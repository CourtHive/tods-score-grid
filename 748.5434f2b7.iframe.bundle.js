/*! For license information please see 748.5434f2b7.iframe.bundle.js.LICENSE.txt */
(self.webpackChunktods_score_grid=self.webpackChunktods_score_grid||[]).push([[748],{"./node_modules/@stitches/react/dist/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{F4:()=>ee,Th:()=>q,iv:()=>te,zo:()=>re});var X,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),e="colors",t="sizes",r="space",n={gap:r,gridGap:r,columnGap:r,gridColumnGap:r,rowGap:r,gridRowGap:r,inset:r,insetBlock:r,insetBlockEnd:r,insetBlockStart:r,insetInline:r,insetInlineEnd:r,insetInlineStart:r,margin:r,marginTop:r,marginRight:r,marginBottom:r,marginLeft:r,marginBlock:r,marginBlockEnd:r,marginBlockStart:r,marginInline:r,marginInlineEnd:r,marginInlineStart:r,padding:r,paddingTop:r,paddingRight:r,paddingBottom:r,paddingLeft:r,paddingBlock:r,paddingBlockEnd:r,paddingBlockStart:r,paddingInline:r,paddingInlineEnd:r,paddingInlineStart:r,top:r,right:r,bottom:r,left:r,scrollMargin:r,scrollMarginTop:r,scrollMarginRight:r,scrollMarginBottom:r,scrollMarginLeft:r,scrollMarginX:r,scrollMarginY:r,scrollMarginBlock:r,scrollMarginBlockEnd:r,scrollMarginBlockStart:r,scrollMarginInline:r,scrollMarginInlineEnd:r,scrollMarginInlineStart:r,scrollPadding:r,scrollPaddingTop:r,scrollPaddingRight:r,scrollPaddingBottom:r,scrollPaddingLeft:r,scrollPaddingX:r,scrollPaddingY:r,scrollPaddingBlock:r,scrollPaddingBlockEnd:r,scrollPaddingBlockStart:r,scrollPaddingInline:r,scrollPaddingInlineEnd:r,scrollPaddingInlineStart:r,fontSize:"fontSizes",background:e,backgroundColor:e,backgroundImage:e,borderImage:e,border:e,borderBlock:e,borderBlockEnd:e,borderBlockStart:e,borderBottom:e,borderBottomColor:e,borderColor:e,borderInline:e,borderInlineEnd:e,borderInlineStart:e,borderLeft:e,borderLeftColor:e,borderRight:e,borderRightColor:e,borderTop:e,borderTopColor:e,caretColor:e,color:e,columnRuleColor:e,fill:e,outline:e,outlineColor:e,stroke:e,textDecorationColor:e,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:t,minBlockSize:t,maxBlockSize:t,inlineSize:t,minInlineSize:t,maxInlineSize:t,width:t,minWidth:t,maxWidth:t,height:t,minHeight:t,maxHeight:t,flexBasis:t,gridTemplateColumns:t,gridTemplateRows:t,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},i=(e,t)=>"function"==typeof t?{"()":Function.prototype.toString.call(t)}:t,o=()=>{const e=Object.create(null);return(t,r,...n)=>{const o=(e=>JSON.stringify(e,i))(t);return o in e?e[o]:e[o]=r(t,...n)}},l=Symbol.for("sxs.internal"),s=(e,t)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)),a=e=>{for(const t in e)return!0;return!1},{hasOwnProperty:c}=Object.prototype,d=e=>e.includes("-")?e:e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),g=/\s+(?![^()]*\))/,p=e=>t=>e(..."string"==typeof t?String(t).split(g):[t]),u={appearance:e=>({WebkitAppearance:e,appearance:e}),backfaceVisibility:e=>({WebkitBackfaceVisibility:e,backfaceVisibility:e}),backdropFilter:e=>({WebkitBackdropFilter:e,backdropFilter:e}),backgroundClip:e=>({WebkitBackgroundClip:e,backgroundClip:e}),boxDecorationBreak:e=>({WebkitBoxDecorationBreak:e,boxDecorationBreak:e}),clipPath:e=>({WebkitClipPath:e,clipPath:e}),content:e=>({content:e.includes('"')||e.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(e)?e:`"${e}"`}),hyphens:e=>({WebkitHyphens:e,hyphens:e}),maskImage:e=>({WebkitMaskImage:e,maskImage:e}),maskSize:e=>({WebkitMaskSize:e,maskSize:e}),tabSize:e=>({MozTabSize:e,tabSize:e}),textSizeAdjust:e=>({WebkitTextSizeAdjust:e,textSizeAdjust:e}),userSelect:e=>({WebkitUserSelect:e,userSelect:e}),marginBlock:p(((e,t)=>({marginBlockStart:e,marginBlockEnd:t||e}))),marginInline:p(((e,t)=>({marginInlineStart:e,marginInlineEnd:t||e}))),maxSize:p(((e,t)=>({maxBlockSize:e,maxInlineSize:t||e}))),minSize:p(((e,t)=>({minBlockSize:e,minInlineSize:t||e}))),paddingBlock:p(((e,t)=>({paddingBlockStart:e,paddingBlockEnd:t||e}))),paddingInline:p(((e,t)=>({paddingInlineStart:e,paddingInlineEnd:t||e})))},h=/([\d.]+)([^]*)/,f=(e,t)=>e.length?e.reduce(((e,r)=>(e.push(...t.map((e=>e.includes("&")?e.replace(/&/g,/[ +>|~]/.test(r)&&/&.*&/.test(e)?`:is(${r})`:r):r+" "+e))),e)),[]):t,m=(e,t)=>e in b&&"string"==typeof t?t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((t,r,n,i)=>r+("stretch"===n?`-moz-available${i};${d(e)}:${r}-webkit-fill-available`:`-moz-fit-content${i};${d(e)}:${r}fit-content`)+i)):String(t),b={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},S=e=>e?e+"-":"",k=(e,t,r)=>e.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((e,n,i,o,l)=>"$"==o==!!i?e:(n||"--"==o?"calc(":"")+"var(--"+("$"===o?S(t)+(l.includes("$")?"":S(r))+l.replace(/\$/g,"-"):l)+")"+(n||"--"==o?"*"+(n||"")+(i||"1")+")":""))),y=/\s*,\s*(?![^()]*\))/,B=Object.prototype.toString,$=(e,t,r,n,i)=>{let o,l,s;const a=(e,t,r)=>{let c,g;const p=e=>{for(c in e){const R=64===c.charCodeAt(0),z=R&&Array.isArray(e[c])?e[c]:[e[c]];for(g of z){const e=/[A-Z]/.test($=c)?$:$.replace(/-[^]/g,(e=>e[1].toUpperCase())),z="object"==typeof g&&g&&g.toString===B&&(!n.utils[e]||!t.length);if(e in n.utils&&!z){const t=n.utils[e];if(t!==l){l=t,p(t(g)),l=null;continue}}else if(e in u){const t=u[e];if(t!==s){s=t,p(t(g)),s=null;continue}}if(R&&(b=c.slice(1)in n.media?"@media "+n.media[c.slice(1)]:c,c=b.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((e,t,r,n,i,o)=>{const l=h.test(t),s=.0625*(l?-1:1),[a,c]=l?[n,t]:[t,n];return"("+("="===r[0]?"":">"===r[0]===l?"max-":"min-")+a+":"+("="!==r[0]&&1===r.length?c.replace(h,((e,t,n)=>Number(t)+s*(">"===r?1:-1)+n)):c)+(i?") and ("+(">"===i[0]?"min-":"max-")+a+":"+(1===i.length?o.replace(h,((e,t,r)=>Number(t)+s*(">"===i?-1:1)+r)):o):"")+")"}))),z){const e=R?r.concat(c):[...r],n=R?[...t]:f(t,c.split(y));void 0!==o&&i(x(...o)),o=void 0,a(g,n,e)}else void 0===o&&(o=[[],t,r]),c=R||36!==c.charCodeAt(0)?c:`--${S(n.prefix)}${c.slice(1).replace(/\$/g,"-")}`,g=z?g:"number"==typeof g?g&&e in I?String(g)+"px":String(g):k(m(e,null==g?"":g),n.prefix,n.themeMap[e]),o[0].push(`${R?`${c} `:`${d(c)}:`}${g}`)}}var b,$};p(e),void 0!==o&&i(x(...o)),o=void 0};a(e,t,r)},x=(e,t,r)=>`${r.map((e=>`${e}{`)).join("")}${t.length?`${t.join(",")}{`:""}${e.join(";")}${t.length?"}":""}${Array(r.length?r.length+1:0).join("}")}`,I={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},R=e=>String.fromCharCode(e+(e>25?39:97)),z=e=>(e=>{let t,r="";for(t=Math.abs(e);t>52;t=t/52|0)r=R(t%52)+r;return R(t%52)+r})(((e,t)=>{let r=t.length;for(;r;)e=33*e^t.charCodeAt(--r);return e})(5381,JSON.stringify(e))>>>0),W=["themed","global","styled","onevar","resonevar","allvar","inline"],j=e=>{if(e.href&&!e.href.startsWith(location.origin))return!1;try{return!!e.cssRules}catch(e){return!1}},E=e=>{let t;const r=()=>{const{cssRules:e}=t.sheet;return[].map.call(e,((r,n)=>{const{cssText:i}=r;let o="";if(i.startsWith("--sxs"))return"";if(e[n-1]&&(o=e[n-1].cssText).startsWith("--sxs")){if(!r.cssRules.length)return"";for(const e in t.rules)if(t.rules[e].group===r)return`--sxs{--sxs:${[...t.rules[e].cache].join(" ")}}${i}`;return r.cssRules.length?`${o}${i}`:""}return i})).join("")},n=()=>{if(t){const{rules:e,sheet:r}=t;if(!r.deleteRule){for(;3===Object(Object(r.cssRules)[0]).type;)r.cssRules.splice(0,1);r.cssRules=[]}for(const t in e)delete e[t]}const i=Object(e).styleSheets||[];for(const e of i)if(j(e)){for(let i=0,o=e.cssRules;o[i];++i){const l=Object(o[i]);if(1!==l.type)continue;const s=Object(o[i+1]);if(4!==s.type)continue;++i;const{cssText:a}=l;if(!a.startsWith("--sxs"))continue;const c=a.slice(14,-3).trim().split(/\s+/),d=W[c[0]];d&&(t||(t={sheet:e,reset:n,rules:{},toString:r}),t.rules[d]={group:s,index:i,cache:new Set(c)})}if(t)break}if(!t){const i=(e,t)=>({type:t,cssRules:[],insertRule(e,t){this.cssRules.splice(t,0,i(e,{import:3,undefined:1}[(e.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return"@media{}"===e?`@media{${[].map.call(this.cssRules,(e=>e.cssText)).join("")}}`:e}});t={sheet:e?(e.head||e).appendChild(document.createElement("style")).sheet:i("","text/css"),rules:{},reset:n,toString:r}}const{sheet:o,rules:l}=t;for(let e=W.length-1;e>=0;--e){const t=W[e];if(!l[t]){const r=W[e+1],n=l[r]?l[r].index:o.cssRules.length;o.insertRule("@media{}",n),o.insertRule(`--sxs{--sxs:${e}}`,n),l[t]={group:o.cssRules[n+1],index:n,cache:new Set([e])}}v(l[t])}};return n(),t},v=e=>{const t=e.group;let r=t.cssRules.length;e.apply=e=>{try{t.insertRule(e,r),++r}catch(e){}}},T=Symbol(),w=o(),M=(e,t)=>w(e,(()=>(...r)=>{let n={type:null,composers:new Set};for(const t of r)if(null!=t)if(t[l]){null==n.type&&(n.type=t[l].type);for(const e of t[l].composers)n.composers.add(e)}else t.constructor!==Object||t.$$typeof?null==n.type&&(n.type=t):n.composers.add(C(t,e));return null==n.type&&(n.type="span"),n.composers.size||n.composers.add(["PJLV",{},[],[],{},[]]),P(e,n,t)})),C=({variants:e,compoundVariants:t,defaultVariants:r,...n},i)=>{const o=`${S(i.prefix)}c-${z(n)}`,l=[],s=[],d=Object.create(null),g=[];for(const e in r)d[e]=String(r[e]);if("object"==typeof e&&e)for(const t in e){p=d,u=t,c.call(p,u)||(d[t]="undefined");const r=e[t];for(const e in r){const n={[t]:String(e)};"undefined"===String(e)&&g.push(t);const i=r[e],o=[n,i,!a(i)];l.push(o)}}var p,u;if("object"==typeof t&&t)for(const e of t){let{css:t,...r}=e;t="object"==typeof t&&t||{};for(const e in r)r[e]=String(r[e]);const n=[r,t,!a(t)];s.push(n)}return[o,n,l,s,d,g]},P=(e,t,r)=>{const[n,i,o,a]=L(t.composers),c="function"==typeof t.type||t.type.$$typeof?(e=>{function t(){for(let r=0;r<t[T].length;r++){const[n,i]=t[T][r];e.rules[n].apply(i)}return t[T]=[],null}return t[T]=[],t.rules={},W.forEach((e=>t.rules[e]={apply:r=>t[T].push([e,r])})),t})(r):null,d=(c||r).rules,g=`.${n}${i.length>1?`:where(.${i.slice(1).join(".")})`:""}`,p=l=>{l="object"==typeof l&&l||A;const{css:s,...p}=l,u={};for(const e in o)if(delete p[e],e in l){let t=l[e];"object"==typeof t&&t?u[e]={"@initial":o[e],...t}:(t=String(t),u[e]="undefined"!==t||a.has(e)?t:o[e])}else u[e]=o[e];const h=new Set([...i]);for(const[n,i,o,l]of t.composers){r.rules.styled.cache.has(n)||(r.rules.styled.cache.add(n),$(i,[`.${n}`],[],e,(e=>{d.styled.apply(e)})));const t=O(o,u,e.media),s=O(l,u,e.media,!0);for(const i of t)if(void 0!==i)for(const[t,o,l]of i){const i=`${n}-${z(o)}-${t}`;h.add(i);const s=(l?r.rules.resonevar:r.rules.onevar).cache,a=l?d.resonevar:d.onevar;s.has(i)||(s.add(i),$(o,[`.${i}`],[],e,(e=>{a.apply(e)})))}for(const t of s)if(void 0!==t)for(const[i,o]of t){const t=`${n}-${z(o)}-${i}`;h.add(t),r.rules.allvar.cache.has(t)||(r.rules.allvar.cache.add(t),$(o,[`.${t}`],[],e,(e=>{d.allvar.apply(e)})))}}if("object"==typeof s&&s){const t=`${n}-i${z(s)}-css`;h.add(t),r.rules.inline.cache.has(t)||(r.rules.inline.cache.add(t),$(s,[`.${t}`],[],e,(e=>{d.inline.apply(e)})))}for(const e of String(l.className||"").trim().split(/\s+/))e&&h.add(e);const f=p.className=[...h].join(" ");return{type:t.type,className:f,selector:g,props:p,toString:()=>f,deferredInjector:c}};return s(p,{className:n,selector:g,[l]:t,toString:()=>(r.rules.styled.cache.has(n)||p(),n)})},L=e=>{let t="";const r=[],n={},i=[];for(const[o,,,,l,s]of e){""===t&&(t=o),r.push(o),i.push(...s);for(const e in l){const t=l[e];(void 0===n[e]||"undefined"!==t||s.includes(t))&&(n[e]=t)}}return[t,r,n,new Set(i)]},O=(e,t,r,n)=>{const i=[];e:for(let[o,l,s]of e){if(s)continue;let e,a=0,c=!1;for(e in o){const n=o[e];let i=t[e];if(i!==n){if("object"!=typeof i||!i)continue e;{let e,t,o=0;for(const l in i){if(n===String(i[l])){if("@initial"!==l){const e=l.slice(1);(t=t||[]).push(e in r?r[e]:l.replace(/^@media ?/,"")),c=!0}a+=o,e=!0}++o}if(t&&t.length&&(l={["@media "+t.join(", ")]:l}),!e)continue e}}}(i[a]=i[a]||[]).push([n?"cv":`${e}-${o[e]}`,l,c])}return i},A={},N=o(),D=(e,t)=>N(e,(()=>(...r)=>{const n=()=>{for(let n of r){n="object"==typeof n&&n||{};let r=z(n);if(!t.rules.global.cache.has(r)){if(t.rules.global.cache.add(r),"@import"in n){let e=[].indexOf.call(t.sheet.cssRules,t.rules.themed.group)-1;for(let r of[].concat(n["@import"]))r=r.includes('"')||r.includes("'")?r:`"${r}"`,t.sheet.insertRule(`@import ${r};`,e++);delete n["@import"]}$(n,[],[],e,(e=>{t.rules.global.apply(e)}))}}return""};return s(n,{toString:n})})),H=o(),V=(e,t)=>H(e,(()=>r=>{const n=`${S(e.prefix)}k-${z(r)}`,i=()=>{if(!t.rules.global.cache.has(n)){t.rules.global.cache.add(n);const i=[];$(r,[],[],e,(e=>i.push(e)));const o=`@keyframes ${n}{${i.join("")}}`;t.rules.global.apply(o)}return n};return s(i,{get name(){return i()},toString:i})})),G=class{constructor(e,t,r,n){this.token=null==e?"":String(e),this.value=null==t?"":String(t),this.scale=null==r?"":String(r),this.prefix=null==n?"":String(n)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+S(this.prefix)+S(this.scale)+this.token}toString(){return this.computedValue}},F=o(),J=(e,t)=>F(e,(()=>(r,n)=>{n="object"==typeof r&&r||Object(n);const i=`.${r=(r="string"==typeof r?r:"")||`${S(e.prefix)}t-${z(n)}`}`,o={},l=[];for(const t in n){o[t]={};for(const r in n[t]){const i=`--${S(e.prefix)}${t}-${r}`,s=k(String(n[t][r]),e.prefix,t);o[t][r]=new G(r,s,t,e.prefix),l.push(`${i}:${s}`)}}const s=()=>{if(l.length&&!t.rules.themed.cache.has(r)){t.rules.themed.cache.add(r);const i=`${n===e.theme?":root,":""}.${r}{${l.join(";")}}`;t.rules.themed.apply(i)}return r};return{...o,get className(){return s()},selector:i,toString:s}})),U=o(),Y=o(),q=e=>{const t=(e=>{let t=!1;const r=U(e,(e=>{t=!0;const r="prefix"in(e="object"==typeof e&&e||{})?String(e.prefix):"",i="object"==typeof e.media&&e.media||{},o="object"==typeof e.root?e.root||null:globalThis.document||null,l="object"==typeof e.theme&&e.theme||{},s={prefix:r,media:i,theme:l,themeMap:"object"==typeof e.themeMap&&e.themeMap||{...n},utils:"object"==typeof e.utils&&e.utils||{}},a=E(o),c={css:M(s,a),globalCss:D(s,a),keyframes:V(s,a),createTheme:J(s,a),reset(){a.reset(),c.theme.toString()},theme:{},sheet:a,config:s,prefix:r,getCssText:a.toString,toString:a.toString};return String(c.theme=c.createTheme(l)),c}));return t||r.reset(),r})(e);return t.styled=(({config:e,sheet:t})=>Y(e,(()=>{const r=M(e,t);return(...e)=>{const t=r(...e),n=t[l].type,i=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef(((e,r)=>{const i=e&&e.as||n,{props:o,deferredInjector:l}=t(e);return delete o.as,o.ref=r,l?react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(i,o),react__WEBPACK_IMPORTED_MODULE_0__.createElement(l,null)):react__WEBPACK_IMPORTED_MODULE_0__.createElement(i,o)}));return i.className=t.className,i.displayName=`Styled.${n.displayName||n.name||n}`,i.selector=t.selector,i.toString=()=>t.selector,i[l]=t[l],i}})))(t),t},K=()=>X||(X=q()),ee=(...e)=>K().keyframes(...e),te=(...e)=>K().css(...e),re=(...e)=>K().styled(...e)},"./node_modules/classnames/index.js":(module,exports)=>{var __WEBPACK_AMD_DEFINE_RESULT__;!function(){"use strict";var hasOwn={}.hasOwnProperty;function classNames(){for(var classes=[],i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){var argType=typeof arg;if("string"===argType||"number"===argType)classes.push(arg);else if(Array.isArray(arg)){if(arg.length){var inner=classNames.apply(null,arg);inner&&classes.push(inner)}}else if("object"===argType){if(arg.toString!==Object.prototype.toString&&!arg.toString.toString().includes("[native code]")){classes.push(arg.toString());continue}for(var key in arg)hasOwn.call(arg,key)&&arg[key]&&classes.push(key)}}}return classes.join(" ")}module.exports?(classNames.default=classNames,module.exports=classNames):void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return classNames}.apply(exports,[]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()},"./node_modules/dayjs/dayjs.min.js":function(module){module.exports=function(){"use strict";var t=1e3,e=6e4,n=36e5,r="millisecond",i="second",s="minute",u="hour",a="day",o="week",f="month",h="quarter",c="year",d="date",l="Invalid Date",$=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,M={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||e[0])+"]"}},m=function(t,e,n){var r=String(t);return!r||r.length>=e?t:""+Array(e+1-r.length).join(n)+t},v={s:m,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),r=Math.floor(n/60),i=n%60;return(e<=0?"+":"-")+m(r,2,"0")+":"+m(i,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),i=e.clone().add(r,f),s=n-i<0,u=e.clone().add(r+(s?-1:1),f);return+(-(r+(n-i)/(s?i-u:u-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:f,y:c,w:o,d:a,D:d,h:u,m:s,s:i,ms:r,Q:h}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},g="en",D={};D[g]=M;var p=function(t){return t instanceof _},S=function t(e,n,r){var i;if(!e)return g;if("string"==typeof e){var s=e.toLowerCase();D[s]&&(i=s),n&&(D[s]=n,i=s);var u=e.split("-");if(!i&&u.length>1)return t(u[0])}else{var a=e.name;D[a]=e,i=a}return!r&&i&&(g=i),i||!r&&g},w=function(t,e){if(p(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new _(n)},O=v;O.l=S,O.i=p,O.w=function(t,e){return w(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var _=function(){function M(t){this.$L=S(t.locale,null,!0),this.parse(t)}var m=M.prototype;return m.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(O.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var r=e.match($);if(r){var i=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},m.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},m.$utils=function(){return O},m.isValid=function(){return!(this.$d.toString()===l)},m.isSame=function(t,e){var n=w(t);return this.startOf(e)<=n&&n<=this.endOf(e)},m.isAfter=function(t,e){return w(t)<this.startOf(e)},m.isBefore=function(t,e){return this.endOf(e)<w(t)},m.$g=function(t,e,n){return O.u(t)?this[e]:this.set(n,t)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(t,e){var n=this,r=!!O.u(e)||e,h=O.p(t),l=function(t,e){var i=O.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return r?i:i.endOf(a)},$=function(t,e){return O.w(n.toDate()[t].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},y=this.$W,M=this.$M,m=this.$D,v="set"+(this.$u?"UTC":"");switch(h){case c:return r?l(1,0):l(31,11);case f:return r?l(1,M):l(0,M+1);case o:var g=this.$locale().weekStart||0,D=(y<g?y+7:y)-g;return l(r?m-D:m+(6-D),M);case a:case d:return $(v+"Hours",0);case u:return $(v+"Minutes",1);case s:return $(v+"Seconds",2);case i:return $(v+"Milliseconds",3);default:return this.clone()}},m.endOf=function(t){return this.startOf(t,!1)},m.$set=function(t,e){var n,o=O.p(t),h="set"+(this.$u?"UTC":""),l=(n={},n[a]=h+"Date",n[d]=h+"Date",n[f]=h+"Month",n[c]=h+"FullYear",n[u]=h+"Hours",n[s]=h+"Minutes",n[i]=h+"Seconds",n[r]=h+"Milliseconds",n)[o],$=o===a?this.$D+(e-this.$W):e;if(o===f||o===c){var y=this.clone().set(d,1);y.$d[l]($),y.init(),this.$d=y.set(d,Math.min(this.$D,y.daysInMonth())).$d}else l&&this.$d[l]($);return this.init(),this},m.set=function(t,e){return this.clone().$set(t,e)},m.get=function(t){return this[O.p(t)]()},m.add=function(r,h){var d,l=this;r=Number(r);var $=O.p(h),y=function(t){var e=w(l);return O.w(e.date(e.date()+Math.round(t*r)),l)};if($===f)return this.set(f,this.$M+r);if($===c)return this.set(c,this.$y+r);if($===a)return y(1);if($===o)return y(7);var M=(d={},d[s]=e,d[u]=n,d[i]=t,d)[$]||1,m=this.$d.getTime()+r*M;return O.w(m,this)},m.subtract=function(t,e){return this.add(-1*t,e)},m.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||l;var r=t||"YYYY-MM-DDTHH:mm:ssZ",i=O.z(this),s=this.$H,u=this.$m,a=this.$M,o=n.weekdays,f=n.months,h=function(t,n,i,s){return t&&(t[n]||t(e,r))||i[n].slice(0,s)},c=function(t){return O.s(s%12||12,t,"0")},d=n.meridiem||function(t,e,n){var r=t<12?"AM":"PM";return n?r.toLowerCase():r},$={YY:String(this.$y).slice(-2),YYYY:O.s(this.$y,4,"0"),M:a+1,MM:O.s(a+1,2,"0"),MMM:h(n.monthsShort,a,f,3),MMMM:h(f,a),D:this.$D,DD:O.s(this.$D,2,"0"),d:String(this.$W),dd:h(n.weekdaysMin,this.$W,o,2),ddd:h(n.weekdaysShort,this.$W,o,3),dddd:o[this.$W],H:String(s),HH:O.s(s,2,"0"),h:c(1),hh:c(2),a:d(s,u,!0),A:d(s,u,!1),m:String(u),mm:O.s(u,2,"0"),s:String(this.$s),ss:O.s(this.$s,2,"0"),SSS:O.s(this.$ms,3,"0"),Z:i};return r.replace(y,(function(t,e){return e||$[t]||i.replace(":","")}))},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(r,d,l){var $,y=O.p(d),M=w(r),m=(M.utcOffset()-this.utcOffset())*e,v=this-M,g=O.m(this,M);return g=($={},$[c]=g/12,$[f]=g,$[h]=g/3,$[o]=(v-m)/6048e5,$[a]=(v-m)/864e5,$[u]=v/n,$[s]=v/e,$[i]=v/t,$)[y]||v,l?g:O.a(g)},m.daysInMonth=function(){return this.endOf(f).$D},m.$locale=function(){return D[this.$L]},m.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=S(t,e,!0);return r&&(n.$L=r),n},m.clone=function(){return O.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},M}(),T=_.prototype;return w.prototype=T,[["$ms",r],["$s",i],["$m",s],["$H",u],["$W",a],["$M",f],["$y",c],["$D",d]].forEach((function(t){T[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),w.extend=function(t,e){return t.$i||(t(e,_,w),t.$i=!0),w},w.locale=S,w.isDayjs=p,w.unix=function(t){return w(1e3*t)},w.en=D[g],w.Ls=D,w.p={},w}()},"./node_modules/fast-deep-equal/index.js":module=>{"use strict";module.exports=function equal(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){if(a.constructor!==b.constructor)return!1;var length,i,keys;if(Array.isArray(a)){if((length=a.length)!=b.length)return!1;for(i=length;0!=i--;)if(!equal(a[i],b[i]))return!1;return!0}if(a.constructor===RegExp)return a.source===b.source&&a.flags===b.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===b.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===b.toString();if((length=(keys=Object.keys(a)).length)!==Object.keys(b).length)return!1;for(i=length;0!=i--;)if(!Object.prototype.hasOwnProperty.call(b,keys[i]))return!1;for(i=length;0!=i--;){var key=keys[i];if(!equal(a[key],b[key]))return!1}return!0}return a!=a&&b!=b}},"./node_modules/lodash/_apply.js":module=>{module.exports=function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}},"./node_modules/lodash/_arrayAggregator.js":module=>{module.exports=function arrayAggregator(array,setter,iteratee,accumulator){for(var index=-1,length=null==array?0:array.length;++index<length;){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}},"./node_modules/lodash/_assignMergeValue.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseAssignValue=__webpack_require__("./node_modules/lodash/_baseAssignValue.js"),eq=__webpack_require__("./node_modules/lodash/eq.js");module.exports=function assignMergeValue(object,key,value){(void 0!==value&&!eq(object[key],value)||void 0===value&&!(key in object))&&baseAssignValue(object,key,value)}},"./node_modules/lodash/_baseAggregator.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseEach=__webpack_require__("./node_modules/lodash/_baseEach.js");module.exports=function baseAggregator(collection,setter,iteratee,accumulator){return baseEach(collection,(function(value,key,collection){setter(accumulator,value,iteratee(value),collection)})),accumulator}},"./node_modules/lodash/_baseEach.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseForOwn=__webpack_require__("./node_modules/lodash/_baseForOwn.js"),baseEach=__webpack_require__("./node_modules/lodash/_createBaseEach.js")(baseForOwn);module.exports=baseEach},"./node_modules/lodash/_baseFlatten.js":(module,__unused_webpack_exports,__webpack_require__)=>{var arrayPush=__webpack_require__("./node_modules/lodash/_arrayPush.js"),isFlattenable=__webpack_require__("./node_modules/lodash/_isFlattenable.js");module.exports=function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;for(predicate||(predicate=isFlattenable),result||(result=[]);++index<length;){var value=array[index];depth>0&&predicate(value)?depth>1?baseFlatten(value,depth-1,predicate,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}},"./node_modules/lodash/_baseMerge.js":(module,__unused_webpack_exports,__webpack_require__)=>{var Stack=__webpack_require__("./node_modules/lodash/_Stack.js"),assignMergeValue=__webpack_require__("./node_modules/lodash/_assignMergeValue.js"),baseFor=__webpack_require__("./node_modules/lodash/_baseFor.js"),baseMergeDeep=__webpack_require__("./node_modules/lodash/_baseMergeDeep.js"),isObject=__webpack_require__("./node_modules/lodash/isObject.js"),keysIn=__webpack_require__("./node_modules/lodash/keysIn.js"),safeGet=__webpack_require__("./node_modules/lodash/_safeGet.js");module.exports=function baseMerge(object,source,srcIndex,customizer,stack){object!==source&&baseFor(source,(function(srcValue,key){if(stack||(stack=new Stack),isObject(srcValue))baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack);else{var newValue=customizer?customizer(safeGet(object,key),srcValue,key+"",object,source,stack):void 0;void 0===newValue&&(newValue=srcValue),assignMergeValue(object,key,newValue)}}),keysIn)}},"./node_modules/lodash/_baseMergeDeep.js":(module,__unused_webpack_exports,__webpack_require__)=>{var assignMergeValue=__webpack_require__("./node_modules/lodash/_assignMergeValue.js"),cloneBuffer=__webpack_require__("./node_modules/lodash/_cloneBuffer.js"),cloneTypedArray=__webpack_require__("./node_modules/lodash/_cloneTypedArray.js"),copyArray=__webpack_require__("./node_modules/lodash/_copyArray.js"),initCloneObject=__webpack_require__("./node_modules/lodash/_initCloneObject.js"),isArguments=__webpack_require__("./node_modules/lodash/isArguments.js"),isArray=__webpack_require__("./node_modules/lodash/isArray.js"),isArrayLikeObject=__webpack_require__("./node_modules/lodash/isArrayLikeObject.js"),isBuffer=__webpack_require__("./node_modules/lodash/isBuffer.js"),isFunction=__webpack_require__("./node_modules/lodash/isFunction.js"),isObject=__webpack_require__("./node_modules/lodash/isObject.js"),isPlainObject=__webpack_require__("./node_modules/lodash/isPlainObject.js"),isTypedArray=__webpack_require__("./node_modules/lodash/isTypedArray.js"),safeGet=__webpack_require__("./node_modules/lodash/_safeGet.js"),toPlainObject=__webpack_require__("./node_modules/lodash/toPlainObject.js");module.exports=function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=safeGet(object,key),srcValue=safeGet(source,key),stacked=stack.get(srcValue);if(stacked)assignMergeValue(object,key,stacked);else{var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):void 0,isCommon=void 0===newValue;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue,isArr||isBuff||isTyped?isArray(objValue)?newValue=objValue:isArrayLikeObject(objValue)?newValue=copyArray(objValue):isBuff?(isCommon=!1,newValue=cloneBuffer(srcValue,!0)):isTyped?(isCommon=!1,newValue=cloneTypedArray(srcValue,!0)):newValue=[]:isPlainObject(srcValue)||isArguments(srcValue)?(newValue=objValue,isArguments(objValue)?newValue=toPlainObject(objValue):isObject(objValue)&&!isFunction(objValue)||(newValue=initCloneObject(srcValue))):isCommon=!1}isCommon&&(stack.set(srcValue,newValue),mergeFunc(newValue,srcValue,srcIndex,customizer,stack),stack.delete(srcValue)),assignMergeValue(object,key,newValue)}}},"./node_modules/lodash/_basePick.js":(module,__unused_webpack_exports,__webpack_require__)=>{var basePickBy=__webpack_require__("./node_modules/lodash/_basePickBy.js"),hasIn=__webpack_require__("./node_modules/lodash/hasIn.js");module.exports=function basePick(object,paths){return basePickBy(object,paths,(function(value,path){return hasIn(object,path)}))}},"./node_modules/lodash/_baseRest.js":(module,__unused_webpack_exports,__webpack_require__)=>{var identity=__webpack_require__("./node_modules/lodash/identity.js"),overRest=__webpack_require__("./node_modules/lodash/_overRest.js"),setToString=__webpack_require__("./node_modules/lodash/_setToString.js");module.exports=function baseRest(func,start){return setToString(overRest(func,start,identity),func+"")}},"./node_modules/lodash/_baseSetToString.js":(module,__unused_webpack_exports,__webpack_require__)=>{var constant=__webpack_require__("./node_modules/lodash/constant.js"),defineProperty=__webpack_require__("./node_modules/lodash/_defineProperty.js"),identity=__webpack_require__("./node_modules/lodash/identity.js"),baseSetToString=defineProperty?function(func,string){return defineProperty(func,"toString",{configurable:!0,enumerable:!1,value:constant(string),writable:!0})}:identity;module.exports=baseSetToString},"./node_modules/lodash/_createAggregator.js":(module,__unused_webpack_exports,__webpack_require__)=>{var arrayAggregator=__webpack_require__("./node_modules/lodash/_arrayAggregator.js"),baseAggregator=__webpack_require__("./node_modules/lodash/_baseAggregator.js"),baseIteratee=__webpack_require__("./node_modules/lodash/_baseIteratee.js"),isArray=__webpack_require__("./node_modules/lodash/isArray.js");module.exports=function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,baseIteratee(iteratee,2),accumulator)}}},"./node_modules/lodash/_createAssigner.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseRest=__webpack_require__("./node_modules/lodash/_baseRest.js"),isIterateeCall=__webpack_require__("./node_modules/lodash/_isIterateeCall.js");module.exports=function createAssigner(assigner){return baseRest((function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:void 0,guard=length>2?sources[2]:void 0;for(customizer=assigner.length>3&&"function"==typeof customizer?(length--,customizer):void 0,guard&&isIterateeCall(sources[0],sources[1],guard)&&(customizer=length<3?void 0:customizer,length=1),object=Object(object);++index<length;){var source=sources[index];source&&assigner(object,source,index,customizer)}return object}))}},"./node_modules/lodash/_createBaseEach.js":(module,__unused_webpack_exports,__webpack_require__)=>{var isArrayLike=__webpack_require__("./node_modules/lodash/isArrayLike.js");module.exports=function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(null==collection)return collection;if(!isArrayLike(collection))return eachFunc(collection,iteratee);for(var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);(fromRight?index--:++index<length)&&!1!==iteratee(iterable[index],index,iterable););return collection}}},"./node_modules/lodash/_flatRest.js":(module,__unused_webpack_exports,__webpack_require__)=>{var flatten=__webpack_require__("./node_modules/lodash/flatten.js"),overRest=__webpack_require__("./node_modules/lodash/_overRest.js"),setToString=__webpack_require__("./node_modules/lodash/_setToString.js");module.exports=function flatRest(func){return setToString(overRest(func,void 0,flatten),func+"")}},"./node_modules/lodash/_isFlattenable.js":(module,__unused_webpack_exports,__webpack_require__)=>{var Symbol=__webpack_require__("./node_modules/lodash/_Symbol.js"),isArguments=__webpack_require__("./node_modules/lodash/isArguments.js"),isArray=__webpack_require__("./node_modules/lodash/isArray.js"),spreadableSymbol=Symbol?Symbol.isConcatSpreadable:void 0;module.exports=function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}},"./node_modules/lodash/_isIterateeCall.js":(module,__unused_webpack_exports,__webpack_require__)=>{var eq=__webpack_require__("./node_modules/lodash/eq.js"),isArrayLike=__webpack_require__("./node_modules/lodash/isArrayLike.js"),isIndex=__webpack_require__("./node_modules/lodash/_isIndex.js"),isObject=__webpack_require__("./node_modules/lodash/isObject.js");module.exports=function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;return!!("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object)&&eq(object[index],value)}},"./node_modules/lodash/_overRest.js":(module,__unused_webpack_exports,__webpack_require__)=>{var apply=__webpack_require__("./node_modules/lodash/_apply.js"),nativeMax=Math.max;module.exports=function overRest(func,start,transform){return start=nativeMax(void 0===start?func.length-1:start,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);++index<length;)array[index]=args[start+index];index=-1;for(var otherArgs=Array(start+1);++index<start;)otherArgs[index]=args[index];return otherArgs[start]=transform(array),apply(func,this,otherArgs)}}},"./node_modules/lodash/_safeGet.js":module=>{module.exports=function safeGet(object,key){if(("constructor"!==key||"function"!=typeof object[key])&&"__proto__"!=key)return object[key]}},"./node_modules/lodash/_setToString.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseSetToString=__webpack_require__("./node_modules/lodash/_baseSetToString.js"),setToString=__webpack_require__("./node_modules/lodash/_shortOut.js")(baseSetToString);module.exports=setToString},"./node_modules/lodash/_shortOut.js":module=>{var nativeNow=Date.now;module.exports=function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=16-(stamp-lastCalled);if(lastCalled=stamp,remaining>0){if(++count>=800)return arguments[0]}else count=0;return func.apply(void 0,arguments)}}},"./node_modules/lodash/constant.js":module=>{module.exports=function constant(value){return function(){return value}}},"./node_modules/lodash/countBy.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseAssignValue=__webpack_require__("./node_modules/lodash/_baseAssignValue.js"),createAggregator=__webpack_require__("./node_modules/lodash/_createAggregator.js"),hasOwnProperty=Object.prototype.hasOwnProperty,countBy=createAggregator((function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:baseAssignValue(result,key,1)}));module.exports=countBy},"./node_modules/lodash/flatten.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseFlatten=__webpack_require__("./node_modules/lodash/_baseFlatten.js");module.exports=function flatten(array){return(null==array?0:array.length)?baseFlatten(array,1):[]}},"./node_modules/lodash/isArrayLikeObject.js":(module,__unused_webpack_exports,__webpack_require__)=>{var isArrayLike=__webpack_require__("./node_modules/lodash/isArrayLike.js"),isObjectLike=__webpack_require__("./node_modules/lodash/isObjectLike.js");module.exports=function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}},"./node_modules/lodash/isEqual.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseIsEqual=__webpack_require__("./node_modules/lodash/_baseIsEqual.js");module.exports=function isEqual(value,other){return baseIsEqual(value,other)}},"./node_modules/lodash/mergeWith.js":(module,__unused_webpack_exports,__webpack_require__)=>{var baseMerge=__webpack_require__("./node_modules/lodash/_baseMerge.js"),mergeWith=__webpack_require__("./node_modules/lodash/_createAssigner.js")((function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer)}));module.exports=mergeWith},"./node_modules/lodash/pick.js":(module,__unused_webpack_exports,__webpack_require__)=>{var basePick=__webpack_require__("./node_modules/lodash/_basePick.js"),pick=__webpack_require__("./node_modules/lodash/_flatRest.js")((function(object,paths){return null==object?{}:basePick(object,paths)}));module.exports=pick},"./node_modules/lodash/toPlainObject.js":(module,__unused_webpack_exports,__webpack_require__)=>{var copyObject=__webpack_require__("./node_modules/lodash/_copyObject.js"),keysIn=__webpack_require__("./node_modules/lodash/keysIn.js");module.exports=function toPlainObject(value){return copyObject(value,keysIn(value))}},"./node_modules/object-inspect/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{var hasMap="function"==typeof Map&&Map.prototype,mapSizeDescriptor=Object.getOwnPropertyDescriptor&&hasMap?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,mapSize=hasMap&&mapSizeDescriptor&&"function"==typeof mapSizeDescriptor.get?mapSizeDescriptor.get:null,mapForEach=hasMap&&Map.prototype.forEach,hasSet="function"==typeof Set&&Set.prototype,setSizeDescriptor=Object.getOwnPropertyDescriptor&&hasSet?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,setSize=hasSet&&setSizeDescriptor&&"function"==typeof setSizeDescriptor.get?setSizeDescriptor.get:null,setForEach=hasSet&&Set.prototype.forEach,weakMapHas="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,weakSetHas="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,weakRefDeref="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,booleanValueOf=Boolean.prototype.valueOf,objectToString=Object.prototype.toString,functionToString=Function.prototype.toString,$match=String.prototype.match,$slice=String.prototype.slice,$replace=String.prototype.replace,$toUpperCase=String.prototype.toUpperCase,$toLowerCase=String.prototype.toLowerCase,$test=RegExp.prototype.test,$concat=Array.prototype.concat,$join=Array.prototype.join,$arrSlice=Array.prototype.slice,$floor=Math.floor,bigIntValueOf="function"==typeof BigInt?BigInt.prototype.valueOf:null,gOPS=Object.getOwnPropertySymbols,symToString="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,hasShammedSymbols="function"==typeof Symbol&&"object"==typeof Symbol.iterator,toStringTag="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===hasShammedSymbols||"symbol")?Symbol.toStringTag:null,isEnumerable=Object.prototype.propertyIsEnumerable,gPO=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(O){return O.__proto__}:null);function addNumericSeparator(num,str){if(num===1/0||num===-1/0||num!=num||num&&num>-1e3&&num<1e3||$test.call(/e/,str))return str;var sepRegex=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof num){var int=num<0?-$floor(-num):$floor(num);if(int!==num){var intStr=String(int),dec=$slice.call(str,intStr.length+1);return $replace.call(intStr,sepRegex,"$&_")+"."+$replace.call($replace.call(dec,/([0-9]{3})/g,"$&_"),/_$/,"")}}return $replace.call(str,sepRegex,"$&_")}var utilInspect=__webpack_require__("?4f7e"),inspectCustom=utilInspect.custom,inspectSymbol=isSymbol(inspectCustom)?inspectCustom:null;function wrapQuotes(s,defaultStyle,opts){var quoteChar="double"===(opts.quoteStyle||defaultStyle)?'"':"'";return quoteChar+s+quoteChar}function quote(s){return $replace.call(String(s),/"/g,"&quot;")}function isArray(obj){return!("[object Array]"!==toStr(obj)||toStringTag&&"object"==typeof obj&&toStringTag in obj)}function isRegExp(obj){return!("[object RegExp]"!==toStr(obj)||toStringTag&&"object"==typeof obj&&toStringTag in obj)}function isSymbol(obj){if(hasShammedSymbols)return obj&&"object"==typeof obj&&obj instanceof Symbol;if("symbol"==typeof obj)return!0;if(!obj||"object"!=typeof obj||!symToString)return!1;try{return symToString.call(obj),!0}catch(e){}return!1}module.exports=function inspect_(obj,options,depth,seen){var opts=options||{};if(has(opts,"quoteStyle")&&"single"!==opts.quoteStyle&&"double"!==opts.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(has(opts,"maxStringLength")&&("number"==typeof opts.maxStringLength?opts.maxStringLength<0&&opts.maxStringLength!==1/0:null!==opts.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var customInspect=!has(opts,"customInspect")||opts.customInspect;if("boolean"!=typeof customInspect&&"symbol"!==customInspect)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(has(opts,"indent")&&null!==opts.indent&&"\t"!==opts.indent&&!(parseInt(opts.indent,10)===opts.indent&&opts.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(has(opts,"numericSeparator")&&"boolean"!=typeof opts.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var numericSeparator=opts.numericSeparator;if(void 0===obj)return"undefined";if(null===obj)return"null";if("boolean"==typeof obj)return obj?"true":"false";if("string"==typeof obj)return inspectString(obj,opts);if("number"==typeof obj){if(0===obj)return 1/0/obj>0?"0":"-0";var str=String(obj);return numericSeparator?addNumericSeparator(obj,str):str}if("bigint"==typeof obj){var bigIntStr=String(obj)+"n";return numericSeparator?addNumericSeparator(obj,bigIntStr):bigIntStr}var maxDepth=void 0===opts.depth?5:opts.depth;if(void 0===depth&&(depth=0),depth>=maxDepth&&maxDepth>0&&"object"==typeof obj)return isArray(obj)?"[Array]":"[Object]";var indent=function getIndent(opts,depth){var baseIndent;if("\t"===opts.indent)baseIndent="\t";else{if(!("number"==typeof opts.indent&&opts.indent>0))return null;baseIndent=$join.call(Array(opts.indent+1)," ")}return{base:baseIndent,prev:$join.call(Array(depth+1),baseIndent)}}(opts,depth);if(void 0===seen)seen=[];else if(indexOf(seen,obj)>=0)return"[Circular]";function inspect(value,from,noIndent){if(from&&(seen=$arrSlice.call(seen)).push(from),noIndent){var newOpts={depth:opts.depth};return has(opts,"quoteStyle")&&(newOpts.quoteStyle=opts.quoteStyle),inspect_(value,newOpts,depth+1,seen)}return inspect_(value,opts,depth+1,seen)}if("function"==typeof obj&&!isRegExp(obj)){var name=function nameOf(f){if(f.name)return f.name;var m=$match.call(functionToString.call(f),/^function\s*([\w$]+)/);if(m)return m[1];return null}(obj),keys=arrObjKeys(obj,inspect);return"[Function"+(name?": "+name:" (anonymous)")+"]"+(keys.length>0?" { "+$join.call(keys,", ")+" }":"")}if(isSymbol(obj)){var symString=hasShammedSymbols?$replace.call(String(obj),/^(Symbol\(.*\))_[^)]*$/,"$1"):symToString.call(obj);return"object"!=typeof obj||hasShammedSymbols?symString:markBoxed(symString)}if(function isElement(x){if(!x||"object"!=typeof x)return!1;if("undefined"!=typeof HTMLElement&&x instanceof HTMLElement)return!0;return"string"==typeof x.nodeName&&"function"==typeof x.getAttribute}(obj)){for(var s="<"+$toLowerCase.call(String(obj.nodeName)),attrs=obj.attributes||[],i=0;i<attrs.length;i++)s+=" "+attrs[i].name+"="+wrapQuotes(quote(attrs[i].value),"double",opts);return s+=">",obj.childNodes&&obj.childNodes.length&&(s+="..."),s+="</"+$toLowerCase.call(String(obj.nodeName))+">"}if(isArray(obj)){if(0===obj.length)return"[]";var xs=arrObjKeys(obj,inspect);return indent&&!function singleLineValues(xs){for(var i=0;i<xs.length;i++)if(indexOf(xs[i],"\n")>=0)return!1;return!0}(xs)?"["+indentedJoin(xs,indent)+"]":"[ "+$join.call(xs,", ")+" ]"}if(function isError(obj){return!("[object Error]"!==toStr(obj)||toStringTag&&"object"==typeof obj&&toStringTag in obj)}(obj)){var parts=arrObjKeys(obj,inspect);return"cause"in Error.prototype||!("cause"in obj)||isEnumerable.call(obj,"cause")?0===parts.length?"["+String(obj)+"]":"{ ["+String(obj)+"] "+$join.call(parts,", ")+" }":"{ ["+String(obj)+"] "+$join.call($concat.call("[cause]: "+inspect(obj.cause),parts),", ")+" }"}if("object"==typeof obj&&customInspect){if(inspectSymbol&&"function"==typeof obj[inspectSymbol]&&utilInspect)return utilInspect(obj,{depth:maxDepth-depth});if("symbol"!==customInspect&&"function"==typeof obj.inspect)return obj.inspect()}if(function isMap(x){if(!mapSize||!x||"object"!=typeof x)return!1;try{mapSize.call(x);try{setSize.call(x)}catch(s){return!0}return x instanceof Map}catch(e){}return!1}(obj)){var mapParts=[];return mapForEach&&mapForEach.call(obj,(function(value,key){mapParts.push(inspect(key,obj,!0)+" => "+inspect(value,obj))})),collectionOf("Map",mapSize.call(obj),mapParts,indent)}if(function isSet(x){if(!setSize||!x||"object"!=typeof x)return!1;try{setSize.call(x);try{mapSize.call(x)}catch(m){return!0}return x instanceof Set}catch(e){}return!1}(obj)){var setParts=[];return setForEach&&setForEach.call(obj,(function(value){setParts.push(inspect(value,obj))})),collectionOf("Set",setSize.call(obj),setParts,indent)}if(function isWeakMap(x){if(!weakMapHas||!x||"object"!=typeof x)return!1;try{weakMapHas.call(x,weakMapHas);try{weakSetHas.call(x,weakSetHas)}catch(s){return!0}return x instanceof WeakMap}catch(e){}return!1}(obj))return weakCollectionOf("WeakMap");if(function isWeakSet(x){if(!weakSetHas||!x||"object"!=typeof x)return!1;try{weakSetHas.call(x,weakSetHas);try{weakMapHas.call(x,weakMapHas)}catch(s){return!0}return x instanceof WeakSet}catch(e){}return!1}(obj))return weakCollectionOf("WeakSet");if(function isWeakRef(x){if(!weakRefDeref||!x||"object"!=typeof x)return!1;try{return weakRefDeref.call(x),!0}catch(e){}return!1}(obj))return weakCollectionOf("WeakRef");if(function isNumber(obj){return!("[object Number]"!==toStr(obj)||toStringTag&&"object"==typeof obj&&toStringTag in obj)}(obj))return markBoxed(inspect(Number(obj)));if(function isBigInt(obj){if(!obj||"object"!=typeof obj||!bigIntValueOf)return!1;try{return bigIntValueOf.call(obj),!0}catch(e){}return!1}(obj))return markBoxed(inspect(bigIntValueOf.call(obj)));if(function isBoolean(obj){return!("[object Boolean]"!==toStr(obj)||toStringTag&&"object"==typeof obj&&toStringTag in obj)}(obj))return markBoxed(booleanValueOf.call(obj));if(function isString(obj){return!("[object String]"!==toStr(obj)||toStringTag&&"object"==typeof obj&&toStringTag in obj)}(obj))return markBoxed(inspect(String(obj)));if(!function isDate(obj){return!("[object Date]"!==toStr(obj)||toStringTag&&"object"==typeof obj&&toStringTag in obj)}(obj)&&!isRegExp(obj)){var ys=arrObjKeys(obj,inspect),isPlainObject=gPO?gPO(obj)===Object.prototype:obj instanceof Object||obj.constructor===Object,protoTag=obj instanceof Object?"":"null prototype",stringTag=!isPlainObject&&toStringTag&&Object(obj)===obj&&toStringTag in obj?$slice.call(toStr(obj),8,-1):protoTag?"Object":"",tag=(isPlainObject||"function"!=typeof obj.constructor?"":obj.constructor.name?obj.constructor.name+" ":"")+(stringTag||protoTag?"["+$join.call($concat.call([],stringTag||[],protoTag||[]),": ")+"] ":"");return 0===ys.length?tag+"{}":indent?tag+"{"+indentedJoin(ys,indent)+"}":tag+"{ "+$join.call(ys,", ")+" }"}return String(obj)};var hasOwn=Object.prototype.hasOwnProperty||function(key){return key in this};function has(obj,key){return hasOwn.call(obj,key)}function toStr(obj){return objectToString.call(obj)}function indexOf(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0,l=xs.length;i<l;i++)if(xs[i]===x)return i;return-1}function inspectString(str,opts){if(str.length>opts.maxStringLength){var remaining=str.length-opts.maxStringLength,trailer="... "+remaining+" more character"+(remaining>1?"s":"");return inspectString($slice.call(str,0,opts.maxStringLength),opts)+trailer}return wrapQuotes($replace.call($replace.call(str,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,lowbyte),"single",opts)}function lowbyte(c){var n=c.charCodeAt(0),x={8:"b",9:"t",10:"n",12:"f",13:"r"}[n];return x?"\\"+x:"\\x"+(n<16?"0":"")+$toUpperCase.call(n.toString(16))}function markBoxed(str){return"Object("+str+")"}function weakCollectionOf(type){return type+" { ? }"}function collectionOf(type,size,entries,indent){return type+" ("+size+") {"+(indent?indentedJoin(entries,indent):$join.call(entries,", "))+"}"}function indentedJoin(xs,indent){if(0===xs.length)return"";var lineJoiner="\n"+indent.prev+indent.base;return lineJoiner+$join.call(xs,","+lineJoiner)+"\n"+indent.prev}function arrObjKeys(obj,inspect){var isArr=isArray(obj),xs=[];if(isArr){xs.length=obj.length;for(var i=0;i<obj.length;i++)xs[i]=has(obj,i)?inspect(obj[i],obj):""}var symMap,syms="function"==typeof gOPS?gOPS(obj):[];if(hasShammedSymbols){symMap={};for(var k=0;k<syms.length;k++)symMap["$"+syms[k]]=syms[k]}for(var key in obj)has(obj,key)&&(isArr&&String(Number(key))===key&&key<obj.length||hasShammedSymbols&&symMap["$"+key]instanceof Symbol||($test.call(/[^\w$]/,key)?xs.push(inspect(key,obj)+": "+inspect(obj[key],obj)):xs.push(key+": "+inspect(obj[key],obj))));if("function"==typeof gOPS)for(var j=0;j<syms.length;j++)isEnumerable.call(obj,syms[j])&&xs.push("["+inspect(syms[j])+"]: "+inspect(obj[syms[j]],obj));return xs}},"./node_modules/qs/lib/formats.js":module=>{"use strict";var replace=String.prototype.replace,percentTwenties=/%20/g,Format_RFC1738="RFC1738",Format_RFC3986="RFC3986";module.exports={default:Format_RFC3986,formatters:{RFC1738:function(value){return replace.call(value,percentTwenties,"+")},RFC3986:function(value){return String(value)}},RFC1738:Format_RFC1738,RFC3986:Format_RFC3986}},"./node_modules/qs/lib/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var stringify=__webpack_require__("./node_modules/qs/lib/stringify.js"),parse=__webpack_require__("./node_modules/qs/lib/parse.js"),formats=__webpack_require__("./node_modules/qs/lib/formats.js");module.exports={formats,parse,stringify}},"./node_modules/qs/lib/parse.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var utils=__webpack_require__("./node_modules/qs/lib/utils.js"),has=Object.prototype.hasOwnProperty,isArray=Array.isArray,defaults={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:utils.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},interpretNumericEntities=function(str){return str.replace(/&#(\d+);/g,(function($0,numberStr){return String.fromCharCode(parseInt(numberStr,10))}))},parseArrayValue=function(val,options){return val&&"string"==typeof val&&options.comma&&val.indexOf(",")>-1?val.split(","):val},parseKeys=function parseQueryStringKeys(givenKey,val,options,valuesParsed){if(givenKey){var key=options.allowDots?givenKey.replace(/\.([^.[]+)/g,"[$1]"):givenKey,child=/(\[[^[\]]*])/g,segment=options.depth>0&&/(\[[^[\]]*])/.exec(key),parent=segment?key.slice(0,segment.index):key,keys=[];if(parent){if(!options.plainObjects&&has.call(Object.prototype,parent)&&!options.allowPrototypes)return;keys.push(parent)}for(var i=0;options.depth>0&&null!==(segment=child.exec(key))&&i<options.depth;){if(i+=1,!options.plainObjects&&has.call(Object.prototype,segment[1].slice(1,-1))&&!options.allowPrototypes)return;keys.push(segment[1])}return segment&&keys.push("["+key.slice(segment.index)+"]"),function(chain,val,options,valuesParsed){for(var leaf=valuesParsed?val:parseArrayValue(val,options),i=chain.length-1;i>=0;--i){var obj,root=chain[i];if("[]"===root&&options.parseArrays)obj=[].concat(leaf);else{obj=options.plainObjects?Object.create(null):{};var cleanRoot="["===root.charAt(0)&&"]"===root.charAt(root.length-1)?root.slice(1,-1):root,index=parseInt(cleanRoot,10);options.parseArrays||""!==cleanRoot?!isNaN(index)&&root!==cleanRoot&&String(index)===cleanRoot&&index>=0&&options.parseArrays&&index<=options.arrayLimit?(obj=[])[index]=leaf:"__proto__"!==cleanRoot&&(obj[cleanRoot]=leaf):obj={0:leaf}}leaf=obj}return leaf}(keys,val,options,valuesParsed)}};module.exports=function(str,opts){var options=function normalizeParseOptions(opts){if(!opts)return defaults;if(null!==opts.decoder&&void 0!==opts.decoder&&"function"!=typeof opts.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==opts.charset&&"utf-8"!==opts.charset&&"iso-8859-1"!==opts.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var charset=void 0===opts.charset?defaults.charset:opts.charset;return{allowDots:void 0===opts.allowDots?defaults.allowDots:!!opts.allowDots,allowPrototypes:"boolean"==typeof opts.allowPrototypes?opts.allowPrototypes:defaults.allowPrototypes,allowSparse:"boolean"==typeof opts.allowSparse?opts.allowSparse:defaults.allowSparse,arrayLimit:"number"==typeof opts.arrayLimit?opts.arrayLimit:defaults.arrayLimit,charset,charsetSentinel:"boolean"==typeof opts.charsetSentinel?opts.charsetSentinel:defaults.charsetSentinel,comma:"boolean"==typeof opts.comma?opts.comma:defaults.comma,decoder:"function"==typeof opts.decoder?opts.decoder:defaults.decoder,delimiter:"string"==typeof opts.delimiter||utils.isRegExp(opts.delimiter)?opts.delimiter:defaults.delimiter,depth:"number"==typeof opts.depth||!1===opts.depth?+opts.depth:defaults.depth,ignoreQueryPrefix:!0===opts.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof opts.interpretNumericEntities?opts.interpretNumericEntities:defaults.interpretNumericEntities,parameterLimit:"number"==typeof opts.parameterLimit?opts.parameterLimit:defaults.parameterLimit,parseArrays:!1!==opts.parseArrays,plainObjects:"boolean"==typeof opts.plainObjects?opts.plainObjects:defaults.plainObjects,strictNullHandling:"boolean"==typeof opts.strictNullHandling?opts.strictNullHandling:defaults.strictNullHandling}}(opts);if(""===str||null==str)return options.plainObjects?Object.create(null):{};for(var tempObj="string"==typeof str?function parseQueryStringValues(str,options){var i,obj={__proto__:null},cleanStr=options.ignoreQueryPrefix?str.replace(/^\?/,""):str,limit=options.parameterLimit===1/0?void 0:options.parameterLimit,parts=cleanStr.split(options.delimiter,limit),skipIndex=-1,charset=options.charset;if(options.charsetSentinel)for(i=0;i<parts.length;++i)0===parts[i].indexOf("utf8=")&&("utf8=%E2%9C%93"===parts[i]?charset="utf-8":"utf8=%26%2310003%3B"===parts[i]&&(charset="iso-8859-1"),skipIndex=i,i=parts.length);for(i=0;i<parts.length;++i)if(i!==skipIndex){var key,val,part=parts[i],bracketEqualsPos=part.indexOf("]="),pos=-1===bracketEqualsPos?part.indexOf("="):bracketEqualsPos+1;-1===pos?(key=options.decoder(part,defaults.decoder,charset,"key"),val=options.strictNullHandling?null:""):(key=options.decoder(part.slice(0,pos),defaults.decoder,charset,"key"),val=utils.maybeMap(parseArrayValue(part.slice(pos+1),options),(function(encodedVal){return options.decoder(encodedVal,defaults.decoder,charset,"value")}))),val&&options.interpretNumericEntities&&"iso-8859-1"===charset&&(val=interpretNumericEntities(val)),part.indexOf("[]=")>-1&&(val=isArray(val)?[val]:val),has.call(obj,key)?obj[key]=utils.combine(obj[key],val):obj[key]=val}return obj}(str,options):str,obj=options.plainObjects?Object.create(null):{},keys=Object.keys(tempObj),i=0;i<keys.length;++i){var key=keys[i],newObj=parseKeys(key,tempObj[key],options,"string"==typeof str);obj=utils.merge(obj,newObj,options)}return!0===options.allowSparse?obj:utils.compact(obj)}},"./node_modules/qs/lib/stringify.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var getSideChannel=__webpack_require__("./node_modules/side-channel/index.js"),utils=__webpack_require__("./node_modules/qs/lib/utils.js"),formats=__webpack_require__("./node_modules/qs/lib/formats.js"),has=Object.prototype.hasOwnProperty,arrayPrefixGenerators={brackets:function brackets(prefix){return prefix+"[]"},comma:"comma",indices:function indices(prefix,key){return prefix+"["+key+"]"},repeat:function repeat(prefix){return prefix}},isArray=Array.isArray,push=Array.prototype.push,pushToArray=function(arr,valueOrArray){push.apply(arr,isArray(valueOrArray)?valueOrArray:[valueOrArray])},toISO=Date.prototype.toISOString,defaultFormat=formats.default,defaults={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:utils.encode,encodeValuesOnly:!1,format:defaultFormat,formatter:formats.formatters[defaultFormat],indices:!1,serializeDate:function serializeDate(date){return toISO.call(date)},skipNulls:!1,strictNullHandling:!1},sentinel={},stringify=function stringify(object,prefix,generateArrayPrefix,commaRoundTrip,strictNullHandling,skipNulls,encoder,filter,sort,allowDots,serializeDate,format,formatter,encodeValuesOnly,charset,sideChannel){for(var obj=object,tmpSc=sideChannel,step=0,findFlag=!1;void 0!==(tmpSc=tmpSc.get(sentinel))&&!findFlag;){var pos=tmpSc.get(object);if(step+=1,void 0!==pos){if(pos===step)throw new RangeError("Cyclic object value");findFlag=!0}void 0===tmpSc.get(sentinel)&&(step=0)}if("function"==typeof filter?obj=filter(prefix,obj):obj instanceof Date?obj=serializeDate(obj):"comma"===generateArrayPrefix&&isArray(obj)&&(obj=utils.maybeMap(obj,(function(value){return value instanceof Date?serializeDate(value):value}))),null===obj){if(strictNullHandling)return encoder&&!encodeValuesOnly?encoder(prefix,defaults.encoder,charset,"key",format):prefix;obj=""}if(function isNonNullishPrimitive(v){return"string"==typeof v||"number"==typeof v||"boolean"==typeof v||"symbol"==typeof v||"bigint"==typeof v}(obj)||utils.isBuffer(obj))return encoder?[formatter(encodeValuesOnly?prefix:encoder(prefix,defaults.encoder,charset,"key",format))+"="+formatter(encoder(obj,defaults.encoder,charset,"value",format))]:[formatter(prefix)+"="+formatter(String(obj))];var objKeys,values=[];if(void 0===obj)return values;if("comma"===generateArrayPrefix&&isArray(obj))encodeValuesOnly&&encoder&&(obj=utils.maybeMap(obj,encoder)),objKeys=[{value:obj.length>0?obj.join(",")||null:void 0}];else if(isArray(filter))objKeys=filter;else{var keys=Object.keys(obj);objKeys=sort?keys.sort(sort):keys}for(var adjustedPrefix=commaRoundTrip&&isArray(obj)&&1===obj.length?prefix+"[]":prefix,j=0;j<objKeys.length;++j){var key=objKeys[j],value="object"==typeof key&&void 0!==key.value?key.value:obj[key];if(!skipNulls||null!==value){var keyPrefix=isArray(obj)?"function"==typeof generateArrayPrefix?generateArrayPrefix(adjustedPrefix,key):adjustedPrefix:adjustedPrefix+(allowDots?"."+key:"["+key+"]");sideChannel.set(object,step);var valueSideChannel=getSideChannel();valueSideChannel.set(sentinel,sideChannel),pushToArray(values,stringify(value,keyPrefix,generateArrayPrefix,commaRoundTrip,strictNullHandling,skipNulls,"comma"===generateArrayPrefix&&encodeValuesOnly&&isArray(obj)?null:encoder,filter,sort,allowDots,serializeDate,format,formatter,encodeValuesOnly,charset,valueSideChannel))}}return values};module.exports=function(object,opts){var objKeys,obj=object,options=function normalizeStringifyOptions(opts){if(!opts)return defaults;if(null!==opts.encoder&&void 0!==opts.encoder&&"function"!=typeof opts.encoder)throw new TypeError("Encoder has to be a function.");var charset=opts.charset||defaults.charset;if(void 0!==opts.charset&&"utf-8"!==opts.charset&&"iso-8859-1"!==opts.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var format=formats.default;if(void 0!==opts.format){if(!has.call(formats.formatters,opts.format))throw new TypeError("Unknown format option provided.");format=opts.format}var formatter=formats.formatters[format],filter=defaults.filter;return("function"==typeof opts.filter||isArray(opts.filter))&&(filter=opts.filter),{addQueryPrefix:"boolean"==typeof opts.addQueryPrefix?opts.addQueryPrefix:defaults.addQueryPrefix,allowDots:void 0===opts.allowDots?defaults.allowDots:!!opts.allowDots,charset,charsetSentinel:"boolean"==typeof opts.charsetSentinel?opts.charsetSentinel:defaults.charsetSentinel,delimiter:void 0===opts.delimiter?defaults.delimiter:opts.delimiter,encode:"boolean"==typeof opts.encode?opts.encode:defaults.encode,encoder:"function"==typeof opts.encoder?opts.encoder:defaults.encoder,encodeValuesOnly:"boolean"==typeof opts.encodeValuesOnly?opts.encodeValuesOnly:defaults.encodeValuesOnly,filter,format,formatter,serializeDate:"function"==typeof opts.serializeDate?opts.serializeDate:defaults.serializeDate,skipNulls:"boolean"==typeof opts.skipNulls?opts.skipNulls:defaults.skipNulls,sort:"function"==typeof opts.sort?opts.sort:null,strictNullHandling:"boolean"==typeof opts.strictNullHandling?opts.strictNullHandling:defaults.strictNullHandling}}(opts);"function"==typeof options.filter?obj=(0,options.filter)("",obj):isArray(options.filter)&&(objKeys=options.filter);var arrayFormat,keys=[];if("object"!=typeof obj||null===obj)return"";arrayFormat=opts&&opts.arrayFormat in arrayPrefixGenerators?opts.arrayFormat:opts&&"indices"in opts?opts.indices?"indices":"repeat":"indices";var generateArrayPrefix=arrayPrefixGenerators[arrayFormat];if(opts&&"commaRoundTrip"in opts&&"boolean"!=typeof opts.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var commaRoundTrip="comma"===generateArrayPrefix&&opts&&opts.commaRoundTrip;objKeys||(objKeys=Object.keys(obj)),options.sort&&objKeys.sort(options.sort);for(var sideChannel=getSideChannel(),i=0;i<objKeys.length;++i){var key=objKeys[i];options.skipNulls&&null===obj[key]||pushToArray(keys,stringify(obj[key],key,generateArrayPrefix,commaRoundTrip,options.strictNullHandling,options.skipNulls,options.encode?options.encoder:null,options.filter,options.sort,options.allowDots,options.serializeDate,options.format,options.formatter,options.encodeValuesOnly,options.charset,sideChannel))}var joined=keys.join(options.delimiter),prefix=!0===options.addQueryPrefix?"?":"";return options.charsetSentinel&&("iso-8859-1"===options.charset?prefix+="utf8=%26%2310003%3B&":prefix+="utf8=%E2%9C%93&"),joined.length>0?prefix+joined:""}},"./node_modules/qs/lib/utils.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var formats=__webpack_require__("./node_modules/qs/lib/formats.js"),has=Object.prototype.hasOwnProperty,isArray=Array.isArray,hexTable=function(){for(var array=[],i=0;i<256;++i)array.push("%"+((i<16?"0":"")+i.toString(16)).toUpperCase());return array}(),arrayToObject=function arrayToObject(source,options){for(var obj=options&&options.plainObjects?Object.create(null):{},i=0;i<source.length;++i)void 0!==source[i]&&(obj[i]=source[i]);return obj};module.exports={arrayToObject,assign:function assignSingleSource(target,source){return Object.keys(source).reduce((function(acc,key){return acc[key]=source[key],acc}),target)},combine:function combine(a,b){return[].concat(a,b)},compact:function compact(value){for(var queue=[{obj:{o:value},prop:"o"}],refs=[],i=0;i<queue.length;++i)for(var item=queue[i],obj=item.obj[item.prop],keys=Object.keys(obj),j=0;j<keys.length;++j){var key=keys[j],val=obj[key];"object"==typeof val&&null!==val&&-1===refs.indexOf(val)&&(queue.push({obj,prop:key}),refs.push(val))}return function compactQueue(queue){for(;queue.length>1;){var item=queue.pop(),obj=item.obj[item.prop];if(isArray(obj)){for(var compacted=[],j=0;j<obj.length;++j)void 0!==obj[j]&&compacted.push(obj[j]);item.obj[item.prop]=compacted}}}(queue),value},decode:function(str,decoder,charset){var strWithoutPlus=str.replace(/\+/g," ");if("iso-8859-1"===charset)return strWithoutPlus.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(strWithoutPlus)}catch(e){return strWithoutPlus}},encode:function encode(str,defaultEncoder,charset,kind,format){if(0===str.length)return str;var string=str;if("symbol"==typeof str?string=Symbol.prototype.toString.call(str):"string"!=typeof str&&(string=String(str)),"iso-8859-1"===charset)return escape(string).replace(/%u[0-9a-f]{4}/gi,(function($0){return"%26%23"+parseInt($0.slice(2),16)+"%3B"}));for(var out="",i=0;i<string.length;++i){var c=string.charCodeAt(i);45===c||46===c||95===c||126===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||format===formats.RFC1738&&(40===c||41===c)?out+=string.charAt(i):c<128?out+=hexTable[c]:c<2048?out+=hexTable[192|c>>6]+hexTable[128|63&c]:c<55296||c>=57344?out+=hexTable[224|c>>12]+hexTable[128|c>>6&63]+hexTable[128|63&c]:(i+=1,c=65536+((1023&c)<<10|1023&string.charCodeAt(i)),out+=hexTable[240|c>>18]+hexTable[128|c>>12&63]+hexTable[128|c>>6&63]+hexTable[128|63&c])}return out},isBuffer:function isBuffer(obj){return!(!obj||"object"!=typeof obj)&&!!(obj.constructor&&obj.constructor.isBuffer&&obj.constructor.isBuffer(obj))},isRegExp:function isRegExp(obj){return"[object RegExp]"===Object.prototype.toString.call(obj)},maybeMap:function maybeMap(val,fn){if(isArray(val)){for(var mapped=[],i=0;i<val.length;i+=1)mapped.push(fn(val[i]));return mapped}return fn(val)},merge:function merge(target,source,options){if(!source)return target;if("object"!=typeof source){if(isArray(target))target.push(source);else{if(!target||"object"!=typeof target)return[target,source];(options&&(options.plainObjects||options.allowPrototypes)||!has.call(Object.prototype,source))&&(target[source]=!0)}return target}if(!target||"object"!=typeof target)return[target].concat(source);var mergeTarget=target;return isArray(target)&&!isArray(source)&&(mergeTarget=arrayToObject(target,options)),isArray(target)&&isArray(source)?(source.forEach((function(item,i){if(has.call(target,i)){var targetItem=target[i];targetItem&&"object"==typeof targetItem&&item&&"object"==typeof item?target[i]=merge(targetItem,item,options):target.push(item)}else target[i]=item})),target):Object.keys(source).reduce((function(acc,key){var value=source[key];return has.call(acc,key)?acc[key]=merge(acc[key],value,options):acc[key]=value,acc}),mergeTarget)}}},"./node_modules/react-country-flag/dist/react-country-flag.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{P:()=>ReactCountryFlag});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}var _excluded=["cdnSuffix","cdnUrl","countryCode","style","svg"],ReactCountryFlag=function ReactCountryFlag(_ref){var _ref$cdnSuffix=_ref.cdnSuffix,cdnSuffix=void 0===_ref$cdnSuffix?"svg":_ref$cdnSuffix,_ref$cdnUrl=_ref.cdnUrl,cdnUrl=void 0===_ref$cdnUrl?"https://cdn.jsdelivr.net/gh/lipis/flag-icons/flags/4x3/":_ref$cdnUrl,countryCode=_ref.countryCode,style=_ref.style,_ref$svg=_ref.svg,svg=void 0!==_ref$svg&&_ref$svg,props=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(_ref,_excluded);if("string"!=typeof countryCode)return null;if(svg){var flagUrl=""+cdnUrl+countryCode.toLowerCase()+"."+cdnSuffix;return(0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)("img",Object.assign({},props,{src:flagUrl,style:_extends({display:"inline-block",width:"1em",height:"1em",verticalAlign:"middle"},style)}))}var emoji=countryCode.toUpperCase().replace(/./g,(function(_char){return String.fromCodePoint(_char.charCodeAt(0)+127397)}));return(0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)("span",Object.assign({role:"img"},props,{style:_extends({display:"inline-block",fontSize:"1em",lineHeight:"1em",verticalAlign:"middle"},style)}),emoji)}},"./node_modules/react/cjs/react-jsx-runtime.production.min.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";__webpack_require__("./node_modules/object-assign/index.js");var f=__webpack_require__("./node_modules/react/index.js"),g=60103;if(60107,"function"==typeof Symbol&&Symbol.for){var h=Symbol.for;g=h("react.element"),h("react.fragment")}var m=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n=Object.prototype.hasOwnProperty,p={key:!0,ref:!0,__self:!0,__source:!0};function q(c,a,k){var b,d={},e=null,l=null;for(b in void 0!==k&&(e=""+k),void 0!==a.key&&(e=""+a.key),void 0!==a.ref&&(l=a.ref),a)n.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:g,type:c,key:e,ref:l,props:d,_owner:m.current}}exports.jsx=q,exports.jsxs=q},"./node_modules/react/jsx-runtime.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module.exports=__webpack_require__("./node_modules/react/cjs/react-jsx-runtime.production.min.js")},"./node_modules/semver/classes/comparator.js":(module,__unused_webpack_exports,__webpack_require__)=>{const ANY=Symbol("SemVer ANY");class Comparator{static get ANY(){return ANY}constructor(comp,options){if(options=parseOptions(options),comp instanceof Comparator){if(comp.loose===!!options.loose)return comp;comp=comp.value}comp=comp.trim().split(/\s+/).join(" "),debug("comparator",comp,options),this.options=options,this.loose=!!options.loose,this.parse(comp),this.semver===ANY?this.value="":this.value=this.operator+this.semver.version,debug("comp",this)}parse(comp){const r=this.options.loose?re[t.COMPARATORLOOSE]:re[t.COMPARATOR],m=comp.match(r);if(!m)throw new TypeError(`Invalid comparator: ${comp}`);this.operator=void 0!==m[1]?m[1]:"","="===this.operator&&(this.operator=""),m[2]?this.semver=new SemVer(m[2],this.options.loose):this.semver=ANY}toString(){return this.value}test(version){if(debug("Comparator.test",version,this.options.loose),this.semver===ANY||version===ANY)return!0;if("string"==typeof version)try{version=new SemVer(version,this.options)}catch(er){return!1}return cmp(version,this.operator,this.semver,this.options)}intersects(comp,options){if(!(comp instanceof Comparator))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new Range(comp.value,options).test(this.value):""===comp.operator?""===comp.value||new Range(this.value,options).test(comp.semver):(!(options=parseOptions(options)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==comp.value)&&(!(!options.includePrerelease&&(this.value.startsWith("<0.0.0")||comp.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!comp.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!comp.operator.startsWith("<"))||(!(this.semver.version!==comp.semver.version||!this.operator.includes("=")||!comp.operator.includes("="))||(!!(cmp(this.semver,"<",comp.semver,options)&&this.operator.startsWith(">")&&comp.operator.startsWith("<"))||!!(cmp(this.semver,">",comp.semver,options)&&this.operator.startsWith("<")&&comp.operator.startsWith(">")))))))}}module.exports=Comparator;const parseOptions=__webpack_require__("./node_modules/semver/internal/parse-options.js"),{safeRe:re,t}=__webpack_require__("./node_modules/semver/internal/re.js"),cmp=__webpack_require__("./node_modules/semver/functions/cmp.js"),debug=__webpack_require__("./node_modules/semver/internal/debug.js"),SemVer=__webpack_require__("./node_modules/semver/classes/semver.js"),Range=__webpack_require__("./node_modules/semver/classes/range.js")},"./node_modules/semver/classes/range.js":(module,__unused_webpack_exports,__webpack_require__)=>{class Range{constructor(range,options){if(options=parseOptions(options),range instanceof Range)return range.loose===!!options.loose&&range.includePrerelease===!!options.includePrerelease?range:new Range(range.raw,options);if(range instanceof Comparator)return this.raw=range.value,this.set=[[range]],this.format(),this;if(this.options=options,this.loose=!!options.loose,this.includePrerelease=!!options.includePrerelease,this.raw=range.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map((r=>this.parseRange(r))).filter((c=>c.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const first=this.set[0];if(this.set=this.set.filter((c=>!isNullSet(c[0]))),0===this.set.length)this.set=[first];else if(this.set.length>1)for(const c of this.set)if(1===c.length&&isAny(c[0])){this.set=[c];break}}this.format()}format(){return this.range=this.set.map((comps=>comps.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(range){const memoKey=((this.options.includePrerelease&&FLAG_INCLUDE_PRERELEASE)|(this.options.loose&&FLAG_LOOSE))+":"+range,cached=cache.get(memoKey);if(cached)return cached;const loose=this.options.loose,hr=loose?re[t.HYPHENRANGELOOSE]:re[t.HYPHENRANGE];range=range.replace(hr,hyphenReplace(this.options.includePrerelease)),debug("hyphen replace",range),range=range.replace(re[t.COMPARATORTRIM],comparatorTrimReplace),debug("comparator trim",range);let rangeList=(range=(range=range.replace(re[t.TILDETRIM],tildeTrimReplace)).replace(re[t.CARETTRIM],caretTrimReplace)).split(" ").map((comp=>parseComparator(comp,this.options))).join(" ").split(/\s+/).map((comp=>replaceGTE0(comp,this.options)));loose&&(rangeList=rangeList.filter((comp=>(debug("loose invalid filter",comp,this.options),!!comp.match(re[t.COMPARATORLOOSE]))))),debug("range list",rangeList);const rangeMap=new Map,comparators=rangeList.map((comp=>new Comparator(comp,this.options)));for(const comp of comparators){if(isNullSet(comp))return[comp];rangeMap.set(comp.value,comp)}rangeMap.size>1&&rangeMap.has("")&&rangeMap.delete("");const result=[...rangeMap.values()];return cache.set(memoKey,result),result}intersects(range,options){if(!(range instanceof Range))throw new TypeError("a Range is required");return this.set.some((thisComparators=>isSatisfiable(thisComparators,options)&&range.set.some((rangeComparators=>isSatisfiable(rangeComparators,options)&&thisComparators.every((thisComparator=>rangeComparators.every((rangeComparator=>thisComparator.intersects(rangeComparator,options)))))))))}test(version){if(!version)return!1;if("string"==typeof version)try{version=new SemVer(version,this.options)}catch(er){return!1}for(let i=0;i<this.set.length;i++)if(testSet(this.set[i],version,this.options))return!0;return!1}}module.exports=Range;const cache=new(__webpack_require__("./node_modules/semver/node_modules/lru-cache/index.js"))({max:1e3}),parseOptions=__webpack_require__("./node_modules/semver/internal/parse-options.js"),Comparator=__webpack_require__("./node_modules/semver/classes/comparator.js"),debug=__webpack_require__("./node_modules/semver/internal/debug.js"),SemVer=__webpack_require__("./node_modules/semver/classes/semver.js"),{safeRe:re,t,comparatorTrimReplace,tildeTrimReplace,caretTrimReplace}=__webpack_require__("./node_modules/semver/internal/re.js"),{FLAG_INCLUDE_PRERELEASE,FLAG_LOOSE}=__webpack_require__("./node_modules/semver/internal/constants.js"),isNullSet=c=>"<0.0.0-0"===c.value,isAny=c=>""===c.value,isSatisfiable=(comparators,options)=>{let result=!0;const remainingComparators=comparators.slice();let testComparator=remainingComparators.pop();for(;result&&remainingComparators.length;)result=remainingComparators.every((otherComparator=>testComparator.intersects(otherComparator,options))),testComparator=remainingComparators.pop();return result},parseComparator=(comp,options)=>(debug("comp",comp,options),comp=replaceCarets(comp,options),debug("caret",comp),comp=replaceTildes(comp,options),debug("tildes",comp),comp=replaceXRanges(comp,options),debug("xrange",comp),comp=replaceStars(comp,options),debug("stars",comp),comp),isX=id=>!id||"x"===id.toLowerCase()||"*"===id,replaceTildes=(comp,options)=>comp.trim().split(/\s+/).map((c=>replaceTilde(c,options))).join(" "),replaceTilde=(comp,options)=>{const r=options.loose?re[t.TILDELOOSE]:re[t.TILDE];return comp.replace(r,((_,M,m,p,pr)=>{let ret;return debug("tilde",comp,_,M,m,p,pr),isX(M)?ret="":isX(m)?ret=`>=${M}.0.0 <${+M+1}.0.0-0`:isX(p)?ret=`>=${M}.${m}.0 <${M}.${+m+1}.0-0`:pr?(debug("replaceTilde pr",pr),ret=`>=${M}.${m}.${p}-${pr} <${M}.${+m+1}.0-0`):ret=`>=${M}.${m}.${p} <${M}.${+m+1}.0-0`,debug("tilde return",ret),ret}))},replaceCarets=(comp,options)=>comp.trim().split(/\s+/).map((c=>replaceCaret(c,options))).join(" "),replaceCaret=(comp,options)=>{debug("caret",comp,options);const r=options.loose?re[t.CARETLOOSE]:re[t.CARET],z=options.includePrerelease?"-0":"";return comp.replace(r,((_,M,m,p,pr)=>{let ret;return debug("caret",comp,_,M,m,p,pr),isX(M)?ret="":isX(m)?ret=`>=${M}.0.0${z} <${+M+1}.0.0-0`:isX(p)?ret="0"===M?`>=${M}.${m}.0${z} <${M}.${+m+1}.0-0`:`>=${M}.${m}.0${z} <${+M+1}.0.0-0`:pr?(debug("replaceCaret pr",pr),ret="0"===M?"0"===m?`>=${M}.${m}.${p}-${pr} <${M}.${m}.${+p+1}-0`:`>=${M}.${m}.${p}-${pr} <${M}.${+m+1}.0-0`:`>=${M}.${m}.${p}-${pr} <${+M+1}.0.0-0`):(debug("no pr"),ret="0"===M?"0"===m?`>=${M}.${m}.${p}${z} <${M}.${m}.${+p+1}-0`:`>=${M}.${m}.${p}${z} <${M}.${+m+1}.0-0`:`>=${M}.${m}.${p} <${+M+1}.0.0-0`),debug("caret return",ret),ret}))},replaceXRanges=(comp,options)=>(debug("replaceXRanges",comp,options),comp.split(/\s+/).map((c=>replaceXRange(c,options))).join(" ")),replaceXRange=(comp,options)=>{comp=comp.trim();const r=options.loose?re[t.XRANGELOOSE]:re[t.XRANGE];return comp.replace(r,((ret,gtlt,M,m,p,pr)=>{debug("xRange",comp,ret,gtlt,M,m,p,pr);const xM=isX(M),xm=xM||isX(m),xp=xm||isX(p),anyX=xp;return"="===gtlt&&anyX&&(gtlt=""),pr=options.includePrerelease?"-0":"",xM?ret=">"===gtlt||"<"===gtlt?"<0.0.0-0":"*":gtlt&&anyX?(xm&&(m=0),p=0,">"===gtlt?(gtlt=">=",xm?(M=+M+1,m=0,p=0):(m=+m+1,p=0)):"<="===gtlt&&(gtlt="<",xm?M=+M+1:m=+m+1),"<"===gtlt&&(pr="-0"),ret=`${gtlt+M}.${m}.${p}${pr}`):xm?ret=`>=${M}.0.0${pr} <${+M+1}.0.0-0`:xp&&(ret=`>=${M}.${m}.0${pr} <${M}.${+m+1}.0-0`),debug("xRange return",ret),ret}))},replaceStars=(comp,options)=>(debug("replaceStars",comp,options),comp.trim().replace(re[t.STAR],"")),replaceGTE0=(comp,options)=>(debug("replaceGTE0",comp,options),comp.trim().replace(re[options.includePrerelease?t.GTE0PRE:t.GTE0],"")),hyphenReplace=incPr=>($0,from,fM,fm,fp,fpr,fb,to,tM,tm,tp,tpr,tb)=>`${from=isX(fM)?"":isX(fm)?`>=${fM}.0.0${incPr?"-0":""}`:isX(fp)?`>=${fM}.${fm}.0${incPr?"-0":""}`:fpr?`>=${from}`:`>=${from}${incPr?"-0":""}`} ${to=isX(tM)?"":isX(tm)?`<${+tM+1}.0.0-0`:isX(tp)?`<${tM}.${+tm+1}.0-0`:tpr?`<=${tM}.${tm}.${tp}-${tpr}`:incPr?`<${tM}.${tm}.${+tp+1}-0`:`<=${to}`}`.trim(),testSet=(set,version,options)=>{for(let i=0;i<set.length;i++)if(!set[i].test(version))return!1;if(version.prerelease.length&&!options.includePrerelease){for(let i=0;i<set.length;i++)if(debug(set[i].semver),set[i].semver!==Comparator.ANY&&set[i].semver.prerelease.length>0){const allowed=set[i].semver;if(allowed.major===version.major&&allowed.minor===version.minor&&allowed.patch===version.patch)return!0}return!1}return!0}},"./node_modules/semver/classes/semver.js":(module,__unused_webpack_exports,__webpack_require__)=>{const debug=__webpack_require__("./node_modules/semver/internal/debug.js"),{MAX_LENGTH,MAX_SAFE_INTEGER}=__webpack_require__("./node_modules/semver/internal/constants.js"),{safeRe:re,t}=__webpack_require__("./node_modules/semver/internal/re.js"),parseOptions=__webpack_require__("./node_modules/semver/internal/parse-options.js"),{compareIdentifiers}=__webpack_require__("./node_modules/semver/internal/identifiers.js");class SemVer{constructor(version,options){if(options=parseOptions(options),version instanceof SemVer){if(version.loose===!!options.loose&&version.includePrerelease===!!options.includePrerelease)return version;version=version.version}else if("string"!=typeof version)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof version}".`);if(version.length>MAX_LENGTH)throw new TypeError(`version is longer than ${MAX_LENGTH} characters`);debug("SemVer",version,options),this.options=options,this.loose=!!options.loose,this.includePrerelease=!!options.includePrerelease;const m=version.trim().match(options.loose?re[t.LOOSE]:re[t.FULL]);if(!m)throw new TypeError(`Invalid Version: ${version}`);if(this.raw=version,this.major=+m[1],this.minor=+m[2],this.patch=+m[3],this.major>MAX_SAFE_INTEGER||this.major<0)throw new TypeError("Invalid major version");if(this.minor>MAX_SAFE_INTEGER||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>MAX_SAFE_INTEGER||this.patch<0)throw new TypeError("Invalid patch version");m[4]?this.prerelease=m[4].split(".").map((id=>{if(/^[0-9]+$/.test(id)){const num=+id;if(num>=0&&num<MAX_SAFE_INTEGER)return num}return id})):this.prerelease=[],this.build=m[5]?m[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(other){if(debug("SemVer.compare",this.version,this.options,other),!(other instanceof SemVer)){if("string"==typeof other&&other===this.version)return 0;other=new SemVer(other,this.options)}return other.version===this.version?0:this.compareMain(other)||this.comparePre(other)}compareMain(other){return other instanceof SemVer||(other=new SemVer(other,this.options)),compareIdentifiers(this.major,other.major)||compareIdentifiers(this.minor,other.minor)||compareIdentifiers(this.patch,other.patch)}comparePre(other){if(other instanceof SemVer||(other=new SemVer(other,this.options)),this.prerelease.length&&!other.prerelease.length)return-1;if(!this.prerelease.length&&other.prerelease.length)return 1;if(!this.prerelease.length&&!other.prerelease.length)return 0;let i=0;do{const a=this.prerelease[i],b=other.prerelease[i];if(debug("prerelease compare",i,a,b),void 0===a&&void 0===b)return 0;if(void 0===b)return 1;if(void 0===a)return-1;if(a!==b)return compareIdentifiers(a,b)}while(++i)}compareBuild(other){other instanceof SemVer||(other=new SemVer(other,this.options));let i=0;do{const a=this.build[i],b=other.build[i];if(debug("prerelease compare",i,a,b),void 0===a&&void 0===b)return 0;if(void 0===b)return 1;if(void 0===a)return-1;if(a!==b)return compareIdentifiers(a,b)}while(++i)}inc(release,identifier,identifierBase){switch(release){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",identifier,identifierBase);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",identifier,identifierBase);break;case"prepatch":this.prerelease.length=0,this.inc("patch",identifier,identifierBase),this.inc("pre",identifier,identifierBase);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",identifier,identifierBase),this.inc("pre",identifier,identifierBase);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const base=Number(identifierBase)?1:0;if(!identifier&&!1===identifierBase)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[base];else{let i=this.prerelease.length;for(;--i>=0;)"number"==typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);if(-1===i){if(identifier===this.prerelease.join(".")&&!1===identifierBase)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(base)}}if(identifier){let prerelease=[identifier,base];!1===identifierBase&&(prerelease=[identifier]),0===compareIdentifiers(this.prerelease[0],identifier)?isNaN(this.prerelease[1])&&(this.prerelease=prerelease):this.prerelease=prerelease}break}default:throw new Error(`invalid increment argument: ${release}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}module.exports=SemVer},"./node_modules/semver/functions/clean.js":(module,__unused_webpack_exports,__webpack_require__)=>{const parse=__webpack_require__("./node_modules/semver/functions/parse.js");module.exports=(version,options)=>{const s=parse(version.trim().replace(/^[=v]+/,""),options);return s?s.version:null}},"./node_modules/semver/functions/cmp.js":(module,__unused_webpack_exports,__webpack_require__)=>{const eq=__webpack_require__("./node_modules/semver/functions/eq.js"),neq=__webpack_require__("./node_modules/semver/functions/neq.js"),gt=__webpack_require__("./node_modules/semver/functions/gt.js"),gte=__webpack_require__("./node_modules/semver/functions/gte.js"),lt=__webpack_require__("./node_modules/semver/functions/lt.js"),lte=__webpack_require__("./node_modules/semver/functions/lte.js");module.exports=(a,op,b,loose)=>{switch(op){case"===":return"object"==typeof a&&(a=a.version),"object"==typeof b&&(b=b.version),a===b;case"!==":return"object"==typeof a&&(a=a.version),"object"==typeof b&&(b=b.version),a!==b;case"":case"=":case"==":return eq(a,b,loose);case"!=":return neq(a,b,loose);case">":return gt(a,b,loose);case">=":return gte(a,b,loose);case"<":return lt(a,b,loose);case"<=":return lte(a,b,loose);default:throw new TypeError(`Invalid operator: ${op}`)}}},"./node_modules/semver/functions/coerce.js":(module,__unused_webpack_exports,__webpack_require__)=>{const SemVer=__webpack_require__("./node_modules/semver/classes/semver.js"),parse=__webpack_require__("./node_modules/semver/functions/parse.js"),{safeRe:re,t}=__webpack_require__("./node_modules/semver/internal/re.js");module.exports=(version,options)=>{if(version instanceof SemVer)return version;if("number"==typeof version&&(version=String(version)),"string"!=typeof version)return null;let match=null;if((options=options||{}).rtl){let next;for(;(next=re[t.COERCERTL].exec(version))&&(!match||match.index+match[0].length!==version.length);)match&&next.index+next[0].length===match.index+match[0].length||(match=next),re[t.COERCERTL].lastIndex=next.index+next[1].length+next[2].length;re[t.COERCERTL].lastIndex=-1}else match=version.match(re[t.COERCE]);return null===match?null:parse(`${match[2]}.${match[3]||"0"}.${match[4]||"0"}`,options)}},"./node_modules/semver/functions/compare-build.js":(module,__unused_webpack_exports,__webpack_require__)=>{const SemVer=__webpack_require__("./node_modules/semver/classes/semver.js");module.exports=(a,b,loose)=>{const versionA=new SemVer(a,loose),versionB=new SemVer(b,loose);return versionA.compare(versionB)||versionA.compareBuild(versionB)}},"./node_modules/semver/functions/compare-loose.js":(module,__unused_webpack_exports,__webpack_require__)=>{const compare=__webpack_require__("./node_modules/semver/functions/compare.js");module.exports=(a,b)=>compare(a,b,!0)},"./node_modules/semver/functions/compare.js":(module,__unused_webpack_exports,__webpack_require__)=>{const SemVer=__webpack_require__("./node_modules/semver/classes/semver.js");module.exports=(a,b,loose)=>new SemVer(a,loose).compare(new SemVer(b,loose))},"./node_modules/semver/functions/diff.js":(module,__unused_webpack_exports,__webpack_require__)=>{const parse=__webpack_require__("./node_modules/semver/functions/parse.js");module.exports=(version1,version2)=>{const v1=parse(version1,null,!0),v2=parse(version2,null,!0),comparison=v1.compare(v2);if(0===comparison)return null;const v1Higher=comparison>0,highVersion=v1Higher?v1:v2,lowVersion=v1Higher?v2:v1,highHasPre=!!highVersion.prerelease.length;if(!!lowVersion.prerelease.length&&!highHasPre)return lowVersion.patch||lowVersion.minor?highVersion.patch?"patch":highVersion.minor?"minor":"major":"major";const prefix=highHasPre?"pre":"";return v1.major!==v2.major?prefix+"major":v1.minor!==v2.minor?prefix+"minor":v1.patch!==v2.patch?prefix+"patch":"prerelease"}},"./node_modules/semver/functions/eq.js":(module,__unused_webpack_exports,__webpack_require__)=>{const compare=__webpack_require__("./node_modules/semver/functions/compare.js");module.exports=(a,b,loose)=>0===compare(a,b,loose)},"./node_modules/semver/functions/gt.js":(module,__unused_webpack_exports,__webpack_require__)=>{const compare=__webpack_require__("./node_modules/semver/functions/compare.js");module.exports=(a,b,loose)=>compare(a,b,loose)>0},"./node_modules/semver/functions/gte.js":(module,__unused_webpack_exports,__webpack_require__)=>{const compare=__webpack_require__("./node_modules/semver/functions/compare.js");module.exports=(a,b,loose)=>compare(a,b,loose)>=0},"./node_modules/semver/functions/inc.js":(module,__unused_webpack_exports,__webpack_require__)=>{const SemVer=__webpack_require__("./node_modules/semver/classes/semver.js");module.exports=(version,release,options,identifier,identifierBase)=>{"string"==typeof options&&(identifierBase=identifier,identifier=options,options=void 0);try{return new SemVer(version instanceof SemVer?version.version:version,options).inc(release,identifier,identifierBase).version}catch(er){return null}}},"./node_modules/semver/functions/lt.js":(module,__unused_webpack_exports,__webpack_require__)=>{const compare=__webpack_require__("./node_modules/semver/functions/compare.js");module.exports=(a,b,loose)=>compare(a,b,loose)<0},"./node_modules/semver/functions/lte.js":(module,__unused_webpack_exports,__webpack_require__)=>{const compare=__webpack_require__("./node_modules/semver/functions/compare.js");module.exports=(a,b,loose)=>compare(a,b,loose)<=0},"./node_modules/semver/functions/major.js":(module,__unused_webpack_exports,__webpack_require__)=>{const SemVer=__webpack_require__("./node_modules/semver/classes/semver.js");module.exports=(a,loose)=>new SemVer(a,loose).major},"./node_modules/semver/functions/minor.js":(module,__unused_webpack_exports,__webpack_require__)=>{const SemVer=__webpack_require__("./node_modules/semver/classes/semver.js");module.exports=(a,loose)=>new SemVer(a,loose).minor},"./node_modules/semver/functions/neq.js":(module,__unused_webpack_exports,__webpack_require__)=>{const compare=__webpack_require__("./node_modules/semver/functions/compare.js");module.exports=(a,b,loose)=>0!==compare(a,b,loose)},"./node_modules/semver/functions/parse.js":(module,__unused_webpack_exports,__webpack_require__)=>{const SemVer=__webpack_require__("./node_modules/semver/classes/semver.js");module.exports=(version,options,throwErrors=!1)=>{if(version instanceof SemVer)return version;try{return new SemVer(version,options)}catch(er){if(!throwErrors)return null;throw er}}},"./node_modules/semver/functions/patch.js":(module,__unused_webpack_exports,__webpack_require__)=>{const SemVer=__webpack_require__("./node_modules/semver/classes/semver.js");module.exports=(a,loose)=>new SemVer(a,loose).patch},"./node_modules/semver/functions/prerelease.js":(module,__unused_webpack_exports,__webpack_require__)=>{const parse=__webpack_require__("./node_modules/semver/functions/parse.js");module.exports=(version,options)=>{const parsed=parse(version,options);return parsed&&parsed.prerelease.length?parsed.prerelease:null}},"./node_modules/semver/functions/rcompare.js":(module,__unused_webpack_exports,__webpack_require__)=>{const compare=__webpack_require__("./node_modules/semver/functions/compare.js");module.exports=(a,b,loose)=>compare(b,a,loose)},"./node_modules/semver/functions/rsort.js":(module,__unused_webpack_exports,__webpack_require__)=>{const compareBuild=__webpack_require__("./node_modules/semver/functions/compare-build.js");module.exports=(list,loose)=>list.sort(((a,b)=>compareBuild(b,a,loose)))},"./node_modules/semver/functions/satisfies.js":(module,__unused_webpack_exports,__webpack_require__)=>{const Range=__webpack_require__("./node_modules/semver/classes/range.js");module.exports=(version,range,options)=>{try{range=new Range(range,options)}catch(er){return!1}return range.test(version)}},"./node_modules/semver/functions/sort.js":(module,__unused_webpack_exports,__webpack_require__)=>{const compareBuild=__webpack_require__("./node_modules/semver/functions/compare-build.js");module.exports=(list,loose)=>list.sort(((a,b)=>compareBuild(a,b,loose)))},"./node_modules/semver/functions/valid.js":(module,__unused_webpack_exports,__webpack_require__)=>{const parse=__webpack_require__("./node_modules/semver/functions/parse.js");module.exports=(version,options)=>{const v=parse(version,options);return v?v.version:null}},"./node_modules/semver/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{const internalRe=__webpack_require__("./node_modules/semver/internal/re.js"),constants=__webpack_require__("./node_modules/semver/internal/constants.js"),SemVer=__webpack_require__("./node_modules/semver/classes/semver.js"),identifiers=__webpack_require__("./node_modules/semver/internal/identifiers.js"),parse=__webpack_require__("./node_modules/semver/functions/parse.js"),valid=__webpack_require__("./node_modules/semver/functions/valid.js"),clean=__webpack_require__("./node_modules/semver/functions/clean.js"),inc=__webpack_require__("./node_modules/semver/functions/inc.js"),diff=__webpack_require__("./node_modules/semver/functions/diff.js"),major=__webpack_require__("./node_modules/semver/functions/major.js"),minor=__webpack_require__("./node_modules/semver/functions/minor.js"),patch=__webpack_require__("./node_modules/semver/functions/patch.js"),prerelease=__webpack_require__("./node_modules/semver/functions/prerelease.js"),compare=__webpack_require__("./node_modules/semver/functions/compare.js"),rcompare=__webpack_require__("./node_modules/semver/functions/rcompare.js"),compareLoose=__webpack_require__("./node_modules/semver/functions/compare-loose.js"),compareBuild=__webpack_require__("./node_modules/semver/functions/compare-build.js"),sort=__webpack_require__("./node_modules/semver/functions/sort.js"),rsort=__webpack_require__("./node_modules/semver/functions/rsort.js"),gt=__webpack_require__("./node_modules/semver/functions/gt.js"),lt=__webpack_require__("./node_modules/semver/functions/lt.js"),eq=__webpack_require__("./node_modules/semver/functions/eq.js"),neq=__webpack_require__("./node_modules/semver/functions/neq.js"),gte=__webpack_require__("./node_modules/semver/functions/gte.js"),lte=__webpack_require__("./node_modules/semver/functions/lte.js"),cmp=__webpack_require__("./node_modules/semver/functions/cmp.js"),coerce=__webpack_require__("./node_modules/semver/functions/coerce.js"),Comparator=__webpack_require__("./node_modules/semver/classes/comparator.js"),Range=__webpack_require__("./node_modules/semver/classes/range.js"),satisfies=__webpack_require__("./node_modules/semver/functions/satisfies.js"),toComparators=__webpack_require__("./node_modules/semver/ranges/to-comparators.js"),maxSatisfying=__webpack_require__("./node_modules/semver/ranges/max-satisfying.js"),minSatisfying=__webpack_require__("./node_modules/semver/ranges/min-satisfying.js"),minVersion=__webpack_require__("./node_modules/semver/ranges/min-version.js"),validRange=__webpack_require__("./node_modules/semver/ranges/valid.js"),outside=__webpack_require__("./node_modules/semver/ranges/outside.js"),gtr=__webpack_require__("./node_modules/semver/ranges/gtr.js"),ltr=__webpack_require__("./node_modules/semver/ranges/ltr.js"),intersects=__webpack_require__("./node_modules/semver/ranges/intersects.js"),simplifyRange=__webpack_require__("./node_modules/semver/ranges/simplify.js"),subset=__webpack_require__("./node_modules/semver/ranges/subset.js");module.exports={parse,valid,clean,inc,diff,major,minor,patch,prerelease,compare,rcompare,compareLoose,compareBuild,sort,rsort,gt,lt,eq,neq,gte,lte,cmp,coerce,Comparator,Range,satisfies,toComparators,maxSatisfying,minSatisfying,minVersion,validRange,outside,gtr,ltr,intersects,simplifyRange,subset,SemVer,re:internalRe.re,src:internalRe.src,tokens:internalRe.t,SEMVER_SPEC_VERSION:constants.SEMVER_SPEC_VERSION,RELEASE_TYPES:constants.RELEASE_TYPES,compareIdentifiers:identifiers.compareIdentifiers,rcompareIdentifiers:identifiers.rcompareIdentifiers}},"./node_modules/semver/internal/constants.js":module=>{const MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;module.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_INTEGER,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},"./node_modules/semver/internal/debug.js":(module,__unused_webpack_exports,__webpack_require__)=>{var process=__webpack_require__("./node_modules/process/browser.js");const debug="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...args)=>console.error("SEMVER",...args):()=>{};module.exports=debug},"./node_modules/semver/internal/identifiers.js":module=>{const numeric=/^[0-9]+$/,compareIdentifiers=(a,b)=>{const anum=numeric.test(a),bnum=numeric.test(b);return anum&&bnum&&(a=+a,b=+b),a===b?0:anum&&!bnum?-1:bnum&&!anum?1:a<b?-1:1};module.exports={compareIdentifiers,rcompareIdentifiers:(a,b)=>compareIdentifiers(b,a)}},"./node_modules/semver/internal/parse-options.js":module=>{const looseOption=Object.freeze({loose:!0}),emptyOpts=Object.freeze({});module.exports=options=>options?"object"!=typeof options?looseOption:options:emptyOpts},"./node_modules/semver/internal/re.js":(module,exports,__webpack_require__)=>{const{MAX_SAFE_COMPONENT_LENGTH}=__webpack_require__("./node_modules/semver/internal/constants.js"),debug=__webpack_require__("./node_modules/semver/internal/debug.js"),re=(exports=module.exports={}).re=[],safeRe=exports.safeRe=[],src=exports.src=[],t=exports.t={};let R=0;const createToken=(name,value,isGlobal)=>{const safe=value.split("\\s*").join("\\s{0,1}").split("\\s+").join("\\s"),index=R++;debug(name,index,value),t[name]=index,src[index]=value,re[index]=new RegExp(value,isGlobal?"g":void 0),safeRe[index]=new RegExp(safe,isGlobal?"g":void 0)};createToken("NUMERICIDENTIFIER","0|[1-9]\\d*"),createToken("NUMERICIDENTIFIERLOOSE","[0-9]+"),createToken("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),createToken("MAINVERSION",`(${src[t.NUMERICIDENTIFIER]})\\.(${src[t.NUMERICIDENTIFIER]})\\.(${src[t.NUMERICIDENTIFIER]})`),createToken("MAINVERSIONLOOSE",`(${src[t.NUMERICIDENTIFIERLOOSE]})\\.(${src[t.NUMERICIDENTIFIERLOOSE]})\\.(${src[t.NUMERICIDENTIFIERLOOSE]})`),createToken("PRERELEASEIDENTIFIER",`(?:${src[t.NUMERICIDENTIFIER]}|${src[t.NONNUMERICIDENTIFIER]})`),createToken("PRERELEASEIDENTIFIERLOOSE",`(?:${src[t.NUMERICIDENTIFIERLOOSE]}|${src[t.NONNUMERICIDENTIFIER]})`),createToken("PRERELEASE",`(?:-(${src[t.PRERELEASEIDENTIFIER]}(?:\\.${src[t.PRERELEASEIDENTIFIER]})*))`),createToken("PRERELEASELOOSE",`(?:-?(${src[t.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${src[t.PRERELEASEIDENTIFIERLOOSE]})*))`),createToken("BUILDIDENTIFIER","[0-9A-Za-z-]+"),createToken("BUILD",`(?:\\+(${src[t.BUILDIDENTIFIER]}(?:\\.${src[t.BUILDIDENTIFIER]})*))`),createToken("FULLPLAIN",`v?${src[t.MAINVERSION]}${src[t.PRERELEASE]}?${src[t.BUILD]}?`),createToken("FULL",`^${src[t.FULLPLAIN]}$`),createToken("LOOSEPLAIN",`[v=\\s]*${src[t.MAINVERSIONLOOSE]}${src[t.PRERELEASELOOSE]}?${src[t.BUILD]}?`),createToken("LOOSE",`^${src[t.LOOSEPLAIN]}$`),createToken("GTLT","((?:<|>)?=?)"),createToken("XRANGEIDENTIFIERLOOSE",`${src[t.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),createToken("XRANGEIDENTIFIER",`${src[t.NUMERICIDENTIFIER]}|x|X|\\*`),createToken("XRANGEPLAIN",`[v=\\s]*(${src[t.XRANGEIDENTIFIER]})(?:\\.(${src[t.XRANGEIDENTIFIER]})(?:\\.(${src[t.XRANGEIDENTIFIER]})(?:${src[t.PRERELEASE]})?${src[t.BUILD]}?)?)?`),createToken("XRANGEPLAINLOOSE",`[v=\\s]*(${src[t.XRANGEIDENTIFIERLOOSE]})(?:\\.(${src[t.XRANGEIDENTIFIERLOOSE]})(?:\\.(${src[t.XRANGEIDENTIFIERLOOSE]})(?:${src[t.PRERELEASELOOSE]})?${src[t.BUILD]}?)?)?`),createToken("XRANGE",`^${src[t.GTLT]}\\s*${src[t.XRANGEPLAIN]}$`),createToken("XRANGELOOSE",`^${src[t.GTLT]}\\s*${src[t.XRANGEPLAINLOOSE]}$`),createToken("COERCE",`(^|[^\\d])(\\d{1,${MAX_SAFE_COMPONENT_LENGTH}})(?:\\.(\\d{1,${MAX_SAFE_COMPONENT_LENGTH}}))?(?:\\.(\\d{1,${MAX_SAFE_COMPONENT_LENGTH}}))?(?:$|[^\\d])`),createToken("COERCERTL",src[t.COERCE],!0),createToken("LONETILDE","(?:~>?)"),createToken("TILDETRIM",`(\\s*)${src[t.LONETILDE]}\\s+`,!0),exports.tildeTrimReplace="$1~",createToken("TILDE",`^${src[t.LONETILDE]}${src[t.XRANGEPLAIN]}$`),createToken("TILDELOOSE",`^${src[t.LONETILDE]}${src[t.XRANGEPLAINLOOSE]}$`),createToken("LONECARET","(?:\\^)"),createToken("CARETTRIM",`(\\s*)${src[t.LONECARET]}\\s+`,!0),exports.caretTrimReplace="$1^",createToken("CARET",`^${src[t.LONECARET]}${src[t.XRANGEPLAIN]}$`),createToken("CARETLOOSE",`^${src[t.LONECARET]}${src[t.XRANGEPLAINLOOSE]}$`),createToken("COMPARATORLOOSE",`^${src[t.GTLT]}\\s*(${src[t.LOOSEPLAIN]})$|^$`),createToken("COMPARATOR",`^${src[t.GTLT]}\\s*(${src[t.FULLPLAIN]})$|^$`),createToken("COMPARATORTRIM",`(\\s*)${src[t.GTLT]}\\s*(${src[t.LOOSEPLAIN]}|${src[t.XRANGEPLAIN]})`,!0),exports.comparatorTrimReplace="$1$2$3",createToken("HYPHENRANGE",`^\\s*(${src[t.XRANGEPLAIN]})\\s+-\\s+(${src[t.XRANGEPLAIN]})\\s*$`),createToken("HYPHENRANGELOOSE",`^\\s*(${src[t.XRANGEPLAINLOOSE]})\\s+-\\s+(${src[t.XRANGEPLAINLOOSE]})\\s*$`),createToken("STAR","(<|>)?=?\\s*\\*"),createToken("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),createToken("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},"./node_modules/semver/node_modules/lru-cache/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";const Yallist=__webpack_require__("./node_modules/yallist/yallist.js"),MAX=Symbol("max"),LENGTH=Symbol("length"),LENGTH_CALCULATOR=Symbol("lengthCalculator"),ALLOW_STALE=Symbol("allowStale"),MAX_AGE=Symbol("maxAge"),DISPOSE=Symbol("dispose"),NO_DISPOSE_ON_SET=Symbol("noDisposeOnSet"),LRU_LIST=Symbol("lruList"),CACHE=Symbol("cache"),UPDATE_AGE_ON_GET=Symbol("updateAgeOnGet"),naiveLength=()=>1;const get=(self,key,doUse)=>{const node=self[CACHE].get(key);if(node){const hit=node.value;if(isStale(self,hit)){if(del(self,node),!self[ALLOW_STALE])return}else doUse&&(self[UPDATE_AGE_ON_GET]&&(node.value.now=Date.now()),self[LRU_LIST].unshiftNode(node));return hit.value}},isStale=(self,hit)=>{if(!hit||!hit.maxAge&&!self[MAX_AGE])return!1;const diff=Date.now()-hit.now;return hit.maxAge?diff>hit.maxAge:self[MAX_AGE]&&diff>self[MAX_AGE]},trim=self=>{if(self[LENGTH]>self[MAX])for(let walker=self[LRU_LIST].tail;self[LENGTH]>self[MAX]&&null!==walker;){const prev=walker.prev;del(self,walker),walker=prev}},del=(self,node)=>{if(node){const hit=node.value;self[DISPOSE]&&self[DISPOSE](hit.key,hit.value),self[LENGTH]-=hit.length,self[CACHE].delete(hit.key),self[LRU_LIST].removeNode(node)}};class Entry{constructor(key,value,length,now,maxAge){this.key=key,this.value=value,this.length=length,this.now=now,this.maxAge=maxAge||0}}const forEachStep=(self,fn,node,thisp)=>{let hit=node.value;isStale(self,hit)&&(del(self,node),self[ALLOW_STALE]||(hit=void 0)),hit&&fn.call(thisp,hit.value,hit.key,self)};module.exports=class LRUCache{constructor(options){if("number"==typeof options&&(options={max:options}),options||(options={}),options.max&&("number"!=typeof options.max||options.max<0))throw new TypeError("max must be a non-negative number");this[MAX]=options.max||1/0;const lc=options.length||naiveLength;if(this[LENGTH_CALCULATOR]="function"!=typeof lc?naiveLength:lc,this[ALLOW_STALE]=options.stale||!1,options.maxAge&&"number"!=typeof options.maxAge)throw new TypeError("maxAge must be a number");this[MAX_AGE]=options.maxAge||0,this[DISPOSE]=options.dispose,this[NO_DISPOSE_ON_SET]=options.noDisposeOnSet||!1,this[UPDATE_AGE_ON_GET]=options.updateAgeOnGet||!1,this.reset()}set max(mL){if("number"!=typeof mL||mL<0)throw new TypeError("max must be a non-negative number");this[MAX]=mL||1/0,trim(this)}get max(){return this[MAX]}set allowStale(allowStale){this[ALLOW_STALE]=!!allowStale}get allowStale(){return this[ALLOW_STALE]}set maxAge(mA){if("number"!=typeof mA)throw new TypeError("maxAge must be a non-negative number");this[MAX_AGE]=mA,trim(this)}get maxAge(){return this[MAX_AGE]}set lengthCalculator(lC){"function"!=typeof lC&&(lC=naiveLength),lC!==this[LENGTH_CALCULATOR]&&(this[LENGTH_CALCULATOR]=lC,this[LENGTH]=0,this[LRU_LIST].forEach((hit=>{hit.length=this[LENGTH_CALCULATOR](hit.value,hit.key),this[LENGTH]+=hit.length}))),trim(this)}get lengthCalculator(){return this[LENGTH_CALCULATOR]}get length(){return this[LENGTH]}get itemCount(){return this[LRU_LIST].length}rforEach(fn,thisp){thisp=thisp||this;for(let walker=this[LRU_LIST].tail;null!==walker;){const prev=walker.prev;forEachStep(this,fn,walker,thisp),walker=prev}}forEach(fn,thisp){thisp=thisp||this;for(let walker=this[LRU_LIST].head;null!==walker;){const next=walker.next;forEachStep(this,fn,walker,thisp),walker=next}}keys(){return this[LRU_LIST].toArray().map((k=>k.key))}values(){return this[LRU_LIST].toArray().map((k=>k.value))}reset(){this[DISPOSE]&&this[LRU_LIST]&&this[LRU_LIST].length&&this[LRU_LIST].forEach((hit=>this[DISPOSE](hit.key,hit.value))),this[CACHE]=new Map,this[LRU_LIST]=new Yallist,this[LENGTH]=0}dump(){return this[LRU_LIST].map((hit=>!isStale(this,hit)&&{k:hit.key,v:hit.value,e:hit.now+(hit.maxAge||0)})).toArray().filter((h=>h))}dumpLru(){return this[LRU_LIST]}set(key,value,maxAge){if((maxAge=maxAge||this[MAX_AGE])&&"number"!=typeof maxAge)throw new TypeError("maxAge must be a number");const now=maxAge?Date.now():0,len=this[LENGTH_CALCULATOR](value,key);if(this[CACHE].has(key)){if(len>this[MAX])return del(this,this[CACHE].get(key)),!1;const item=this[CACHE].get(key).value;return this[DISPOSE]&&(this[NO_DISPOSE_ON_SET]||this[DISPOSE](key,item.value)),item.now=now,item.maxAge=maxAge,item.value=value,this[LENGTH]+=len-item.length,item.length=len,this.get(key),trim(this),!0}const hit=new Entry(key,value,len,now,maxAge);return hit.length>this[MAX]?(this[DISPOSE]&&this[DISPOSE](key,value),!1):(this[LENGTH]+=hit.length,this[LRU_LIST].unshift(hit),this[CACHE].set(key,this[LRU_LIST].head),trim(this),!0)}has(key){if(!this[CACHE].has(key))return!1;const hit=this[CACHE].get(key).value;return!isStale(this,hit)}get(key){return get(this,key,!0)}peek(key){return get(this,key,!1)}pop(){const node=this[LRU_LIST].tail;return node?(del(this,node),node.value):null}del(key){del(this,this[CACHE].get(key))}load(arr){this.reset();const now=Date.now();for(let l=arr.length-1;l>=0;l--){const hit=arr[l],expiresAt=hit.e||0;if(0===expiresAt)this.set(hit.k,hit.v);else{const maxAge=expiresAt-now;maxAge>0&&this.set(hit.k,hit.v,maxAge)}}}prune(){this[CACHE].forEach(((value,key)=>get(this,key,!1)))}}},"./node_modules/semver/ranges/gtr.js":(module,__unused_webpack_exports,__webpack_require__)=>{const outside=__webpack_require__("./node_modules/semver/ranges/outside.js");module.exports=(version,range,options)=>outside(version,range,">",options)},"./node_modules/semver/ranges/intersects.js":(module,__unused_webpack_exports,__webpack_require__)=>{const Range=__webpack_require__("./node_modules/semver/classes/range.js");module.exports=(r1,r2,options)=>(r1=new Range(r1,options),r2=new Range(r2,options),r1.intersects(r2,options))},"./node_modules/semver/ranges/ltr.js":(module,__unused_webpack_exports,__webpack_require__)=>{const outside=__webpack_require__("./node_modules/semver/ranges/outside.js");module.exports=(version,range,options)=>outside(version,range,"<",options)},"./node_modules/semver/ranges/max-satisfying.js":(module,__unused_webpack_exports,__webpack_require__)=>{const SemVer=__webpack_require__("./node_modules/semver/classes/semver.js"),Range=__webpack_require__("./node_modules/semver/classes/range.js");module.exports=(versions,range,options)=>{let max=null,maxSV=null,rangeObj=null;try{rangeObj=new Range(range,options)}catch(er){return null}return versions.forEach((v=>{rangeObj.test(v)&&(max&&-1!==maxSV.compare(v)||(max=v,maxSV=new SemVer(max,options)))})),max}},"./node_modules/semver/ranges/min-satisfying.js":(module,__unused_webpack_exports,__webpack_require__)=>{const SemVer=__webpack_require__("./node_modules/semver/classes/semver.js"),Range=__webpack_require__("./node_modules/semver/classes/range.js");module.exports=(versions,range,options)=>{let min=null,minSV=null,rangeObj=null;try{rangeObj=new Range(range,options)}catch(er){return null}return versions.forEach((v=>{rangeObj.test(v)&&(min&&1!==minSV.compare(v)||(min=v,minSV=new SemVer(min,options)))})),min}},"./node_modules/semver/ranges/min-version.js":(module,__unused_webpack_exports,__webpack_require__)=>{const SemVer=__webpack_require__("./node_modules/semver/classes/semver.js"),Range=__webpack_require__("./node_modules/semver/classes/range.js"),gt=__webpack_require__("./node_modules/semver/functions/gt.js");module.exports=(range,loose)=>{range=new Range(range,loose);let minver=new SemVer("0.0.0");if(range.test(minver))return minver;if(minver=new SemVer("0.0.0-0"),range.test(minver))return minver;minver=null;for(let i=0;i<range.set.length;++i){const comparators=range.set[i];let setMin=null;comparators.forEach((comparator=>{const compver=new SemVer(comparator.semver.version);switch(comparator.operator){case">":0===compver.prerelease.length?compver.patch++:compver.prerelease.push(0),compver.raw=compver.format();case"":case">=":setMin&&!gt(compver,setMin)||(setMin=compver);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${comparator.operator}`)}})),!setMin||minver&&!gt(minver,setMin)||(minver=setMin)}return minver&&range.test(minver)?minver:null}},"./node_modules/semver/ranges/outside.js":(module,__unused_webpack_exports,__webpack_require__)=>{const SemVer=__webpack_require__("./node_modules/semver/classes/semver.js"),Comparator=__webpack_require__("./node_modules/semver/classes/comparator.js"),{ANY}=Comparator,Range=__webpack_require__("./node_modules/semver/classes/range.js"),satisfies=__webpack_require__("./node_modules/semver/functions/satisfies.js"),gt=__webpack_require__("./node_modules/semver/functions/gt.js"),lt=__webpack_require__("./node_modules/semver/functions/lt.js"),lte=__webpack_require__("./node_modules/semver/functions/lte.js"),gte=__webpack_require__("./node_modules/semver/functions/gte.js");module.exports=(version,range,hilo,options)=>{let gtfn,ltefn,ltfn,comp,ecomp;switch(version=new SemVer(version,options),range=new Range(range,options),hilo){case">":gtfn=gt,ltefn=lte,ltfn=lt,comp=">",ecomp=">=";break;case"<":gtfn=lt,ltefn=gte,ltfn=gt,comp="<",ecomp="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(satisfies(version,range,options))return!1;for(let i=0;i<range.set.length;++i){const comparators=range.set[i];let high=null,low=null;if(comparators.forEach((comparator=>{comparator.semver===ANY&&(comparator=new Comparator(">=0.0.0")),high=high||comparator,low=low||comparator,gtfn(comparator.semver,high.semver,options)?high=comparator:ltfn(comparator.semver,low.semver,options)&&(low=comparator)})),high.operator===comp||high.operator===ecomp)return!1;if((!low.operator||low.operator===comp)&&ltefn(version,low.semver))return!1;if(low.operator===ecomp&&ltfn(version,low.semver))return!1}return!0}},"./node_modules/semver/ranges/simplify.js":(module,__unused_webpack_exports,__webpack_require__)=>{const satisfies=__webpack_require__("./node_modules/semver/functions/satisfies.js"),compare=__webpack_require__("./node_modules/semver/functions/compare.js");module.exports=(versions,range,options)=>{const set=[];let first=null,prev=null;const v=versions.sort(((a,b)=>compare(a,b,options)));for(const version of v){satisfies(version,range,options)?(prev=version,first||(first=version)):(prev&&set.push([first,prev]),prev=null,first=null)}first&&set.push([first,null]);const ranges=[];for(const[min,max]of set)min===max?ranges.push(min):max||min!==v[0]?max?min===v[0]?ranges.push(`<=${max}`):ranges.push(`${min} - ${max}`):ranges.push(`>=${min}`):ranges.push("*");const simplified=ranges.join(" || "),original="string"==typeof range.raw?range.raw:String(range);return simplified.length<original.length?simplified:range}},"./node_modules/semver/ranges/subset.js":(module,__unused_webpack_exports,__webpack_require__)=>{const Range=__webpack_require__("./node_modules/semver/classes/range.js"),Comparator=__webpack_require__("./node_modules/semver/classes/comparator.js"),{ANY}=Comparator,satisfies=__webpack_require__("./node_modules/semver/functions/satisfies.js"),compare=__webpack_require__("./node_modules/semver/functions/compare.js"),minimumVersionWithPreRelease=[new Comparator(">=0.0.0-0")],minimumVersion=[new Comparator(">=0.0.0")],simpleSubset=(sub,dom,options)=>{if(sub===dom)return!0;if(1===sub.length&&sub[0].semver===ANY){if(1===dom.length&&dom[0].semver===ANY)return!0;sub=options.includePrerelease?minimumVersionWithPreRelease:minimumVersion}if(1===dom.length&&dom[0].semver===ANY){if(options.includePrerelease)return!0;dom=minimumVersion}const eqSet=new Set;let gt,lt,gtltComp,higher,lower,hasDomLT,hasDomGT;for(const c of sub)">"===c.operator||">="===c.operator?gt=higherGT(gt,c,options):"<"===c.operator||"<="===c.operator?lt=lowerLT(lt,c,options):eqSet.add(c.semver);if(eqSet.size>1)return null;if(gt&&lt){if(gtltComp=compare(gt.semver,lt.semver,options),gtltComp>0)return null;if(0===gtltComp&&(">="!==gt.operator||"<="!==lt.operator))return null}for(const eq of eqSet){if(gt&&!satisfies(eq,String(gt),options))return null;if(lt&&!satisfies(eq,String(lt),options))return null;for(const c of dom)if(!satisfies(eq,String(c),options))return!1;return!0}let needDomLTPre=!(!lt||options.includePrerelease||!lt.semver.prerelease.length)&&lt.semver,needDomGTPre=!(!gt||options.includePrerelease||!gt.semver.prerelease.length)&&gt.semver;needDomLTPre&&1===needDomLTPre.prerelease.length&&"<"===lt.operator&&0===needDomLTPre.prerelease[0]&&(needDomLTPre=!1);for(const c of dom){if(hasDomGT=hasDomGT||">"===c.operator||">="===c.operator,hasDomLT=hasDomLT||"<"===c.operator||"<="===c.operator,gt)if(needDomGTPre&&c.semver.prerelease&&c.semver.prerelease.length&&c.semver.major===needDomGTPre.major&&c.semver.minor===needDomGTPre.minor&&c.semver.patch===needDomGTPre.patch&&(needDomGTPre=!1),">"===c.operator||">="===c.operator){if(higher=higherGT(gt,c,options),higher===c&&higher!==gt)return!1}else if(">="===gt.operator&&!satisfies(gt.semver,String(c),options))return!1;if(lt)if(needDomLTPre&&c.semver.prerelease&&c.semver.prerelease.length&&c.semver.major===needDomLTPre.major&&c.semver.minor===needDomLTPre.minor&&c.semver.patch===needDomLTPre.patch&&(needDomLTPre=!1),"<"===c.operator||"<="===c.operator){if(lower=lowerLT(lt,c,options),lower===c&&lower!==lt)return!1}else if("<="===lt.operator&&!satisfies(lt.semver,String(c),options))return!1;if(!c.operator&&(lt||gt)&&0!==gtltComp)return!1}return!(gt&&hasDomLT&&!lt&&0!==gtltComp)&&(!(lt&&hasDomGT&&!gt&&0!==gtltComp)&&(!needDomGTPre&&!needDomLTPre))},higherGT=(a,b,options)=>{if(!a)return b;const comp=compare(a.semver,b.semver,options);return comp>0?a:comp<0||">"===b.operator&&">="===a.operator?b:a},lowerLT=(a,b,options)=>{if(!a)return b;const comp=compare(a.semver,b.semver,options);return comp<0?a:comp>0||"<"===b.operator&&"<="===a.operator?b:a};module.exports=(sub,dom,options={})=>{if(sub===dom)return!0;sub=new Range(sub,options),dom=new Range(dom,options);let sawNonNull=!1;OUTER:for(const simpleSub of sub.set){for(const simpleDom of dom.set){const isSub=simpleSubset(simpleSub,simpleDom,options);if(sawNonNull=sawNonNull||null!==isSub,isSub)continue OUTER}if(sawNonNull)return!1}return!0}},"./node_modules/semver/ranges/to-comparators.js":(module,__unused_webpack_exports,__webpack_require__)=>{const Range=__webpack_require__("./node_modules/semver/classes/range.js");module.exports=(range,options)=>new Range(range,options).set.map((comp=>comp.map((c=>c.value)).join(" ").trim().split(" ")))},"./node_modules/semver/ranges/valid.js":(module,__unused_webpack_exports,__webpack_require__)=>{const Range=__webpack_require__("./node_modules/semver/classes/range.js");module.exports=(range,options)=>{try{return new Range(range,options).range||"*"}catch(er){return null}}},"./node_modules/side-channel/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var GetIntrinsic=__webpack_require__("./node_modules/get-intrinsic/index.js"),callBound=__webpack_require__("./node_modules/call-bind/callBound.js"),inspect=__webpack_require__("./node_modules/object-inspect/index.js"),$TypeError=GetIntrinsic("%TypeError%"),$WeakMap=GetIntrinsic("%WeakMap%",!0),$Map=GetIntrinsic("%Map%",!0),$weakMapGet=callBound("WeakMap.prototype.get",!0),$weakMapSet=callBound("WeakMap.prototype.set",!0),$weakMapHas=callBound("WeakMap.prototype.has",!0),$mapGet=callBound("Map.prototype.get",!0),$mapSet=callBound("Map.prototype.set",!0),$mapHas=callBound("Map.prototype.has",!0),listGetNode=function(list,key){for(var curr,prev=list;null!==(curr=prev.next);prev=curr)if(curr.key===key)return prev.next=curr.next,curr.next=list.next,list.next=curr,curr};module.exports=function getSideChannel(){var $wm,$m,$o,channel={assert:function(key){if(!channel.has(key))throw new $TypeError("Side channel does not contain "+inspect(key))},get:function(key){if($WeakMap&&key&&("object"==typeof key||"function"==typeof key)){if($wm)return $weakMapGet($wm,key)}else if($Map){if($m)return $mapGet($m,key)}else if($o)return function(objects,key){var node=listGetNode(objects,key);return node&&node.value}($o,key)},has:function(key){if($WeakMap&&key&&("object"==typeof key||"function"==typeof key)){if($wm)return $weakMapHas($wm,key)}else if($Map){if($m)return $mapHas($m,key)}else if($o)return function(objects,key){return!!listGetNode(objects,key)}($o,key);return!1},set:function(key,value){$WeakMap&&key&&("object"==typeof key||"function"==typeof key)?($wm||($wm=new $WeakMap),$weakMapSet($wm,key,value)):$Map?($m||($m=new $Map),$mapSet($m,key,value)):($o||($o={key:{},next:null}),function(objects,key,value){var node=listGetNode(objects,key);node?node.value=value:objects.next={key,next:objects.next,value}}($o,key,value))}};return channel}},"./node_modules/store2/dist/store2.js":function(module){var window,define,_,store;window=this,define=this&&this.define,_={version:"2.14.2",areas:{},apis:{},nsdelim:".",inherit:function(api,o){for(var p in api)o.hasOwnProperty(p)||Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(api,p));return o},stringify:function(d,fn){return void 0===d||"function"==typeof d?d+"":JSON.stringify(d,fn||_.replace)},parse:function(s,fn){try{return JSON.parse(s,fn||_.revive)}catch(e){return s}},fn:function(name,fn){for(var api in _.storeAPI[name]=fn,_.apis)_.apis[api][name]=fn},get:function(area,key){return area.getItem(key)},set:function(area,key,string){area.setItem(key,string)},remove:function(area,key){area.removeItem(key)},key:function(area,i){return area.key(i)},length:function(area){return area.length},clear:function(area){area.clear()},Store:function(id,area,namespace){var store=_.inherit(_.storeAPI,(function(key,data,overwrite){return 0===arguments.length?store.getAll():"function"==typeof data?store.transact(key,data,overwrite):void 0!==data?store.set(key,data,overwrite):"string"==typeof key||"number"==typeof key?store.get(key):"function"==typeof key?store.each(key):key?store.setAll(key,data):store.clear()}));store._id=id;try{area.setItem("__store2_test","ok"),store._area=area,area.removeItem("__store2_test")}catch(e){store._area=_.storage("fake")}return store._ns=namespace||"",_.areas[id]||(_.areas[id]=store._area),_.apis[store._ns+store._id]||(_.apis[store._ns+store._id]=store),store},storeAPI:{area:function(id,area){var store=this[id];return store&&store.area||(store=_.Store(id,area,this._ns),this[id]||(this[id]=store)),store},namespace:function(namespace,singleArea,delim){if(delim=delim||this._delim||_.nsdelim,!namespace)return this._ns?this._ns.substring(0,this._ns.length-delim.length):"";var ns=namespace,store=this[ns];if(!(store&&store.namespace||((store=_.Store(this._id,this._area,this._ns+ns+delim))._delim=delim,this[ns]||(this[ns]=store),singleArea)))for(var name in _.areas)store.area(name,_.areas[name]);return store},isFake:function(force){return force?(this._real=this._area,this._area=_.storage("fake")):!1===force&&(this._area=this._real||this._area),"fake"===this._area.name},toString:function(){return"store"+(this._ns?"."+this.namespace():"")+"["+this._id+"]"},has:function(key){return this._area.has?this._area.has(this._in(key)):!!(this._in(key)in this._area)},size:function(){return this.keys().length},each:function(fn,fill){for(var i=0,m=_.length(this._area);i<m;i++){var key=this._out(_.key(this._area,i));if(void 0!==key&&!1===fn.call(this,key,this.get(key),fill))break;m>_.length(this._area)&&(m--,i--)}return fill||this},keys:function(fillList){return this.each((function(k,v,list){list.push(k)}),fillList||[])},get:function(key,alt){var fn,s=_.get(this._area,this._in(key));return"function"==typeof alt&&(fn=alt,alt=null),null!==s?_.parse(s,fn):null!=alt?alt:s},getAll:function(fillObj){return this.each((function(k,v,all){all[k]=v}),fillObj||{})},transact:function(key,fn,alt){var val=this.get(key,alt),ret=fn(val);return this.set(key,void 0===ret?val:ret),this},set:function(key,data,overwrite){var replacer,d=this.get(key);return null!=d&&!1===overwrite?data:("function"==typeof overwrite&&(replacer=overwrite,overwrite=void 0),_.set(this._area,this._in(key),_.stringify(data,replacer),overwrite)||d)},setAll:function(data,overwrite){var changed,val;for(var key in data)val=data[key],this.set(key,val,overwrite)!==val&&(changed=!0);return changed},add:function(key,data,replacer){var d=this.get(key);if(d instanceof Array)data=d.concat(data);else if(null!==d){var type=typeof d;if(type===typeof data&&"object"===type){for(var k in data)d[k]=data[k];data=d}else data=d+data}return _.set(this._area,this._in(key),_.stringify(data,replacer)),data},remove:function(key,alt){var d=this.get(key,alt);return _.remove(this._area,this._in(key)),d},clear:function(){return this._ns?this.each((function(k){_.remove(this._area,this._in(k))}),1):_.clear(this._area),this},clearAll:function(){var area=this._area;for(var id in _.areas)_.areas.hasOwnProperty(id)&&(this._area=_.areas[id],this.clear());return this._area=area,this},_in:function(k){return"string"!=typeof k&&(k=_.stringify(k)),this._ns?this._ns+k:k},_out:function(k){return this._ns?k&&0===k.indexOf(this._ns)?k.substring(this._ns.length):void 0:k}},storage:function(name){return _.inherit(_.storageAPI,{items:{},name})},storageAPI:{length:0,has:function(k){return this.items.hasOwnProperty(k)},key:function(i){var c=0;for(var k in this.items)if(this.has(k)&&i===c++)return k},setItem:function(k,v){this.has(k)||this.length++,this.items[k]=v},removeItem:function(k){this.has(k)&&(delete this.items[k],this.length--)},getItem:function(k){return this.has(k)?this.items[k]:null},clear:function(){for(var k in this.items)this.removeItem(k)}}},(store=_.Store("local",function(){try{return localStorage}catch(e){}}())).local=store,store._=_,store.area("session",function(){try{return sessionStorage}catch(e){}}()),store.area("page",_.storage("page")),"function"==typeof define&&void 0!==define.amd?define("store2",[],(function(){return store})):module.exports?module.exports=store:(window.store&&(_.conflict=window.store),window.store=store)},"./node_modules/storybook-dark-mode/dist/esm/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{vs:()=>useDarkMode});var Addon_TypesEnum2,react=__webpack_require__("./node_modules/react/index.js"),external_STORYBOOK_MODULE_ADDONS_=__webpack_require__("@storybook/addons"),constants_DARK_MODE_EVENT_NAME="DARK_MODE",dist=__webpack_require__("./node_modules/@storybook/global/dist/index.mjs"),chunk_4NMOSTKD=__webpack_require__("./node_modules/@storybook/theming/dist/chunk-4NMOSTKD.mjs"),external_STORYBOOK_MODULE_CORE_EVENTS_=__webpack_require__("@storybook/core-events"),mergeWith=__webpack_require__("./node_modules/lodash/mergeWith.js"),mergeWith_default=__webpack_require__.n(mergeWith),external_STORYBOOK_MODULE_CLIENT_LOGGER_=__webpack_require__("@storybook/client-logger"),store2=__webpack_require__("./node_modules/store2/dist/store2.js"),store2_default=__webpack_require__.n(store2),telejson_dist=__webpack_require__("./node_modules/telejson/dist/index.mjs"),isEqual=__webpack_require__("./node_modules/lodash/isEqual.js"),isEqual_default=__webpack_require__.n(isEqual),Addon_TypesEnum=((Addon_TypesEnum2=Addon_TypesEnum||{}).TAB="tab",Addon_TypesEnum2.PANEL="panel",Addon_TypesEnum2.TOOL="tool",Addon_TypesEnum2.TOOLEXTRA="toolextra",Addon_TypesEnum2.PREVIEW="preview",Addon_TypesEnum2.NOTES_ELEMENT="notes-element",Addon_TypesEnum2),memoizerific=__webpack_require__("./node_modules/memoizerific/memoizerific.js"),memoizerific_default=__webpack_require__.n(memoizerific),csf_dist=__webpack_require__("./node_modules/@storybook/csf/dist/index.mjs"),esm=__webpack_require__("./node_modules/ts-dedent/esm/index.js"),countBy=__webpack_require__("./node_modules/lodash/countBy.js"),countBy_default=__webpack_require__.n(countBy),mapValues=__webpack_require__("./node_modules/lodash/mapValues.js"),mapValues_default=__webpack_require__.n(mapValues),pick=__webpack_require__("./node_modules/lodash/pick.js"),pick_default=__webpack_require__.n(pick),has=Object.prototype.hasOwnProperty;function find(iter,tar,key){for(key of iter.keys())if(dequal(key,tar))return key}function dequal(foo,bar){var ctor,len,tmp;if(foo===bar)return!0;if(foo&&bar&&(ctor=foo.constructor)===bar.constructor){if(ctor===Date)return foo.getTime()===bar.getTime();if(ctor===RegExp)return foo.toString()===bar.toString();if(ctor===Array){if((len=foo.length)===bar.length)for(;len--&&dequal(foo[len],bar[len]););return-1===len}if(ctor===Set){if(foo.size!==bar.size)return!1;for(len of foo){if((tmp=len)&&"object"==typeof tmp&&!(tmp=find(bar,tmp)))return!1;if(!bar.has(tmp))return!1}return!0}if(ctor===Map){if(foo.size!==bar.size)return!1;for(len of foo){if((tmp=len[0])&&"object"==typeof tmp&&!(tmp=find(bar,tmp)))return!1;if(!dequal(len[1],bar.get(tmp)))return!1}return!0}if(ctor===ArrayBuffer)foo=new Uint8Array(foo),bar=new Uint8Array(bar);else if(ctor===DataView){if((len=foo.byteLength)===bar.byteLength)for(;len--&&foo.getInt8(len)===bar.getInt8(len););return-1===len}if(ArrayBuffer.isView(foo)){if((len=foo.byteLength)===bar.byteLength)for(;len--&&foo[len]===bar[len];);return-1===len}if(!ctor||"object"==typeof foo){for(ctor in len=0,foo){if(has.call(foo,ctor)&&++len&&!has.call(bar,ctor))return!1;if(!(ctor in bar)||!dequal(foo[ctor],bar[ctor]))return!1}return Object.keys(bar).length===len}}return foo!=foo&&bar!=bar}var lib=__webpack_require__("./node_modules/qs/lib/index.js"),lib_default=__webpack_require__.n(lib),__create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty,__commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports},require_freeGlobal=__commonJS({"../../node_modules/lodash/_freeGlobal.js"(exports,module){var freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g;module.exports=freeGlobal}}),require_root=__commonJS({"../../node_modules/lodash/_root.js"(exports,module){var freeGlobal=require_freeGlobal(),freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")();module.exports=root}}),require_Symbol=__commonJS({"../../node_modules/lodash/_Symbol.js"(exports,module){var Symbol2=require_root().Symbol;module.exports=Symbol2}}),require_getRawTag=__commonJS({"../../node_modules/lodash/_getRawTag.js"(exports,module){var Symbol2=require_Symbol(),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=Symbol2?Symbol2.toStringTag:void 0;module.exports=function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=void 0;var unmasked=!0}catch{}var result=nativeObjectToString.call(value);return unmasked&&(isOwn?value[symToStringTag]=tag:delete value[symToStringTag]),result}}}),require_objectToString=__commonJS({"../../node_modules/lodash/_objectToString.js"(exports,module){var nativeObjectToString=Object.prototype.toString;module.exports=function objectToString(value){return nativeObjectToString.call(value)}}}),require_baseGetTag=__commonJS({"../../node_modules/lodash/_baseGetTag.js"(exports,module){var Symbol2=require_Symbol(),getRawTag=require_getRawTag(),objectToString=require_objectToString(),symToStringTag=Symbol2?Symbol2.toStringTag:void 0;module.exports=function baseGetTag(value){return null==value?void 0===value?"[object Undefined]":"[object Null]":symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}}}),require_overArg=__commonJS({"../../node_modules/lodash/_overArg.js"(exports,module){module.exports=function overArg(func,transform){return function(arg){return func(transform(arg))}}}}),require_getPrototype=__commonJS({"../../node_modules/lodash/_getPrototype.js"(exports,module){var getPrototype=require_overArg()(Object.getPrototypeOf,Object);module.exports=getPrototype}}),require_isObjectLike=__commonJS({"../../node_modules/lodash/isObjectLike.js"(exports,module){module.exports=function isObjectLike(value){return null!=value&&"object"==typeof value}}}),require_isPlainObject=__commonJS({"../../node_modules/lodash/isPlainObject.js"(exports,module){var baseGetTag=require_baseGetTag(),getPrototype=require_getPrototype(),isObjectLike=require_isObjectLike(),funcProto=Function.prototype,objectProto=Object.prototype,funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectCtorString=funcToString.call(Object);module.exports=function isPlainObject2(value){if(!isObjectLike(value)||"[object Object]"!=baseGetTag(value))return!1;var proto=getPrototype(value);if(null===proto)return!0;var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}}}),chunk_NQZQ3SVL_has=Object.prototype.hasOwnProperty;function chunk_NQZQ3SVL_find(iter,tar,key){for(key of iter.keys())if(chunk_NQZQ3SVL_dequal(key,tar))return key}function chunk_NQZQ3SVL_dequal(foo,bar){var ctor,len,tmp;if(foo===bar)return!0;if(foo&&bar&&(ctor=foo.constructor)===bar.constructor){if(ctor===Date)return foo.getTime()===bar.getTime();if(ctor===RegExp)return foo.toString()===bar.toString();if(ctor===Array){if((len=foo.length)===bar.length)for(;len--&&chunk_NQZQ3SVL_dequal(foo[len],bar[len]););return-1===len}if(ctor===Set){if(foo.size!==bar.size)return!1;for(len of foo)if((tmp=len)&&"object"==typeof tmp&&!(tmp=chunk_NQZQ3SVL_find(bar,tmp))||!bar.has(tmp))return!1;return!0}if(ctor===Map){if(foo.size!==bar.size)return!1;for(len of foo)if((tmp=len[0])&&"object"==typeof tmp&&!(tmp=chunk_NQZQ3SVL_find(bar,tmp))||!chunk_NQZQ3SVL_dequal(len[1],bar.get(tmp)))return!1;return!0}if(ctor===ArrayBuffer)foo=new Uint8Array(foo),bar=new Uint8Array(bar);else if(ctor===DataView){if((len=foo.byteLength)===bar.byteLength)for(;len--&&foo.getInt8(len)===bar.getInt8(len););return-1===len}if(ArrayBuffer.isView(foo)){if((len=foo.byteLength)===bar.byteLength)for(;len--&&foo[len]===bar[len];);return-1===len}if(!ctor||"object"==typeof foo){for(ctor in len=0,foo)if(chunk_NQZQ3SVL_has.call(foo,ctor)&&++len&&!chunk_NQZQ3SVL_has.call(bar,ctor)||!(ctor in bar)||!chunk_NQZQ3SVL_dequal(foo[ctor],bar[ctor]))return!1;return Object.keys(bar).length===len}}return foo!=foo&&bar!=bar}var mod,isNodeMode,target,import_isPlainObject=(mod=require_isPlainObject(),target=null!=mod?__create(__getProtoOf(mod)):{},((to,from,except,desc)=>{if(from&&"object"==typeof from||"function"==typeof from)for(let key of __getOwnPropNames(from))!__hasOwnProp.call(to,key)&&key!==except&&__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to})(!isNodeMode&&mod&&mod.__esModule?target:__defProp(target,"default",{value:mod,enumerable:!0}),mod));function dedent(templ){for(var values=[],_i=1;_i<arguments.length;_i++)values[_i-1]=arguments[_i];var strings=Array.from("string"==typeof templ?[templ]:templ);strings[strings.length-1]=strings[strings.length-1].replace(/\r?\n([\t ]*)$/,"");var indentLengths=strings.reduce((function(arr,str){var matches=str.match(/\n([\t ]+|(?!\s).)/g);return matches?arr.concat(matches.map((function(match){var _a,_b;return null!==(_b=null===(_a=match.match(/[\t ]/g))||void 0===_a?void 0:_a.length)&&void 0!==_b?_b:0}))):arr}),[]);if(indentLengths.length){var pattern_1=new RegExp("\n[\t ]{"+Math.min.apply(Math,indentLengths)+"}","g");strings=strings.map((function(str){return str.replace(pattern_1,"\n")}))}strings[0]=strings[0].replace(/^\r?\n/,"");var string=strings[0];return values.forEach((function(value,i){var endentations=string.match(/(?:^|\n)( *)$/),endentation=endentations?endentations[1]:"",indentedValue=value;"string"==typeof value&&value.includes("\n")&&(indentedValue=String(value).split("\n").map((function(str,i2){return 0===i2?str:""+endentation+str})).join("\n")),string+=indentedValue+strings[i+1]})),string}var _,splitPathRegex=/\/([^/]+)\/(?:(.*)_)?([^/]+)?/,DEEPLY_EQUAL=(memoizerific_default()(1e3)((path=>{let result={viewMode:void 0,storyId:void 0,refId:void 0};if(path){let[,viewMode,refId,storyId]=path.toLowerCase().match(splitPathRegex)||[];viewMode&&Object.assign(result,{viewMode,storyId,refId})}return result})),Symbol("Deeply equal")),deepDiff=(value,update)=>{if(typeof value!=typeof update)return update;if(chunk_NQZQ3SVL_dequal(value,update))return DEEPLY_EQUAL;if(Array.isArray(value)&&Array.isArray(update)){let res=update.reduce(((acc,upd,index)=>{let diff=deepDiff(value[index],upd);return diff!==DEEPLY_EQUAL&&(acc[index]=diff),acc}),new Array(update.length));return update.length>=value.length?res:res.concat(new Array(value.length-update.length).fill(void 0))}return(0,import_isPlainObject.default)(value)&&(0,import_isPlainObject.default)(update)?Object.keys({...value,...update}).reduce(((acc,key)=>{let diff=deepDiff(value?.[key],update?.[key]);return diff===DEEPLY_EQUAL?acc:Object.assign(acc,{[key]:diff})}),{}):update},VALIDATION_REGEXP=/^[a-zA-Z0-9 _-]*$/,NUMBER_REGEXP=/^-?[0-9]+(\.[0-9]+)?$/,HEX_REGEXP=/^#([a-f0-9]{3,4}|[a-f0-9]{6}|[a-f0-9]{8})$/i,COLOR_REGEXP=/^(rgba?|hsla?)\(([0-9]{1,3}),\s?([0-9]{1,3})%?,\s?([0-9]{1,3})%?,?\s?([0-9](\.[0-9]{1,2})?)?\)$/i,validateArgs=(key="",value)=>!(null===key||""===key||!VALIDATION_REGEXP.test(key))&&(null==value||value instanceof Date||"number"==typeof value||"boolean"==typeof value||("string"==typeof value?VALIDATION_REGEXP.test(value)||NUMBER_REGEXP.test(value)||HEX_REGEXP.test(value)||COLOR_REGEXP.test(value):Array.isArray(value)?value.every((v=>validateArgs(key,v))):!!(0,import_isPlainObject.default)(value)&&Object.entries(value).every((([k,v])=>validateArgs(k,v))))),encodeSpecialValues=value=>void 0===value?"!undefined":null===value?"!null":"string"==typeof value?HEX_REGEXP.test(value)?`!hex(${value.slice(1)})`:COLOR_REGEXP.test(value)?`!${value.replace(/[\s%]/g,"")}`:value:"boolean"==typeof value?`!${value}`:Array.isArray(value)?value.map(encodeSpecialValues):(0,import_isPlainObject.default)(value)?Object.entries(value).reduce(((acc,[key,val])=>Object.assign(acc,{[key]:encodeSpecialValues(val)})),{}):value,QS_OPTIONS={encode:!1,delimiter:";",allowDots:!0,format:"RFC1738",serializeDate:date=>`!date(${date.toISOString()})`},buildArgsParam=(initialArgs,args)=>{let update=deepDiff(initialArgs,args);if(!update||update===DEEPLY_EQUAL)return"";let object=Object.entries(update).reduce(((acc,[key,value])=>validateArgs(key,value)?Object.assign(acc,{[key]:value}):(external_STORYBOOK_MODULE_CLIENT_LOGGER_.once.warn(dedent`
      Omitted potentially unsafe URL args.

      More info: https://storybook.js.org/docs/react/writing-stories/args#setting-args-through-the-url
    `),acc)),{});return lib_default().stringify(encodeSpecialValues(object),QS_OPTIONS).replace(/ /g,"+").split(";").map((part=>part.replace("=",":"))).join(";")},queryFromString=memoizerific_default()(1e3)((s=>void 0!==s?lib_default().parse(s,{ignoreQueryPrefix:!0}):{})),semver=(memoizerific_default()(1e3)(((current,target,startsWith=!0)=>{if(startsWith)return current&&current.startsWith(target)?{path:current}:null;let currentIsTarget="string"==typeof target&&current===target,matchTarget=current&&target&&current.match(target);return currentIsTarget||matchTarget?{path:current}:null})),__webpack_require__("./node_modules/semver/index.js")),semver_default=__webpack_require__.n(semver),external_STORYBOOK_MODULE_CHANNELS_=__webpack_require__("@storybook/channels"),dist_defProp=Object.defineProperty,__export=(target,all)=>{for(var name in all)dist_defProp(target,name,{get:all[name],enumerable:!0})};(_=store2_default()._).fn("set",(function(key,data){return _.set(this._area,this._in(key),(0,telejson_dist.Pz)(data,{maxDepth:50}))})),_.fn("get",(function(key,alt){let value=_.get(this._area,this._in(key));return null!==value?(0,telejson_dist.Qc)(value):alt||value}));var STORAGE_KEY="@storybook/manager/store";function get(storage){return storage.get(STORAGE_KEY)||{}}function update(storage,patch){return function set(storage,value){return storage.set(STORAGE_KEY,value)}(storage,{...get(storage),...patch})}var merge_default=(a,b)=>mergeWith_default()({},a,b,((objValue,srcValue)=>Array.isArray(srcValue)&&Array.isArray(objValue)?(srcValue.forEach((s=>{objValue.find((o=>o===s||isEqual_default()(o,s)))||objValue.push(s)})),objValue):Array.isArray(objValue)?(external_STORYBOOK_MODULE_CLIENT_LOGGER_.logger.log(["the types mismatch, picking",objValue]),objValue):void 0)),initial_state_default=(...additions)=>additions.reduce(((acc,item)=>merge_default(acc,item)),{}),provider_exports={};__export(provider_exports,{init:()=>init});var init=({provider,fullAPI})=>({api:provider.renderPreview?{renderPreview:provider.renderPreview}:{},state:{},init:()=>{provider.handleAPI(fullAPI)}}),addons_exports={};function ensurePanel(panels,selectedPanel,currentPanel){let keys2=Object.keys(panels);return keys2.indexOf(selectedPanel)>=0?selectedPanel:keys2.length?keys2[0]:currentPanel}__export(addons_exports,{ensurePanel:()=>ensurePanel,init:()=>init2});var init2=({provider,store:store2,fullAPI})=>{let api={getElements:type=>provider.getElements(type),getPanels:()=>api.getElements(Addon_TypesEnum.PANEL),getStoryPanels:()=>{let allPanels=api.getPanels(),{storyId}=store2.getState(),story=fullAPI.getData(storyId);if(!allPanels||!story||"story"!==story.type)return allPanels;let{parameters}=story,filteredPanels={};return Object.entries(allPanels).forEach((([id,panel])=>{let{paramKey}=panel;paramKey&&parameters&&parameters[paramKey]&&parameters[paramKey].disable||(filteredPanels[id]=panel)})),filteredPanels},getSelectedPanel:()=>{let{selectedPanel}=store2.getState();return ensurePanel(api.getPanels(),selectedPanel,selectedPanel)},setSelectedPanel:panelName=>{store2.setState({selectedPanel:panelName},{persistence:"session"})},setAddonState(addonId,newStateOrMerger,options){let nextState,{addons:existing}=store2.getState();return nextState="function"==typeof newStateOrMerger?newStateOrMerger(api.getAddonState(addonId)):newStateOrMerger,store2.setState({addons:{...existing,[addonId]:nextState}},options).then((()=>api.getAddonState(addonId)))},getAddonState:addonId=>store2.getState().addons[addonId]};return{api,state:{selectedPanel:ensurePanel(api.getPanels(),store2.getState().selectedPanel),addons:{}}}},channel_exports={};__export(channel_exports,{init:()=>init3});var init3=({provider})=>{let api={getChannel:()=>provider.channel,on:(type,cb)=>(provider.channel.addListener(type,cb),()=>provider.channel.removeListener(type,cb)),off:(type,cb)=>provider.channel.removeListener(type,cb),once:(type,cb)=>provider.channel.once(type,cb),emit:(type,data,...args)=>{data?.options?.target&&"storybook-preview-iframe"!==data.options.target&&!data.options.target.startsWith("storybook-ref-")&&(data.options.target="storybook_internal"!==data.options.target?`storybook-ref-${data.options.target}`:"storybook-preview-iframe"),provider.channel.emit(type,data,...args)},collapseAll:()=>{provider.channel.emit(external_STORYBOOK_MODULE_CORE_EVENTS_.STORIES_COLLAPSE_ALL,{})},expandAll:()=>{api.emit(external_STORYBOOK_MODULE_CORE_EVENTS_.STORIES_EXPAND_ALL)}};return{api,state:{}}},notifications_exports={};__export(notifications_exports,{init:()=>init4});var init4=({store:store2})=>{let api={addNotification:notification=>{api.clearNotification(notification.id);let{notifications}=store2.getState();store2.setState({notifications:[...notifications,notification]})},clearNotification:id=>{let{notifications}=store2.getState();store2.setState({notifications:notifications.filter((n=>n.id!==id))});let notification=notifications.find((n=>n.id===id));notification&&notification.onClear&&notification.onClear()}};return{api,state:{notifications:[]}}},settings_exports={};__export(settings_exports,{init:()=>init5});var init5=({store:store2,navigate,fullAPI})=>{let isSettingsScreenActive=()=>{let{path}=fullAPI.getUrlState();return!!(path||"").match(/^\/settings/)};return{state:{settings:{lastTrackedStoryId:null}},api:{closeSettings:()=>{let{settings:{lastTrackedStoryId}}=store2.getState();lastTrackedStoryId?fullAPI.selectStory(lastTrackedStoryId):fullAPI.selectFirstStory()},changeSettingsTab:tab=>{navigate(`/settings/${tab}`)},isSettingsScreenActive,navigateToSettingsPage:async path=>{if(!isSettingsScreenActive()){let{settings,storyId}=store2.getState();await store2.setState({settings:{...settings,lastTrackedStoryId:storyId}})}navigate(path)}}}},release_notes_exports={};__export(release_notes_exports,{init:()=>init6});var{RELEASE_NOTES_DATA}=dist.global,getReleaseNotesData=memoizerific_default()(1)((()=>{try{return{...JSON.parse(RELEASE_NOTES_DATA)||{}}}catch{return{}}})),init6=({store:store2})=>{let releaseNotesData=getReleaseNotesData(),getReleaseNotesViewed=()=>{let{releaseNotesViewed:persistedReleaseNotesViewed}=store2.getState();return persistedReleaseNotesViewed||[]};return{state:{releaseNotesViewed:[]},api:{releaseNotesVersion:()=>releaseNotesData.currentVersion,setDidViewReleaseNotes:()=>{let releaseNotesViewed=getReleaseNotesViewed();releaseNotesViewed.includes(releaseNotesData.currentVersion)||store2.setState({releaseNotesViewed:[...releaseNotesViewed,releaseNotesData.currentVersion]},{persistence:"permanent"})},showReleaseNotesOnLaunch:()=>{if(!releaseNotesData.currentVersion)return!1;let didViewReleaseNotes=getReleaseNotesViewed().includes(releaseNotesData.currentVersion);return releaseNotesData.showOnFirstLaunch&&!didViewReleaseNotes}}}},stories_exports={};__export(stories_exports,{init:()=>init8});var refs_exports={};__export(refs_exports,{defaultStoryMapper:()=>defaultStoryMapper,getSourceType:()=>getSourceType,init:()=>init7});var TITLE_PATH_SEPARATOR=/\s*\/\s*/,transformSetStoriesStoryDataToPreparedStoryIndex=stories=>({v:4,entries:Object.entries(stories).reduce(((acc,[id,story])=>{if(!story)return acc;let{docsOnly,fileName,...parameters}=story.parameters,base={title:story.kind,id,name:story.name,importPath:fileName};if(docsOnly)acc[id]={type:"docs",tags:["stories-mdx"],storiesImports:[],...base};else{let{argTypes,args,initialArgs}=story;acc[id]={type:"story",...base,parameters,argTypes,args,initialArgs}}return acc}),{})}),transformStoryIndexToStoriesHash=(input,{provider,docsOptions})=>{if(!input.v)throw new Error("Composition: Missing stories.json version");let index=input;index=2===index.v?(index=>({v:3,stories:Object.values(index.stories).reduce(((acc,entry)=>(acc[entry.id]={...entry,title:entry.kind,name:entry.name||entry.story,importPath:entry.parameters.fileName||""},acc)),{})}))(index):index,index=3===index.v?(index=>{let countByTitle=countBy_default()(Object.values(index.stories),"title");return{v:4,entries:Object.values(index.stories).reduce(((acc,entry)=>{let type="story";return(entry.parameters?.docsOnly||"Page"===entry.name&&1===countByTitle[entry.title])&&(type="docs"),acc[entry.id]={type,..."docs"===type&&{tags:["stories-mdx"],storiesImports:[]},...entry},delete acc[entry.id].story,delete acc[entry.id].kind,acc}),{})}})(index):index;let entryValues=Object.values(index.entries),{sidebar={}}=provider.getConfig(),{showRoots,collapsedRoots=[],renderLabel}=sidebar,setShowRoots=typeof showRoots<"u",storiesHashOutOfOrder=Object.values(entryValues).reduce(((acc,item)=>{if(docsOptions.docsMode&&"docs"!==item.type)return acc;let{title}=item,groups=title.trim().split(TITLE_PATH_SEPARATOR),root=(!setShowRoots||showRoots)&&groups.length>1?[groups.shift()]:[],names=[...root,...groups],paths=names.reduce(((list,name,idx)=>{let parent=idx>0&&list[idx-1],id=(0,csf_dist.Nw)(parent?`${parent}-${name}`:name);if(parent===id)throw new Error(esm.Z`
          Invalid part '${name}', leading to id === parentId ('${id}'), inside title '${title}'
          
          Did you create a path that uses the separator char accidentally, such as 'Vue <docs/>' where '/' is a separator char? See https://github.com/storybookjs/storybook/issues/6128
          `);return list.push(id),list}),[]);return paths.forEach(((id,idx)=>{let childId=paths[idx+1]||item.id;root.length&&0===idx?acc[id]=merge_default(acc[id]||{},{type:"root",id,name:names[idx],depth:idx,renderLabel,startCollapsed:collapsedRoots.includes(id),children:[childId],isRoot:!0,isComponent:!1,isLeaf:!1}):acc[id]&&"component"!==acc[id].type||idx!==paths.length-1?acc[id]=merge_default(acc[id]||{},{type:"group",id,name:names[idx],parent:paths[idx-1],depth:idx,renderLabel,...childId&&{children:[childId]},isRoot:!1,isComponent:!1,isLeaf:!1}):acc[id]=merge_default(acc[id]||{},{type:"component",id,name:names[idx],parent:paths[idx-1],depth:idx,renderLabel,...childId&&{children:[childId]},isRoot:!1,isComponent:!0,isLeaf:!1})})),acc[item.id]={type:"story",...item,depth:paths.length,parent:paths[paths.length-1],renderLabel,prepared:!!item.parameters,kind:item.title,isRoot:!1,isComponent:!1,isLeaf:!0},acc}),{});function addItem(acc,item){return acc[item.id]||(acc[item.id]=item,("root"===item.type||"group"===item.type||"component"===item.type)&&item.children.forEach((childId=>addItem(acc,storiesHashOutOfOrder[childId])))),acc}let orphanHash=Object.values(storiesHashOutOfOrder).filter((i=>"root"!==i.type&&!i.parent)).reduce(addItem,{});return Object.values(storiesHashOutOfOrder).filter((i=>"root"===i.type)).reduce(addItem,orphanHash)},addPreparedStories=(newHash,oldHash)=>oldHash?Object.fromEntries(Object.entries(newHash).map((([id,newEntry])=>{let oldEntry=oldHash[id];return"story"===newEntry.type&&"story"===oldEntry?.type&&oldEntry.prepared?[id,{...oldEntry,...newEntry,prepared:!0}]:[id,newEntry]}))):newHash,getComponentLookupList=memoizerific_default()(1)((hash=>Object.entries(hash).reduce(((acc,i)=>{let value=i[1];return"component"===value.type&&acc.push([...value.children]),acc}),[]))),getStoriesLookupList=memoizerific_default()(1)((hash=>Object.keys(hash).filter((k=>["story","docs"].includes(hash[k].type))))),{location:dist_location,fetch}=dist.global,findFilename=/(\/((?:[^\/]+?)\.[^\/]+?)|\/)$/,getSourceType=(source,refId)=>{let{origin:localOrigin,pathname:localPathname}=dist_location,{origin:sourceOrigin,pathname:sourcePathname}=new URL(source),localFull=`${localOrigin+localPathname}`.replace(findFilename,""),sourceFull=`${sourceOrigin+sourcePathname}`.replace(findFilename,"");return localFull===sourceFull?["local",sourceFull]:refId||source?["external",sourceFull]:[null,null]},defaultStoryMapper=(b,a)=>({...a,kind:a.kind.replace("|","/")});async function handleRequest(request){if(!request)return{};try{let response=await request;if(!1===response||!0===response)throw new Error("Unexpected boolean response");if(!response.ok)throw new Error(`Unexpected response not OK: ${response.statusText}`);let json=await response.json();return json.entries||json.stories?{storyIndex:json}:json}catch(err){return{indexError:err}}}var init7=({store:store2,provider,singleStory,docsOptions={}},{runCheck=!0}={})=>{let api={findRef:source=>{let refs2=api.getRefs();return Object.values(refs2).find((({url})=>url.match(source)))},changeRefVersion:(id,url)=>{let{versions,title}=api.getRefs()[id],ref={id,url,versions,title,index:{},expanded:!0};api.setRef(id,{...ref,type:"unknown"},!1),api.checkRef(ref)},changeRefState:(id,previewInitialized)=>{let{[id]:ref,...updated}=api.getRefs();updated[id]={...ref,previewInitialized},store2.setState({refs:updated})},checkRef:async ref=>{let{id,url,version:version2,type}=ref,isPublic="server-checked"===type,loadedData={},query=version2?`?version=${version2}`:"",credentials=isPublic?"omit":"include",urlParseResult=(url=>{let authorization,cleanUrl=url,[,credentials]=url.match(/https?:\/\/(.+:.+)@/)||[];return credentials&&(cleanUrl=url.replace(`${credentials}@`,""),authorization=btoa(`${credentials}`)),{url:cleanUrl,authorization}})(url),headers={Accept:"application/json"};urlParseResult.authorization&&Object.assign(headers,{Authorization:`Basic ${urlParseResult.authorization}`});let[indexResult,storiesResult]=await Promise.all(["index.json","stories.json"].map((async file=>handleRequest(fetch(`${urlParseResult.url}/${file}${query}`,{headers,credentials})))));if(indexResult.indexError&&storiesResult.indexError)isPublic||(loadedData.indexError={message:esm.Z`
            Error: Loading of ref failed
              at fetch (lib/api/src/modules/refs.ts)

            URL: ${urlParseResult.url}

            We weren't able to load the above URL,
            it's possible a CORS error happened.

            Please check your dev-tools network tab.
          `});else{let metadata=await handleRequest(fetch(`${urlParseResult.url}/metadata.json${query}`,{headers,credentials,cache:"no-cache"}).catch((()=>!1)));Object.assign(loadedData,{...indexResult.indexError?storiesResult:indexResult,...!metadata.indexError&&metadata})}let versions=ref.versions&&Object.keys(ref.versions).length?ref.versions:loadedData.versions;await api.setRef(id,{id,url:urlParseResult.url,...loadedData,...versions?{versions}:{},type:loadedData.storyIndex?"lazy":"auto-inject"})},getRefs:()=>{let{refs:refs2={}}=store2.getState();return refs2},setRef:(id,{storyIndex,setStoriesData,...rest},ready=!1)=>{if(singleStory)return;let index,{storyMapper=defaultStoryMapper}=provider.getConfig(),ref=api.getRefs()[id];setStoriesData?index=((data,{provider,docsOptions})=>transformStoryIndexToStoriesHash(transformSetStoriesStoryDataToPreparedStoryIndex(data),{provider,docsOptions}))(((input,ref,options)=>{let{storyMapper}=options;return storyMapper?Object.entries(input).reduce(((acc,[id,item])=>({...acc,[id]:storyMapper(ref,item)})),{}):input})(setStoriesData,ref,{storyMapper}),{provider,docsOptions}):storyIndex&&(index=transformStoryIndexToStoriesHash(storyIndex,{provider,docsOptions})),index&&(index=((input,ref)=>Object.entries(input).reduce(((acc,[id,item])=>({...acc,[id]:{...item,refId:ref.id}})),{}))(index,ref)),api.updateRef(id,{index,...rest})},updateRef:(id,data)=>{let{[id]:ref,...updated}=api.getRefs();updated[id]={...ref,...data};let ordered=Object.keys(initialState).reduce(((obj,key)=>(obj[key]=updated[key],obj)),{});store2.setState({refs:ordered})}},refs=!singleStory&&dist.global.REFS||{},initialState=refs;return runCheck&&Object.entries(refs).forEach((([id,ref])=>{api.checkRef({...ref,stories:{}})})),{api,state:{refs:initialState}}},getEventMetadata=(context,fullAPI)=>{let{source,refId,type}=context,[sourceType,sourceLocation]=getSourceType(source,refId),meta={source,sourceType,sourceLocation,refId,ref:refId&&fullAPI.getRefs()[refId]?fullAPI.getRefs()[refId]:fullAPI.findRef(sourceLocation),type};switch(!0){case"string"==typeof refId:case"local"===sourceType:case"external"===sourceType:return meta;default:return external_STORYBOOK_MODULE_CLIENT_LOGGER_.logger.warn(`Received a ${type} frame that was not configured as a ref`),null}},{FEATURES,fetch:fetch2}=dist.global,removedOptions=["enableShortcuts","theme","showRoots"];function removeRemovedOptions(options){if(!options||"string"==typeof options)return options;let result={...options};return removedOptions.forEach((option=>{option in result&&delete result[option]})),result}var init8=({fullAPI,store:store2,navigate,provider,storyId:initialStoryId,viewMode:initialViewMode,docsOptions={}})=>{let api={storyId:csf_dist.KK,getData:(storyId,refId)=>{let result=api.resolveStory(storyId,refId);if("story"===result?.type||"docs"===result?.type)return result},isPrepared:(storyId,refId)=>{let data=api.getData(storyId,refId);return"story"!==data.type||data.prepared},resolveStory:(storyId,refId)=>{let{refs,index}=store2.getState();return refId&&!refs[refId]?null:refId?refs[refId].index?refs[refId].index[storyId]:void 0:index?index[storyId]:void 0},getCurrentStoryData:()=>{let{storyId,refId}=store2.getState();return api.getData(storyId,refId)},getParameters:(storyIdOrCombo,parameterName)=>{let{storyId,refId}="string"==typeof storyIdOrCombo?{storyId:storyIdOrCombo,refId:void 0}:storyIdOrCombo,data=api.getData(storyId,refId);if(["story","docs"].includes(data?.type)){let{parameters}=data;if(parameters)return parameterName?parameters[parameterName]:parameters}return null},getCurrentParameter:parameterName=>{let{storyId,refId}=store2.getState();return api.getParameters({storyId,refId},parameterName)||void 0},jumpToComponent:direction=>{let{index,storyId,refs,refId}=store2.getState();if(!api.getData(storyId,refId))return;let hash=refId?refs[refId].index||{}:index,result=api.findSiblingStoryId(storyId,hash,direction,!0);result&&api.selectStory(result,void 0,{ref:refId})},jumpToStory:direction=>{let{index,storyId,refs,refId}=store2.getState(),story=api.getData(storyId,refId);if(!story)return;let hash=story.refId?refs[story.refId].index:index,result=api.findSiblingStoryId(storyId,hash,direction,!1);result&&api.selectStory(result,void 0,{ref:refId})},selectFirstStory:()=>{let{index}=store2.getState(),firstStory=Object.keys(index).find((id=>"story"===index[id].type));firstStory?api.selectStory(firstStory):navigate("/")},selectStory:(titleOrId=void 0,name=void 0,options={})=>{let{ref}=options,{storyId,index,refs}=store2.getState(),hash=ref?refs[ref].index:index,kindSlug=storyId?.split("--",2)[0];if(name)if(titleOrId){let id=ref?`${ref}_${(0,csf_dist.KK)(titleOrId,name)}`:(0,csf_dist.KK)(titleOrId,name);if(hash[id])api.selectStory(id,void 0,options);else{let entry=hash[(0,csf_dist.Nw)(titleOrId)];if("component"===entry?.type){let foundId=entry.children.find((childId=>hash[childId].name===name));foundId&&api.selectStory(foundId,void 0,options)}}}else{let id=(0,csf_dist.KK)(kindSlug,name);api.selectStory(id,void 0,options)}else{let entry=titleOrId?hash[titleOrId]||hash[(0,csf_dist.Nw)(titleOrId)]:hash[kindSlug];if(!entry)throw new Error(`Unknown id or title: '${titleOrId}'`);let leafEntry=api.findLeafEntry(hash,entry.id),fullId=leafEntry.refId?`${leafEntry.refId}_${leafEntry.id}`:leafEntry.id;navigate(`/${leafEntry.type}/${fullId}`)}},findLeafEntry(index,storyId){let entry=index[storyId];if("docs"===entry.type||"story"===entry.type)return entry;let childStoryId=entry.children[0];return api.findLeafEntry(index,childStoryId)},findLeafStoryId:(index,storyId)=>api.findLeafEntry(index,storyId)?.id,findSiblingStoryId(storyId,index,direction,toSiblingGroup){if(toSiblingGroup){let lookupList2=getComponentLookupList(index),position2=lookupList2.findIndex((i=>i.includes(storyId)));return position2===lookupList2.length-1&&direction>0||0===position2&&direction<0?void 0:lookupList2[position2+direction]?lookupList2[position2+direction][0]:void 0}let lookupList=getStoriesLookupList(index),position=lookupList.indexOf(storyId);if(!(position===lookupList.length-1&&direction>0||0===position&&direction<0))return lookupList[position+direction]},updateStoryArgs:(story,updatedArgs)=>{let{id:storyId,refId}=story;fullAPI.emit(external_STORYBOOK_MODULE_CORE_EVENTS_.UPDATE_STORY_ARGS,{storyId,updatedArgs,options:{target:refId}})},resetStoryArgs:(story,argNames)=>{let{id:storyId,refId}=story;fullAPI.emit(external_STORYBOOK_MODULE_CORE_EVENTS_.RESET_STORY_ARGS,{storyId,argNames,options:{target:refId}})},fetchIndex:async()=>{try{let result=await fetch2("./index.json");if(200!==result.status)throw new Error(await result.text());let storyIndex=await result.json();if(storyIndex.v<3)return void external_STORYBOOK_MODULE_CLIENT_LOGGER_.logger.warn(`Skipping story index with version v${storyIndex.v}, awaiting SET_STORIES.`);await fullAPI.setIndex(storyIndex)}catch(err){await store2.setState({indexError:err})}},setIndex:async storyIndex=>{let newHash=transformStoryIndexToStoriesHash(storyIndex,{provider,docsOptions}),oldHash=store2.getState().index;await store2.setState({index:addPreparedStories(newHash,oldHash),indexError:void 0})},updateStory:async(storyId,update2,ref)=>{if(ref){let{id:refId,index}=ref;index[storyId]={...index[storyId],...update2},await fullAPI.updateRef(refId,{index})}else{let{index}=store2.getState();index[storyId]={...index[storyId],...update2},await store2.setState({index})}},updateDocs:async(docsId,update2,ref)=>{if(ref){let{id:refId,index}=ref;index[docsId]={...index[docsId],...update2},await fullAPI.updateRef(refId,{index})}else{let{index}=store2.getState();index[docsId]={...index[docsId],...update2},await store2.setState({index})}},setPreviewInitialized:async ref=>{ref?fullAPI.updateRef(ref.id,{previewInitialized:!0}):store2.setState({previewInitialized:!0})}};return{api,state:{storyId:initialStoryId,viewMode:initialViewMode,hasCalledSetOptions:!1,previewInitialized:!1},init:async()=>{fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.STORY_SPECIFIED,(function({storyId,viewMode}){let{sourceType}=getEventMetadata(this,fullAPI);if("local"===sourceType){if(fullAPI.isSettingsScreenActive())return;let state=store2.getState();(state.storyId!==storyId||state.viewMode!==viewMode)&&navigate(`/${viewMode}/${storyId}`)}})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.CURRENT_STORY_WAS_SET,(function(){let{ref}=getEventMetadata(this,fullAPI);fullAPI.setPreviewInitialized(ref)})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.STORY_CHANGED,(function(){let{sourceType}=getEventMetadata(this,fullAPI);if("local"===sourceType){let options=fullAPI.getCurrentParameter("options");options&&fullAPI.setOptions(removeRemovedOptions(options))}})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.STORY_PREPARED,(function({id,...update2}){let{ref,sourceType}=getEventMetadata(this,fullAPI);if(fullAPI.updateStory(id,{...update2,prepared:!0},ref),!ref&&!store2.getState().hasCalledSetOptions){let{options}=update2.parameters;fullAPI.setOptions(removeRemovedOptions(options)),store2.setState({hasCalledSetOptions:!0})}if("local"===sourceType){let{storyId,index,refId}=store2.getState(),toBePreloaded=Array.from(new Set([api.findSiblingStoryId(storyId,index,1,!0),api.findSiblingStoryId(storyId,index,-1,!0)])).filter(Boolean);fullAPI.emit(external_STORYBOOK_MODULE_CORE_EVENTS_.PRELOAD_ENTRIES,{ids:toBePreloaded,options:{target:refId}})}})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.DOCS_PREPARED,(function({id,...update2}){let{ref}=getEventMetadata(this,fullAPI);fullAPI.updateStory(id,{...update2,prepared:!0},ref)})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.SET_INDEX,(function(index){let{ref}=getEventMetadata(this,fullAPI);if(ref)fullAPI.setRef(ref.id,{...ref,storyIndex:index},!0);else{fullAPI.setIndex(index);let options=fullAPI.getCurrentParameter("options");fullAPI.setOptions(removeRemovedOptions(options))}})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.SET_STORIES,(function(data){let{ref}=getEventMetadata(this,fullAPI),setStoriesData=data.v?(({globalParameters,kindParameters,stories})=>mapValues_default()(stories,(storyData=>({...storyData,parameters:combineParameters(globalParameters,kindParameters[storyData.kind],storyData.parameters)}))))(data):data.stories;if(!ref)throw new Error("Cannot call SET_STORIES for local frame");fullAPI.setRef(ref.id,{...ref,setStoriesData},!0)})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.SELECT_STORY,(function({kind,title=kind,story,name=story,storyId,...rest}){let{ref}=getEventMetadata(this,fullAPI);ref?fullAPI.selectStory(storyId||title,name,{...rest,ref:ref.id}):fullAPI.selectStory(storyId||title,name,rest)})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.STORY_ARGS_UPDATED,(function({storyId,args}){let{ref}=getEventMetadata(this,fullAPI);fullAPI.updateStory(storyId,{args},ref)})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.CONFIG_ERROR,(function(err){let{ref}=getEventMetadata(this,fullAPI);fullAPI.setPreviewInitialized(ref)})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.STORY_MISSING,(function(err){let{ref}=getEventMetadata(this,fullAPI);fullAPI.setPreviewInitialized(ref)})),FEATURES?.storyStoreV7&&(provider.serverChannel?.on(external_STORYBOOK_MODULE_CORE_EVENTS_.STORY_INDEX_INVALIDATED,(()=>fullAPI.fetchIndex())),await fullAPI.fetchIndex())}}},layout_exports={};__export(layout_exports,{ActiveTabs:()=>ActiveTabs,focusableUIElements:()=>focusableUIElements,init:()=>init9});var{document:dist_document}=dist.global,ActiveTabs={SIDEBAR:"sidebar",CANVAS:"canvas",ADDONS:"addons"},defaultState={ui:{enableShortcuts:!0},layout:{initialActive:ActiveTabs.CANVAS,showToolbar:!0,isFullscreen:!1,showPanel:!0,showNav:!0,panelPosition:"bottom",showTabs:!0},selectedPanel:void 0,theme:(0,chunk_4NMOSTKD.Ue)()},focusableUIElements={storySearchField:"storybook-explorer-searchfield",storyListMenu:"storybook-explorer-menu",storyPanelRoot:"storybook-panel-root"},init9=({store:store2,provider,singleStory,fullAPI})=>{let api={toggleFullscreen:toggled=>store2.setState((state=>{let{showNav}=state.layout,value="boolean"==typeof toggled?toggled:!state.layout.isFullscreen,shouldShowNav=!1===showNav&&!1===value;return{layout:{...state.layout,isFullscreen:value,showNav:!(singleStory||!shouldShowNav)||showNav}}}),{persistence:"session"}),togglePanel:toggled=>store2.setState((state=>{let{showNav,isFullscreen}=state.layout,value=typeof toggled<"u"?toggled:!state.layout.showPanel,shouldToggleFullScreen=!1===showNav&&!1===value;return{layout:{...state.layout,showPanel:value,isFullscreen:!!shouldToggleFullScreen||isFullscreen}}}),{persistence:"session"}),togglePanelPosition:position=>typeof position<"u"?store2.setState((state=>({layout:{...state.layout,panelPosition:position}})),{persistence:"permanent"}):store2.setState((state=>({layout:{...state.layout,panelPosition:"right"===state.layout.panelPosition?"bottom":"right"}})),{persistence:"permanent"}),toggleNav:toggled=>store2.setState((state=>{if(singleStory)return{layout:state.layout};let{showPanel,isFullscreen}=state.layout,showNav=typeof toggled<"u"?toggled:!state.layout.showNav,shouldToggleFullScreen=!1===showPanel&&!1===showNav;return{layout:{...state.layout,showNav,isFullscreen:!!shouldToggleFullScreen||!showNav&&isFullscreen}}}),{persistence:"session"}),toggleToolbar:toggled=>store2.setState((state=>{let value=typeof toggled<"u"?toggled:!state.layout.showToolbar;return{layout:{...state.layout,showToolbar:value}}}),{persistence:"session"}),resetLayout:()=>store2.setState((state=>({layout:{...state.layout,showNav:!1,showPanel:!1,isFullscreen:!1}})),{persistence:"session"}),focusOnUIElement(elementId,select){if(!elementId)return;let element=dist_document.getElementById(elementId);element&&(element.focus(),select&&element.select())},getInitialOptions(){let{theme,selectedPanel,...options}=provider.getConfig();return{...defaultState,layout:{...defaultState.layout,...pick_default()(options,Object.keys(defaultState.layout)),...singleStory&&{showNav:!1}},ui:{...defaultState.ui,...pick_default()(options,Object.keys(defaultState.ui))},selectedPanel:selectedPanel||defaultState.selectedPanel,theme:theme||defaultState.theme}},setOptions:options=>{let{layout,ui,selectedPanel,theme}=store2.getState();if(options){let updatedLayout={...layout,...options.layout,...pick_default()(options,Object.keys(layout)),...singleStory&&{showNav:!1}},updatedUi={...ui,...options.ui,...pick_default()(options,Object.keys(ui))},updatedTheme={...theme,...options.theme},modification={};dequal(ui,updatedUi)||(modification.ui=updatedUi),dequal(layout,updatedLayout)||(modification.layout=updatedLayout),options.selectedPanel&&!dequal(selectedPanel,options.selectedPanel)&&(modification.selectedPanel=options.selectedPanel),Object.keys(modification).length&&store2.setState(modification,{persistence:"permanent"}),dequal(theme,updatedTheme)||store2.setState({theme:updatedTheme})}}},persisted=pick_default()(store2.getState(),"layout","selectedPanel");return{api,state:merge_default(api.getInitialOptions(),persisted),init:()=>{api.setOptions(merge_default(api.getInitialOptions(),persisted)),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.SET_CONFIG,(()=>{api.setOptions(merge_default(api.getInitialOptions(),persisted))}))}}},shortcuts_exports={};__export(shortcuts_exports,{controlOrMetaKey:()=>controlOrMetaKey2,defaultShortcuts:()=>defaultShortcuts,init:()=>init10,isMacLike:()=>isMacLike2,keys:()=>keys});var{navigator:dist_navigator}=dist.global,eventToShortcut=e=>{if(["Meta","Alt","Control","Shift"].includes(e.key))return null;let keys2=[];if(e.altKey&&keys2.push("alt"),e.ctrlKey&&keys2.push("control"),e.metaKey&&keys2.push("meta"),e.shiftKey&&keys2.push("shift"),e.key&&1===e.key.length&&" "!==e.key){let key=e.key.toUpperCase(),code=e.code?.toUpperCase().replace("KEY","").replace("DIGIT","");code&&1===code.length&&code!==key?keys2.push([key,code]):keys2.push(key)}return" "===e.key&&keys2.push("space"),"Escape"===e.key&&keys2.push("escape"),"ArrowRight"===e.key&&keys2.push("ArrowRight"),"ArrowDown"===e.key&&keys2.push("ArrowDown"),"ArrowUp"===e.key&&keys2.push("ArrowUp"),"ArrowLeft"===e.key&&keys2.push("ArrowLeft"),keys2.length>0?keys2:null},shortcutMatchesShortcut=(inputShortcut,shortcut)=>!(!inputShortcut||!shortcut||(inputShortcut.join("").startsWith("shift/")&&inputShortcut.shift(),inputShortcut.length!==shortcut.length))&&!inputShortcut.find(((input,i)=>Array.isArray(input)?!input.includes(shortcut[i]):input!==shortcut[i])),{navigator:navigator2,document:document2}=dist.global,isMacLike2=()=>!(!navigator2||!navigator2.platform)&&!!navigator2.platform.match(/(Mac|iPhone|iPod|iPad)/i),controlOrMetaKey2=()=>isMacLike2()?"meta":"control";function keys(o){return Object.keys(o)}var defaultShortcuts=Object.freeze({fullScreen:["F"],togglePanel:["A"],panelPosition:["D"],toggleNav:["S"],toolbar:["T"],search:["/"],focusNav:["1"],focusIframe:["2"],focusPanel:["3"],prevComponent:["alt","ArrowUp"],nextComponent:["alt","ArrowDown"],prevStory:["alt","ArrowLeft"],nextStory:["alt","ArrowRight"],shortcutsPage:[controlOrMetaKey2(),"shift",","],aboutPage:[","],escape:["escape"],collapseAll:[controlOrMetaKey2(),"shift","ArrowUp"],expandAll:[controlOrMetaKey2(),"shift","ArrowDown"],remount:["alt","R"]}),addonsShortcuts={};var init10=({store:store2,fullAPI})=>{let api={getShortcutKeys:()=>store2.getState().shortcuts,getDefaultShortcuts:()=>({...defaultShortcuts,...api.getAddonsShortcutDefaults()}),getAddonsShortcuts:()=>addonsShortcuts,getAddonsShortcutLabels(){let labels={};return Object.entries(api.getAddonsShortcuts()).forEach((([actionName,{label}])=>{labels[actionName]=label})),labels},getAddonsShortcutDefaults(){let defaults={};return Object.entries(api.getAddonsShortcuts()).forEach((([actionName,{defaultShortcut}])=>{defaults[actionName]=defaultShortcut})),defaults},setShortcuts:async shortcuts=>(await store2.setState({shortcuts},{persistence:"permanent"}),shortcuts),restoreAllDefaultShortcuts:async()=>api.setShortcuts(api.getDefaultShortcuts()),async setShortcut(action,value){let shortcuts=api.getShortcutKeys();return await api.setShortcuts({...shortcuts,[action]:value}),value},async setAddonShortcut(addon,shortcut){let shortcuts=api.getShortcutKeys();return await api.setShortcuts({...shortcuts,[`${addon}-${shortcut.actionName}`]:shortcut.defaultShortcut}),addonsShortcuts[`${addon}-${shortcut.actionName}`]=shortcut,shortcut},async restoreDefaultShortcut(action){let defaultShortcut=api.getDefaultShortcuts()[action];return api.setShortcut(action,defaultShortcut)},handleKeydownEvent(event){let shortcut=eventToShortcut(event),shortcuts=api.getShortcutKeys(),matchedFeature=keys(shortcuts).find((feature=>shortcutMatchesShortcut(shortcut,shortcuts[feature])));matchedFeature&&(event?.preventDefault&&event.preventDefault(),api.handleShortcutFeature(matchedFeature))},handleShortcutFeature(feature){let{layout:{isFullscreen,showNav,showPanel},ui:{enableShortcuts},storyId}=store2.getState();if(enableShortcuts)switch(feature){case"escape":isFullscreen?fullAPI.toggleFullscreen():showNav||fullAPI.toggleNav();break;case"focusNav":isFullscreen&&fullAPI.toggleFullscreen(),showNav||fullAPI.toggleNav(),fullAPI.focusOnUIElement(focusableUIElements.storyListMenu);break;case"search":isFullscreen&&fullAPI.toggleFullscreen(),showNav||fullAPI.toggleNav(),setTimeout((()=>{fullAPI.focusOnUIElement(focusableUIElements.storySearchField,!0)}),0);break;case"focusIframe":{let element=document2.getElementById("storybook-preview-iframe");if(element)try{element.contentWindow.focus()}catch{}break}case"focusPanel":isFullscreen&&fullAPI.toggleFullscreen(),showPanel||fullAPI.togglePanel(),fullAPI.focusOnUIElement(focusableUIElements.storyPanelRoot);break;case"nextStory":fullAPI.jumpToStory(1);break;case"prevStory":fullAPI.jumpToStory(-1);break;case"nextComponent":fullAPI.jumpToComponent(1);break;case"prevComponent":fullAPI.jumpToComponent(-1);break;case"fullScreen":fullAPI.toggleFullscreen();break;case"togglePanel":isFullscreen&&(fullAPI.toggleFullscreen(),fullAPI.resetLayout()),fullAPI.togglePanel();break;case"toggleNav":isFullscreen&&(fullAPI.toggleFullscreen(),fullAPI.resetLayout()),fullAPI.toggleNav();break;case"toolbar":fullAPI.toggleToolbar();break;case"panelPosition":isFullscreen&&fullAPI.toggleFullscreen(),showPanel||fullAPI.togglePanel(),fullAPI.togglePanelPosition();break;case"aboutPage":fullAPI.navigate("/settings/about");break;case"shortcutsPage":fullAPI.navigate("/settings/shortcuts");break;case"collapseAll":fullAPI.collapseAll();break;case"expandAll":fullAPI.expandAll();break;case"remount":fullAPI.emit(external_STORYBOOK_MODULE_CORE_EVENTS_.FORCE_REMOUNT,{storyId});break;default:addonsShortcuts[feature].action()}}},{shortcuts:persistedShortcuts=defaultShortcuts}=store2.getState(),state={shortcuts:keys(defaultShortcuts).reduce(((acc,key)=>({...acc,[key]:persistedShortcuts[key]||defaultShortcuts[key]})),defaultShortcuts)};return{api,state,init:()=>{document2.addEventListener("keydown",(event=>{(function focusInInput(event){let target=event.target;return/input|textarea/i.test(target.tagName)||null!==target.getAttribute("contenteditable")})(event)||fullAPI.handleKeydownEvent(event)})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.PREVIEW_KEYDOWN,(data=>{fullAPI.handleKeydownEvent(data.event)}))}}},url_exports={};__export(url_exports,{init:()=>init11});var prevParams,{window:globalWindow}=dist.global,parseBoolean=value=>"true"===value||"1"===value||"false"!==value&&"0"!==value&&void 0,initialUrlSupport=({state:{location:location2,path,viewMode,storyId:storyIdFromUrl},singleStory})=>{let{full,panel,nav,shortcuts,addonPanel,tabs,path:queryPath,...otherParams}=(location=>queryFromString(location.search))(location2),layout={isFullscreen:parseBoolean(full),showNav:!singleStory&&parseBoolean(nav),showPanel:parseBoolean(panel),panelPosition:["right","bottom"].includes(panel)?panel:void 0,showTabs:parseBoolean(tabs)},ui={enableShortcuts:parseBoolean(shortcuts)},selectedPanel=addonPanel||void 0,storyId=storyIdFromUrl,customQueryParams=dequal(prevParams,otherParams)?prevParams:otherParams;return prevParams=customQueryParams,{viewMode,layout,ui,selectedPanel,location:location2,path,customQueryParams,storyId}},init11=({store:store2,navigate,state,provider,fullAPI,...rest})=>{let navigateTo=(path,queryParams={},options={})=>{let to=[path,...Object.entries(queryParams).filter((([,v])=>v)).sort((([a],[b])=>a<b?-1:1)).map((([k,v])=>`${k}=${v}`))].join("&");return navigate(to,options)},api={getQueryParam(key){let{customQueryParams}=store2.getState();return customQueryParams?customQueryParams[key]:void 0},getUrlState(){let{path,customQueryParams,storyId,url,viewMode}=store2.getState();return{path,queryParams:customQueryParams,storyId,url,viewMode}},setQueryParams(input){let{customQueryParams}=store2.getState(),update2={...customQueryParams,...Object.entries(input).reduce(((acc,[key,value])=>(null!==value&&(acc[key]=value),acc)),{})};dequal(customQueryParams,update2)||(store2.setState({customQueryParams:update2}),fullAPI.emit(external_STORYBOOK_MODULE_CORE_EVENTS_.UPDATE_QUERY_PARAMS,update2))},navigateUrl(url,options){navigate(url,{...options,plain:!0})}};return{api,state:initialUrlSupport({store:store2,navigate,state,provider,fullAPI,...rest}),init:()=>{let handleOrId,updateArgsParam=()=>{let{path,queryParams,viewMode}=fullAPI.getUrlState();if("story"!==viewMode)return;let currentStory=fullAPI.getCurrentStoryData();if("story"!==currentStory?.type)return;let{args,initialArgs}=currentStory,argsString=buildArgsParam(initialArgs,args);navigateTo(path,{...queryParams,args:argsString},{replace:!0}),api.setQueryParams({args:argsString})};fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.SET_CURRENT_STORY,(()=>updateArgsParam())),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.STORY_ARGS_UPDATED,(()=>{"requestIdleCallback"in globalWindow?(handleOrId&&globalWindow.cancelIdleCallback(handleOrId),handleOrId=globalWindow.requestIdleCallback(updateArgsParam,{timeout:1e3})):(handleOrId&&clearTimeout(handleOrId),setTimeout(updateArgsParam,100))})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.GLOBALS_UPDATED,(({globals,initialGlobals})=>{let{path,queryParams}=fullAPI.getUrlState(),globalsString=buildArgsParam(initialGlobals,globals);navigateTo(path,{...queryParams,globals:globalsString},{replace:!0}),api.setQueryParams({globals:globalsString})})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.NAVIGATE_URL,((url,options)=>{fullAPI.navigateUrl(url,options)})),fullAPI.showReleaseNotesOnLaunch()&&navigate("/settings/release-notes")}}},versions_exports={};__export(versions_exports,{init:()=>init12});var{VERSIONCHECK}=dist.global,getVersionCheckData=memoizerific_default()(1)((()=>{try{return{...JSON.parse(VERSIONCHECK).data||{}}}catch{return{}}})),init12=({store:store2,mode,fullAPI})=>{let{dismissedVersionNotification}=store2.getState(),state={versions:{current:{version:"7.0.22"},...getVersionCheckData()},dismissedVersionNotification},api={getCurrentVersion:()=>{let{versions:{current}}=store2.getState();return current},getLatestVersion:()=>{let{versions:{latest,next,current}}=store2.getState();return current&&semver_default().prerelease(current.version)&&next?latest&&semver_default().gt(latest.version,next.version)?latest:next:latest},versionUpdateAvailable:()=>{let latest=api.getLatestVersion(),current=api.getCurrentVersion();if(latest){if(!latest.version||!current.version)return!0;let actualCurrent=semver_default().prerelease(current.version)?`${semver_default().major(current.version)}.${semver_default().minor(current.version)}.${semver_default().patch(current.version)}`:current.version,diff=semver_default().diff(actualCurrent,latest.version);return semver_default().gt(latest.version,actualCurrent)&&"patch"!==diff&&!diff.includes("pre")}return!1}};return{init:async()=>{let{versions={}}=store2.getState(),{latest,next}=getVersionCheckData();if(await store2.setState({versions:{...versions,latest,next}}),api.versionUpdateAvailable()){let latestVersion=api.getLatestVersion().version,diff=semver_default().diff(versions.current.version,versions.latest.version);latestVersion!==dismissedVersionNotification&&"patch"!==diff&&!semver_default().prerelease(latestVersion)&&"production"!==mode&&fullAPI.addNotification({id:"update",link:"/settings/about",content:{headline:`Storybook ${latestVersion} is available!`,subHeadline:`Your current version is: ${versions.current.version}`},icon:{name:"book"},onClear(){store2.setState({dismissedVersionNotification:latestVersion},{persistence:"permanent"})}})}},state,api}},globals_exports={};__export(globals_exports,{init:()=>init13});var init13=({store:store2,fullAPI})=>{let api={getGlobals:()=>store2.getState().globals,getGlobalTypes:()=>store2.getState().globalTypes,updateGlobals(newGlobals){fullAPI.emit(external_STORYBOOK_MODULE_CORE_EVENTS_.UPDATE_GLOBALS,{globals:newGlobals,options:{target:"storybook-preview-iframe"}})}};return{api,state:{globals:{},globalTypes:{}},init:()=>{fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.GLOBALS_UPDATED,(function({globals}){let{ref}=getEventMetadata(this,fullAPI);ref?external_STORYBOOK_MODULE_CLIENT_LOGGER_.logger.warn("received a GLOBALS_UPDATED from a non-local ref. This is not currently supported."):(globals=>{let currentGlobals=store2.getState()?.globals;dequal(globals,currentGlobals)||store2.setState({globals})})(globals)})),fullAPI.on(external_STORYBOOK_MODULE_CORE_EVENTS_.SET_GLOBALS,(function({globals,globalTypes}){let{ref}=getEventMetadata(this,fullAPI),currentGlobals=store2.getState()?.globals;ref?Object.keys(globals).length>0&&external_STORYBOOK_MODULE_CLIENT_LOGGER_.logger.warn("received globals from a non-local ref. This is not currently supported."):store2.setState({globals,globalTypes}),currentGlobals&&0!==Object.keys(currentGlobals).length&&!dequal(globals,currentGlobals)&&api.updateGlobals(currentGlobals)}))}}};var KEY="__STORYBOOK_ADDONS_MANAGER";(function getAddonsStore(){return dist.global[KEY]||(dist.global[KEY]=new class{constructor(){this.loaders={},this.elements={},this.config={},this.getChannel=()=>(this.channel||this.setChannel(function mockChannel(){return new external_STORYBOOK_MODULE_CHANNELS_.Channel({transport:{setHandler:()=>{},send:()=>{}}})}()),this.channel),this.getServerChannel=()=>{if(!this.serverChannel)throw new Error("Accessing non-existent serverChannel");return this.serverChannel},this.ready=()=>this.promise,this.hasChannel=()=>!!this.channel,this.hasServerChannel=()=>!!this.serverChannel,this.setChannel=channel=>{this.channel=channel,this.resolve()},this.setServerChannel=channel=>{this.serverChannel=channel},this.getElements=type=>(this.elements[type]||(this.elements[type]={}),this.elements[type]),this.addPanel=(name,options)=>{this.add(name,{type:Addon_TypesEnum.PANEL,...options})},this.add=(name,addon)=>{let{type}=addon;this.getElements(type)[name]={id:name,...addon}},this.setConfig=value=>{Object.assign(this.config,value),this.hasChannel()?this.getChannel().emit(external_STORYBOOK_MODULE_CORE_EVENTS_.SET_CONFIG,this.config):this.ready().then((channel=>{channel.emit(external_STORYBOOK_MODULE_CORE_EVENTS_.SET_CONFIG,this.config)}))},this.getConfig=()=>this.config,this.register=(name,registerCallback)=>{this.loaders[name]&&external_STORYBOOK_MODULE_CLIENT_LOGGER_.logger.warn(`${name} was loaded twice, this could have bad side-effects`),this.loaders[name]=registerCallback},this.loadAddons=api=>{Object.values(this.loaders).forEach((value=>value(api)))},this.promise=new Promise((res=>{this.resolve=()=>res(this.getChannel())}))}}),dist.global[KEY]})();var{ActiveTabs:ActiveTabs2}=layout_exports,ManagerContext=(({api,state})=>(0,react.createContext)({api,state}))({api:void 0,state:initial_state_default({})}),combineParameters=(...parameterSets)=>mergeWith_default()({},...parameterSets,((objValue,srcValue)=>{if(Array.isArray(srcValue))return srcValue})),ManagerProvider=class extends react.Component{constructor(props){super(props),this.api={},this.initModules=()=>{this.modules.forEach((module=>{"init"in module&&module.init()}))};let{location:location2,path,refId,viewMode=props.docsOptions.docsMode?"docs":"story",singleStory,storyId,docsOptions,navigate}=props,store2=new class{constructor({setState,getState}){this.upstreamSetState=setState,this.upstreamGetState=getState}getInitialState(base){return{...base,...get(store2_default().local),...get(store2_default().session)}}getState(){return this.upstreamGetState()}async setState(inputPatch,cbOrOptions,inputOptions){let callback,options;"function"==typeof cbOrOptions?(callback=cbOrOptions,options=inputOptions):options=cbOrOptions;let{persistence="none"}=options||{},patch={},delta={};"function"==typeof inputPatch?patch=state=>(delta=inputPatch(state),delta):(patch=inputPatch,delta=patch);let newState=await new Promise((resolve=>{this.upstreamSetState(patch,resolve)}));if("none"!==persistence){let storage="session"===persistence?store2_default().session:store2_default().local;await update(storage,delta)}return callback&&callback(newState),newState}}({getState:()=>this.state,setState:(stateChange,callback)=>this.setState(stateChange,callback)}),routeData={location:location2,path,viewMode,singleStory,storyId,refId},optionsData={docsOptions};this.state=store2.getInitialState(initial_state_default({...routeData,...optionsData}));let apiData={navigate,store:store2,provider:props.provider};this.modules=[provider_exports,channel_exports,addons_exports,layout_exports,notifications_exports,settings_exports,release_notes_exports,shortcuts_exports,stories_exports,refs_exports,globals_exports,url_exports,versions_exports].map((m=>m.init({...routeData,...optionsData,...apiData,state:this.state,fullAPI:this.api})));let state=initial_state_default(this.state,...this.modules.map((m=>m.state))),api=Object.assign(this.api,{navigate},...this.modules.map((m=>m.api)));this.state=state,this.api=api}static getDerivedStateFromProps(props,state){return state.path!==props.path?{...state,location:props.location,path:props.path,refId:props.refId,viewMode:props.viewMode,storyId:props.storyId}:null}shouldComponentUpdate(nextProps,nextState){let prevState=this.state,prevProps=this.props;return prevState!==nextState||prevProps.path!==nextProps.path}render(){let{children}=this.props,value={state:this.state,api:this.api};return react.createElement(EffectOnMount,{effect:this.initModules},react.createElement(ManagerContext.Provider,{value},react.createElement(ManagerConsumer,null,children)))}};ManagerProvider.displayName="Manager";var EffectOnMount=({children,effect})=>(react.useEffect(effect,[]),children),defaultFilter=c=>c;function ManagerConsumer({filter=defaultFilter,children}){let c=(0,react.useContext)(ManagerContext),renderer=(0,react.useRef)(children),filterer=(0,react.useRef)(filter);if("function"!=typeof renderer.current)return react.createElement(react.Fragment,null,renderer.current);let data=filterer.current(c),l=(0,react.useMemo)((()=>[...Object.entries(data).reduce(((acc,keyval)=>acc.concat(keyval)),[])]),[c.state]);return(0,react.useMemo)((()=>{let Child=renderer.current;return react.createElement(Child,{...data})}),l)}var fast_deep_equal=__webpack_require__("./node_modules/fast-deep-equal/index.js"),fast_deep_equal_default=__webpack_require__.n(fast_deep_equal);function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var _window$matchMedia;function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return(key=function _toPropertyKey(arg){var key=function _toPrimitive(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!==_typeof(res))return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}(arg,"string");return"symbol"===_typeof(key)?key:String(key)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var _ref=dist.global,Tool_document=_ref.document,Tool_window=_ref.window,defaultParams=(null===(_window$matchMedia=Tool_window.matchMedia)||void 0===_window$matchMedia||_window$matchMedia.call(Tool_window,"(prefers-color-scheme: dark)"),{classTarget:"body",dark:chunk_4NMOSTKD.np.dark,darkClass:["dark"],light:chunk_4NMOSTKD.np.light,lightClass:["light"],stylePreview:!1,userHasExplicitlySetTheTheme:!1}),updateStore=function updateStore(newStore){Tool_window.localStorage.setItem("sb-addon-themes-3",JSON.stringify(newStore))},toggleDarkClass=function toggleDarkClass(el,_ref2){var _el$classList,_el$classList2,_el$classList3,_el$classList4,current=_ref2.current,_ref2$darkClass=_ref2.darkClass,darkClass=void 0===_ref2$darkClass?defaultParams.darkClass:_ref2$darkClass,_ref2$lightClass=_ref2.lightClass,lightClass=void 0===_ref2$lightClass?defaultParams.lightClass:_ref2$lightClass;"dark"===current?((_el$classList=el.classList).remove.apply(_el$classList,_toConsumableArray(arrayify(lightClass))),(_el$classList2=el.classList).add.apply(_el$classList2,_toConsumableArray(arrayify(darkClass)))):((_el$classList3=el.classList).remove.apply(_el$classList3,_toConsumableArray(arrayify(darkClass))),(_el$classList4=el.classList).add.apply(_el$classList4,_toConsumableArray(arrayify(lightClass))))},arrayify=function arrayify(classes){return[].concat(classes).map((function(item){return item}))},updateManager=function updateManager(store){var manager=Tool_document.querySelector(store.classTarget);manager&&toggleDarkClass(manager,store)},store=function store(){var userTheme=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},storedItem=Tool_window.localStorage.getItem("sb-addon-themes-3");if("string"==typeof storedItem){var stored=JSON.parse(storedItem);return userTheme&&(userTheme.dark&&!fast_deep_equal_default()(stored.dark,userTheme.dark)&&(stored.dark=userTheme.dark,updateStore(stored)),userTheme.light&&!fast_deep_equal_default()(stored.light,userTheme.light)&&(stored.light=userTheme.light,updateStore(stored))),stored}return _objectSpread(_objectSpread({},defaultParams),userTheme)};updateManager(store());function esm_slicedToArray(arr,i){return function esm_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function esm_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_x,_r,_arr=[],_n=!0,_d=!1;try{if(_x=(_i=_i.call(arr)).next,0===i){if(Object(_i)!==_i)return;_n=!1}else for(;!(_n=(_s=_x.call(_i)).done)&&(_arr.push(_s.value),_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{if(!_n&&null!=_i.return&&(_r=_i.return(),Object(_r)!==_r))return}finally{if(_d)throw _e}}return _arr}}(arr,i)||function esm_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return esm_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return esm_arrayLikeToArray(o,minLen)}(arr,i)||function esm_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function esm_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function useDarkMode(){var _React$useState2=esm_slicedToArray(react.useState("dark"===store().current),2),isDark=_React$useState2[0],setIsDark=_React$useState2[1];return react.useEffect((function(){var chan=external_STORYBOOK_MODULE_ADDONS_.addons.getChannel();return chan.on(constants_DARK_MODE_EVENT_NAME,setIsDark),function(){return chan.off(constants_DARK_MODE_EVENT_NAME,setIsDark)}}),[]),isDark}},"./node_modules/tods-competition-factory/dist/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{M6:()=>tournamentEngine,QO:()=>mocksEngine,RO:()=>fixtures,utilities:()=>utilities,y1:()=>drawEngine});const SET="SET",NOAD="NOAD",TIMED="timed",setTypes$1={S:"normal",F:"final"};function stringify(matchUpFormatObject,preserveRedundant){if("object"==typeof matchUpFormatObject)return matchUpFormatObject.timed&&!isNaN(matchUpFormatObject.minutes)?timedSetFormat(matchUpFormatObject):matchUpFormatObject.bestOf&&matchUpFormatObject.setFormat?function getSetFormat(matchUpFormatObject,preserveRedundant){var _a;const bestOfValue=getNumber$1(matchUpFormatObject.bestOf);if((null==(_a=matchUpFormatObject.setFormat)?void 0:_a.timed)&&matchUpFormatObject.simplified&&1===bestOfValue)return timedSetFormat(matchUpFormatObject.setFormat);const bestOfCode=bestOfValue&&`${SET}${bestOfValue}`||"",setCountValue=stringifySet(matchUpFormatObject.setFormat,preserveRedundant),setCode=setCountValue&&`S:${setCountValue}`||"",finalSetCountValue=stringifySet(matchUpFormatObject.finalSetFormat,preserveRedundant),finalSetCode=bestOfValue>1&&finalSetCountValue&&!finalSetCountValue.invalid&&setCountValue!==finalSetCountValue&&`F:${finalSetCountValue}`||"";if(bestOfCode&&setCountValue&&!setCountValue.invalid&&(!finalSetCountValue||!finalSetCountValue.invalid))return[bestOfCode,setCode,finalSetCode].filter((f=>f)).join("-")}(matchUpFormatObject,preserveRedundant):void 0}function getNumber$1(formatstring){return!isNaN(Number(formatstring))&&Number(formatstring)}function timedSetFormat(matchUpFormatObject){let value=`T${matchUpFormatObject.minutes}`;return matchUpFormatObject.based&&(value+=matchUpFormatObject.based),matchUpFormatObject.modifier&&(value+=`@${matchUpFormatObject.modifier}`),value}function stringifySet(setObject,preserveRedundant){if("object"==typeof setObject&&Object.keys(setObject).length){if(setObject.timed)return timedSetFormat(setObject);if(setObject.tiebreakSet)return tiebreakFormat(setObject.tiebreakSet);const setToValue=getNumber$1(setObject.setTo);if(setToValue){const NoAD=setObject.NoAD&&NOAD||"",setTiebreakValue=tiebreakFormat(setObject.tiebreakFormat),setTiebreakCode=setTiebreakValue&&!setTiebreakValue.invalid&&`/${setTiebreakValue}`||"",tiebreakAtValue=getNumber$1(setObject.tiebreakAt),tiebreakAtCode=tiebreakAtValue&&(tiebreakAtValue!==setToValue||preserveRedundant)&&`@${tiebreakAtValue}`||"";return!setTiebreakValue||!setTiebreakValue.invalid?`${setToValue}${NoAD}${setTiebreakCode}${tiebreakAtCode}`:{invalid:!0}}return{invalid:!0}}}function tiebreakFormat(tieobject){if(tieobject){if("object"!=typeof tieobject||tieobject.tiebreakTo){if("object"==typeof tieobject&&getNumber$1(tieobject.tiebreakTo)){let value=`TB${tieobject.tiebreakTo}${tieobject.NoAD?NOAD:""}`;return tieobject.modifier&&(value+=`@${tieobject.modifier}`),value}return{invalid:!0}}return""}}function isPowerOf2(n){return!isNaN(n)&&(n&&0==(n&n-1))}function coerceEven(n){return isNaN(n)?0:n%2&&n+1||n}function nearestPowerOf2(val){return Math.pow(2,Math.round(Math.log(val)/Math.log(2)))}function isNumeric(value){return!isNaN(parseFloat(value))}function nextPowerOf2(n){if(isNaN(n))return!1;for(;!isPowerOf2(n);)n++;return n}function randomInt(min,max){return min=Math.ceil(min),max=Math.floor(max),Math.floor(Math.random()*(max-min+1))+min}function isConvertableInteger(n){return Number.isSafeInteger("string"==typeof n?+n:n)}function skewedDistribution(min,max,skew,step,significantDecimals=2){const u=1-Math.random(),v=1-Math.random();let num=Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v);return num=num/10+.5,num>1||num<0?num=skewedDistribution(min,max,skew):(num=Math.pow(num,skew),num*=max-min,num+=min),step&&(num=function stepRound(value,step){step||(step=1);const inv=1/step;return Math.round(value*inv)/inv}(num,step)),parseFloat(num.toFixed(significantDecimals))}function parse(matchUpFormatCode){if("string"==typeof matchUpFormatCode){const type=matchUpFormatCode.startsWith("T")&&TIMED||matchUpFormatCode.startsWith(SET)&&SET||"";if(type===TIMED){const parsedFormat={simplified:!0,setFormat:parseTimedSet(matchUpFormatCode),bestOf:1};if(parsedFormat.setFormat)return parsedFormat}if(type===SET)return function setsMatch(formatstring){const parts=formatstring.split("-"),bestOf=getNumber(parts[0].slice(3)),setFormat=parts&&parseSetFormat(parts[1]),finalSetFormat=parts&&parseSetFormat(parts[2]),validBestOf=bestOf&&bestOf<6,validFinalSet=!parts[2]||finalSetFormat&&!finalSetFormat.invalid,validSetsFormat=setFormat&&!setFormat.invalid,result={bestOf,setFormat};finalSetFormat&&(result.finalSetFormat=finalSetFormat);if(validBestOf&&validSetsFormat&&validFinalSet)return result}(matchUpFormatCode)}}function parseSetFormat(formatstring){if(":"===(null==formatstring?void 0:formatstring[1])){const parts=formatstring.split(":"),setType=setTypes$1[parts[0]],setFormatString=parts[1];if(setType&&setFormatString){if(0===setFormatString.indexOf("TB"))return{tiebreakSet:parseTiebreakFormat(setFormatString)};if(0===setFormatString.indexOf("T"))return parseTimedSet(setFormatString);const parts2=formatstring.match(/^[FS]{1}:(\d+)([A-Za-z]*)/),NoAD=parts2&&isNoAD(parts2[2])||!1,validNoAD=!parts2||!parts2[2]||NoAD,setTo=parts2&&getNumber(parts2[1]),tiebreakAtValue=parseTiebreakAt(setFormatString),validTiebreakAt=!tiebreakAtValue||tiebreakAtValue&&!tiebreakAtValue.invalid,tiebreakAt=validTiebreakAt&&tiebreakAtValue||setTo,tiebreakFormat=parseTiebreakFormat(setFormatString.split("/")[1]),validTiebreak=!tiebreakFormat||!tiebreakFormat.invalid,result={setTo};return NoAD&&(result.NoAD=!0),tiebreakFormat?(result.tiebreakFormat=tiebreakFormat,result.tiebreakAt=tiebreakAt):result.noTiebreak=!0,setTo&&validNoAD&&validTiebreak&&validTiebreakAt&&result||{invalid:!0}}}}function parseTiebreakAt(setFormatString,expectNumber=!0){const tiebreakAtValue=(null==setFormatString?void 0:setFormatString.indexOf("@"))>0&&setFormatString.split("@");if(tiebreakAtValue){return(expectNumber?getNumber(tiebreakAtValue[1]):tiebreakAtValue[1])||{invalid:!0}}}function parseTiebreakFormat(formatstring){if(formatstring){if(formatstring.startsWith("TB")){const modifier=parseTiebreakAt(formatstring,!1),parts=formatstring.match(/^TB(\d+)([A-Za-z]*)/),tiebreakToString=parts&&parts[1],NoAD=parts&&isNoAD(parts[2]),validNoAD=!parts||!parts[2]||NoAD,tiebreakTo=getNumber(tiebreakToString);if(tiebreakTo&&validNoAD){const result={tiebreakTo};return modifier&&!isConvertableInteger(modifier)&&(result.modifier=modifier),NoAD&&(result.NoAD=!0),result}return{invalid:!0}}return{invalid:!0}}}function parseTimedSet(formatstring){var _a;const timestring=formatstring.slice(1),parts=timestring.match(/^(\d+)(@?[A-Za-z]*)/),minutes=getNumber(null==parts?void 0:parts[1]);if(!minutes)return;const setFormat={timed:!0,minutes},based=null==parts?void 0:parts[2],validModifier=[void 0,"P","G"].includes(based);if(based&&!validModifier){const modifier=null==(_a=timestring.match(/^(\d+)(@)([A-Za-z]+)$/))?void 0:_a[3];return modifier?(setFormat.modifier=modifier,setFormat):void 0}return based&&(setFormat.based=parts[2]),setFormat}function isNoAD(formatstring){return formatstring&&formatstring.indexOf(NOAD)>=0}function getNumber(formatstring){return!isNaN(Number(formatstring))&&Number(formatstring)}function isValid(matchUpFormat){if("string"!=typeof matchUpFormat)return!1;const parsedFormat=parse(matchUpFormat),setParts=matchUpFormat.match(/-S:(\d+)+\/TB(\d+)@?(\d*)*/),setsTo=null==setParts?void 0:setParts[1],tiebreakTo=null==setParts?void 0:setParts[2],tiebreakAt=null==setParts?void 0:setParts[3],finalSetParts=matchUpFormat.match(/-F:(\d+)+\/TB(\d+)@?(\d*)*/),finalSetTo=null==finalSetParts?void 0:finalSetParts[1],finalSetTiebreakTo=null==finalSetParts?void 0:finalSetParts[2],finalTiebreakAt=null==finalSetParts?void 0:finalSetParts[3];return stringify(parsedFormat,setParts&&tiebreakTo&&setsTo===tiebreakAt||finalSetParts&&finalSetTiebreakTo&&finalSetTo===finalTiebreakAt)===matchUpFormat}const matchUpFormatCode={isValidMatchUpFormat:isValid,stringify,isValid,parse};function unique(arr){return arr.filter(((item,i,s)=>s.lastIndexOf(item)===i))}function shuffleArray(arr){return arr.map((a=>[Math.random(),a])).sort(((a,b)=>a[0]-b[0])).map((a=>a[1]))}function instanceCount(values){return values.reduce(((a,c)=>(a[c]||(a[c]=0),a[c]++,a)),{})}function onlyUnique(value,index,self){return self.indexOf(value)===index}function uniqueValues(arr){return arr.filter(onlyUnique)}function randomPop(array){return Array.isArray(array)&&array.length?array.splice(Math.floor(Math.random()*array.length),1)[0]:void 0}function randomMember(arr){return arr[Math.floor(Math.random()*arr.length)]}function generateRange(start,end){return Array.from({length:end-start},((v,k)=>k+start))}function arrayIndices(val,arr){return arr.reduce(((a,e,i)=>(e===val&&a.push(i),a)),[])}function intersection(a,b){return Array.isArray(a)&&Array.isArray(b)?a.filter((n=>-1!==b.indexOf(n))).filter(((e,i,c)=>c.indexOf(e)===i)):0}function difference(a,b){return Array.isArray(a)&&Array.isArray(b)?a.filter((x=>!b.includes(x))):0}function overlap(a,b){return!(!Array.isArray(a)||!Array.isArray(b))&&a.some((e=>b.includes(e)))}function chunkArray(arr,chunksize){return arr.reduce(((all,one,i)=>{const ch=Math.floor(i/chunksize);return all[ch]=[].concat(all[ch]||[],one),all}),[])}function chunkByNth(arr,chunksCount,shuttle){return arr.reduce(((chunks,entry,index)=>{const reverseDirection=!!shuttle&&!!(Math.floor(index/chunksCount)%2),chunkIndex=index%chunksCount,directionIndex=reverseDirection?chunksCount-1-chunkIndex:chunkIndex;return chunks[directionIndex]||(chunks[directionIndex]=[]),chunks[directionIndex].push(entry),chunks}),[])}const SUCCESS={success:!0},ANACHRONISM={message:"Chronological error; time violation.",code:"ANACHRONISM"},CANNOT_REMOVE_MAIN_STRUCTURE={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},INVALID_RECORDS={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},MISSING_TOURNAMENT_RECORDS={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},MISSING_TOURNAMENT_RECORD={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},INVALID_TOURNAMENT_RECORD={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},MISSING_TOURNAMENT_ID={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},INVALID_DRAW_DEFINITION={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},MISSING_DRAW_DEFINITION={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},EXISTING_DRAW_DEFINITIONS={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},DRAW_DEFINITION_NOT_FOUND={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},INVALID_STRUCTURE={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},INCOMPLETE_SOURCE_STRUCTURE={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},INVALID_DRAW_POSITION_FOR_SEEDING={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},DRAW_POSITION_ASSIGNED={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},SCHEDULE_NOT_CLEARED={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},DRAW_POSITION_NOT_CLEARED={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},UNRECOGNIZED_DRAW_TYPE={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},MISSING_DRAW_POSITIONS={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},DRAW_POSITION_ACTIVE={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},INVALID_DRAW_POSITION={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},MISSING_DRAW_POSITION={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},INVALID_DRAW_TYPE={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},INVALID_DRAW_SIZE={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},DRAW_SIZE_MISMATCH={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},MISSING_DRAW_SIZE={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},MISSING_DRAW_ID={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},DRAW_ID_EXISTS={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},INVALID_PARTICIPANT_SEEDING={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},SEEDSCOUNT_GREATER_THAN_DRAW_SIZE={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},MISSING_SEEDCOUNT_THRESHOLDS={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},INVALID_ACTION={message:"Invalid action",code:"ERR_INVALID_ACTION"},INVALID_ASSIGNMENT={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},MISSING_SEED_ASSIGNMENTS={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},INVALID_SEED_NUMBER={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},INVALID_SEED_POSITION={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},MISSING_TARGET_LINK={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},EXISTING_ROUND={message:"Existing round",code:"ERR_EXISTING_ROUND"},MISSING_STRUCTURE_ID={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},STRUCTURE_NOT_FOUND={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},MISSING_STRUCTURES={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},MISSING_STRUCTURE={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},UNLINKED_STRUCTURES={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},INVALID_EVENT_TYPE={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},MISSING_EVENT={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},EVENT_NOT_FOUND={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},EVENT_EXISTS={message:"Event exists",code:"ERR_EXISTING_EVENT"},MISSING_ENTRIES={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},INVALID_ENTRIES={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},MISSING_ASSIGNMENTS={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},MISSING_STAGE={message:"Missing stage",code:"ERR_MISSING_STAGE"},INVALID_STAGE={message:"Invalid stage",code:"ERR_INVALID_STAGE"},MISSING_POSITION_ASSIGNMENTS={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},INVALID_MATCHUP_STATUS_BYE={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},UNRECOGNIZED_MATCHUP_STATUS={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},UNRECOGNIZED_MATCHUP_FORMAT={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},INCOMPATIBLE_MATCHUP_STATUS={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},INVALID_MATCHUP_STATUS={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},INVALID_TIE_FORMAT={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},INVALID_MATCHUP_FORMAT={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},MISSING_MATCHUP_FORMAT={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},MISSING_COLLECTION_DEFINITION={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},MISSING_TIE_FORMAT={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},MISSING_MATCHUP_ID={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},MISSING_MATCHUP_IDS={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},MATCHUP_NOT_FOUND={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},MISSING_MATCHUPS={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},MISSING_MATCHUP={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},INVALID_MATCHUP={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},MISSING_POLICY_TYPE={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},MISSING_POLICY_DEFINITION={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},MISSING_AVOIDANCE_POLICY={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},MISSING_POLICY_ATTRIBUTES={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},INVALID_POLICY_DEFINITION={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},EXISTING_POLICY_TYPE={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},POLICY_NOT_ATTACHED={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},POLICY_NOT_FOUND={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},MISSING_SCORING_POLICY={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},INVALID_SIDE_NUMBER={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},MISSING_SET_OBJECT={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},MISSING_COURT_ID={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},MISSING_VALUE={message:"Missing value",code:"ERR_MISSING_VALUE"},MISSING_DATE={message:"Missing date",code:"ERR_MISSING_DATE"},NO_VALID_DATES={message:"No valid dates",code:"ERR_NO_VALID_DATES"},INVALID_BOOKINGS={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},INVALID_DATE_AVAILABILITY={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},MISSING_DATE_AVAILABILITY={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},INVALID_DATE={message:"Invalid Date",code:"ERR_INVALID_DATE"},INVALID_TIME={message:"Invalid time",code:"ERR_INVALID_TIME"},INVALID_TOURNAMENT_DATES={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},INVALID_GAME_SCORES={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},INVALID_SCORE={message:"Invalid score",code:"ERR_INVALID_SCORE"},INVALID_WINNING_SIDE={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},NO_PARTICIPANTS_GENERATED={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},CANNOT_MODIFY_TIEFORMAT={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},CANNOT_REMOVE_PARTICIPANTS={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},CANNOT_CHANGE_WINNING_SIDE={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},INVALID_PARTICIPANT={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},INVALID_PARTICIPANT_ID={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},INVALID_PARTICIPANT_IDS={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},INVALID_PARTICIPANT_ROLE={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},INVALID_PARTICIPANT_TYPE={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},MISSING_PARTICIPANT_ROLE={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},MISSING_PARTICIPANT={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},MISSING_PARTICIPANTS={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},MISSING_PARTICIPANT_ID={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},PARTICIPANT_NOT_FOUND={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},PARTICIPANT_ID_EXISTS={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},NO_PARTICIPANT_REMOVED={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},MISSING_PARTICIPANT_IDS={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},MISSING_PARTICIPANT_COUNT={message:"Missing participantCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},PARTICIPANT_NOT_CHECKED_IN={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},PARTICIPANT_ALREADY_CHECKED_IN={message:"Participant already checked in",code:"ERR_UNCHANGED_PARTICIPANT_CHECKED_IN"},MISSING_PERSON_DETAILS={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},EXISTING_PARTICIPANT={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE={message:"participantCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},INVALID_ENTRY_STATUS={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},PARTICIPANT_ENTRY_NOT_FOUND={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},PARTICIPANT_NOT_ENTERED_IN_STAGE={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},PARTICIPANT_NOT_FOUND_IN_STAGE={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},ENTRY_STATUS_NOT_ALLOWED_IN_STAGE={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},INSUFFICIENT_DRAW_POSITIONS={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},MISSING_PENALTY_TYPE={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},MISSING_PENALTY_ID={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},PENALTY_NOT_FOUND={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},MISSING_COURTS_INFO={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},COURT_NOT_FOUND={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},COURT_EXISTS={message:"Court exists",code:"ERR_EXISTING_COURT"},VENUE_EXISTS={message:"Venue exists",code:"ERR_EXISTING_VENUE"},VENUE_NOT_FOUND={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},MISSING_VENUE_ID={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},INVALID_END_TIME={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},EXISTING_END_TIME={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},INVALID_STOP_TIME={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},INVALID_START_TIME={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},INVALID_RESUME_TIME={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},INVALID_TIME_ITEM={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},MISSING_TIME_ITEM={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},MISSING_TIME_ITEMS={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},MISSING_CONTEXT={message:"Missing context",code:"ERR_MISSING_CONTEXT"},MISSING_SCHEDULE={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},INVALID_SCALE_ITEM={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},SCALE_ITEM_NOT_FOUND={message:"No scaleItem found",code:"ERR_NOT_FOUND_SCALE_ITEM"},MODIFICATIONS_FAILED={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},NO_MODIFICATIONS_APPLIED={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},UNABLE_TO_ASSIGN_COURT={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},NO_CANDIDATES={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},INVALID_CONFIGURATION={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},INVALID_OBJECT={message:"Invalid object",code:"ERR_INVALID_OBJECT"},INVALID_VALUES={message:"Invalid values",code:"ERR_INVALID_VALUES"},DUPLICATE_VALUE={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},TEAM_NOT_FOUND={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},NO_VALID_ACTIONS={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},NO_VALID_ATTRIBUTES={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},VALUE_UNCHANGED={message:"Value unchanged",code:"ABORT_UNCHANGED"},NOT_FOUND={message:"Not found",code:"ERR_NOT_FOUND"},NOT_IMPLEMENTED={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},EXISTING_FLIGHT={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},EXISTING_PROFILE={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},EXISTING_OUTCOME={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},EXISTING_MATCHUP_ID={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},EXISTING_STAGE={message:"Existing stage",code:"ERR_EXISTING_STAGE"},EXISTING_STRUCTURE={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},METHOD_NOT_FOUND={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},SCHEDULED_MATCHUPS={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"};var __defProp$4V=Object.defineProperty,__getOwnPropSymbols$4W=Object.getOwnPropertySymbols,__hasOwnProp$4W=Object.prototype.hasOwnProperty,__propIsEnum$4W=Object.prototype.propertyIsEnumerable,__defNormalProp$4V=(obj,key,value)=>key in obj?__defProp$4V(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4V=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4W.call(b,prop)&&__defNormalProp$4V(a,prop,b[prop]);if(__getOwnPropSymbols$4W)for(var prop of __getOwnPropSymbols$4W(b))__propIsEnum$4W.call(b,prop)&&__defNormalProp$4V(a,prop,b[prop]);return a};const syncGlobalState={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,notices:[]};var syncGlobalState$1={addNotice:function addNotice$1({topic,payload,key}){if(syncGlobalState.modified=!0,"string"!=typeof topic||"object"!=typeof payload)return;if(syncGlobalState.disableNotifications||!syncGlobalState.subscriptions[topic])return;key&&(syncGlobalState.notices=syncGlobalState.notices.filter((notice=>!(notice.topic===topic&&notice.key===key))));syncGlobalState.notices.push({topic,payload,key})},callListener:function callListener$1({topic,notices}){const method=syncGlobalState.subscriptions[topic];method&&"function"==typeof method&&method(notices)},cycleMutationStatus:function cycleMutationStatus$1(){const status=syncGlobalState.modified;return syncGlobalState.modified=!1,status},deleteNotice:function deleteNotice$1({topic,key}){syncGlobalState.notices=syncGlobalState.notices.filter((notice=>(!topic||notice.topic===topic)&&notice.key!==key))},deleteNotices:function deleteNotices$1(){syncGlobalState.notices=[]},disableNotifications:function disableNotifications$1(){syncGlobalState.disableNotifications=!0},enableNotifications:function enableNotifications$1(){syncGlobalState.disableNotifications=!1},getNotices:function getNotices$1({topic}){const notices=syncGlobalState.notices.filter((notice=>notice.topic===topic)).map((notice=>notice.payload));return notices.length&&notices},getTopics:function getTopics$1(){return{topics:Object.keys(syncGlobalState.subscriptions)}},getTournamentId:function getTournamentId$1(){return syncGlobalState.tournamentId},getTournamentRecord:function getTournamentRecord$1(tournamentId){return syncGlobalState.tournamentRecords[tournamentId]},getTournamentRecords:function getTournamentRecords$1(){return syncGlobalState.tournamentRecords},removeTournamentRecord:function removeTournamentRecord$1(tournamentId){if("string"!=typeof tournamentId)return{error:INVALID_VALUES};if(!syncGlobalState.tournamentRecords[tournamentId])return{error:NOT_FOUND};delete syncGlobalState.tournamentRecords[tournamentId];const tournamentIds=Object.keys(syncGlobalState.tournamentRecords);1===tournamentIds.length?syncGlobalState.tournamentId=tournamentIds[0]:tournamentIds.length||(syncGlobalState.tournamentId=void 0);return{success:!0}},setSubscriptions:function setSubscriptions$1({subscriptions={}}={}){return"object"!=typeof subscriptions?{error:INVALID_VALUES}:(Object.keys(subscriptions).forEach((subscription=>{syncGlobalState.subscriptions[subscription]=subscriptions[subscription]})),__spreadValues$4V({},SUCCESS))},setTournamentId:function setTournamentId$1(tournamentId){return syncGlobalState.tournamentRecords[tournamentId]?(syncGlobalState.tournamentId=tournamentId,{success:!0}):{error:MISSING_TOURNAMENT_RECORD}},setTournamentRecord:function setTournamentRecord$2(tournamentRecord){const tournamentId=null==tournamentRecord?void 0:tournamentRecord.tournamentId;return tournamentId?(syncGlobalState.tournamentRecords[tournamentId]=tournamentRecord,{success:!0}):{error:INVALID_TOURNAMENT_RECORD}},setTournamentRecords:function setTournamentRecords$1(tournamentRecords){syncGlobalState.tournamentRecords=tournamentRecords;const tournamentIds=Object.keys(tournamentRecords);1===tournamentIds.length?syncGlobalState.tournamentId=tournamentIds[0]:tournamentIds.length||(syncGlobalState.tournamentId=void 0)}};var __defProp$4U=Object.defineProperty,__getOwnPropSymbols$4V=Object.getOwnPropertySymbols,__hasOwnProp$4V=Object.prototype.hasOwnProperty,__propIsEnum$4V=Object.prototype.propertyIsEnumerable,__defNormalProp$4U=(obj,key,value)=>key in obj?__defProp$4U(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4U=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4V.call(b,prop)&&__defNormalProp$4U(a,prop,b[prop]);if(__getOwnPropSymbols$4V)for(var prop of __getOwnPropSymbols$4V(b))__propIsEnum$4V.call(b,prop)&&__defNormalProp$4U(a,prop,b[prop]);return a};const globalState={tournamentFactoryVersion:"0.0.0",timers:{default:{elapsedTime:0}},iterators:{makeDeepCopy:0},devContext:void 0,deepCopyAttributes:{threshold:void 0,stringify:[],ignore:[],toJSON:[]},deepCopy:!0};let _globalStateProvider=syncGlobalState$1;function getDevContext(contextCriteria){return contextCriteria&&"object"==typeof contextCriteria?"object"==typeof globalState.devContext&&(Object.keys(contextCriteria).every((key=>globalState.devContext[key]===contextCriteria[key]))&&globalState.devContext):globalState.devContext||!1}function setDevContext(value){globalState.devContext=value}function enableNotifications(){_globalStateProvider.enableNotifications()}function setDeepCopy(value,attributes){"boolean"==typeof value&&(globalState.deepCopy=value),"object"==typeof attributes&&(Array.isArray(attributes.ignore)&&(globalState.deepCopyAttributes.ignore=attributes.ignore),Array.isArray(attributes.toJSON)&&(globalState.deepCopyAttributes.toJSON=attributes.toJSON),Array.isArray(attributes.stringify)&&(globalState.deepCopyAttributes.stringify=attributes.stringify),attributes.threshold&&(globalState.deepCopyAttributes.threshold=attributes.threshold))}function deepCopyEnabled(){return __spreadValues$4U({enabled:globalState.deepCopy},globalState.deepCopyAttributes)}function cycleMutationStatus(){return _globalStateProvider.cycleMutationStatus()}function addNotice(notice){return _globalStateProvider.addNotice(notice)}function getNotices(topic){return _globalStateProvider.getNotices(topic)}function deleteNotice({key,topic}){return _globalStateProvider.deleteNotice({key,topic})}function deleteNotices(){return _globalStateProvider.deleteNotices()}function getTopics(){return _globalStateProvider.getTopics()}async function callListener(payload){return _globalStateProvider.callListener(payload)}function getTournamentId(){return _globalStateProvider.getTournamentId()}function getTournamentRecord(tournamentId){return _globalStateProvider.getTournamentRecord(tournamentId)}function getTournamentRecords(){return _globalStateProvider.getTournamentRecords()}function setTournamentRecord$1(tournamentRecord){return _globalStateProvider.setTournamentRecord(tournamentRecord)}function setTournamentRecords(tournamentRecords){return _globalStateProvider.setTournamentRecords(tournamentRecords)}function setTournamentId(tournamentId){return _globalStateProvider.setTournamentId(tournamentId)}function removeTournamentRecord(tournamentId){return _globalStateProvider.removeTournamentRecord(tournamentId)}function isObject(obj){return"object"==typeof obj}function definedAttributes(obj,ignoreFalse,ignoreEmptyArrays,shallow){if("object"!=typeof obj||null===obj)return obj;const deepCopy=deepCopyEnabled();(null==deepCopy?void 0:deepCopy.enabled)||(shallow=!0);const ignoreValues=["",void 0,null];ignoreFalse&&ignoreValues.push(!1);const definedKeys=Object.keys(obj).filter((key=>!ignoreValues.includes(obj[key])&&(!ignoreEmptyArrays||!Array.isArray(obj[key])||obj[key].length)));return Object.assign({},...definedKeys.map((key=>Array.isArray(obj[key])?{[key]:shallow?obj[key]:obj[key].map((m=>definedAttributes(m)))}:{[key]:shallow?obj[key]:definedAttributes(obj[key])})))}function countKeys(o){return Array.isArray(o)?o.length+o.map(countKeys).reduce(((a,b)=>a+b),0):"object"==typeof o&&null!==o?Object.keys(o).length+Object.keys(o).map((k=>countKeys(o[k]))).reduce(((a,b)=>a+b),0):0}function attributeFilter(params){if(null===params)return{};const{source,template}=params||{};if(!template)return source;const target={};return function attributeCopy(valuesObject,templateObject,outputObject){if(!valuesObject||!templateObject)return;const vKeys=Object.keys(valuesObject),oKeys=Object.keys(templateObject),orMap=Object.assign({},...oKeys.filter((key=>key.indexOf("||"))).map((key=>key.split("||").map((or=>({[or]:key}))))).flat()),allKeys=oKeys.concat(...Object.keys(orMap)),wildcard=allKeys.includes("*");for(let k=0;k<vKeys.length;k++)if(allKeys.indexOf(vKeys[k])>=0||wildcard){const tobj=templateObject[orMap[vKeys[k]]||vKeys[k]]||wildcard,vobj=valuesObject[vKeys[k]];if("object"!=typeof tobj||"function"==typeof vobj||Array.isArray(tobj)){const value=valuesObject[vKeys[k]];if(Array.isArray(tobj)&&!tobj.includes(value))return!1;(templateObject[vKeys[k]]||wildcard&&!1!==templateObject[vKeys[k]])&&(outputObject[vKeys[k]]=value)}else if(Array.isArray(vobj)){const mappedElements=vobj.map((arrayMember=>{const target2={};if(!1!==attributeCopy(arrayMember,tobj,target2))return target2})).filter(Boolean);outputObject[vKeys[k]]=mappedElements}else vobj&&(outputObject[vKeys[k]]={},attributeCopy(vobj,tobj,outputObject[vKeys[k]]))}}(source,template,target),target}function generateTimeCode(index=0){const uidate=new Date;return uidate.setHours(uidate.getHours()+index),uidate.getTime().toString(36).slice(-6).toUpperCase()}const validDateString=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/,validTimeString=/^((0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)([.,][0-9]{3})?$/,dateValidation=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))([ T](0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/,timeValidation=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))?([ T]?(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/;function getIsoDateString(schedule){let{scheduledDate,scheduledTime}=schedule;if(!scheduledDate&&scheduledTime&&(scheduledDate=extractDate(scheduledTime)),!scheduledDate)return;const extractedTime=extractTime(scheduledTime);let isoDateString=extractDate(scheduledDate);return isoDateString&&extractedTime&&(isoDateString+=`T${extractedTime}`),isoDateString}function isDateObject(value){if("object"!=typeof value||Array.isArray(value))return!1;return"[object Date]"===Object.prototype.toString.call(value)}function isValidDateString(scheduleDate){return isISODateString(scheduleDate)||validDateString.test(scheduleDate)}const getUTCdateString=date=>{const dateDate=isDate(date)||isISODateString(date)?new Date(date):new Date,monthNumber=dateDate.getUTCMonth()+1,utcMonth=monthNumber<10?`0${monthNumber}`:`${monthNumber}`;return`${dateDate.getUTCFullYear()}-${zeroPad(utcMonth)}-${zeroPad(dateDate.getUTCDate())}`};function formatDate(date,separator="-",format="YMD"){if(!date)return"";"string"==typeof date&&date.indexOf("T")<0&&(date+="T00:00");const d=new Date(date);let month=""+(d.getMonth()+1),day=""+d.getDate();const year=d.getFullYear();return month.length<2&&(month="0"+month),day.length<2&&(day="0"+day),"DMY"===format?[day,month,year].join(separator):"MDY"===format?[month,day,year].join(separator):"YDM"===format?[year,day,month].join(separator):"DYM"===format?[day,year,month].join(separator):"MYD"===format?[month,year,day].join(separator):[year,month,day].join(separator)}function offsetDate(date){const targetTime=date?new Date(date):new Date,tzDifference=targetTime.getTimezoneOffset();return new Date(targetTime.getTime()-60*tzDifference*1e3)}function isDate(dateArg){if("boolean"==typeof dateArg)return!1;const t=dateArg instanceof Date&&dateArg||!isNaN(dateArg)&&new Date(dateArg)||!1;return t&&!isNaN(t.valueOf())}function dateRange(startDt,endDt){if(!isValidDateString(startDt)||!isValidDateString(endDt))return[];const startDateString=extractDate(startDt)+"T00:00",endDateString=extractDate(endDt)+"T00:00",startDate=new Date(startDateString),endDate=new Date(endDateString),between=[];let iterations=0;if(!!(isDate(endDate)&&isDate(startDate)&&function isValidDateRange(minDate,maxDate){return minDate<=maxDate}(startDate,endDate))){const currentDate=startDate;for(;currentDate<=endDate&&iterations<300;)iterations+=1,between.push(new Date(currentDate)),currentDate.setDate(currentDate.getDate()+1)}return between.map((date=>formatDate(date)))}const re=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function isISODateString(dateString){return"string"==typeof dateString&&re.test(dateString)}function isTimeString(timeString){if("string"!=typeof timeString)return!1;const parts=timeString.split("Z")[0].split(":"),isNumeric=parts.every((part=>!isNaN(part)));return!(parts.length<2||!isNumeric||parseInt(parts[0])>23||parseInt(parts[1])>60)}function timeStringMinutes(timeString){const validTimeString=extractTime(timeString);if(!validTimeString)return 0;const[hours,minutes]=validTimeString.split(":").map((value=>parseInt(value)));return 60*hours+minutes}function tidyTime(timeString){return isTimeString(timeString)?timeString.split(":").slice(0,2).map(zeroPad).join(":"):void 0}function extractTime(dateString){return isISODateString(dateString)&&dateString.indexOf("T")>0?tidyTime(dateString.split("T").reverse()[0]):tidyTime(dateString)}function extractDate(dateString){return isISODateString(dateString)||dateValidation.test(dateString)?dateString.split("T")[0]:void 0}function dateStringDaysChange(dateString,daysChange){const date=new Date(dateString);return date.setDate(date.getDate()+daysChange),extractDate(date.toISOString())}function splitTime(value){value="string"!=typeof value?"00:00":value;const o={},time={};return({0:o.time,1:o.ampm}=value.split(" ")||[]),({0:time.hours,1:time.minutes}=o.time.split(":")||[]),time.ampm=o.ampm,isNaN(time.hours)||isNaN(time.minutes)||time.ampm&&!["AM","PM"].includes(time.ampm.toUpperCase())?{}:time}function timeSort(a,b){const as=splitTime(a),bs=splitTime(b);if(parseInt(as.hours)<parseInt(bs.hours))return-1;if(parseInt(as.hours)>parseInt(bs.hours))return 1;if(as.hours===bs.hours){if(parseInt(as.minutes)<parseInt(bs.minutes))return-1;if(parseInt(as.minutes)>parseInt(bs.minutes))return 1}return 0}function timeToDate(timeString,date=void 0){const[hours,minutes]=(timeString||"00:00").split(":").map(zeroPad),milliseconds=offsetDate(date).setHours(hours,minutes,0,0);return offsetDate(milliseconds)}function minutesDifference(date1,date2,absolute=!0){const dt1=new Date(date1),diff=(new Date(date2).getTime()-dt1.getTime())/1e3/60;return absolute?Math.abs(Math.round(diff)):Math.round(diff)}function addMinutesToTimeString(timeString,minutes){const validTimeString=extractTime(timeString);if(!validTimeString)return"00:00";const minutesToAdd=isNaN(minutes)?0:minutes;return extractTime(addMinutes(timeToDate(validTimeString),minutesToAdd).toISOString())}function addMinutes(startDate,minutes){const date=new Date(startDate);return new Date(date.getTime()+6e4*minutes)}function zeroPad(number){return number.toString()[1]?number:"0"+number}function sameDay(date1,date2){const d1=new Date(date1),d2=new Date(date2);return d1.getFullYear()===d2.getFullYear()&&d1.getMonth()===d2.getMonth()&&d1.getDate()===d2.getDate()}const dateTime={addMinutesToTimeString,convertTime:function convertTime(value,time24){return time24?function militaryTime(value){const time=splitTime(value);return time.ampm&&time.hours&&("pm"===time.ampm.toLowerCase()&&parseInt(time.hours)<12&&(time.hours=(time.hours&&parseInt(time.hours)||0)+12),"am"===time.ampm.toLowerCase()&&"12"===time.hours&&(time.hours="00")),`${time.hours||"12"}:${time.minutes||"00"}`.split(":").map(zeroPad).join(":")}(value):function regularTime(value){const time=splitTime(value);return time.ampm?value:(time.hours>12?(time.hours-=12,time.ampm="PM"):"12"===time.hours?time.ampm="PM":"00"===time.hours?(time.hours="12",time.ampm="AM"):time.ampm="AM","0"===time.hours[0]&&(time.hours=time.hours.slice(1)),`${time.hours||"12"}:${time.minutes||"00"} ${time.ampm}`)}(value)},getIsoDateString,getUTCdateString,DateHHMM:function DateHHMM(date){const dt=new Date(date);return function HHMMSS(s,format){const secondNumber=parseInt(s,10),hours=Math.floor(secondNumber/3600),minutes=Math.floor((secondNumber-3600*hours)/60),seconds=secondNumber-3600*hours-60*minutes,displaySeconds=!format||format&&format.displaySeconds;return(displaySeconds?hours+":"+minutes+":"+seconds:hours+":"+minutes).split(":").map(zeroPad).join(":")}(dt.getSeconds()+60*dt.getMinutes()+3600*dt.getHours(),{displaySeconds:!1})},extractDate,extractTime,formatDate,getDateByWeek:function getDateByWeek(week,year,dateFormat,sunday=!1){let date=new Date(year,0,1+7*(week-1));const startValue=sunday?0:1;return date.setDate(date.getDate()+(startValue-date.getDay())),formatDate(date,dateFormat)},isISODateString,isDate,isTimeString,offsetDate,offsetTime:function offsetTime(date){return offsetDate(date).getTime()},sameDay,timeStringMinutes,timeToDate,timeUTC:function timeUTC(date){const dateDate=isDate(date)||isISODateString(date)?new Date(date):new Date;return Date.UTC(dateDate.getFullYear(),dateDate.getMonth(),dateDate.getDate())}};function makeDeepCopy(sourceObject,convertExtensions,internalUse,removeExtensions,iteration=0){const deepCopy=deepCopyEnabled(),{stringify,toJSON,ignore,modulate}=deepCopy||{};if(!(null==deepCopy?void 0:deepCopy.enabled)&&!internalUse||"object"!=typeof sourceObject||"function"==typeof sourceObject||null===sourceObject||"number"==typeof(null==deepCopy?void 0:deepCopy.threshold)&&iteration>=deepCopy.threshold)return sourceObject;const devContext=getDevContext({makeDeepCopy:!0});devContext&&(!function setDeepCopyIterations(value){globalState.iterators.makeDeepCopy=value}(iteration),(iteration>(devContext.iterationThreshold||15)||devContext.firstIteration&&0===iteration)&&devContext.log&&(!devContext.notInternalUse||devContext.notInternalUse&&!internalUse)&&console.log({devContext,iteration,internalUse},sourceObject));const targetObject=Array.isArray(sourceObject)?[]:{},sourceObjectKeys=Object.keys(sourceObject).filter((key=>!internalUse||!ignore||Array.isArray(ignore)&&!ignore.includes(key)||"function"==typeof ignore&&!ignore(key))),stringifyValue=(key,value)=>{targetObject[key]="function"==typeof(null==value?void 0:value.toString)?value.toString():JSON.stringify(value)};for(const key of sourceObjectKeys){const value=sourceObject[key],modulated="function"==typeof modulate?modulate(value):void 0;if(void 0!==modulated)targetObject[key]=modulated;else if(convertExtensions&&"extensions"===key&&Array.isArray(value)){const extensionConversions=extensionsToAttributes(value);Object.assign(targetObject,...extensionConversions)}else removeExtensions&&"extensions"===key?targetObject[key]=[]:Array.isArray(stringify)&&stringify.includes(key)?stringifyValue(key,value):Array.isArray(toJSON)&&toJSON.includes(key)&&"function"==typeof(null==value?void 0:value.toJSON)?targetObject[key]=value.toJSON():null===value?targetObject[key]=void 0:isDateObject(value)?targetObject[key]=new Date(value).toISOString():targetObject[key]=makeDeepCopy(value,convertExtensions,internalUse,removeExtensions,iteration+1)}return targetObject}function extensionsToAttributes(extensions=[]){return null==extensions?void 0:extensions.map((extension=>{const{name,value}=extension;return name&&value&&{[`_${name}`]:value}})).filter(Boolean)}function numericSort(a,b){return a-b}function flattenJSON(obj,keyJoiner,path=[]){return"object"==typeof obj&&Object.keys(obj).reduce(((result,key)=>"object"!=typeof obj[key]?(result[path.concat(key).join(keyJoiner)]=obj[key],result):Object.assign(result,flattenJSON(obj[key],keyJoiner,path.concat(key)))),{})}function UUID(){const lut=[];for(let i=0;i<256;i++)lut[i]=(i<16?"0":"")+i.toString(16);const d0=4294967295*Math.random()|0,d1=4294967295*Math.random()|0,d2=4294967295*Math.random()|0,d3=4294967295*Math.random()|0;return lut[255&d0]+lut[d0>>8&255]+lut[d0>>16&255]+lut[d0>>24&255]+"-"+lut[255&d1]+lut[d1>>8&255]+"-"+lut[d1>>16&15|64]+lut[d1>>24&255]+"-"+lut[63&d2|128]+lut[d2>>8&255]+"-"+lut[d2>>16&255]+lut[d2>>24&255]+lut[255&d3]+lut[d3>>8&255]+lut[d3>>16&255]+lut[d3>>24&255]}const RANKING$1="RANKING",RATING$2="RATING",SCALE$1="SCALE",SEEDING$1="SEEDING";var __defProp$4T=Object.defineProperty,__getOwnPropSymbols$4U=Object.getOwnPropertySymbols,__hasOwnProp$4U=Object.prototype.hasOwnProperty,__propIsEnum$4U=Object.prototype.propertyIsEnumerable,__defNormalProp$4T=(obj,key,value)=>key in obj?__defProp$4T(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4T=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4U.call(b,prop)&&__defNormalProp$4T(a,prop,b[prop]);if(__getOwnPropSymbols$4U)for(var prop of __getOwnPropSymbols$4U(b))__propIsEnum$4U.call(b,prop)&&__defNormalProp$4T(a,prop,b[prop]);return a};function getScaleValues({participant}){var _a;const scaleItems=null==(_a=participant.timeItems)?void 0:_a.filter((({itemType})=>(null==itemType?void 0:itemType.startsWith(SCALE$1))&&[RANKING$1,RATING$2,SEEDING$1].includes(itemType.split(".")[1]))),scales={ratings:{},rankings:{},seedings:{}};if(null==scaleItems?void 0:scaleItems.length){const latestScaleItem=scaleType=>scaleItems.filter((timeItem=>(null==timeItem?void 0:timeItem.itemType)===scaleType)).sort(((a,b)=>new Date(a.createdAt||void 0)-new Date(b.createdAt||void 0))).pop(),itemTypes=unique(scaleItems.map((({itemType})=>itemType)));for(const itemType of itemTypes){const scaleItem=latestScaleItem(itemType);if(scaleItem){const[,type,format,scaleName]=scaleItem.itemType.split("."),scaleType="seedings"===type||type===RANKING$1?"rankings":"ratings";scales[scaleType][format]||(scales[scaleType][format]=[]),scales[scaleType][format].push({scaleValue:scaleItem.itemValue,scaleDate:scaleItem.itemDate,scaleName})}}}return __spreadValues$4T(__spreadValues$4T({},SUCCESS),scales)}const POLICY_TYPE_VOLUNTARY_CONSOLATION="voluntaryConsolation",POLICY_TYPE_COMPETITIVE_BANDS="competitiveBands",POLICY_TYPE_ROUND_ROBIN_TALLY="roundRobinTally",POLICY_TYPE_POSITION_ACTIONS="positionActions",POLICY_TYPE_MATCHUP_ACTIONS="matchUpActions",POLICY_TYPE_ROUND_NAMING="roundNaming",POLICY_TYPE_PARTICIPANT="participant",POLICY_TYPE_PROGRESSION="progression",POLICY_TYPE_SCHEDULING="scheduling",POLICY_TYPE_SEEDING="seeding",POLICY_TYPE_SCORING="scoring",POLICY_TYPE_FEED_IN="feedIn",POLICY_TYPE_DRAWS="draws";function findParticipant({tournamentParticipants=[],policyDefinitions={},contextProfile,participantId,internalUse,personId}){const participant=tournamentParticipants.find((candidate=>participantId&&candidate.participantId===participantId||personId&&candidate.person&&candidate.person.personId===personId));if(participant){const participantAttributes=null==policyDefinitions?void 0:policyDefinitions[POLICY_TYPE_PARTICIPANT];if(null==contextProfile?void 0:contextProfile.withScaleValues){const{ratings,rankings}=getScaleValues({participant});participant.ratings=ratings,participant.rankings=rankings}if(null==participantAttributes?void 0:participantAttributes.participant){return makeDeepCopy(attributeFilter({template:participantAttributes.participant,source:participant}),!1,internalUse)}}return makeDeepCopy(participant,!1,internalUse)}function isValidExtension({requiredAttributes=["name","value"],extension}){if(!extension||"object"!=typeof extension)return!1;if("string"!=typeof extension.name)return!1;const extensionAttributes=Object.keys(extension);return requiredAttributes.filter((attribute=>extensionAttributes.includes(attribute))).length===requiredAttributes.length}var __defProp$4S=Object.defineProperty,__getOwnPropSymbols$4T=Object.getOwnPropertySymbols,__hasOwnProp$4T=Object.prototype.hasOwnProperty,__propIsEnum$4T=Object.prototype.propertyIsEnumerable,__defNormalProp$4S=(obj,key,value)=>key in obj?__defProp$4S(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4S=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4T.call(b,prop)&&__defNormalProp$4S(a,prop,b[prop]);if(__getOwnPropSymbols$4T)for(var prop of __getOwnPropSymbols$4T(b))__propIsEnum$4T.call(b,prop)&&__defNormalProp$4S(a,prop,b[prop]);return a};function decorateResult({result,stack,context,info}){return Array.isArray(result.stack)||(result.stack=[]),stack&&result.stack.push(stack),info&&result.error&&(result.error.info=info),"object"==typeof context&&Object.keys(context).length&&Object.assign(result,definedAttributes(context)),result.error||result.success||Object.assign(result,__spreadValues$4S({},SUCCESS)),result}var __defProp$4R=Object.defineProperty,__getOwnPropSymbols$4S=Object.getOwnPropertySymbols,__hasOwnProp$4S=Object.prototype.hasOwnProperty,__propIsEnum$4S=Object.prototype.propertyIsEnumerable,__defNormalProp$4R=(obj,key,value)=>key in obj?__defProp$4R(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4R=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4S.call(b,prop)&&__defNormalProp$4R(a,prop,b[prop]);if(__getOwnPropSymbols$4S)for(var prop of __getOwnPropSymbols$4S(b))__propIsEnum$4S.call(b,prop)&&__defNormalProp$4R(a,prop,b[prop]);return a};function addExtension$1({element,extension,creationTime=!0}={}){const stack="addExtension";if(!element)return decorateResult({result:{error:MISSING_VALUE},stack});if("object"!=typeof element)return decorateResult({result:{error:INVALID_VALUES},stack});if(!isValidExtension({extension}))return decorateResult({result:{error:INVALID_VALUES,info:"invalid extension"},stack});if(element.extensions||(element.extensions=[]),creationTime){const createdAt=(new Date).toISOString();Object.assign(extension,{createdAt})}const existingExtension=element.extensions.find((({name})=>name===extension.name));return existingExtension?existingExtension.value=extension.value:extension.value&&element.extensions.push(extension),__spreadValues$4R({},SUCCESS)}const ELEMENT_REQUIRED="element required",MISSING_NAME="missing name";var __defProp$4Q=Object.defineProperty,__defProps$2N=Object.defineProperties,__getOwnPropDescs$2N=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4R=Object.getOwnPropertySymbols,__hasOwnProp$4R=Object.prototype.hasOwnProperty,__propIsEnum$4R=Object.prototype.propertyIsEnumerable,__defNormalProp$4Q=(obj,key,value)=>key in obj?__defProp$4Q(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4Q=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4R.call(b,prop)&&__defNormalProp$4Q(a,prop,b[prop]);if(__getOwnPropSymbols$4R)for(var prop of __getOwnPropSymbols$4R(b))__propIsEnum$4R.call(b,prop)&&__defNormalProp$4Q(a,prop,b[prop]);return a},__spreadProps$2N=(a,b)=>__defProps$2N(a,__getOwnPropDescs$2N(b));function removeExtension$1({element,name}={}){return element?"object"!=typeof element?{error:INVALID_VALUES}:name?element.extensions?(element.extensions=element.extensions.filter((extension=>(null==extension?void 0:extension.name)!==name)),__spreadValues$4Q({},SUCCESS)):__spreadProps$2N(__spreadValues$4Q({},SUCCESS),{info:NOT_FOUND}):{error:MISSING_VALUE,info:MISSING_NAME}:{error:MISSING_VALUE,info:ELEMENT_REQUIRED}}function addTournamentExtension({creationTime=!0,tournamentRecord,extension}={}){return tournamentRecord?addExtension$1({element:tournamentRecord,extension,creationTime}):{error:MISSING_TOURNAMENT_RECORD}}function addDrawDefinitionExtension({creationTime=!0,drawDefinition,extension}={}){return drawDefinition?addExtension$1({element:drawDefinition,extension,creationTime}):{error:DRAW_DEFINITION_NOT_FOUND}}function addEventExtension$1({creationTime=!0,extension,event}={}){return event?addExtension$1({element:event,extension,creationTime}):{error:MISSING_EVENT}}function removeTournamentExtension({tournamentRecord,name}={}){return tournamentRecord?removeExtension$1({element:tournamentRecord,name}):{error:MISSING_TOURNAMENT_RECORD}}function removeEventExtension({event,name}={}){return event?removeExtension$1({element:event,name}):{error:EVENT_NOT_FOUND}}function copyTieFormat(tieFormat){return makeDeepCopy(tieFormat,!1,!0)}function mustBeAnArray(value){return`${value} must be an array`}const SINGLES_MATCHUP="SINGLES",SINGLES$1="SINGLES",DOUBLES_MATCHUP="DOUBLES",DOUBLES$1="DOUBLES",TEAM_MATCHUP="TEAM",TEAM$2="TEAM";var __defProp$4P=Object.defineProperty,__getOwnPropSymbols$4Q=Object.getOwnPropertySymbols,__hasOwnProp$4Q=Object.prototype.hasOwnProperty,__propIsEnum$4Q=Object.prototype.propertyIsEnumerable,__defNormalProp$4P=(obj,key,value)=>key in obj?__defProp$4P(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4P=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4Q.call(b,prop)&&__defNormalProp$4P(a,prop,b[prop]);if(__getOwnPropSymbols$4Q)for(var prop of __getOwnPropSymbols$4Q(b))__propIsEnum$4Q.call(b,prop)&&__defNormalProp$4P(a,prop,b[prop]);return a};function validateTieFormat({checkCollectionIds=!0,tieFormat}={}){var _a,_b,_c,_d;const stack="validateTieFormat",errors=[];if("object"!=typeof tieFormat)return errors.push("tieFormat must be an object"),decorateResult({result:{error:INVALID_TIE_FORMAT,stack,context:{tieFormat,errors}}});if("object"!=typeof tieFormat.winCriteria)return errors.push("tieFormat.winCriteria must be an object"),decorateResult({result:{error:INVALID_TIE_FORMAT,stack,context:{tieFormat,errors}}});if(!Array.isArray(tieFormat.collectionDefinitions))return errors.push(mustBeAnArray("tieFormat.collectionDefinitions")),decorateResult({result:{error:INVALID_TIE_FORMAT,stack,context:{tieFormat,errors}}});let aggregateValueImperative;const validCollections=tieFormat.collectionDefinitions.every((collectionDefinition=>{const{setValue,scoreValue,collectionValue}=collectionDefinition;!setValue&&!scoreValue||collectionValue||(aggregateValueImperative=!0);const{valid:valid2,errors:collectionDefinitionErrors}=validateCollectionDefinition({collectionDefinition,checkCollectionIds});return!!valid2||(errors.push(...collectionDefinitionErrors),!1)})),validWinCriteria="number"==typeof(null==(_a=tieFormat.winCriteria)?void 0:_a.valueGoal)&&(null==(_b=tieFormat.winCriteria)?void 0:_b.valueGoal)>0&&!aggregateValueImperative||(null==(_c=tieFormat.winCriteria)?void 0:_c.aggregateValue);if(!validWinCriteria&&!(null==(_d=tieFormat.winCriteria)?void 0:_d.aggregateValue))return aggregateValueImperative?errors.push("aggregateValue is required"):errors.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),decorateResult({result:{context:{tieFormat,errors,aggregateValueImperative},error:INVALID_TIE_FORMAT,stack}});const collectionIds=tieFormat.collectionDefinitions.map((({collectionId})=>collectionId)),uniqueCollectionIds=!checkCollectionIds||collectionIds.length===unique(collectionIds).length,valid=validCollections&&validWinCriteria&&uniqueCollectionIds;return valid?{valid,errors}:decorateResult({result:{context:{tieFormat,errors},error:INVALID_TIE_FORMAT,stack}})}function validateCollectionDefinition({checkValueDefinition=!0,collectionDefinition,checkCollectionIds}){const errors=[];if("object"!=typeof collectionDefinition)return errors.push(`collectionDefinition must be an object: ${collectionDefinition}`),{errors};const{collectionValueProfile,collectionGroupNumber,collectionValue,collectionId,matchUpCount,matchUpFormat,matchUpValue,matchUpType,scoreValue,setValue}=collectionDefinition;if(checkCollectionIds&&"string"!=typeof collectionId)return errors.push(`collectionId is not type string: ${collectionId}`),{errors};if("number"!=typeof matchUpCount)return errors.push(`matchUpCount is not type number: ${matchUpCount}`),{errors};if(![SINGLES$1,DOUBLES$1].includes(matchUpType))return errors.push(`matchUpType must be SINGLES or DOUBLES: ${matchUpType}`),{errors};if(checkValueDefinition&&!matchUpValue&&!collectionValue&&!collectionValueProfile&&!scoreValue&&!setValue)return errors.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfile"),{errors};if(matchUpValue&&"number"!=typeof matchUpValue)return errors.push(`matchUpValue is not type number: ${matchUpValue}`),{errors};if(collectionValue&&"number"!=typeof collectionValue)return errors.push(`collectionValue is not type number: ${collectionValue}`),{errors};if(collectionValueProfile){const result=validateCollectionValueProfile({collectionValueProfile,matchUpCount});if(result.errors)return errors.push(...result.errors),{errors}}return collectionGroupNumber&&"number"!=typeof collectionGroupNumber?(errors.push(`collectionValue is not type number: ${collectionValue}`),{errors}):matchUpFormat&&!matchUpFormatCode.isValid(matchUpFormat)?(errors.push(`Invalid matchUpFormat: ${matchUpFormat}`),{errors}):{valid:!0}}function validateCollectionValueProfile({collectionValueProfile,matchUpCount}){const errors=[];if(!Array.isArray(collectionValueProfile))return errors.push(`collectionValueProfile is not an array: ${collectionValueProfile}`),{errors};if(collectionValueProfile.length!==matchUpCount)return errors.push("collectionValueProfile does not align with matchUpsCount"),{errors};for(const valueProfile of collectionValueProfile){if("object"!=typeof valueProfile)return errors.push(`valueProfile is not type object: ${valueProfile}`),{errors};const{value,collectionPosition}=valueProfile;if("number"!=typeof value||"number"!=typeof collectionPosition||collectionPosition>matchUpCount||collectionPosition<1)return errors.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors}}const collectionPositions=collectionValueProfile.map((valueProfile=>valueProfile.collectionPosition));return collectionPositions.length!==unique(collectionPositions).length?(errors.push("collectionPositions are not unique"),{errors}):__spreadValues$4P({},SUCCESS)}const ABANDONED="ABANDONED",AWAITING_RESULT="AWAITING_RESULT",BYE="BYE",CANCELLED$1="CANCELLED",COMPLETED$1="COMPLETED",DEAD_RUBBER="DEAD_RUBBER",DEFAULTED="DEFAULTED",DOUBLE_DEFAULT="DOUBLE_DEFAULT",DOUBLE_WALKOVER="DOUBLE_WALKOVER",IN_PROGRESS$1="IN_PROGRESS",INCOMPLETE="INCOMPLETE",RETIRED$1="RETIRED",SUSPENDED="SUSPENDED",TO_BE_PLAYED="TO_BE_PLAYED",WALKOVER$2="WALKOVER",particicipantsRequiredMatchUpStatuses=[AWAITING_RESULT,COMPLETED$1,DEFAULTED,DOUBLE_WALKOVER,DOUBLE_DEFAULT,IN_PROGRESS$1,INCOMPLETE,RETIRED$1,SUSPENDED,WALKOVER$2],validMatchUpStatuses=[ABANDONED,AWAITING_RESULT,BYE,CANCELLED$1,COMPLETED$1,DEAD_RUBBER,DEFAULTED,DOUBLE_WALKOVER,DOUBLE_DEFAULT,IN_PROGRESS$1,INCOMPLETE,"NOT_PLAYED",RETIRED$1,SUSPENDED,TO_BE_PLAYED,WALKOVER$2],directingMatchUpStatuses=[BYE,DOUBLE_WALKOVER,DOUBLE_DEFAULT,COMPLETED$1,DEFAULTED,RETIRED$1,WALKOVER$2],nonDirectingMatchUpStatuses=[ABANDONED,AWAITING_RESULT,CANCELLED$1,DEAD_RUBBER,IN_PROGRESS$1,INCOMPLETE,"NOT_PLAYED",SUSPENDED,TO_BE_PLAYED,void 0],completedMatchUpStatuses=[CANCELLED$1,ABANDONED,COMPLETED$1,DEAD_RUBBER,DEFAULTED,DOUBLE_WALKOVER,DOUBLE_DEFAULT,RETIRED$1,WALKOVER$2],activeMatchUpStatuses=[ABANDONED,COMPLETED$1,DEFAULTED,DOUBLE_WALKOVER,DOUBLE_DEFAULT,IN_PROGRESS$1,RETIRED$1,WALKOVER$2],upcomingMatchUpStatuses=[IN_PROGRESS$1,INCOMPLETE,SUSPENDED,TO_BE_PLAYED],matchUpStatusConstants={ABANDONED,AWAITING_RESULT,BYE,CANCELLED:CANCELLED$1,COMPLETED:COMPLETED$1,DEAD_RUBBER,DEFAULTED,DOUBLE_WALKOVER,DOUBLE_DEFAULT,IN_PROGRESS:IN_PROGRESS$1,INCOMPLETE,NOT_PLAYED:"NOT_PLAYED",RETIRED:RETIRED$1,SUSPENDED,TO_BE_PLAYED,WALKOVER:WALKOVER$2};var __defProp$4O=Object.defineProperty,__defProps$2M=Object.defineProperties,__getOwnPropDescs$2M=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4P=Object.getOwnPropertySymbols,__hasOwnProp$4P=Object.prototype.hasOwnProperty,__propIsEnum$4P=Object.prototype.propertyIsEnumerable,__defNormalProp$4O=(obj,key,value)=>key in obj?__defProp$4O(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4O=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4P.call(b,prop)&&__defNormalProp$4O(a,prop,b[prop]);if(__getOwnPropSymbols$4P)for(var prop of __getOwnPropSymbols$4P(b))__propIsEnum$4P.call(b,prop)&&__defNormalProp$4O(a,prop,b[prop]);return a},__spreadProps$2M=(a,b)=>__defProps$2M(a,__getOwnPropDescs$2M(b));function getGroupValueGroups({collectionGroups=[]}={}){const groupValueGroups=Object.assign({},...collectionGroups.filter((group=>(null==group?void 0:group.groupValue)&&(null==group?void 0:group.groupNumber))).map((group=>({[group.groupNumber]:__spreadProps$2M(__spreadValues$4O({},group),{allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]})}))));return{groupValueGroups,groupValueNumbers:Object.keys(groupValueGroups).map((num=>parseInt(num)))}}function generateTieMatchUpScore({sideAdjustments=[0,0],separator="-",tieFormat,matchUp}){if(!Array.isArray(sideAdjustments)||2!==sideAdjustments.length||isNaN(sideAdjustments.reduce(((a,b)=>a+b))))return{error:INVALID_VALUES};if(!matchUp)return{error:MISSING_MATCHUP};if(!(tieFormat=matchUp.tieFormat||tieFormat))return{error:MISSING_TIE_FORMAT};const result=validateTieFormat({tieFormat});if(result.error)return result;const sideTieValues=[0,0],tieMatchUps=(null==matchUp?void 0:matchUp.tieMatchUps)||[],collectionDefinitions=(null==tieFormat?void 0:tieFormat.collectionDefinitions)||[],{groupValueGroups,groupValueNumbers}=getGroupValueGroups(tieFormat);for(const collectionDefinition of collectionDefinitions){const collectionMatchUps=tieMatchUps.filter((matchUp2=>matchUp2.collectionId===collectionDefinition.collectionId)),sideMatchUpValues=[0,0];let sideCollectionValues=[0,0];const allCollectionMatchUpsCompleted=collectionMatchUps.every((matchUp2=>completedMatchUpStatuses.includes(matchUp2.matchUpStatus))),{collectionValueProfiles,collectionGroupNumber,collectionValue,matchUpValue,winCriteria,scoreValue,setValue}=collectionDefinition,belongsToValueGroup=collectionGroupNumber&&groupValueNumbers.includes(collectionGroupNumber),sideWins=[0,0];if(collectionMatchUps.forEach((matchUp2=>{matchUp2.winningSide&&(sideWins[matchUp2.winningSide-1]+=1)})),matchUpValue?collectionMatchUps.forEach((matchUp2=>{matchUp2.winningSide&&(sideMatchUpValues[matchUp2.winningSide-1]+=matchUpValue)})):setValue?collectionMatchUps.forEach((matchUp2=>{var _a,_b;null==(_b=null==(_a=matchUp2.score)?void 0:_a.sets)||_b.forEach((set2=>{set2.winningSide&&(sideMatchUpValues[set2.winningSide-1]+=setValue)}))})):scoreValue?collectionMatchUps.forEach((matchUp2=>{var _a,_b;null==(_b=null==(_a=matchUp2.score)?void 0:_a.sets)||_b.forEach((set2=>{const{side1TiebreakScore=0,side2TiebreakScore=0,side1Score=0,side2Score=0}=set2;(set2.winningSide||matchUp2.winningSide)&&(side1Score||side2Score?(sideMatchUpValues[0]+=side1Score,sideMatchUpValues[1]+=side2Score):(side1TiebreakScore||side2TiebreakScore)&&set2.winningSide&&(sideMatchUpValues[set2.winningSide-1]+=1))}))})):Array.isArray(collectionValueProfiles)&&collectionMatchUps.forEach((matchUp2=>{if(matchUp2.winningSide){const collectionPosition=matchUp2.collectionPosition,matchUpValue2=getCollectionPositionValue({collectionDefinition,collectionPosition});sideMatchUpValues[matchUp2.winningSide-1]+=matchUpValue2}})),collectionValue){let collectionWinningSide;if(null==winCriteria?void 0:winCriteria.aggregateValue)allCollectionMatchUpsCompleted&&((matchUpValue||setValue||scoreValue)&&sideMatchUpValues[0]!==sideMatchUpValues[1]?collectionWinningSide=sideMatchUpValues[0]>sideMatchUpValues[1]?1:2:sideWins[0]!==sideWins[1]&&(collectionWinningSide=sideWins[0]>sideWins[1]?1:2));else if(null==winCriteria?void 0:winCriteria.valueGoal)collectionWinningSide=sideMatchUpValues.reduce(((winningSide2,side,i)=>side>=winCriteria.valueGoal?i+1:winningSide2),void 0);else{const winGoal=Math.floor(collectionDefinition.matchUpCount/2)+1;collectionWinningSide=sideWins.reduce(((winningSide2,side,i)=>side>=winGoal?i+1:winningSide2),void 0)}collectionWinningSide&&(belongsToValueGroup?groupValueGroups[collectionGroupNumber].values[collectionWinningSide-1]+=collectionValue:sideCollectionValues[collectionWinningSide-1]+=collectionValue)}else belongsToValueGroup?(groupValueGroups[collectionGroupNumber].values[0]+=sideMatchUpValues[0]||0,groupValueGroups[collectionGroupNumber].values[1]+=sideMatchUpValues[1]||0):sideCollectionValues=sideMatchUpValues;belongsToValueGroup?(groupValueGroups[collectionGroupNumber].sideWins[0]+=sideWins[0]||0,groupValueGroups[collectionGroupNumber].sideWins[1]+=sideWins[1]||0,groupValueGroups[collectionGroupNumber].allGroupMatchUpsCompleted=groupValueGroups[collectionGroupNumber].allGroupMatchUpsCompleted&&allCollectionMatchUpsCompleted,groupValueGroups[collectionGroupNumber].matchUpsCount+=collectionMatchUps.length):sideCollectionValues.forEach(((sideCollectionValue,i)=>sideTieValues[i]+=sideCollectionValue))}for(const groupNumber of groupValueNumbers){const group=groupValueGroups[groupNumber];let groupWinningSide,{allGroupMatchUpsCompleted,groupValue,matchUpCount,sideWins,winCriteria,values}=group;if(null==winCriteria?void 0:winCriteria.aggregateValue)allGroupMatchUpsCompleted&&values[0]!==values[1]&&(groupWinningSide=values[0]>values[1]?1:2);else if(null==winCriteria?void 0:winCriteria.valueGoal)groupWinningSide=values.reduce(((winningSide2,side,i)=>side>=winCriteria.valueGoal?i+1:winningSide2),void 0);else{const winGoal=Math.floor(matchUpCount/2)+1;groupWinningSide=sideWins.reduce(((winningSide2,side,i)=>side>=winGoal?i+1:winningSide2),void 0)}groupWinningSide&&(sideTieValues[groupWinningSide-1]+=groupValue)}const sideScores=sideTieValues.map(((sideTieValue,i)=>sideTieValue+sideAdjustments[i])),set={side1Score:sideScores[0],side2Score:sideScores[1]},scoreStringSide1=sideScores.join(separator),scoreStringSide2=sideScores.slice().reverse().join(separator);let winningSide;if(null==tieFormat?void 0:tieFormat.winCriteria){const{valueGoal,aggregateValue}=tieFormat.winCriteria;if(valueGoal){const sideThatWon=sideScores.map(((points,sideIndex)=>({sideNumber:sideIndex+1,points}))).find((({points})=>points>=valueGoal));winningSide=null==sideThatWon?void 0:sideThatWon.sideNumber}else if(aggregateValue){tieMatchUps.every((matchUp2=>completedMatchUpStatuses.includes(matchUp2.matchUpStatus)||matchUp2.winningSide))&&sideScores[0]!==sideScores[1]&&(winningSide=sideScores[0]>sideScores[1]?1:2)}}return winningSide&&(set.winningSide=winningSide),{scoreStringSide1,scoreStringSide2,winningSide,set}}function getCollectionPositionValue({collectionDefinition,collectionPosition}){const collectionValueProfiles=collectionDefinition.collectionValueProfiles||[],profile=null==collectionValueProfiles?void 0:collectionValueProfiles.find((profile2=>profile2.collectionPosition===collectionPosition));return null==profile?void 0:profile.matchUpValue}function findExtension$2({element,name}){const stack="findExtension";if(!element||!name)return decorateResult({result:{error:MISSING_VALUE},stack});if(!Array.isArray(element.extensions))return decorateResult({result:{error:NOT_FOUND},stack});const extension=element.extensions.find((extension2=>(null==extension2?void 0:extension2.name)===name));return extension?{extension}:decorateResult({result:{error:NOT_FOUND},stack})}const APPLIED_POLICIES="appliedPolicies",AUDIT_POSITION_ACTIONS="positionActions",CONTEXT="context",DELEGATED_OUTCOME="delegatedOutcome",DISABLED="disabled",DISABLE_LINKS="disableLinks",DISABLE_AUTO_CALC="disableAutoCalc",DRAW_DELETIONS="drawDeletions",ENTRY_PROFILE="entryProfile",FLIGHT_PROFILE="flightProfile",GROUPING_ATTRIBUTE="groupingAttribute",LINEUPS="lineUps",LINKED_TOURNAMENTS="linkedTournamentsIds",MATCHUP_HISTORY="matchUpHistory",PERSON_REQUESTS="personRequests",ROUND_TARGET="roundTarget",SCHEDULE_LIMITS="scheduleLimits",SCHEDULE_TIMING="scheduleTiming",SCHEDULING_PROFILE="schedulingProfile",SUB_ORDER="subOrder",TALLY="tally",TIE_FORMAT_MODIFICATIONS="tieFormatModification",extensionConstants={APPLIED_POLICIES,AUDIT_POSITION_ACTIONS,CONTEXT,DELEGATED_OUTCOME,DISABLED,DISABLE_LINKS,DISABLE_AUTO_CALC,DRAW_DELETIONS,DRAW_PROFILE:"drawProfile",ENTRY_PROFILE,EVENT_PROFILE:"eventProfile",FLIGHT_PROFILE,GROUPING_ATTRIBUTE,LINEUPS,LINKED_TOURNAMENTS,MATCHUP_HISTORY,PARTICIPANT_REPRESENTATIVES:"participantRepresentatives",PERSON_REQUESTS,RANKING_POINTS:"rankingPoints",ROUND_TARGET,SCHEDULE_LIMITS,SCHEDULE_TIMING,SCHEDULING_PROFILE,SUB_ORDER,TALLY,TIE_FORMAT_MODIFICATIONS,FACTORY:"factory"},internalExtensions=[DELEGATED_OUTCOME,DISABLED,DISABLE_LINKS,FLIGHT_PROFILE,LINEUPS,MATCHUP_HISTORY,"participantRepresentatives",PERSON_REQUESTS,ROUND_TARGET,SCHEDULE_LIMITS,SCHEDULE_TIMING,SCHEDULING_PROFILE,SUB_ORDER,TALLY];var __defProp$4N=Object.defineProperty,__getOwnPropSymbols$4O=Object.getOwnPropertySymbols,__hasOwnProp$4O=Object.prototype.hasOwnProperty,__propIsEnum$4O=Object.prototype.propertyIsEnumerable,__defNormalProp$4N=(obj,key,value)=>key in obj?__defProp$4N(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4N=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4O.call(b,prop)&&__defNormalProp$4N(a,prop,b[prop]);if(__getOwnPropSymbols$4O)for(var prop of __getOwnPropSymbols$4O(b))__propIsEnum$4O.call(b,prop)&&__defNormalProp$4N(a,prop,b[prop]);return a};function getAppliedPolicies({onlySpecifiedPolicyTypes=!1,policyTypes=[],tournamentRecord,drawDefinition,structure,event}){if(!Array.isArray(policyTypes))return{error:MISSING_POLICY_TYPE};const appliedPolicies={};return tournamentRecord&&extractAppliedPolicies(tournamentRecord),event&&extractAppliedPolicies(event),drawDefinition&&extractAppliedPolicies(drawDefinition),structure&&extractAppliedPolicies(structure),__spreadValues$4N({appliedPolicies},SUCCESS);function extractAppliedPolicies({extensions}){var _a;const extensionPolicies=null==(_a=null==extensions?void 0:extensions.find((extension=>extension.name===APPLIED_POLICIES)))?void 0:_a.value;if(extensionPolicies)for(const key of Object.keys(extensionPolicies))(onlySpecifiedPolicyTypes?policyTypes.includes(key):!policyTypes.length||policyTypes.includes(key))&&(appliedPolicies[key]=makeDeepCopy(extensionPolicies[key],!1,!0))}}function getPolicyDefinitions({policyTypes=[],tournamentRecord,drawDefinition,structure,event}){if(!Array.isArray(policyTypes))return{error:MISSING_POLICY_TYPE};const{appliedPolicies}=getAppliedPolicies({tournamentRecord,drawDefinition,structure,event}),policyDefinitions={};for(const policyType of policyTypes){const policy=appliedPolicies[policyType];policy&&(policyDefinitions[policyType]=policy)}return Object.keys(policyDefinitions).length?{policyDefinitions}:{error:POLICY_NOT_FOUND}}const WALKOVER$1="WALKOVER",COMPETITIVE="COMPETITIVE",ROUTINE="ROUTINE",DECISIVE="DECISIVE",WIN_RATIO$1="winRatio",POLICY_COMPETITIVE_BANDS_DEFAULT={[POLICY_TYPE_COMPETITIVE_BANDS]:{policyName:"Competitive Bands Default",competitiveProfile:{[DECISIVE]:20,[ROUTINE]:50}}};function getContextContent({policyDefinitions,tournamentRecord,contextProfile,drawDefinition,event}){const contextContent={policies:{}};if(!contextProfile)return contextContent;const policies=getPolicyDefinitions({tournamentRecord,drawDefinition,event});if(contextProfile.withCompetitiveness){const policy=(null==policyDefinitions?void 0:policyDefinitions[POLICY_TYPE_COMPETITIVE_BANDS])||(null==policies?void 0:policies[POLICY_TYPE_COMPETITIVE_BANDS])||POLICY_COMPETITIVE_BANDS_DEFAULT[POLICY_TYPE_COMPETITIVE_BANDS];contextContent.policies[POLICY_TYPE_COMPETITIVE_BANDS]=policy}return contextContent}function findPolicy({tournamentRecord,drawDefinition,policyType,structure,event}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{appliedPolicies}=getAppliedPolicies({tournamentRecord,drawDefinition,structure,event});return(null==appliedPolicies?void 0:appliedPolicies[policyType])?{policy:appliedPolicies[policyType]}:{error:POLICY_NOT_FOUND}}const add=(a,b)=>(a||0)+(b||0);function getBand(spread,bandProfiles){return isNaN(spread)?WALKOVER$1:spread<=bandProfiles[DECISIVE]?DECISIVE:spread<=bandProfiles[ROUTINE]?ROUTINE:COMPETITIVE}function getScoreComponents({score}){const sets=(null==score?void 0:score.sets)||[],games=sets.reduce(((p,c)=>(p[0]+=c.side1Score||0,p[1]+=c.side2Score||0,p)),[0,0]);let stb=sets.reduce(((p,c)=>(p[0]+=c.side1TiebreakScore||0,p[1]+=c.side2TiebreakScore||0,p)),[0,0]);return stb.reduce(add)&&(games[stb[0]>stb[1]?0:1]+=1),{sets,games,score}}function gamesPercent(scoreComponents){const minGames=Math.min(...scoreComponents.games),maxGames=Math.max(...scoreComponents.games);return Math.round(minGames/maxGames*100)}function pctSpread(pcts){return pcts.map(gamesPercent).sort().map((p=>p.toFixed(2)))}var __defProp$4M=Object.defineProperty,__defProps$2L=Object.defineProperties,__getOwnPropDescs$2L=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4N=Object.getOwnPropertySymbols,__hasOwnProp$4N=Object.prototype.hasOwnProperty,__propIsEnum$4N=Object.prototype.propertyIsEnumerable,__defNormalProp$4M=(obj,key,value)=>key in obj?__defProp$4M(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4M=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4N.call(b,prop)&&__defNormalProp$4M(a,prop,b[prop]);if(__getOwnPropSymbols$4N)for(var prop of __getOwnPropSymbols$4N(b))__propIsEnum$4N.call(b,prop)&&__defNormalProp$4M(a,prop,b[prop]);return a},__spreadProps$2L=(a,b)=>__defProps$2L(a,__getOwnPropDescs$2L(b));function getMatchUpCompetitiveness({competitiveProfile,tournamentRecord,matchUp}){if(!matchUp)return{error:MISSING_MATCHUP};const{score,winningSide}=matchUp;if(!winningSide)return{error:INVALID_VALUES};const policy=!competitiveProfile&&findPolicy({policyType:POLICY_TYPE_COMPETITIVE_BANDS,tournamentRecord}).policy,bandProfiles=competitiveProfile||(null==policy?void 0:policy.competitiveProfile)||POLICY_COMPETITIVE_BANDS_DEFAULT[POLICY_TYPE_COMPETITIVE_BANDS].competitiveProfile,competitiveness=getBand(pctSpread([getScoreComponents({score})]),bandProfiles);return __spreadProps$2L(__spreadValues$4M({},SUCCESS),{competitiveness})}function findCategoryTiming({categoryName,categoryType,timesBlockArray}){return timesBlockArray.filter((f=>Array.isArray(f))).map((times=>times.sort(((a,b)=>{var _a,_b;return((null==(_a=b.categoryNames)?void 0:_a.length)||0)-((null==(_b=a.categoryNames)?void 0:_b.length)||0)})).find((({categoryTypes,categoryNames})=>!(null==categoryNames?void 0:categoryNames.length)&&!(null==categoryTypes?void 0:categoryTypes.length)||(null==categoryNames?void 0:categoryNames.includes(categoryName))||(null==categoryTypes?void 0:categoryTypes.includes(categoryType)))))).find(Boolean)}function findMatchupFormatAverageTimes({matchUpAverageTimes,matchUpFormat}={}){const codeMatches=(null==matchUpAverageTimes?void 0:matchUpAverageTimes.map((({matchUpFormatCodes})=>null==matchUpFormatCodes?void 0:matchUpFormatCodes.filter((code=>code===matchUpFormat)))).flat().filter(Boolean).sort(((a,b)=>((null==a?void 0:a.length)||0)-((null==b?void 0:b.length)||0))))||[],targetCode=codeMatches.includes(matchUpFormat)?matchUpFormat:codeMatches[0],targetDefinition=null==matchUpAverageTimes?void 0:matchUpAverageTimes.find((({matchUpFormatCodes,averageTimes})=>(null==matchUpFormatCodes?void 0:matchUpFormatCodes.find((code=>targetCode===code)))&&averageTimes));return null==targetDefinition?void 0:targetDefinition.averageTimes}function findMatchupFormatRecoveryTimes({matchUpRecoveryTimes,averageMinutes,matchUpFormat}={}){var _a;return null==(_a=null==matchUpRecoveryTimes?void 0:matchUpRecoveryTimes.find((({matchUpFormatCodes,averageTimes,recoveryTimes})=>{if(averageTimes&&averageMinutes){const{greaterThan=0,lessThan=360}=averageTimes;if(averageMinutes>greaterThan&&averageMinutes<lessThan)return!0}return(null==matchUpFormatCodes?void 0:matchUpFormatCodes.find((code=>code===matchUpFormat)))&&recoveryTimes})))?void 0:_a.recoveryTimes}var __defProp$4L=Object.defineProperty,__defProps$2K=Object.defineProperties,__getOwnPropDescs$2K=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4M=Object.getOwnPropertySymbols,__hasOwnProp$4M=Object.prototype.hasOwnProperty,__propIsEnum$4M=Object.prototype.propertyIsEnumerable,__defNormalProp$4L=(obj,key,value)=>key in obj?__defProp$4L(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4L=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4M.call(b,prop)&&__defNormalProp$4L(a,prop,b[prop]);if(__getOwnPropSymbols$4M)for(var prop of __getOwnPropSymbols$4M(b))__propIsEnum$4M.call(b,prop)&&__defNormalProp$4L(a,prop,b[prop]);return a},__spreadProps$2K=(a,b)=>__defProps$2K(a,__getOwnPropDescs$2K(b));var __defProp$4K=Object.defineProperty,__defProps$2J=Object.defineProperties,__getOwnPropDescs$2J=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4L=Object.getOwnPropertySymbols,__hasOwnProp$4L=Object.prototype.hasOwnProperty,__propIsEnum$4L=Object.prototype.propertyIsEnumerable,__defNormalProp$4K=(obj,key,value)=>key in obj?__defProp$4K(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4K=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4L.call(b,prop)&&__defNormalProp$4K(a,prop,b[prop]);if(__getOwnPropSymbols$4L)for(var prop of __getOwnPropSymbols$4L(b))__propIsEnum$4L.call(b,prop)&&__defNormalProp$4K(a,prop,b[prop]);return a},__spreadProps$2J=(a,b)=>__defProps$2J(a,__getOwnPropDescs$2J(b));function findTournamentParticipant({tournamentRecord,participantId}){return{participant:(tournamentRecord.participants||[]).reduce(((participant2,candidate)=>candidate.participantId===participantId?candidate:participant2),void 0)}}const stack="extensionQueries";function findExtension$1({element,name}){if(!element||!name)return decorateResult({result:{error:MISSING_VALUE},stack});if(!Array.isArray(element.extensions))return{info:NOT_FOUND};const extension=element.extensions.find((extension2=>(null==extension2?void 0:extension2.name)===name));return{extension,info:extension?void 0:NOT_FOUND}}function findTournamentExtension({tournamentRecord,name}){return findExtension$1({element:tournamentRecord,name})}function findEventExtension({event,name}){return event?findExtension$1({element:event,name}):decorateResult({result:{error:MISSING_EVENT},stack})}function findDrawDefinitionExtension({drawDefinition,name}){return drawDefinition?findExtension$1({element:drawDefinition,name}):decorateResult({result:{error:MISSING_DRAW_DEFINITION},stack})}function getScheduleTiming({tournamentRecord,categoryName,categoryType,event}){var _a,_b,_c,_d;categoryName=categoryName||(null==(_a=null==event?void 0:event.category)?void 0:_a.categoryName)||(null==(_b=null==event?void 0:event.category)?void 0:_b.ageCategoryCode),categoryType=categoryType||(null==(_c=null==event?void 0:event.category)?void 0:_c.categoryType)||(null==(_d=null==event?void 0:event.category)?void 0:_d.subType);const{policy}=findPolicy({policyType:POLICY_TYPE_SCHEDULING,tournamentRecord,event}),{extension:tournamentExtension}=findTournamentExtension({name:SCHEDULE_TIMING,tournamentRecord}),tournamentScheduling=null==tournamentExtension?void 0:tournamentExtension.value,{extension:eventExtension}=findEventExtension({name:SCHEDULE_TIMING,event});return{scheduleTiming:{tournamentScheduling,eventScheduling:null==eventExtension?void 0:eventExtension.value,categoryName,categoryType,policy}}}const DOUBLES_SINGLES="DOUBLES_SINGLES",SINGLES_DOUBLES="SINGLES_DOUBLES",TOTAL="total";var __defProp$4J=Object.defineProperty,__defProps$2I=Object.defineProperties,__getOwnPropDescs$2I=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4K=Object.getOwnPropertySymbols,__hasOwnProp$4K=Object.prototype.hasOwnProperty,__propIsEnum$4K=Object.prototype.propertyIsEnumerable,__defNormalProp$4J=(obj,key,value)=>key in obj?__defProp$4J(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4J=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4K.call(b,prop)&&__defNormalProp$4J(a,prop,b[prop]);if(__getOwnPropSymbols$4K)for(var prop of __getOwnPropSymbols$4K(b))__propIsEnum$4K.call(b,prop)&&__defNormalProp$4J(a,prop,b[prop]);return a},__spreadProps$2I=(a,b)=>__defProps$2I(a,__getOwnPropDescs$2I(b));function getMatchUpFormatTiming({defaultAverageMinutes=90,defaultRecoveryMinutes=0,tournamentRecord,matchUpFormat,categoryName,categoryType,eventType,event}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};eventType=eventType||(null==event?void 0:event.eventType)||SINGLES$1;const defaultTiming={averageTimes:[{minutes:{default:defaultAverageMinutes}}],recoveryTimes:[{minutes:{default:defaultRecoveryMinutes}}]},{scheduleTiming}=getScheduleTiming({tournamentRecord,categoryName,categoryType,event});return matchUpFormatTimes({eventType,timingDetails:__spreadProps$2I(__spreadValues$4J({},scheduleTiming),{matchUpFormat,categoryType,defaultTiming})})}function matchUpFormatTimes({eventType,timingDetails}){const averageTimes=function getMatchUpFormatAverageTimes({matchUpFormat,categoryName,categoryType,defaultTiming,tournamentScheduling,eventScheduling,policy}){var _a;return findCategoryTiming({categoryName,categoryType,timesBlockArray:[(null==eventScheduling?void 0:eventScheduling.matchUpAverageTimes)&&findMatchupFormatAverageTimes(__spreadProps$2J(__spreadValues$4K({},eventScheduling),{matchUpFormat})),(null==tournamentScheduling?void 0:tournamentScheduling.matchUpAverageTimes)&&findMatchupFormatAverageTimes(__spreadProps$2J(__spreadValues$4K({},tournamentScheduling),{matchUpFormat})),(null==policy?void 0:policy.matchUpAverageTimes)&&findMatchupFormatAverageTimes(__spreadProps$2J(__spreadValues$4K({},policy),{matchUpFormat})),null==(_a=null==policy?void 0:policy.defaultTimes)?void 0:_a.averageTimes,null==defaultTiming?void 0:defaultTiming.averageTimes]})}(timingDetails),averageKeys=Object.keys((null==averageTimes?void 0:averageTimes.minutes)||{}),averageMinutes=(null==averageTimes?void 0:averageTimes.minutes)&&((null==averageKeys?void 0:averageKeys.includes(eventType))&&averageTimes.minutes[eventType]||averageTimes.minutes.default),recoveryTimes=function getMatchUpFormatRecoveryTimes({matchUpFormat,categoryName,categoryType,averageMinutes,defaultTiming,tournamentScheduling,eventScheduling,policy}){var _a;return findCategoryTiming({categoryName,categoryType,timesBlockArray:[(null==eventScheduling?void 0:eventScheduling.matchUpRecoveryTimes)&&findMatchupFormatRecoveryTimes(__spreadProps$2K(__spreadValues$4L({},eventScheduling),{averageMinutes,matchUpFormat})),(null==tournamentScheduling?void 0:tournamentScheduling.matchUpRecoveryTimes)&&findMatchupFormatRecoveryTimes(__spreadProps$2K(__spreadValues$4L({},tournamentScheduling),{averageMinutes,matchUpFormat})),(null==policy?void 0:policy.matchUpRecoveryTimes)&&findMatchupFormatRecoveryTimes(__spreadProps$2K(__spreadValues$4L({},policy),{averageMinutes,matchUpFormat})),null==(_a=null==policy?void 0:policy.defaultTimes)?void 0:_a.recoveryTimes,null==defaultTiming?void 0:defaultTiming.recoveryTimes]})}(__spreadProps$2I(__spreadValues$4J({},timingDetails),{averageMinutes})),recoveryKeys=Object.keys((null==recoveryTimes?void 0:recoveryTimes.minutes)||{}),recoveryMinutes=(null==recoveryTimes?void 0:recoveryTimes.minutes)&&((null==recoveryKeys?void 0:recoveryKeys.includes(eventType))&&recoveryTimes.minutes[eventType]||recoveryTimes.minutes.default),formatChangeKey=eventType===SINGLES$1?SINGLES_DOUBLES:DOUBLES_SINGLES;return{averageMinutes,recoveryMinutes,typeChangeRecoveryMinutes:(null==recoveryTimes?void 0:recoveryTimes.minutes)&&((null==recoveryKeys?void 0:recoveryKeys.includes(formatChangeKey))&&recoveryTimes.minutes[formatChangeKey]||recoveryMinutes)}}function getFlightProfile({event,eventId}){var _a;if(!event)return{error:MISSING_EVENT};const{extension}=findEventExtension({name:FLIGHT_PROFILE,event}),flightProfile=eventId?makeDeepCopy(null==extension?void 0:extension.value,!1,!0):null==extension?void 0:extension.value;return eventId&&(null==(_a=event.drawDefinitions)||_a.forEach((drawDefinition=>{var _a2;null==(_a2=null==flightProfile?void 0:flightProfile.flights)||_a2.forEach((flight=>{flight.drawId===drawDefinition.drawId&&Object.assign(flight,{drawDefinition})}))}))),{flightProfile}}var __defProp$4I=Object.defineProperty,__defProps$2H=Object.defineProperties,__getOwnPropDescs$2H=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4J=Object.getOwnPropertySymbols,__hasOwnProp$4J=Object.prototype.hasOwnProperty,__propIsEnum$4J=Object.prototype.propertyIsEnumerable,__defNormalProp$4I=(obj,key,value)=>key in obj?__defProp$4I(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4I=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4J.call(b,prop)&&__defNormalProp$4I(a,prop,b[prop]);if(__getOwnPropSymbols$4J)for(var prop of __getOwnPropSymbols$4J(b))__propIsEnum$4J.call(b,prop)&&__defNormalProp$4I(a,prop,b[prop]);return a},__spreadProps$2H=(a,b)=>__defProps$2H(a,__getOwnPropDescs$2H(b));function findEvent({tournamentRecord,eventId,drawId}){if(!tournamentRecord)return decorateResult({result:{error:MISSING_TOURNAMENT_RECORD},stack:"findEvent"});const events=(null==tournamentRecord?void 0:tournamentRecord.events)||[];if(drawId){let drawDefinition;const event=events.find((event2=>{var _a;const targetDrawDefinition=((null==event2?void 0:event2.drawDefinitions)||[]).find((drawDefinition2=>drawDefinition2.drawId===drawId));if(targetDrawDefinition)drawDefinition=targetDrawDefinition;else{const{flightProfile}=getFlightProfile({event:event2}),flight=null==(_a=null==flightProfile?void 0:flightProfile.flights)?void 0:_a.find((flight2=>flight2.drawId===drawId));if(flight)return{drawId,entries:flight.drawEntries,drawName:flight.drawName}}return targetDrawDefinition}));if(event)return{event,drawDefinition}}if(eventId){const event=events.find((event2=>event2.eventId===eventId));return event?{event}:decorateResult({result:{error:EVENT_NOT_FOUND},stack:"findEvent"})}return decorateResult({result:{error:DRAW_DEFINITION_NOT_FOUND},context:{drawId,eventId},stack:"findEvent"})}function getDrawDefinition$2({tournamentRecord,drawId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!drawId)return{error:MISSING_DRAW_ID};const target=(tournamentRecord.events||[]).reduce(((target2,event)=>{const candidate=(event.drawDefinitions||[]).reduce(((drawDefinition,candidate2)=>candidate2.drawId===drawId?candidate2:drawDefinition),void 0);return candidate&&candidate.drawId===drawId?{event,drawDefinition:candidate}:target2}),void 0);return target?__spreadProps$2H(__spreadValues$4I({},target),{SUCCESS}):decorateResult({result:{error:DRAW_DEFINITION_NOT_FOUND},stack:"getDrawDefinition"})}var __defProp$4H=Object.defineProperty,__defProps$2G=Object.defineProperties,__getOwnPropDescs$2G=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4I=Object.getOwnPropertySymbols,__hasOwnProp$4I=Object.prototype.hasOwnProperty,__propIsEnum$4I=Object.prototype.propertyIsEnumerable,__defNormalProp$4H=(obj,key,value)=>key in obj?__defProp$4H(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4H=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4I.call(b,prop)&&__defNormalProp$4H(a,prop,b[prop]);if(__getOwnPropSymbols$4I)for(var prop of __getOwnPropSymbols$4I(b))__propIsEnum$4I.call(b,prop)&&__defNormalProp$4H(a,prop,b[prop]);return a},__spreadProps$2G=(a,b)=>__defProps$2G(a,__getOwnPropDescs$2G(b));function addExtension({tournamentRecords,extension}){if(!isValidExtension({extension}))return{error:INVALID_VALUES};for(const tournamentRecord of Object.values(tournamentRecords)){const result=addTournamentExtension({tournamentRecord,extension});if(result.error)return decorateResult({result,stack:"addExtension"})}return __spreadValues$4H({},SUCCESS)}function findExtension({tournamentRecords,name}){if(!name)return{error:MISSING_VALUE,info:MISSING_NAME};let foundExtension;return Object.keys(tournamentRecords).find((tournamentId2=>{const tournamentRecord=tournamentRecords[tournamentId2],{extension}=findTournamentExtension({tournamentRecord,name});return foundExtension=extension,!!extension}))?{extension:foundExtension}:{error:NOT_FOUND}}function removeExtension({tournamentRecords,name}){if(!name)return{error:MISSING_VALUE,info:MISSING_NAME};let removed=0;for(const tournamentId of Object.keys(tournamentRecords)){const result=removeTournamentExtension({tournamentRecord:tournamentRecords[tournamentId],name});if(result.error)return decorateResult({result,stack:"removeExtension"});result.info!==NOT_FOUND&&removed++}return __spreadProps$2G(__spreadValues$4H({},SUCCESS),{removed})}var __defProp$4G=Object.defineProperty,__getOwnPropSymbols$4H=Object.getOwnPropertySymbols,__hasOwnProp$4H=Object.prototype.hasOwnProperty,__propIsEnum$4H=Object.prototype.propertyIsEnumerable,__defNormalProp$4G=(obj,key,value)=>key in obj?__defProp$4G(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4G=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4H.call(b,prop)&&__defNormalProp$4G(a,prop,b[prop]);if(__getOwnPropSymbols$4H)for(var prop of __getOwnPropSymbols$4H(b))__propIsEnum$4H.call(b,prop)&&__defNormalProp$4G(a,prop,b[prop]);return a};function getLinkedTournamentIds({tournamentRecords}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};return{linkedTournamentIds:Object.assign({},...Object.keys(tournamentRecords).map((tournamentId=>{var _a;const tournamentRecord=tournamentRecords[tournamentId],touranmentId=null==tournamentRecord?void 0:tournamentRecord.tournamentId,{extension}=findTournamentExtension({tournamentRecord,name:LINKED_TOURNAMENTS});return{[tournamentId]:((null==(_a=null==extension?void 0:extension.value)?void 0:_a.tournamentIds)||[]).filter((currentTournamentId=>currentTournamentId!==touranmentId))}})))}}function getTournamentIds$1(tournamentRecords){return{tournamentIds:Object.keys(tournamentRecords).filter(Boolean)}}function getDisabledStatus({extension,dates=[]}){if(!extension)return!1;if("boolean"==typeof extension.value&&extension.value)return!0;if("object"==typeof extension.value&&Array.isArray(extension.value.dates)){if(!dates.length)return!0;return dates.filter((date=>extension.value.dates.includes(date))).length}}var __defProp$4F=Object.defineProperty,__defProps$2F=Object.defineProperties,__getOwnPropDescs$2F=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4G=Object.getOwnPropertySymbols,__hasOwnProp$4G=Object.prototype.hasOwnProperty,__propIsEnum$4G=Object.prototype.propertyIsEnumerable,__defNormalProp$4F=(obj,key,value)=>key in obj?__defProp$4F(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4F=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4G.call(b,prop)&&__defNormalProp$4F(a,prop,b[prop]);if(__getOwnPropSymbols$4G)for(var prop of __getOwnPropSymbols$4G(b))__propIsEnum$4G.call(b,prop)&&__defNormalProp$4F(a,prop,b[prop]);return a},__spreadProps$2F=(a,b)=>__defProps$2F(a,__getOwnPropDescs$2F(b));function getInContextCourt({convertExtensions,ignoreDisabled,venue,court}){const inContextCourt=__spreadProps$2F(__spreadValues$4F({},makeDeepCopy(court,convertExtensions,!0)),{venueId:venue.venueId}),{extension}=findExtension$2({name:DISABLED,element:court});if(ignoreDisabled&&extension){const disabledDates="object"==typeof extension.value&&extension.value.dates||[],dateAvailability=!0===extension.value?[]:inContextCourt.dateAvailability.map((availability=>{const date=availability.date;if(date&&!disabledDates.includes(date))return availability})).filter(Boolean);inContextCourt.dateAvailability=dateAvailability}return{inContextCourt}}const ADD_DRAW_DEFINITION="addDrawDefinition",ADD_MATCHUPS="addMatchUps",ADD_PARTICIPANTS="addParticipants",ADD_VENUE="addVenue",AUDIT="audit",DELETE_PARTICIPANTS="deleteParticipants",DELETE_VENUE="deleteVenue",DELETED_DRAW_IDS="deletedDrawIds",DELETED_MATCHUP_IDS="deletedMatchUpIds",MODIFY_DRAW_DEFINITION="modifyDrawDefinition",MODIFY_MATCHUP="modifyMatchUp",MODIFY_PARTICIPANTS="modifyParticipants",MODIFY_POSITION_ASSIGNMENTS="modifyPositionAssignments",MODIFY_SEED_ASSIGNMENTS="modifySeedAssignments",MODIFY_TOURNAMENT_DETAIL="modifyTournamentDetail",MODIFY_VENUE="modifyVenue",MUTATIONS="mutations",PUBLISH_EVENT="publishEvent",PUBLISH_ORDER_OF_PLAY="publishOrderOfPlay",UNPUBLISH_ORDER_OF_PLAY="unPublishOrderOfPlay",UPDATE_INCONTEXT_MATCHUP="updateInContextMatchUp";var __defProp$4E=Object.defineProperty,__defProps$2E=Object.defineProperties,__getOwnPropDescs$2E=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4F=Object.getOwnPropertySymbols,__hasOwnProp$4F=Object.prototype.hasOwnProperty,__propIsEnum$4F=Object.prototype.propertyIsEnumerable,__defNormalProp$4E=(obj,key,value)=>key in obj?__defProp$4E(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4E=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4F.call(b,prop)&&__defNormalProp$4E(a,prop,b[prop]);if(__getOwnPropSymbols$4F)for(var prop of __getOwnPropSymbols$4F(b))__propIsEnum$4F.call(b,prop)&&__defNormalProp$4E(a,prop,b[prop]);return a},__spreadProps$2E=(a,b)=>__defProps$2E(a,__getOwnPropDescs$2E(b));function addVenue$1({tournamentRecord,context,disableNotice,venue}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!venue)return{error:MISSING_VALUE,info:"missing venue"};tournamentRecord.venues||(tournamentRecord.venues=[]),venue.venueId||(venue.venueId=UUID());if(tournamentRecord.venues.reduce(((exists,existingVenue)=>exists||existingVenue.venueId===venue.venueId),void 0))return{error:VENUE_EXISTS};if(context){addExtension$1({element:venue,extension:{value:context,name:CONTEXT}})}return tournamentRecord.venues.push(venue),disableNotice||addNotice({payload:{venue,tournamentId:tournamentRecord.tournamentId},topic:ADD_VENUE}),__spreadProps$2E(__spreadValues$4E({},SUCCESS),{venue:makeDeepCopy(venue)})}var __defProp$4D=Object.defineProperty,__defProps$2D=Object.defineProperties,__getOwnPropDescs$2D=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4E=Object.getOwnPropertySymbols,__hasOwnProp$4E=Object.prototype.hasOwnProperty,__propIsEnum$4E=Object.prototype.propertyIsEnumerable,__defNormalProp$4D=(obj,key,value)=>key in obj?__defProp$4D(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4D=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4E.call(b,prop)&&__defNormalProp$4D(a,prop,b[prop]);if(__getOwnPropSymbols$4E)for(var prop of __getOwnPropSymbols$4E(b))__propIsEnum$4E.call(b,prop)&&__defNormalProp$4D(a,prop,b[prop]);return a},__spreadProps$2D=(a,b)=>__defProps$2D(a,__getOwnPropDescs$2D(b));function getVenuesAndCourts$1({convertExtensions,tournamentRecord,ignoreDisabled,dates}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const venues=makeDeepCopy(tournamentRecord.venues||[],convertExtensions).filter((venue=>{if(!ignoreDisabled)return venue;const{extension}=findExtension$2({name:DISABLED,element:venue});return!(null==extension?void 0:extension.value)&&venue})).filter(Boolean),courts=venues.reduce(((courts2,venue)=>{const additionalCourts=((null==venue?void 0:venue.courts)||[]).filter((court=>{if(!ignoreDisabled&&!(null==dates?void 0:dates.length))return court;const{extension}=findExtension$2({name:DISABLED,element:court});return getDisabledStatus({extension,dates})})).filter(Boolean).map((court=>{const{inContextCourt}=getInContextCourt({convertExtensions,ignoreDisabled,venue,court});return inContextCourt}));return additionalCourts.length?courts2.concat(additionalCourts):courts2}),[]);return{venues,courts}}function findVenue({tournamentRecords,tournamentRecord,venueId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!venueId)return{error:MISSING_VENUE_ID};let venue=(tournamentRecord.venues||[]).reduce(((venue2,venueRecord)=>venueRecord.venueId===venueId?venueRecord:venue2),void 0);if(!venue&&tournamentRecords){const relevantIds=getLinkedTournamentIds({tournamentRecords}).linkedTournamentIds[tournamentRecord.tournamentId];for(const tournamentId of relevantIds){const result=findVenue({tournamentRecord:tournamentRecords[tournamentId],venueId});if(result.success)return addVenue$1({tournamentRecord,venue:result.venue}),__spreadProps$2D(__spreadValues$4D({},SUCCESS),{venue})}}return venue?__spreadProps$2D(__spreadValues$4D({},SUCCESS),{venue}):{error:VENUE_NOT_FOUND}}var __defProp$4C=Object.defineProperty,__defProps$2C=Object.defineProperties,__getOwnPropDescs$2C=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4D=Object.getOwnPropertySymbols,__hasOwnProp$4D=Object.prototype.hasOwnProperty,__propIsEnum$4D=Object.prototype.propertyIsEnumerable,__defNormalProp$4C=(obj,key,value)=>key in obj?__defProp$4C(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4C=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4D.call(b,prop)&&__defNormalProp$4C(a,prop,b[prop]);if(__getOwnPropSymbols$4D)for(var prop of __getOwnPropSymbols$4D(b))__propIsEnum$4D.call(b,prop)&&__defNormalProp$4C(a,prop,b[prop]);return a},__spreadProps$2C=(a,b)=>__defProps$2C(a,__getOwnPropDescs$2C(b));function findCourt({tournamentRecords,tournamentRecord,courtId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!courtId)return{error:MISSING_COURT_ID};let court,venue;if((tournamentRecord.venues||[]).forEach((venueRecord=>{(venueRecord.courts||[]).forEach((courtRecord=>{courtRecord.courtId===courtId&&(court=courtRecord,venue=venueRecord)}))})),court)return __spreadProps$2C(__spreadValues$4C({},SUCCESS),{court,venue});if(tournamentRecords){const relevantIds=getLinkedTournamentIds({tournamentRecords}).linkedTournamentIds[tournamentRecord.tournamentId];for(const tournamentId of relevantIds){const result=findCourt({tournamentRecord:tournamentRecords[tournamentId],courtId});if(result.success)return addVenue$1({tournamentRecord,venue:result.venue}),__spreadProps$2C(__spreadValues$4C({},SUCCESS),{court,venue})}}return decorateResult({result:{error:COURT_NOT_FOUND},stack:"findCourt"})}var __defProp$4B=Object.defineProperty,__defProps$2B=Object.defineProperties,__getOwnPropDescs$2B=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4C=Object.getOwnPropertySymbols,__hasOwnProp$4C=Object.prototype.hasOwnProperty,__propIsEnum$4C=Object.prototype.propertyIsEnumerable,__defNormalProp$4B=(obj,key,value)=>key in obj?__defProp$4B(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4B=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4C.call(b,prop)&&__defNormalProp$4B(a,prop,b[prop]);if(__getOwnPropSymbols$4C)for(var prop of __getOwnPropSymbols$4C(b))__propIsEnum$4C.call(b,prop)&&__defNormalProp$4B(a,prop,b[prop]);return a},__spreadProps$2B=(a,b)=>__defProps$2B(a,__getOwnPropDescs$2B(b));function getCourtInfo({tournamentRecord,courtId,internalUse}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!courtId)return{error:MISSING_COURT_ID};const result=findCourt({tournamentRecord,courtId});if(result.error)return result;const courtInfo=(({altitude,courtId:courtId2,courtName,courtDimensions,latitude,longitude,surfaceCategory,surfaceType,surfaceDate,pace,notes})=>({altitude,courtId:courtId2,courtName,courtDimensions,latitude,longitude,surfaceCategory,surfaceType,surfaceDate,pace,notes}))(result.court);return __spreadProps$2B(__spreadValues$4B({},SUCCESS),{courtInfo:makeDeepCopy(courtInfo,!1,internalUse)})}var __defProp$4A=Object.defineProperty,__defProps$2A=Object.defineProperties,__getOwnPropDescs$2A=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4B=Object.getOwnPropertySymbols,__hasOwnProp$4B=Object.prototype.hasOwnProperty,__propIsEnum$4B=Object.prototype.propertyIsEnumerable,__defNormalProp$4A=(obj,key,value)=>key in obj?__defProp$4A(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4A=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4B.call(b,prop)&&__defNormalProp$4A(a,prop,b[prop]);if(__getOwnPropSymbols$4B)for(var prop of __getOwnPropSymbols$4B(b))__propIsEnum$4B.call(b,prop)&&__defNormalProp$4A(a,prop,b[prop]);return a},__spreadProps$2A=(a,b)=>__defProps$2A(a,__getOwnPropDescs$2A(b));function getVenueData({tournamentRecord,venueId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!venueId)return{error:MISSING_VENUE_ID};const result=findVenue({tournamentRecord,venueId});if(result.error)return result;const courtsInfo=(result.venue.courts||[]).map((court=>(({courtInfo})=>__spreadValues$4A({},courtInfo))(getCourtInfo({courtId:court.courtId,internalUse:!0,tournamentRecord})))),venueInfo=(({venueId:venueId2,venueName,venueAbbreviation})=>({venueId:venueId2,venueName,venueAbbreviation}))(result.venue),venueData=__spreadProps$2A(__spreadValues$4A({},venueInfo),{courtsInfo});return __spreadProps$2A(__spreadValues$4A({},SUCCESS),{venueData:makeDeepCopy(venueData,!1,!0)})}const CHECK_IN="CHECK_IN",CHECK_OUT="CHECK_OUT",ASSIGN_VENUE="SCHEDULE.ASSIGNMENT.VENUE",ALLOCATE_COURTS="SCHEDULE.ALLOCATION.COURTS",ASSIGN_COURT="SCHEDULE.ASSIGNMENT.COURT",COURT_ORDER="SCHEDULE.COURT.ORDER",SCHEDULED_DATE="SCHEDULE.DATE",ASSIGN_OFFICIAL="SCHEDULE.ASSIGN.OFFICIAL",SCHEDULED_TIME="SCHEDULE.TIME.SCHEDULED",START_TIME="SCHEDULE.TIME.START",STOP_TIME="SCHEDULE.TIME.STOP",RESUME_TIME="SCHEDULE.TIME.RESUME",END_TIME="SCHEDULE.TIME.END",TIME_MODIFIERS="SCHEDULE.TIME.MODIFIERS",SCALE="SCALE",SEEDING="SEEDING",PUBLISH="PUBLISH",PUBLIC="PUBLIC",STATUS$1="STATUS";function getTimeStamp(item){return item.createdAt?new Date(item.createdAt).getTime():0}function latestVisibleTimeItemValue({timeItems,itemType,visibilityThreshold}){const latestVisible=timeItems.filter((timeItem=>timeItem&&timeItem.itemType===itemType&&(!visibilityThreshold||getTimeStamp(timeItem)<visibilityThreshold))).sort(((a,b)=>getTimeStamp(a)-getTimeStamp(b))).pop(),timeStamp=latestVisible&&getTimeStamp(latestVisible);return{itemValue:null==latestVisible?void 0:latestVisible.itemValue,timeStamp}}function scheduledMatchUpTime({visibilityThreshold,timeStamp,schedule,matchUp}){const{itemValue:scheduledTime,timeStamp:itemTimeStamp}=latestVisibleTimeItemValue({timeItems:(null==matchUp?void 0:matchUp.timeItems)||[],itemType:SCHEDULED_TIME,visibilityThreshold});return!schedule||itemTimeStamp&&timeStamp&&itemTimeStamp>timeStamp?{scheduledTime}:schedule}function scheduledMatchUpDate({visibilityThreshold,timeStamp,schedule,matchUp}){const{itemValue:scheduledDate,timeStamp:itemTimeStamp}=latestVisibleTimeItemValue({timeItems:(null==matchUp?void 0:matchUp.timeItems)||[],itemType:SCHEDULED_DATE,visibilityThreshold});return!schedule||itemTimeStamp&&timeStamp&&itemTimeStamp>timeStamp?{scheduledDate}:schedule}function matchUpAllocatedCourts({visibilityThreshold,timeStamp,schedule,matchUp}){const{itemValue:allocatedCourts,timeStamp:itemTimeStamp}=latestVisibleTimeItemValue({timeItems:(null==matchUp?void 0:matchUp.timeItems)||[],itemType:ALLOCATE_COURTS,visibilityThreshold});return!schedule||itemTimeStamp&&timeStamp&&itemTimeStamp>timeStamp?{allocatedCourts:makeDeepCopy(allocatedCourts,!1,!0)}:schedule}function matchUpAssignedCourtId({visibilityThreshold,timeStamp,schedule,matchUp}){const{itemValue:courtId,timeStamp:itemTimeStamp}=latestVisibleTimeItemValue({timeItems:(null==matchUp?void 0:matchUp.timeItems)||[],itemType:ASSIGN_COURT,visibilityThreshold});return!schedule||itemTimeStamp&&timeStamp&&itemTimeStamp>timeStamp?{courtId}:schedule}function matchUpAssignedVenueId({matchUp,visibilityThreshold,timeStamp,schedule}){const{itemValue:venueId,timeStamp:itemTimeStamp}=latestVisibleTimeItemValue({timeItems:(null==matchUp?void 0:matchUp.timeItems)||[],itemType:ASSIGN_VENUE,visibilityThreshold});return!schedule||itemTimeStamp&&timeStamp&&itemTimeStamp>timeStamp?{venueId}:schedule}function timeDate$1(value){if(validTimeString.test(value)){const dateString=getUTCdateString();return new Date(`${dateString}T${value}`)}return new Date(value)}function matchUpDuration({matchUp}){if(!matchUp)return{error:MISSING_MATCHUP};if(!matchUp.timeItems)return{error:MISSING_TIME_ITEMS};const relevantTimeItems=matchUp.timeItems.filter((timeItem=>[START_TIME,STOP_TIME,RESUME_TIME,END_TIME].includes(null==timeItem?void 0:timeItem.itemType))).sort(((a,b)=>timeDate$1(a.itemValue)-timeDate$1(b.itemValue))),elapsed=relevantTimeItems.reduce(((elapsed2,timeItem)=>{var _a,_b;let milliseconds;const itemTypeComponents=null==(_a=null==timeItem?void 0:timeItem.itemType)?void 0:_a.split("."),scheduleType=`SCHEDULE.TIME.${(null==(_b=null==timeItem?void 0:timeItem.itemType)?void 0:_b.startsWith("SCHEDULE.TIME"))&&itemTypeComponents[2]}`;switch(scheduleType){case START_TIME:milliseconds=0;break;case END_TIME:if(elapsed2.lastValue&&[START_TIME,RESUME_TIME].includes(elapsed2.lastType)){const interval=timeDate$1(timeItem.itemValue)-timeDate$1(elapsed2.lastValue);milliseconds=elapsed2.milliseconds+interval}else milliseconds=elapsed2.milliseconds;break;case STOP_TIME:if([START_TIME,"SCHECULE.TIME.RESUME"].includes(elapsed2.lastType)){const interval=timeDate$1(timeItem.itemValue)-timeDate$1(elapsed2.lastValue);milliseconds=elapsed2.milliseconds+interval}else milliseconds=elapsed2.milliseconds;break;default:milliseconds=elapsed2.milliseconds}return{milliseconds,lastType:scheduleType,lastValue:timeItem.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([START_TIME,RESUME_TIME].includes(elapsed.lastType)){const interval=new Date-timeDate$1(elapsed.lastValue);elapsed.milliseconds+=interval}return{milliseconds:elapsed.milliseconds,time:msToTime(elapsed.milliseconds),relevantTimeItems}}function msToTime(s){const pad=(n,z=2)=>("00"+n).slice(-z);return pad(s/36e5|0)+":"+pad(s%36e5/6e4|0)+":"+pad(s%6e4/1e3|0)}const SINGLES="SINGLES",SINGLES_EVENT="SINGLES",DOUBLES="DOUBLES",DOUBLES_EVENT="DOUBLES",TEAM$1="TEAM",TEAM_EVENT="TEAM";var __defProp$4z=Object.defineProperty,__getOwnPropSymbols$4A=Object.getOwnPropertySymbols,__hasOwnProp$4A=Object.prototype.hasOwnProperty,__propIsEnum$4A=Object.prototype.propertyIsEnumerable,__defNormalProp$4z=(obj,key,value)=>key in obj?__defProp$4z(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4z=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4A.call(b,prop)&&__defNormalProp$4z(a,prop,b[prop]);if(__getOwnPropSymbols$4A)for(var prop of __getOwnPropSymbols$4A(b))__propIsEnum$4A.call(b,prop)&&__defNormalProp$4z(a,prop,b[prop]);return a};function getMatchUpScheduleDetails({scheduleVisibilityFilters,afterRecoveryTimes,tournamentRecord,scheduleTiming,matchUpFormat,matchUpType,matchUp,event}){var _a,_b,_c,_d;if(!matchUp)return{error:MISSING_MATCHUP};if(afterRecoveryTimes&&!matchUp.matchUpType&&!matchUpType&&(event||tournamentRecord)&&matchUp.drawId){let drawDefinition=null==event?void 0:event.drawDefinitions.find((drawDefinition2=>drawDefinition2.drawId===matchUp.drawId));!drawDefinition&&tournamentRecord&&({drawDefinition,event}=findEvent({tournamentRecord,drawId:matchUp.drawId}));const structure=matchUp.structureId&&(null==(_a=null==drawDefinition?void 0:drawDefinition.structures)?void 0:_a.find((({structureId})=>structureId===matchUp.structureId)));matchUpType=(null==structure?void 0:structure.matchUpType)||(null==drawDefinition?void 0:drawDefinition.matchUpType)||(null==event?void 0:event.eventType)!==TEAM$1&&(null==event?void 0:event.eventType)}const{milliseconds,time}=matchUpDuration({matchUp}),{startTime}=function matchUpStartTime({matchUp}){const timeItems=(null==matchUp?void 0:matchUp.timeItems)||[],getTimeStamp=item=>item.createdAt?new Date(item.createdAt).getTime():0,startTimeItem=timeItems.reduce(((startTimeItem2,timeItem)=>{const startTimeCandidate=timeItem.itemType===START_TIME&&timeItem;return startTimeCandidate&&(!startTimeItem2||getTimeStamp(startTimeCandidate)<getTimeStamp(startTimeItem2))?startTimeCandidate:startTimeItem2}),void 0);return{startTime:startTimeItem&&startTimeItem.itemValue}}({matchUp}),{endTime}=function matchUpEndTime({matchUp}){const timeItems=(null==matchUp?void 0:matchUp.timeItems)||[],getTimeStamp=item=>item.createdAt?new Date(item.createdAt).getTime():0,endTimeItem=timeItems.reduce(((endTimeItem2,timeItem)=>{const endTimeCandidate=timeItem.itemType===END_TIME&&timeItem;return endTimeCandidate&&(!endTimeItem2||getTimeStamp(endTimeCandidate)>getTimeStamp(endTimeItem2))?endTimeCandidate:endTimeItem2}),void 0);return{endTime:endTimeItem&&endTimeItem.itemValue}}({matchUp});let schedule;const{visibilityThreshold,eventIds,drawIds}=scheduleVisibilityFilters||{};if(eventIds&&!eventIds.includes(matchUp.eventId)||drawIds&&!drawIds.includes(matchUp.drawId))schedule=definedAttributes({time,startTime,endTime,milliseconds});else{const scheduleSource={matchUp,visibilityThreshold},{allocatedCourts}=matchUpAllocatedCourts(scheduleSource),{scheduledTime:scheduledTime2}=scheduledMatchUpTime(scheduleSource);let{scheduledDate:scheduledDate2}=scheduledMatchUpDate(scheduleSource);const{venueId}=matchUpAssignedVenueId(scheduleSource),{courtId}=matchUpAssignedCourtId(scheduleSource),{courtOrder}=function matchUpCourtOrder({visibilityThreshold,timeStamp,schedule,matchUp}){const{itemValue:courtOrder,timeStamp:itemTimeStamp}=latestVisibleTimeItemValue({timeItems:(null==matchUp?void 0:matchUp.timeItems)||[],itemType:COURT_ORDER,visibilityThreshold});return!schedule||itemTimeStamp&&timeStamp&&itemTimeStamp>timeStamp?{courtOrder}:schedule}(scheduleSource),{timeModifiers}=function matchUpTimeModifiers({visibilityThreshold,timeStamp,schedule,matchUp}){const{itemValue:timeModifiers,timeStamp:itemTimeStamp}=latestVisibleTimeItemValue({timeItems:(null==matchUp?void 0:matchUp.timeItems)||[],itemType:TIME_MODIFIERS,visibilityThreshold});return!schedule||itemTimeStamp&&timeStamp&&itemTimeStamp>timeStamp?{timeModifiers}:schedule}(scheduleSource);let timeAfterRecovery,averageMinutes,recoveryMinutes,typeChangeRecoveryMinutes,typeChangeTimeAfterRecovery;if((null==scheduleTiming?void 0:scheduleTiming.policy)&&scheduledTime2&&afterRecoveryTimes){const timingDetails=__spreadValues$4z({matchUpFormat:matchUp.matchUpFormat||matchUpFormat},scheduleTiming);({averageMinutes=0,recoveryMinutes=0,typeChangeRecoveryMinutes=0}=matchUpFormatTimes({eventType:matchUp.matchUpType||matchUpType,timingDetails})),(averageMinutes||recoveryMinutes)&&(timeAfterRecovery=endTime?addMinutesToTimeString(extractTime(endTime),recoveryMinutes):addMinutesToTimeString(scheduledTime2,averageMinutes+recoveryMinutes)),typeChangeRecoveryMinutes&&(typeChangeTimeAfterRecovery=endTime?addMinutesToTimeString(extractTime(endTime),typeChangeRecoveryMinutes):addMinutesToTimeString(scheduledTime2,averageMinutes+typeChangeRecoveryMinutes))}!scheduledDate2&&scheduledTime2&&(scheduledDate2=extractDate(scheduledTime2));const isoDateString=getIsoDateString({scheduledDate:scheduledDate2,scheduledTime:scheduledTime2}),venueDataMap={},venueData=(null==(_b=tournamentRecord&&venueId&&getVenueData({tournamentRecord,venueId}))?void 0:_b.venueData)||{};venueId&&(venueDataMap[venueId]=venueData);const{venueName,venueAbbreviation,courtsInfo}=venueData,courtInfo=courtId&&(null==courtsInfo?void 0:courtsInfo.find((courtInfo2=>courtInfo2.courtId===courtId))),courtName=null==courtInfo?void 0:courtInfo.courtName;for(const allocatedCourt of allocatedCourts||[]){if(!tournamentRecord)break;allocatedCourt.venueId&&!venueDataMap[allocatedCourt.venueid]&&(venueDataMap[allocatedCourt.venueId]=null==(_c=getVenueData({venueId:allocatedCourt.venueId,tournamentRecord}))?void 0:_c.venueData);const vData=venueDataMap[allocatedCourt.venueId];allocatedCourt.venueName=null==vData?void 0:vData.venueName;const courtInfo2=null==(_d=null==vData?void 0:vData.courtsInfo)?void 0:_d.find((courtInfo3=>courtInfo3.courtId===allocatedCourt.courtId));allocatedCourt.courtName=null==courtInfo2?void 0:courtInfo2.courtName}schedule=definedAttributes({typeChangeTimeAfterRecovery,timeAfterRecovery,scheduledDate:scheduledDate2,scheduledTime:scheduledTime2,isoDateString,allocatedCourts,timeModifiers,venueAbbreviation,venueName,venueId,courtOrder,courtName,courtId,typeChangeRecoveryMinutes,recoveryMinutes,averageMinutes,milliseconds,startTime,endTime,time})}const hasCompletedStatus=completedMatchUpStatuses.includes(matchUp.matchUpStatus),{scheduledDate}=scheduledMatchUpDate({matchUp}),{scheduledTime}=scheduledMatchUpTime({matchUp});return{schedule,endDate:hasCompletedStatus&&(extractDate(endTime)||extractDate(scheduledDate)||extractDate(scheduledTime))||void 0}}var __defProp$4y=Object.defineProperty,__getOwnPropSymbols$4z=Object.getOwnPropertySymbols,__hasOwnProp$4z=Object.prototype.hasOwnProperty,__propIsEnum$4z=Object.prototype.propertyIsEnumerable,__defNormalProp$4y=(obj,key,value)=>key in obj?__defProp$4y(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4y=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4z.call(b,prop)&&__defNormalProp$4y(a,prop,b[prop]);if(__getOwnPropSymbols$4z)for(var prop of __getOwnPropSymbols$4z(b))__propIsEnum$4z.call(b,prop)&&__defNormalProp$4y(a,prop,b[prop]);return a};function getCollectionPositionAssignments({collectionPosition,collectionId,lineUp}){let assignedParticipantIds=[];const substitutions=[];if(lineUp){const getOrderValue=order=>void 0===order?-1:order,competitorAssignments=lineUp.map((teamCompetitor=>{const{collectionAssignments,participantId}=teamCompetitor,assignment=null==collectionAssignments?void 0:collectionAssignments.find((assignment2=>assignment2.collectionPosition===collectionPosition&&assignment2.collectionId===collectionId));return assignment&&__spreadValues$4y({participantId},assignment)})).filter(Boolean).sort(((a,b)=>getOrderValue(a.substitutionOrder)-getOrderValue(b.substitutionOrder)));for(const competitorAssignment of competitorAssignments){const{participantId,previousParticipantId,substitutionOrder}=competitorAssignment;assignedParticipantIds.includes(participantId)||(previousParticipantId&&substitutions.push({previousParticipantId,substitutionOrder,participantId}),assignedParticipantIds=assignedParticipantIds.filter((id=>id!==previousParticipantId)),assignedParticipantIds.push(participantId))}}return{assignedParticipantIds,substitutions}}const SIGN_IN_STATUS="SIGN_IN_STATUS";const INDIVIDUAL="INDIVIDUAL",GROUP="GROUP",PAIR="PAIR",TEAM="TEAM",TEAM_PARTICIPANT="TEAM";const SIGNED_IN="SIGNED_IN",SIGNED_OUT="SIGNED_OUT",participantTypes={TEAM_PARTICIPANT,INDIVIDUAL,GROUP,TEAM,PAIR};var __defProp$4x=Object.defineProperty,__getOwnPropSymbols$4y=Object.getOwnPropertySymbols,__hasOwnProp$4y=Object.prototype.hasOwnProperty,__propIsEnum$4y=Object.prototype.propertyIsEnumerable,__defNormalProp$4x=(obj,key,value)=>key in obj?__defProp$4x(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4x=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4y.call(b,prop)&&__defNormalProp$4x(a,prop,b[prop]);if(__getOwnPropSymbols$4y)for(var prop of __getOwnPropSymbols$4y(b))__propIsEnum$4y.call(b,prop)&&__defNormalProp$4x(a,prop,b[prop]);return a};function getPairedParticipant({tournamentParticipants,tournamentRecord,participantIds}){const stack="getPairedParticipant";if(!tournamentParticipants&&!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(participantIds)||participantIds.length>2)return{error:INVALID_PARTICIPANT_IDS};if(!participantIds.length)return decorateResult({result:{error:MISSING_PARTICIPANT_IDS},stack});const existingPairedParticipants=(tournamentParticipants=tournamentParticipants||(null==tournamentRecord?void 0:tournamentRecord.participants)||[]).filter((participant=>participant.participantType===PAIR&&intersection(participantIds,participant.individualParticipantIds).length===participantIds.length&&participant.individualParticipantIds.length===participantIds.length)),existingPairedParticipant=existingPairedParticipants[0];if(!existingPairedParticipant)return decorateResult({result:{error:PARTICIPANT_NOT_FOUND},stack});const duplicatedPairParticipants=makeDeepCopy(existingPairedParticipants.slice(1),!1,!0);return __spreadValues$4x({participant:makeDeepCopy(existingPairedParticipant),duplicatedPairParticipants},SUCCESS)}function getTeamLineUp({drawDefinition,participantId}){if("object"!=typeof drawDefinition)return{error:MISSING_DRAW_DEFINITION};if("string"!=typeof participantId)return{error:MISSING_PARTICIPANT_ID};const{extension}=findExtension$1({element:drawDefinition,name:LINEUPS});return{lineUp:((null==extension?void 0:extension.value)||{})[participantId]}}function getMatchUp$1({matchUps,matchUpId}){return{matchUp:(matchUps||[]).find((matchUp2=>matchUp2.matchUpId===matchUpId))}}function getRoundMatchUps$1({matchUps=[],interpolate}){var _a;if(!Array.isArray(matchUps))return{error:INVALID_VALUES};const roundMatchUpsArray=matchUps.reduce(((roundNumbers2,matchUp)=>!matchUp.roundNumber||roundNumbers2.includes(matchUp.roundNumber)?roundNumbers2:roundNumbers2.concat(parseInt(matchUp.roundNumber))),[]).sort(numericSort).map((roundNumber=>{const roundMatchUps2=matchUps.filter((matchUp=>matchUp.roundNumber===roundNumber)),consideredMatchUps=roundMatchUps2.find((({matchUpType})=>matchUpType===TEAM$2))?roundMatchUps2.filter((({matchUpType})=>matchUpType===TEAM$2)):roundMatchUps2;return{[roundNumber]:consideredMatchUps.sort(((a,b)=>numericSort(a.roundPosition,b.roundPosition)))}})),finishingRoundMap=matchUps.reduce(((mapping,matchUp)=>(mapping[matchUp.roundNumber]||(mapping[matchUp.roundNumber]=definedAttributes({abbreviatedRoundName:matchUp.abbreviatedRoundName,finishingRound:matchUp.finishingRound,roundName:matchUp.roundName})),mapping)),{}),roundMatchUps=Object.assign({},...roundMatchUpsArray);if(interpolate){const maxRoundNumber=Math.max(...Object.keys(roundMatchUps).map((key=>parseInt(key))).filter((f=>!isNaN(f)))),maxRoundMatchUpsCount=null==(_a=roundMatchUps[maxRoundNumber])?void 0:_a.length;if(maxRoundMatchUpsCount>1&&isPowerOf2(maxRoundMatchUpsCount)){const nextRound=maxRoundNumber+1;generateRange(nextRound,nextRound+maxRoundMatchUpsCount/2).forEach(((roundNumber,i)=>{roundMatchUps[roundNumber]=generateRange(0,maxRoundMatchUpsCount/(2+2*i)).map((()=>({})))}))}}let maxMatchUpsCount=0;const roundProfile=Object.assign({},...Object.keys(roundMatchUps).map((roundNumber=>{var _a2,_b,_c;const matchUpsCount=null==(_a2=roundMatchUps[roundNumber])?void 0:_a2.length,inactiveCount=null==(_c=null==(_b=roundMatchUps[roundNumber])?void 0:_b.filter((matchUp=>{var _a3;return!completedMatchUpStatuses.includes(matchUp.matchUpStatus)&&!(null==(_a3=matchUp.score)?void 0:_a3.scoreStringSide1)})))?void 0:_c.length,inactiveRound=matchUpsCount&&matchUpsCount===inactiveCount;return maxMatchUpsCount=Math.max(maxMatchUpsCount,matchUpsCount),{[roundNumber]:{matchUpsCount,inactiveCount,inactiveRound}}})));let roundIndex=0,feedRoundIndex=0;const roundNumbers=Object.keys(roundMatchUps).map((key=>parseInt(key))).filter((f=>!isNaN(f)));roundNumbers.forEach((roundNumber=>{var _a2,_b,_c;const currentRoundMatchUps=roundMatchUps[roundNumber].sort(((a,b)=>a.roundPosition-b.roundPosition)),currentRoundDrawPositions=currentRoundMatchUps.map((matchUp=>(null==matchUp?void 0:matchUp.drawPositions)||[])).flat();if(roundProfile[roundNumber].roundNumber=roundNumber,roundProfile[roundNumber].roundFactor=roundProfile[roundNumber].matchUpsCount?maxMatchUpsCount/roundProfile[roundNumber].matchUpsCount:1,roundProfile[roundNumber].finishingRound=null==(_a2=finishingRoundMap[roundNumber])?void 0:_a2.finishingRound,roundProfile[roundNumber].roundName=null==(_b=finishingRoundMap[roundNumber])?void 0:_b.roundName,roundProfile[roundNumber].abbreviatedRoundName=null==(_c=finishingRoundMap[roundNumber])?void 0:_c.abbreviatedRoundName,roundProfile[roundNumber].finishingPositionRange=roundMatchUps[roundNumber][0].finishingPositionRange,1!==roundNumber&&roundProfile[roundNumber-1]){const priorRound=roundProfile[roundNumber-1],priorRoundDrawPositions=priorRound.drawPositions,chunkFactor=priorRound.matchUpsCount/roundProfile[roundNumber].matchUpsCount,priorRoundDrawPositionChunks=chunkArray(priorRoundDrawPositions,chunkFactor),roundDrawPositions=currentRoundMatchUps.map((matchUp=>{const{roundPosition}=matchUp,drawPositions=[].concat(...matchUp.drawPositions||[],void 0,void 0).slice(0,2);if(!roundPosition)return drawPositions;const filteredDrawPositions=(null==drawPositions?void 0:drawPositions.filter(Boolean))||[];if(!(null==filteredDrawPositions?void 0:filteredDrawPositions.length))return[void 0,void 0];if(roundNumber<3&&2===(null==filteredDrawPositions?void 0:filteredDrawPositions.length))return null==drawPositions?void 0:drawPositions.slice().sort(numericSort);const isFeedRound=intersection(priorRoundDrawPositions,filteredDrawPositions).length!==(null==filteredDrawPositions?void 0:filteredDrawPositions.length);if((null==filteredDrawPositions?void 0:filteredDrawPositions.length)&&isFeedRound)return 1===(null==filteredDrawPositions?void 0:filteredDrawPositions.length)?[filteredDrawPositions[0],void 0]:null==drawPositions?void 0:drawPositions.slice().sort(numericSort);const targetChunkIndex=2*(roundPosition-1);return priorRoundDrawPositionChunks.slice(targetChunkIndex,targetChunkIndex+2).map((chunk=>null==filteredDrawPositions?void 0:filteredDrawPositions.find((drawPosition=>chunk.includes(drawPosition)))))}));roundProfile[roundNumber].drawPositions=null==roundDrawPositions?void 0:roundDrawPositions.flat(),roundProfile[roundNumber].pairedDrawPositions=roundDrawPositions}else{const orderedDrawPositions=currentRoundDrawPositions.sort(numericSort),pairedDrawPositions=chunkArray(orderedDrawPositions,2);roundProfile[roundNumber].drawPositions=orderedDrawPositions,roundProfile[roundNumber].pairedDrawPositions=pairedDrawPositions}roundProfile[roundNumber+1]&&roundProfile[roundNumber+1].matchUpsCount===roundProfile[roundNumber].matchUpsCount&&(roundProfile[roundNumber+1].feedRound=!0,roundProfile[roundNumber+1].feedRoundIndex=feedRoundIndex,roundProfile[roundNumber].preFeedRound=!0,feedRoundIndex+=1),roundProfile[roundNumber]&&!roundProfile[roundNumber].feedRound&&(roundProfile[roundNumber].roundIndex=roundIndex,roundIndex+=1)}));return{hasOddMatchUpsCount:!!Object.values(roundProfile).find((({matchUpsCount})=>!isPowerOf2(matchUpsCount))),maxMatchUpsCount,roundMatchUps,roundNumbers,roundProfile}}function getMatchUpType({matchUp={}}={}){var _a;let matchUpType=matchUp.matchUpType;if(!matchUpType&&(null==(_a=matchUp.sides)?void 0:_a.length)){const side=matchUp.sides.find((({participant:participant2})=>participant2)),participant=null==side?void 0:side.participant,participantType=null==participant?void 0:participant.participantType;matchUpType=participantType===INDIVIDUAL?SINGLES$1:participantType===PAIR?DOUBLES$1:participantType===TEAM?TEAM:void 0}return{matchUpType}}const MAIN="MAIN",QUALIFYING="QUALIFYING",CONSOLATION="CONSOLATION",VOLUNTARY_CONSOLATION="VOLUNTARY_CONSOLATION",PLAY_OFF="PLAY_OFF",validStages=[MAIN,QUALIFYING,CONSOLATION,PLAY_OFF,VOLUNTARY_CONSOLATION],stageOrder$1={[QUALIFYING]:1,[MAIN]:2,[PLAY_OFF]:3,[CONSOLATION]:3,[VOLUNTARY_CONSOLATION]:4},FINISHING_POSITIONS="finishingPositions",AGGREGATE_EVENT_STRUCTURES="aggregateEventStructures",finishOrder={[MAIN]:1,[PLAY_OFF]:2,[CONSOLATION]:3,[QUALIFYING]:4,[VOLUNTARY_CONSOLATION]:5},aggregateOrder={[PLAY_OFF]:1,[MAIN]:2,[CONSOLATION]:3,[QUALIFYING]:4,[VOLUNTARY_CONSOLATION]:5},CLUSTER="CLUSTER",WATERFALL="WATERFALL",ITEM="ITEM",CONTAINER="CONTAINER",DRAW="DRAW",RANDOM="RANDOM",TOP_DOWN="TOP_DOWN",BOTTOM_UP="BOTTOM_UP",POSITION="POSITION",WINNER="WINNER",LOSER="LOSER",FIRST_MATCHUP="FIRST_MATCHUP",AD_HOC="AD_HOC",FEED_IN$1="FEED_IN",COMPASS="COMPASS",OLYMPIC="OLYMPIC",SINGLE_ELIMINATION="SINGLE_ELIMINATION",DOUBLE_ELIMINATION="DOUBLE_ELIMINATION",FIRST_MATCH_LOSER_CONSOLATION="FIRST_MATCH_LOSER_CONSOLATION",FIRST_ROUND_LOSER_CONSOLATION="FIRST_ROUND_LOSER_CONSOLATION",LUCKY_DRAW="LUCKY_DRAW",CURTIS="CURTIS_CONSOLATION",FICSF="FEED_IN_CHAMPIONSHIP_TO_SF",FICQF="FEED_IN_CHAMPIONSHIP_TO_QF",FICR16="FEED_IN_CHAMPIONSHIP_TO_R16",MFIC="MODIFIED_FEED_IN_CHAMPIONSHIP",FEED_IN_CHAMPIONSHIP="FEED_IN_CHAMPIONSHIP",ROUND_ROBIN="ROUND_ROBIN",ROUND_ROBIN_WITH_PLAYOFF="ROUND_ROBIN_WITH_PLAYOFF",DECIDER="DECIDER",BACKDRAW="BACKDRAW",COMPASS_ATTRIBUTES={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-3":{name:"NORTHEAST",abbreviation:"NE"},"0-1-1":{name:"SOUTH",abbreviation:"S"},"0-1-2":{name:"SOUTHWEST",abbreviation:"SW"},"0-2-1":{name:"NORTHWEST",abbreviation:"NW"},"0-1-1-1":{name:"SOUTHEAST",abbreviation:"SE"}},OLYMPIC_ATTRIBUTES={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-1-1":{name:"SOUTH",abbreviation:"S"}},WIN_RATIO="WIN_RATIO",ROUND_OUTCOME="ROUND_OUTCOME",MULTI_STRUCTURE_DRAWS=[COMPASS,CURTIS,"FEED_IN_CHAMPIONSHIP_TO_QF","FEED_IN_CHAMPIONSHIP_TO_R16","FEED_IN_CHAMPIONSHIP_TO_SF",FEED_IN_CHAMPIONSHIP,FICQF,FICR16,FICSF,FIRST_MATCH_LOSER_CONSOLATION,FIRST_ROUND_LOSER_CONSOLATION,LUCKY_DRAW,"MODIFIED_FEED_IN_CHAMPIONSHIP",OLYMPIC,PLAY_OFF,ROUND_ROBIN_WITH_PLAYOFF],drawDefinitionConstants={MAIN,QUALIFYING,CONSOLATION,ITEM,CONTAINER,FIRST_MATCHUP,WINNER,LOSER,AD_HOC,FEED_IN:FEED_IN$1,COMPASS,PLAY_OFF,OLYMPIC,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION,DOUBLE_ELIMINATION,CURTIS,FICSF,FICQF,FICR16,MFIC,VOLUNTARY_CONSOLATION,FIRST_MATCH_LOSER_CONSOLATION,FIRST_ROUND_LOSER_CONSOLATION,MODIFIED_FEED_IN_CHAMPIONSHIP:"MODIFIED_FEED_IN_CHAMPIONSHIP",FEED_IN_CHAMPIONSHIP_TO_R16:"FEED_IN_CHAMPIONSHIP_TO_R16",FEED_IN_CHAMPIONSHIP_TO_QF:"FEED_IN_CHAMPIONSHIP_TO_QF",FEED_IN_CHAMPIONSHIP_TO_SF:"FEED_IN_CHAMPIONSHIP_TO_SF",FEED_IN_CHAMPIONSHIP,ROUND_ROBIN_WITH_PLAYOFF,ROUND_ROBIN,DECIDER,BACKDRAW,COMPASS_ATTRIBUTES,OLYMPIC_ATTRIBUTES,DRAW,RANDOM,TOP_DOWN,BOTTOM_UP,WATERFALL,WIN_RATIO,ROUND_OUTCOME,MULTI_STRUCTURE_DRAWS,generatedDrawTypes:[AD_HOC,COMPASS,CURTIS,DOUBLE_ELIMINATION,"FEED_IN_CHAMPIONSHIP_TO_QF","FEED_IN_CHAMPIONSHIP_TO_R16","FEED_IN_CHAMPIONSHIP_TO_SF",FEED_IN_CHAMPIONSHIP,FEED_IN$1,FIRST_MATCH_LOSER_CONSOLATION,FIRST_ROUND_LOSER_CONSOLATION,LUCKY_DRAW,"MODIFIED_FEED_IN_CHAMPIONSHIP",OLYMPIC,PLAY_OFF,ROUND_ROBIN,ROUND_ROBIN_WITH_PLAYOFF,SINGLE_ELIMINATION],stageOrder:stageOrder$1,finishOrder,AGGREGATE_EVENT_STRUCTURES,FINISHING_POSITIONS};function getExitProfiles({drawDefinition}){if("object"!=typeof drawDefinition)return{error:INVALID_DRAW_DEFINITION};const exitProfiles={},{structures=[],links=[]}=drawDefinition||{},stageStructures=structures.reduce(((stageStructures2,structure)=>{const{stage}=structure;return stageStructures2[stage]?stageStructures2[stage].push(structure):stageStructures2[stage]=[structure],stageStructures2}),{});for(const stage of Object.keys(stageStructures)){const initialStructure=stageStructures[stage].find((({stageSequence})=>1===stageSequence));if(!initialStructure)continue;const{structureId}=initialStructure;addExitProfiles({aggregator:{},targetRound:0,exitProfiles,exitProfile:"0",structureId,stage})}return{exitProfiles};function addExitProfiles({exitProfiles:exitProfiles2,exitProfile,structureId,targetRound,aggregator,stage}){exitProfiles2[structureId]||(exitProfiles2[structureId]=[]),"0"===exitProfile&&[CONSOLATION,PLAY_OFF].includes(stage)||exitProfiles2[structureId].push(exitProfile);const relevantLinks=links.filter((link=>link.source.structureId===structureId&&link.source.roundNumber>=targetRound));for(const link of relevantLinks){const exitRound=link.source.roundNumber,targetRound2=link.target.roundNumber,targetStructureId=link.target.structureId,stage2=structures.find((structure=>structure.structureId===targetStructureId)).stage,fp=[stage2,targetStructureId,targetRound2,exitRound].join("|");if(aggregator[fp])return;aggregator[fp]=!0,addExitProfiles({exitProfile:`${exitProfile}-${exitRound}`,structureId:targetStructureId,exitProfiles:exitProfiles2,targetRound:targetRound2,aggregator,stage:stage2})}}}function getMatchUpsMap({drawDefinition,structure}){const mappedMatchUps={},drawMatchUps=[];return((null==drawDefinition?void 0:drawDefinition.structures)||[structure]).filter((structure2=>structure2&&"object"==typeof structure2)).forEach((structure2=>{const{structureId,matchUps,structures}=structure2,isRoundRobin=Array.isArray(structures);if(isRoundRobin)isRoundRobin&&structures.forEach((itemStructure=>{const{structureName}=itemStructure,filteredMatchUps=itemStructure.matchUps;mappedMatchUps[itemStructure.structureId]={matchUps:filteredMatchUps,structureName},drawMatchUps.push(...filteredMatchUps),filteredMatchUps.forEach((matchUp=>{matchUp.tieMatchUps&&drawMatchUps.push(...matchUp.tieMatchUps)})),mappedMatchUps[structureId]||(mappedMatchUps[structureId]={}),mappedMatchUps[structureId].itemStructureIds||(mappedMatchUps[structureId].itemStructureIds=[]),mappedMatchUps[structureId].itemStructureIds.push(itemStructure.structureId)}));else{const filteredMatchUps=matchUps;mappedMatchUps[structureId]={matchUps:filteredMatchUps},filteredMatchUps.forEach((matchUp=>{drawMatchUps.push(matchUp),matchUp.tieMatchUps&&drawMatchUps.push(...matchUp.tieMatchUps)}))}})),{mappedMatchUps,drawMatchUps}}function getMappedStructureMatchUps({mappedMatchUps,matchUpsMap,structureId,inContext}){let structureMatchUpsMap=(mappedMatchUps=(null==matchUpsMap?void 0:matchUpsMap.mappedMatchUps)||mappedMatchUps)[structureId];const itemStructureMatchUps=((null==structureMatchUpsMap?void 0:structureMatchUpsMap.itemStructureIds)||[]).map((itemStructureId=>{const{matchUps,structureName}=mappedMatchUps[itemStructureId];return inContext?matchUps.map((matchUp=>Object.assign(makeDeepCopy(matchUp,!0,!0),{containerStructureId:structureId,structureId:itemStructureId,structureName}))):matchUps})).flat();return((null==structureMatchUpsMap?void 0:structureMatchUpsMap.matchUps)||[]).concat(...itemStructureMatchUps)}function structureSort(a,b,config={}){var _a,_b;const getRoundTarget=element=>{var _a2,_b2;return null==(_b2=null==(_a2=findExtension$1({element,name:ROUND_TARGET}))?void 0:_a2.extension)?void 0:_b2.value},completed=null==config?void 0:config.deprioritizeCompleted,aggregate=(null==config?void 0:config.mode)===AGGREGATE_EVENT_STRUCTURES&&aggregateOrder,finish=(null==config?void 0:config.mode)===FINISHING_POSITIONS&&finishOrder,orderProtocol=finish||aggregate||stageOrder$1,protocolSequence=s=>(s=>(null==s?void 0:s.stage)===MAIN&&1===(null==s?void 0:s.stageSequence))(s)?-1:orderProtocol[null==s?void 0:s.stage],completedStructure=s=>null==s?void 0:s.matchUps.every((({matchUpStatus})=>completedMatchUpStatuses.includes(matchUpStatus)?1:-1));return completed&&completedStructure(a)-completedStructure(b)||aggregate&&protocolSequence(a)-protocolSequence(b)||(orderProtocol[null==a?void 0:a.stage]||0)-(orderProtocol[null==b?void 0:b.stage]||0)||(getRoundTarget(a)||0)-(getRoundTarget(b)||0)||!finish&&!aggregate&&((null==(_a=null==b?void 0:b.positionAssignments)?void 0:_a.length)||1/0)-((null==(_b=null==a?void 0:a.positionAssignments)?void 0:_b.length)||1/0)||((null==a?void 0:a.stageSequence)||0)-((null==b?void 0:b.stageSequence)||0)||(getMinFinishingPositionRange(a)||0)-(getMinFinishingPositionRange(b)||0)}function getMinFinishingPositionRange(structure){return((null==structure?void 0:structure.matchUps)||[]).reduce(((rangeSum,matchUp)=>{var _a;const sum=((null==(_a=matchUp.finishingPositionRange)?void 0:_a.winner)||[]).reduce(((a,b)=>a+b),0);return!rangeSum||sum<rangeSum?sum:rangeSum}),void 0)}function findStructure({drawDefinition,structureId}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structureId)return{error:MISSING_STRUCTURE_ID};const{structures}=getDrawStructures({drawDefinition}),allStructures=structures.map((structure2=>structure2.structures?[].concat(...structure2.structures,structure2):structure2)).flat(),structure=allStructures.find((structure2=>structure2.structureId===structureId));if(!structure)return{error:STRUCTURE_NOT_FOUND};return{structure,containingStructure:structure.structureType===ITEM&&allStructures.find((s=>{var _a;return null==(_a=s.structures)?void 0:_a.some((s2=>s2.structureId===structureId))}))}}function getDrawStructures({withStageGrouping,drawDefinition,stageSequences,stageSequence,roundTarget,sortConfig,stages,stage}){var _a;const error=drawDefinition?drawDefinition.structures?void 0:MISSING_STRUCTURES:MISSING_DRAW_DEFINITION;if(error)return decorateResult({result:{error},stack:"getDrawStructure"});const structures=null==(_a=drawDefinition.structures)?void 0:_a.filter((function isStage(structure){return!stage&&!Array.isArray(stages)||stage&&structure.stage===stage||Array.isArray(stages)&&stages.includes(structure.stage)})).filter((function isStageSequence(structure){return!stageSequence&&!Array.isArray(stageSequences)||stageSequence&&structure.stageSequence===stageSequence||Array.isArray(stageSequences)&&stageSequences.includes(structure.stageSequence)})).filter((structure=>{var _a2,_b;const value=null==(_b=null==(_a2=findExtension$1({element:structure,name:ROUND_TARGET}))?void 0:_a2.extension)?void 0:_b.value;return!roundTarget||roundTarget===value})).sort(((a,b)=>structureSort(a,b,sortConfig))),stageStructures=withStageGrouping&&Object.assign({},...validStages.map((stage2=>{const relevantStructures=structures.filter((structure=>structure.stage===stage2));return relevantStructures.length&&{[stage2]:relevantStructures}})).filter(Boolean));return{structures,stageStructures}}function modifyEntryProfile({drawDefinition,attributes}){let{extension}=findDrawDefinitionExtension({name:ENTRY_PROFILE,drawDefinition});const entryProfile=(null==extension?void 0:extension.value)||drawDefinition.entryProfile||{};return attributes.forEach((attribute=>{Object.keys(attribute).forEach((key=>{entryProfile[key]?Object.assign(entryProfile[key],attribute[key]):entryProfile[key]=attribute[key]}))})),extension={name:ENTRY_PROFILE,value:entryProfile},addDrawDefinitionExtension({drawDefinition,extension}),{entryProfile}}function getEntryProfile({drawDefinition}){let{extension}=findDrawDefinitionExtension({name:ENTRY_PROFILE,drawDefinition});return{entryProfile:(null==extension?void 0:extension.value)||drawDefinition.entryProfile||{}}}const ALTERNATE="ALTERNATE",DIRECT_ACCEPTANCE="DIRECT_ACCEPTANCE",FEED_IN="FEED_IN",LUCKY_LOSER="LUCKY_LOSER",QUALIFIER="QUALIFIER",UNGROUPED="UNGROUPED",UNPAIRED="UNPAIRED",WILDCARD="WILDCARD",WITHDRAWN="WITHDRAWN",EQUIVALENT_ACCEPTANCE_STATUSES=["CONFIRMED",DIRECT_ACCEPTANCE,"JUNIOR_EXEMPT","ORGANISER_ACCEPTANCE","SPECIAL_EXEMPT"],DRAW_SPECIFIC_STATUSES=[FEED_IN,LUCKY_LOSER,QUALIFIER],DIRECT_ENTRY_STATUSES=["CONFIRMED",DIRECT_ACCEPTANCE,FEED_IN,"JUNIOR_EXEMPT","ORGANISER_ACCEPTANCE","SPECIAL_EXEMPT",WILDCARD],STRUCTURE_SELECTED_STATUSES=["CONFIRMED",DIRECT_ACCEPTANCE,FEED_IN,"JUNIOR_EXEMPT",LUCKY_LOSER,QUALIFIER,"ORGANISER_ACCEPTANCE","SPECIAL_EXEMPT",WILDCARD],VALID_ENTRY_STATUSES=[ALTERNATE,"CONFIRMED",DIRECT_ACCEPTANCE,FEED_IN,"JUNIOR_EXEMPT",LUCKY_LOSER,"ORGANISER_ACCEPTANCE",QUALIFIER,"REGISTERED","SPECIAL_EXEMPT",UNGROUPED,UNPAIRED,WILDCARD,WITHDRAWN],STRUCTURE_ENTERED_TYPES=STRUCTURE_SELECTED_STATUSES;function stageExists({stage,drawDefinition}){const{entryProfile}=getEntryProfile({drawDefinition}),exists=Object.keys(entryProfile).includes(stage);if(!exists&&validStages.includes(stage)){return modifyEntryProfile({drawDefinition,attributes:[{[stage]:{drawSize:void 0,alternates:!0}}]}),!0}return exists}function getStageEntryTypeCount({stage,drawDefinition,entryStatus}){return drawDefinition.entries.reduce(((p,c)=>c.entryStage===stage&&c.entryStatus===entryStatus?p+1:p),0)}function getStageEntries$1({provisionalPositioning,drawDefinition,stageSequence,entryStatuses,structureId,roundTarget,stages,stage}){var _a;const entries=(null==(_a=drawDefinition.entries)?void 0:_a.reduce(((entries2,entry)=>{var _a2,_b;const entryRoundTarget=null==(_b=null==(_a2=findExtension$1({name:ROUND_TARGET,element:entry}))?void 0:_a2.extension)?void 0:_b.value,stageTarget=stage&&entry.entryStage===stage||(null==stages?void 0:stages.length)&&stages.includes(entry.entryStage),matchesEntryType=!entryStatuses||entryStatuses.includes(entry.entryStatus),entryStageSequence=entry.entryStageSequence||1;return stageTarget&&(!stageSequence||entryStageSequence===stageSequence)&&matchesEntryType&&(!roundTarget||!entryRoundTarget||roundTarget===entryRoundTarget)?entries2.concat(entry):entries2}),[]))||[];if(structureId&&stage===PLAY_OFF){const{playoffEntries,error}=function getPlayoffEntries({provisionalPositioning,drawDefinition,structureId}){const playoffEntries=[],inboundLink=(drawDefinition.links||[]).find((link=>link.linkType===POSITION&&link.target.structureId===structureId));if(inboundLink){const{finishingPositions,structureId:structureId2}=inboundLink.source,{structure:sourceStructure}=findStructure({drawDefinition,structureId:structureId2});if(sourceStructure.structureType===CONTAINER){(sourceStructure.structures||[]).forEach((structure=>{const{positionAssignments}=structure,{structureId:playoffStructureId}=structure,groupingValue=playoffStructureId,results=Object.assign({},...positionAssignments.map((assignment=>{var _a;const{participantId}=assignment,results2=null==(_a=findExtension$1({element:assignment,name:TALLY}).extension)?void 0:_a.value;return results2?{[participantId]:results2}:void 0})).filter(Boolean)),uniqueFinishingPositions=Object.keys(results).reduce(((unique,key)=>{const result=results[key],finishingPosition=result.groupOrder||provisionalPositioning&&result.provisionalOrder;return unique.includes(finishingPosition)||unique.push(finishingPosition),unique}),[]),finishingPositionsAreUnique=uniqueFinishingPositions.length===Object.keys(results).length,participantIds=Object.keys(results).filter((key=>{const result=results[key],finishingPosition=result.groupOrder||provisionalPositioning&&result.provisionalOrder;return finishingPositions.includes(finishingPosition)}));provisionalPositioning&&!finishingPositionsAreUnique||participantIds.forEach((participantId=>{const participantResult=results[participantId],{groupOrder,provisionalOrder,GEMscore}=participantResult,finishingPosition=groupOrder||provisionalPositioning&&provisionalOrder,placementGroup=finishingPositions.sort().indexOf(finishingPosition)+1;playoffEntries.push({entryStage:PLAY_OFF,entryStatus:FEED_IN,placementGroup,groupingValue,participantId,GEMscore})}))}))}}return{playoffEntries}}({provisionalPositioning,drawDefinition,structureId});return error&&console.log("playoff entries error"),(null==playoffEntries?void 0:playoffEntries.length)?playoffEntries:entries}return entries}function getStageDirectEntriesCount({stage,drawDefinition}){return DIRECT_ENTRY_STATUSES.reduce(((count,entryStatus)=>(getStageEntryTypeCount({drawDefinition,entryStatus,stage})||0)+count),0)}function getStructureSeedAssignments({provisionalPositioning,drawDefinition,matchUpsMap,structureId,structure}){var _a;let error,seedAssignments=[];if(structure||({structure,error}=findStructure({drawDefinition,structureId})),!structure)return{seedAssignments:[],error:STRUCTURE_NOT_FOUND};structureId||(structureId=structure.structureId);const{stage,stageSequence}=structure;if(!error){if(stage===PLAY_OFF&&drawDefinition){const seedProxies=getStageEntries$1({provisionalPositioning,drawDefinition,stageSequence,matchUpsMap,structureId,stage}).filter((entry=>1===entry.placementGroup)).sort(((a,b)=>(a.GEMscore<b.GEMscore?1:a.GEMscore>b.GEMscore&&-1)||0)).map(((entry,index)=>{const seedNumber=index+1;return{participantId:entry.participantId,seedValue:seedNumber,seedNumber,seedProxy:!0}}));seedAssignments=seedProxies.length?seedProxies:structure.seedAssignments}else structure.seedAssignments?seedAssignments=structure.seedAssignments:error=MISSING_SEED_ASSIGNMENTS}return{seedAssignments,seedLimit:structure.seedLimit||(null==(_a=null==structure?void 0:structure.positionAssignments)?void 0:_a.length),stage,stageSequence,error}}function reduceGroupedOrder({groupedOrder,roundPositionsCount}){if(!groupedOrder||(null==groupedOrder?void 0:groupedOrder.length)<=roundPositionsCount)return groupedOrder;const chunkValues=chunkArray(groupedOrder,groupedOrder.length/roundPositionsCount).map((chunk=>chunk.reduce(((a,b)=>a+b)))),sortedChunks=chunkValues.slice().sort(numericSort);return chunkValues.map((chunkValue=>sortedChunks.indexOf(chunkValue)+1))}function getRangeString(arr){if(!Array.isArray(arr))return"";const numericArray=arr.filter(isNumeric);if(!numericArray.length)return"";return unique([Math.min(...numericArray),Math.max(...numericArray)]).join("-")}const extractor=object=>attr=>object[attr],getMatchUpIds=(o=[])=>o.map(getMatchUpId).filter(Boolean),getParticipantIds=(o=[])=>o.map(getParticipantId).filter(Boolean),getParticipantId=(o={})=>extractor(o)("participantId"),getDrawPosition=(o={})=>extractor(o)("drawPosition"),getMatchUpId=(o={})=>extractor(o)("matchUpId");function getAllPositionedParticipantIds({drawDefinition}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const stagePositionedParticipantIds={};return{allPositionedParticipantIds:(drawDefinition.structures||[]).map((structure=>{const stage=structure.stage;stagePositionedParticipantIds[stage]||(stagePositionedParticipantIds[stage]=[]);const{positionAssignments}=getPositionAssignments$1({structure}),particiapntIds=getParticipantIds(positionAssignments);return stagePositionedParticipantIds[stage].push(...particiapntIds),particiapntIds})).flat(),stagePositionedParticipantIds}}function getPositionAssignments$1({drawDefinition,structureId,structure}){let error,positionAssignments=[];if(!structure){if(!drawDefinition)return{positionAssignments,error:MISSING_DRAW_DEFINITION};if(({structure,error}=findStructure({drawDefinition,structureId})),error)return{positionAssignments,error}}return structure.structures?positionAssignments=[].concat(...structure.structures.map((structure2=>getPositionAssignments$1({structure:structure2}).positionAssignments))):structure.positionAssignments?positionAssignments=structure.positionAssignments:error=MISSING_POSITION_ASSIGNMENTS,{positionAssignments,error}}function structureAssignedDrawPositions({drawDefinition,structureId,structure}){const{positionAssignments}=getPositionAssignments$1({drawDefinition,structureId,structure}),assignedPositions=positionAssignments.filter((drawPosition=>drawPosition.participantId||drawPosition.bye||drawPosition.qualifier)),allPositionsAssigned=positionAssignments.length===assignedPositions.length,unassignedPositions=positionAssignments.filter((drawPosition=>!drawPosition.participantId&&!drawPosition.bye&&!drawPosition.qualifier));return{byePositions:positionAssignments.filter((drawPosition=>!drawPosition.participantId&&drawPosition.bye)),assignedPositions,qualifierPositions:positionAssignments.filter((drawPosition=>!drawPosition.participantId&&drawPosition.qualifier)),unassignedPositions,positionAssignments,allPositionsAssigned}}function getOrderedDrawPositions({drawPositions,roundProfile,roundNumber}){const unassignedDrawPositions=[void 0,void 0];if(function noNumeric(arr){return arr.reduce(((numeric,item)=>isNaN(parseInt(item))&&numeric),!0)}(drawPositions))return{orderedDrawPositions:unassignedDrawPositions,displayOrder:unassignedDrawPositions};const targetRoundProfile=roundProfile[roundNumber],pairedDrawPositions=null==targetRoundProfile?void 0:targetRoundProfile.pairedDrawPositions,displayOrder=(null==pairedDrawPositions?void 0:pairedDrawPositions.find((pair=>overlap(pair||[],drawPositions.filter(Boolean)))))||unassignedDrawPositions,isFeedRound=null==targetRoundProfile?void 0:targetRoundProfile.feedRound;if(function allNumeric$1(arr){return arr.reduce(((numeric,item)=>!isNaN(parseInt(item))&&numeric),!0)}(drawPositions)){const orderedDrawPositions=drawPositions.sort(numericSort);return{orderedDrawPositions:2===orderedDrawPositions.length?orderedDrawPositions:displayOrder,displayOrder:isFeedRound?orderedDrawPositions:displayOrder}}if(isFeedRound){const orderedDrawPositions=[drawPositions.find((drawPosition2=>!isNaN(parseInt(drawPosition2)))),void 0];return{orderedDrawPositions,displayOrder:orderedDrawPositions}}return{orderedDrawPositions:displayOrder,displayOrder}}function isAdHoc({drawDefinition,structure}){return!!structure&&!((null==structure?void 0:structure.structures)||(null==drawDefinition?void 0:drawDefinition.drawType)&&drawDefinition.drawType!==AD_HOC||(null==structure?void 0:structure.matchUps.find((({roundPosition})=>!!roundPosition))))}const POLICY_ROUND_NAMING_DEFAULT={[POLICY_TYPE_ROUND_NAMING]:{policyName:"Round Naming Default",abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q"},stageConstants:{[MAIN]:"",[PLAY_OFF]:"P",[QUALIFYING]:"Q",[CONSOLATION]:"C"}}};function getRoundContextProfile({roundNamingPolicy,structure,matchUps}){const{hasOddMatchUpsCount,roundProfile,roundMatchUps}=getRoundMatchUps$1({matchUps}),{structureAbbreviation,stage}=structure,isAdHocStructure=isAdHoc({structure}),isLuckyStructure=function isLucky({hasOddMatchUpsCount,drawDefinition,roundMatchUps,structure}){var _a,_b;if(!structure)return!1;roundMatchUps||({hasOddMatchUpsCount,roundMatchUps}=getRoundMatchUps$1({matchUps:structure.matchUps||[]}));const hasFirstRoundDrawPositions=!!(null==(_a=null==roundMatchUps?void 0:roundMatchUps[1])?void 0:_a.find((({drawPositions})=>drawPositions))),noSecondRoundDrawPositions=!(null==(_b=null==roundMatchUps?void 0:roundMatchUps[2])?void 0:_b.find((({drawPositions})=>drawPositions)));return hasOddMatchUpsCount&&!(null==structure?void 0:structure.structures)&&hasFirstRoundDrawPositions&&noSecondRoundDrawPositions&&!((null==drawDefinition?void 0:drawDefinition.drawType)&&drawDefinition.drawType!==LUCKY_DRAW)}({hasOddMatchUpsCount,roundMatchUps,structure}),isRoundRobin=structure.structures,roundNamingProfile={},defaultRoundNamingPolicy=POLICY_ROUND_NAMING_DEFAULT[POLICY_TYPE_ROUND_NAMING],roundNamingMap=(null==roundNamingPolicy?void 0:roundNamingPolicy.roundNamingMap)||defaultRoundNamingPolicy.roundNamingMap||{},abbreviatedRoundNamingMap=(null==roundNamingPolicy?void 0:roundNamingPolicy.abbreviatedRoundNamingMap)||defaultRoundNamingPolicy.abbreviatedRoundNamingMap||{},roundNamePrefix=(null==roundNamingPolicy?void 0:roundNamingPolicy.affixes)||defaultRoundNamingPolicy.affixes,stageInitial=stage&&stage!==MAIN&&stage[0],stageConstants=null==roundNamingPolicy?void 0:roundNamingPolicy.stageConstants,stageConstant=stageConstants&&stageConstants[stage]||stageInitial;return isRoundRobin||isAdHocStructure||isLuckyStructure?Object.assign(roundNamingProfile,...Object.keys(roundProfile).map((key=>({[key]:{roundName:`Round ${key}`,abbreviatedRoundName:`R${key}`}})))):Object.assign(roundNamingProfile,...Object.keys(roundProfile).map((round=>{const{matchUpsCount,preFeedRound}=roundProfile[round],participantsCount=2*matchUpsCount,sizedRoundName=roundNamingMap[matchUpsCount]||`${roundNamePrefix.roundNumber}${participantsCount}`,suffix=preFeedRound?`-${roundNamePrefix.preFeedRound}`:"",roundName=[stageConstant,structureAbbreviation,`${sizedRoundName}${suffix}`].filter(Boolean).join("-"),sizedAbbreviation=abbreviatedRoundNamingMap[matchUpsCount]||`${roundNamePrefix.roundNumber}${participantsCount}`;return{[round]:{abbreviatedRoundName:[stageConstant,structureAbbreviation,`${sizedAbbreviation}${suffix}`].filter(Boolean).join("-"),roundName}}}))),{roundNamingProfile,roundProfile,roundMatchUps}}function getMatchUpParticipantIds({matchUp}){let error,sideParticipantIds=[],individualParticipantIds=[],allRelevantParticipantIds=[],nestedIndividualParticipantIds=[];if(matchUp||(error=MISSING_MATCHUP),matchUp&&!matchUp.sides&&(error=INVALID_MATCHUP),matchUp&&!matchUp.hasContext&&(error=MISSING_CONTEXT),!error){sideParticipantIds=matchUp.sides.map((side=>side.participantId));const sideIndividualParticipantIds=matchUp.sides.filter((side=>side.participantType===INDIVIDUAL)).map((participant=>participant.participantId)).filter(Boolean);nestedIndividualParticipantIds=matchUp.sides.map((side=>side.participant&&side.participant.individualParticipants)).filter(Boolean).map((participants=>participants.map((participant=>null==participant?void 0:participant.participantId)).filter(Boolean))),individualParticipantIds=[].concat(...sideIndividualParticipantIds,...nestedIndividualParticipantIds.flat()).filter(Boolean),allRelevantParticipantIds=unique(individualParticipantIds.concat(sideParticipantIds)).filter(Boolean)}return{error,sideParticipantIds,individualParticipantIds,allRelevantParticipantIds,nestedIndividualParticipantIds}}function getCheckedInParticipantIds({matchUp}){if(!matchUp)return{error:MISSING_MATCHUP};if(!matchUp.hasContext)return{error:MISSING_CONTEXT};if(!matchUp.sides||2!==matchUp.sides.filter(Boolean).length)return{error:INVALID_MATCHUP};const{sideParticipantIds,nestedIndividualParticipantIds,allRelevantParticipantIds}=getMatchUpParticipantIds({matchUp}),checkInItems=(matchUp.timeItems||[]).filter((timeItem=>[CHECK_IN,CHECK_OUT].includes(null==timeItem?void 0:timeItem.itemType))).sort(((a,b)=>new Date(a.createdAt)-new Date(b.createdAt))),checkedInParticipantIds=checkInItems.map((timeItem=>timeItem.itemValue)).filter((participantId=>checkInItems.filter((timeItem=>(null==timeItem?void 0:timeItem.itemValue)===participantId)).reverse()[0].itemType===CHECK_IN));null==nestedIndividualParticipantIds||nestedIndividualParticipantIds.forEach(((sideIndividualParticipantIds,sideIndex)=>{const sideParticipantId=sideParticipantIds[sideIndex],allIndividualsCheckedIn=(null==sideIndividualParticipantIds?void 0:sideIndividualParticipantIds.length)&&sideIndividualParticipantIds.reduce(((checkedIn,participantId)=>checkedIn&&participantId&&checkedInParticipantIds.includes(participantId)),!0);sideParticipantId&&allIndividualsCheckedIn&&!checkedInParticipantIds.includes(sideParticipantId)&&checkedInParticipantIds.push(sideParticipantId)})),sideParticipantIds.forEach(((sideParticipantId,sideIndex)=>{checkedInParticipantIds.includes(sideParticipantId)&&(nestedIndividualParticipantIds[sideIndex]||[]).forEach((participantId=>{participantId&&!checkedInParticipantIds.includes(participantId)&&checkedInParticipantIds.push(participantId)}))}));return{allParticipantsCheckedIn:sideParticipantIds.reduce(((checkedIn,participantId)=>checkedInParticipantIds.includes(participantId)&&checkedIn),!0),checkedInParticipantIds,allRelevantParticipantIds}}function filterMatchUps(params){const{matchUps,isCollectionMatchUp,excludeMatchUpStatuses,matchUpStatuses,hasWinningSide,matchUpFormats,roundPositions,matchUpFormat,collectionIds,isMatchUpTie,roundNumbers,matchUpIds,roundNames,stageSequences,scheduledDates,scheduledDate,participantIds,processContext,tournamentIds,matchUpTypes,structureIds,readyToScore,courtIds,eventIds,venueIds,drawIds,stages,filterMatchUpIds=!0,filterMatchUpTypes=!0}=params,targetParticipantIds=Array.isArray(participantIds)?participantIds.filter(Boolean):[],targetMatchUpStatuses=Array.isArray(matchUpStatuses)?matchUpStatuses.filter(Boolean):[],excludeTargetMatchUpStatuses=Array.isArray(excludeMatchUpStatuses)?excludeMatchUpStatuses.filter(Boolean):[],targetStages=Array.isArray(stages)?stages.filter(Boolean):[],targetStageSequences=Array.isArray(stageSequences)?stageSequences.filter(Boolean):[],targetCollectionIds=Array.isArray(collectionIds)?collectionIds.filter(Boolean):[],targetRoundNames=Array.isArray(roundNames)?roundNames.filter(Boolean):[],targetRoundNumbers=Array.isArray(roundNumbers)?roundNumbers.filter(Boolean):[],targetRoundPositions=Array.isArray(roundPositions)?roundPositions.filter(Boolean):[],targetMatchUpIds=Array.isArray(matchUpIds)&&filterMatchUpIds?matchUpIds.filter(Boolean):[],targetMatchUpTypes=Array.isArray(matchUpTypes)&&filterMatchUpTypes?matchUpTypes.filter(Boolean):[],targetCourtIds=Array.isArray(courtIds)?courtIds.filter(Boolean):[],targetVenueIds=Array.isArray(venueIds)?venueIds.filter(Boolean):[],targetMatchUpFormats=Array.isArray(matchUpFormats)&&matchUpFormats.filter(Boolean)||"string"==typeof matchUpFormat&&[matchUpFormat]||[],targetScheduledDates=Array.isArray(scheduledDates)&&scheduledDates.filter(Boolean)||"string"==typeof scheduledDate&&scheduledDate.length&&[scheduledDate]||[],targetTournamentIds=Array.isArray(tournamentIds)?tournamentIds.filter(Boolean):[],targetEventIds=Array.isArray(eventIds)?eventIds.filter(Boolean):[],targetDrawIds=Array.isArray(drawIds)?drawIds.filter(Boolean):[],targetStructureIds=Array.isArray(structureIds)?structureIds.filter(Boolean):[];return matchUps.filter((matchUp=>{var _a;if(readyToScore&&matchUp.matchUpType!==TEAM_MATCHUP&&!matchUp.readyToScore)return!1;if(hasWinningSide&&![1,2].includes(matchUp.winningSide))return!1;if(void 0!==isMatchUpTie){if(isMatchUpTie&&!matchUp.tieMatchUps)return!1;if(!isMatchUpTie&&matchUp.tieMatchUps)return!1}if(void 0!==isCollectionMatchUp){if(isCollectionMatchUp&&!matchUp.collectionId)return!1;if(!isCollectionMatchUp&&matchUp.collectionId)return!1}if(targetStages.length&&!targetStages.includes(matchUp.stage))return!1;if(targetStageSequences.length&&!targetStageSequences.includes(matchUp.stageSequence))return!1;if(targetCollectionIds.length&&!targetCollectionIds.includes(matchUp.collectionId))return!1;if(targetRoundNames.length&&!targetRoundNames.includes(matchUp.roundName))return!1;if(targetRoundNumbers.length&&!roundNumbers.includes(matchUp.roundNumber))return!1;if(targetRoundPositions.length&&!roundPositions.includes(matchUp.roundPosition))return!1;if(targetMatchUpStatuses.length&&!targetMatchUpStatuses.includes(matchUp.matchUpStatus))return!1;if(excludeTargetMatchUpStatuses.length&&excludeTargetMatchUpStatuses.includes(matchUp.matchUpStatus))return!1;if(targetMatchUpIds.length&&!targetMatchUpIds.includes(matchUp.matchUpId))return!1;if(targetMatchUpTypes.length&&!targetMatchUpTypes.includes(matchUp.matchUpType))return!1;if(targetMatchUpFormats.length&&!targetMatchUpFormats.includes(matchUp.matchUpFormat))return!1;if(null==targetScheduledDates?void 0:targetScheduledDates.length){const{scheduledTime}=scheduledMatchUpTime({matchUp}),{scheduledDate:matchUpDate}=scheduledMatchUpDate({matchUp}),comparisonDate=extractDate(scheduledTime)||matchUpDate;if(!targetScheduledDates.find((scheduledDate2=>sameDay(scheduledDate2,comparisonDate))))return!1}if(targetCourtIds.length){const{courtId}=matchUpAssignedCourtId({matchUp}),{allocatedCourts}=matchUpAllocatedCourts({matchUp}),allocatedCourtIds=null==allocatedCourts?void 0:allocatedCourts.map((({courtId:courtId2})=>courtId2));if(!courtIds.filter(Boolean).includes(courtId)||(null==allocatedCourtIds?void 0:allocatedCourtIds.includes(courtId)))return!1}if(targetVenueIds.length){const{venueId}=matchUpAssignedVenueId({matchUp});if(!venueIds.filter(Boolean).includes(venueId))return!1}if(processContext){if(targetTournamentIds.length&&!targetTournamentIds.includes(matchUp.tournamentId))return!1;if(targetEventIds.length&&!targetEventIds.includes(matchUp.eventId))return!1;if(targetDrawIds.length&&!targetDrawIds.includes(matchUp.drawId))return!1;if(targetStructureIds.length&&!targetStructureIds.includes(matchUp.structureId))return!1;if(targetParticipantIds.length){const matchUpParticipantIds=(null==(_a=matchUp.sides)?void 0:_a.map((({participantId})=>participantId)).filter(Boolean))||[];if(!targetParticipantIds.some((participantId=>matchUpParticipantIds.includes(participantId))))return!1}}return!0}))}function getSide({drawPositionCollectionAssignment,positionAssignments,displaySideNumber,seedAssignments,drawPosition,isFeedRound,sideNumber}){var _a,_b,_c,_d;const assignment=positionAssignments.find((assignment2=>assignment2.drawPosition===drawPosition)),participantId=drawPositionCollectionAssignment?null==(_a=drawPositionCollectionAssignment[drawPosition])?void 0:_a.participantId:null==assignment?void 0:assignment.participantId,sideValue=assignment?function getSideValue$1({displaySideNumber,seedAssignments,participantId,assignment,sideNumber}){const side={drawPosition:assignment.drawPosition,displaySideNumber,sideNumber};if(participantId){const seeding=function getSeeding({seedAssignments,participantId}){return null==seedAssignments?void 0:seedAssignments.find((assignment=>!assignment.seedProxy&&assignment.participantId===participantId))}({seedAssignments,participantId});Object.assign(side,seeding,{participantId})}else assignment.bye&&Object.assign(side,{bye:!0});assignment.qualifier&&Object.assign(side,{qualifier:!0});return side}({displaySideNumber,seedAssignments,participantId,assignment,sideNumber}):{};isFeedRound&&(1===sideNumber?Object.assign(sideValue,{participantFed:!0}):Object.assign(sideValue,{participantAdvanced:!0}));const teamParticipant=null==(_b=null==drawPositionCollectionAssignment?void 0:drawPositionCollectionAssignment[drawPosition])?void 0:_b.teamParticipant,participant=null==(_c=null==drawPositionCollectionAssignment?void 0:drawPositionCollectionAssignment[drawPosition])?void 0:_c.participant,substitutions=null==(_d=null==drawPositionCollectionAssignment?void 0:drawPositionCollectionAssignment[drawPosition])?void 0:_d.substitutions;return participant&&Object.assign(sideValue,{participant}),substitutions&&Object.assign(sideValue,{substitutions}),teamParticipant&&Object.assign(sideValue,{teamParticipant}),sideValue}const ANY="ANY",MALE="MALE",MIXED="MIXED",OTHER$2="OTHER",FEMALE="FEMALE",genderConstants={ANY,MALE,FEMALE,MIXED,OTHER:OTHER$2};var __defProp$4w=Object.defineProperty,__defProps$2z=Object.defineProperties,__getOwnPropDescs$2z=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4x=Object.getOwnPropertySymbols,__hasOwnProp$4x=Object.prototype.hasOwnProperty,__propIsEnum$4x=Object.prototype.propertyIsEnumerable,__defNormalProp$4w=(obj,key,value)=>key in obj?__defProp$4w(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4w=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4x.call(b,prop)&&__defNormalProp$4w(a,prop,b[prop]);if(__getOwnPropSymbols$4x)for(var prop of __getOwnPropSymbols$4x(b))__propIsEnum$4x.call(b,prop)&&__defNormalProp$4w(a,prop,b[prop]);return a},__spreadProps$2z=(a,b)=>__defProps$2z(a,__getOwnPropDescs$2z(b));function getAllStructureMatchUps({scheduleVisibilityFilters,tournamentAppliedPolicies,provisionalPositioning,tournamentParticipants,afterRecoveryTimes,policyDefinitions,tournamentRecord,seedAssignments,drawDefinition,contextFilters,contextProfile,contextContent,matchUpFilters,participantMap,scheduleTiming,exitProfiles,context={},matchUpsMap,structure,inContext,event}){var _a,_b,_c,_d;let collectionPositionMatchUps={},roundMatchUps={};if(tournamentParticipants=tournamentParticipants||(null==tournamentRecord?void 0:tournamentRecord.participants),!structure)return{collectionPositionMatchUps,error:MISSING_STRUCTURE,roundMatchUps,matchUps:[]};const selectedEventIds=Array.isArray(null==matchUpFilters?void 0:matchUpFilters.eventIds)?matchUpFilters.eventIds.filter(Boolean):[],selectedStructureIds=Array.isArray(null==matchUpFilters?void 0:matchUpFilters.structureIds)?matchUpFilters.structureIds.filter(Boolean):[],selectedDrawIds=Array.isArray(null==matchUpFilters?void 0:matchUpFilters.drawIds)?matchUpFilters.drawIds.filter(Boolean):[],targetEvent=!(null==context?void 0:context.eventId)||!selectedEventIds.length&&!(null==(_a=null==contextFilters?void 0:contextFilters.eventIds)?void 0:_a.filter(Boolean).length)||selectedEventIds.includes(context.eventId)||(null==(_b=null==contextFilters?void 0:contextFilters.eventIds)?void 0:_b.includes(context.eventId)),targetStructure=!selectedStructureIds.length||selectedStructureIds.includes(structure.structureId),targetDraw=!drawDefinition||!selectedDrawIds.length||selectedDrawIds.includes(drawDefinition.drawId);if(!targetEvent||!targetStructure||!targetDraw)return{collectionPositionMatchUps,roundMatchUps,matchUps:[]};contextProfile&&!contextContent&&(contextContent=getContextContent({tournamentRecord,contextProfile,drawDefinition}));const{appliedPolicies:drawAppliedPolicies}=getAppliedPolicies({drawDefinition}),appliedPolicies=Object.assign({},tournamentAppliedPolicies,drawAppliedPolicies,policyDefinitions),structureScoringPolicies=null==(_c=null==appliedPolicies?void 0:appliedPolicies.scoring)?void 0:_c.structures,stageSpecificPolicies=(null==structureScoringPolicies?void 0:structureScoringPolicies.stage)&&(null==structureScoringPolicies?void 0:structureScoringPolicies.stage[structure.stage]),sequenceSpecificPolicies=(null==stageSpecificPolicies?void 0:stageSpecificPolicies.stageSequence)&&stageSpecificPolicies.stageSequence[structure.stageSequence],requireAllPositionsAssigned=(null==(_d=null==appliedPolicies?void 0:appliedPolicies.scoring)?void 0:_d.requireAllPositionsAssigned)||(null==stageSpecificPolicies?void 0:stageSpecificPolicies.requireAllPositionsAssigned)||(null==sequenceSpecificPolicies?void 0:sequenceSpecificPolicies.requireAllPositionsAssigned);matchUpsMap||(matchUpsMap=getMatchUpsMap({drawDefinition,structure}));const{positionAssignments,allPositionsAssigned}=structureAssignedDrawPositions({structure}),scoringActive=!requireAllPositionsAssigned||allPositionsAssigned,{seedAssignments:structureSeedAssignments}=getStructureSeedAssignments({provisionalPositioning,drawDefinition,matchUpsMap,structure});seedAssignments=seedAssignments||structureSeedAssignments;const{roundOffset,structureId,structureName,stage,stageSequence}=structure,{drawId,drawName,drawType}=drawDefinition||{},exitProfile=null==(exitProfiles=exitProfiles||drawDefinition&&getExitProfiles({drawDefinition}).exitProfiles)?void 0:exitProfiles[structureId],initialRoundOfPlay=(null==exitProfile?void 0:exitProfile.length)&&(exitProfile[0].split("-").map((x=>parseInt(x))).reduce(((a,b)=>a+b))||0),isRoundRobin=!!structure.structures;let matchUps=getMappedStructureMatchUps({matchUpsMap,structureId,inContext});const result=getRoundContextProfile({roundNamingPolicy:null==appliedPolicies?void 0:appliedPolicies[POLICY_TYPE_ROUND_NAMING],drawDefinition,structure,matchUps}),{roundNamingProfile,roundProfile}=result;if(roundMatchUps=result.roundMatchUps,matchUpFilters&&(matchUps=filterMatchUps(__spreadProps$2z(__spreadValues$4w({matchUps},matchUpFilters),{filterMatchUpTypes:!1,filterMatchUpIds:!1}))),inContext){const{sourceDrawPositionRanges}=function getSourceDrawPositionRanges({drawDefinition,structureId,matchUpsMap}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structureId)return{error:MISSING_STRUCTURE_ID};const{structure}=findStructure({drawDefinition,structureId});if(structure.stage!==CONSOLATION)return{error:INVALID_STAGE,info:"Structure is not CONSOLATION stage"};const{links}=drawDefinition,relevantLinks=(null==links?void 0:links.filter((link=>link.target.structureId===structureId)))||[],sourceStructureIds=(null==relevantLinks?void 0:relevantLinks.reduce(((sourceStructureIds2,link)=>{const{structureId:sourceStructureId}=link.source;return sourceStructureIds2.includes(sourceStructureId)?sourceStructureIds2:sourceStructureIds2.concat(sourceStructureId)}),[]))||[],sourceStructureProfiles=Object.assign({},...sourceStructureIds.map((sourceStructureId=>{const structureMatchUps2=getMappedStructureMatchUps({matchUpsMap,structureId:sourceStructureId}),{roundProfile}=getRoundMatchUps$1({matchUps:structureMatchUps2});return{[sourceStructureId]:roundProfile}}))),structureMatchUps=getMappedStructureMatchUps({matchUpsMap,structureId}),{roundProfile:targetStructureProfile}=getRoundMatchUps$1({matchUps:structureMatchUps}),sourceDrawPositionRanges={};return null==relevantLinks||relevantLinks.forEach((link=>{const{structureId:sourceStructureId,roundNumber:sourceRoundNumber}=link.source,{feedProfile,groupedOrder,positionInterleave,roundNumber:targetRoundNumber}=link.target,sourceStructureProfile=sourceStructureProfiles[sourceStructureId],firstRoundDrawPositions=sourceStructureProfile[1]&&sourceStructureProfile[1].drawPositions,sourceRoundProfile=sourceStructureProfile[sourceRoundNumber],sourceRoundMatchUpsCount=null==sourceRoundProfile?void 0:sourceRoundProfile.matchUpsCount;if(!sourceRoundMatchUpsCount)return;const chunkSize=sourceRoundMatchUpsCount?firstRoundDrawPositions.length/sourceRoundMatchUpsCount:0,targetRoundMatchUpsCount=firstRoundDrawPositions.length/chunkSize;let orderedPositions=firstRoundDrawPositions.slice();const sizedGroupOrder=reduceGroupedOrder({roundPositionsCount:orderedPositions.length,groupedOrder}),groupsCount=(null==sizedGroupOrder?void 0:sizedGroupOrder.length)||1;if(groupsCount<=targetRoundMatchUpsCount){const groups=chunkArray(orderedPositions,firstRoundDrawPositions.length/groupsCount);feedProfile===BOTTOM_UP&&groups.forEach((group=>group.reverse())),orderedPositions=(null==sizedGroupOrder?void 0:sizedGroupOrder.length)&&(null==sizedGroupOrder?void 0:sizedGroupOrder.map((order=>groups[order-1])).flat())||orderedPositions}let drawPositionBlocks=chunkArray(orderedPositions,chunkSize);if((null==sizedGroupOrder?void 0:sizedGroupOrder.length)||feedProfile===BOTTOM_UP&&drawPositionBlocks.reverse(),positionInterleave){const interleave=generateRange(0,positionInterleave.interleave).map((()=>{})),offset=generateRange(0,positionInterleave.offset).map((()=>{}));drawPositionBlocks=drawPositionBlocks.map((block=>[block,...interleave])),drawPositionBlocks.unshift(offset),drawPositionBlocks=drawPositionBlocks.flat(1);const targetLength=drawPositionBlocks.length-positionInterleave.offset;drawPositionBlocks=drawPositionBlocks.slice(0,targetLength)}sourceDrawPositionRanges[targetRoundNumber]||(sourceDrawPositionRanges[targetRoundNumber]={});const targetRoundProfile=targetStructureProfile[targetRoundNumber],increment=(null==targetRoundProfile?void 0:targetRoundProfile.feedRound)?2:1;drawPositionBlocks.forEach(((block,index)=>{const columnPosition=1+index*increment;sourceDrawPositionRanges[targetRoundNumber][columnPosition]||(sourceDrawPositionRanges[targetRoundNumber][columnPosition]=getRangeString(block))}))})),{sourceDrawPositionRanges}}({drawDefinition,matchUpsMap,structureId}),{drawPositionsRanges}=function getDrawPositionsRanges({drawDefinition,roundProfile,structureId,matchUpsMap}){var _a;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structureId)return{error:MISSING_STRUCTURE_ID};if(!roundProfile){const structureMatchUps=getMappedStructureMatchUps({matchUpsMap,structureId});({roundProfile}=getRoundMatchUps$1({matchUps:structureMatchUps}))}const firstRoundFirstDrawPositionOffset=(Math.min(...(null==(_a=roundProfile[1])?void 0:_a.drawPositions)||[])||1)-1,roundNumbers=Object.keys(roundProfile);return{drawPositionsRanges:Object.assign({},...(roundNumbers||[]).map((roundNumber=>{var _a2;const{matchUpsCount}=roundProfile[roundNumber],firstRoundDrawPositions=(null==(_a2=roundProfile[1])?void 0:_a2.drawPositions)||[],firstRoundDrawPositionsChunks=chunkArray(firstRoundDrawPositions,firstRoundDrawPositions.length/matchUpsCount),firstRoundDrawPositionsRanges=firstRoundDrawPositionsChunks.map(getRangeString),firstRoundOffsetDrawPositionsRanges=firstRoundDrawPositionsChunks.map((drawPositions=>drawPositions.map((drawPosition=>drawPosition-firstRoundFirstDrawPositionOffset)))).map(getRangeString),currentRoundDrawPositionChunks=roundNumbers.map((value=>{if(value>roundNumber)return;const{drawPositions}=roundProfile[value];return chunkArray(drawPositions,drawPositions.length/matchUpsCount)})).filter(Boolean),possibleDrawPositions=generateRange(0,matchUpsCount).map((index=>currentRoundDrawPositionChunks.map((chunk=>chunk[index])).flat().filter(Boolean).sort(numericSort))).map((possible=>unique(possible))),drawPositionsRanges2=possibleDrawPositions.map((possible=>function groupConsecutiveNumbers(arr){return arr.reduce(((result,num)=>{const finalGroup=result[result.length-1];return finalGroup&&finalGroup[finalGroup.length-1]===num-1||result.push([]),result[result.length-1].push(num),result}),[])}(possible).map(getRangeString).join(", "))),roundPositionsMap=Object.assign({},...generateRange(0,matchUpsCount).map((index=>({[index+1]:{firstRoundDrawPositionsRange:firstRoundDrawPositionsRanges[index],firstRoundOffsetDrawPositionsRange:firstRoundOffsetDrawPositionsRanges[index],possibleDrawPositions:possibleDrawPositions[index],drawPositionsRange:drawPositionsRanges2[index]}}))));return{[roundNumber]:roundPositionsMap}})))}}({drawDefinition,roundProfile,matchUpsMap,structureId});matchUps=matchUps.map((matchUp=>addMatchUpContext({scheduleVisibilityFilters,sourceDrawPositionRanges,drawPositionsRanges,roundNamingProfile,initialRoundOfPlay,appliedPolicies,isRoundRobin,roundProfile,matchUp,event})));(null==matchUps?void 0:matchUps.filter((matchUp=>Array.isArray(matchUp.tieMatchUps)))).forEach((matchUpTie=>{const tieMatchUps=matchUpTie.tieMatchUps;matchUps=matchUps.concat(...tieMatchUps)})),contextFilters&&(matchUps=filterMatchUps(__spreadProps$2z(__spreadValues$4w({processContext:!0},contextFilters),{matchUps})))}else{(null==matchUps?void 0:matchUps.filter((matchUp=>Array.isArray(matchUp.tieMatchUps)))).forEach((matchUpTie=>{const tieMatchUps=matchUpTie.tieMatchUps;matchUps=matchUps.concat(...tieMatchUps)}))}return matchUpFilters&&(matchUps=filterMatchUps(__spreadProps$2z(__spreadValues$4w({matchUps},matchUpFilters),{filterMatchUpTypes:!1,filterMatchUpIds:!1}))),((null==matchUpFilters?void 0:matchUpFilters.matchUpTypes)||(null==matchUpFilters?void 0:matchUpFilters.matchUpIds))&&(matchUps=filterMatchUps({matchUpTypes:matchUpFilters.matchUpTypes,matchUpIds:matchUpFilters.matchUpIds,matchUps})),((null==matchUpFilters?void 0:matchUpFilters.matchUpTypes)||(null==matchUpFilters?void 0:matchUpFilters.matchUpIds)||inContext)&&({roundMatchUps}=getRoundMatchUps$1({matchUps})),(structure.tieFormat||(null==drawDefinition?void 0:drawDefinition.tieFormat)||(null==event?void 0:event.tieFormat))&&({collectionPositionMatchUps}=function getCollectionPositionMatchUps({matchUps}){const collectionPositionMatchUpsArray=matchUps.reduce(((collectionPositions,matchUp)=>!matchUp.collectionPosition||collectionPositions.includes(matchUp.collectionPosition)?collectionPositions:collectionPositions.concat(matchUp.collectionPosition)),[]).map((collectionPosition=>({[collectionPosition]:matchUps.filter((matchUp=>matchUp.collectionPosition===collectionPosition))})));return{collectionPositionMatchUps:Object.assign({},...collectionPositionMatchUpsArray)}}({matchUps})),{matchUps,roundMatchUps,roundProfile,collectionPositionMatchUps};function addMatchUpContext({scheduleVisibilityFilters:scheduleVisibilityFilters2,sourceDrawPositionRanges,additionalContext={},drawPositionsRanges,roundNamingProfile:roundNamingProfile2,initialRoundOfPlay:initialRoundOfPlay2,tieDrawPositions,appliedPolicies:appliedPolicies2,isCollectionBye,matchUpTieId,isRoundRobin:isRoundRobin2,roundProfile:roundProfile2,sideLineUps,matchUp,event:event2}){var _a2,_b2,_c2,_d2,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n;const tieFormat=matchUp.tieFormat||structure.tieFormat||(null==drawDefinition?void 0:drawDefinition.tieFormat)||(null==event2?void 0:event2.tieFormat)||void 0,collectionDefinitions=null==tieFormat?void 0:tieFormat.collectionDefinitions,collectionDefinition=matchUp.collectionId&&(null==collectionDefinitions?void 0:collectionDefinitions.find((definition=>definition.collectionId===matchUp.collectionId))),matchUpFormat=matchUp.collectionId?null==collectionDefinition?void 0:collectionDefinition.matchUpFormat:matchUp.matchUpFormat||structure.matchUpFormat||(null==drawDefinition?void 0:drawDefinition.matchUpFormat)||(null==event2?void 0:event2.matchUpFormat),matchUpType=matchUp.matchUpType||(null==collectionDefinition?void 0:collectionDefinition.matchUpType)||structure.matchUpType||(null==drawDefinition?void 0:drawDefinition.matchUpType)||(null==event2?void 0:event2.eventType)!==TEAM$1&&(null==event2?void 0:event2.eventType),matchUpStatus=isCollectionBye?BYE:matchUp.matchUpStatus,{schedule,endDate}=getMatchUpScheduleDetails({scheduleVisibilityFilters:scheduleVisibilityFilters2,afterRecoveryTimes,tournamentRecord,scheduleTiming,matchUpFormat,matchUpType,matchUp,event:event2}),drawPositions=tieDrawPositions||matchUp.drawPositions,{collectionPosition,collectionId,roundPosition}=matchUp,roundNumber=matchUp.roundNumber||additionalContext.roundNumber,drawPositionCollectionAssignment=function getDrawPositionCollectionAssignment({tournamentParticipants,positionAssignments,collectionPosition,drawPositions=[],drawDefinition,participantMap,collectionId,sideLineUps,matchUpType}){if(!collectionId||!collectionPosition)return;const drawPositionCollectionAssignment=(null==drawPositions?void 0:drawPositions.map((drawPosition=>{var _a,_b,_c,_d,_e,_f;const teamParticipantId=null==(_a=positionAssignments.find((assignment=>assignment.drawPosition===drawPosition)))?void 0:_a.participantId,side=null==sideLineUps?void 0:sideLineUps.find((lineUp2=>(null==lineUp2?void 0:lineUp2.drawPosition)===drawPosition)),teamParticipant=(null==side?void 0:side.teamParticipant)||(null==(_b=null==participantMap?void 0:participantMap[teamParticipantId])?void 0:_b.participant)||(null==tournamentParticipants?void 0:tournamentParticipants.find((({participantId})=>participantId===teamParticipantId))),lineUp=(null==side?void 0:side.lineUp)||(null==(_c=getTeamLineUp({participantId:teamParticipantId,drawDefinition}))?void 0:_c.lineUp),{assignedParticipantIds,substitutions}=getCollectionPositionAssignments({collectionPosition,collectionId,lineUp});if(matchUpType!==DOUBLES$1){const participantId=null==assignedParticipantIds?void 0:assignedParticipantIds[0];return participantId&&{[drawPosition]:{participantId,teamParticipant,substitutions}}}if((null==assignedParticipantIds?void 0:assignedParticipantIds.length)<=2){const pairedParticipantId=null==(_e=null==(_d=null==participantMap?void 0:participantMap[assignedParticipantIds[0]])?void 0:_d.pairIdMap)?void 0:_e[assignedParticipantIds[1]],participant=pairedParticipantId&&(null==(_f=participantMap[pairedParticipantId])?void 0:_f.participant)||getPairedParticipant({participantIds:assignedParticipantIds,tournamentParticipants}).participant,participantId=null==participant?void 0:participant.participantId;return{[drawPosition]:{participantId,teamParticipant,substitutions}}}if((null==assignedParticipantIds?void 0:assignedParticipantIds.length)>2)return{[drawPosition]:{teamParticipant,substitutions}}})).filter(Boolean))||{};return Object.assign({},...drawPositionCollectionAssignment)}({tournamentParticipants,positionAssignments,collectionPosition,drawDefinition,participantMap,drawPositions,collectionId,sideLineUps,matchUpType}),roundName=(null==(_a2=null==roundNamingProfile2?void 0:roundNamingProfile2[roundNumber])?void 0:_a2.roundName)||additionalContext.roundName,abbreviatedRoundName=(null==(_b2=null==roundNamingProfile2?void 0:roundNamingProfile2[roundNumber])?void 0:_b2.abbreviatedRoundName)||additionalContext.abbreviatedRoundName,feedRound=null==(_c2=null==roundProfile2?void 0:roundProfile2[roundNumber])?void 0:_c2.feedRound,preFeedRound=null==(_d2=null==roundProfile2?void 0:roundProfile2[roundNumber])?void 0:_d2.preFeedRound,roundFactor=null==(_e=null==roundProfile2?void 0:roundProfile2[roundNumber])?void 0:_e.roundFactor,drawPositionsRoundRanges=null==drawPositionsRanges?void 0:drawPositionsRanges[roundNumber],drawPositionsRange=null==drawPositionsRoundRanges?void 0:drawPositionsRoundRanges[roundPosition],sourceDrawPositionRoundRanges=null==sourceDrawPositionRanges?void 0:sourceDrawPositionRanges[roundNumber],matchUpCategory=(null==collectionDefinition?void 0:collectionDefinition.category)?Object.assign({},(null==context?void 0:context.category)||{},collectionDefinition.category):null==context?void 0:context.category,processCodes=(null==(_f=matchUp.processCodes)?void 0:_f.length)&&matchUp.processCodes||(null==(_g=null==collectionDefinition?void 0:collectionDefinition.processCodes)?void 0:_g.length)&&(null==collectionDefinition?void 0:collectionDefinition.processCodes)||(null==(_h=structure.processCodes)?void 0:_h.length)&&structure.processCodes||(null==(_i=null==drawDefinition?void 0:drawDefinition.processCodes)?void 0:_i.length)&&(null==drawDefinition?void 0:drawDefinition.processCodes)||(null==(_j=null==event2?void 0:event2.processCodes)?void 0:_j.length)&&(null==event2?void 0:event2.processCodes)||(null==tournamentRecord?void 0:tournamentRecord.processCodes),competitiveness=(null==contextProfile?void 0:contextProfile.withCompetitiveness)&&getMatchUpCompetitiveness(__spreadProps$2z(__spreadValues$4w({},contextContent),{matchUp})).competitiveness,finishingPositionRange=matchUp.finishingPositionRange||additionalContext.finishingPositionRange,onlyDefined=obj=>definedAttributes(obj,void 0,!0),matchUpWithContext=Object.assign({},onlyDefined(context),onlyDefined({matchUpFormat:matchUp.matchUpType===TEAM$1?void 0:matchUpFormat,tieFormat:matchUp.matchUpType!==TEAM$1?void 0:tieFormat,roundOfPlay:stage!==QUALIFYING&&isConvertableInteger(initialRoundOfPlay2)&&initialRoundOfPlay2+(roundNumber||0),endDate:matchUp.endDate||endDate,gender:null==collectionDefinition?void 0:collectionDefinition.gender,discipline:null==event2?void 0:event2.discipline,category:matchUpCategory,finishingPositionRange,abbreviatedRoundName,drawPositionsRange,competitiveness,structureName,stageSequence,drawPositions,matchUpStatus,processCodes,isRoundRobin:isRoundRobin2,matchUpTieId,preFeedRound,matchUpType,roundFactor,roundOffset,structureId,roundNumber,feedRound,roundName,drawName,drawType,schedule,drawId,stage}),makeDeepCopy(onlyDefined(matchUp),!0,!0));if(matchUpFormat&&(null==(_k=matchUp.score)?void 0:_k.scoreStringSide1)){const parsedFormat=parse(matchUpFormat),{bestOf,finalSetFormat,setFormat}=parsedFormat||{};((null==finalSetFormat?void 0:finalSetFormat.tiebreakSet)||(null==setFormat?void 0:setFormat.tiebreakSet)||(null==setFormat?void 0:setFormat.timed))&&(matchUpWithContext.score.sets=matchUpWithContext.score.sets.sort(((a,b)=>a.setNumber-b.setNumber)).map(((set,i)=>(i+1===bestOf?((null==finalSetFormat?void 0:finalSetFormat.tiebreakSet)||(null==finalSetFormat?void 0:finalSetFormat.timed))&&(set.tiebreakSet=!0):((null==setFormat?void 0:setFormat.tiebreakSet)||(null==setFormat?void 0:setFormat.timed))&&(set.tiebreakSet=!0),set))))}if(Array.isArray(drawPositions)){const{orderedDrawPositions,displayOrder}=getOrderedDrawPositions({drawPositions,roundPosition,roundProfile:roundProfile2,roundNumber}),isFeedRound=null==(_l=roundProfile2[roundNumber])?void 0:_l.feedRound,reversedDisplayOrder=displayOrder[0]!==orderedDrawPositions[0],sides=orderedDrawPositions.concat(void 0,void 0).slice(0,2).map(((drawPosition,index)=>{var _a3;const sideNumber=index+1,side=getSide({drawPositionCollectionAssignment,positionAssignments,displaySideNumber:reversedDisplayOrder?3-sideNumber:sideNumber,seedAssignments,drawPosition,isFeedRound,sideNumber}),existingSide=null==(_a3=matchUp.sides)?void 0:_a3.find((existing=>existing.sideNumber===sideNumber)),sourceDrawPositionRange=null==sourceDrawPositionRoundRanges?void 0:sourceDrawPositionRoundRanges[2*(roundPosition-1)+index+1];return onlyDefined(__spreadValues$4w(__spreadValues$4w({sourceDrawPositionRange},existingSide),side))}));Object.assign(matchUpWithContext,makeDeepCopy({sides},!0,!0))}if(tournamentParticipants&&matchUpWithContext.sides){const participantAttributes=null==policyDefinitions?void 0:policyDefinitions[POLICY_TYPE_PARTICIPANT],getMappedParticipant=participantId=>{var _a3;const participant=null==(_a3=null==participantMap?void 0:participantMap[participantId])?void 0:_a3.participant;return participant&&attributeFilter({template:null==participantAttributes?void 0:participantAttributes.participant,source:participant})};if(matchUpWithContext.sides.filter(Boolean).forEach((side=>{var _a3,_b3,_c3;if(side.participantId){const participant=makeDeepCopy(getMappedParticipant(side.participantId)||findParticipant({policyDefinitions:appliedPolicies2,participantId:side.participantId,tournamentParticipants,internalUse:!0,contextProfile}),void 0,!0);if(participant){if(null==drawDefinition?void 0:drawDefinition.entries){const entry=drawDefinition.entries.find((entry2=>entry2.participantId===side.participantId));(null==entry?void 0:entry.entryStatus)&&(participant.entryStatus=entry.entryStatus),(null==entry?void 0:entry.entryStage)&&(participant.entryStage=entry.entryStage)}Object.assign(side,{participant})}}if((null==(_b3=null==(_a3=null==side?void 0:side.participant)?void 0:_a3.individualParticipantIds)?void 0:_b3.length)&&!(null==(_c3=side.participant.individualParticipants)?void 0:_c3.length)){const individualParticipants=side.participant.individualParticipantIds.map((participantId=>getMappedParticipant(participantId)||findParticipant({policyDefinitions:appliedPolicies2,tournamentParticipants,internalUse:!0,contextProfile,participantId})));Object.assign(side.participant,{individualParticipants})}})),!matchUpWithContext.matchUpType){const{matchUpType:matchUpType2}=getMatchUpType({matchUp:matchUpWithContext});matchUpType2&&Object.assign(matchUpWithContext,{matchUpType:matchUpType2})}if((null==contextProfile?void 0:contextProfile.inferGender)&&(!matchUpWithContext.gender||matchUpWithContext.gender===MIXED)&&2===(null==(_m=matchUpWithContext.sides)?void 0:_m.length)&&matchUpWithContext.matchUpType!==TEAM$1){const sideGenders=matchUpWithContext.sides.map((side=>{var _a3,_b3,_c3,_d3;if(matchUpWithContext.matchUpType===SINGLES$1)return null==(_b3=null==(_a3=side.participant)?void 0:_a3.person)?void 0:_b3.sex;if(2===(null==(_d3=null==(_c3=side.participant)?void 0:_c3.individualParticipants)?void 0:_d3.length)){const pairGenders=unique(side.participant.individualParticipants.map((participant=>{var _a4;return null==(_a4=participant.person)?void 0:_a4.sex}))).filter(Boolean);if(1===pairGenders.length)return pairGenders[0]}}));if(2===sideGenders.filter(Boolean).length&&1===unique(sideGenders).length){const inferredGender=sideGenders[0];matchUpWithContext.inferredGender=inferredGender}}}if(matchUpWithContext.tieMatchUps){const isCollectionBye2=matchUpWithContext.matchUpStatus===BYE,lineUps=null==(_n=matchUpWithContext.sides)?void 0:_n.map((({participant,drawPosition,sideNumber,lineUp})=>{const teamParticipant=(null==participant?void 0:participant.participantType)===TEAM$1&&participant;return{teamParticipant:teamParticipant&&definedAttributes({participantRoleResponsibilities:teamParticipant.participantRoleResponsibilities,participantOtherName:teamParticipant.participanOthertName,participantName:teamParticipant.participantName,participantId:teamParticipant.participantId,teamId:teamParticipant.teamId}),drawPosition,sideNumber,lineUp}}));matchUpWithContext.tieMatchUps=matchUpWithContext.tieMatchUps.map((matchUp2=>{const matchUpTieId2=matchUpWithContext.matchUpId,finishingPositionRange2=matchUpWithContext.finishingPositionRange;return addMatchUpContext({tieDrawPositions:drawPositions,scheduleVisibilityFilters:scheduleVisibilityFilters2,sourceDrawPositionRanges,sideLineUps:lineUps,drawPositionsRanges,initialRoundOfPlay:initialRoundOfPlay2,roundNamingProfile:roundNamingProfile2,additionalContext:{finishingPositionRange:finishingPositionRange2,abbreviatedRoundName,roundNumber,roundName},appliedPolicies:appliedPolicies2,isCollectionBye:isCollectionBye2,matchUpTieId:matchUpTieId2,isRoundRobin:isRoundRobin2,roundProfile:roundProfile2,matchUp:matchUp2,event:event2})}))}const hasParticipants=matchUpWithContext.sides&&2===matchUpWithContext.sides.filter((side=>null==side?void 0:side.participantId)).length,hasNoWinner=!matchUpWithContext.winningSide,readyToScore=scoringActive&&hasParticipants&&hasNoWinner;if(Object.assign(matchUpWithContext,{readyToScore,hasContext:!0}),hasParticipants){const{allParticipantsCheckedIn,checkedInParticipantIds}=getCheckedInParticipantIds({matchUp:matchUpWithContext});Object.assign(matchUpWithContext,{allParticipantsCheckedIn,checkedInParticipantIds})}return Array.isArray(null==contextProfile?void 0:contextProfile.exclude)&&contextProfile.exclude.forEach((attribute=>delete matchUpWithContext[attribute])),matchUpWithContext}}function findMatchUp$1({tournamentParticipants,afterRecoveryTimes,drawDefinition,contextProfile,contextContent,matchUpsMap,matchUpId,inContext,context,event}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!matchUpId)return{error:MISSING_MATCHUP_ID};if("string"!=typeof matchUpId)return{error:INVALID_VALUES};const{structures=[]}=getDrawStructures({drawDefinition});contextProfile&&!contextContent&&(contextContent=getContextContent({contextProfile,drawDefinition}));for(const structure of structures){const{matchUps}=getAllStructureMatchUps({tournamentParticipants,afterRecoveryTimes,drawDefinition,contextProfile,contextContent,matchUpsMap,inContext,structure,context,event}),{matchUp}=getMatchUp$1({matchUps,matchUpId});if(matchUp)return{matchUp,structure}}return{error:MATCHUP_NOT_FOUND}}function isDirectingMatchUpStatus({matchUpStatus}){return directingMatchUpStatuses.includes(matchUpStatus)}function isNonDirectingMatchUpStatus({matchUpStatus}){return nonDirectingMatchUpStatuses.includes(matchUpStatus)}function scoreHasValue({matchUp,score}={}){var _a,_b;const firstSet=null==(_a=null==(score=score||(null==matchUp?void 0:matchUp.score))?void 0:score.sets)?void 0:_a[0],{side1Score,side2Score,side1TiebreakScore,side2TiebreakScore,side1PointScore,side2PointScore}=firstSet||{},firstSetScore=side1Score||side2Score||side1TiebreakScore||side2TiebreakScore||side1PointScore||side2PointScore;return!!((null==(_b=null==score?void 0:score.sets)?void 0:_b.length)>1||firstSetScore)}function isActiveMatchUp({matchUpStatus,winningSide,tieMatchUps,sides,score}){var _a;const participantAssigned=null==sides?void 0:sides.find((({participantId})=>participantId)),activeTieMatchUps=null==(_a=null==tieMatchUps?void 0:tieMatchUps.filter(isActiveMatchUp))?void 0:_a.length;return scoreHasValue({score})||activeTieMatchUps||winningSide&&participantAssigned||function isActiveMatchUpStatus({matchUpStatus}){return activeMatchUpStatuses.includes(matchUpStatus)}({matchUpStatus})&&![DEFAULTED,WALKOVER$2,IN_PROGRESS$1].includes(matchUpStatus)}var __defProp$4v=Object.defineProperty,__getOwnPropSymbols$4w=Object.getOwnPropertySymbols,__hasOwnProp$4w=Object.prototype.hasOwnProperty,__propIsEnum$4w=Object.prototype.propertyIsEnumerable,__defNormalProp$4v=(obj,key,value)=>key in obj?__defProp$4v(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4v=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4w.call(b,prop)&&__defNormalProp$4v(a,prop,b[prop]);if(__getOwnPropSymbols$4w)for(var prop of __getOwnPropSymbols$4w(b))__propIsEnum$4w.call(b,prop)&&__defNormalProp$4v(a,prop,b[prop]);return a};function addNotes({element,notes}={}){return"object"!=typeof element?{error:INVALID_VALUES}:notes?"string"==typeof notes||(null==notes?void 0:notes.testing)?(Object.assign(element,{notes}),__spreadValues$4v({},SUCCESS)):{error:INVALID_VALUES}:{error:MISSING_VALUE}}function matchUpIsComplete({matchUp}){return completedMatchUpStatuses.includes(null==matchUp?void 0:matchUp.matchUpStatus)||(null==matchUp?void 0:matchUp.winningSide)}const FORMAT_STANDARD="SET3-S:6/TB7",matchUpFormats={FORMAT_STANDARD,FORMAT_STANDARD_NOAD:"SET3-S:6NOAD",FORMAT_ATP_DOUBLES:"SET3-S:6/TB7-F:TB10",FORMAT_SHORT_SETS:"SET3-S:4/TB7",FORMAT_FAST4:"SET3-S:4/TB5@3",FORMAT_PRO_SET:"SET1-S:8/TB7",FORMAT_COLLEGE_PRO_SET:"SET1-S:8/TB7@7",TIMED20:"SET1-S:T20"};function countSets({winningSide:matchUpWinningSide,matchUpFormat=FORMAT_STANDARD,matchUpStatus,tallyPolicy,score}){const setsTally=[0,0],{sets}=score||{},matchUpWinnerIndex=matchUpWinningSide-1,parsedMatchUpFormat=parse(matchUpFormat),setsToWin=getSetsToWin((null==parsedMatchUpFormat?void 0:parsedMatchUpFormat.bestOf)||1);if(matchUpStatus===DEFAULTED&&(null==tallyPolicy?void 0:tallyPolicy.setsCreditForDefaults)||matchUpStatus===WALKOVER$2&&(null==tallyPolicy?void 0:tallyPolicy.setsCreditForWalkovers))setsTally[matchUpWinnerIndex]=setsToWin;else for(const set of sets||[]){const{winningSide:setWinningSide}=set;setWinningSide&&(setsTally[setWinningSide-1]+=1)}return matchUpStatus===RETIRED$1&&(+setsTally[1-matchUpWinnerIndex]===setsToWin&&(setsTally[1-matchUpWinnerIndex]-=1),(null==tallyPolicy?void 0:tallyPolicy.setsCreditForRetirements)&&(setsTally[matchUpWinnerIndex]=setsToWin)),setsTally}function getSetsToWin(bestOfGames){return bestOfGames&&Math.ceil(bestOfGames/2)||1}function getParticipantResults({participantIds,matchUpFormat,tallyPolicy,perPlayer,matchUps}){const participantResults={},filteredMatchUps=matchUps.filter((matchUp=>!(null==participantIds?void 0:participantIds.length)||2===intersection(participantIds,[getSideId(matchUp,0),getSideId(matchUp,1)]).length)),totalSets=matchUps.flatMap((({score,tieMatchUps})=>{var _a;return tieMatchUps?tieMatchUps.flatMap((({score:score2})=>{var _a2;return(null==(_a2=null==score2?void 0:score2.sets)?void 0:_a2.length)||0})):(null==(_a=null==score?void 0:score.sets)?void 0:_a.length)||0})).reduce(((a,b)=>a+b),0);return filteredMatchUps.forEach((matchUp=>{var _a,_b;const{matchUpStatus,tieMatchUps,score,winningSide,sides}=matchUp,winningParticipantId=winningSide&&function getWinningSideId(matchUp){const winnerIndex=matchUp.winningSide-1;return getSideId(matchUp,winnerIndex)}(matchUp),losingParticipantId=winningSide&&function getLosingSideId(matchUp){const loserIndex=1-(matchUp.winningSide-1);return getSideId(matchUp,loserIndex)}(matchUp);if(winningParticipantId&&losingParticipantId)if(checkInitializeParticipant(participantResults,winningParticipantId),checkInitializeParticipant(participantResults,losingParticipantId),null==tieMatchUps?void 0:tieMatchUps.length){perPlayer=0;for(const tieMatchUp of tieMatchUps)tieMatchUp.winningSide===winningSide?(winningParticipantId&&(participantResults[winningParticipantId].tieMatchUpsWon+=1),losingParticipantId&&(participantResults[losingParticipantId].tieMatchUpsLost+=1)):tieMatchUp.winningSide===3-winningSide&&(losingParticipantId&&(participantResults[losingParticipantId].tieMatchUpsWon+=1),winningParticipantId&&(participantResults[winningParticipantId].tieMatchUpsLost+=1)),processMatchUp$1({matchUpFormat:tieMatchUp.matchUpFormat,matchUpStatus:tieMatchUp.matchUpStatus,score:tieMatchUp.score,winningParticipantId,losingParticipantId,participantResults,isTieMatchUp:!0,tallyPolicy,winningSide});processOutcome$1({winningParticipantId,losingParticipantId,participantResults,matchUpStatus})}else processMatchUp$1({winningParticipantId,losingParticipantId,participantResults,matchUpFormat,matchUpStatus,tallyPolicy,winningSide,score});else{if(completedMatchUpStatuses.includes(matchUpStatus)){const participantIdSide1=getSideId(matchUp,0),participantIdSide2=getSideId(matchUp,1);return participantIdSide1&&(checkInitializeParticipant(participantResults,participantIdSide1),participantResults[participantIdSide1].matchUpsCancelled+=1),void(participantIdSide2&&(checkInitializeParticipant(participantResults,participantIdSide2),participantResults[participantIdSide2].matchUpsCancelled+=1))}if(null==tieMatchUps?void 0:tieMatchUps.length){perPlayer=0;for(const tieMatchUp of tieMatchUps){if(tieMatchUp.winningSide){const tieWinningParticipantId=null==(_a=sides.find((({sideNumber})=>sideNumber===tieMatchUp.winningSide)))?void 0:_a.participantId,tieLosingParticipantId=null==(_b=sides.find((({sideNumber})=>sideNumber===tieMatchUp.winningSide)))?void 0:_b.participantId;tieWinningParticipantId&&tieLosingParticipantId&&(checkInitializeParticipant(participantResults,tieWinningParticipantId),checkInitializeParticipant(participantResults,tieLosingParticipantId),participantResults[tieWinningParticipantId].tieMatchUpsWon+=1,participantResults[tieLosingParticipantId].tieMatchUpsLost+=1)}processScore({score:tieMatchUp.score,participantResults,sides})}}else processScore({score,sides,participantResults})}})),function calculatePercentages({participantResults,matchUpFormat,tallyPolicy,perPlayer,totalSets}){var _a;const parsedGroupMatchUpFormat=matchUpFormat&&parse(matchUpFormat)||{},bestOfGames=parsedGroupMatchUpFormat.bestOf,bracketSetsToWin=bestOfGames&&Math.ceil(bestOfGames/2)||1,bracketGamesForSet=null==(_a=parsedGroupMatchUpFormat.setFormat)?void 0:_a.setTo;Object.keys(participantResults).forEach((participantId=>{const setsWon=participantResults[participantId].setsWon,setsLost=participantResults[participantId].setsLost,setsTotal=(null==tallyPolicy?void 0:tallyPolicy.groupTotalSetsPlayed)?totalSets:perPlayer*(bracketSetsToWin||0)||setsWon+setsLost;let setsPct=Math.round(setsWon/setsTotal*1e3)/1e3;(setsPct===1/0||isNaN(setsPct))&&(setsPct=setsTotal);const tieMatchUpsWon=participantResults[participantId].tieMatchUpsWon,tieMatchUpsTotal=tieMatchUpsWon+participantResults[participantId].tieMatchUpsLost;let tieMatchUpsPct=Math.round(tieMatchUpsWon/tieMatchUpsTotal*1e3)/1e3;(tieMatchUpsPct===1/0||isNaN(tieMatchUpsPct))&&(tieMatchUpsPct=tieMatchUpsWon);const matchUpsWon=participantResults[participantId].matchUpsWon,matchUpsTotal=matchUpsWon+participantResults[participantId].matchUpsLost;let matchUpsPct=Math.round(matchUpsWon/matchUpsTotal*1e3)/1e3;(matchUpsPct===1/0||isNaN(matchUpsPct))&&(matchUpsPct=matchUpsWon);const gamesWon=participantResults[participantId].gamesWon||0,gamesLost=participantResults[participantId].gamesLost||0,minimumExpectedGames=(perPlayer||0)*(bracketSetsToWin||0)*(bracketGamesForSet||0),gamesTotal=Math.max(minimumExpectedGames,gamesWon+gamesLost);let gamesPct=Math.round(gamesWon/gamesTotal*1e3)/1e3;(gamesPct===1/0||isNaN(gamesPct))&&(gamesPct=0);let pointsRatio=Math.round(participantResults[participantId].pointsWon/participantResults[participantId].pointsLost*1e3)/1e3;(pointsRatio===1/0||isNaN(pointsRatio))&&(pointsRatio=0),participantResults[participantId].setsPct=setsPct,participantResults[participantId].tieMatchUpsPct=tieMatchUpsPct,participantResults[participantId].matchUpsPct=matchUpsPct,participantResults[participantId].gamesPct=gamesPct,participantResults[participantId].pointsRatio=pointsRatio,participantResults[participantId].result=`${participantResults[participantId].matchUpsWon}/${participantResults[participantId].matchUpsLost}`}))}({participantResults,matchUpFormat,tallyPolicy,perPlayer,totalSets}),{participantResults}}function getSideId(matchUp,index){if(!matchUp||!matchUp.sides)return console.log("no sides:",{matchUp}),"foo";const Side=matchUp.sides[index];return Side?Side.participantId:(console.log("No Side",{matchUp,index}),"foo")}function checkInitializeParticipant(participantResults,participantId){participantId&&!participantResults[participantId]&&(participantResults[participantId]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,retirements:0,setsLost:0,setsWon:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function processScore({score,sides,participantResults}){const{sets}=score||{},gamesTally=[[],[]],setsTally=[0,0];for(const set of sets||[]){const{winningSide:setWinningSide,side1Score,side2Score}=set;setWinningSide&&(setsTally[setWinningSide-1]+=1),gamesTally[0].push(parseInt(side1Score||0)),gamesTally[1].push(parseInt(side2Score||0))}const gamesTotal=[gamesTally[0].reduce(((a,b)=>a+b),0),gamesTally[1].reduce(((a,b)=>a+b),0)];sides.forEach(((side,i)=>{const{participantId}=side;participantId&&(checkInitializeParticipant(participantResults,participantId),participantResults[participantId].setsWon+=setsTally[i],participantResults[participantId].setsLost+=setsTally[1-i],participantResults[participantId].gamesWon+=gamesTotal[i],participantResults[participantId].gamesLost+=gamesTotal[1-i])}))}function processMatchUp$1({winningParticipantId,losingParticipantId,participantResults,matchUpFormat,matchUpStatus,isTieMatchUp,tallyPolicy,winningSide,score}){const winningSideIndex=winningSide&&winningSide-1,losingSideIndex=1-winningSideIndex;isTieMatchUp||processOutcome$1({winningParticipantId,losingParticipantId,participantResults,matchUpStatus});const setsTally=countSets({matchUpStatus,matchUpFormat,tallyPolicy,winningSide,score}),gamesTally=function countGames({winningSide:matchUpWinningSide,matchUpFormat=FORMAT_STANDARD,matchUpStatus,tallyPolicy,score}){var _a,_b;const{sets}=score||{},matchUpWinnerIndex=matchUpWinningSide-1,parsedMatchUpFormat=parse(matchUpFormat),setsToWin=getSetsToWin((null==parsedMatchUpFormat?void 0:parsedMatchUpFormat.bestOf)||1),gamesForSet=(null==(_a=null==parsedMatchUpFormat?void 0:parsedMatchUpFormat.setFormat)?void 0:_a.setTo)||0,tiebreakAt=(null==(_b=null==parsedMatchUpFormat?void 0:parsedMatchUpFormat.setFormat)?void 0:_b.tiebreakAt)||0;if(!sets)return[0,0];const minimumGameWins=setsToWin*gamesForSet,gamesTally=[[],[]];if(matchUpStatus===DEFAULTED&&(null==tallyPolicy?void 0:tallyPolicy.gamesCreditForDefaults)||matchUpStatus===WALKOVER$2&&(null==tallyPolicy?void 0:tallyPolicy.gamesCreditForWalkovers)?gamesTally[matchUpWinnerIndex].push(minimumGameWins):(sets||[]).forEach((set=>{const{side1Score,side2Score}=set;gamesTally[0].push(parseInt(side1Score||0)),gamesTally[1].push(parseInt(side2Score||0))})),matchUpStatus===RETIRED$1){const setsTally=countSets({winningSide:matchUpWinningSide,matchUpStatus,matchUpFormat,sets});if(gamesTally.map((g=>g[matchUpWinnerIndex]<=g[1-matchUpWinnerIndex])).reduce(((a,b)=>a+b),0)>setsTally[1-matchUpWinnerIndex]){const talliedGames=gamesTally[matchUpWinnerIndex].length,complement=function getComplement(value){if(parsedMatchUpFormat&&""!==value)return+value==tiebreakAt-1||+value===tiebreakAt?parseInt(tiebreakAt||0)+1:+value<tiebreakAt?gamesForSet:tiebreakAt}(gamesTally[1-matchUpWinnerIndex][talliedGames-1]);complement&&(gamesTally[matchUpWinnerIndex][talliedGames-1]=complement)}setsToWin>gamesTally[matchUpWinnerIndex].length&&(null==tallyPolicy?void 0:tallyPolicy.gamesCreditForRetirements)&&gamesTally[matchUpWinnerIndex].push(gamesForSet)}return[gamesTally[0].reduce(((a,b)=>a+b),0),gamesTally[1].reduce(((a,b)=>a+b),0)]}({matchUpStatus,matchUpFormat,tallyPolicy,winningSide,score}),pointsTally=function countPoints({score}){var _a;const pointsTally=[0,0];return null==(_a=null==score?void 0:score.sets)||_a.forEach((set=>{set.side1TiebreakScore&&(pointsTally[0]+=parseInt(set.side1TiebreakScore)),set.side2TiebreakScore&&(pointsTally[1]+=parseInt(set.side2TiebreakScore))})),pointsTally}({score,tallyPolicy});winningParticipantId&&(participantResults[winningParticipantId].setsWon+=setsTally[winningSideIndex],participantResults[winningParticipantId].setsLost+=setsTally[losingSideIndex],participantResults[winningParticipantId].gamesWon+=gamesTally[winningSideIndex],participantResults[winningParticipantId].gamesLost+=gamesTally[losingSideIndex],participantResults[winningParticipantId].pointsWon+=pointsTally[winningSideIndex],participantResults[winningParticipantId].pointsLost+=pointsTally[losingSideIndex]),losingParticipantId&&(participantResults[losingParticipantId].setsWon+=setsTally[losingSideIndex],participantResults[losingParticipantId].setsLost+=setsTally[winningSideIndex],participantResults[losingParticipantId].gamesWon+=gamesTally[losingSideIndex],participantResults[losingParticipantId].gamesLost+=gamesTally[winningSideIndex],participantResults[losingParticipantId].pointsWon+=pointsTally[losingSideIndex],participantResults[losingParticipantId].pointsLost+=pointsTally[winningSideIndex])}function processOutcome$1({winningParticipantId,losingParticipantId,participantResults,matchUpStatus}){losingParticipantId&&(matchUpStatus===WALKOVER$2&&(participantResults[losingParticipantId].walkovers+=1),matchUpStatus===DEFAULTED&&(participantResults[losingParticipantId].defaults+=1),matchUpStatus===RETIRED$1&&(participantResults[losingParticipantId].retirements+=1),[DEFAULTED,RETIRED$1,WALKOVER$2].includes(matchUpStatus)&&(participantResults[losingParticipantId].allDefaults+=1),participantResults[losingParticipantId].matchUpsLost+=1),winningParticipantId&&(participantResults[winningParticipantId].matchUpsWon+=1),losingParticipantId&&winningParticipantId&&(participantResults[losingParticipantId].defeats.push(winningParticipantId),participantResults[winningParticipantId].victories.push(losingParticipantId))}var __defProp$4u=Object.defineProperty,__getOwnPropSymbols$4v=Object.getOwnPropertySymbols,__hasOwnProp$4v=Object.prototype.hasOwnProperty,__propIsEnum$4v=Object.prototype.propertyIsEnumerable,__defNormalProp$4u=(obj,key,value)=>key in obj?__defProp$4u(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4u=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4v.call(b,prop)&&__defNormalProp$4u(a,prop,b[prop]);if(__getOwnPropSymbols$4v)for(var prop of __getOwnPropSymbols$4v(b))__propIsEnum$4v.call(b,prop)&&__defNormalProp$4u(a,prop,b[prop]);return a};const headToHeadTallyDirectives=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsRatio",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsRatio",idsFilter:!0}],GEMScoreValueMap={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsRatio:4};function getGroupOrder(params){const{requireCompletion=!0,participantResults,subOrderMap,tallyPolicy}=params;if(requireCompletion&&!function isComplete({participantResults,participantsCount}){const resultsArray=getResultsArray({participantResults});let participantsFinished=resultsArray.filter((r=>participantsCount-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled));return participantsCount===participantsFinished.length}(params))return;const attribute=["matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsRatio","matchUpsPct"].includes(null==tallyPolicy?void 0:tallyPolicy.groupOrderKey)?tallyPolicy.groupOrderKey:"matchUpsWon",orderedTallyGroups=getGroups({participantResults,attribute}),groupOrder=Object.keys(orderedTallyGroups).map((key=>parseFloat(key))).sort(((a,b)=>b-a)).map((key=>orderedTallyGroups[key])).map((participantIds=>groupSubSort(__spreadValues$4u({participantIds},params)))).flat(1/0);let priorPositionResolution,groupPosition=1;groupOrder.forEach(((finishingPosition,index)=>{index&&(finishingPosition.resolved||priorPositionResolution&&!finishingPosition.resolved)&&(groupPosition+=1),priorPositionResolution=finishingPosition.resolved,finishingPosition.resolved?(finishingPosition.position=index+1,groupPosition=finishingPosition.position):finishingPosition.position=groupPosition}));const positionsCount=instanceCount(groupOrder.map((({position})=>position)));return groupOrder.forEach((finishingPosition=>{const{participantId,position}=finishingPosition||{},participantResult=participantResults[participantId];finishingPosition.GEMscore=function getRatioHash(result){const attributes=Array.isArray(null==tallyPolicy?void 0:tallyPolicy.GEMscore)?Object.keys(GEMScoreValueMap).filter((attribute2=>tallyPolicy.GEMscore.includes(attribute2))):Object.keys(GEMScoreValueMap);return attributes.map((attribute2=>(result[attribute2]||0)*Math.pow(10,GEMScoreValueMap[attribute2].toFixed(3)))).reduce(((a,b)=>a+b),0)}(participantResult);const positionInstances=positionsCount[position];void 0!==(null==finishingPosition?void 0:finishingPosition.position)&&(positionInstances>1&&(finishingPosition.ties=positionInstances,subOrderMap&&(finishingPosition.subOrder=subOrderMap[participantId])),finishingPosition.rankOrder=position,finishingPosition.groupOrder=position+(finishingPosition.subOrder||1)-1)})),groupOrder}function groupSubSort({participantResults,disableHeadToHead,participantIds,matchUpFormat,tallyPolicy,matchUps}){if(1===(null==participantIds?void 0:participantIds.length))return{resolved:!0,participantId:participantIds[0]};if(2===(null==participantIds?void 0:participantIds.length)&&(!(null==tallyPolicy?void 0:tallyPolicy.headToHead)||!tallyPolicy.headToHead.disabled&&!disableHeadToHead)){const result2=function headToHeadWinner({participantIds,participantResults}){if(!participantIds)return;if(participantResults[participantIds[0]].victories.includes(participantIds[1]))return participantIds.map((participantId=>({resolved:!0,participantId})));if(participantResults[participantIds[1]].victories.includes(participantIds[0]))return participantIds.reverse().map((participantId=>({resolved:!0,participantId})))}({participantIds,participantResults});if(result2)return result2}let result;return((null==tallyPolicy?void 0:tallyPolicy.tallyDirectives)||headToHeadTallyDirectives).every((({attribute,reversed,idsFilter,disableHeadToHead:disableHeadToHead2})=>(result=function processAttribute({disableHeadToHead,participantIds,matchUpFormat,tallyPolicy,attribute,idsFilter,matchUps,reversed}){const{participantResults}=getParticipantResults({participantIds:idsFilter&&participantIds,matchUpFormat,tallyPolicy,matchUps}),groups=getGroups({participantResults,participantIds,attribute});if(Object.keys(groups).length>1&&participantIds.length)return Object.keys(groups).map((key=>parseFloat(key))).sort(((a,b)=>reversed?a-b:b-a)).map((key=>groups[key])).map((participantIds2=>groupSubSort({participantResults,disableHeadToHead,participantIds:participantIds2,matchUpFormat,tallyPolicy,matchUps}))).flat(1/0)}({disableHeadToHead:disableHeadToHead2,participantIds,matchUpFormat,tallyPolicy,attribute,idsFilter,matchUps,reversed}),!result))),result||(null==participantIds?void 0:participantIds.map((participantId=>({participantId}))))}function getGroups({participantResults,participantIds,attribute}){return getResultsArray({participantResults,participantIds}).reduce(((groups,participantResult)=>{const{participantId,results}=participantResult,value=null==results?void 0:results[attribute];return!isNaN(value)&&participantId&&(groups[value]?groups[value].push(participantId):groups[value]=[participantId]),groups}),{})}function getResultsArray({participantResults,participantIds}){return(participantIds=participantIds||Object.keys(participantResults)).reduce(((arr,participantId,i)=>(arr.push({participantId,i,results:participantResults[participantId]}),arr)),[])}function tallyParticipantResults({policyDefinitions,matchUpFormat,matchUps=[],subOrderMap,perPlayer}){if(!Array.isArray(matchUps))return{error:MISSING_MATCHUPS};if(1!==matchUps.reduce(((structureIds2,{structureId})=>structureIds2.includes(structureId)?structureIds2:structureIds2.concat(structureId)),[]).length)return{error:INVALID_VALUES};const relevantMatchUps=matchUps.filter((matchUp=>matchUp&&matchUp.matchUpStatus!==BYE)),participantsCount=relevantMatchUps.length&&unique(relevantMatchUps.map((({drawPositions})=>drawPositions)).flat()).length,bracketComplete=relevantMatchUps.filter((matchUp=>matchUpIsComplete({matchUp}))).length===relevantMatchUps.length;bracketComplete||(perPlayer=0);const tallyPolicy=policyDefinitions&&policyDefinitions[POLICY_TYPE_ROUND_ROBIN_TALLY],consideredMatchUps=matchUps.filter((matchUp=>matchUpIsComplete({matchUp})||matchUp.matchUpType===TEAM$2)),{participantResults}=getParticipantResults({matchUps:consideredMatchUps,matchUpFormat,tallyPolicy,perPlayer}),groupOrder=getGroupOrder({matchUps:consideredMatchUps,participantResults,participantsCount,matchUpFormat,tallyPolicy,subOrderMap});if(bracketComplete&&groupOrder)groupOrder.forEach((finishingPosition=>{const{participantId,groupOrder:groupOrder2,rankOrder,subOrder,ties,GEMscore}=finishingPosition,participantResult=participantResults[participantId];Object.assign(participantResult,{groupOrder:groupOrder2,rankOrder,GEMscore,subOrder,ties})}));else{const provionalOrder=getGroupOrder({requireCompletion:!1,participantResults,participantsCount,matchUpFormat,tallyPolicy,subOrderMap,matchUps});provionalOrder&&provionalOrder.forEach((finishingPosition=>{const{participantId,groupOrder:groupOrder2,GEMscore}=finishingPosition,participantResult=participantResults[participantId];Object.assign(participantResult,{provisionalOrder:groupOrder2,GEMscore})}))}return{participantResults,bracketComplete}}function drawUpdatedAt(drawDefinition,structureIds){var _a;if(!drawDefinition)return;let timeStamp=Date.now();timeStamp===new Date(drawDefinition.updatedAt).getTime()&&(timeStamp+=1);const updatedAt=new Date(timeStamp).toISOString(),relevantStructureIds=null==structureIds?void 0:structureIds.filter(Boolean);drawDefinition.updatedAt=updatedAt,null==(_a=drawDefinition.structures)||_a.filter(Boolean).forEach((structure=>{(null==relevantStructureIds?void 0:relevantStructureIds.length)&&!(null==relevantStructureIds?void 0:relevantStructureIds.includes(structure.structureId))||(structure.updatedAt=updatedAt)}))}function addMatchUpsNotice({drawDefinition,tournamentId,matchUps,eventId}){drawDefinition&&drawUpdatedAt(drawDefinition),addNotice({payload:{matchUps,tournamentId,eventId},topic:ADD_MATCHUPS})}function deleteMatchUpsNotice({drawDefinition,tournamentId,matchUpIds,eventId,action}){drawDefinition&&drawUpdatedAt(drawDefinition),addNotice({topic:DELETED_MATCHUP_IDS,payload:{tournamentId,matchUpIds,eventId,action}});for(const matchUpId of matchUpIds)deleteNotice({key:matchUpId})}function modifyMatchUpNotice({drawDefinition,tournamentId,structureId,context,eventId,matchUp}){if(!matchUp)return console.log(MISSING_MATCHUP),{error:MISSING_MATCHUP};drawDefinition&&modifyDrawNotice({structureIds:[structureId],drawDefinition,tournamentId,eventId}),addNotice({topic:MODIFY_MATCHUP,payload:{matchUp,tournamentId,context},key:matchUp.matchUpId})}function addDrawNotice({tournamentId,eventId,drawDefinition}){if(!drawDefinition)return console.log(MISSING_DRAW_DEFINITION),{error:MISSING_DRAW_DEFINITION};drawUpdatedAt(drawDefinition),addNotice({payload:{drawDefinition,tournamentId,eventId},topic:ADD_DRAW_DEFINITION,key:drawDefinition.drawId})}function modifyDrawNotice({drawDefinition,tournamentId,structureIds,eventId}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};drawUpdatedAt(drawDefinition,structureIds),addNotice({payload:{tournamentId,eventId,drawDefinition},topic:MODIFY_DRAW_DEFINITION,key:drawDefinition.drawId})}function modifySeedAssignmentsNotice({drawDefinition,tournamentId,structure,eventId}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structure)return{error:MISSING_STRUCTURE};const seedAssignments=structure.seedAssignments,structureId=structure.structureId;addNotice({payload:{tournamentId,eventId,drawId:drawDefinition.drawId,structureId,seedAssignments},topic:MODIFY_SEED_ASSIGNMENTS,key:drawDefinition.drawId}),modifyDrawNotice({sructureIds:[structureId],drawDefinition,tournamentId,eventId})}function modifyPositionAssignmentsNotice({drawDefinition,tournamentId,structure,event}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structure)return{error:MISSING_STRUCTURE};const positionAssignments=getPositionAssignments$1({structure}),structureId=structure.structureId,drawId=drawDefinition.drawId,eventId=null==event?void 0:event.eventId;addNotice({topic:MODIFY_POSITION_ASSIGNMENTS,payload:{positionAssignments,tournamentId,structureId,eventId,drawId},key:structureId}),modifyDrawNotice({sructureIds:[structureId],drawDefinition,tournamentId,eventId})}const hasParticipantId=o=>null==o?void 0:o.participantId;var __defProp$4t=Object.defineProperty,__defProps$2y=Object.defineProperties,__getOwnPropDescs$2y=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4u=Object.getOwnPropertySymbols,__hasOwnProp$4u=Object.prototype.hasOwnProperty,__propIsEnum$4u=Object.prototype.propertyIsEnumerable,__defNormalProp$4t=(obj,key,value)=>key in obj?__defProp$4t(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4t=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4u.call(b,prop)&&__defNormalProp$4t(a,prop,b[prop]);if(__getOwnPropSymbols$4u)for(var prop of __getOwnPropSymbols$4u(b))__propIsEnum$4u.call(b,prop)&&__defNormalProp$4t(a,prop,b[prop]);return a},__spreadProps$2y=(a,b)=>__defProps$2y(a,__getOwnPropDescs$2y(b));function updateAssignmentParticipantResults({positionAssignments,tournamentRecord,drawDefinition,matchUpFormat,matchUps,event}){if(!Array.isArray(matchUps))return{error:INVALID_VALUES};if(!positionAssignments)return{error:INVALID_VALUES};const{policyDefinitions}=getPolicyDefinitions({policyTypes:[POLICY_TYPE_ROUND_ROBIN_TALLY],tournamentRecord,drawDefinition,event}),{subOrderMap}=function createSubOrderMap({positionAssignments}){const subOrderArray=(positionAssignments||[]).filter(hasParticipantId).map((assignment=>{const{extension}=findExtension$1({element:assignment,name:SUB_ORDER}),value=parseInt(null==extension?void 0:extension.value),subOrder=!isNaN(value)&&value;return subOrder&&{participantId:assignment.participantId,subOrder}})).filter(Boolean),subOrdersCount=instanceCount(subOrderArray.map((({subOrder})=>subOrder)));return{subOrderMap:Object.assign({},...subOrderArray.filter((({subOrder})=>1===subOrdersCount[subOrder])).map((({participantId,subOrder})=>({[participantId]:subOrder}))))}}({positionAssignments}),result=tallyParticipantResults({policyDefinitions,matchUpFormat,subOrderMap,matchUps});if(result.error)return result;const{participantResults,bracketComplete}=result,participantIds=Object.keys(participantResults);return positionAssignments.forEach((assignment=>{const{participantId}=assignment;if(participantIds.includes(participantId)){addExtension$1({element:assignment,extension:{value:participantResults[participantId],name:TALLY}}),participantResults[participantId].ties||removeExtension$1({element:assignment,name:SUB_ORDER})}else removeExtension$1({element:assignment,name:TALLY}),removeExtension$1({element:assignment,name:SUB_ORDER})})),modifyDrawNotice({drawDefinition}),__spreadProps$2y(__spreadValues$4t({},SUCCESS),{participantResults,bracketComplete})}function addParticipantGroupings({participantsProfile,participants=[]}){const participantsWithGroupings=makeDeepCopy(participants,null==participantsProfile?void 0:participantsProfile.convertExtensions,!0),teamParticipants=participantsWithGroupings.filter((participant=>participant.participantType===TEAM)),groupParticipants=participantsWithGroupings.filter((participant=>participant.participantType===GROUP)),pairParticipants=participantsWithGroupings.filter((participant=>participant.participantType===PAIR));return participantsWithGroupings.forEach((participant=>{if(participant.participantType===INDIVIDUAL){const{participantId}=participant;participant.groupParticipantIds=[],participant.teamParticipantIds=[],participant.pairParticipantIds=[],participant.groups=[],participant.teams=[],teamParticipants.forEach((team=>{((null==team?void 0:team.individualParticipantIds)||[]).forEach((individualParticipantId=>{var _a;individualParticipantId!==participantId||(null==(_a=participant.teamParticipantIds)?void 0:_a.includes(team.participantId))||(participant.teamParticipantIds.push(team.participantId),participant.teams.push({participantRoleResponsibilities:team.participantRoleResponsibilities,participantOtherName:team.participantOtherName,participantName:team.participantName,participantId:team.participantId,teamId:team.teamId}))}))})),pairParticipants.forEach((pair=>{((null==pair?void 0:pair.individualParticipantIds)||[]).forEach((individualParticipantId=>{individualParticipantId!==participantId||participant.pairParticipantIds.includes(pair.participantId)||participant.pairParticipantIds.push(pair.participantId)}))})),groupParticipants.forEach((group=>{((null==group?void 0:group.individualParticipantIds)||[]).forEach((individualParticipantId=>{individualParticipantId!==participantId||participant.groupParticipantIds.includes(group.participantId)||(participant.groupParticipantIds.push(group.participantId),participant.groups.push({participantRoleResponsibilities:group.participantRoleResponsibilities,participantOtherName:group.participantOtherName,participantName:group.participantName,participantId:group.participantId}))}))}))}})),participantsWithGroupings}function getTargetMatchUp({sourceRoundMatchUpCount,inContextDrawMatchUps,sourceRoundPosition,drawDefinition,targetLink}){var _a;if(!targetLink)return{error:MISSING_TARGET_LINK};const{target:{structureId,feedProfile,groupedOrder,roundNumber,positionInterleave}}=targetLink,{structure:targetStructure}=findStructure({drawDefinition,structureId}),{positionAssignments}=getPositionAssignments$1({structure:targetStructure}),targetRoundMatchUps=(null==inContextDrawMatchUps?void 0:inContextDrawMatchUps.filter((matchUp2=>matchUp2.structureId===targetStructure.structureId))).filter((matchUp2=>matchUp2.roundNumber===roundNumber&&!matchUp2.matchUpTieId)),targetRoundMatchUpCount=targetRoundMatchUps.length,roundPositions=generateRange(1,targetRoundMatchUpCount+1),matchUpCountFactor=targetRoundMatchUpCount/sourceRoundMatchUpCount;let calculatedRoundPosition=Math.ceil(matchUpCountFactor*sourceRoundPosition),matchUpDrawPositionIndex=1-sourceRoundPosition%2;if((null==positionInterleave?void 0:positionInterleave.interleave)&&.5!==matchUpCountFactor){const relativeRoundPosition=sourceRoundPosition+(positionInterleave.offset+(sourceRoundPosition-1)*positionInterleave.interleave);calculatedRoundPosition=Math.ceil(relativeRoundPosition/2),matchUpDrawPositionIndex=1-relativeRoundPosition%2}let orderedPositions=roundPositions,targetedRoundPosition=roundPositions[calculatedRoundPosition-1];const sizedGroupOrder=reduceGroupedOrder({groupedOrder,roundPositionsCount:roundPositions.length}),groupsCount=(null==sizedGroupOrder?void 0:sizedGroupOrder.length)||1;if(groupsCount<=roundPositions.length){const groups=chunkArray(roundPositions,targetRoundMatchUpCount/groupsCount);feedProfile===BOTTOM_UP&&groups.forEach((group=>group.reverse())),orderedPositions=(null==sizedGroupOrder?void 0:sizedGroupOrder.length)&&(null==sizedGroupOrder?void 0:sizedGroupOrder.map((order=>groups[order-1])).flat())||orderedPositions}feedProfile===TOP_DOWN?targetedRoundPosition=orderedPositions[calculatedRoundPosition-1]:feedProfile===BOTTOM_UP?((!(null==sizedGroupOrder?void 0:sizedGroupOrder.length)||groupsCount>roundPositions.length)&&(calculatedRoundPosition=targetRoundMatchUps.length+1-calculatedRoundPosition),targetedRoundPosition=orderedPositions[calculatedRoundPosition-1]):feedProfile===RANDOM&&getDevContext()&&console.log(NOT_IMPLEMENTED,{feedProfile});const matchUp=targetedRoundPosition&&targetRoundMatchUps.reduce(((matchUp2,current)=>current.roundPosition===targetedRoundPosition?current:matchUp2),void 0);let targetDrawPosition;(null==matchUp?void 0:matchUp.feedRound)?(matchUpDrawPositionIndex=0,targetDrawPosition=Math.min(...(matchUp.drawPositions||[]).filter(Boolean))):targetDrawPosition=2===(null==(_a=null==matchUp?void 0:matchUp.drawPositions)?void 0:_a.length)&&(null==matchUp?void 0:matchUp.drawPositions[matchUpDrawPositionIndex]);const relevantAssignment=positionAssignments.find((({drawPosition})=>drawPosition===targetDrawPosition));if(relevantAssignment){const{extension}=findExtension$1({element:relevantAssignment,name:DISABLE_LINKS});if(null==extension?void 0:extension.value)return{disabledDrawPosition:targetDrawPosition}}return{matchUp,targetDrawPosition,matchUpDrawPositionIndex}}function getTargetLink({finishingPositions,linkCondition,linkType,source}){var _a;const result=source.find((link=>{var _a2,_b;const positionCondition=!(null==(_a2=link.source)?void 0:_a2.finishingPositions)||!finishingPositions||overlap(finishingPositions,null==(_b=link.source)?void 0:_b.finishingPositions);return linkCondition===link.linkCondition&&positionCondition&&link.linkType===linkType}));return[WINNER,LOSER].includes(null==result?void 0:result.linkType)&&!(null==(_a=null==result?void 0:result.source)?void 0:_a.roundNumber)?decorateResult({result:{error:INVALID_VALUES},stack:"getTargetLink",context:result}):result}function getStructureLinks({drawDefinition,structureId,roundNumber}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structureId)return{error:MISSING_STRUCTURE_ID};return{links:(drawDefinition.links||[]).filter(Boolean).reduce(((structureLinks2,link)=>{var _a,_b;return(null==(_a=link.source)?void 0:_a.structureId)!==structureId||roundNumber&&link.source.roundNumber!==roundNumber||(structureLinks2.source=structureLinks2.source.concat(link)),(null==(_b=link.target)?void 0:_b.structureId)!==structureId||roundNumber&&link.target.roundNumber!==roundNumber||(structureLinks2.target=structureLinks2.target.concat(link)),structureLinks2}),{source:[],target:[]})}}function positionTargets({inContextDrawMatchUps=[],useTargetMatchUpIds,inContextMatchUp,drawDefinition,matchUpId}){let matchUp=inContextMatchUp;inContextDrawMatchUps.length&&!matchUp&&(matchUp=inContextDrawMatchUps.find((m=>m.matchUpId===matchUpId)));const{structure}=findStructure({structureId:matchUp.structureId,drawDefinition}),{finishingPosition}=structure;return finishingPosition===ROUND_OUTCOME?function targetByRoundOutcome({inContextDrawMatchUps,useTargetMatchUpIds,drawDefinition,structure,matchUp}){var _a,_b,_c;const{winnerMatchUpId,loserMatchUpId}=matchUp,{links}=function getRoundLinks({drawDefinition,roundNumber,structureId}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structureId)return{error:MISSING_STRUCTURE_ID};const{links}=getStructureLinks({drawDefinition,structureId});return{links:{source:links.source.reduce(((source2,link)=>link.source.roundNumber&&link.source.roundNumber!==roundNumber?source2:source2.concat(link)),[]),target:links.target.reduce(((target2,link)=>link.target.roundNumber&&link.target.roundNumber!==roundNumber?target2:target2.concat(link)),[])}}}({roundNumber:matchUp.roundNumber,structureId:structure.structureId,drawDefinition}),source=null==links?void 0:links.source,winnerTargetLink=getTargetLink({source,linkType:WINNER}),byeTargetLink=getTargetLink({linkCondition:FIRST_MATCHUP,linkType:LOSER,source});let loserTargetLink=getTargetLink({source,linkType:LOSER});const propagateByeFMLC=byeTargetLink&&loserTargetLink;loserTargetLink||(loserTargetLink=byeTargetLink);const winnerFeedProfile=null==(_a=null==winnerTargetLink?void 0:winnerTargetLink.target)?void 0:_a.feedProfile,loserFeedProfile=null==(_b=null==loserTargetLink?void 0:loserTargetLink.target)?void 0:_b.feedProfile,byeFeedProfile=null==(_c=null==byeTargetLink?void 0:byeTargetLink.target)?void 0:_c.feedProfile;let byeMatchUp,byeTargetDrawPosition,byeMatchUpDrawPositionIndex,loserMatchUp,loserTargetDrawPosition,loserMatchUpDrawPositionIndex,winnerMatchUp,winnerTargetDrawPosition,winnerMatchUpDrawPositionIndex,structureMatchUps;if(useTargetMatchUpIds&&(winnerMatchUpId||loserMatchUpId)&&(winnerMatchUp=winnerMatchUpId&&winnerFeedProfile!==DRAW&&inContextDrawMatchUps.find((({matchUpId})=>matchUpId===winnerMatchUpId)),loserMatchUp=loserMatchUpId&&loserFeedProfile!==DRAW&&inContextDrawMatchUps.find((({matchUpId})=>matchUpId===loserMatchUpId)),winnerMatchUp||loserMatchUp))return{matchUp,targetLinks:{loserTargetLink,winnerTargetLink},targetMatchUps:{loserMatchUp,winnerMatchUp}};const{roundPosition:sourceRoundPosition}=matchUp;structureMatchUps=structureMatchUps||inContextDrawMatchUps.filter((matchUp2=>matchUp2.structureId===structure.structureId));const sourceRoundMatchUpCount=structureMatchUps.reduce(((count,currentMatchUp)=>currentMatchUp.roundNumber!==matchUp.roundNumber||currentMatchUp.matchUpTieId?count:count+1),0);loserTargetLink&&!loserMatchUp&&loserFeedProfile!==DRAW&&({matchUpDrawPositionIndex:loserMatchUpDrawPositionIndex,targetDrawPosition:loserTargetDrawPosition,matchUp:loserMatchUp}=getTargetMatchUp({targetLink:loserTargetLink,sourceRoundMatchUpCount,inContextDrawMatchUps,sourceRoundPosition,drawDefinition}));propagateByeFMLC&&byeFeedProfile!==DRAW&&({matchUpDrawPositionIndex:byeMatchUpDrawPositionIndex,targetDrawPosition:byeTargetDrawPosition,matchUp:byeMatchUp}=getTargetMatchUp({targetLink:byeTargetLink,sourceRoundMatchUpCount,inContextDrawMatchUps,sourceRoundPosition,drawDefinition}));winnerTargetLink&&!winnerMatchUp&&winnerFeedProfile!==DRAW&&({matchUpDrawPositionIndex:winnerMatchUpDrawPositionIndex,targetDrawPosition:winnerTargetDrawPosition,matchUp:winnerMatchUp}=getTargetMatchUp({targetLink:winnerTargetLink,sourceRoundMatchUpCount,inContextDrawMatchUps,sourceRoundPosition,drawDefinition}));winnerMatchUp||(structureMatchUps=structureMatchUps||inContextDrawMatchUps.filter((matchUp2=>matchUp2.structureId===structure.structureId)),({matchUp:winnerMatchUp}=function nextRoundMatchUp({structureMatchUps,matchUp}){const{roundNumber,roundPosition}=matchUp,currentRoundMatchUps=structureMatchUps.filter((matchUp2=>matchUp2.roundNumber===roundNumber&&!matchUp2.matchUpTieId)),nextRoundMatchUps=structureMatchUps.filter((matchUp2=>matchUp2.roundNumber===roundNumber+1&&!matchUp2.matchUpTieId));if(nextRoundMatchUps.length){let nextMatchUp;return nextRoundMatchUps.length===currentRoundMatchUps.length?nextMatchUp=nextRoundMatchUps.find((matchUp2=>matchUp2.roundPosition===roundPosition)):nextRoundMatchUps.length===currentRoundMatchUps.length/2&&(nextMatchUp=nextRoundMatchUps.find((matchUp2=>matchUp2.roundPosition===Math.ceil(roundPosition/2)))),{matchUp:nextMatchUp}}return{message:"no progression found"}}({structureMatchUps,matchUp})));return definedAttributes({matchUp,targetLinks:{loserTargetLink,winnerTargetLink,byeTargetLink},targetMatchUps:{byeMatchUp,loserMatchUp,winnerMatchUp,byeTargetDrawPosition,loserTargetDrawPosition,winnerTargetDrawPosition,byeMatchUpDrawPositionIndex,loserMatchUpDrawPositionIndex,winnerMatchUpDrawPositionIndex},targetMatchUpIds:!(!winnerMatchUpId&&!loserMatchUpId)})}({inContextDrawMatchUps,useTargetMatchUpIds,drawDefinition,structure,matchUp}):function targetByWinRatio({matchUp}){return{matchUp,targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0}}}({drawDefinition,matchUp,structure})}function addUpcomingMatchUps({drawDefinition,inContextDrawMatchUps}){const scheduleConflictMatchUpIds={};return inContextDrawMatchUps.forEach((inContextMatchUp=>{var _a,_b,_c,_d,_e;const{matchUpId,structureId,drawPositions=[]}=inContextMatchUp,{structure}=findStructure({drawDefinition,structureId});if((null==structure?void 0:structure.finishingPosition)===WIN_RATIO){const{roundNumber}=inContextMatchUp,nextRoundNumber=roundNumber&&parseInt(roundNumber)+1,matchUps=structure.matchUps||[],{roundMatchUps}=getRoundMatchUps$1({matchUps});if(nextRoundNumber&&roundMatchUps[nextRoundNumber]){const sidesTo=drawPositions.sort().map(((drawPosition,index)=>{const nextRoundMatchUp=roundMatchUps[nextRoundNumber].find((matchUp=>{var _a2;return null==(_a2=matchUp.drawPositions)?void 0:_a2.includes(drawPosition)}));return{matchUpId:null==nextRoundMatchUp?void 0:nextRoundMatchUp.matchUpId,roundNumber:nextRoundNumber,schedule:null==nextRoundMatchUp?void 0:nextRoundMatchUp.schedule,sideNumber:index+1,structureName:structure.structureName}}));Object.assign(inContextMatchUp,{sidesTo})}}else{const targetData=positionTargets({useTargetMatchUpIds:!0,inContextDrawMatchUps,inContextMatchUp,drawDefinition,matchUpId});let{winnerMatchUp,loserMatchUp}=targetData.targetMatchUps;!inContextMatchUp.winnerMatchUpId&&winnerMatchUp&&(inContextMatchUp.winnerMatchUpId=winnerMatchUp.matchUpId),!inContextMatchUp.loserMatchUpId&&loserMatchUp&&(inContextMatchUp.loserMatchUpId=loserMatchUp.matchUpId);const winnerTo=getUpcomingInfo({upcomingMatchUp:winnerMatchUp});let loserTo=getUpcomingInfo({upcomingMatchUp:loserMatchUp});if(inContextMatchUp.matchUpStatus!==BYE&&(null==loserMatchUp?void 0:loserMatchUp.matchUpStatus)===BYE){const{matchUp:nextMatchUp}=getNextToBePlayedMatchUp({matchUp:loserMatchUp,drawDefinition,inContextDrawMatchUps})||{};loserTo=nextMatchUp&&getUpcomingInfo({upcomingMatchUp:nextMatchUp})||loserTo}const timeAfterRecovery=null==(_a=inContextMatchUp.schedule)?void 0:_a.timeAfterRecovery;if(timeAfterRecovery){if(null==(_b=null==winnerTo?void 0:winnerTo.schedule)?void 0:_b.scheduledTime){timeStringMinutes(winnerTo.schedule.scheduledTime)<timeStringMinutes(timeAfterRecovery)&&(scheduleConflictMatchUpIds[winnerTo.matchUpId]=inContextMatchUp.matchUpId,winnerTo.schedule.scheduleConflict=inContextMatchUp.matchUpId)}if(null==(_c=null==loserTo?void 0:loserTo.schedule)?void 0:_c.scheduledTime){timeStringMinutes(loserTo.schedule.scheduledTime)<timeStringMinutes(timeAfterRecovery)&&(scheduleConflictMatchUpIds[loserTo.matchUpId]=inContextMatchUp.matchUpId,loserTo.schedule.scheduleConflict=inContextMatchUp.matchUpId)}}if(Object.assign(inContextMatchUp,{winnerTo,loserTo}),null==(_d=inContextMatchUp.drawPositions)?void 0:_d.filter(Boolean).length){const loserTargetLink=null==(_e=targetData.targetLinks)?void 0:_e.loserTargetLink,firstMatchUp=(null==loserTargetLink?void 0:loserTargetLink.linkCondition)===FIRST_MATCHUP,participants=function getMatchUpParticipants(matchUp){var _a;return(null==(_a=null==matchUp?void 0:matchUp.sides)?void 0:_a.map((({participant,participantId,qualifier})=>participant||participantId&&{participantId}||qualifier&&{qualifier})).filter(Boolean))||[]}(inContextMatchUp);if(participants.length){const winnerParticipantIds=getParticipantIds(null==winnerMatchUp?void 0:winnerMatchUp.sides),loserParticipantIds=getParticipantIds(null==loserMatchUp?void 0:loserMatchUp.sides),winnerPotentials=participants.find((({participantId})=>winnerParticipantIds.includes(participantId)))?[]:participants,loserPotentials=participants.find((({participantId})=>loserParticipantIds.includes(participantId)))?[]:participants;loserMatchUp&&firstMatchUp&&loserPotentials.length<2&&loserPotentials.push({bye:!0,tbd:!0}),(null==winnerPotentials?void 0:winnerPotentials.length)&&winnerMatchUp&&(!targetData.targetMatchUpIds&&winnerMatchUp&&(winnerMatchUp=inContextDrawMatchUps.find((({matchUpId:matchUpId2})=>matchUpId2===winnerMatchUp.matchUpId))),winnerMatchUp.potentialParticipants||(winnerMatchUp.potentialParticipants=[]),winnerMatchUp.potentialParticipants.push(winnerPotentials)),(null==loserPotentials?void 0:loserPotentials.length)&&loserMatchUp&&(!targetData.targetMatchUpIds&&loserMatchUp&&(winnerMatchUp=inContextDrawMatchUps.find((({matchUpId:matchUpId2})=>matchUpId2===loserMatchUp.matchUpId))),loserMatchUp.potentialParticipants||(loserMatchUp.potentialParticipants=[]),loserMatchUp.potentialParticipants.push(loserPotentials))}}}})),Object.keys(scheduleConflictMatchUpIds).length&&inContextDrawMatchUps.forEach((inContextMatchUp=>{Object.keys(scheduleConflictMatchUpIds).includes(inContextMatchUp.matchUpId)&&(inContextMatchUp.schedule.scheduleConflict=scheduleConflictMatchUpIds[inContextMatchUp.matchUpId])})),{scheduleConflictMatchUpIds}}function getNextToBePlayedMatchUp({matchUp,drawDefinition,inContextDrawMatchUps}){const{matchUpId,matchUpStatus,structureId}=matchUp||{};if(!matchUp||!structureId||(null==matchUp?void 0:matchUp.matchUpStatus)===TO_BE_PLAYED)return{matchUp};if(matchUpStatus===BYE){let winnerMatchUp;if(matchUp.winnerMatchUpId)winnerMatchUp=inContextDrawMatchUps.find((({matchUpId:matchUpId2})=>matchUpId2===matchUp.winnerMatchUpId));else{const targetData=positionTargets({inContextDrawMatchUps,drawDefinition,matchUpId});({winnerMatchUp}=(null==targetData?void 0:targetData.targetMatchUps)||{})}return getNextToBePlayedMatchUp({matchUp:winnerMatchUp,drawDefinition,inContextDrawMatchUps})}return{matchUp:void 0}}function getUpcomingInfo({upcomingMatchUp}={}){if(upcomingMatchUp)return(({matchUpId,structureId,schedule,roundNumber,roundPosition,structureName})=>({matchUpId,structureId,schedule,roundNumber,roundPosition,structureName}))(upcomingMatchUp)}function getStructureMatchUps({requireParticipants=!0,scheduleVisibilityFilters,tournamentAppliedPolicies,tournamentParticipants,afterRecoveryTimes,policyDefinitions,tournamentRecord,drawDefinition,matchUpFilters,contextFilters,contextProfile,contextContent,participantMap,scheduleTiming,exitProfiles,matchUpsMap,structureId,inContext,structure,context,event}){!structure&&structureId&&({structure}=findStructure({drawDefinition,structureId}));const result=getAllStructureMatchUps({tournamentAppliedPolicies,scheduleVisibilityFilters,tournamentParticipants,afterRecoveryTimes,policyDefinitions,tournamentRecord,drawDefinition,matchUpFilters,contextFilters,contextProfile,contextContent,participantMap,scheduleTiming,exitProfiles,matchUpsMap,structure,inContext,context,event});if(result.error)return result;const{matchUps}=result,{assignedPositions}=structureAssignedDrawPositions({structure}),participantAssignedDrawPositions=assignedPositions.filter((assignment=>assignment.participantId)).map((assignment=>assignment.drawPosition)),byeMatchUps=[],pendingMatchUps=[],upcomingMatchUps=[],abandonedMatchUps=[],completedMatchUps=[];let includesTeamMatchUps;return matchUps.filter((matchUp=>{var _a;const teamsMatchUpsOnly=1===(null==(_a=null==matchUpFilters?void 0:matchUpFilters.matchUpTypes)?void 0:_a.length)&&matchUpFilters.matchUpTypes[0]===TEAM$2;return matchUp.matchUpType===TEAM$2||!teamsMatchUpsOnly})).forEach((matchUp=>{var _a,_b,_c,_d;if(matchUp.matchUpStatus===ABANDONED)return void abandonedMatchUps.push(matchUp);matchUp.matchUpType===TEAM$2&&(includesTeamMatchUps=!0);const isCollectionMatchUp=matchUp.collectionId,collectionSidesAssigned=isCollectionMatchUp&&(null==(_a=matchUp.sides)?void 0:_a.every((side=>side.participantId))),drawPositionsFilled=!isCollectionMatchUp&&2===(null==(_b=matchUp.drawPositions)?void 0:_b.filter(Boolean).length),drawPositionsAssigned=!isCollectionMatchUp&&(null==(_c=matchUp.drawPositions)?void 0:_c.every((drawPosition=>participantAssignedDrawPositions.includes(drawPosition)))),byeAssignedDrawPositions=assignedPositions.filter((assignment=>assignment.bye)).map((assignment=>assignment.drawPosition)),isByeMatchUp=!isCollectionMatchUp&&(null==(_d=matchUp.drawPositions)?void 0:_d.find((drawPosition=>byeAssignedDrawPositions.includes(drawPosition)))),isUpcomingMatchUp=upcomingMatchUpStatuses.includes(matchUp.matchUpStatus)&&(collectionSidesAssigned||drawPositionsFilled&&(!requireParticipants||drawPositionsAssigned));return isByeMatchUp?byeMatchUps.push(matchUp):matchUpIsComplete({matchUp})?completedMatchUps.push(matchUp):isUpcomingMatchUp?upcomingMatchUps.push(matchUp):pendingMatchUps.push(matchUp)})),{includesTeamMatchUps,abandonedMatchUps,completedMatchUps,upcomingMatchUps,pendingMatchUps,byeMatchUps,structure}}var __defProp$4s=Object.defineProperty,__defProps$2x=Object.defineProperties,__getOwnPropDescs$2x=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4t=Object.getOwnPropertySymbols,__hasOwnProp$4t=Object.prototype.hasOwnProperty,__propIsEnum$4t=Object.prototype.propertyIsEnumerable,__defNormalProp$4s=(obj,key,value)=>key in obj?__defProp$4s(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4s=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4t.call(b,prop)&&__defNormalProp$4s(a,prop,b[prop]);if(__getOwnPropSymbols$4t)for(var prop of __getOwnPropSymbols$4t(b))__propIsEnum$4t.call(b,prop)&&__defNormalProp$4s(a,prop,b[prop]);return a},__spreadProps$2x=(a,b)=>__defProps$2x(a,__getOwnPropDescs$2x(b));function getAllDrawMatchUps(params){Object.assign(params,{requireParticipants:!1});const result=getDrawMatchUps(params);if(result.error)return decorateResult({result,stack:"getAllDrawMatchUps"});const{abandonedMatchUps,completedMatchUps,upcomingMatchUps,pendingMatchUps,byeMatchUps,matchUpsMap}=result;return{matchUps:[].concat(...abandonedMatchUps,...completedMatchUps,...upcomingMatchUps,...pendingMatchUps,...byeMatchUps),matchUpsMap}}function getDrawMatchUps({scheduleVisibilityFilters,tournamentAppliedPolicies,tournamentParticipants,requireParticipants,participantsProfile,afterRecoveryTimes,includeByeMatchUps,policyDefinitions,tournamentRecord,contextContent,contextFilters,contextProfile,drawDefinition,matchUpFilters,scheduleTiming,participantMap,nextMatchUps,matchUpsMap,inContext,context,event}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};let allAbandonedMatchUps=[],allCompletedMatchUps=[],allUpcomingMatchUps=[],allPendingMatchUps=[],allByeMatchUps=[];contextProfile&&!contextContent&&(contextContent=getContextContent({policyDefinitions,tournamentRecord,contextProfile,event})),!(null==tournamentParticipants?void 0:tournamentParticipants.length)&&tournamentRecord&&(tournamentParticipants=null==tournamentRecord?void 0:tournamentRecord.participants,(inContext||(null==participantsProfile?void 0:participantsProfile.withGroupings))&&(null==tournamentParticipants?void 0:tournamentParticipants.length)&&(tournamentParticipants=addParticipantGroupings({participants:tournamentParticipants,participantsProfile})));const{structures}=getDrawStructures({drawDefinition});matchUpsMap||(matchUpsMap=getMatchUpsMap({drawDefinition}));const exitProfiles=drawDefinition&&getExitProfiles({drawDefinition}).exitProfiles;structures.forEach((structure=>{const{byeMatchUps=[],pendingMatchUps,upcomingMatchUps,completedMatchUps,abandonedMatchUps}=getStructureMatchUps({matchUpFilters:nextMatchUps?void 0:matchUpFilters,contextFilters:nextMatchUps?void 0:contextFilters,inContext:inContext||nextMatchUps||contextFilters,tournamentAppliedPolicies,scheduleVisibilityFilters,tournamentParticipants,requireParticipants,afterRecoveryTimes,includeByeMatchUps,policyDefinitions,tournamentRecord,contextProfile,contextContent,drawDefinition,participantMap,scheduleTiming,exitProfiles,matchUpsMap,structure,context,event});allAbandonedMatchUps=allAbandonedMatchUps.concat(...abandonedMatchUps),allCompletedMatchUps=allCompletedMatchUps.concat(...completedMatchUps),allUpcomingMatchUps=allUpcomingMatchUps.concat(...upcomingMatchUps),allPendingMatchUps=allPendingMatchUps.concat(...pendingMatchUps),allByeMatchUps=allByeMatchUps.concat(...byeMatchUps)}));const applyFilter=matchUps=>matchUpFilters||nextMatchUps||contextFilters?(matchUpFilters&&(matchUps=filterMatchUps(__spreadValues$4s({matchUps},matchUpFilters))),contextFilters&&(matchUps=filterMatchUps(__spreadProps$2x(__spreadValues$4s({matchUps},contextFilters),{processContext:!0}))),matchUps):matchUps,matchUpGroups=__spreadValues$4s({abandonedMatchUps:applyFilter(allAbandonedMatchUps),completedMatchUps:applyFilter(allCompletedMatchUps),upcomingMatchUps:applyFilter(allUpcomingMatchUps),pendingMatchUps:applyFilter(allPendingMatchUps),byeMatchUps:applyFilter(allByeMatchUps),matchUpsMap},SUCCESS);if(nextMatchUps){const nextFilter="object"==typeof nextMatchUps||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned,completed,upcoming,pending,bye}=nextFilter;addUpcomingMatchUps({inContextDrawMatchUps:[].concat(...abandoned&&allAbandonedMatchUps||[],...completed&&allCompletedMatchUps||[],...upcoming&&allUpcomingMatchUps||[],...pending&&allPendingMatchUps||[],...bye&&allByeMatchUps||[]),drawDefinition})}return matchUpGroups}const toBePlayed={matchUpStatus:TO_BE_PLAYED,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};var __defProp$4r=Object.defineProperty,__getOwnPropSymbols$4s=Object.getOwnPropertySymbols,__hasOwnProp$4s=Object.prototype.hasOwnProperty,__propIsEnum$4s=Object.prototype.propertyIsEnumerable,__defNormalProp$4r=(obj,key,value)=>key in obj?__defProp$4r(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4r=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4s.call(b,prop)&&__defNormalProp$4r(a,prop,b[prop]);if(__getOwnPropSymbols$4s)for(var prop of __getOwnPropSymbols$4s(b))__propIsEnum$4s.call(b,prop)&&__defNormalProp$4r(a,prop,b[prop]);return a};function modifyMatchUpScore({matchUpStatusCodes,removeWinningSide,tournamentRecord,drawDefinition,matchUpFormat,matchUpStatus,removeScore,winningSide,matchUpId,matchUp,event,notes,score}){var _a,_b;const stack="modifyMatchUpScore";let structure;const isDualMatchUp=matchUp.matchUpType===TEAM$2;if(isDualMatchUp?matchUpId&&matchUp.matchUpId!==matchUpId&&({matchUp,structure}=findMatchUp$1({drawDefinition,matchUpId,event})):matchUp.matchUpId!==matchUpId&&console.log("!!!!!"),matchUpStatus&&[WALKOVER$2,DOUBLE_WALKOVER].includes(matchUpStatus)||removeScore?Object.assign(matchUp,__spreadValues$4r({},toBePlayed)):score&&(matchUp.score=score),matchUpStatus&&(matchUp.matchUpStatus=matchUpStatus),matchUpFormat&&(matchUp.matchUpFormat=matchUpFormat),matchUpStatusCodes&&(matchUp.matchUpStatusCodes=matchUpStatusCodes),winningSide&&(matchUp.winningSide=winningSide),removeWinningSide&&(matchUp.winningSide=void 0),structure||({structure}=findMatchUp$1({drawDefinition,matchUpId,event})),matchUp.winningSide||!scoreHasValue(matchUp)||completedMatchUpStatuses.includes(matchUpStatus)||[AWAITING_RESULT,SUSPENDED].includes(matchUpStatus)||(matchUp.matchUpStatus=IN_PROGRESS$1),(null==structure?void 0:structure.structureType)===CONTAINER&&!matchUp.collectionId){matchUpFormat=isDualMatchUp?"SET1-S:T100":matchUpFormat||matchUp.matchUpFormat||(null==structure?void 0:structure.matchUpFormat)||drawDefinition.matchUpFormat||(null==event?void 0:event.matchUpFormat);const itemStructure=structure.structures.find((itemStructure2=>null==itemStructure2?void 0:itemStructure2.matchUps.find((matchUp2=>matchUp2.matchUpId===matchUpId)))),matchUpFilters=isDualMatchUp&&{matchUpTypes:[TEAM$2]},{matchUps}=getAllStructureMatchUps({afterRecoveryTimes:!1,structure:itemStructure,inContext:!0,matchUpFilters,event}),result=updateAssignmentParticipantResults({positionAssignments:itemStructure.positionAssignments,tournamentRecord,drawDefinition,matchUpFormat,matchUps,event});if(result.error)return decorateResult({result,stack})}if(winningSide!==matchUp.winningSide){const{flightProfile}=getFlightProfile({event}),flight=null==(_a=null==flightProfile?void 0:flightProfile.flights)?void 0:_a.find((flight2=>flight2.drawId===drawDefinition.drawId));(null==flight?void 0:flight.matchUpValue)&&console.log("recalculate team point tallies")}if(notes){const result=addNotes({element:matchUp,notes});if(result.error)return decorateResult({result,stack})}const tournamentId=null==tournamentRecord?void 0:tournamentRecord.tournamentId;if(getTopics().topics.includes(UPDATE_INCONTEXT_MATCHUP)){const matchUpsMap=getMatchUpsMap({drawDefinition}),inContextMatchUp=null==(_b=getAllDrawMatchUps({matchUpFilters:{matchUpIds:[matchUpId]},includeByeMatchUps:!0,nextMatchUps:!0,tournamentRecord,inContext:!0,drawDefinition,matchUpsMap}).matchUps)?void 0:_b[0];inContextMatchUp&&function updateInContextMatchUp({tournamentId,inContextMatchUp}){if(!inContextMatchUp)return{error:MISSING_MATCHUP};addNotice({topic:UPDATE_INCONTEXT_MATCHUP,payload:{inContextMatchUp,tournamentId},key:inContextMatchUp.matchUpId})}({tournamentId,inContextMatchUp})}return modifyMatchUpNotice({eventId:null==event?void 0:event.eventId,context:stack,drawDefinition,tournamentId,matchUp}),__spreadValues$4r({},SUCCESS)}var __defProp$4q=Object.defineProperty,__defProps$2w=Object.defineProperties,__getOwnPropDescs$2w=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4r=Object.getOwnPropertySymbols,__hasOwnProp$4r=Object.prototype.hasOwnProperty,__propIsEnum$4r=Object.prototype.propertyIsEnumerable,__defNormalProp$4q=(obj,key,value)=>key in obj?__defProp$4q(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4q=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4r.call(b,prop)&&__defNormalProp$4q(a,prop,b[prop]);if(__getOwnPropSymbols$4r)for(var prop of __getOwnPropSymbols$4r(b))__propIsEnum$4r.call(b,prop)&&__defNormalProp$4q(a,prop,b[prop]);return a},__spreadProps$2w=(a,b)=>__defProps$2w(a,__getOwnPropDescs$2w(b));function updateTieMatchUpScore$1({tournamentRecord,exitWhenNoValues,drawDefinition,matchUpStatus,removeScore,matchUpId,event}){const result=findMatchUp$1({drawDefinition,event,matchUpId});if(result.error)return result;const{matchUp,structure}=result;if(!matchUp.tieMatchUps)return{error:INVALID_MATCHUP};const{extension}=findExtension$2({name:DISABLE_AUTO_CALC,element:matchUp});if(null==extension?void 0:extension.value){if(!removeScore)return __spreadProps$2w(__spreadValues$4q({},SUCCESS),{score:matchUp.score});removeExtension$1({element:matchUp,name:DISABLE_AUTO_CALC})}const tieFormat=matchUp.tieFormat||(null==structure?void 0:structure.tieFormat)||(null==drawDefinition?void 0:drawDefinition.tieFormat)||(null==event?void 0:event.tieFormat)||void 0;matchUp.tieFormat=copyTieFormat(tieFormat);const{winningSide,set,scoreStringSide1,scoreStringSide2}=generateTieMatchUpScore({matchUp}),setHasValue=(null==set?void 0:set.side1Score)||(null==set?void 0:set.side2Score);if(exitWhenNoValues&&!matchUp.score&&!setHasValue)return __spreadValues$4q({},SUCCESS);const scoreObject={scoreStringSide1,scoreStringSide2,sets:set?[set]:[]},hasWinner=[1,2].includes(winningSide),newMatchUpStatus=hasWinner&&COMPLETED$1||isActiveMatchUp({matchUpStatus:matchUpStatus||matchUp.matchUpStatus,tieMatchUps:matchUp.tieMatchUps,winningSide:matchUp.winningSide,score:scoreObject})&&IN_PROGRESS$1||TO_BE_PLAYED,removeWinningSide=matchUp.winningSide&&!hasWinner,hasResults=matchUp.tieMatchUps.find((({score,winningSide:winningSide2,matchUpStatus:matchUpStatus2})=>{var _a;return(null==(_a=null==score?void 0:score.sets)?void 0:_a.length)&&(score.sets[0].side1Score||score.sets[0].side2Score)||completedMatchUpStatuses.includes(matchUpStatus2)||winningSide2}));let tieFormatRemoved;if(matchUp.tieFormat&&!hasWinner&&!hasResults){const inheritedTieFormat=(null==structure?void 0:structure.tieFormat)||(null==drawDefinition?void 0:drawDefinition.tieFormat)||(null==event?void 0:event.tieFormat)||void 0;inheritedTieFormat&&JSON.stringify(tieFormat)===JSON.stringify(inheritedTieFormat)&&(matchUp.tieFormat=void 0,tieFormatRemoved=!0)}return modifyMatchUpScore({matchUpStatus:newMatchUpStatus,score:scoreObject,removeWinningSide,tournamentRecord,drawDefinition,removeScore,winningSide,matchUpId,matchUp,event}),__spreadProps$2w(__spreadValues$4q({},SUCCESS),{score:scoreObject,removeWinningSide,tieFormatRemoved,winningSide})}function generateScoreString(params){const{winnerFirst=!0,addOutcomeString,reversed=!1,matchUpStatus,matchUpFormat,autoComplete,winningSide,sets}=params;if(!sets)return{error:MISSING_VALUE,info:"missing sets"};const parsedFormat=matchUpFormat&&parse(matchUpFormat),{bestOf,finalSetFormat,setFormat}=parsedFormat||{},reverseScores=reversed||!(!winnerFirst||!winningSide||1===winningSide),outcomeString=addOutcomeString?function getOutcomeString({matchUpStatus}){const outcomeStrings={[RETIRED$1]:"RET",[WALKOVER$2]:"WO",[DOUBLE_DEFAULT]:"DF/DF",[DOUBLE_WALKOVER]:"WO/WO",[SUSPENDED]:"SUS",[ABANDONED]:"ABN",[DEFAULTED]:"DEF",[DEAD_RUBBER]:"DR"};return matchUpStatus&&outcomeStrings[matchUpStatus]||""}({matchUpStatus}):"",setScores=(null==sets?void 0:sets.sort(setSort).map((function setString(currentSet){const format=bestOf&&currentSet.setNumber===bestOf&&finalSetFormat?finalSetFormat:setFormat,isTiebreakSet=(null==format?void 0:format.tiebreakSet)||(set=currentSet,!(isNumeric(null==set?void 0:set.side1Score)||isNumeric(null==set?void 0:set.side2Score))&&(set=>isNumeric(null==set?void 0:set.side1TiebreakScore)||isNumeric(null==set?void 0:set.side2TiebreakScore))(currentSet)),{side1Score,side2Score,side1TiebreakScore,side2TiebreakScore}=currentSet,t1=side1TiebreakScore||(isNumeric(side1TiebreakScore)||autoComplete?0:""),t2=side2TiebreakScore||(isNumeric(side2TiebreakScore)||autoComplete?0:"");var set;if(isTiebreakSet){return`[${(reverseScores?[t2,t1]:[t1,t2]).join("-")}]`}const lowTiebreakScore=Math.min(t1,t2),tiebreak=lowTiebreakScore?`(${lowTiebreakScore})`:"",s1=side1Score||(isNumeric(side1Score)||autoComplete?0:""),s2=side2Score||(isNumeric(side2Score)||autoComplete?0:"");let scoreString=reverseScores?`${[s2,s1].join("-")}${tiebreak}`:`${[s1,s2].join("-")}${tiebreak}`;["-"," "].includes(scoreString)&&(scoreString="");return scoreString})).filter(Boolean).join(" "))||"";return outcomeString?2===winningSide?`${outcomeString} ${setScores}`:`${setScores} ${outcomeString}`:setScores}function setSort(a,b){return a.setNumber-b.setNumber}function validateScore({existingMatchUpStatus,matchUpFormat,matchUpStatus,winningSide,score}){if("object"!=typeof score)return{error:INVALID_VALUES};const{sets,scoreStringSide1,scoreStringSide2}=score,info="scoreString must be a string!";if(void 0!==scoreStringSide1&&"string"!=typeof scoreStringSide1)return{error:INVALID_VALUES,info};if(void 0!==scoreStringSide2&&"string"!=typeof scoreStringSide2)return{error:INVALID_VALUES,info};if(void 0!==sets&&!Array.isArray(sets))return{error:INVALID_VALUES,info:mustBeAnArray("sets")};if(null==sets?void 0:sets.length){const setNumbers=sets.map((set=>null==set?void 0:set.setNumber)).filter(Boolean);if(setNumbers.length!==unique(setNumbers).length)return{error:INVALID_VALUES,info:"setNumbers not unique"};for(const set of sets){const{side1Score,side2Score,side1TiebreakScore,side2TiebreakScore,side1PointScore,side2PointScore,winningSide:winningSide2,setNumber}=set;if(![[side1Score,side2Score],[side1TiebreakScore,side2TiebreakScore],[side1PointScore,side2PointScore]].filter((pair=>pair.some((value=>void 0!==value)))).every((pair=>pair.every((numericValue=>isConvertableInteger(numericValue))))))return{error:INVALID_VALUES,info:"non-numeric values"};if(![setNumber,winningSide2].filter((value=>void 0!==value)).every((numericValue=>isConvertableInteger(numericValue))))return{error:INVALID_VALUES,info:"non-numeric values"};if(winningSide2&&![1,2].includes(winningSide2))return{error:INVALID_VALUES,info:"winningSide must be 1 or 2"}}const{valid:isValidScore}=function analyzeScore({existingMatchUpStatus,matchUpFormat,matchUpStatus,winningSide,score}){const sets=(null==score?void 0:score.sets)||[],setsWinCounts=((null==sets?void 0:sets.filter((set=>null==set?void 0:set.winningSide)))||[]).reduce(((counts,set)=>{const{winningSide:winningSide2}=set;return counts[winningSide2-1]++,counts}),[0,0]),matchUpWinningSideIndex=winningSide&&winningSide-1,matchUpLosingSideIndex=1-matchUpWinningSideIndex,winningSideSetsCount=setsWinCounts[matchUpWinningSideIndex],losingSideSetsCount=setsWinCounts[matchUpLosingSideIndex],matchUpScoringFormat=parse(matchUpFormat),maxSetsCount=Math.max(...setsWinCounts),maxSetsInstances=instanceCount(setsWinCounts)[maxSetsCount],{bestOf}=matchUpScoringFormat||{},setsToWin=bestOf&&Math.ceil(bestOf/2)||1,irregularEnding=[DEFAULTED,RETIRED$1,WALKOVER$2].includes(matchUpStatus||existingMatchUpStatus),validSets=!matchUpScoringFormat||!sets.length||sets.every(((set,i)=>{const isFinalSet=i+1===bestOf,{side1Score,side2Score}=set,maxSetScore=Math.max(side1Score||0,side2Score||0),{finalSetFormat,setFormat}=matchUpScoringFormat;return!(maxSetScore>(isFinalSet&&finalSetFormat||setFormat).setTo+1)})),calculatedWinningSide=(!matchUpFormat||maxSetsCount===setsToWin)&&1===maxSetsInstances&&setsWinCounts.indexOf(maxSetsCount)+1||void 0;return{valid:winningSide&&winningSideSetsCount>losingSideSetsCount&&winningSide===calculatedWinningSide||!winningSide&&!calculatedWinningSide&&validSets||irregularEnding}}({existingMatchUpStatus,matchUpStatus,matchUpFormat,winningSide,score});if(!isValidScore)return{error:INVALID_SCORE,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}function getWinningSide$1({analysis,set}){const leadingSide=getLeadingSide$1({set}),{isDecidingSet,isTiebreakSet,matchUpScoringFormat}=analysis;return checkSetIsComplete$1({matchUpScoringFormat,isDecidingSet,isTiebreakSet,set})&&leadingSide}function checkSetIsComplete$1({ignoreTiebreak=!1,matchUpScoringFormat,matchUpFormat,isTiebreakSet,isDecidingSet,set}){if(!set)return{error:MISSING_VALUE};matchUpScoringFormat=matchUpScoringFormat||matchUpFormat;const setFormat=isDecidingSet&&matchUpScoringFormat.finalSetFormat||(null==matchUpScoringFormat?void 0:matchUpScoringFormat.setFormat)||{},{side1Score,side2Score}=set,{NoAD,setTo,tiebreakAt,tiebreakFormat}=setFormat,tiebreakNoAd=null==tiebreakFormat?void 0:tiebreakFormat.NoAd,leadingSide=getLeadingSide$1({set}),scoreDiff=Math.abs(side1Score-side2Score),containsSetTo=side1Score>=setTo||side2Score>=setTo,requiresTiebreak=isTiebreakSet||side1Score>=setTo&&side2Score>=setTo||tiebreakAt&&tiebreakAt<setTo&&(side1Score===tiebreakAt||side2Score===tiebreakAt),tiebreakIsValid=ignoreTiebreak||requiresTiebreak&&(1===leadingSide&&set.side1TiebreakScore>set.side2TiebreakScore||2===leadingSide&&set.side2TiebreakScore>set.side1TiebreakScore);return(containsSetTo&&(scoreDiff>=(NoAD||requiresTiebreak&&(tiebreakAt&&!isTiebreakSet||isTiebreakSet&&tiebreakNoAd)?1:2)||requiresTiebreak)||isTiebreakSet)&&(!requiresTiebreak||tiebreakIsValid)}function getLeadingSide$1({set}){if(set.side1Score||set.side2Score){if(set.side1Score>set.side2Score)return 1;if(set.side2Score>set.side1Score)return 2}else if(set.side1TiebreakScore||set.side2TiebreakScore){if(set.side1TiebreakScore>set.side2TiebreakScore)return 1;if(set.side2TiebreakScore>set.side1TiebreakScore)return 2}}const SPACE_CHARACTER=" ",OUTCOME_DEFAULT="DEF",OUTCOME_WALKOVER="WO",OUTCOME_ABANDONED="ABN",OUTCOME_SUSPENDED="SUS",OUTCOME_RETIREMENT="RET",OUTCOME_INTERRUPTED="INT",OUTCOMES=[OUTCOME_RETIREMENT,OUTCOME_DEFAULT,OUTCOME_WALKOVER,"WO/WO",OUTCOME_ABANDONED,OUTCOME_SUSPENDED,OUTCOME_INTERRUPTED],STATUS_DEFAULT="DEFAULTED",STATUS_WALKOVER="WALKOVER",STATUS_ABANDONED="ABANDONED",STATUS_SUSPENDED="SUSPENDED",STATUS_RETIREMENT="RETIRED",STATUS_INTERRUPTED="INTERRUPTED",WINNING_STATUSES=[STATUS_RETIREMENT,STATUS_DEFAULT,STATUS_WALKOVER],SET_TIEBREAK_BRACKETS="()",MATCH_TIEBREAK_BRACKETS="[]",MOVEUP=["up","left","shift+tab"],MOVEDOWN=["enter","down","tab","right"],BACKSPACE="backspace",RETIRE="r",SUSPEND="s",ABANDON="a",DEFAULT="d",WALKOVER="w",INTERRUPT="i",OUTCOMEKEYS=[RETIRE,DEFAULT,WALKOVER,ABANDON,SUSPEND,INTERRUPT],SPACE_KEY="space",OPENERS=["[","("],CLOSERS=[...MOVEUP,...MOVEDOWN,SPACE_KEY,"]"],SCORE_JOINER="-",MATCH_TIEBREAK_JOINER="-",ALTERNATE_JOINERS=["/"],SIDE1KEYS=["0","1","2","3","4","5","6","7","8","9"].concat(OUTCOMEKEYS),SIDE2KEYS=SIDE1KEYS.map((key=>`shift+${key}`)),MODIFIERS=[SCORE_JOINER,BACKSPACE].concat(CLOSERS,ALTERNATE_JOINERS),VALID_VALUE_KEYS=[SIDE1KEYS,SIDE2KEYS,MODIFIERS].join(",");[VALID_VALUE_KEYS,MOVEUP,MOVEDOWN,["=","+","num_1","num_2","shift+=","shift+-"]].join(",");[].concat(...SIDE1KEYS,...SIDE1KEYS,...MODIFIERS,...SIDE1KEYS,...SIDE1KEYS,...SIDE1KEYS,...SIDE1KEYS,...SIDE1KEYS,...SIDE1KEYS);function addOutcome({scoreString,lowSide,outcome}){if(({scoreString}=removeOutcome({scoreString})),2===lowSide){return scoreString+((scoreString&&scoreString[scoreString.length-1])!==SPACE_CHARACTER?SPACE_CHARACTER:"")+outcome}return outcome+SPACE_CHARACTER+scoreString}function removeOutcome({scoreString}){if(!scoreString)return{scoreString:""};let removed=!1;for(const outcome of OUTCOMES){const index=null==scoreString?void 0:scoreString.indexOf(outcome);0===index?scoreString=scoreString.slice(outcome.length+1).trim()+SPACE_CHARACTER:index>0&&(scoreString=scoreString.slice(0,index)),index>=0&&(removed=!0)}return scoreString&&scoreString.trim()||(scoreString=""),{scoreString,removed}}function removeFromScore({analysis,scoreString,sets,lowSide}){var _a,_b,_c;let newScore,newSets;if(!scoreString)return{scoreString,sets};const{scoreString:outcomeRemoved,removed}=removeOutcome({scoreString});if(scoreString=outcomeRemoved,removed)return{scoreString,sets,outcomeRemoved:!0};let lastSet=sets[sets.length-1]||{};const setValuesCount=Object.values(lastSet).filter((f=>void 0!==f)).length;lastSet.setNumber&&1===setValuesCount&&(lastSet=(sets=sets.slice(0,sets.length-1))[sets.length-1]||{});const{tiebreakSet}=analysis.setFormat,{tiebreakTo,NoAD}=tiebreakSet||{},{isTiebreakEntry:isMatchTiebreak}=testTiebreakEntry({scoreString,brackets:MATCH_TIEBREAK_BRACKETS}),index=function lastNumericIndex(str){const arr=str.split("");return arr.reduce(((a,e,i)=>(e.match(/\d+/g)&&a.push(i),a)),[]).pop()}(scoreString);if(index>=0){newScore=scoreString.slice(0,index);const{isTiebreakEntry:openSetTiebreak}=testTiebreakEntry({scoreString:newScore,brackets:SET_TIEBREAK_BRACKETS}),{lastOpenBracketIndex:lastMatchTiebreakOpenBracketIndex,isTiebreakEntry:openMatchTiebreak}=testTiebreakEntry({scoreString:newScore,brackets:MATCH_TIEBREAK_BRACKETS}),lastNewScoreChar=newScore&&newScore[newScore.length-1].trim(),remainingNumbers=newScore&&!isNaN(lastNewScoreChar);let isIncompleteScore=analysis.isIncompleteSetScore;if(isMatchTiebreak&&openMatchTiebreak){const splitScoreString=newScore.slice(lastMatchTiebreakOpenBracketIndex+1).split(MATCH_TIEBREAK_JOINER),side1TiebreakScore=(null==splitScoreString?void 0:splitScoreString.length)>0&&void 0!==splitScoreString[0]&&!isNaN(parseInt(splitScoreString[0]))&&parseInt(splitScoreString[0])||void 0,side2TiebreakScore=(null==splitScoreString?void 0:splitScoreString.length)>1&&void 0!==splitScoreString[1]&&parseInt(splitScoreString[1])||void 0,matchTiebreakScores=[side1TiebreakScore,side2TiebreakScore];if(side2TiebreakScore){const highIndex=1===lowSide?1:0;matchTiebreakScores[highIndex]=matchTiebreakScores[1-highIndex]+(NoAD?1:2),matchTiebreakScores[highIndex]<tiebreakTo&&(matchTiebreakScores[highIndex]=tiebreakTo),newScore=scoreString.slice(0,lastMatchTiebreakOpenBracketIndex+1),newScore+=matchTiebreakScores.join(MATCH_TIEBREAK_JOINER)}else void 0!==side1TiebreakScore?(newScore=scoreString.slice(0,lastMatchTiebreakOpenBracketIndex+1),newScore+=side1TiebreakScore):(newScore=scoreString.slice(0,lastMatchTiebreakOpenBracketIndex),isIncompleteScore=!0);lastSet.side1TiebreakScore=matchTiebreakScores[0]||0,lastSet.side2TiebreakScore=matchTiebreakScores[1]||0}if(newScore.length||(newScore=void 0),isIncompleteScore){const side1Score=null==(_a=lastSet.side1Score)?void 0:_a.toString();if(side1Score){const newSide1Score=null==side1Score?void 0:side1Score.slice(0,side1Score.length-1);lastSet.side1Score=!isNaN(newSide1Score)&&parseInt(newSide1Score)||void 0,void 0===lastSet.side1Score&&(lastSet.side2Score=void 0)}analysis.isTimedSet?(newSets=lastSet.side1Score?sets:(null==sets?void 0:sets.slice(0,sets.length-1))||[],newSets[sets.length-1]=lastSet):newSets=(null==sets?void 0:sets.slice(0,sets.length-1))||[]}else if(remainingNumbers){const side2Score=null==(_b=lastSet.side2Score)?void 0:_b.toString(),side1Score=null==(_c=lastSet.side1Score)?void 0:_c.toString();if(!analysis.isTiebreakEntry&&!analysis.isMatchTiebreak)if(lastSet.side2Score){const newSide2Score=null==side2Score?void 0:side2Score.slice(0,side2Score.length-1);lastSet.side2Score=!isNaN(newSide2Score)&&parseInt(newSide2Score)||void 0}else{const newSide1Score=null==side1Score?void 0:side1Score.slice(0,side1Score.length-1);lastSet.side1Score=!isNaN(newSide1Score)&&parseInt(newSide1Score)||void 0}analysis.isTimedSet?lastSet.side1Score?(newSets=sets||[],newSets[sets.length-1]=lastSet):newSets=(null==sets?void 0:sets.slice(0,sets.length-1))||[]:(newSets=sets||[],newSets[sets.length-1]=lastSet),newSets[newSets.length-1]&&Object.assign(newSets[newSets.length-1],{winningSide:void 0})}else openSetTiebreak?(newSets=sets||[],Object.assign(newSets[newSets.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(isMatchTiebreak&&!openMatchTiebreak?newSets=(null==sets?void 0:sets.slice(0,sets.length-1))||[]:(newSets=sets,newSets[sets.length-1]=lastSet),isMatchTiebreak||(newSets[newSets.length-1].side2Score=0,newSets[newSets.length-1].winningSide=void 0));return{scoreString:newScore,sets:newSets}}return{scoreString,sets}}function testTiebreakEntry({scoreString,brackets=SET_TIEBREAK_BRACKETS}){if(!scoreString)return!1;const[open,close]=brackets.split(""),splitScore=scoreString.split(""),lastOpenBracketIndex=Math.max(...arrayIndices(open,splitScore));return{isTiebreakEntry:lastOpenBracketIndex>Math.max(...arrayIndices(close,splitScore)),lastOpenBracketIndex}}function getHighTiebreakValue$1({lowValue=0,NoAD=!1,tiebreakTo}={}){return lowValue+1>=tiebreakTo?lowValue+(NoAD?1:2):parseInt(tiebreakTo)}function getMatchUpWinner({matchUpFormat,matchUpStatus,winningSide,sets}){const matchUpScoringFormat=parse(matchUpFormat),{bestOf}=matchUpScoringFormat,scoreGoal=Math.ceil(bestOf/2),sideScores=sets&&sets.reduce(((scores,set)=>{const{winningSide:winningSide2}=set;return winningSide2&&scores[winningSide2-1]++,scores}),[0,0]);let matchUpWinningSide=(null==sideScores?void 0:sideScores.indexOf(scoreGoal))+1||void 0;return WINNING_STATUSES.includes(matchUpStatus)&&winningSide&&(matchUpWinningSide=winningSide),{matchUpWinningSide}}function processOutcome({lowSide,value,sets,scoreString,winningSide,matchUpStatus}){let updated;return value===RETIRE?scoreString?(updated=!0,scoreString=addOutcome({scoreString,lowSide,outcome:OUTCOME_RETIREMENT}),winningSide=2===lowSide?1:2,matchUpStatus=STATUS_RETIREMENT):(updated=!0,scoreString=addOutcome({scoreString,lowSide,outcome:OUTCOME_DEFAULT}),winningSide=2===lowSide?1:2,matchUpStatus=STATUS_DEFAULT):value===DEFAULT?(updated=!0,scoreString=addOutcome({scoreString,lowSide,outcome:OUTCOME_DEFAULT}),winningSide=2===lowSide?1:2,matchUpStatus=STATUS_DEFAULT):value===WALKOVER?(updated=!0,sets=[],scoreString=OUTCOME_WALKOVER,winningSide=2===lowSide?1:2,matchUpStatus=STATUS_WALKOVER):value===SUSPEND&&scoreString?(updated=!0,scoreString=addOutcome({scoreString,lowSide,outcome:OUTCOME_SUSPENDED}),matchUpStatus=STATUS_SUSPENDED,winningSide=void 0):value===ABANDON?(updated=!0,scoreString=addOutcome({scoreString,lowSide,outcome:OUTCOME_ABANDONED}),matchUpStatus=STATUS_ABANDONED,winningSide=void 0):value===INTERRUPT&&scoreString&&(updated=!0,scoreString=addOutcome({scoreString,lowSide,outcome:OUTCOME_INTERRUPTED}),matchUpStatus=STATUS_INTERRUPTED,winningSide=void 0),{updated,sets,scoreString,matchUpStatus,winningSide}}function getScoreAnalysis({sets,scoreString,winningSide,matchUpFormat,value}){var _a,_b;const setNumber=((null==(_a=null==sets?void 0:sets.filter((set=>null==set?void 0:set.winningSide)))?void 0:_a.length)||0)+(winningSide?0:1),matchUpScoringFormat=parse(matchUpFormat),isDecidingSet=setNumber===(null==matchUpScoringFormat?void 0:matchUpScoringFormat.bestOf),setFormat=isDecidingSet&&matchUpScoringFormat.finalSetFormat||matchUpScoringFormat.setFormat||{},isTimedSet=(null==setFormat?void 0:setFormat.timed)||matchUpScoringFormat.timed,finalSet=isDecidingSet&&sets[(null==matchUpScoringFormat?void 0:matchUpScoringFormat.bestOf)-1],finalSetIsComplete=finalSet&&finalSet.winningSide,{isTiebreakEntry:isSetTiebreakEntry}=testTiebreakEntry({scoreString,brackets:SET_TIEBREAK_BRACKETS}),{isTiebreakEntry:isMatchTiebreakEntry}=testTiebreakEntry({scoreString,brackets:MATCH_TIEBREAK_BRACKETS}),isTiebreakEntry=isSetTiebreakEntry||isMatchTiebreakEntry,isTiebreakSet=!!setFormat.tiebreakSet,lastScoreChar=scoreString&&scoreString[scoreString.length-1].trim(),isNumericEnding=scoreString&&!isNaN(lastScoreChar),isIncompleteSetScore=!isTiebreakEntry&&lastScoreChar===SCORE_JOINER,isIncompleteSetTiebreak=isSetTiebreakEntry&&OPENERS.includes(lastScoreChar),isIncompleteMatchTiebreak=isMatchTiebreakEntry&&OPENERS.includes(lastScoreChar),isPartialMatchTiebreakValue=isMatchTiebreakEntry&&lastScoreChar===MATCH_TIEBREAK_JOINER,splitScore=scoreString&&scoreString.split(""),[open]=MATCH_TIEBREAK_BRACKETS.split(""),lastOpenBracketIndex=splitScore&&Math.max(...arrayIndices(open,splitScore)),lastJoinerIndex=splitScore&&Math.max(...arrayIndices(MATCH_TIEBREAK_JOINER,splitScore)),matchTiebreakHasJoiner=splitScore&&lastJoinerIndex>lastOpenBracketIndex,lastSetIsComplete=null==(_b=sets[sets.length-1])?void 0:_b.winningSide,isGameScoreEntry=(null==sets?void 0:sets.length)&&!lastSetIsComplete,hasOutcome=OUTCOMES.find((outcome=>(null==scoreString?void 0:scoreString.indexOf(outcome))>=0)),isNumericValue=!isNaN(value),isSpace=value===SPACE_KEY,isCloser=CLOSERS.includes(value),hasOpener=null==scoreString?void 0:scoreString.split("").find((char=>OPENERS.includes(char))),isInvalidMatchTiebreakValue=isCloser&&isMatchTiebreakEntry&&!isIncompleteMatchTiebreak&&(isPartialMatchTiebreakValue||!function checkValidMatchTiebreak({scoreString}){if(!scoreString)return!1;const lastScoreChar=scoreString&&scoreString[scoreString.length-1].trim(),isNumericEnding=scoreString&&!isNaN(lastScoreChar),[open,close]=MATCH_TIEBREAK_BRACKETS.split(""),splitScore=scoreString.split(""),lastOpenBracketIndex=Math.max(...arrayIndices(open,splitScore)),lastCloseBracketIndex=Math.max(...arrayIndices(close,splitScore)),lastJoinerIndex=Math.max(...arrayIndices(MATCH_TIEBREAK_JOINER,splitScore));return isNumericEnding&&lastOpenBracketIndex>lastCloseBracketIndex&&lastJoinerIndex>lastOpenBracketIndex}({scoreString}));return{isTiebreakSetValue:isTiebreakSet&&isNumericValue,matchUpScoringFormat,setNumber,setFormat,matchTiebreakHasJoiner,isGameScoreEntry,isSpace,isCloser,isTiebreakCloser:isCloser&&hasOpener&&isTiebreakEntry&&isNumericEnding,isDecidingSet,isTiebreakSet,isTimedSet,isNumericEnding,isNumericValue,hasOpener,hasOutcome,finalSet,finalSetIsComplete,lastSetIsComplete,isInvalidSetTiebreakValue:isSpace&&isTiebreakEntry&&isIncompleteSetTiebreak,isInvalidMatchTiebreakValue,isTiebreakEntry,isSetTiebreakEntry,isMatchTiebreakEntry,isIncompleteSetScore,isIncompleteSetTiebreak,isIncompleteMatchTiebreak,isPartialMatchTiebreakValue}}function getSetWinningSide({matchUpScoringFormat,isDecidingSet,isTiebreakSet,setObject}){if(!setObject)return;const leadingSide=getLeadingSide({set:setObject}),setIsComplete=function checkSetIsComplete({ignoreTiebreak=!1,matchUpScoringFormat,matchUpFormat,isTiebreakSet,isDecidingSet,set}){if(!set)return{error:MISSING_VALUE,info:"missing set"};matchUpScoringFormat=matchUpScoringFormat||matchUpFormat;const setFormat=isDecidingSet&&matchUpScoringFormat.finalSetFormat||(null==matchUpScoringFormat?void 0:matchUpScoringFormat.setFormat)||{},{side1Score,side2Score}=set,{setTo,tiebreakAt,tiebreakFormat}=setFormat,NoAD=null==tiebreakFormat?void 0:tiebreakFormat.NoAd,leadingSide=getLeadingSide({set}),scoreDiff=Math.abs(side1Score-side2Score),containsSetTo=side1Score>=setTo||side2Score>=setTo,requiresTiebreak=isTiebreakSet||side1Score>=setTo&&side2Score>=setTo||tiebreakAt&&tiebreakAt<setTo&&(side1Score===tiebreakAt||side2Score===tiebreakAt),tiebreakIsValid=ignoreTiebreak||requiresTiebreak&&(1===leadingSide&&set.side1TiebreakScore>set.side2TiebreakScore||2===leadingSide&&set.side2TiebreakScore>set.side1TiebreakScore),winMargin=requiresTiebreak&&(tiebreakAt&&!isTiebreakSet||isTiebreakSet&&NoAD)?1:2,hasWinMargin=scoreDiff>=winMargin;return(containsSetTo&&(hasWinMargin||requiresTiebreak)||isTiebreakSet)&&(!requiresTiebreak||tiebreakIsValid)}({matchUpScoringFormat,isDecidingSet,isTiebreakSet,set:setObject});return setIsComplete&&leadingSide||void 0}function getLeadingSide({set}){if(set.side1Score||set.side2Score){if(set.side1Score>set.side2Score)return 1;if(set.side2Score>set.side1Score)return 2}else if(set.side1TiebreakScore||set.side2TiebreakScore){if(set.side1TiebreakScore>set.side2TiebreakScore)return 1;if(set.side2TiebreakScore>set.side1TiebreakScore)return 2}}function analyzeSet(params){const{setObject,matchUpScoringFormat}=params;if(!setObject)return{error:MISSING_SET_OBJECT};const{setNumber}=setObject||{},{bestOf}=matchUpScoringFormat||{},isDecidingSet=!(!setNumber||!bestOf||setNumber!==bestOf),setFormat=isDecidingSet&&(null==matchUpScoringFormat?void 0:matchUpScoringFormat.finalSetFormat)||(null==matchUpScoringFormat?void 0:matchUpScoringFormat.setFormat),expectTiebreakSet=!!(null==setFormat?void 0:setFormat.tiebreakSet),expectTimedSet=!!(null==setFormat?void 0:setFormat.timed),expectStandardSet=!expectTiebreakSet&&!expectTimedSet,isValidSetNumber=!!(setNumber&&bestOf&&setNumber<=bestOf),sideGameScores=[null==setObject?void 0:setObject.side1Score,null==setObject?void 0:setObject.side2Score],sidePointScores=[null==setObject?void 0:setObject.side1PointScore,null==setObject?void 0:setObject.side2PointScore],sideTiebreakScores=[null==setObject?void 0:setObject.side1TiebreakScore,null==setObject?void 0:setObject.side2TiebreakScore],sideGameScoresCount=sideGameScores.filter((sideScore=>void 0!==sideScore)).length,sidePointScoresCount=sidePointScores.filter((sideScore=>void 0!==sideScore)).length,sideTiebreakScoresCount=sideTiebreakScores.filter((tiebreakScore=>void 0!==tiebreakScore)).length,gameScoresCount=null==sideGameScores?void 0:sideGameScores.filter((s=>!isNaN(s))).length,tiebreakScoresCount=null==sideTiebreakScores?void 0:sideTiebreakScores.filter((s=>!isNaN(s))).length,{tiebreakAt}=setFormat||{},hasTiebreakCondition=tiebreakAt&&2===sideGameScores.filter((gameScore=>gameScore>=tiebreakAt)).length,leadingSide=hasTiebreakCondition&&(sideGameScores[0]>sideGameScores[1]?1:sideGameScores[1]>sideGameScores[0]?2:void 0),isTiebreakSet=!(!tiebreakScoresCount||gameScoresCount),isCompletedSet=!(!setObject||!(null==setObject?void 0:setObject.winningSide)),{error:standardSetError,result:isValidStandardSetOutcome}=function checkValidStandardSetOutcome({setObject,setFormat,sideGameScores,sideTiebreakScores}){if(!setObject)return{result:!1,error:MISSING_SET_OBJECT};const expectTiebreakSet=!!(null==setFormat?void 0:setFormat.tiebreakSet),expectTimedSet=!!(null==setFormat?void 0:setFormat.timed);if(!setFormat||expectTiebreakSet||expectTimedSet)return{result:!1,error:INVALID_VALUES};const validGameScores=2===(null==sideGameScores?void 0:sideGameScores.filter((s=>!isNaN(s))).length);if(!validGameScores)return{result:!1,error:INVALID_GAME_SCORES};const{setTo,tiebreakAt,tiebreakFormat,NoAD}=setFormat||{},meetsSetTo=!(!setTo||!(null==sideGameScores?void 0:sideGameScores.find((gameScore=>gameScore>=setTo))));if(!meetsSetTo)return{result:!1,error:INVALID_GAME_SCORES};const isValidWinningSide=[1,2].includes(null==setObject?void 0:setObject.winningSide);if(!setObject||!isValidWinningSide)return{result:!1,error:INVALID_WINNING_SIDE};const winningSideIndex=(null==setObject?void 0:setObject.winningSide)-1,losingSideIndex=1-winningSideIndex,winningSideGameScore=sideGameScores[winningSideIndex],losingSideGameScore=sideGameScores[losingSideIndex],gamesDifference=winningSideGameScore-losingSideGameScore;if(!(winningSideGameScore>losingSideGameScore))return{result:!1,error:{message:"winningSide game scoreString is not high"}};const setTiebreakDefined=tiebreakAt&&tiebreakFormat,validTiebreakScores=2===(null==sideTiebreakScores?void 0:sideTiebreakScores.filter((s=>!isNaN(s))).length),winningSideTiebreakScore=sideTiebreakScores&&sideTiebreakScores[winningSideIndex],losingSideTiebreakScore=sideTiebreakScores&&sideTiebreakScores[losingSideIndex],hasTiebreakCondition=tiebreakAt&&2===sideGameScores.filter((gameScore=>gameScore>=tiebreakAt)).length;if(setTiebreakDefined){const{NoAD:tiebreakNoAD,tiebreakTo}=tiebreakFormat;if(hasTiebreakCondition){if(gamesDifference>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!validTiebreakScores)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(tiebreakTo))return{result:!1,error:{message:"tiebreakTo error"}};if(!!(!tiebreakTo||!(null==sideTiebreakScores?void 0:sideTiebreakScores.find((tiebreakScore=>tiebreakScore>=tiebreakTo)))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};if(winningSideGameScore>(tiebreakAt<setTo?setTo:setTo+1))return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!winningSideTiebreakScore||!losingSideTiebreakScore||winningSideTiebreakScore<losingSideTiebreakScore)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};const tiebreakDifference=winningSideTiebreakScore-losingSideTiebreakScore;if(tiebreakDifference&&losingSideTiebreakScore>=tiebreakTo-1&&tiebreakDifference<(tiebreakNoAD?1:2))return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(winningSideGameScore>setTo&&(!setTiebreakDefined||!hasTiebreakCondition))return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}const minimumGamesWinMargin=NoAD?1:2,losingSideGameScoreAtSetToThreshold=losingSideGameScore>=setTo-1,invalidWinningScore=gamesDifference&&losingSideGameScoreAtSetToThreshold&&!hasTiebreakCondition&&gamesDifference<minimumGamesWinMargin;if(invalidWinningScore)return{result:!1,error:{message:"invalid winning game scoreString (3)"}};if(gamesDifference>minimumGamesWinMargin&&winningSideGameScore>setTo)return{result:!1,error:{message:"invalid winning game scoreString (4)"}};return{result:!0}}({setObject,setFormat,sideGameScores,sideTiebreakScores}),{error:tiebreakSetError,result:isValidTiebreakSetOutcome}=function checkValidTiebreakSetOutcome({setObject,setFormat,sideTiebreakScores}){if(!setObject)return{result:!1,error:MISSING_SET_OBJECT};const expectTiebreakSet=!!(null==setFormat?void 0:setFormat.tiebreakSet),expectTimedSet=!!(null==setFormat?void 0:setFormat.timed);if(!setFormat||!expectTiebreakSet||expectTimedSet)return{result:!1,error:{message:"not tiebreak set"}};const isValidWinningSide=[1,2].includes(null==setObject?void 0:setObject.winningSide);if(!setObject||!isValidWinningSide)return{result:!1,error:INVALID_WINNING_SIDE};const{tiebreakSet}=setFormat||{},{NoAD,tiebreakTo}=tiebreakSet||{},validTiebreakScores=2===(null==sideTiebreakScores?void 0:sideTiebreakScores.filter((s=>!isNaN(s))).length);if(!validTiebreakScores)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(tiebreakTo))return{result:!1,error:{message:"tiebreakTo error"}};const meetsTiebreakTo=!!(null==sideTiebreakScores?void 0:sideTiebreakScores.find((tiebreakScore=>tiebreakScore>=tiebreakTo)));if(!meetsTiebreakTo)return{result:!1,error:{message:"invalid tiebreak scores (2)"}};const winningSideIndex=(null==setObject?void 0:setObject.winningSide)-1,losingSideIndex=1-winningSideIndex,winningSideTiebreakScore=sideTiebreakScores[winningSideIndex],losingSideTiebreakScore=sideTiebreakScores[losingSideIndex];if(!winningSideTiebreakScore||!losingSideTiebreakScore||winningSideTiebreakScore<losingSideTiebreakScore)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};const minimumTiebreakWinMargin=NoAD?1:2,tiebreakDifference=winningSideTiebreakScore-losingSideTiebreakScore,losingSideGameScoreAtTiebreakToThreshold=losingSideTiebreakScore>=tiebreakTo-1;if(tiebreakDifference&&losingSideGameScoreAtTiebreakToThreshold&&tiebreakDifference<minimumTiebreakWinMargin)return{result:!1,error:{message:"invalid tiebreak scores (3)"}};return{result:!0}}({setObject,setFormat,sideTiebreakScores}),isValidSetOutcome=expectStandardSet&&!isTiebreakSet&&isValidStandardSetOutcome||expectTiebreakSet&&isTiebreakSet&&isValidTiebreakSetOutcome,analysis={expectTiebreakSet,expectTimedSet,hasTiebreakCondition,isCompletedSet,isDecidingSet,isTiebreakSet,isValidSet:isValidSetNumber&&!(expectTiebreakSet&&!isTiebreakSet)&&!(expectStandardSet&&isTiebreakSet)&&(!isCompletedSet||isValidSetOutcome),isValidSetNumber,isValidSetOutcome,leadingSide,setFormat,sideGameScores,sideGameScoresCount,sidePointScores,sidePointScoresCount,sideTiebreakScores,sideTiebreakScoresCount,winningSide:getSetWinningSide({isDecidingSet,isTiebreakSet,matchUpScoringFormat,setObject})};return void 0!==(null==setObject?void 0:setObject.winningSide)&&(isTiebreakSet?(analysis.isValidTiebreakSetOutcome=isValidTiebreakSetOutcome,isValidTiebreakSetOutcome||(analysis.tiebreakSetError=tiebreakSetError)):(analysis.isValidStandardSetOutcome=isValidStandardSetOutcome,isValidStandardSetOutcome||(analysis.standardSetError=standardSetError))),analysis}var __defProp$4p=Object.defineProperty,__getOwnPropSymbols$4q=Object.getOwnPropertySymbols,__hasOwnProp$4q=Object.prototype.hasOwnProperty,__propIsEnum$4q=Object.prototype.propertyIsEnumerable,__defNormalProp$4p=(obj,key,value)=>key in obj?__defProp$4p(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const getSetComplement=params=>{const{isSide1,lowValue,setTo,tiebreakAt,NoAD}=params;if(void 0===lowValue)return{error:MISSING_VALUE};let calculatedValue,valueAsNumber=parseInt(lowValue);(null==valueAsNumber?void 0:valueAsNumber.toString().length)>2&&(valueAsNumber=parseInt(valueAsNumber.toString().slice(0,2))),tiebreakAt&&tiebreakAt<setTo&&valueAsNumber>tiebreakAt&&(valueAsNumber=tiebreakAt),calculatedValue=NoAD&&!tiebreakAt?valueAsNumber<setTo?setTo:setTo-1:valueAsNumber+1<setTo||tiebreakAt&&tiebreakAt<setTo&&valueAsNumber===tiebreakAt?setTo:tiebreakAt?setTo+1:valueAsNumber+2;return[isSide1?valueAsNumber:calculatedValue,isSide1?calculatedValue:valueAsNumber]},getTiebreakComplement=params=>{const{isSide1,lowValue,tiebreakTo,tiebreakNoAd}=params;if(void 0===lowValue)return{error:MISSING_VALUE,info:"missing lowValue"};let valueAsNumber=parseInt(lowValue);(null==valueAsNumber?void 0:valueAsNumber.toString().length)>2&&(valueAsNumber=parseInt(valueAsNumber.toString().slice(0,2))),tiebreakNoAd&&valueAsNumber>tiebreakTo-1&&(valueAsNumber=tiebreakTo-1);const highValue=function getHighTiebreakValue(params){const{lowValue,NoAD,tiebreakTo}=params,winBy=NoAD?1:2;if(lowValue+1>=tiebreakTo)return lowValue+winBy;return tiebreakTo}({lowValue:valueAsNumber,NoAD:tiebreakNoAd,tiebreakTo});return[isSide1?valueAsNumber:highValue,isSide1?highValue:valueAsNumber]};const scoreGovernor={stringifyMatchUpFormat:stringify,isValidMatchUpFormat:isValid,parseMatchUpFormat:parse,generateTieMatchUpScore,getTiebreakComplement,updateTieMatchUpScore:updateTieMatchUpScore$1,generateScoreString,checkSetIsComplete:checkSetIsComplete$1,validateTieFormat,getSetComplement,scoreHasValue,keyValueScore:function keyValueScore(params){let{lowSide=1,value}=params,{scoreString,sets,winningSide,matchUpStatus}=params;const{matchUpFormat,shiftFirst,auto=!0}=params;let updated,info;const isShifted=shiftFirst&&2===lowSide||!shiftFirst&&1===lowSide;if(!VALID_VALUE_KEYS.includes(value))return{updated:!1,info:"invalid key"};shiftFirst&&(lowSide=3-lowSide);const{matchUpWinningSide}=getMatchUpWinner({sets,winningSide,matchUpStatus,matchUpFormat});winningSide=matchUpWinningSide;const analysis=getScoreAnalysis({value,winningSide,scoreString,sets,matchUpFormat});if(ALTERNATE_JOINERS.includes(value)&&(value=SCORE_JOINER),analysis.hasOpener&&analysis.isTiebreakEntry&&!analysis.isTiebreakSet&&isShifted&&0===parseInt(value)&&(analysis.isTiebreakCloser=!0),CLOSERS.includes(value)&&analysis.hasOpener&&(value=""),CLOSERS.includes(value)&&(value=SPACE_KEY),analysis.lastSetIsComplete){const finalCharacter=(null==scoreString?void 0:scoreString.length)&&scoreString[scoreString.length-1];scoreString&&" "!==finalCharacter&&(scoreString+=" ")}if(analysis.isTimedSet)({info,sets,scoreString,updated,matchUpStatus,winningSide}=function keyValueTimedSetScore({analysis,lowSide,scoreString,sets,winningSide,matchUpStatus,info,value}){let updated,outcomeRemoved;(null==sets?void 0:sets.length)||value===BACKSPACE||(sets=[{setNumber:1}]);const setIndex=sets.length-1;if(OUTCOMEKEYS.includes(value)){const lastSet=sets[sets.length-1]||{},{side1Score,side2Score}=lastSet;side1Score&&!side2Score?info="missing side2Score":analysis.finalSetIsComplete||winningSide?info="final set is already complete":analysis.isIncompleteSetScore?info="incomplete set scoreString":analysis.isIncompleteSetScore||({sets,scoreString,winningSide,matchUpStatus,updated}=processOutcome({lowSide,value,sets,scoreString,matchUpStatus,winningSide}))}else if(value===BACKSPACE){if(({scoreString,sets,outcomeRemoved}=removeFromScore({analysis,scoreString,sets})),""===(null==scoreString?void 0:scoreString.trim())&&(scoreString=scoreString.trim()),scoreString||(sets=[]),outcomeRemoved){const lastSet=sets[sets.length-1]||{},{side1Score,side2Score}=lastSet;if(side1Score&&side2Score){const winningSide2=side1Score>side2Score?1:side2Score>side1Score?2:void 0;winningSide2&&(lastSet.winningSide=winningSide2,sets.push({setNumber:sets.length+1}))}}matchUpStatus=void 0,winningSide=void 0,updated=!0}else if(analysis.hasOutcome)info="has outcome";else{if(winningSide)return{sets,scoreString,winningSide,matchUpStatus,updated:!1,info:"matchUp is complete"};if(value===SPACE_KEY){const lastSet=sets[sets.length-1]||{},{side1Score,side2Score}=lastSet,setWinningSide=side1Score>side2Score?1:side2Score>side1Score?2:void 0;!setWinningSide||winningSide||analysis.isIncompleteSetScore||(sets[sets.length-1].winningSide=setWinningSide,sets.push({setNumber:sets.length+1}),scoreString+=" ",updated=!0)}else if(value===SCORE_JOINER&&void 0!==sets[setIndex].side1Score&&void 0===sets[setIndex].side2Score&&scoreString&&analysis.isNumericEnding)scoreString+="-",sets[setIndex].side2Score=0,matchUpStatus=void 0,winningSide=void 0,updated=!0;else if(!isNaN(value)){let currentSetScore;if(void 0===sets[setIndex].side2Score){const newValue=parseInt((sets[setIndex].side1Score||0).toString()+value).toString().slice(0,2);sets[setIndex].side1Score=parseInt(newValue),currentSetScore=sets[setIndex].side1Score.toString(),updated=!0}else{const newValue=parseInt((sets[setIndex].side2Score||0).toString()+value).toString().slice(0,2);sets[setIndex].side2Score=parseInt(newValue),currentSetScore=[sets[setIndex].side1Score,sets[setIndex].side2Score].join("-"),updated=!0}if(updated){const priorSetScores=(sets.slice(0,setIndex)||[]).filter((set=>set)).map((set=>{const{side1Score,side2Score}=set;return[side1Score,side2Score].join("-")})).join(" ");scoreString=priorSetScores?priorSetScores+" "+currentSetScore:currentSetScore}}}return{sets,scoreString,winningSide,matchUpStatus,info,updated}}({analysis,lowSide,scoreString,sets,matchUpStatus,winningSide,value}));else if(OUTCOMEKEYS.includes(value))analysis.finalSetIsComplete||winningSide?info="final set is already complete":analysis.isTiebreakEntry||analysis.isIncompleteSetScore?analysis.isTiebreakEntry||analysis.isIncompleteSetScore?info="incomplete set scoreString or tiebreak entry":console.log("handle case",{value}):({sets,scoreString,matchUpStatus,winningSide,updated}=processOutcome({lowSide,sets,scoreString,matchUpStatus,winningSide,value}));else if(value===BACKSPACE)updated=!0,({scoreString,sets}=removeFromScore({analysis,scoreString,sets,lowSide,auto})),scoreString||(sets=[]),matchUpStatus=void 0,winningSide=void 0;else if(analysis.hasOutcome)info="has outcome";else if(value!==SCORE_JOINER||analysis.isMatchTiebreakEntry)if(value===MATCH_TIEBREAK_JOINER&&analysis.isMatchTiebreakEntry&&!analysis.isSetTiebreakEntry)analysis.matchTiebreakHasJoiner?info="existing joiner":analysis.isNumericEnding&&(updated=!0,scoreString+=MATCH_TIEBREAK_JOINER);else if([SCORE_JOINER,MATCH_TIEBREAK_JOINER].includes(value))info="invalid location for joiner";else{if(winningSide)return{updated:!1,info:"matchUp is complete"};if(analysis.isIncompleteSetScore)analysis.isNumericValue&&({sets,scoreString,updated}=function processIncompleteSetScore({analysis,scoreString,sets,value}){let updated;if(!(null==sets?void 0:sets.length))return{sets:[]};const set=sets[sets.length-1];value=parseInt(value);const{validSide2Score,requiresTiebreak}=function checkValidSide2Score({analysis,set={},value}){const setFormat=analysis.isDecidingSet&&analysis.matchUpScoringFormat.finalSetFormat||analysis.matchUpScoringFormat.setFormat,{tiebreakAt,setTo,NoAD}=setFormat,{side1Score}=set;let validSide2Score,requiresTiebreak;return validSide2Score=tiebreakAt&&tiebreakAt<setTo?side1Score===tiebreakAt?value<=setTo:value<=tiebreakAt:side1Score===setTo?NoAD?value<setTo:value<=setTo+1:side1Score===setTo-1?NoAD?value<=setTo:value<=setTo+1:side1Score===setTo+1?value===setTo||value===setTo-1:value<=setTo,validSide2Score&&(requiresTiebreak=tiebreakAt&&tiebreakAt<setTo?side1Score===setTo&&value===tiebreakAt||side1Score===tiebreakAt&&value===setTo:side1Score>=setTo&&value>=setTo&&side1Score!==value),{validSide2Score,requiresTiebreak}}({analysis,set,value});if(validSide2Score){updated=!0,scoreString=(scoreString||"")+value,set.side2Score=value;const winningSide=getWinningSide$1({analysis,set:sets[sets.length-1]});set.winningSide=winningSide||void 0,requiresTiebreak?scoreString+=SET_TIEBREAK_BRACKETS.split("")[0]:analysis.isDecidingSet||(scoreString+=SPACE_CHARACTER)}return{sets,scoreString,updated}}({analysis,scoreString,sets,value}));else if(analysis.isInvalidMatchTiebreakValue)info="invalid matchUp tiebreak character";else if(analysis.isInvalidSetTiebreakValue)info="invalid set tiebreak character";else if(analysis.isTiebreakCloser){const brackets=analysis.isSetTiebreakEntry?SET_TIEBREAK_BRACKETS:MATCH_TIEBREAK_BRACKETS,close=brackets.split("").reverse()[0],open=brackets.split("")[0],set=sets[sets.length-1],{tiebreakFormat}=analysis.setFormat,{tiebreakTo,NoAD}=tiebreakFormat||{},leadingSide=getLeadingSide$1({set});if(!analysis.isTiebreakSet){const lowTiebreakScore=parseInt(scoreString.split(open).reverse()[0]),highTiebreakScore=getHighTiebreakValue$1({lowValue:lowTiebreakScore,tiebreakTo,NoAD});1===leadingSide?(set.side1TiebreakScore=highTiebreakScore,set.side2TiebreakScore=lowTiebreakScore):(set.side1TiebreakScore=lowTiebreakScore,set.side2TiebreakScore=highTiebreakScore)}scoreString=(scoreString||"")+close,analysis.isDecidingSet||(scoreString+=SPACE_CHARACTER);const winningSide2=getWinningSide$1({analysis,set});set.winningSide=winningSide2||void 0,updated=!0}else if(analysis.isTiebreakSetValue)({info,scoreString,sets,updated}=function processTiebreakSet({analysis,auto,lowSide,scoreString="",sets,value}){var _a;let updated,info;const{tiebreakSet:{tiebreakTo,NoAD}}=analysis.setFormat,[open]=MATCH_TIEBREAK_BRACKETS.split("");if(analysis.isMatchTiebreakEntry||(scoreString+=open),sets[analysis.setNumber-1]){const{lastOpenBracketIndex}=testTiebreakEntry({scoreString,brackets:MATCH_TIEBREAK_BRACKETS}),matchTiebreakScores=(scoreString.slice(lastOpenBracketIndex+1)+(auto?"":value)).split(MATCH_TIEBREAK_JOINER);if(((null==(_a=matchTiebreakScores[lowSide-1])?void 0:_a.length)||0)>=2)info="tiebreak digit limit";else if(auto){1===lowSide&&(matchTiebreakScores[0]=(matchTiebreakScores[0]||"")+value),2===lowSide&&(matchTiebreakScores[1]=(matchTiebreakScores[1]||"")+value);const setScores=[matchTiebreakScores[0]||0,matchTiebreakScores[1]||0].map((s=>parseInt(s))),highIndex=1===lowSide?1:0;setScores[highIndex]=setScores[1-highIndex]+(NoAD?1:2),setScores[highIndex]<tiebreakTo&&(setScores[highIndex]=tiebreakTo);const lastSet=sets[sets.length-1];lastSet.side1TiebreakScore=setScores[0],lastSet.side2TiebreakScore=setScores[1],scoreString=scoreString.slice(0,lastOpenBracketIndex+1),scoreString+=setScores.join(MATCH_TIEBREAK_JOINER),updated=!0}else{const setScores=[matchTiebreakScores[0]||0,matchTiebreakScores[1]||0].map((s=>parseInt(s))),lastSet=sets[sets.length-1];lastSet.side1TiebreakScore=setScores[0],lastSet.side2TiebreakScore=setScores[1],scoreString+=value,updated=!0}}else{const highValue=getHighTiebreakValue$1({lowValue:parseInt(value||0),tiebreakTo,NoAD}),setScores=[parseInt(value),highValue];2===lowSide&&setScores.reverse();const set={side1TiebreakScore:setScores[0],side2TiebreakScore:setScores[1],setNumber:(null==sets?void 0:sets.length)+1||1};sets.push(set),scoreString+=setScores.join(MATCH_TIEBREAK_JOINER),updated=!0}return{info,scoreString,sets,updated}}({analysis,auto,lowSide,scoreString,sets,value}));else if(analysis.isSetTiebreakEntry){const[open]=SET_TIEBREAK_BRACKETS.split(""),lastOpenBracketIndex=Math.max(...arrayIndices(open,scoreString.split(""))),tiebreakValue=scoreString.slice(lastOpenBracketIndex+1),hasZeroStart=tiebreakValue&&0===parseInt(tiebreakValue),newTiebreakValue=parseInt(tiebreakValue?tiebreakValue+value:value),{tiebreakFormat}=analysis.setFormat,{tiebreakTo,NoAD}=tiebreakFormat||{};!hasZeroStart&&tiebreakValue.length<2?NoAD&&newTiebreakValue>tiebreakTo-1?info="invalid low value for NoAD tiebreak":(updated=!0,scoreString=(scoreString||"")+value):info=hasZeroStart?"tiebreak begins with zero":"tiebreak digit limit"}else if(analysis.isCloser)info=`invalid key: ${value}`;else if(analysis.isGameScoreEntry)info="game scoreString entry";else if(analysis.lastSetIsComplete||!sets.length){updated=!0;const{scoreString:newScore,set}=function keyValueSetScore({analysis,lowSide,scoreString,value}){const{setTo,tiebreakAt,NoAD}=(null==analysis?void 0:analysis.setFormat)||{},needsTiebreak=value===parseInt(tiebreakAt||setTo);if(tiebreakAt&&tiebreakAt<setTo&&value>tiebreakAt)return{scoreString};if(NoAD&&value===setTo||value>setTo)return{scoreString};const highValue=function getHighSetValue(){return needsTiebreak?value+1:value+1===setTo?value+(NoAD?1:2):setTo}(),setScores=[value,highValue];2===lowSide&&setScores.reverse();const open=SET_TIEBREAK_BRACKETS.split("")[0];scoreString=(scoreString||"")+(setScores.join(SCORE_JOINER)+(needsTiebreak?open:SPACE_CHARACTER));const set={side1Score:setScores[0],side2Score:setScores[1]},winningSide=getWinningSide$1({analysis,set});return set.winningSide=winningSide||void 0,{scoreString,set}}({analysis,lowSide,scoreString,value:parseInt(value)});set&&(set.setNumber=(null==sets?void 0:sets.length)+1||1),sets=(null==sets?void 0:sets.concat(set).filter(Boolean))||[set],scoreString=newScore||void 0}else console.log("error: unknown outcome")}else(!analysis.isSetTiebreakEntry||analysis.isSetTiebreakEntry&&!analysis.isNumericEnding)&&(updated=!0,({scoreString,sets}=removeFromScore({analysis,scoreString,sets,lowSide,auto})),matchUpStatus=void 0);if(updated){sets=null==sets?void 0:sets.filter(Boolean);const{matchUpWinningSide:matchUpWinningSide2}=getMatchUpWinner({sets,winningSide,matchUpStatus,matchUpFormat});return winningSide=matchUpWinningSide2,!matchUpWinningSide2||matchUpStatus&&![TO_BE_PLAYED,INCOMPLETE].includes(matchUpStatus)?!scoreString||winningSide||[STATUS_SUSPENDED,STATUS_ABANDONED,STATUS_INTERRUPTED].includes(matchUpStatus)||(matchUpStatus=void 0):(matchUpStatus="COMPLETED",sets=sets.filter((set=>{const{side1Score,side2Score,side1TiebreakScore,side2TiebreakScore}=set;return side1Score||side2Score||side1TiebreakScore||side2TiebreakScore}))),{updated,scoreString,sets,winningSide,matchUpStatus,info}}return{updated,scoreString,sets,winningSide,matchUpStatus,info}},validateScore,reverseScore:function reverseScore({score}={}){if(!score)return{error:MISSING_VALUE};const{sets}=score,reversedSets=sets.map((set=>{const{side1TiebreakScore,side2TiebreakScore,winningSide,side1Score,side2Score,setNumber}=set;return definedAttributes({winningSide:winningSide?3-winningSide:void 0,side1TiebreakScore:side2TiebreakScore,side2TiebreakScore:side1TiebreakScore,side1Score:side2Score,side2Score:side1Score,setNumber})}));return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4q.call(b,prop)&&__defNormalProp$4p(a,prop,b[prop]);if(__getOwnPropSymbols$4q)for(var prop of __getOwnPropSymbols$4q(b))__propIsEnum$4q.call(b,prop)&&__defNormalProp$4p(a,prop,b[prop]);return a})({reversedScore:{sets:reversedSets,scoreStringSide1:generateScoreString({sets:reversedSets}),scoreStringSide2:generateScoreString({sets:reversedSets,reversed:!0})}},SUCCESS)},analyzeSet};function countryToFlag(isoCode){return isoCode&&void 0!==String.fromCodePoint?isoCode.toUpperCase().replace(/./g,(char=>String.fromCodePoint(char.charCodeAt(0)+127397))):isoCode}const countries=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];var DOMINANT_DUO_TIE_FORMAT={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},DOMINANT_DUO_MIXED_TIE_FORMAT={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},LAVER_CUP_TIE_FORMAT={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},TEAM_AGGREGATION_TIE_FORMAT={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},USTA_BREWER_CUP_TIE_FORMAT={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},USTA_OZAKI_CUP_TIE_FORMAT={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},USTA_COLLEGE_TIE_FORMAT={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},USTA_GOLD_TEAM_CHALLENGE_FORMAT={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:2,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:2,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:4,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},USTA_INTERSECTIONAL_TIE_FORMAT={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},USTA_LEVEL_1_TIE_FORMAT={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},USTA_SECTION_BATTLE_TIE_FORMAT={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},USTA_SOUTHERN_LEVEL_5_TIE_FORMAT={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},USTA_TOC_TIE_FORMAT={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},USTA_WTT_ITT_TIE_FORMAT={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},USTA_ZONAL_TIE_FORMAT={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}};const tieFormats={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:DOMINANT_DUO_TIE_FORMAT,DOMINANT_DUO_MIXED:DOMINANT_DUO_MIXED_TIE_FORMAT,LAVER_CUP:LAVER_CUP_TIE_FORMAT,TEAM_DOUBLES_3_AGGREGATION:TEAM_AGGREGATION_TIE_FORMAT,USTA_BREWER_CUP:USTA_BREWER_CUP_TIE_FORMAT,USTA_OZAKI_CUP:USTA_OZAKI_CUP_TIE_FORMAT,USTA_COLLEGE:USTA_COLLEGE_TIE_FORMAT,USTA_GOLD_TEAM_CHALLENGE:USTA_GOLD_TEAM_CHALLENGE_FORMAT,USTA_INTERSECTIONAL:USTA_INTERSECTIONAL_TIE_FORMAT,USTA_LEVEL_1:USTA_LEVEL_1_TIE_FORMAT,USTA_SECTION_BATTLE:USTA_SECTION_BATTLE_TIE_FORMAT,USTA_SOUTHERN_LEVEL_5:USTA_SOUTHERN_LEVEL_5_TIE_FORMAT,USTA_TOC:USTA_TOC_TIE_FORMAT,USTA_WTT_ITT:USTA_WTT_ITT_TIE_FORMAT,USTA_ZONAL:USTA_ZONAL_TIE_FORMAT},QUALIFYING_PARTICIPANT_METHOD="qualifierDrawPositionAssignment",WITHDRAW_PARTICIPANT_METHOD="withdrawParticipantAtDrawPosition",ALTERNATE_PARTICIPANT_METHOD="alternateDrawPositionAssignment",LUCKY_PARTICIPANT_METHOD="luckyLoserDrawPositionAssignment",REMOVE_ASSIGNMENT_METHOD="removeDrawPositionAssignment",SWAP_PARTICIPANT_METHOD="swapDrawPositionAssignments",MODIFY_PAIR_ASSIGNMENT_METHOD="modifyPairAssignment",ADD_NICKNAME_METHOD="modifyParticipantOtherName",ASSIGN_SIDE_METHOD="assignMatchUpSideParticipant",ASSIGN_PARTICIPANT_METHOD="assignDrawPosition",REMOVE_SEED_METHOD="removeSeededParticipant",ASSIGN_BYE_METHOD="assignDrawPositionBye",SEED_VALUE_METHOD="modifySeedAssignment",ADD_PENALTY_METHOD="addPenalty",MODIFY_PAIR_ASSIGNMENT="MODIFY_PAIR",QUALIFYING_PARTICIPANT="QUALIFIER",ALTERNATE_PARTICIPANT="ALTERNATE",WITHDRAW_PARTICIPANT="WITHDRAW",ASSIGN_PARTICIPANT="ASSIGN",REMOVE_ASSIGNMENT="REMOVE",LUCKY_PARTICIPANT="LUCKY",REMOVE_SEED="REMOVE_SEED",SWAP_PARTICIPANTS="SWAP",ADD_NICKNAME="NICKNAME",SEED_VALUE="SEED_VALUE",ADD_PENALTY="PENALTY",ASSIGN_BYE="BYE",POLICY_POSITION_ACTIONS_DEFAULT={[POLICY_TYPE_POSITION_ACTIONS]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[QUALIFYING,MAIN],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[ADD_NICKNAME,ADD_PENALTY,QUALIFYING_PARTICIPANT,SEED_VALUE],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},POLICY_SEEDING_USTA={[POLICY_TYPE_SEEDING]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:"SEPARATE",policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},fixtures={matchUpFormats,countryToFlag,tieFormats,countries,policies:{POLICY_AVOIDANCE_COUNTRY:{avoidance:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},POLICY_POSITION_ACTIONS_DEFAULT,POLICY_POSITION_ACTIONS_DISABLED:{[POLICY_TYPE_POSITION_ACTIONS]:{policyName:"positionActionsDisabled",enabledStructures:!1}},POLICY_POSITION_ACTIONS_NO_MOVEMENT:{[POLICY_TYPE_POSITION_ACTIONS]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[SEED_VALUE,ADD_NICKNAME,ADD_PENALTY],disabledActions:[]}]}},POLICY_POSITION_ACTIONS_UNRESTRICTED:{[POLICY_TYPE_POSITION_ACTIONS]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[SEED_VALUE,REMOVE_SEED]}},POLICY_PRIVACY_DEFAULT:{[POLICY_TYPE_PARTICIPANT]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},POLICY_ROUND_NAMING_DEFAULT,POLICY_SCHEDULING_USTA:{[POLICY_TYPE_SCHEDULING]:{defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[DOUBLES$1]:30,default:60}}]},defaultDailyLimits:{[SINGLES$1]:2,[DOUBLES$1]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:["SET3-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:["WHEELCHAIR"],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:["ADULT","WHEELCHAIR"],minutes:{default:60,[DOUBLES$1]:30}},{categoryTypes:["JUNIOR"],minutes:{default:60,[DOUBLES$1]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:["ADULT","WHEELCHAIR"],minutes:{default:30}},{categoryTypes:["JUNIOR"],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:["ADULT","JUNIOR"],minutes:{default:30}},{categoryTypes:["WHEELCHAIR"],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},POLICY_SCORING_DEFAULT:{[POLICY_TYPE_SCORING]:{defaultMatchUpFormat:"SET3-S:6/TB7",requireAllPositionsAssigned:!1,stage:{[MAIN]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}}}},POLICY_SCORING_USTA:{[POLICY_TYPE_SCORING]:{requireAllPositionsAssigned:!1,stage:{[MAIN]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:"SET3-S:6/TB7",matchUpFormats:[{categoryNames:[],categoryTypes:[],description:"Best of 3 tiebreak sets",matchUpFormat:"SET3-S:6/TB7"},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}]}},POLICY_SEEDING_ITF:{[POLICY_TYPE_SEEDING]:{seedingProfile:{positioning:CLUSTER},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},POLICY_SEEDING_USTA},flagIOC:function flagIOC(ioc){return countryToFlag(Object.assign({},...countries.filter((c=>c.ioc)).map((c=>({[c.ioc]:c.iso}))))[ioc])}};function calculateWinCriteria({collectionDefinitions=[],collectionGroups=[]}={}){let valueTotal=0;const{groupValueNumbers}=getGroupValueGroups({collectionGroups});let aggregateValueImperative;for(const collectionDefinition of collectionDefinitions||[]){const{collectionValueProfiles,collectionGroupNumber,collectionValue,matchUpCount,matchUpValue,scoreValue,setValue}=collectionDefinition,belongsToValueGroup=collectionGroupNumber&&groupValueNumbers.includes(collectionGroupNumber);if(setValue||scoreValue)aggregateValueImperative=!0;else{if(belongsToValueGroup)continue;if(collectionValue)valueTotal+=collectionValue;else if(null==collectionValueProfiles?void 0:collectionValueProfiles.length)for(const collectionValueProfile of collectionValueProfiles)valueTotal+=collectionValueProfile.matchUpValue;else valueTotal+=matchUpValue?matchUpCount*matchUpValue:matchUpCount}}for(const collectionGroup of collectionGroups)valueTotal+=collectionGroup.groupValue||0;if(aggregateValueImperative||!valueTotal)return{aggregateValue:!0};return{valueGoal:Math.floor(valueTotal/2)+1}}function addFinishingRounds({finishingPositionOffset=0,finishingPositionLimit,positionsFed,roundsCount,roundLimit,matchUps,lucky,fmlc}){var _a;if(!Array.isArray(matchUps))return{error:MISSING_MATCHUPS};const{roundProfile,roundNumbers}=getRoundMatchUps$1({interpolate:!0,matchUps});roundsCount=roundsCount||Math.max(...roundNumbers);const finishingRoundOffset=roundLimit?roundsCount-roundLimit:0,minQualifyingPosition=finishingRoundOffset&&(null==(_a=roundProfile[roundsCount-finishingRoundOffset])?void 0:_a.matchUpsCount),roundMatchUpsCountArray=Object.values(roundProfile).map((({matchUpsCount})=>matchUpsCount)),finishingRange=(positionRange,winner)=>{let minFinishingPosition=Math.min(...positionRange);minQualifyingPosition&&winner&&1===minFinishingPosition&&(minFinishingPosition=minQualifyingPosition);let maxFinishingPosition=Math.max(...positionRange);return maxFinishingPosition>finishingPositionLimit&&(maxFinishingPosition=finishingPositionLimit),[minFinishingPosition,maxFinishingPosition]},roundFinishingData=Object.assign({},...roundNumbers.map((roundNumber=>{const finishingRound=roundsCount+1-roundNumber-finishingRoundOffset,matchUpsCount=roundProfile[roundNumber].matchUpsCount,finishingData={finishingRound},upcomingMatchUps=roundMatchUpsCountArray.slice(roundNumber-1).reduce(((a,b)=>a+b),0),rangeOffset=1+finishingPositionOffset+(fmlc&&1!==roundNumber?positionsFed:0),positionRange=generateRange(rangeOffset,lucky?rangeOffset+2*matchUpsCount:upcomingMatchUps+rangeOffset+1),slicer=upcomingMatchUps+1-matchUpsCount,loser=finishingRange(positionRange.slice(slicer)),winner=finishingRange(positionRange.slice(0,slicer),!0);return finishingData.finishingPositionRange={loser,winner},{[roundNumber]:finishingData}}))),devContext=getDevContext({finishingRound:!0});return matchUps.filter(Boolean).forEach((matchUp=>{const roundData=roundFinishingData[matchUp.roundNumber];devContext&&!roundData&&console.log({roundFinishingData,matchUp}),matchUp.finishingRound=null==roundData?void 0:roundData.finishingRound,matchUp.finishingPositionRange=null==roundData?void 0:roundData.finishingPositionRange})),matchUps}function addGoesTo({inContextDrawMatchUps,drawDefinition,matchUpsMap}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const goesToMap={loserMatchUpIds:{},winnerMatchUpIds:[]};inContextDrawMatchUps||({matchUps:inContextDrawMatchUps,matchUpsMap}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap}));return matchUpsMap.drawMatchUps.some((m=>m.finishingPositionRange))||1!==drawDefinition.structures.length||drawDefinition.structures[0].structures||addFinishingRounds({matchUps:matchUpsMap.drawMatchUps}),(inContextDrawMatchUps||[]).filter((({collectionId})=>!collectionId)).forEach((inContextMatchUp=>{const{matchUpId,structureId}=inContextMatchUp,targetData=positionTargets({inContextDrawMatchUps,drawDefinition,matchUpId}),{winnerMatchUp,loserMatchUp}=targetData.targetMatchUps,winnerMatchUpId=null==winnerMatchUp?void 0:winnerMatchUp.matchUpId,loserMatchUpId=null==loserMatchUp?void 0:loserMatchUp.matchUpId,matchUp=getMappedStructureMatchUps({matchUpsMap,structureId}).find((matchUp2=>matchUp2.matchUpId===matchUpId));if(matchUp&&(winnerMatchUpId&&(goesToMap.winnerMatchUpIds[matchUp.matchUpId]=winnerMatchUpId,Object.assign(matchUp,{winnerMatchUpId}),Object.assign(inContextMatchUp,{winnerMatchUpId})),loserMatchUpId&&(goesToMap.loserMatchUpIds[matchUp.matchUpId]=loserMatchUpId,inContextMatchUp.loserMatchUpId=loserMatchUpId,matchUp.loserMatchUpId=loserMatchUpId,inContextMatchUp.finishingPositionRange))){const loserRange=loserMatchUp.finishingPositionRange&&[...inContextMatchUp.finishingPositionRange.loser,...loserMatchUp.finishingPositionRange.loser],loser=loserRange&&[Math.min(...loserRange),Math.max(...loserRange)];inContextMatchUp.finishingPositionRange.loser=loser,matchUp.finishingPositionRange.loser=loser}})),{inContextDrawMatchUps,goesToMap}}function addNationalityCode({participant,withISO2,withIOC}){const{person,individualParticipants}=participant;[person,null==individualParticipants?void 0:individualParticipants.map((({person:person2})=>person2))].flat().filter(Boolean).forEach((function annotatePerson(person2){const{nationalityCode}=person2||{};if(nationalityCode){const country=countries.find((({iso})=>iso===nationalityCode));withIOC&&(null==country?void 0:country.ioc)&&!person2.iocNationalityCode&&(person2.iocNationalityCode=country.ioc),withISO2&&(null==country?void 0:country.iso2)&&!person2.iso2NationalityCode&&(person2.iso2NationalityCode=country.iso2),(null==country?void 0:country.label)&&!person2.countryName&&(person2.countryName=country.label)}}))}var __defProp$4o=Object.defineProperty,__getOwnPropSymbols$4p=Object.getOwnPropertySymbols,__hasOwnProp$4p=Object.prototype.hasOwnProperty,__propIsEnum$4p=Object.prototype.propertyIsEnumerable,__defNormalProp$4o=(obj,key,value)=>key in obj?__defProp$4o(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4o=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4p.call(b,prop)&&__defNormalProp$4o(a,prop,b[prop]);if(__getOwnPropSymbols$4p)for(var prop of __getOwnPropSymbols$4p(b))__propIsEnum$4p.call(b,prop)&&__defNormalProp$4o(a,prop,b[prop]);return a};function getTimeItem({returnPreviousValues,itemSubTypes,itemType,element}){if(!element)return{error:MISSING_VALUE,info:ELEMENT_REQUIRED};if(itemSubTypes&&!Array.isArray(itemSubTypes))return{error:INVALID_VALUES,context:{itemSubTypes}};if(!Array.isArray(element.timeItems))return{error:MISSING_TIME_ITEMS};const filteredSorted=element.timeItems.filter((timeItem2=>(null==timeItem2?void 0:timeItem2.itemType)===itemType)).filter((timeItem2=>!(null==itemSubTypes?void 0:itemSubTypes.length)||itemSubTypes.some((subType=>{var _a;return null==(_a=null==timeItem2?void 0:timeItem2.itemSubTypes)?void 0:_a.includes(subType)})))).sort(((a,b)=>new Date(a.createdAt||void 0)-new Date(b.createdAt||void 0))),timeItem=filteredSorted.pop();if(timeItem){const result=__spreadValues$4o({timeItem},SUCCESS);return returnPreviousValues&&Object.assign(result,{previousItems:filteredSorted}),result}return{info:NOT_FOUND}}function getEventTimeItem({returnPreviousValues,itemSubTypes,itemType,event}){if(!event)return{error:MISSING_EVENT};if(!event.timeItems)return{info:NOT_FOUND};const{timeItem,previousItems,info}=getTimeItem({returnPreviousValues,element:event,itemSubTypes,itemType});return timeItem&&{timeItem,previousItems}||{info}}function getTournamentTimeItem({returnPreviousValues,tournamentRecord,itemSubTypes,itemType}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!tournamentRecord.timeItems)return{info:NOT_FOUND};const{timeItem,previousItems,info}=getTimeItem({element:tournamentRecord,returnPreviousValues,itemSubTypes,itemType});return timeItem&&{timeItem,previousItems}||{info}}var __defProp$4n=Object.defineProperty,__getOwnPropSymbols$4o=Object.getOwnPropertySymbols,__hasOwnProp$4o=Object.prototype.hasOwnProperty,__propIsEnum$4o=Object.prototype.propertyIsEnumerable,__defNormalProp$4n=(obj,key,value)=>key in obj?__defProp$4n(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4n=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4o.call(b,prop)&&__defNormalProp$4n(a,prop,b[prop]);if(__getOwnPropSymbols$4o)for(var prop of __getOwnPropSymbols$4o(b))__propIsEnum$4o.call(b,prop)&&__defNormalProp$4n(a,prop,b[prop]);return a};const typeMap={[GROUP]:"groupParticipantIds",[PAIR]:"pairParticipantIds",[TEAM]:"teamParticipantIds"},membershipMap={[GROUP]:"groups",[TEAM]:"teams"};function getParticipantMap({withIndividualParticipants,convertExtensions,policyDefinitions,tournamentRecord,withSignInStatus,withScaleValues,internalUse,withISO2,withIOC}){const participantAttributes=null==policyDefinitions?void 0:policyDefinitions[POLICY_TYPE_PARTICIPANT],filterAttributes=null==participantAttributes?void 0:participantAttributes.participant,participantMap={};for(const participant of tournamentRecord.participants||[]){const participantCopy=makeDeepCopy(participant,convertExtensions,internalUse),filteredParticipant=filterAttributes?attributeFilter({template:participantAttributes.participant,source:participantCopy}):participantCopy,{participantId,individualParticipantIds,participantType}=filteredParticipant;if(initializeParticipantId({participantMap,participantId}),Object.assign(participantMap[participantId].participant,filteredParticipant),individualParticipantIds&&processIndividualParticipantIds({individualParticipantIds,filteredParticipant,participantMap,participantType,participantId}),withSignInStatus&&(participantMap[participantId].participant.signedIn=signedIn(participantCopy)),withScaleValues){const{ratings,rankings,seedings}=getScaleValues({participant:participantCopy});participantMap[participantId].participant.seedings=seedings,participantMap[participantId].participant.rankings=rankings,participantMap[participantId].participant.ratings=ratings}(withIOC||withISO2)&&addNationalityCode({participant:participantMap[participantId].participant,withISO2,withIOC})}return withIndividualParticipants&&function addIndividualParticipants({participantMap}){var _a;for(const{participant}of Object.values(participantMap))if(null==(_a=participant.individualParticipantIds)?void 0:_a.length){participant.individualParticipants=[];for(const participantId of participant.individualParticipantIds)participant.individualParticipants.push(participantMap[participantId].participant)}}({participantMap}),{participantMap}}function signedIn(participant){const{timeItem}=getTimeItem({itemType:SIGN_IN_STATUS,element:participant});return(null==timeItem?void 0:timeItem.itemValue)===SIGNED_IN}function processIndividualParticipantIds({individualParticipantIds,filteredParticipant,participantMap,participantType,participantId}){for(const individualParticipantId of individualParticipantIds){initializeParticipantId({participantId:individualParticipantId,participantMap});const individualParticipant=participantMap[individualParticipantId].participant;if(individualParticipant[typeMap[participantType]].push(participantId),[TEAM,GROUP].includes(participantType)){const{participantRoleResponsibilities,participantOtherName,participantName,participantId:participantId2,teamId}=filteredParticipant;individualParticipant[membershipMap[participantType]].push({participantRoleResponsibilities,participantOtherName,participantName,participantId:participantId2,teamId})}if(participantType===PAIR){const partnerParticipantId=individualParticipantIds.find((id=>id!==individualParticipantId));participantMap[individualParticipantId].pairIdMap[participantId]=partnerParticipantId,participantMap[individualParticipantId].pairIdMap[partnerParticipantId]=participantId}}}function initializeParticipantId({participantMap,participantId}){if(participantMap[participantId])return;const counters={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};participantMap[participantId]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:[],scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:__spreadValues$4n({[SINGLES$1]:__spreadValues$4n({},counters),[DOUBLES$1]:__spreadValues$4n({},counters),[TEAM]:__spreadValues$4n({},counters)},counters)}}var __defProp$4m=Object.defineProperty,__defProps$2v=Object.defineProperties,__getOwnPropDescs$2v=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4n=Object.getOwnPropertySymbols,__hasOwnProp$4n=Object.prototype.hasOwnProperty,__propIsEnum$4n=Object.prototype.propertyIsEnumerable,__defNormalProp$4m=(obj,key,value)=>key in obj?__defProp$4m(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4m=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4n.call(b,prop)&&__defNormalProp$4m(a,prop,b[prop]);if(__getOwnPropSymbols$4n)for(var prop of __getOwnPropSymbols$4n(b))__propIsEnum$4n.call(b,prop)&&__defNormalProp$4m(a,prop,b[prop]);return a},__spreadProps$2v=(a,b)=>__defProps$2v(a,__getOwnPropDescs$2v(b));function allTournamentMatchUps({scheduleVisibilityFilters,participantsProfile,afterRecoveryTimes,useParticipantMap,policyDefinitions,tournamentRecord,inContext=!0,contextProfile,matchUpFilters,contextFilters,participantMap,nextMatchUps,participants,context}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const tournamentId=(null==(_a=tournamentRecord.unifiedTournamentId)?void 0:_a.tournamentId)||tournamentRecord.tournamentId,events=(null==tournamentRecord?void 0:tournamentRecord.events)||[];participants||({participants,participantMap}=getParticipants$2({participantsProfile,policyDefinitions,useParticipantMap,tournamentRecord,contextProfile,inContext}));const{appliedPolicies:tournamentAppliedPolicies}=getAppliedPolicies({tournamentRecord}),additionalContext=__spreadProps$2v(__spreadValues$4m({},context),{tournamentId,indoorOutDoor:tournamentRecord.indoorOutDoor,surfaceCategory:tournamentRecord.surfaceCategory,endDate:tournamentRecord.endDate}),contextContent=getContextContent({policyDefinitions,tournamentRecord,contextProfile});return{matchUps:events.map((event=>{var _a2;return additionalContext.eventDrawsCount=(null==(_a2=event.drawDefinitions)?void 0:_a2.length)||0,allEventMatchUps({context:additionalContext,scheduleVisibilityFilters,tournamentAppliedPolicies,participantsProfile,afterRecoveryTimes,policyDefinitions,tournamentRecord,contextContent,contextFilters,contextProfile,matchUpFilters,participantMap,nextMatchUps,participants,inContext,event}).matchUps})).flat(1/0).concat(...tournamentRecord.matchUps||[])}}function allDrawMatchUps$1({participants:tournamentParticipants,scheduleVisibilityFilters,tournamentAppliedPolicies,participantsProfile,afterRecoveryTimes,policyDefinitions,useParticipantMap,tournamentRecord,contextContent,contextFilters,contextProfile,drawDefinition,matchUpFilters,participantMap,nextMatchUps,inContext,context,event}){const{eventId,eventName,eventType,category,gender,matchUpFormat}=event||{},additionalContext=__spreadProps$2v(__spreadValues$4m({},context),{eventId,eventType,eventName,category,gender,matchUpFormat,indoorOutDoor:(null==event?void 0:event.indoorOutDoor)||(null==tournamentRecord?void 0:tournamentRecord.indoorOutDoor),surfaceCategory:(null==event?void 0:event.surfaceCategory)||(null==tournamentRecord?void 0:tournamentRecord.surfaceCategory),endDate:null==event?void 0:event.endDate});return(null==tournamentParticipants?void 0:tournamentParticipants.length)||participantMap||!tournamentRecord||({participants:tournamentParticipants=[],participantMap}=getParticipants$2({participantsProfile,policyDefinitions,useParticipantMap,tournamentRecord,contextProfile,inContext})),contextProfile&&!contextContent&&(contextContent=getContextContent({policyDefinitions,tournamentRecord,contextProfile,drawDefinition,event})),getAllDrawMatchUps({context:additionalContext,tournamentAppliedPolicies,scheduleVisibilityFilters,tournamentParticipants,participantsProfile,afterRecoveryTimes,policyDefinitions,tournamentRecord,drawDefinition,contextContent,contextFilters,contextProfile,matchUpFilters,participantMap,nextMatchUps,inContext,event})}function allEventMatchUps({scheduleVisibilityFilters,tournamentAppliedPolicies,participantsProfile,afterRecoveryTimes,policyDefinitions,participants=[],useParticipantMap,tournamentRecord,contextContent,contextFilters,contextProfile,matchUpFilters,participantMap,nextMatchUps,inContext,context,event}){if(!event)return{error:MISSING_EVENT};const{eventId,eventName,endDate,category,gender,matchUpFormat}=event,additionalContext=__spreadValues$4m(__spreadValues$4m({},context),definedAttributes({indoorOutDoor:event.indoorOutDoor||(null==tournamentRecord?void 0:tournamentRecord.indoorOutDoor),surfaceCategory:event.surfaceCategory||(null==tournamentRecord?void 0:tournamentRecord.surfaceCategory),endDate:event.endDate||(null==tournamentRecord?void 0:tournamentRecord.endDate),tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUpFormat,eventName,category,gender,eventId}));endDate&&(additionalContext.endDate=endDate),contextProfile&&!contextContent&&(contextContent=getContextContent({policyDefinitions,tournamentRecord,contextProfile,event})),(null==participants?void 0:participants.length)||participantMap||!tournamentRecord||({participants,participantMap}=getParticipants$2({participantsProfile,policyDefinitions,useParticipantMap,tournamentRecord,contextProfile,inContext}));const drawDefinitions=event.drawDefinitions||[],scheduleTiming=getScheduleTiming({tournamentRecord,event}).scheduleTiming,matchUps=drawDefinitions.map((drawDefinition=>{const{matchUps:matchUps2}=getAllDrawMatchUps({tournamentParticipants:participants,tournamentAppliedPolicies,scheduleVisibilityFilters,context:additionalContext,participantsProfile,afterRecoveryTimes,policyDefinitions,tournamentRecord,contextFilters,contextProfile,drawDefinition,contextContent,matchUpFilters,participantMap,scheduleTiming,nextMatchUps,inContext,event});return matchUps2})).flat(1/0);return{matchUps}}function tournamentMatchUps({scheduleVisibilityFilters,participantsProfile,afterRecoveryTimes,policyDefinitions,useParticipantMap,tournamentRecord,inContext=!0,contextFilters,contextProfile,contextContent,matchUpFilters,nextMatchUps,context}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const tournamentId=(null==(_a=tournamentRecord.unifiedTournamentId)?void 0:_a.tournamentId)||tournamentRecord.tournamentId,events=(null==tournamentRecord?void 0:tournamentRecord.events)||[],{participants,participantMap}=getParticipants$2({participantsProfile,policyDefinitions,useParticipantMap,tournamentRecord,contextProfile,inContext});contextProfile&&!contextContent&&(contextContent=getContextContent({policyDefinitions,tournamentRecord,contextProfile}));const{appliedPolicies:tournamentAppliedPolicies}=getAppliedPolicies({tournamentRecord}),filteredEventIds=(null==contextFilters?void 0:contextFilters.eventIds)||[];return events.filter((event=>!filteredEventIds.includes(event.eventId))).map((event=>{var _a2,_b;const flightProfile=getFlightProfile({event}).flightProfile;return eventMatchUps({context:__spreadValues$4m({eventDrawsCount:(null==(_a2=null==flightProfile?void 0:flightProfile.flights)?void 0:_a2.length)||(null==(_b=event.drawDefinitions)?void 0:_b.length)||0},context),tournamentAppliedPolicies,scheduleVisibilityFilters,participantsProfile,afterRecoveryTimes,policyDefinitions,tournamentRecord,contextFilters,contextProfile,contextContent,matchUpFilters,participantMap,participants,tournamentId,nextMatchUps,inContext,event})})).reduce(((matchUps,eventMatchUps2)=>{const keys=eventMatchUps2&&Object.keys(eventMatchUps2).filter((key=>!["success","matchUpsMap"].includes(key)));return null==keys||keys.forEach((key=>{matchUps[key]||(matchUps[key]=[]),matchUps[key]=matchUps[key].concat(eventMatchUps2[key]),matchUps.matchUpsCount+=eventMatchUps2[key].length})),matchUps}),{matchUpsCount:0})}function eventMatchUps({participants:tournamentParticipants,tournamentAppliedPolicies,scheduleVisibilityFilters,participantsProfile,afterRecoveryTimes,policyDefinitions,useParticipantMap,tournamentRecord,contextFilters,contextProfile,contextContent,matchUpFilters,participantMap,nextMatchUps,tournamentId,inContext,context,event}){if(!event)return{error:MISSING_EVENT};const{eventId,eventName,endDate}=event,additionalContext=__spreadValues$4m(__spreadValues$4m({},context),definedAttributes({eventId,eventName,endDate:endDate||(null==tournamentRecord?void 0:tournamentRecord.endDate),tournamentId:tournamentId||(null==tournamentRecord?void 0:tournamentRecord.tournamentId),indoorOutDoor:event.indoorOutDoor||(null==tournamentRecord?void 0:tournamentRecord.indoorOutDoor),surfaceCategory:event.surfaceCategory||(null==tournamentRecord?void 0:tournamentRecord.surfaceCategory)}));!tournamentParticipants&&tournamentRecord&&({participants:tournamentParticipants,participantMap}=getParticipants$2({participantsProfile,policyDefinitions,useParticipantMap,tournamentRecord,contextProfile,inContext})),contextProfile&&!contextContent&&(contextContent=getContextContent({policyDefinitions,tournamentRecord,contextProfile,event}));return(event.drawDefinitions||[]).reduce(((matchUps,drawDefinition)=>{const drawMatchUps2=getDrawMatchUps({context:additionalContext,tournamentAppliedPolicies,scheduleVisibilityFilters,tournamentParticipants,participantsProfile,afterRecoveryTimes,policyDefinitions,tournamentRecord,drawDefinition,contextContent,contextFilters,contextProfile,matchUpFilters,participantMap,nextMatchUps,inContext,event}),keys=Object.keys(drawMatchUps2);return null==keys||keys.forEach((key=>{matchUps[key]||(matchUps[key]=[]),matchUps[key]=matchUps[key].concat(drawMatchUps2[key])})),matchUps}),{})}function getParticipants$2({participantsProfile,policyDefinitions,useParticipantMap,tournamentRecord,contextProfile,inContext}){var _a;if(useParticipantMap){return{participantMap:null==(_a=getParticipantMap(__spreadProps$2v(__spreadValues$4m(__spreadValues$4m({},participantsProfile),contextProfile),{policyDefinitions,tournamentRecord,inContext})))?void 0:_a.participantMap}}let participants=tournamentRecord.participants||[];if(((null==participantsProfile?void 0:participantsProfile.withIOC)||(null==participantsProfile?void 0:participantsProfile.withISO2))&&participants.forEach((participant=>addNationalityCode(__spreadValues$4m({participant},participantsProfile)))),(inContext||(null==participantsProfile?void 0:participantsProfile.withGroupings))&&(null==participants?void 0:participants.length)&&(participants=addParticipantGroupings({participantsProfile,participants})),(null==participantsProfile?void 0:participantsProfile.withScaleValues)&&(null==participants?void 0:participants.length))for(const participant of participants){const{ratings,rankings}=getScaleValues({participant});participant.rankings=rankings,participant.ratings=ratings}return{participants}}function findMatchUp({participantsProfile,afterRecoveryTimes,tournamentRecord,contextProfile,contextContent,nextMatchUps,matchUpId,inContext}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if("string"!=typeof matchUpId)return{error:MISSING_MATCHUP_ID};const{matchUps}=allTournamentMatchUps({tournamentRecord}),inContextMatchUp=matchUps.find((matchUp2=>matchUp2.matchUpId===matchUpId));if(!inContextMatchUp)return{error:MATCHUP_NOT_FOUND};const{eventId,drawId}=inContextMatchUp,{event,drawDefinition}=findEvent({tournamentRecord,eventId,drawId});contextProfile&&!contextContent&&(contextContent=getContextContent({tournamentRecord,contextProfile}));const additionalContext={surfaceCategory:event.surfaceCategory||tournamentRecord.surfaceCategory,indoorOutDoor:event.indoorOutDoor||tournamentRecord.indoorOutDoor,endDate:event.endDate||tournamentRecord.endDate,tournamentId:tournamentRecord.tournamentId,eventId,drawId},tournamentParticipants=tournamentRecord.participants||[],{matchUp,structure}=findMatchUp$1({context:inContext&&additionalContext,tournamentParticipants,participantsProfile,afterRecoveryTimes,drawDefinition,contextProfile,contextContent,nextMatchUps,matchUpId,inContext,event});return{matchUp,structure,drawDefinition}}function getIndividualParticipantIds(matchUp){var _a;const{sides,matchUpType}=matchUp||{},potentialIndividualParticipantIds=(null==(_a=matchUp.potentialParticipants)?void 0:_a.length)?matchUp.potentialParticipants.flat().map((participant=>matchUpType===DOUBLES$1?(null==participant?void 0:participant.individualParticipantIds)||[]:participant.participantId)).flat():[],enteredIndividualParticipantIds=(sides||[]).map((side=>{var _a2;return matchUpType===DOUBLES$1&&((null==(_a2=null==side?void 0:side.participant)?void 0:_a2.individualParticipantIds)||[])||(null==side?void 0:side.participantId)&&[side.participantId]||[]})).flat();return{individualParticipantIds:enteredIndividualParticipantIds.concat(potentialIndividualParticipantIds).flat(),enteredIndividualParticipantIds,potentialIndividualParticipantIds}}function allCompetitionMatchUps({scheduleVisibilityFilters,afterRecoveryTimes,tournamentRecords,matchUpFilters,contextFilters,nextMatchUps}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};return{matchUps:Object.keys(tournamentRecords).map((tournamentId=>{const tournamentRecord=tournamentRecords[tournamentId],{matchUps}=allTournamentMatchUps({scheduleVisibilityFilters,afterRecoveryTimes,tournamentRecord,matchUpFilters,contextFilters,nextMatchUps});return matchUps})).flat()}}function competitionMatchUps({scheduleVisibilityFilters,participantsProfile,policyDefinitions,tournamentRecords,matchUpFilters,contextFilters,nextMatchUps}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};return Object.keys(tournamentRecords).map((tournamentId=>{const tournamentRecord=tournamentRecords[tournamentId];return tournamentMatchUps({scheduleVisibilityFilters,participantsProfile,policyDefinitions,tournamentRecord,matchUpFilters,contextFilters,nextMatchUps})})).reduce(((groupings,matchUpGroupings)=>(Object.keys(matchUpGroupings).forEach((key=>{groupings[key]||(groupings[key]=[]),groupings[key]=groupings[key].concat(matchUpGroupings[key])})),groupings)),{})}function matchUpSort(a,b){return function stageDifference(a,b){return(stageOrder$1[null==a?void 0:a.stage]||0)-(stageOrder$1[null==b?void 0:b.stage]||0)}(a,b)||((null==a?void 0:a.stageSequence)||0)-((null==b?void 0:b.stageSequence)||0)||(null==a?void 0:a.roundNumber)-(null==b?void 0:b.roundNumber)||((null==a?void 0:a.roundPosition)||0)-((null==b?void 0:b.roundPosition)||0)}var __defProp$4l=Object.defineProperty,__getOwnPropSymbols$4m=Object.getOwnPropertySymbols,__hasOwnProp$4m=Object.prototype.hasOwnProperty,__propIsEnum$4m=Object.prototype.propertyIsEnumerable,__defNormalProp$4l=(obj,key,value)=>key in obj?__defProp$4l(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4l=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4m.call(b,prop)&&__defNormalProp$4l(a,prop,b[prop]);if(__getOwnPropSymbols$4m)for(var prop of __getOwnPropSymbols$4m(b))__propIsEnum$4m.call(b,prop)&&__defNormalProp$4l(a,prop,b[prop]);return a};function getMatchUpDependencies({includeParticipantDependencies,tournamentRecords={},tournamentRecord,drawDefinition,matchUpIds=[],matchUps=[],drawIds=[]}){if(!Array.isArray(matchUpIds))return{error:MISSING_MATCHUP_IDS};if(!Array.isArray(matchUps))return{error:MISSING_MATCHUPS};if(!Array.isArray(drawIds))return{error:MISSING_DRAW_ID};matchUpIds.length||(matchUpIds=matchUps.map((({matchUpId})=>matchUpId)));const positionDependencies={},matchUpDependencies={},sourceStructureIdMap={},sourceMatchUpIds={};tournamentRecord&&!Object.keys(tournamentRecords).length&&(tournamentRecords={[tournamentRecord.tournamentId]:tournamentRecord});const allTournamentRecords=Object.values(tournamentRecords),positionLinks=allTournamentRecords.reduce(((allLinks2,tournamentRecord2)=>(tournamentRecord2.events||[]).map((event=>(event.drawDefinitions||[]).map((drawDefinition2=>drawDefinition2.links||[])))).flat(1/0)),[]).filter((({linkType})=>linkType===POSITION));if(positionLinks.length){({matchUps}=allCompetitionMatchUps({nextMatchUps:!0,tournamentRecords}));const sourceStructureIds=positionLinks.reduce(((structureIds,link)=>{var _a,_b;const sourceStructureId=null==(_a=link.source)?void 0:_a.structureId,targetStructureId=null==(_b=link.target)?void 0:_b.structureId;return sourceStructureId&&targetStructureId&&(sourceStructureIdMap[targetStructureId]=sourceStructureId),sourceStructureId&&!structureIds.includes(sourceStructureId)&&structureIds.push(sourceStructureId),structureIds}),[]);for(const sourceStructureId of sourceStructureIds)positionDependencies[sourceStructureId]=[];for(const matchUp of matchUps){const sourceStructureId=matchUp.containerStructureId||matchUp.structureId;sourceStructureIds.includes(sourceStructureId)&&positionDependencies[sourceStructureId].push(matchUp.matchUpId)}}const initializeMatchUpId=matchUpId=>{matchUpDependencies[matchUpId]||(matchUpDependencies[matchUpId]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},sourceMatchUpIds[matchUpId]=[])},propagateDependencies=(matchUpId,targetMatchUpId)=>{matchUpDependencies[matchUpId].matchUpIds.forEach((matchUpIdDependency=>{matchUpDependencies[targetMatchUpId].matchUpIds.push(matchUpIdDependency)})),matchUpDependencies[targetMatchUpId].matchUpIds.push(matchUpId),matchUpDependencies[matchUpId].dependentMatchUpIds.push(targetMatchUpId),includeParticipantDependencies&&matchUpDependencies[matchUpId].participantIds.forEach((participantIdDependency=>matchUpDependencies[targetMatchUpId].participantIds.push(participantIdDependency)))},processMatchUps=matchUpsToProcess=>{const processSourceStructures=Object.keys(positionDependencies).length;for(const matchUp of matchUpsToProcess){const{matchUpId,winnerMatchUpId,loserMatchUpId}=matchUp;if(!matchUpIds.length||matchUpIds.includes(matchUpId)){if(initializeMatchUpId(matchUpId),includeParticipantDependencies){const{individualParticipantIds}=getIndividualParticipantIds(matchUp);matchUpDependencies[matchUpId].participantIds=individualParticipantIds}winnerMatchUpId&&(initializeMatchUpId(winnerMatchUpId),propagateDependencies(matchUpId,winnerMatchUpId),sourceMatchUpIds[winnerMatchUpId].push(matchUpId)),loserMatchUpId&&(initializeMatchUpId(loserMatchUpId),propagateDependencies(matchUpId,loserMatchUpId),sourceMatchUpIds[loserMatchUpId].push(matchUpId)),matchUpDependencies[matchUpId].sources.push(sourceMatchUpIds[matchUpId]);const s1=sourceMatchUpIds[matchUpId].map((id=>matchUpDependencies[id].sources[0])).flat(),s2=sourceMatchUpIds[matchUpId].map((id=>matchUpDependencies[id].sources[1])).flat();if(matchUpDependencies[matchUpId].sources.push(s1,s2),processSourceStructures){const relevantStructureId=matchUp.containerStructureId||matchUp.structureId,sourceStructureId=sourceStructureIdMap[relevantStructureId];if(positionDependencies[sourceStructureId])for(const matchUpDependency of positionDependencies[sourceStructureId])initializeMatchUpId(matchUpDependency),propagateDependencies(matchUpDependency,matchUpId),sourceMatchUpIds[matchUpDependency].push(matchUpId)}}}};if(drawDefinition)addGoesTo({drawDefinition}),matchUps.length||({matchUps}=allDrawMatchUps$1({drawDefinition})),processMatchUps(matchUps);else{matchUps.length||({matchUps}=allCompetitionMatchUps({nextMatchUps:!0,tournamentRecords})),drawIds.length||(drawIds=(null==allTournamentRecords?void 0:allTournamentRecords.length)?allTournamentRecords.map((({events=[]})=>events.map((({drawDefinitions=[]})=>drawDefinitions.map((({drawId})=>drawId)))))).flat(1/0):[]);for(const drawId of drawIds){let drawMatchUps=matchUps.filter((matchUp=>matchUp.drawId===drawId)).sort(matchUpSort);if(!drawMatchUps.find((({roundPosition})=>!roundPosition))){const hasTournamentId=drawMatchUps.find((({tournamentId})=>tournamentId)),{drawDefinition:drawDefinition2}=findEvent({tournamentRecord:tournamentRecords[null==hasTournamentId?void 0:hasTournamentId.tournamentId],drawId});drawDefinition2&&addGoesTo({drawDefinition:drawDefinition2})}processMatchUps(drawMatchUps)}}return __spreadValues$4l({positionDependencies,matchUpDependencies,sourceMatchUpIds,matchUps},SUCCESS)}function proConflicts({tournamentRecords,matchUps}={}){if(!Array.isArray(matchUps))return{error:MISSING_MATCHUPS};if(matchUps.some((({hasContext})=>!hasContext)))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:MISSING_CONTEXT};const filteredRows=generateRange(1,Math.max(...matchUps.map((({schedule})=>(null==schedule?void 0:schedule.courtOrder)||1)).map((order=>parseInt(order))))+1).map((courtOrder=>matchUps.filter((m=>{var _a;return parseInt(null==(_a=m.schedule)?void 0:_a.courtOrder)===courtOrder})))),matchUpsMap={},courtIssues={},rowIndices={};filteredRows.flat().filter(Boolean).sort(matchUpSort).forEach((({schedule})=>delete schedule.STATE));const deps=getMatchUpDependencies({includeParticipantDependencies:!0,tournamentRecords,drawIds:unique(matchUps.map((({drawId})=>drawId)))}).matchUpDependencies,rowProfiles=filteredRows.map(((row,rowIndex)=>row.reduce(((profile,matchUp)=>{if(!matchUp.matchUpId)return profile;const{matchUpId,winnerMatchUpId,loserMatchUpId,schedule}=matchUp,courtId=null==schedule?void 0:schedule.courtId;rowIndices[matchUpId]=rowIndex,courtIssues[courtId]=[],profile.matchUpIds.push(matchUpId),matchUpsMap[matchUpId]=matchUp;const sourceMatchUpIds=deps[matchUpId].matchUpIds;return sourceMatchUpIds.length&&profile.sourceMatchUpIds.push(...sourceMatchUpIds),profile.participantIds.push(...deps[matchUpId].participantIds),winnerMatchUpId&&profile.targetMatchUpIds.push(winnerMatchUpId),loserMatchUpId&&profile.targetMatchUpIds.push(loserMatchUpId),profile}),{matchUpIds:[],sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[]}))),rowIssues=rowProfiles.map((()=>[])),annotate=(matchUpId,issue,issueType,issueIds)=>{if(!matchUpsMap[matchUpId].schedule.STATE){matchUpsMap[matchUpId].schedule.STATE=issue,matchUpsMap[matchUpId].schedule.ISSUE_IDS=issueIds,rowIssues[rowIndices[matchUpId]].push({matchUpId,issue,issueType,issueIds});const courtId=matchUpsMap[matchUpId].schedule.courtId;courtIssues[courtId]||(courtIssues[courtId]=[]),courtIssues[courtId].push({matchUpId,issue,issueType,issueIds})}};return rowProfiles.forEach(((row,rowIndex)=>{const previousRow=rowIndex?rowProfiles[rowIndex-1]:void 0,subsequentRows=rowProfiles.slice(rowIndex+1),participantConflicts={},instances=instanceCount(row.participantIds),conflictedParticipantIds=Object.keys(instances).filter((key=>instances[key]>1)),conflictedMatchUpIds=row.matchUpIds.filter((matchUpId=>deps[matchUpId].participantIds.some((id=>conflictedParticipantIds.includes(id)))));conflictedMatchUpIds.forEach((matchUpId=>{participantConflicts[matchUpId]||(participantConflicts[matchUpId]={}),participantConflicts[matchUpId].CONFLICT||(participantConflicts[matchUpId].CONFLICT=conflictedMatchUpIds.filter((id=>id!==matchUpId)))}));const previousRowWarnings=previousRow&&row.participantIds.filter((id=>previousRow.participantIds.includes(id)));previousRowWarnings&&previousRowWarnings.forEach((participantId=>{const warnedMatchUpIds=row.matchUpIds.concat(previousRow.matchUpIds).filter((matchUpId=>deps[matchUpId].participantIds.includes(participantId)));warnedMatchUpIds.forEach((matchUpId=>{participantConflicts[matchUpId]||(participantConflicts[matchUpId]={}),participantConflicts[matchUpId].WARNING||(participantConflicts[matchUpId].WARNING=warnedMatchUpIds.filter((id=>id!==matchUpId)))}))})),row.matchUpIds.forEach((matchUpId=>{var _a,_b,_c,_d;const sourceMatchUpIds=deps[matchUpId].matchUpIds;for(const subsequentRow of subsequentRows){const sourceAfter=subsequentRow.matchUpIds.filter((id=>sourceMatchUpIds.includes(id)));(null==sourceAfter?void 0:sourceAfter.length)&&(sourceAfter.forEach((id=>annotate(id,"ERROR","matchUpConflict",[matchUpId]))),annotate(matchUpId,"ERROR","matchUpConflict",sourceAfter))}if((null==(_a=participantConflicts[matchUpId])?void 0:_a.CONFLICT)&&annotate(matchUpId,"CONFLICT","participantConflict",participantConflicts[matchUpId].CONFLICT),row.sourceMatchUpIds.includes(matchUpId)){const sources=row.matchUpIds.filter((id=>deps[id].matchUpIds.includes(matchUpId)));annotate(matchUpId,"CONFLICT","matchUpConflict",sources),row.matchUpIds.filter((id=>deps[id].matchUpIds.includes(matchUpId))).forEach((id=>annotate(id,"CONFLICT","matchUpConflict",[matchUpId])))}const insufficientGap=null==(_b=null==previousRow?void 0:previousRow.matchUpIds)?void 0:_b.filter((id=>{return b=id,deps[matchUpId].sources.reduce(((distance,round,index)=>round.includes(b)&&index+1||distance),0)>1;var b}));if((null==insufficientGap?void 0:insufficientGap.length)&&(annotate(matchUpId,"ISSUE","matchUpConflict",insufficientGap),insufficientGap.forEach((id=>annotate(id,"ISSUE","matchUpConflict",[matchUpId])))),(null==(_c=participantConflicts[matchUpId])?void 0:_c.WARNING)&&annotate(matchUpId,"WARNING","participantConflict",participantConflicts[matchUpId].WARNING),null==(_d=null==previousRow?void 0:previousRow.targetMatchUpIds)?void 0:_d.includes(matchUpId)){const consideredCourtId=matchUpsMap[matchUpId].schedule.courtId,warningMatchUpIds=sourceMatchUpIds.filter((id=>previousRow.matchUpIds.includes(id)));warningMatchUpIds.some((id=>matchUpsMap[id].schedule.courtId===consideredCourtId))||(warningMatchUpIds.forEach((id=>annotate(id,"WARNING","matchUpConflict",[matchUpId]))),annotate(matchUpId,"WARNING","matchUpConflict",warningMatchUpIds))}}))})),{courtIssues,rowIssues}}var __defProp$4k=Object.defineProperty,__getOwnPropSymbols$4l=Object.getOwnPropertySymbols,__hasOwnProp$4l=Object.prototype.hasOwnProperty,__propIsEnum$4l=Object.prototype.propertyIsEnumerable,__defNormalProp$4k=(obj,key,value)=>key in obj?__defProp$4k(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const baseAttributeKeys=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function getCourtDateAvailability({court,date}){const targetDateAvailability=date&&court.dateAvailability.find((availability=>sameDay(availability.date,date))),defaultAvailability=court.dateAvailability.find((availability=>!availability.date));return targetDateAvailability||defaultAvailability}function generateTimeSlots({courtDate,includeBookingTypes=[]}){const timeSlots=[];let startTime=timeToDate(courtDate.startTime);(courtDate.bookings||[]).filter((booking=>!booking.bookingType||!includeBookingTypes.includes(booking.bookingType))).sort(((a,b)=>tidyTime(a.startTime).localeCompare(tidyTime(b.startTime)))).forEach((booking=>{const timeSlot2={startTime:extractTime(startTime.toISOString()),endTime:booking.startTime};timeToDate(booking.startTime)>startTime&&timeSlots.push(timeSlot2),timeToDate(booking.endTime)>startTime&&(startTime=timeToDate(booking.endTime))}));const timeSlot={startTime:extractTime(startTime.toISOString()),endTime:courtDate.endTime};return timeToDate(courtDate.endTime)>startTime&&timeSlots.push(timeSlot),timeSlots}function getCourtsAvailableAtPeriodStart({averageMatchUpMinutes,includeBookingTypes,periodLength,periodStart,courts,date}){const periodStartTime=timeToDate(periodStart),periodEndTime=addMinutes(periodStartTime,averageMatchUpMinutes),{enoughTime}=function getEnoughTime({includeBookingTypes,averageMatchUpMinutes,periodStartTime,periodEndTime,periodLength}){function validTimeSlot(timeSlot){const slotStartTime=timeToDate(timeSlot.startTime),slotEndTime=timeToDate(timeSlot.endTime);return!(slotStartTime>periodStartTime)&&(!(slotEndTime<periodEndTime)&&minutesDifference(periodStartTime,slotEndTime)>=averageMatchUpMinutes)}return{enoughTime:courtDate=>!!generateTimeSlots({includeBookingTypes,periodLength,courtDate}).filter(validTimeSlot).length}}({averageMatchUpMinutes,includeBookingTypes,periodStartTime,periodEndTime,periodLength});return{availableToScheduleCount:((null==courts?void 0:courts.filter((court=>{if(!Array.isArray(court.dateAvailability))return!1;const courtDate=getCourtDateAvailability({date,court});return!(!courtDate||!enoughTime(courtDate))})))||[]).length}}function generateVirtualCourts({remainingScheduleTimes=[],clearScheduleDates,periodLength=30,bookings=[],scheduleDate,courts=[]}){if(!Array.isArray(courts)||!courts.length)return{error:INVALID_VALUES,courts};if(!Array.isArray(bookings))return{error:INVALID_BOOKINGS};if(!isValidDateString(scheduleDate))return{error:INVALID_DATE};clearScheduleDates&&(Array.isArray(clearScheduleDates)?clearScheduleDates.includes(scheduleDate)&&(bookings=[]):bookings=[]);const{courtBookings,unassignedBookings}=bookings.reduce(((accumulator,booking)=>{const{courtId}=booking;return courtId?accumulator.courtBookings[courtId]?accumulator.courtBookings[courtId].push(booking):accumulator.courtBookings[courtId]=[booking]:accumulator.unassignedBookings.push(booking),accumulator}),{courtBookings:{},unassignedBookings:[]}),inProcessCourts=courts.map(((court,index)=>{const{courtId,courtName}=court,bookingsThisCourt=courtBookings[courtId]||[],availability=getCourtDateAvailability({date:scheduleDate,court})||{},{bookings:existingBookings=[],startTime,endTime,date}=availability;return{courtId,courtName,dateAvailability:{bookings:[remainingScheduleTimes[index]&&{startTime,endTime:remainingScheduleTimes[index]},...makeDeepCopy(existingBookings,!1,!0),...bookingsThisCourt].filter(Boolean),startTime,endTime,date}}}));unassignedBookings.sort(((a,b)=>timeStringMinutes(a.startTime)-timeStringMinutes(b.startTime)));const assignedBookings=[];for(const unassignedBooking of unassignedBookings){const{startTime,endTime,averageMinutes,recoveryMinutes,matchUpId}=unassignedBooking,startMinutes=timeStringMinutes(startTime),endMinutes=timeStringMinutes(endTime),bestCourt=inProcessCourts.map((court=>{const timeSlots=generateTimeSlots({courtDate:court.dateAvailability});return{courtName:court.courtName,courtId:court.courtId,timeSlots}})).flat().reduce(((best,{courtId,courtName,timeSlots})=>{let startDifference;return timeSlots.find((({startTime:startTime2,endTime:endTime2})=>{startDifference=timeStringMinutes(startTime2)-startMinutes;const startFits=startMinutes>=timeStringMinutes(startTime2);return endMinutes<=timeStringMinutes(endTime2)&&0!==best.startDifference&&((0===startDifference||startDifference+periodLength>=0)&&(void 0===best.startDifference||startDifference<best.startDifference)||startFits)}))?{courtName,courtId,startDifference}:best}),{});if(bestCourt.courtId){const booking={averageMinutes,recoveryMinutes,matchUpId,startTime,endTime};assignedBookings.push(booking);inProcessCourts.find((({courtId})=>courtId===bestCourt.courtId)).dateAvailability.bookings.push(booking)}else console.log({unassignedBooking})}return{virtualCourts:inProcessCourts.map((({courtId,courtName,dateAvailability})=>({dateAvailability:[dateAvailability],courtName,courtId}))),assignedBookings}}function calculatePeriodLength({averageMatchUpMinutes,periodLength=30,recoveryMinutes}){const combinedMinutes=(averageMatchUpMinutes||90)+(recoveryMinutes||0);return periodLength>combinedMinutes?combinedMinutes:periodLength||30}function getDateTimeBoundary({scheduleDate,startTime,endTime,courts}){const accessor=startTime?"startTime":endTime?"endTime":void 0;return courts.reduce(((boundaryTime,court)=>{const dateAvailability=getCourtDateAvailability({date:scheduleDate,court}),comparisonTime=(null==dateAvailability?void 0:dateAvailability[accessor])||court[accessor];return!comparisonTime||boundaryTime&&!(startTime?timeStringMinutes(comparisonTime)<timeStringMinutes(boundaryTime):timeStringMinutes(comparisonTime)>timeStringMinutes(boundaryTime))?boundaryTime:comparisonTime}),void 0)}function courtGenerator({startTime="8:00",endTime="20:30",count=10,date}={}){return generateRange(0,count).map((()=>({dateAvailability:[{date,startTime,endTime}]})))}function getScheduleTimes({calculateStartTimeFromCourts=!0,remainingScheduleTimes,date=getUTCdateString(),averageMatchUpMinutes,startTime="08:00",clearScheduleDates,endTime="19:00",periodLength,courtsCount,bookings,courts}={}){periodLength=periodLength||calculatePeriodLength({averageMatchUpMinutes}),date=extractDate(date),startTime=extractTime(startTime),endTime=extractTime(endTime);let previousCalculation=0,previousAvailableCourts=0,cumulativeMatches=0,totalMatchUps=0,cumulativePeriods=0;!courts&&courtsCount&&(courts=courtGenerator({startTime,endTime,count:courtsCount,date}));const{virtualCourts}=generateVirtualCourts({remainingScheduleTimes,clearScheduleDates,scheduleDate:date,periodLength,bookings,courts}),{firstTimeSlotStartTime}=function getFirstTimeSlotStartTime({averageMinutes,startTime,endTime,courts,date}){let firstTimeSlotStartTime;if(startTime=startTime||getDateTimeBoundary({courts,scheduleDate:date,startTime:!0}),endTime=endTime||getDateTimeBoundary({courts,scheduleDate:date,endTime:!0}),startTime&&endTime){const dateStartTime=timeToDate(startTime),dateEndTime=timeToDate(endTime);for(const court of courts||[]){if(!Array.isArray(court.dateAvailability))return!1;generateTimeSlots({courtDate:getCourtDateAvailability({court,date})}).find((timeSlot=>{const timeSlotStartTime=timeToDate(timeSlot.startTime),timeSlotEndTime=timeToDate(timeSlot.endTime);if(timeSlotStartTime>dateEndTime||timeSlotStartTime<dateStartTime)return!1;if(timeSlotEndTime<dateStartTime)return!1;const available=minutesDifference(timeSlotStartTime,timeSlotEndTime)>=averageMinutes;if(available){const timeString=extractTime(timeSlotStartTime.toISOString());(!firstTimeSlotStartTime||timeString<firstTimeSlotStartTime)&&(firstTimeSlotStartTime=timeString)}return available}))}}return{firstTimeSlotStartTime}}({averageMinutes:averageMatchUpMinutes,courts:virtualCourts,startTime,endTime,date});calculateStartTimeFromCourts&&firstTimeSlotStartTime&&(startTime=firstTimeSlotStartTime||startTime);const dayStartMinutes=timeStringMinutes(startTime),dayMinutes=timeStringMinutes(endTime)-dayStartMinutes,timingProfile=generateRange(0,Math.floor(dayMinutes/periodLength)+1).map((period=>{const periodStart=function dayMinutesToTimeString(totalMinutes){let hours=Math.floor(totalMinutes/60);const minutes=totalMinutes-60*hours;return hours>23&&(hours%=24),[zeroPad(hours),zeroPad(minutes)].join(":")}(dayStartMinutes+period*periodLength),{availableToScheduleCount}=getCourtsAvailableAtPeriodStart({courts:virtualCourts,averageMatchUpMinutes,periodLength,periodStart,period,date}),newCourts=availableToScheduleCount>previousAvailableCourts?availableToScheduleCount-previousAvailableCourts:0;cumulativePeriods+=period?availableToScheduleCount:0;const averageCourts=period?cumulativePeriods/period:availableToScheduleCount,calculatedTotal=period?periodLength*averageCourts/averageMatchUpMinutes*(period-1)+averageCourts:averageCourts,calculationDifference=availableToScheduleCount?previousAvailableCourts?calculatedTotal-previousCalculation:newCourts:0;previousCalculation=calculatedTotal,previousAvailableCourts=availableToScheduleCount,cumulativeMatches+=calculationDifference;const addToSchedule=parseInt(cumulativeMatches)-totalMatchUps;return totalMatchUps+=addToSchedule,{periodStart,add:addToSchedule,availableToScheduleCount,newCourts,totalMatchUps}}));return{scheduleTimes:timingProfile.reduce(((scheduleTimes2,profile)=>scheduleTimes2.concat(...generateRange(0,profile.add).map((()=>({scheduleTime:profile.periodStart}))))),[]).flat(),timingProfile,totalMatchUps}}const garman={getCourtsAvailableAtPeriodStart,generateTimeSlots,getScheduleTimes,courtGenerator},typeMatch=(arr,type)=>arr.filter(Boolean).every((i=>typeof i===type)),allNumeric=arr=>arr.filter(Boolean).every(isNumeric);function parseAgeCategoryCode({consideredDate,category}={}){const invalid={error:INVALID_VALUES,ageMin:8,ageMax:99};if("object"!=typeof category||!isValidDateString(consideredDate))return invalid;const consideredYear=parseInt(consideredDate.split("-")[0]),errors=[];let combinedAge,{ageCategoryCode,categoryName,ageMaxDate,ageMinDate,ageMax,ageMin}=category;if(!typeMatch([ageCategoryCode,ageMaxDate,ageMinDate,categoryName],"string")||!allNumeric([ageMax,ageMin]))return invalid;ageCategoryCode=ageCategoryCode||categoryName;const prePost=/^([UO]?)(\d{1,2})([UO]?)$/,extractCombined=/^C(\d{1,2})-(\d{1,2})$/,isBetween=(null==ageCategoryCode?void 0:ageCategoryCode.indexOf("-"))>0,isCombined=isBetween&&(null==ageCategoryCode?void 0:ageCategoryCode.match(extractCombined)),isCoded=null==ageCategoryCode?void 0:ageCategoryCode.match(prePost),constructedDate=(y,d,df)=>isValidDateString(d)?d:d&&d.match(/^\d{2}-\d{2}$/)?`${y}-${d}`:`${y}-${df}`,processCode=code=>{const[pre,age,post]=(code.match(prePost)||[]).slice(1),ageInt=parseInt(age);"U"===pre&&({ageMinDate,ageMax}=(ageInt=>(ageMinDate=constructedDate(consideredYear-ageInt,ageMinDate,"01-01"),ageMax&&ageMax!==ageInt-1&&errors.push(`Invalid ageMax: ${ageMax}`),ageMax||(ageMax=ageInt-1),{ageMinDate,ageMax}))(ageInt)),"U"===post&&({ageMinDate,ageMax}=(ageInt=>(ageMinDate=constructedDate(consideredYear-ageInt-1,ageMinDate,"01-01"),ageMax&&ageMax!==ageInt&&errors.push(`Invalid ageMax: ${ageMax}`),ageMax||(ageMax=ageInt),{ageMinDate,ageMax}))(ageInt)),"O"===pre&&({ageMaxDate,ageMin}=(ageInt=>(ageMaxDate=constructedDate(consideredYear-ageInt-2,ageMaxDate,"12-31"),ageMin&&ageMin!==ageInt+1&&errors.push(`Invalid ageMin: ${ageMin}`),ageMin||(ageMin=ageInt+1),{ageMaxDate,ageMin}))(ageInt)),"O"===post&&({ageMaxDate,ageMin}=(ageInt=>(ageMaxDate=constructedDate(consideredYear-ageInt-1,ageMaxDate,"12-31"),ageMin&&ageMin!==ageInt&&errors.push(`Invalid ageMin: ${ageMin}`),ageMin||(ageMin=ageInt),{ageMaxDate,ageMin}))(ageInt))};if(isCombined){const[lowAge,highAge]=ageCategoryCode.match(extractCombined).slice(1).map((n=>parseInt(n)));lowAge<=highAge?(ageMin=ageMin||lowAge,ageMax=ageMax||highAge,combinedAge=!0):errors.push(`Invalid combined age range ${ageCategoryCode}`)}else isBetween?ageCategoryCode.split("-").forEach(processCode):isCoded&&processCode(ageCategoryCode);return errors.length?{error:errors,ageMin:8,ageMax:99}:definedAttributes({combinedAge,ageMaxDate,ageMinDate,ageMax,ageMin})}function parseScoreString({scoreString,tiebreakTo=7}){return scoreString.split(" ").filter(Boolean).map(((set,index)=>function parseSet({set,setNumber}){const matchTiebreak=(null==set?void 0:set.startsWith("["))&&set.split("[")[1].split("]")[0].split("-").map((sideScore=>parseInt(sideScore))),setString=set.includes("(")&&set.split("(")[0]||set.includes("[")&&set.split("[")[0]||set,setScores=!matchTiebreak&&setString.split("-").map((sideScore=>parseInt(sideScore))),winningSide=matchTiebreak?(matchTiebreak[0]>matchTiebreak[1]?1:matchTiebreak[0]<matchTiebreak[1]&&2)||void 0:(setScores[0]>setScores[1]?1:setScores[0]<setScores[1]&&2)||void 0,setTiebreakLowScore=set.includes("(")&&set.split("(")[1].split(")")[0],setTiebreak=![!1,void 0].includes(setTiebreakLowScore)&&getTiebreakComplement({isSide1:2===winningSide,lowValue:setTiebreakLowScore,tiebreakTo})||[],[side1Score,side2Score]=setScores||[],[side1TiebreakScore,side2TiebreakScore]=matchTiebreak||setTiebreak||[];return{side1Score,side2Score,side1TiebreakScore,side2TiebreakScore,winningSide,setNumber}}({set,setNumber:index+1})))}const standardSetComma=new RegExp("(\\d+-\\d+),","g"),tiebreakSetComma=new RegExp("(\\d+-\\d+\\(\\d+\\)),","g"),setTypes=["\\d+-\\d+","\\d+-\\d+\\(\\d+\\)","\\[\\d+-\\d+\\]","\\d+-\\d+\\(\\d+-\\d+\\)"],regularExpressions=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"].map((pattern=>{const expression=pattern.split("").map((index=>setTypes[index])).join(" ");return new RegExp(`^${expression}$`)}));function isValidPattern(score){return!score||regularExpressions.some((re=>re.test(score)))}function isTiebreakScore(part){return/^\(\d+\)$/.test(part)||/^\(\d+$/.test(part)}function isDiffOne(score){const stripped=null==(value=score)?void 0:value.split("-").join("").split("/").join("");var value;if(/^\d+$/.test(stripped)&&2===stripped.length){const scores=stripped.split("");return 1===Math.abs(scores.reduce(((a,b)=>+a-+b)))}}function getSuper(values,index){const parts=[values.slice(index,index+2),index?values.slice(0,1):values.slice(2)].map((n=>parseInt(n.join("")))),scores=index?parts.reverse():parts;if(Math.abs(scores.reduce(((a,b)=>+a-+b)))>=2)return scores.join("-")}function dashJoin(part){return 2===part.length?part.split("").join("-"):([", ",",","/"," "].forEach((separator=>part=part.split(separator).join("-"))),part=part.replace(/-{2,}/,"-"))}function isContained(part){return part.startsWith("(")&&part.endsWith(")")}function dashMash(segment){if(!/^[\d-]+(\(\d\))*$/.test(segment))return segment;const dashIndices=arrayIndices("-",segment.split(""));if(!dashIndices.length)return segment;const numbers=segment.split("-"),eventNumberCount=!(numbers.length%2),oddDashCount=!!(dashIndices.length%2);if(eventNumberCount&&oddDashCount&&dashIndices.length>numbers.length/2){dashIndices.filter(((_,i)=>i%2)).forEach((index=>{segment=segment.substring(0,index)+" "+segment.substring(index+1)}))}return segment}function setBuilder({score}){const chars=score.split(""),sets=[];let set;const resetSet=()=>set=[void 0,void 0,void 0],completeSet=()=>{let joinedSet=`${set[0]}-${set[1]}`;return set[2]&&(joinedSet+=` (${set[2]})`),resetSet(),set.push(set),joinedSet};resetSet();const getDiff=()=>void 0!==set[0]&&void 0!==set[1]&&Math.abs(parseInt(set[0])-parseInt(set[1]));for(;chars.length;){const char=chars.shift(),digit=isNumeric(char)&&parseInt(char),twoSetScores=void 0!==set[0]&&void 0!==set[1];if(isNumeric(digit)){if(void 0===set[0]){set[0]=digit;continue}if(void 0===set[1]&&(set[1]=digit,getDiff()>1)){sets.push(completeSet()),set=[void 0,void 0];continue}if(twoSetScores&&1===chars.length&&isNumeric(chars[0])){const lastChar=chars.pop();set[0]=set[0].toString()+set[1].toString(),set[1]=lastChar,sets.push(completeSet()),set=[void 0,void 0]}twoSetScores&&getDiff()}}return{sets}}function parseSuper(score){const oneIndex=score.indexOf("1"),numbers=score.split(""),allNumeric=numbers.every((n=>!isNaN(n)));if(allNumeric&&3===score.length&&0===oneIndex){const superTiebreak=getSuper(numbers,oneIndex);if(superTiebreak)return superTiebreak}if(allNumeric&&7===score.length&&oneIndex>3){const superTiebreak=getSuper(numbers.slice(4),oneIndex-4);if(superTiebreak)return`${numbers[0]}-${numbers[1]} ${numbers[2]}-${numbers[3]} ${superTiebreak}`}}function handleNumeric({score,applied,matchUpStatus}){const onlyNumbers=null==score?void 0:score.toString().split(""),allNumeric=null==onlyNumbers?void 0:onlyNumbers.every((d=>isNumeric(d))),getDiff=values=>Math.abs(values[0]-values[1]);if("number"==typeof score||allNumeric){score=score.toString().toLowerCase(),allNumeric&&(score=onlyNumbers.join(""));const numbers=allNumeric?onlyNumbers.map((n=>parseInt(n))):score.split("").map((n=>parseInt(n)));if(setBuilder({score}),numbers.length,3===score.length&&1===getDiff(numbers.slice(0,2))){const[s1,s2,tb]=numbers;score=`${s1}-${s2}(${tb})`,applied.push("numericTiebreakPattern1")}else if(3===score.length&&1===numbers[0]){const[mtb1,mtb2,mtb3]=numbers;score=`[${mtb1}${mtb2}-${mtb3}]`,applied.push("numericTiebreakPattern2")}else if(4===score.length&&1===getDiff(numbers.slice(0,2))&&"987654".split("").includes(numbers[0].toString())){const[s1,s2,tb1,tb2]=numbers;score=`${s1}-${s2}(${Math.min(tb1,tb2)})`,applied.push("numericTiebreakPattern3")}else if(4===score.length&&1===numbers[0]&&1===numbers[2]){const[tb1,tb2,tb3,tb4]=numbers;score=`[${tb1}${tb2}-${tb3}${tb4}]`,applied.push("bigSuper")}else if(4===score.length){const[s1,s2,s3,s4]=numbers;score=`${s1}${s2} ${s3}${s4}`,applied.push("split4")}else if(5===score.length&&1===getDiff(numbers.slice(0,2))){const[s1,s2,tb,s3,s4]=numbers;score=`${s1}-${s2}(${tb}) ${s3}-${s4}`,applied.push("numericTiebreakPattern4")}else if(5===score.length&&1===getDiff(numbers.slice(3))){const[s1,s2,s3,s4,tb]=numbers;score=`${s1}-${s2} ${s3}-${s4}(${tb})`,applied.push("numericTiebreakPattern5")}else if(7===numbers.length)if(getDiff(numbers.slice(0,2))>1&&getDiff(numbers.slice(2,4))>1&&1===numbers[4]){const[s1,s2,s3,s4,mtb1,mtb2,mtb3]=numbers;score=`${s1}-${s2} ${s3}-${s4} [${mtb1}${mtb2}-${mtb3}]`,applied.push("numericTiebreakPattern6")}else if(1===getDiff(numbers.slice(0,2))&&getDiff(numbers.slice(3,5))>1&&getDiff(numbers.slice(5,7))>1){const[s1,s2,tb,s3,s4,s5,s6]=numbers;score=`${s1}-${s2}(${tb}) ${s3}-${s4} ${s5}-${s6}`,applied.push("numericTiebreakPattern7")}else if(getDiff(numbers.slice(0,2))>1&&1===getDiff(numbers.slice(2,4))&&getDiff(numbers.slice(5,7))>1){const[s1,s2,s3,s4,tb,s5,s6]=numbers;score=`${s1}-${s2} ${s3}-${s4}(${tb}) ${s5}-${s6}`,applied.push("numericTiebreakPattern8")}else if(getDiff(numbers.slice(0,2))>1&&getDiff(numbers.slice(2,4))>1&&1===getDiff(numbers.slice(4,6))){const[s1,s2,s3,s4,s5,s6,tb]=numbers;score=`${s1}-${s2} ${s3}-${s4} ${s5}-${s6}(${tb})`,applied.push("numericTiebreakPattern9")}else score=score.slice(0,2)+" "+score.slice(2,4)+" "+score.slice(4),applied.push("numericMatchTiebreakPattern");else if(score.length%2){const superParse=parseSuper(score);superParse&&score!==superParse&&applied.push("parsedSuperPattern"),score=superParse||score}else{const chunks=chunkArray(score.split(""),2).map((part=>part.join(""))),chunkCharacter=chunks.map((chunk=>{const[s1,s2]=chunk.split("").map((s=>parseInt(s))),winner=s1>s2?1:2;return Math.abs(s1-s2)>1&&winner||-1*winner})),allWinners=chunkCharacter.reduce(((a,b)=>a>0&&b>0),1),instances=instanceCount(chunkCharacter),positiveInstances=instanceCount(chunkCharacter.map((c=>Math.abs(c)))),set1tb=chunkCharacter[0]<0,set2tb=!set1tb&&chunkCharacter[1]<0;if(chunkCharacter[0]>0&&chunkCharacter[1]>0&&chunkCharacter[0]!==chunkCharacter[1])score=[chunks.slice(0,2).join(" "),chunks.slice(2).join("-")].join(" "),applied.push("numeric3rdSetTiebreakPattern");else if(allWinners)score=chunks.join(" "),applied.push("chunkSplit");else if(6==numbers.length){if(2==instances[1]||2===instances[2])if(Object.values(positiveInstances).includes(3)){const[n1,n2,n3,n4,n5,n6]=numbers,tiebreakChunkIndex=chunkCharacter.reduce(((index,chunk,i)=>chunk<0?i:index),void 0);if(0===tiebreakChunkIndex){score=`${n1}-${n2}(${Math.min(n3,n4)}) ${n5}-${n6}`,applied.push("chunkSplitTiebreak1")}else if(1===tiebreakChunkIndex){score=`${n1}-${n2} ${n3}-${n4}(${Math.min(n5,n6)})`,applied.push("chunkSplitTiebreak2")}else score=`${n1}-${n2} ${n3}-${n4}`,applied.push("chunkSplitTrimExtraneous")}else score=chunks.join(" "),applied.push("chunkSplit")}else if(8===numbers.length){const[n1,n2,n3,n4,n5,n6,n7,n8]=numbers;set1tb||set2tb?1===numbers[5]&&(score=set1tb?`${n1}-${n2}(${n3}) ${n4}-${n5} [${n6}${n7}-${n8}]`:`${n1}-${n2} ${n3}-${n4}(${n5}) [${n6}${n7}-${n8}]`):(chunkCharacter[0],chunkCharacter[1])}}}return{score,applied,matchUpStatus}}function getWinningSide(score){const setsWon=[0,0],setWinners=[],sets=score.split(" "),getSetScores=/(\d+)-(\d+)/;sets.forEach((set=>{if(getSetScores.test(set)){const setScores=set.match(getSetScores).slice(1).map((s=>parseInt(s))),winningSide2=setScores[0]>setScores[1]?1:setScores[1]>setScores[0]&&2;winningSide2&&(setsWon[winningSide2-1]+=1,setWinners.push(winningSide2))}}));const winningSide=setsWon[0]>setsWon[1]?1:setsWon[1]>setsWon[0]&&2,setsTied=setsWon[0]>0&&setsWon[0]===setsWon[1],totalSets=setsWon.reduce(((a,b)=>a+b),0);return{setsWon,setsTied,setWinners,totalSets,winningSide}}const transforms={handleTiebreakSlashSeparation:function handleTiebreakSlashSeparation({score}){const re=new RegExp(/\(\d+\/\d+\)/g),tiebreaks=score.match(re);for(const tiebreak of tiebreaks||[]){const replacement=tiebreak.replace("/","-");score=score.replace(tiebreak,replacement)}return{score}},handleSetSlashSeparation:function handleSetSlashSeparation({score}){return new RegExp(/-\d+\/\d+-/).test(score)&&(score=score.split("/").join(" ")),{score}},punctuationAdjustments:function punctuationAdjustments({score,applied}){score=function correctContainerMismatch(score){const types="[];()",openers=["[];"[0],"()"[0]],typeCount=Object.assign({},...types.split("").map((char=>({[char]:0}))));let lastType="";const corrected=score.split("").map((char=>{const type=types.includes(char)&&char,isOpener=openers.includes(type);if(isOpener&&type)return typeCount[type]+=1,lastType=type,char;if(!isOpener&&type&&lastType&&type!==lastType){typeCount[lastType]-=1;const domain="[];".includes(lastType)?"[];":"()".includes(lastType)&&"()",complement=domain.split("").find((c=>c!==lastType));if(!domain.includes(type))return typeCount[type]||(lastType=""),complement;typeCount[lastType]||(lastType="")}return char})).join("");return score!==corrected?corrected:score}(score);const closeParenDigit=/\)(\d+)/g;if(closeParenDigit.test(score))for(const instance of score.match(closeParenDigit)){const replacement=instance.replace(")",") ");score=score.replace(instance,replacement)}const bws=/\(([\d- ]+)\)/,ws=(score=(score=score.replace(/\)\//g,") / ")).replace(/\/\)/g,")")).match(/\(([\d- ]+)\)/g);for(const s of ws||[]){const[v]=s.match(bws).slice(1),trimmedBracketValue=v.replace(/ /g,"");score=score.replace(s,`(${trimmedBracketValue})`)}let doubleBracketed=/\(\(\d-\d\)\)/g;if(doubleBracketed.test(score)){const dbls=score.match(doubleBracketed);dbls.length&&dbls.forEach((dbl=>{const m=dbl.match(/\((\(\d-\d\))\)/).slice(1)[0];score=score.replace(dbl,m)}))}if(doubleBracketed=/\(\((\d)\)\)/g,doubleBracketed.test(score)){const dbls=score.match(doubleBracketed);dbls.length&&dbls.forEach((dbl=>{const m=dbl.match(/\((\(\d\))\)/).slice(1)[0];score=score.replace(dbl,m)}))}/(^|\s)6-,/.test(score)&&(score=score.replace(/(^|\s)6-,/g,"6-0,"));const repeatingDash=new RegExp(/[-,]{2,}/g);score=score.replace(repeatingDash,"-"),["- "," -"].forEach((dashScenario=>{const dashSpace=new RegExp(`(\\d+)${dashScenario}(\\d+)`,"g"),spacedDash=score.match(dashSpace);spacedDash&&spacedDash.forEach((spaced=>score=score.replace(spaced,spaced.split(dashScenario).join("-"))))})),/^[(-/,]+$/.test(score)&&(score=""),/\)[-/,]+$/.test(score)&&(score=score.slice(0,score.length-1)),/\d \/\d/.test(score)&&(score=score.replace(/ \//g,"/")),score.includes(" /")&&(score=score.replace(/ \//g," "));const ghost=/\(\d+, \)/g;if(ghost.test(score)){score.match(ghost).forEach((g=>{const[digits]=g.match(/\((\d+), \)/).slice(1);2===digits.length?score=score.replace(g,`(${digits})`):1===digits.length&&"6"===digits&&(score=score.replace(g,"(6-0)"))}))}const slashClose=/\((\d+)\/\)/g;if(slashClose.test(score)){score.match(slashClose).forEach((s=>{const[digits]=s.match(/\((\d+)\/\)/).slice(1);score=2===digits.length?score.replace(s,`(${digits})`):1===digits.length&&"6"===digits?score.replace(s,"(6-0)"):score.replace(s,`(${digits})`)}))}const slashComma=/\d\/\d\/,/g;if(slashComma.test(score)){score.match(slashComma).forEach((s=>{const[digits]=s.match(/(\d\/\d)\/,/).slice(1);score=score.replace(s,`${digits},`),applied.push("slashComma")}))}const slashOpen=/\(\/(\d+)\)/g;if(slashOpen.test(score)){score.match(slashOpen).forEach((s=>{const[digits]=s.match(/\(\/(\d+)\)/).slice(1);score=2===digits.length?score.replace(s,`(${digits})`):1===digits.length&&parseInt(digits)<6?score.replace(s,`(6-${digits})`):score.replace(s,`(${digits})`)}))}let missingOpenParen,missingCloseParen,missingCloseBracket,noClose,counts;const getMissing=()=>{counts=instanceCount(score.split("")),missingCloseParen=counts["("]===(counts[")"]||0)+1,missingOpenParen=(counts["("]||0)+1===counts[")"],missingCloseBracket=counts["["]===counts["]"]+1,noClose=missingCloseParen&&!missingCloseBracket};getMissing();const unclosed=/(\d+-\d+\(\d+)0,/;if(unclosed.test(score)){const[setScore]=score.match(unclosed).slice(1);score=score.replace(unclosed,setScore+")")}if(counts["("]===counts[")"]&&counts["("]>1){const parts=score.split(")(").join(") (").split(" ");score=parts.every(isContained)?parts.map((part=>{const innards=part.slice(1,part.length-1);return innards.length>2?innards:part})).join(" "):parts.join(" ")}getMissing();const hasAlpha=/[A-Za-z]+/.test(score),hasDigits=/\d+/.test(score);if(!hasAlpha&&!hasDigits)return{score:""};if(/^\[.+\]$/.test(score)&&"()/,- ".split("").some((punctuation=>counts[punctuation]))&&(score=score.slice(1,score.length-1)),/^\(.+\)$/.test(score)&&1===counts["("]&&1===counts[")"]&&"[]/,".split("").some((punctuation=>counts[punctuation]>1))&&(score=score.slice(1,score.length-1)),score.startsWith("(")&&score.endsWith("))")&&(score=score.slice(1,score.length-1)),counts["("]>(counts[")"]||0)&&"("===score[score.length-1]&&(score=score.slice(0,score.length-1)+")",getMissing()),1!==counts["("]||counts[")"]||"("!==score[0]||(score+=")",getMissing()),counts["("]>(counts[")"]||0)&&"(("===score.slice(0,2)&&(score=score.slice(1)),missingOpenParen){if(/^9\d/.test(score))score="("+score.slice(1);else if("("!==score[0])score="("+score;else{let reconstructed=[],open=0;for(const char of score.split("").reverse())")"===char&&(open?reconstructed.push("("):open+=1),"("===char&&(open-=1),reconstructed.push(char);reconstructed.reverse(),score=reconstructed.join("")}getMissing()}if(counts[")"]>(counts["("]||0)&&")"===score[0]&&(score="("+score.slice(1),getMissing()),noClose&&(score.endsWith(9)||/\d+0$/.test(score))&&(score=score.slice(0,score.length-1)+")",getMissing()),!noClose||score.endsWith(")")&&!score.startsWith("((")||(score+=")",getMissing()),noClose){let reconstructed="",open=0;for(const char of score.split(""))"("===char&&(open?reconstructed+=")":open+=1),")"===char&&(open-=1),reconstructed+=char;score=reconstructed}if(getMissing(),missingCloseBracket&&!missingCloseParen&&(score+="]"),score.includes("([")&&score.includes("])")&&(score=score.split("([").join("[").split("])").join("]"),getMissing()),/\(\d+0$/.test(score)&&(score=score.slice(0,score.length-1)+")"),getMissing(),1===counts[")"]&&!counts["("]&&score.endsWith(")")&&(score=score.slice(0,score.length-1)),score.startsWith("(")&&score.endsWith(")")&&1===counts["("]&&1===counts[")"]&&(score=score.slice(1,score.length-1),getMissing()),/^\([\d ]+.*[\d ]+\)$/.test(score)&&counts["("]===counts[")"]){const proposed=score.slice(1,score.length-1);(value=>{const open=value.indexOf("("),close=value.indexOf(")");return open>=0&&close>=0&&open<close})(proposed)&&(score=proposed,getMissing())}return{score,applied}},handleGameSeparation:function handleGameSeparation({score}){const re=new RegExp(/^\d+\/\d+/),parts=score.split(" ");parts.some((part=>re.test(part)))&&(score=parts.map((part=>re.test(part)?part.replace("/","-"):part)).join(" "));const singleSet=/^(\d+), *(\d+)$/;if(singleSet.test(score)){const[s1,s2]=score.match(singleSet).slice(1);score=[s1,s2].join("-")}return{score}},joinFloatingTiebreak:function joinFloatingTiebreak({score}){if("string"!=typeof score)return{score};const strip=value=>null==value?void 0:value.split("-").join("").split("/").join(""),bracketToParen=value=>value.split("[").join("(").split("]").join(")");let parts=(score=score.split(", ").join(" ")).split(" ");score=parts.map((part=>{const deDash=/^-(\d+)$/;if(deDash.test(part)){const[value]=part.match(deDash).slice(1);if(2===value.length)return value.split("").join("-")}return part})).join(" "),parts=score.split(" ");const floatingTiebreaks=parts.filter(isTiebreakScore);let lastIndex=0,joinedScore="";for(const floatingTiebreak of floatingTiebreaks){const thisIndex=arrayIndices(floatingTiebreak,parts).filter((index=>!lastIndex||index>lastIndex))[0],leading=parts.slice(lastIndex,thisIndex-1),prior=parts[thisIndex-1],stripped=strip(prior);if(/^\d+$/.test(stripped)&&2===stripped.length){const scores=stripped.split(""),diff=Math.abs(scores.reduce(((a,b)=>+a-+b)));if(1===diff){joinedScore+=[leading.join(" "),[prior,floatingTiebreak].join("")].join(" "),lastIndex=thisIndex+1}else if(0===diff){const sameScore=Math.max(...scores);if([4,5,6,7,8,9].includes(sameScore)){const setScore=[sameScore,[6,4].includes(sameScore)?sameScore+1:sameScore-1].sort().reverse().join("-");joinedScore+=[leading.join(" "),[setScore,floatingTiebreak].join("")].join(" "),lastIndex=thisIndex+1}}}}if(floatingTiebreaks.length&&joinedScore.length){return joinedScore=[joinedScore,parts.slice(lastIndex).join(" ")].join(" "),{score:joinedScore.trim()}}if(2===parts.length&&["(","["].some((punctuation=>parts[1].includes(punctuation)))){const scores=strip(parts[0]).split("");if(1===Math.abs(scores.reduce(((a,b)=>+a-+b),0)))return parts[1]=bracketToParen(parts[1]),{score:parts.join("")}}const parenScores=parts.map((part=>function isBracketScore(part){return/^\(\d+-\d+\)$/.test(part)||/^\[\d+-\d+\]$/.test(part)}(part)?"bracket":isDiffOne(part)&&"set"));if(parenScores.includes("set")&&parenScores.includes("bracket")){let lastPart,joinedParts="";return parts.forEach(((part,i)=>{"bracket"===parenScores[i]&&"set"===lastPart?(part=bracketToParen(part),joinedParts+=part):joinedParts+=` ${part}`,lastPart=parenScores[i]})),{score:joinedParts.trim()}}let lastSet;parts=score.split(" ");let profile=parts.map((part=>{const re=new RegExp(/^(\d+)-(\d+)$/);if(re.test(part)){const[n1,n2]=part.match(re).slice(1),diff=Math.abs([n1,n2].reduce(((a,b)=>+a-+b))),max=Math.max(n1,n2);if(1===diff)return lastSet="tiebreakSet",lastSet;if(diff>=2&&max>=7&&"tiebreakSet"===lastSet)return lastSet="tiebreak",lastSet}}));const tiebreakIndices=arrayIndices("tiebreak",profile);if(tiebreakIndices.length){let joinedParts="";parts.forEach(((part,i)=>{tiebreakIndices.includes(i)?joinedParts+=`(${part}) `:tiebreakIndices.includes(i+1)?joinedParts+=`${part}`:joinedParts+=`${part} `})),score=joinedParts.trim()}const setCheck=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(setCheck.test(score)){const[setScore,t1,t2]=score.match(setCheck).slice(1),potentialSuper=Math.max(t1,t2)>=10;!isDiffOne(setScore)&&potentialSuper&&(score=score.replace(setCheck,`${setScore} [${t1}-${t2}]`))}return profile=[],score=score.split(" ").map((set=>{const getContained=/^\((.*)\)$/,isContained=getContained.test(set),setType=(new RegExp("\\[\\d+-\\d+\\]").test(set)?"super":new RegExp("\\d+-\\d+\\(\\d+\\)").test(set)&&"tiebreak")||new RegExp("\\d+-\\d+").test(set)&&"standard"||"unknown";return profile.push(setType),"standard"===setType&&isContained?set.match(getContained)[1]:set})).join(" "),{score}},handleBracketSpacing:function handleBracketSpacing({score,applied}){return score.includes("( ")&&(applied.push("removeParenSpacingAfterOpen"),score=score.split("( ").map((part=>part.trim())).join("(")),score.includes(" )")&&(applied.push("removeParenSpacingBeforeClose"),score=score.split(" )").map((part=>part.trim())).join(")")),[standardSetComma,tiebreakSetComma].forEach((setComma=>{const setsEndComma=score.match(setComma);(null==setsEndComma?void 0:setsEndComma.length)&&(setsEndComma.forEach((commaEnd=>{score=score.replace(commaEnd,commaEnd.slice(0,commaEnd.length-1)+" ")})),applied.push("setsEndComma"))})),{score:score=score.split(" ").filter(Boolean).map(dashMash).join(" "),applied}},handleSpaceSeparator:function handleSpaceSeparator({score}){if(score.includes(",")){const sets=score.split(",").map((set=>set.trim())),isSpaced=set=>/\d \d/.test(set);sets.every(isSpaced)&&(score=sets.map((set=>{const spaceSeparatedDigits=/\d+ \d+/g;for(const ssd of set.match(spaceSeparatedDigits)){const[d1,d2]=ssd.match(/(\d+) (\d+)/).slice(1);set=set.replace(ssd,`${d1}-${d2}`)}return set})).join(" "))}if(score.includes(" ")){const noSpaces=score.replace(/[ ,]/g,"");noSpaces.split("").every((char=>isNumeric(char)))&&4===noSpaces.length&&(score=noSpaces)}return{score}},separateScoreBlocks:function separateScoreBlocks({score,applied}){return"string"!=typeof score?{score}:{score:score=score.toLowerCase().split(" ").map((part=>{if(/^\d+$/.test(part)&&part.length>2){const oneIndex=part.indexOf("1");if(part.length%2){if(3===part.length&&0===oneIndex){const tiebreakScore=getSuper(part.split(""),oneIndex);return applied.push("getSuper"),tiebreakScore}}else{const{score:xPart,applied:app}=handleNumeric({score:part,applied:[]});xPart!==part&&(part=xPart,applied.push(...app))}}return part})).join(" "),applied}},matchKnownPatterns:function matchKnownPatterns({score,applied}){for(const punctuation of[".",","," ","/"]){const re=new RegExp(`^(\\d+)\\${punctuation}(\\d+)$`);if(re.test(score)){const numbers=score.match(re).slice(1).map((n=>parseInt(n))),diff=Math.abs(numbers[0]-numbers[1]);diff<=10&&diff>=2&&(score=score.split(punctuation).join("-"),applied.push("variedJoinerPattern"))}}score.includes(";")&&(score=score.split(";").join(" "),applied.push("semicolon set separation"));const smashSlash=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(smashSlash.test(score)){const[before,s1,s2,s3,s4,after]=score.match(smashSlash).slice(1);score=score.replace(smashSlash,`${before}${s1}-${s2} ${s3}-${s4}${after}`),applied.push("smashSlashPattern")}/.*\s6[/-]+$/.test(score)&&(score+="0",applied.push("incompleteFinalSetPattern"));const missingZero=/\(6,\)/g;missingZero.test(score)&&(score=score.replace(missingZero,"(6, 0)"),applied.push("missingZeroPattern1"));const noSpacing=/^\d{3,}\(/,parenStart=/\(\d+\)\d+/;[noSpacing,parenStart].forEach((()=>{const parts=score.split(" ");score=parts.map((part=>(noSpacing.test(part)&&(part=part.replace("("," (")),parenStart.test(part)&&(part=part.replace(")",") ")),part))).join(" "),applied.push("spaceConsiderationPatterns")}));let deDashMash=dashMash(score);deDashMash!==score&&(score=deDashMash,applied.push("deDashMash"));const smashedSets=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(smashedSets.test(score)){const[s1,ss,s4]=score.match(smashedSets).slice(1),[s2,s3]=ss.split("");score=`${s1}-${s2} ${s3}-${s4}`,applied.push("smashSetPattern")}const setSpacing=/^(\d+)[ -](\d+)$/,slashSeparation=/^([\d -]+)\/([\d -]+)$/;if(slashSeparation.test(score)){const[left,right]=score.match(slashSeparation).slice(1),s1=left.trim(),s2=right.trim();if(setSpacing.test(s1)&&setSpacing.test(s2)){const set1=s1.match(setSpacing).slice(1,3).join("-"),set2=s2.match(setSpacing).slice(1,3).join("-");score=`${set1} ${set2}`,applied.push("slashSeparationPattern")}}const commaSeparation=/^([\d -]+),([\d -]+)$/;if(commaSeparation.test(score)){const[left,right]=score.match(commaSeparation).slice(1),s1=left.trim(),s2=right.trim();if(setSpacing.test(s1)&&setSpacing.test(s2)){const set1=s1.match(setSpacing).slice(1,3).join("-"),set2=s2.match(setSpacing).slice(1,3).join("-");score=`${set1} ${set2}`,applied.push("commaSeparationPattern")}}const singleSetCommaSeparation=/^\d \d,/;if(singleSetCommaSeparation.test(score)){const set=score.match(singleSetCommaSeparation)[0],replacement=set.slice(0,set.length-1).split(" ").join("-");score=score.replace(set,replacement),applied.push("singleSetCommaSeparationPattern")}let failSafe=0;const noSetSeparation=/(\d+)-(\d{2})-(\d+)/;for(;noSetSeparation.test(score)&&failSafe<3;){const[left,middle,right]=score.match(noSetSeparation).slice(1),separated=middle.split(""),reformatted=`${left}-${separated[0]} ${separated[1]}-${right}`;score=score.replace(noSetSeparation,reformatted),applied.push("noSetSeparationPattern"),failSafe+=1}const floatingTiebreaks=score.match(/(^|\s)7-6\s(\d+)\s/g);if(null==floatingTiebreaks?void 0:floatingTiebreaks.length){const getFloatingTiebreak=/(^|\s)7-6\s(\d+)\s/;floatingTiebreaks.forEach((floater=>{const tiebreakScore=floater.match(getFloatingTiebreak).slice(2)[0];score=score.replace(floater,`7-6(${tiebreakScore}) `),applied.push("floatingTiebreakPattern1")}))}let spaceSeparatedSets=score.match(/\d \d /);null==spaceSeparatedSets||spaceSeparatedSets.forEach((ss=>{const replacement=ss.slice(0,ss.length-1).split(" ").join("-");score=score.replace(ss,replacement),applied.push("spaceSeparatedSetPattern1")})),spaceSeparatedSets=score.match(/ \d \d$/),null==spaceSeparatedSets||spaceSeparatedSets.forEach((ss=>{const replacement=" "+ss.slice(1).split(" ").join("-");score=score.replace(ss,replacement),applied.push("spaceSeparatedSetPattern2")}));const slashCommaSets=/^\d, *\d\/\d, *\d/;if(slashCommaSets.test(score)){const excerpt=score.match(slashCommaSets)[0],replacement=excerpt.split("/").map((e=>`(${e})`)).join(" ")+" ";score=score.replace(excerpt,replacement),applied.push("slashCommaSetPattern")}const missedSet0=/\(6-\)/g;missedSet0.test(score)&&(score=score.replace(missedSet0,"(6-0)"),applied.push("missingZeroPattern2"));const slashSetGlobal=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(slashSetGlobal.test(score)){const slashSets=score.match(slashSetGlobal),slashSet=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)");let newScore=score;slashSets.forEach((set=>{const[s1,s2]=set.match(slashSet).slice(1),dashSet=`${s1}-${s2}`;newScore=newScore.replace(set,dashSet)})),score=newScore,applied.push("slashSetPattern")}const spaceSeparatedSuper=/(.*)\s(1\d)\s(\d+)$/;if(spaceSeparatedSuper.test(score)){const[start,s1,s2]=score.match(spaceSeparatedSuper).slice(1);start.replace(/\D/g,"").length>=4&&(score=start+` ${s1}${s2}`,applied.push("spaceSeparatedSuperPattern"))}const spaceSeparatedSetTB=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(const ssb of score.match(spaceSeparatedSetTB)||[]){const[before,setScore,tb,after]=ssb.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[s1,s2]=setScore.split("-").map((s=>parseInt(s)));1===Math.abs(s1-s2)&&(score=score.replace(ssb,`${before}${setScore}(${tb})${after}`),applied.push("spaceSeparatedSetPattern"))}const getFloaters=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(const floater of score.match(getFloaters)||[]){const getFloater=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[setScore,tb,tail]=floater.match(getFloater).slice(1),[s1,s2]=setScore.split("-").map((s=>parseInt(s)));1===Math.abs(s1-s2)&&(score=score.replace(floater,`${setScore}(${tb})${tail}`),applied.push("floatingTiebreakPattern2"))}const getSpacedTibreakSets=/(^|\s)(\d \d)\(/g;for(const spacedTB of score.match(getSpacedTibreakSets)||[]){const getSpacedTibreakSet=/(^|\s)(\d \d)\(/,[before,spacedScore]=spacedTB.match(getSpacedTibreakSet).slice(1);score=score.replace(spacedTB,`${before}${spacedScore.split(" ").join("-")}(`),applied.push("spacedTiebreakPattern")}return{score,applied}},removeDanglingBits:function removeDanglingBits({score,attributes}){(score.endsWith(" am")||score.endsWith(" pm"))&&(score=""),score=score.replace(/[A-Za-z]+/g,"").trim(),[".",","].some((punctuation=>score.endsWith(punctuation)))&&(score=score.slice(0,score.length-1));const targetPunctuation="()/-".split("").some((punctuation=>score.includes(punctuation)));if(/ \d$/.test(score)&&targetPunctuation){attributes={removed:score.slice(score.length-2).trim()},score=score.slice(0,score.length-2)}const alphaEnding=/(.*)[A-Za-z]+$/;if(alphaEnding.test(score)){const scorePart=score.match(alphaEnding).slice(1)[0];score=scorePart.trim()}return{score,attributes}},removeErroneous:function removeErroneous({score,applied}){if("string"!=typeof score)return{score};if([3,4].includes(score.length)&&parseSuper(score)){return{score:parseSuper(score)}}return{score:score=score.toLowerCase().split(" ").map((part=>{if(!/^\d+$/.test(part)||1!==part.length)return part;applied.push("removeErroneous1")})).filter(Boolean).join(" "),applied}},handleWalkover:function handleWalkover({score,applied}){return["walkover","wo","w/o","w-o"].includes(null==score?void 0:score.toString().toLowerCase())?(applied.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied}):{score}},properTiebreak:function properTiebreak({score,matchUpStatus}){var _a;let parts=null==score?void 0:score.split(" ");score=parts.map((part=>{if(part.endsWith("]")){const setScores=part.split("[");if(isDiffOne(setScores[0]))return setScores[0]+`(${setScores[1].slice(0,setScores[1].length-1)})`}return part})).join(" ");const tb=new RegExp(/(\([\d ]+\))/g);if(tb.test(score))for(const t of score.match(tb)){let tiebreakScore=null==(_a=t.replace(" ","-").match(/\((.*)\)/))?void 0:_a[1];if(isNumeric(tiebreakScore)&&(null==tiebreakScore?void 0:tiebreakScore[0])>2)if([2,4].includes(tiebreakScore.length))tiebreakScore=tiebreakScore.split("").join("-");else if(3===tiebreakScore.length){const oneIndex=tiebreakScore.indexOf("1");tiebreakScore=getSuper(tiebreakScore.split(""),oneIndex)}score=score.replace(t,`(${tiebreakScore})`)}parts=null==score?void 0:score.split(" ");let re=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/);const lastIndex=parts.length-1;score=parts.map(((part,index)=>{const considerCompleted=[void 0,"","COMPLETED"].includes(matchUpStatus)||index!==lastIndex;if(re.test(part)&&considerCompleted){const[set,tb1,tb2]=Array.from(part.match(re)).slice(1);return`${set}(${Math.min(tb1,tb2)})`}return part})).join(" "),parts=null==score?void 0:score.split(" "),re=new RegExp(/^(\d{2})\((\d+)\)$/),score=parts.map((part=>{if(re.test(part)){const[set,lowTiebreakScore]=Array.from(part.match(re)).slice(1),setScores=set.split("");return`${setScores[0]}-${setScores[1]}(${lowTiebreakScore})`}return part})).join(" "),parts=null==score?void 0:score.split(" "),re=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),score=parts.map((part=>{if(re.test(part)){const[set,lowTiebreakScore]=Array.from(part.match(re)).slice(1);return isDiffOne(set)?`${set}(${lowTiebreakScore})`:set}return part})).join(" "),parts=null==score?void 0:score.split(" "),re=new RegExp(/^1-0\((\d+)\)$/),score=parts.map((part=>{if(re.test(part)){const[lowTiebreakScore]=part.match(re).slice(1);return`[${lowTiebreakScore<9?10:parseInt(lowTiebreakScore)+2}-${lowTiebreakScore}]`}return part})).join(" ");const misTyped0=/\((\d)+0 /;if(misTyped0.test(score)){const value=score.match(misTyped0)[1];score=score.replace(misTyped0,`(${value}) `)}return{score}},handleNumeric,handleRetired:function handleRetired({score,profile,applied}){var _a;score=null==score?void 0:score.toString().toLowerCase();const re=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(re.test(score)){const[leading]=score.match(re).slice(1);return applied.push("handleRetired"),{score:leading.trim(),matchUpStatus:"retired",applied}}const providerRetired=null==(_a=null==profile?void 0:profile.matchUpStatuses)?void 0:_a.retired,retired=["rtd",...Array.isArray(providerRetired)?providerRetired:[providerRetired].filter(Boolean)].find((ret=>null==score?void 0:score.endsWith(ret)));return retired?(applied.push("handleRetired"),{matchUpStatus:"retired",score:null==score?void 0:score.replace(retired,"").trim(),applied}):{score}},containedSets:function containedSets({score,attributes,identifier}){if("string"!=typeof score)return{score,identifier};const withParens=new RegExp(/\([\d,/ ]+\)/g),contained=score.match(withParens);for(const container of contained||[]){const[innards]=container.match(/^\((.*)\)$/).slice(1),priorDigits=score.split(container)[0].split(")").reverse()[0].replace(/\D/g,"");if(2===innards.length&&(null==priorDigits?void 0:priorDigits.length)>=2){const priorTwo=priorDigits.slice(priorDigits.length-2).split("").map((d=>parseInt(d)));if(1===Math.abs(priorTwo[0]-priorTwo[1]))continue}const mashed=dashMash(dashJoin(innards));score=score.replace(container,`(${mashed})`).trim()}const withBrackets=new RegExp(/\[[\d,/ ]+\]/g),bracketed=score.match(withBrackets);null==bracketed||bracketed.forEach((container=>{const innards=dashJoin(container.match(/^\[(.*)\]$/)[1]);score=score.replace(container,`(${innards}) `).trim()}));const potentialMiddles=[")(","), (",") (",")[",") [","](","] ("];if(score.startsWith("(")&&[")","]"].some((ending=>score.endsWith(ending)))&&potentialMiddles.some((middle=>score.includes(middle)))){let newScore="";const parts=score.split(/[)\]]/).filter(Boolean).map((part=>(part.startsWith(",")&&(part=part.slice(1)),part.trim()))),commadDelimited=parts.every((part=>part.includes(",")||isTiebreakScore(part))),slashDelimited=parts.every((part=>part.includes("/")||isTiebreakScore(part))),dashDelimited=parts.every((part=>part.includes("-")||isTiebreakScore(part))),delimiter=(commadDelimited?",":dashDelimited&&"-")||slashDelimited&&"/";if(delimiter){let lastPart;parts.forEach((part=>{if(part.startsWith("("))if("set"===lastPart&&(newScore+=" "),part.includes(delimiter))newScore+=part.slice(1).split(delimiter).map((s=>s.trim())).join("-"),lastPart="set";else{const value=part.slice(1);newScore+=`(${value}) `,lastPart="tiebreak"}else if(part.startsWith("[")){const values=part.slice(1).split(delimiter).map((s=>parseInt(s.trim()))),highValue=Math.min(...values);newScore+="set"===lastPart?`(${highValue}) `:`[${values.join("-")}] `,lastPart="tiebreak"}})),score=newScore.trim()}}let counts=instanceCount(score.split(""));1===counts["("]&&1===counts[")"]&&score.startsWith("(")&&score.endsWith(")")&&(score=score.slice(1,score.length-1),1===counts["-"]&&isDiffOne(score)&&isNumeric(null==attributes?void 0:attributes.removed)&&(score+=`(${attributes.removed})`,attributes.removed=void 0));const emptyParens=/\(\)/g;return emptyParens.test(score)&&(score=score.replace(emptyParens,"").trim()),{score}},sensibleSets:function sensibleSets({score,matchUpStatus,attributes}){const profile=[];let maxSetValue;const sets=score.split(" "),setsCount=sets.length;score=sets.map(((set,index)=>{if(new RegExp("\\d+-\\d+\\(\\d+\\)").test(set)){const tiebreak=set.slice(3),setScores=set.slice(0,3),sideScores=setScores.split("-");if(!isDiffOne(setScores)&&!matchUpStatus){const maxSetScore=Math.max(...sideScores),sensibleSetScores=[maxSetScore,maxSetScore-1];return(setScores.indexOf(maxSetScore)?sensibleSetScores.reverse().join("-"):sensibleSetScores.join("-"))+tiebreak}}else if(2===set.length&&isNumeric(set))return set.split("").join("-");set=dashMash(set);const setType=(new RegExp("^\\[\\d+-\\d+\\]$").test(set)?"super":new RegExp("^\\d+-\\d+\\(\\d+\\)$").test(set)&&"tiebreak")||new RegExp("^\\d+-\\d+$").test(set)&&"standard"||"unknown";if(profile.push(setType),setsCount>1&&"standard"===setType&&index<2){const[s1,s2]=set.split("-"),diff=Math.abs(parseInt(s1)-parseInt(s2)),max=Math.max(s1,s2),min=Math.min(s1,s2),minIndex=[parseInt(s1),parseInt(s2)].indexOf(min);if(max>9&&diff>2){const splitMax=max.toString().split(""),reasonable=splitMax.find((value=>parseInt(value)>min||index&&parseInt(value)<=maxSetValue))||splitMax[0];reasonable&&(set=minIndex?[reasonable,min].join("-"):[min,reasonable].join("-"))}max>(maxSetValue||0)&&(maxSetValue=max)}if("standard"===setType){const[s1,s2]=set.split("-");if(!Math.abs(parseInt(s1)-parseInt(s2))&&"RETIRED"!==matchUpStatus)return""}return set})).filter(Boolean).join(" ");const{setsWon,setWinners,totalSets}=getWinningSide(score);if(1===totalSets&&"6"===(null==attributes?void 0:attributes.removed)&&(score+=" 6-0"),score.split(" ").length>2&&Math.max(...setsWon)>=2&&setWinners[0]===setWinners[1]&&(score=score.split(" ").slice(0,2).join(" ")),Math.max(...setsWon)>2){let counts=[0,0];score=score.split(" ").map(((set,i)=>(counts[setWinners[i]]+=1,Math.max(...counts)>2?void 0:set))).filter(Boolean).join(" ")}return{score,profile}},stringScore:function stringScore({score}){return{score:score=(null==score?void 0:score.toString().toLowerCase())||""}},superSquare:function superSquare({score}){const{setsTied,winningSide}=getWinningSide(score),finalSetMatchTiebreak=/\s\((\d+)\)$/;if(!winningSide&&setsTied&&finalSetMatchTiebreak.test(score)){const lowTiebreakScore=score.match(finalSetMatchTiebreak).slice(1)[0],highTiebreakScore=lowTiebreakScore<=8?10:lowTiebreakScore+2;score=score.replace(finalSetMatchTiebreak,` [${highTiebreakScore}-${lowTiebreakScore}]`)}const sets=score.split(" "),finalSet=sets[sets.length-1];if(!finalSet.includes("-")||finalSet.indexOf("(")>0)return{score};let scores=finalSet.split("(").join("").split(")").join("").split("-");if(!scores.every((score2=>isNumeric(score2))))return{score};if("76"===scores[0]){const tb=2===scores[1].length?Math.min(...scores[1].split("").map((n=>parseInt(n)))):scores[1];score=[...sets.slice(0,sets.length-1),`7-6(${tb})`].join(" ")}else{scores=scores.map((score2=>parseInt(score2)));const maxSetScore=Math.max(...scores);let diff=Math.abs(scores[0]-scores[1]);if(maxSetScore>=10){if(diff>2&&scores.every((s=>+s>=10))){const modifiedScores=scores.map((s=>s===maxSetScore?s-10:10)).sort();diff=Math.abs(modifiedScores[0]-modifiedScores[1]),diff>2&&(scores=modifiedScores)}score=[...sets.slice(0,sets.length-1),`[${scores.join("-")}]`].join(" ")}else 3===sets.length&&maxSetScore>=7&&diff>2&&(score=[...sets.slice(0,sets.length-1),`[${scores.join("-")}]`].join(" "))}return{score}},setBuilder,excisions:function excisions({score}){const re=new RegExp(/^\[\d+\](.*)$/);re.test(score)&&(score=score.match(re).slice(1)[0].trim());const openComma=/\(,/g;return openComma.test(score)&&(score=score.replace(openComma,"(")),{score}},replaceOh:function replaceOh({score,applied}){return"string"!=typeof score?{score}:(score.toLowerCase().includes("o")&&(score=score.toLowerCase().split(" ").map((part=>part.split("o").join("0"))).join(" "),applied.push("replaceOh")),{score,applied})}};let transformations={};const processingOrder=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],secondPass=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];var __defProp$4j=Object.defineProperty,__getOwnPropSymbols$4k=Object.getOwnPropertySymbols,__hasOwnProp$4k=Object.prototype.hasOwnProperty,__propIsEnum$4k=Object.prototype.propertyIsEnumerable,__defNormalProp$4j=(obj,key,value)=>key in obj?__defProp$4j(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4j=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4k.call(b,prop)&&__defNormalProp$4j(a,prop,b[prop]);if(__getOwnPropSymbols$4k)for(var prop of __getOwnPropSymbols$4k(b))__propIsEnum$4k.call(b,prop)&&__defNormalProp$4j(a,prop,b[prop]);return a};const{FACTORY}=extensionConstants;function updateFactoryExtension({tournamentRecord,value}){const{extension}=findExtension$2({element:tournamentRecord,name:FACTORY});addExtension$1({element:tournamentRecord,extension:{name:FACTORY,value:__spreadValues$4j(__spreadValues$4j({},null==extension?void 0:extension.value),value)}})}function notifySubscribers({mutationStatus,tournamentId,directives,timeStamp}={}){const{topics}=getTopics();for(const topic of[...topics].sort(topicSort)){const notices=getNotices({topic});notices&&callListener({topic,notices})}mutationStatus&&timeStamp&&topics.includes(MUTATIONS)&&callListener({notices:[{tournamentId,directives,timeStamp}],topic:MUTATIONS})}const topicValues={unPublishEventSeeding:5,unPublishEvent:5,[UNPUBLISH_ORDER_OF_PLAY]:5,[MODIFY_SEED_ASSIGNMENTS]:5,[MODIFY_POSITION_ASSIGNMENTS]:5,[MODIFY_DRAW_DEFINITION]:5,modifyDrawEntries:5,modifyEventEntries:5,[MODIFY_MATCHUP]:1,[UPDATE_INCONTEXT_MATCHUP]:1,[MODIFY_PARTICIPANTS]:5,[MODIFY_VENUE]:5,[DELETED_MATCHUP_IDS]:4,[DELETE_PARTICIPANTS]:4,[DELETE_VENUE]:4,[DELETED_DRAW_IDS]:4,[ADD_MATCHUPS]:3,[ADD_DRAW_DEFINITION]:2};function topicSort(a,b){return(topicValues[b]||0)-(topicValues[a]||0)}function getVenuesAndCourts({tournamentRecords,convertExtensions,ignoreDisabled,venueIds=[],dates}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const uniqueVenueIds=[],uniqueCourtIds=[],venues=[],courts=[];return Object.keys(tournamentRecords).forEach((tournamentId=>{const tournamentRecord=tournamentRecords[tournamentId];for(const venue of tournamentRecord.venues||[])if(tournamentRecord.venues,!venueIds.length||venueIds.includes(venue.venueId)){if(ignoreDisabled){const{extension}=findExtension$2({name:DISABLED,element:venue});if(null==extension?void 0:extension.value)continue}uniqueVenueIds.includes(venue.venueId)||(venues.push(makeDeepCopy(venue,convertExtensions,!0)),uniqueVenueIds.push(venue.venueId));for(const court of venue.courts||[])if(!uniqueCourtIds.includes(court.courtId)){if(ignoreDisabled&&dates){const{extension}=findExtension$2({name:DISABLED,element:court});if(getDisabledStatus({extension,dates}))continue}const{inContextCourt}=getInContextCourt({convertExtensions,ignoreDisabled,venue,court});courts.push(inContextCourt),uniqueCourtIds.push(court.courtId)}}})),{courts,venues}}function getCompetitionVenues({tournamentRecords,requireCourts,dates}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};return Object.keys(tournamentRecords).reduce(((accumulator,tournamentId)=>{const tournamentRecord=tournamentRecords[tournamentId],{venues}=getVenuesAndCourts$1({tournamentRecord,dates});return venues.forEach((venue=>{const{venueId,courts}=venue;(!requireCourts||(null==courts?void 0:courts.length))&&!accumulator.venueIds.includes(venueId)&&(accumulator.venues.push(venue),accumulator.venueIds.push(venueId))})),accumulator}),{venues:[],venueIds:[]})}var __defProp$4i=Object.defineProperty,__getOwnPropSymbols$4j=Object.getOwnPropertySymbols,__hasOwnProp$4j=Object.prototype.hasOwnProperty,__propIsEnum$4j=Object.prototype.propertyIsEnumerable,__defNormalProp$4i=(obj,key,value)=>key in obj?__defProp$4i(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4i=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4j.call(b,prop)&&__defNormalProp$4i(a,prop,b[prop]);if(__getOwnPropSymbols$4j)for(var prop of __getOwnPropSymbols$4j(b))__propIsEnum$4j.call(b,prop)&&__defNormalProp$4i(a,prop,b[prop]);return a};function addTimeItem({duplicateValues=!0,creationTime=!0,removePriorValues,timeItem,element}){if(!timeItem)return{error:MISSING_TIME_ITEM};if(!element)return{error:MISSING_VALUE,info:ELEMENT_REQUIRED};const timeItemAttributes=timeItem&&Object.keys(timeItem),requiredAttributes=["itemType","itemValue"];if(!(requiredAttributes.filter((attribute=>timeItemAttributes.includes(attribute))).length===requiredAttributes.length))return{error:INVALID_TIME_ITEM};if(element.timeItems){const{itemType,itemSubTypes,itemValue}=timeItem,{timeItem:existingTimeItem}=getTimeItem({itemSubTypes,itemType,element});if(JSON.stringify(null==existingTimeItem?void 0:existingTimeItem.itemValue)===JSON.stringify(itemValue)&&!duplicateValues)return __spreadValues$4i({},SUCCESS)}else element.timeItems=[];if(timeItem.itemSubTypes&&!timeItem.itemSubTypes.length&&delete timeItem.itemSubTypes,creationTime){const createdAt=(new Date).toISOString();Object.assign(timeItem,{createdAt})}removePriorValues&&(element.timeItems=element.timeItems.filter((({itemType})=>timeItem.itemType!==itemType)));return removePriorValues&&!timeItem.itemValue||element.timeItems.push(timeItem),__spreadValues$4i({},SUCCESS)}function addParticipantTimeItem({creationTime=!0,removePriorValues,tournamentRecord,duplicateValues,participantId,timeItem}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participantId)return{error:MISSING_PARTICIPANT_ID};const result=findTournamentParticipant({tournamentRecord,participantId});return result.error?result:addTimeItem({element:result.participant,removePriorValues,duplicateValues,creationTime,timeItem})}function addTournamentTimeItem({removePriorValues,tournamentRecord,duplicateValues,creationTime,timeItem}){return tournamentRecord?addTimeItem({element:tournamentRecord,removePriorValues,duplicateValues,creationTime,timeItem}):{error:MISSING_TOURNAMENT_RECORD}}function addEventTimeItem({removePriorValues,duplicateValues,creationTime,timeItem,event}){return event?addTimeItem({removePriorValues,duplicateValues,element:event,creationTime,timeItem}):{error:EVENT_NOT_FOUND}}var __defProp$4h=Object.defineProperty,__getOwnPropSymbols$4i=Object.getOwnPropertySymbols,__hasOwnProp$4i=Object.prototype.hasOwnProperty,__propIsEnum$4i=Object.prototype.propertyIsEnumerable,__defNormalProp$4h=(obj,key,value)=>key in obj?__defProp$4h(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function addMatchUpTimeItem({removePriorValues,tournamentRecord,duplicateValues,drawDefinition,disableNotice,matchUpId,timeItem,event}){const{matchUp}=findMatchUp$1({drawDefinition,event,matchUpId});if(!matchUp)return{error:MATCHUP_NOT_FOUND};const result=addTimeItem({removePriorValues,element:matchUp,duplicateValues,timeItem});return disableNotice||modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,context:"addTimeItem",drawDefinition,matchUp}),result}function allocateTeamMatchUpCourts$1({removePriorValues,tournamentRecords,tournamentRecord,drawDefinition,disableNotice,courtDayDate,matchUpId,courtIds}){if(!tournamentRecord&&!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORD};if(!matchUpId)return{error:MISSING_MATCHUP_ID};const result=findMatchUp$1({drawDefinition,matchUpId});if(result.error)return result;if(result.matchUp.matchUpType!==TEAM_MATCHUP)return{error:INVALID_MATCHUP};if(!(void 0===courtIds||Array.isArray(courtIds)&&courtIds.length&&courtIds.every((id=>"string"==typeof id))))return{error:INVALID_VALUES,context:{courtIds}};let itemValue;if(courtIds){const result2=getVenuesAndCourts({tournamentRecords:tournamentRecords||{[tournamentRecord.tournamentId]:tournamentRecord}});if(result2.error)return result2;const specifiedCourts=result2.courts.filter((court=>courtIds.includes(court.courtId)));if(specifiedCourts.length!==courtIds.length)return{error:INVALID_VALUES,context:{courtIds}};itemValue=specifiedCourts.map((court=>({venueId:court.venueId,courtId:court.courtId})))}return addMatchUpTimeItem({duplicateValues:!1,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,timeItem:{itemType:ALLOCATE_COURTS,itemDate:courtDayDate,itemValue}})}function assignMatchUpVenue$1({removePriorValues,tournamentRecords,tournamentRecord,drawDefinition,disableNotice,matchUpId,venueId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!matchUpId)return{error:MISSING_MATCHUP_ID};if(venueId){const result=findVenue({tournamentRecords,tournamentRecord,venueId});if(result.error)return result}return addMatchUpTimeItem({duplicateValues:!1,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,timeItem:{itemType:ASSIGN_VENUE,itemValue:venueId}})}function assignMatchUpCourt$1({removePriorValues,tournamentRecords,tournamentRecord,drawDefinition,disableNotice,courtDayDate,matchUpId,courtId}){var _a;if(!tournamentRecord&&!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORD};if(!matchUpId)return{error:MISSING_MATCHUP_ID};if(courtId){const result=findCourt({tournamentRecords,tournamentRecord,courtId});if(result.error)return result;assignMatchUpVenue$1({tournamentRecord,drawDefinition,disableNotice,matchUpId,venueId:null==(_a=result.venue)?void 0:_a.venueId})}return addMatchUpTimeItem({duplicateValues:!1,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,timeItem:{itemType:ASSIGN_COURT,itemDate:courtDayDate,itemValue:courtId}})}var __defProp$4g=Object.defineProperty,__defProps$2u=Object.defineProperties,__getOwnPropDescs$2u=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4h=Object.getOwnPropertySymbols,__hasOwnProp$4h=Object.prototype.hasOwnProperty,__propIsEnum$4h=Object.prototype.propertyIsEnumerable,__defNormalProp$4g=(obj,key,value)=>key in obj?__defProp$4g(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4g=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4h.call(b,prop)&&__defNormalProp$4g(a,prop,b[prop]);if(__getOwnPropSymbols$4h)for(var prop of __getOwnPropSymbols$4h(b))__propIsEnum$4h.call(b,prop)&&__defNormalProp$4g(a,prop,b[prop]);return a},__spreadProps$2u=(a,b)=>__defProps$2u(a,__getOwnPropDescs$2u(b));function timeDate(value,scheduledDate){const time=validTimeString.test(value)?value:extractTime(value),date=extractDate(value)||extractDate(scheduledDate)||formatDate(new Date);return new Date(`${date}T${time}`)}function validTimeValue(value){return!(void 0!==value&&!timeValidation.test(value))}function addMatchUpScheduleItems$2({errorOnAnachronism=!1,checkChronology=!0,matchUpDependencies,removePriorValues,tournamentRecords,tournamentRecord,drawDefinition,disableNotice,matchUpId,matchUps,schedule,event}){var _a;if(!schedule)return{error:MISSING_VALUE,info:"Missing schedule"};if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!matchUpId)return{error:MISSING_MATCHUP_ID};const stack="drawEngine.addMatchUpScheduleItems";let warning;const result=findMatchUp$1({drawDefinition,event,matchUpId});if(result.error)return result;const matchUp=result.matchUp,{endTime,courtId,courtIds,courtOrder,resumeTime,scheduledDate,scheduledTime,startTime,stopTime,timeModifiers,venueId}=schedule;!checkChronology||matchUpDependencies&&matchUps||({matchUpDependencies,matchUps}=getMatchUpDependencies({drawDefinition}));const priorMatchUpIds=null==(_a=null==matchUpDependencies?void 0:matchUpDependencies[matchUpId])?void 0:_a.matchUpIds;if(schedule.scheduledDate&&checkChronology&&priorMatchUpIds){const priorMatchUpTimes=matchUps.filter((matchUp2=>{var _a2,_b;return((null==(_a2=matchUp2.schedule)?void 0:_a2.scheduledDate)||extractDate(null==(_b=matchUp2.schedule)?void 0:_b.scheduledTime))&&priorMatchUpIds.includes(matchUp2.matchUpId)})).map((({schedule:schedule2})=>{const isoDateString=getIsoDateString(schedule2);return new Date(isoDateString).getTime()}));if(null==priorMatchUpTimes?void 0:priorMatchUpTimes.length){const isoDateString=getIsoDateString(schedule),matchUpTime=new Date(isoDateString).getTime();if(Math.max(...priorMatchUpTimes)>=matchUpTime){if(errorOnAnachronism)return decorateResult({result:{error:ANACHRONISM},stack});warning=ANACHRONISM}}}if(void 0!==scheduledDate){const result2=addMatchUpScheduledDate$2({disableNotice:!0,removePriorValues,tournamentRecord,drawDefinition,scheduledDate,matchUpId});if(null==result2?void 0:result2.error)return decorateResult({result:result2,stack,context:{scheduledDate}})}if(void 0!==scheduledTime){const result2=addMatchUpScheduledTime$2({disableNotice:!0,removePriorValues,tournamentRecord,drawDefinition,scheduledTime,matchUpId});if(null==result2?void 0:result2.error)return decorateResult({result:result2,stack,context:{scheduledTime}})}if(void 0!==startTime){const result2=addMatchUpStartTime$2({disableNotice:!0,removePriorValues,tournamentRecord,drawDefinition,matchUpId,startTime,event});if(null==result2?void 0:result2.error)return decorateResult({result:result2,stack,context:{startTime}})}if(void 0!==stopTime){const result2=addMatchUpStopTime$2({disableNotice:!0,removePriorValues,tournamentRecord,drawDefinition,matchUpId,stopTime,event});if(null==result2?void 0:result2.error)return decorateResult({result:result2,stack,context:{stopTime}})}if(void 0!==resumeTime){const result2=addMatchUpResumeTime$2({disableNotice:!0,removePriorValues,tournamentRecord,drawDefinition,resumeTime,matchUpId,event});if(null==result2?void 0:result2.error)return decorateResult({result:result2,stack,context:{resumeTime}})}if(void 0!==endTime){const result2=addMatchUpEndTime$2({disableNotice:!0,removePriorValues,tournamentRecord,drawDefinition,matchUpId,endTime,event});if(null==result2?void 0:result2.error)return decorateResult({result:result2,stack,context:{endTime}})}if(void 0!==courtIds){const result2=allocateTeamMatchUpCourts$1({disableNotice:!0,removePriorValues,tournamentRecord,drawDefinition,matchUpId,courtIds});if(null==result2?void 0:result2.error)return decorateResult({result:result2,stack,context:{courtIds}})}if(void 0!==courtId&&void 0!==scheduledDate){const result2=assignMatchUpCourt$1({courtDayDate:scheduledDate,disableNotice:!0,removePriorValues,tournamentRecords,tournamentRecord,drawDefinition,matchUpId,courtId,event});if(null==result2?void 0:result2.error)return decorateResult({result:result2,stack,context:{courtId}})}if(void 0!==venueId){const result2=assignMatchUpVenue$1({disableNotice:!0,removePriorValues,tournamentRecords,tournamentRecord,drawDefinition,matchUpId,venueId,event});if(null==result2?void 0:result2.error)return decorateResult({result:result2,stack,context:{venueId}})}if(void 0!==courtOrder&&isConvertableInteger(courtOrder)){const result2=addMatchUpCourtOrder$2({disableNotice:!0,removePriorValues,tournamentRecords,tournamentRecord,drawDefinition,courtOrder,matchUpId,event});if(null==result2?void 0:result2.error)return decorateResult({result:result2,stack,context:{courtOrder}})}if(void 0!==timeModifiers&&Array.isArray(timeModifiers)){const result2=function addMatchUpTimeModifiers({removePriorValues,tournamentRecord,drawDefinition,disableNotice,timeModifiers,matchUpId}){if(!matchUpId)return{error:MISSING_MATCHUP_ID};if(timeModifiers&&!Array.isArray(timeModifiers))return{error:INVALID_VALUES,info:mustBeAnArray("timeModifiers")};const itemValue=timeModifiers;return addMatchUpTimeItem({duplicateValues:!1,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,timeItem:{itemType:TIME_MODIFIERS,itemValue}})}({disableNotice:!0,removePriorValues,tournamentRecords,tournamentRecord,drawDefinition,timeModifiers,matchUpId,event});if(null==result2?void 0:result2.error)return decorateResult({result:result2,stack,context:{timeModifiers}})}return disableNotice||modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,context:stack,drawDefinition,matchUp}),warning?__spreadProps$2u(__spreadValues$4g({},SUCCESS),{warnings:[warning]}):__spreadValues$4g({},SUCCESS)}function addMatchUpScheduledDate$2({removePriorValues,tournamentRecord,drawDefinition,disableNotice,scheduledDate,matchUpId}){if(!matchUpId)return{error:MISSING_MATCHUP_ID};const validDate=dateValidation.test(scheduledDate);if(scheduledDate&&!validDate)return{error:INVALID_DATE};return addMatchUpTimeItem({duplicateValues:!1,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,timeItem:{itemType:SCHEDULED_DATE,itemValue:scheduledDate}})}function addMatchUpCourtOrder$2({removePriorValues,tournamentRecord,drawDefinition,disableNotice,courtOrder,matchUpId}){if(!matchUpId)return{error:MISSING_MATCHUP_ID};if(courtOrder&&!isConvertableInteger(courtOrder))return{error:INVALID_VALUES,info:"courtOrder must be numeric"};const itemValue=parseInt(courtOrder);return addMatchUpTimeItem({duplicateValues:!1,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,timeItem:{itemType:COURT_ORDER,itemValue}})}function addMatchUpScheduledTime$2({removePriorValues,tournamentRecord,drawDefinition,disableNotice,scheduledTime,matchUpId}){if(!matchUpId)return{error:MISSING_MATCHUP_ID};if(!validTimeValue(scheduledTime))return{error:INVALID_TIME};return addMatchUpTimeItem({duplicateValues:!1,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,timeItem:{itemType:SCHEDULED_TIME,itemValue:scheduledTime}})}function addMatchUpOfficial$2({removePriorValues,tournamentRecord,drawDefinition,disableNotice,participantId,officialType,matchUpId}){if(!matchUpId)return{error:MISSING_MATCHUP_ID};return addMatchUpTimeItem({duplicateValues:!1,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,timeItem:{itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemSubTypes:[officialType],itemValue:participantId}})}function addMatchUpStartTime$2({removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,startTime,event}){if(!matchUpId)return{error:MISSING_MATCHUP_ID};if(!validTimeValue(startTime))return{error:INVALID_TIME};const{matchUp}=findMatchUp$1({drawDefinition,event,matchUpId}),{scheduledDate}=scheduledMatchUpDate({matchUp}),earliestRelevantTimeValue=(matchUp.timeItems||[]).filter((timeItem=>[STOP_TIME,RESUME_TIME,END_TIME].includes(null==timeItem?void 0:timeItem.itemType))).map((timeItem=>timeDate(timeItem.itemValue,scheduledDate))).reduce(((earliest,timeValue)=>!earliest||timeValue<earliest?timeValue:earliest),void 0);if(!earliestRelevantTimeValue||timeDate(startTime,scheduledDate)<earliestRelevantTimeValue){matchUp.timeItems&&(matchUp.timeItems=matchUp.timeItems.filter((timeItem2=>timeItem2.itemType!==START_TIME)));return addMatchUpTimeItem({duplicateValues:!1,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,timeItem:{itemType:START_TIME,itemValue:startTime}})}return{error:INVALID_START_TIME}}function addMatchUpEndTime$2({validateTimeSeries=!0,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,endTime,event}){if(!matchUpId)return{error:MISSING_MATCHUP_ID};if(!validTimeValue(endTime))return{error:INVALID_TIME};const{matchUp}=findMatchUp$1({drawDefinition,event,matchUpId}),{scheduledDate}=scheduledMatchUpDate({matchUp}),latestRelevantTimeValue=(matchUp.timeItems||[]).filter((timeItem=>[START_TIME,RESUME_TIME,STOP_TIME].includes(null==timeItem?void 0:timeItem.itemType))).map((timeItem=>timeDate(timeItem.itemValue,scheduledDate))).reduce(((latest,timeValue)=>!latest||timeValue>latest?timeValue:latest),void 0);if(!validateTimeSeries||!latestRelevantTimeValue||timeDate(endTime,scheduledDate)>latestRelevantTimeValue){matchUp.timeItems&&(matchUp.timeItems=matchUp.timeItems.filter((timeItem2=>timeItem2.itemType!==END_TIME)));return addMatchUpTimeItem({duplicateValues:!1,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,timeItem:{itemType:END_TIME,itemValue:endTime}})}return{error:INVALID_END_TIME}}function addMatchUpStopTime$2({removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,stopTime,event}){if(!matchUpId)return{error:MISSING_MATCHUP_ID};if(!validTimeValue(stopTime))return{error:INVALID_TIME};const{matchUp}=findMatchUp$1({drawDefinition,event,matchUpId}),{scheduledDate}=scheduledMatchUpDate({matchUp}),timeItems=matchUp.timeItems||[];if(timeItems.reduce(((hasEndTime2,timeItem)=>timeItem.itemType===END_TIME||hasEndTime2),void 0))return{error:EXISTING_END_TIME};const relevantTimeItems=timeItems.filter((timeItem=>[START_TIME,RESUME_TIME,STOP_TIME].includes(null==timeItem?void 0:timeItem.itemType))).sort(((a,b)=>timeDate(a.itemValue,scheduledDate)-timeDate(b.itemValue,scheduledDate))),lastRelevantTimeItem=relevantTimeItems[relevantTimeItems.length-1],lastRelevantTimeItemIsStop=lastRelevantTimeItem&&lastRelevantTimeItem.itemType===STOP_TIME,latestRelevantTimeValue=relevantTimeItems.filter((timeItem=>!lastRelevantTimeItemIsStop||timeItem.createdAt!==lastRelevantTimeItem.createdAt)).map((timeItem=>timeDate(timeItem.itemValue,scheduledDate))).reduce(((latest,timeValue)=>!latest||timeValue>latest?timeValue:latest),void 0);if(timeDate(stopTime,scheduledDate)>latestRelevantTimeValue){if(matchUp.timeItems&&lastRelevantTimeItemIsStop){const targetTimeStamp=lastRelevantTimeItem.createdAt;matchUp.timeItems=matchUp.timeItems.filter((timeItem2=>timeItem2.createdAt!==targetTimeStamp))}return addMatchUpTimeItem({duplicateValues:!0,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,timeItem:{itemType:STOP_TIME,itemValue:stopTime}})}return{error:INVALID_STOP_TIME}}function addMatchUpResumeTime$2({removePriorValues,tournamentRecord,drawDefinition,disableNotice,resumeTime,matchUpId,event}){if(!matchUpId)return{error:MISSING_MATCHUP_ID};if(!validTimeValue(resumeTime))return{error:INVALID_TIME};const{matchUp}=findMatchUp$1({drawDefinition,event,matchUpId}),{scheduledDate}=scheduledMatchUpDate({matchUp}),timeItems=matchUp.timeItems||[];if(timeItems.reduce(((hasEndTime2,timeItem)=>timeItem.itemType===END_TIME||hasEndTime2),void 0))return{error:EXISTING_END_TIME};const relevantTimeItems=timeItems.filter((timeItem=>[START_TIME,RESUME_TIME,STOP_TIME].includes(null==timeItem?void 0:timeItem.itemType))).sort(((a,b)=>timeDate(a.itemValue,scheduledDate)-timeDate(b.itemValue,scheduledDate))),lastRelevantTimeItem=relevantTimeItems[relevantTimeItems.length-1],lastRelevantTimeItemIsResume=lastRelevantTimeItem&&lastRelevantTimeItem.itemType===RESUME_TIME,latestRelevantTimeValue=relevantTimeItems.filter((timeItem=>!lastRelevantTimeItemIsResume||timeItem.createdAt!==lastRelevantTimeItem.createdAt)).map((timeItem=>timeDate(timeItem.itemValue,scheduledDate))).reduce(((latest,timeValue)=>!latest||timeValue>latest?timeValue:latest),void 0);if(timeDate(resumeTime,scheduledDate)>latestRelevantTimeValue){if(matchUp.timeItems&&lastRelevantTimeItemIsResume){const targetTimeStamp=lastRelevantTimeItem.createdAt;matchUp.timeItems=matchUp.timeItems.filter((timeItem2=>timeItem2.createdAt!==targetTimeStamp))}return addMatchUpTimeItem({duplicateValues:!0,removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,timeItem:{itemType:RESUME_TIME,itemValue:resumeTime}})}return{error:INVALID_RESUME_TIME}}var __defProp$4f=Object.defineProperty,__defProps$2t=Object.defineProperties,__getOwnPropDescs$2t=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4g=Object.getOwnPropertySymbols,__hasOwnProp$4g=Object.prototype.hasOwnProperty,__propIsEnum$4g=Object.prototype.propertyIsEnumerable,__defNormalProp$4f=(obj,key,value)=>key in obj?__defProp$4f(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4f=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4g.call(b,prop)&&__defNormalProp$4f(a,prop,b[prop]);if(__getOwnPropSymbols$4g)for(var prop of __getOwnPropSymbols$4g(b))__propIsEnum$4g.call(b,prop)&&__defNormalProp$4f(a,prop,b[prop]);return a},__spreadProps$2t=(a,b)=>__defProps$2t(a,__getOwnPropDescs$2t(b));function bulkScheduleMatchUps$1({errorOnAnachronism=!1,checkChronology=!0,matchUpDependencies,tournamentRecords,tournamentRecord,matchUpDetails,matchUpIds,schedule}){var _a,_b;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!(matchUpDetails||matchUpIds&&Array.isArray(matchUpIds)))return{error:MISSING_MATCHUP_IDS};if(!(matchUpDetails||schedule&&"object"==typeof schedule))return{error:MISSING_SCHEDULE};const warnings=[];let scheduled=0;matchUpDependencies=checkChronology&&(matchUpDependencies||getMatchUpDependencies({tournamentRecords}).matchUpDependencies);const{matchUps}=allTournamentMatchUps({tournamentRecord}),drawIdMap=matchUps.reduce(((drawIdMap2,matchUp)=>{const{matchUpId,drawId}=matchUp;return drawIdMap2[drawId]?drawIdMap2[drawId].push(matchUpId):drawIdMap2[drawId]=[matchUpId],drawIdMap2}),{}),detailMatchUpIds=null==matchUpDetails?void 0:matchUpDetails.map((detail=>detail.matchUpId));for(const drawId of Object.keys(drawIdMap)){const{drawDefinition}=getDrawDefinition$2({tournamentRecord,drawId}),drawMatchUpIds=drawIdMap[drawId].filter((matchUpId=>(null==matchUpIds?void 0:matchUpIds.includes(matchUpId))||(null==detailMatchUpIds?void 0:detailMatchUpIds.includes(matchUpId))));for(const matchUpId of drawMatchUpIds){const result=addMatchUpScheduleItems$2({schedule:(null==(_a=null==matchUpDetails?void 0:matchUpDetails.find((details=>details.matchUpId===matchUpId)))?void 0:_a.schedule)||schedule,matchUpDependencies,errorOnAnachronism,tournamentRecords,tournamentRecord,checkChronology,drawDefinition,matchUpId,matchUps});if((null==(_b=result.warnings)?void 0:_b.length)&&warnings.push(...result.warnings),result.success&&(scheduled+=1),result.error)return result}}return warnings.length?__spreadProps$2t(__spreadValues$4f({},SUCCESS),{scheduled,warnings}):__spreadProps$2t(__spreadValues$4f({},SUCCESS),{scheduled})}var __defProp$4e=Object.defineProperty,__defProps$2s=Object.defineProperties,__getOwnPropDescs$2s=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4f=Object.getOwnPropertySymbols,__hasOwnProp$4f=Object.prototype.hasOwnProperty,__propIsEnum$4f=Object.prototype.propertyIsEnumerable,__defNormalProp$4e=(obj,key,value)=>key in obj?__defProp$4e(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4e=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4f.call(b,prop)&&__defNormalProp$4e(a,prop,b[prop]);if(__getOwnPropSymbols$4f)for(var prop of __getOwnPropSymbols$4f(b))__propIsEnum$4f.call(b,prop)&&__defNormalProp$4e(a,prop,b[prop]);return a},__spreadProps$2s=(a,b)=>__defProps$2s(a,__getOwnPropDescs$2s(b));function bulkScheduleMatchUps({errorOnAnachronism,matchUpContextIds,tournamentRecords,checkChronology,matchUpDetails,schedule}){var _a;if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!Array.isArray(matchUpContextIds)&&!Array.isArray(matchUpDetails))return{error:INVALID_VALUES};if((!matchUpDetails||matchUpContextIds)&&!schedule)return{error:MISSING_VALUE,info:"schedule is required"};const warnings=[];let scheduled=0;const{matchUpDependencies}=getMatchUpDependencies({tournamentRecords});for(const tournamentRecord of Object.values(tournamentRecords)){const{tournamentId}=tournamentRecord,matchUpIds=null==matchUpContextIds?void 0:matchUpContextIds.filter((contextIds=>contextIds.tournamentId===tournamentId)).map(getMatchUpId),tournamentMatchUpDetails=null==matchUpDetails?void 0:matchUpDetails.filter((details=>(null==details?void 0:details.tournamentId)===tournamentId));if((null==matchUpIds?void 0:matchUpIds.length)||(null==tournamentMatchUpDetails?void 0:tournamentMatchUpDetails.length)){const result=bulkScheduleMatchUps$1({matchUpDetails:tournamentMatchUpDetails,matchUpDependencies,errorOnAnachronism,tournamentRecord,checkChronology,matchUpIds,schedule});if((null==(_a=result.warnings)?void 0:_a.length)&&warnings.push(...result.warnings),result.scheduled&&(scheduled+=result.scheduled),result.error)return result}}return warnings.length?__spreadProps$2s(__spreadValues$4e({},SUCCESS),{scheduled,warnings}):__spreadProps$2s(__spreadValues$4e({},SUCCESS),{scheduled})}function getEventIdsAndDrawIds({tournamentRecords}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};return Object.keys(tournamentRecords).reduce(((aggregator,tournamentId)=>{aggregator.tournamentIdMap[tournamentId]=[];const events=tournamentRecords[tournamentId].events||[],eventIds=events.map((({eventId})=>eventId)),drawIds=events.map((event=>(event.drawDefinitions||[]).map((({drawId})=>drawId)))).flat();return aggregator.tournamentIdMap[tournamentId].push(...eventIds,...drawIds),aggregator.eventIds.push(...eventIds),aggregator.drawIds.push(...drawIds),aggregator}),{eventIds:[],drawIds:[],tournamentIdMap:{}})}function findTournamentId({drawId,eventId,tournamentRecords}){const{tournamentIdMap}=getEventIdsAndDrawIds({tournamentRecords});return Object.keys(tournamentIdMap).find((tournamentId=>tournamentIdMap[tournamentId].includes(eventId)||tournamentIdMap[tournamentId].includes(drawId)))}var __defProp$4d=Object.defineProperty,__getOwnPropSymbols$4e=Object.getOwnPropertySymbols,__hasOwnProp$4e=Object.prototype.hasOwnProperty,__propIsEnum$4e=Object.prototype.propertyIsEnumerable,__defNormalProp$4d=(obj,key,value)=>key in obj?__defProp$4d(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4d=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4e.call(b,prop)&&__defNormalProp$4d(a,prop,b[prop]);if(__getOwnPropSymbols$4e)for(var prop of __getOwnPropSymbols$4e(b))__propIsEnum$4e.call(b,prop)&&__defNormalProp$4d(a,prop,b[prop]);return a};function getInitialRoundNumber({drawPosition,matchUps=[]}){return{initialRoundNumber:matchUps.filter((({drawPositions})=>drawPosition&&(null==drawPositions?void 0:drawPositions.includes(drawPosition)))).map((({roundNumber})=>parseInt(roundNumber))).sort(numericSort)[0]}}function getPairedPreviousMatchUp({structureId,matchUpsMap,matchUp}){const sourceRoundPosition=null==matchUp?void 0:matchUp.roundPosition,pairedRoundPosition=sourceRoundPosition+(sourceRoundPosition%2?1:-1);return{pairedPreviousMatchUp:getMappedStructureMatchUps({matchUpsMap,structureId}).find((({roundNumber,roundPosition})=>roundNumber===(null==matchUp?void 0:matchUp.roundNumber)&&roundPosition===pairedRoundPosition))}}var __defProp$4c=Object.defineProperty,__defProps$2r=Object.defineProperties,__getOwnPropDescs$2r=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4d=Object.getOwnPropertySymbols,__hasOwnProp$4d=Object.prototype.hasOwnProperty,__propIsEnum$4d=Object.prototype.propertyIsEnumerable,__defNormalProp$4c=(obj,key,value)=>key in obj?__defProp$4c(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4c=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4d.call(b,prop)&&__defNormalProp$4c(a,prop,b[prop]);if(__getOwnPropSymbols$4d)for(var prop of __getOwnPropSymbols$4d(b))__propIsEnum$4d.call(b,prop)&&__defNormalProp$4c(a,prop,b[prop]);return a},__spreadProps$2r=(a,b)=>__defProps$2r(a,__getOwnPropDescs$2r(b));function updateMatchUpStatusCodes({inContextDrawMatchUps,sourceMatchUpStatus,sourceMatchUpId,matchUpsMap,matchUp}){const sourceMatchUp=inContextDrawMatchUps.find((matchUp2=>matchUp2.matchUpId===sourceMatchUpId)),{pairedPreviousMatchUp}=getPairedPreviousMatchUp({structureId:null==sourceMatchUp?void 0:sourceMatchUp.structureId,matchUp:sourceMatchUp,matchUpsMap});if(sourceMatchUp&&pairedPreviousMatchUp){const pairedPreviousMatchUpId=null==pairedPreviousMatchUp?void 0:pairedPreviousMatchUp.matchUpId,pairedMatchUp=inContextDrawMatchUps.find((matchUp2=>matchUp2.matchUpId===pairedPreviousMatchUpId)),sourceSideNumber=(null==sourceMatchUp?void 0:sourceMatchUp.structureId)===(null==pairedMatchUp?void 0:pairedMatchUp.structureId)?(null==sourceMatchUp?void 0:sourceMatchUp.roundPosition)<(null==pairedMatchUp?void 0:pairedMatchUp.roundPosition)?1:2:sourceMatchUp.structureId===(null==pairedMatchUp?void 0:pairedMatchUp.structureId)?2:1;matchUp.matchUpStatusCodes=matchUp.matchUpStatusCodes.map((code=>code.sideNumber===sourceSideNumber?__spreadProps$2r(__spreadValues$4c({},code),{previousMatchUpStatus:sourceMatchUpStatus}):code))}}var __defProp$4b=Object.defineProperty,__getOwnPropSymbols$4c=Object.getOwnPropertySymbols,__hasOwnProp$4c=Object.prototype.hasOwnProperty,__propIsEnum$4c=Object.prototype.propertyIsEnumerable,__defNormalProp$4b=(obj,key,value)=>key in obj?__defProp$4b(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4b=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4c.call(b,prop)&&__defNormalProp$4b(a,prop,b[prop]);if(__getOwnPropSymbols$4c)for(var prop of __getOwnPropSymbols$4c(b))__propIsEnum$4c.call(b,prop)&&__defNormalProp$4b(a,prop,b[prop]);return a};function removeDrawPosition$1({inContextDrawMatchUps,positionAssignments,sourceMatchUpStatus,targetDrawPosition,tournamentRecord,sourceMatchUpId,drawDefinition,dualMatchUp,matchUpsMap,matchUp,event}){var _a,_b,_c;if(dualMatchUp){const inContextMatchUp=inContextDrawMatchUps.find((({matchUpId})=>matchUp.matchUpId===matchUpId)),targetSideNumber=null==(_b=null==(_a=inContextMatchUp.sides)?void 0:_a.find((side=>side.drawPosition===targetDrawPosition)))?void 0:_b.sideNumber,targetSide=null==(_c=matchUp.sides)?void 0:_c.find((side=>side.sideNumber===targetSideNumber));targetSide&&delete targetSide.lineUp}matchUp.drawPositions=(matchUp.drawPositions||[]).map((drawPosition=>drawPosition===targetDrawPosition?void 0:drawPosition)).filter(Boolean);const matchUpContainsBye=positionAssignments.filter((({drawPosition})=>{var _a2;return null==(_a2=matchUp.drawPositions)?void 0:_a2.includes(drawPosition)})).filter((assignment=>assignment.bye)).length;return matchUp.matchUpStatus=matchUpContainsBye?BYE:[DEFAULTED,WALKOVER$2].includes(matchUp.matchUpStatus)?matchUp.matchUpStatus:TO_BE_PLAYED,[WALKOVER$2,DEFAULTED].includes(matchUp.matchUpStatus)&&(matchUp.winningSide=void 0),matchUp.matchUpStatusCodes&&updateMatchUpStatusCodes({inContextDrawMatchUps,sourceMatchUpStatus,sourceMatchUpId,matchUpsMap,matchUp}),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,context:`removeSubsequentDrawPosition-${targetDrawPosition}`,drawDefinition,matchUp}),__spreadValues$4b({},SUCCESS)}function modifyRoundRobinMatchUpsStatus({positionAssignments,tournamentRecord,drawDefinition,matchUpsMap,structure,event}){const{matchUps}=getAllStructureMatchUps({drawDefinition,matchUpsMap,structure,event});matchUps.forEach((matchUp=>{const matchUpContainsBye=positionAssignments.filter((({drawPosition})=>{var _a;return null==(_a=matchUp.drawPositions)?void 0:_a.includes(drawPosition)})).filter((assignment=>assignment.bye)).length;if(!matchUp.winningSide){const matchUpStatus=matchUpContainsBye?BYE:TO_BE_PLAYED;Object.assign(matchUp,{matchUpStatus}),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:null==event?void 0:event.eventId,drawDefinition,matchUp})}}))}function getContainedStructures({tournamentRecord,drawDefinition,event}){const events=(null==tournamentRecord?void 0:tournamentRecord.events)||event&&[event],drawDefinitions=(null==events?void 0:events.map((event2=>null==event2?void 0:event2.drawDefinitions)).flat().filter(Boolean))||drawDefinition&&[drawDefinition]||[],containedStructures={},containerStructures={},structureContainers=drawDefinitions.map((({structures})=>null==structures?void 0:structures.filter((structure=>null==structure?void 0:structure.structures)))).flat().filter(Boolean);for(const structureContainer of structureContainers){const{structures,structureId}=structureContainer||{};structures&&(containedStructures[structureId]=null==structures?void 0:structures.map((structure=>structure.structureId)))&&structures.forEach((structure=>containerStructures[structure.structureId]=structureContainer.structureId))}return{containedStructures,containerStructures}}function getStructureDrawPositionProfiles({drawDefinition,findContainer,structureId,structure}){var _a;const{containedStructures}=getContainedStructures({drawDefinition}),containedStructureIds=containedStructures[structureId]||[];if(!structure){const result=findStructure({drawDefinition,structureId});if(result.error)return result;structure=findContainer&&result.containingStructure||result.structure}if(isAdHoc({drawDefinition,structure}))return{structure,isAdHoc:!0,error:INVALID_DRAW_POSITION};const{matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({inContext:!0,drawDefinition,matchUpFilters:{isCollectionMatchUp:!1}}),inContextStructureMatchUps=inContextDrawMatchUps.filter((matchUp=>matchUp.structureId===structureId||containedStructureIds.includes(matchUp.structureId))),{matchUpDependencies}=getMatchUpDependencies({drawIds:[drawDefinition.drawId],matchUps:inContextDrawMatchUps,drawDefinition}),activeDependentMatchUpIdsCollection=[],drawPositionInitialRounds={},drawPositionsCollection=[],activeMatchUps=[];for(const matchUp of inContextDrawMatchUps){if(matchUp.structureId===structureId||containedStructureIds.includes(matchUp.structureId)){drawPositionsCollection.push(...matchUp.drawPositions||[]);const roundNumber=matchUp.roundNumber;for(const drawPosition of(matchUp.drawPositions||[]).filter(Boolean))(!drawPositionInitialRounds[drawPosition]||drawPositionInitialRounds[drawPosition]>roundNumber)&&(drawPositionInitialRounds[drawPosition]=roundNumber)}isActiveMatchUp(matchUp)&&(activeMatchUps.push(matchUp),activeDependentMatchUpIdsCollection.push(matchUp.matchUpId,...(null==(_a=null==matchUpDependencies?void 0:matchUpDependencies[null==matchUp?void 0:matchUp.matchUpId])?void 0:_a.matchUpIds)||[]))}const drawPositions=unique(drawPositionsCollection.filter(Boolean)).sort(numericSort),activeDependentMatchUpIds=unique(activeDependentMatchUpIdsCollection),activeDrawPositions=unique(inContextStructureMatchUps.map((({matchUpId,drawPositions:drawPositions2})=>activeDependentMatchUpIds.includes(matchUpId)?drawPositions2:[])).flat().filter(Boolean)).sort(numericSort),{positionAssignments}=getPositionAssignments$1({drawDefinition,structure}),byeDrawPositions=positionAssignments.filter((assignment=>assignment.bye)).map((assignment=>assignment.drawPosition)),qualifyingDrawPositions=positionAssignments.filter((assignment=>assignment.qualifier)).map((assignment=>assignment.drawPosition)),inactiveDrawPositions=(null==drawPositions?void 0:drawPositions.filter((drawPosition=>!activeDrawPositions.includes(drawPosition))))||[];return{allDrawPositions:drawPositions,inContextStructureMatchUps,drawPositionInitialRounds,activeDependentMatchUpIds,qualifyingDrawPositions,inactiveDrawPositions,positionAssignments,activeDrawPositions,byeDrawPositions,activeMatchUps,structure}}function pushGlobalLog(value,devContextOverride){devContextOverride||getDevContext()}var __defProp$4a=Object.defineProperty,__defProps$2q=Object.defineProperties,__getOwnPropDescs$2q=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4b=Object.getOwnPropertySymbols,__hasOwnProp$4b=Object.prototype.hasOwnProperty,__propIsEnum$4b=Object.prototype.propertyIsEnumerable,__defNormalProp$4a=(obj,key,value)=>key in obj?__defProp$4a(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4a=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4b.call(b,prop)&&__defNormalProp$4a(a,prop,b[prop]);if(__getOwnPropSymbols$4b)for(var prop of __getOwnPropSymbols$4b(b))__propIsEnum$4b.call(b,prop)&&__defNormalProp$4a(a,prop,b[prop]);return a},__spreadProps$2q=(a,b)=>__defProps$2q(a,__getOwnPropDescs$2q(b));function clearDrawPosition({inContextDrawMatchUps,tournamentRecord,drawDefinition,drawPosition,participantId,structureId,matchUpsMap,event}){const{structure}=findStructure({drawDefinition,structureId}),{positionAssignments}=structureAssignedDrawPositions({drawDefinition,structure}),existingAssignment=positionAssignments.find((assignment=>participantId&&assignment.participantId===participantId||drawPosition&&assignment.drawPosition===drawPosition));if(participantId&&!drawPosition&&(drawPosition=null==existingAssignment?void 0:existingAssignment.drawPosition),!drawPosition)return{error:MISSING_DRAW_POSITION};participantId||(participantId=null==existingAssignment?void 0:existingAssignment.participantId);const{activeDrawPositions}=getStructureDrawPositionProfiles({drawDefinition,structureId});if(activeDrawPositions.includes(drawPosition))return{error:DRAW_POSITION_ACTIVE};inContextDrawMatchUps||({matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap}));const result=drawPositionRemovals({inContextDrawMatchUps,tournamentRecord,drawDefinition,structureId,drawPosition,matchUpsMap,event});return result.error?result:result.drawPositionCleared?(modifyPositionAssignmentsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,source:"clearDrawPosition",structure,event}),__spreadProps$2q(__spreadValues$4a({},SUCCESS),{participantId})):{error:DRAW_POSITION_NOT_CLEARED}}function drawPositionRemovals({inContextDrawMatchUps,tournamentRecord,drawDefinition,drawPosition,matchUpsMap,structureId,event}){const{structure}=findStructure({drawDefinition,structureId}),{positionAssignments}=structureAssignedDrawPositions({drawDefinition,structure}),drawPositionCleared=positionAssignments.some((assignment=>{if(assignment.drawPosition===drawPosition)return delete assignment.participantId,delete assignment.qualifier,delete assignment.bye,!0}));if(structure.structureType===CONTAINER)return modifyRoundRobinMatchUpsStatus({positionAssignments,tournamentRecord,drawDefinition,matchUpsMap,structure}),__spreadValues$4a({drawPositionCleared},SUCCESS);const{matchUps:structureMatchUps}=getAllStructureMatchUps({drawDefinition,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap,structure,event}),{roundProfile,roundMatchUps}=getRoundMatchUps$1({matchUps:structureMatchUps}),roundNumbers=Object.keys(roundProfile).map((roundNumber=>parseInt(roundNumber)));let targetDrawPosition=drawPosition;const tasks=roundNumbers.map((roundNumber=>{var _a;const relevantPair=roundProfile[roundNumber].pairedDrawPositions.find((drawPositions=>drawPositions.includes(targetDrawPosition))),pairedDrawPosition=null==relevantPair?void 0:relevantPair.find((currentDrawPosition=>currentDrawPosition!==targetDrawPosition)),pairedDrawPositionAssignment=positionAssignments.find((assignment=>assignment.drawPosition===pairedDrawPosition)),nextRoundProfile=roundProfile[roundNumber+1],pairedDrawPositionIsBye=null==pairedDrawPositionAssignment?void 0:pairedDrawPositionAssignment.bye,pairedDrawPositionInNextRound=nextRoundProfile&&nextRoundProfile.pairedDrawPositions.find((pairedPositions=>pairedPositions.includes(pairedDrawPosition))),isTransitiveBye=pairedDrawPositionIsBye&&pairedDrawPositionInNextRound&&nextRoundProfile&&(null==(_a=nextRoundProfile.drawPositions)?void 0:_a.includes(pairedDrawPosition)),result=relevantPair&&{pairedDrawPositionByeAdvancedPair:!isTransitiveBye&&pairedDrawPositionInNextRound,pairedDrawPosition,targetDrawPosition,relevantPair,roundNumber};return isTransitiveBye&&(targetDrawPosition=pairedDrawPosition),result})).filter((f=>null==f?void 0:f.targetDrawPosition)).reduce(((tasks2,pairingDetail)=>{const{roundNumber,relevantPair,targetDrawPosition:targetDrawPosition2,pairedDrawPosition,pairedDrawPositionByeAdvancedPair}=pairingDetail,newTasks=[{roundNumber,targetDrawPosition:targetDrawPosition2,relevantPair},pairedDrawPositionByeAdvancedPair&&{roundNumber:roundNumber+1,targetDrawPosition:pairedDrawPosition,relevantPair:pairedDrawPositionByeAdvancedPair,subsequentRoundRemoval:!0}].filter(Boolean);return tasks2.concat(...newTasks)}),[]);return tasks.forEach((({roundNumber,targetDrawPosition:targetDrawPosition2,relevantPair})=>{const targetMatchUp=roundMatchUps[roundNumber].find((matchUp=>overlap(matchUp.drawPositions.filter(Boolean),relevantPair.filter(Boolean))));targetMatchUp&&(!function removeSubsequentRoundsParticipant({inContextDrawMatchUps,targetDrawPosition,tournamentRecord,drawDefinition,matchUpsMap,roundNumber,structureId}){const{structure}=findStructure({drawDefinition,structureId});if(structure.structureType===CONTAINER)return;matchUpsMap=matchUpsMap||getMatchUpsMap({drawDefinition});const mappedMatchUps=(null==matchUpsMap?void 0:matchUpsMap.mappedMatchUps)||{},matchUps=mappedMatchUps[structureId].matchUps,{initialRoundNumber}=getInitialRoundNumber({drawPosition:targetDrawPosition,matchUps}),relevantMatchUps=null==matchUps?void 0:matchUps.filter((matchUp=>{var _a;return matchUp.roundNumber>=roundNumber&&matchUp.roundNumber!==initialRoundNumber&&(null==(_a=matchUp.drawPositions)?void 0:_a.includes(targetDrawPosition))})),{positionAssignments}=getPositionAssignments$1({drawDefinition,structureId});null==relevantMatchUps||relevantMatchUps.forEach((matchUp=>removeDrawPosition({drawPosition:targetDrawPosition,targetMatchUp:matchUp,inContextDrawMatchUps,positionAssignments,tournamentRecord,drawDefinition,matchUpsMap,structure})))}({inContextDrawMatchUps,targetDrawPosition:targetDrawPosition2,tournamentRecord,drawDefinition,structureId,roundNumber,matchUpsMap,event}),removeDrawPosition({inContextDrawMatchUps,positionAssignments,tournamentRecord,drawDefinition,targetMatchUp,drawPosition,matchUpsMap,structure,event}))})),{tasks,drawPositionCleared,positionAssignments}}function removeDrawPosition({inContextDrawMatchUps,positionAssignments,tournamentRecord,drawDefinition,targetMatchUp,drawPosition,matchUpsMap,structure,event}){var _a,_b,_c,_d;const stack="removeDrawPosition",initialDrawPositions=targetMatchUp.drawPositions.slice(),initialMatchUpStatus=targetMatchUp.matchUpStatus,initialWinningSide=targetMatchUp.winningSide,matchUps=(matchUpsMap=matchUpsMap||getMatchUpsMap({drawDefinition})).mappedMatchUps[structure.structureId].matchUps,{initialRoundNumber}=getInitialRoundNumber({drawPosition,matchUps});if(targetMatchUp.roundNumber>initialRoundNumber&&(targetMatchUp.drawPositions=(targetMatchUp.drawPositions||[]).map((currentDrawPosition=>currentDrawPosition===drawPosition?void 0:currentDrawPosition))),targetMatchUp.matchUpType===TEAM$2){const inContextTargetMatchUp=null==inContextDrawMatchUps?void 0:inContextDrawMatchUps.find((matchUp=>matchUp.matchUpId===targetMatchUp.matchUpId)),drawPositionSideIndex=null==(_a=null==inContextTargetMatchUp?void 0:inContextTargetMatchUp.sides)?void 0:_a.reduce(((index,side,i)=>side.drawPosition===drawPosition?i:index),void 0);void 0!==drawPositionSideIndex&&(null==(_c=null==(_b=targetMatchUp.sides)?void 0:_b[drawPositionSideIndex])?void 0:_c.lineUp)&&(null==(_d=targetMatchUp.sides)||delete _d[drawPositionSideIndex].lineUp,modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,matchUp:targetMatchUp,context:`${stack}-TEAM`,drawDefinition}))}const targetData=positionTargets({matchUpId:targetMatchUp.matchUpId,inContextDrawMatchUps,drawDefinition,structure}),{targetLinks:{winnerTargetLink},targetMatchUps:{loserMatchUp,winnerMatchUp,loserMatchUpDrawPositionIndex,winnerMatchUpDrawPositionIndex}}=targetData,matchUpContainsBye=positionAssignments.filter((({drawPosition:drawPosition2})=>{var _a2;return null==(_a2=targetMatchUp.drawPositions)?void 0:_a2.includes(drawPosition2)})).filter((assignment=>assignment.bye)).length,newMatchUpStatus=matchUpContainsBye?BYE:[DEFAULTED,WALKOVER$2].includes(targetMatchUp.matchUpStatus)?targetMatchUp.matcHUpStatus:2===targetMatchUp.drawPositions.length?TO_BE_PLAYED:void 0;targetMatchUp.matchUpStatus=newMatchUpStatus,[WALKOVER$2,DEFAULTED].includes(targetMatchUp.matchUpStatus)&&(targetMatchUp.winningSide=void 0);const removedDrawPosition=initialDrawPositions.find((position=>!targetMatchUp.drawPositions.includes(position)));if(initialDrawPositions.includes(drawPosition)&&initialMatchUpStatus===targetMatchUp.matchUpStatus&&initialWinningSide===targetMatchUp.winningSide||(removedDrawPosition&&pushGlobalLog(),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,matchUp:targetMatchUp,context:`${stack}-${drawPosition}`,drawDefinition})),loserMatchUp&&loserMatchUp.structureId!==targetData.matchUp.structureId&&!matchUpContainsBye){const{drawPositions,roundNumber}=loserMatchUp;if(1===roundNumber){const loserMatchUpDrawPosition=drawPositions[loserMatchUpDrawPositionIndex];drawPositionRemovals({structureId:loserMatchUp.structureId,drawPosition:loserMatchUpDrawPosition,inContextDrawMatchUps,tournamentRecord,drawDefinition,matchUpsMap})}else{const loserMatchUpDrawPosition=Math.min(...drawPositions.filter(Boolean)),result=function consolationCleanup({loserMatchUpDrawPosition,inContextDrawMatchUps,tournamentRecord,drawDefinition,loserMatchUp,matchUpsMap,event}){const{structure}=findStructure({structureId:loserMatchUp.structureId,drawDefinition}),{positionAssignments}=getPositionAssignments$1({structure}),assignment=positionAssignments.find((assignment2=>assignment2.drawPosition===loserMatchUpDrawPosition));if(assignment.bye){const result=clearDrawPosition({drawPosition:loserMatchUpDrawPosition,structureId:loserMatchUp.structureId,inContextDrawMatchUps,tournamentRecord,drawDefinition,matchUpsMap,event});if(result.error)return result}return __spreadValues$4a({},SUCCESS)}({loserMatchUpDrawPosition,inContextDrawMatchUps,tournamentRecord,drawDefinition,loserMatchUp,matchUpsMap,event});if(result.error)return decorateResult({result,stack});const loserStructureMatchUps=((null==matchUpsMap?void 0:matchUpsMap.mappedMatchUps)||{})[loserMatchUp.structureId].matchUps,{initialRoundNumber:initialRoundNumber2}=getInitialRoundNumber({drawPosition:loserMatchUpDrawPosition,matchUps:loserStructureMatchUps});1===initialRoundNumber2&&(pushGlobalLog(),drawPositionRemovals({structureId:loserMatchUp.structureId,drawPosition:loserMatchUpDrawPosition,inContextDrawMatchUps,tournamentRecord,drawDefinition,matchUpsMap}))}}if(winnerMatchUp&&winnerMatchUp.structureId!==targetData.matchUp.structureId&&winnerTargetLink.target.feedProfile!==DRAW){const{structure:structure2}=findStructure({structureId:targetData.matchUp.structureId,drawDefinition});structure2.structureType!==QUALIFYING&&console.log("linked structure winnerMatchUp removal",{winnerMatchUpDrawPositionIndex,winnerTargetLink})}return __spreadValues$4a({},SUCCESS)}var __defProp$49=Object.defineProperty,__defProps$2p=Object.defineProperties,__getOwnPropDescs$2p=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4a=Object.getOwnPropertySymbols,__hasOwnProp$4a=Object.prototype.hasOwnProperty,__propIsEnum$4a=Object.prototype.propertyIsEnumerable,__defNormalProp$49=(obj,key,value)=>key in obj?__defProp$49(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$49=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4a.call(b,prop)&&__defNormalProp$49(a,prop,b[prop]);if(__getOwnPropSymbols$4a)for(var prop of __getOwnPropSymbols$4a(b))__propIsEnum$4a.call(b,prop)&&__defNormalProp$49(a,prop,b[prop]);return a},__spreadProps$2p=(a,b)=>__defProps$2p(a,__getOwnPropDescs$2p(b));function removeDirectedParticipants(params){const{dualWinningSideChange,inContextDrawMatchUps,tournamentRecord,drawDefinition,matchUpStatus,matchUpsMap,dualMatchUp,targetData,matchUpId,structure,event}=params,isCollectionMatchUp=Boolean(params.matchUp.collectionId),isAdHocMatchUp=isAdHoc({drawDefinition,structure}),{drawPositions,winningSide}=targetData.matchUp||{};if(!isAdHocMatchUp&&!drawPositions)return{error:MISSING_DRAW_POSITIONS};const{targetLinks:{loserTargetLink,winnerTargetLink,byeTargetLink},targetMatchUps:{loserMatchUp,winnerMatchUp,byeMatchUp}}=targetData,result=modifyMatchUpScore(__spreadProps$2p(__spreadValues$49({},params),{matchUpStatus:matchUpStatus||TO_BE_PLAYED,removeWinningSide:!0}));if(result.error)return result;if(isCollectionMatchUp){const{matchUpTieId}=params,{removeWinningSide}=updateTieMatchUpScore$1({matchUpId:matchUpTieId,tournamentRecord,drawDefinition,event});if(!dualWinningSideChange&&!removeWinningSide)return __spreadValues$49({},SUCCESS)}if(isAdHocMatchUp)return __spreadValues$49({},SUCCESS);const{matchUps:sourceMatchUps}=getAllStructureMatchUps({afterRecoveryTimes:!1,inContext:!0,drawDefinition,matchUpsMap,structure}),{positionAssignments}=structureAssignedDrawPositions({structure}),winningIndex=winningSide-1,losingIndex=1-winningIndex,winningDrawPosition=drawPositions[winningIndex],loserDrawPosition=drawPositions[losingIndex],{winnerParticipantId,loserParticipantId}=positionAssignments.reduce(((assignments,assignment)=>(assignment.drawPosition===loserDrawPosition&&(assignments.loserParticipantId=assignment.participantId),assignment.drawPosition===winningDrawPosition&&(assignments.winnerParticipantId=assignment.participantId),assignments)),{winnerParticipantId:void 0,loserParticipantId:void 0}),drawPositionMatchUps=sourceMatchUps.filter((matchUp=>{var _a;return null==(_a=matchUp.drawPositions)?void 0:_a.includes(loserDrawPosition)}));if(winnerMatchUp){const result2=removeDirectedWinner({sourceMatchUpStatus:matchUpStatus,sourceMatchUpId:matchUpId,inContextDrawMatchUps,winningDrawPosition,winnerParticipantId,tournamentRecord,winnerTargetLink,drawDefinition,winnerMatchUp,dualMatchUp,matchUpsMap});if(result2.error)return result2}if(loserMatchUp){const{winnerHadMatchUpStatus:winnerHadBye}=function includesMatchUpStatuses({matchUpStatuses=[BYE,WALKOVER$2,DEFAULTED],drawPositionMatchUps,loserDrawPosition,sourceMatchUps}){var _a;const sourceMatchUp=null==drawPositionMatchUps?void 0:drawPositionMatchUps.reduce(((sourceMatchUp2,matchUp)=>!sourceMatchUp2||matchUp.roundNumber>sourceMatchUp2.roundNumber?matchUp:sourceMatchUp2),void 0),winnerDrawPosition=null==(_a=null==sourceMatchUp?void 0:sourceMatchUp.drawPositions)?void 0:_a.find((drawPosition=>drawPosition!==loserDrawPosition)),winnerMatchUpStatuses=sourceMatchUps.filter((matchUp=>{var _a2;return null==(_a2=null==matchUp?void 0:matchUp.drawPositions)?void 0:_a2.includes(winnerDrawPosition)})).map((matchUp=>matchUp.matchUpStatus)),loserMatchUpStatuses=sourceMatchUps.filter((matchUp=>{var _a2;return null==(_a2=null==matchUp?void 0:matchUp.drawPositions)?void 0:_a2.includes(loserDrawPosition)})).map((matchUp=>matchUp.matchUpStatus));return{sourceMatchUp,winnerHadMatchUpStatus:overlap(winnerMatchUpStatuses||[],matchUpStatuses),winnerMatchUpStatuses,loserHadMatchUpStatus:overlap(loserMatchUpStatuses||[],matchUpStatuses),loserMatchUpStatuses}}({drawPositionMatchUps,loserDrawPosition,sourceMatchUps}),loserLinkCondition=loserTargetLink.linkCondition;if(winnerHadBye&&loserLinkCondition===FIRST_MATCHUP){const removeByeResult=removeDirectedBye({targetLink:loserTargetLink,inContextDrawMatchUps,drawDefinition,drawPosition:Math.min(...loserMatchUp.drawPositions),matchUpsMap,event});if(removeByeResult.error)return removeByeResult}const removeLoserResult=function removeDirectedLoser({sourceMatchUpStatus,loserParticipantId,tournamentRecord,loserTargetLink,sourceMatchUpId,drawDefinition,loserMatchUp,matchUpsMap,dualMatchUp,event}){var _a,_b,_c;const stack="removeDirectedLoser",structureId=loserTargetLink.target.structureId,{structure}=findStructure({drawDefinition,structureId}),{positionAssignments}=structureAssignedDrawPositions({structure}),relevantDrawPosition=null==(_a=positionAssignments.find((assignment=>assignment.participantId===loserParticipantId)))?void 0:_a.drawPosition;if(positionAssignments.forEach((assignment=>{assignment.participantId===loserParticipantId&&delete assignment.participantId})),structure.seedAssignments=(structure.seedAssignments||[]).filter((assignment=>assignment.participantId!==loserParticipantId)),dualMatchUp){const drawPositionSideIndex=null==loserMatchUp?void 0:loserMatchUp.sides.reduce(((sideIndex,side,i)=>side.drawPosition===relevantDrawPosition?i:sideIndex),void 0),targetMatchUp=null==(_b=null==matchUpsMap?void 0:matchUpsMap.drawMatchUps)?void 0:_b.find((({matchUpId})=>matchUpId===loserMatchUp.matchUpId)),targetSide=null==(_c=null==targetMatchUp?void 0:targetMatchUp.sides)?void 0:_c[drawPositionSideIndex];targetSide&&(delete targetSide.lineUp,modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,matchUp:targetMatchUp,context:stack,drawDefinition}))}return __spreadValues$49({},SUCCESS)}({sourceMatchUpStatus:matchUpStatus,sourceMatchUpId:matchUpId,inContextDrawMatchUps,loserParticipantId,tournamentRecord,loserTargetLink,drawDefinition,loserMatchUp,dualMatchUp,matchUpsMap,event});if(removeLoserResult.error)return removeLoserResult}if(byeMatchUp){const removeByeResult=removeDirectedBye({sourceMatchUpId:matchUpId,targetLink:byeTargetLink,inContextDrawMatchUps,drawDefinition,drawPosition:Math.min(...byeMatchUp.drawPositions),matchUpsMap,event});removeByeResult.error&&console.log({removeByeResult})}return __spreadValues$49({},SUCCESS)}function removeDirectedWinner({inContextDrawMatchUps,winningDrawPosition,sourceMatchUpStatus,winnerParticipantId,tournamentRecord,winnerTargetLink,sourceMatchUpId,drawDefinition,winnerMatchUp,matchUpsMap,dualMatchUp,event}){var _a;const{structureId,roundNumber}=winnerMatchUp,stack="removeDirectedWinner";if(winnerTargetLink){const structureId2=winnerTargetLink.target.structureId,{structure}=findStructure({drawDefinition,structureId:structureId2}),{positionAssignments}=structureAssignedDrawPositions({structure});structure.seedAssignments=(structure.seedAssignments||[]).filter((assignment=>assignment.participantId!==winnerParticipantId));const relevantAssignment=positionAssignments.find((assignment=>assignment.participantId===winnerParticipantId)),winnerDrawPosition=null==relevantAssignment?void 0:relevantAssignment.drawPosition,{matchUps}=getAllStructureMatchUps({drawDefinition,structure,event});if(1===instanceCount(matchUps.map((matchUp=>matchUp.drawPositions)).flat(1/0).filter(Boolean))[winnerDrawPosition])positionAssignments.forEach((assignment=>{assignment.participantId===winnerParticipantId&&delete assignment.participantId}));else{const drawPositionMatchUps=matchUps.filter((({drawPositions})=>drawPositions.includes(winnerDrawPosition)));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps,winnerTargetLink})}const targetMatchUp=null==(_a=null==matchUpsMap?void 0:matchUpsMap.drawMatchUps)?void 0:_a.find((({matchUpId})=>matchUpId===winnerMatchUp.matchUpId));modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,matchUp:targetMatchUp,context:stack,drawDefinition})}const result=function removeSubsequentRoundsParticipant$1({inContextDrawMatchUps,sourceMatchUpStatus,targetDrawPosition,tournamentRecord,sourceMatchUpId,drawDefinition,structureId,dualMatchUp,roundNumber,matchUpsMap,event}){const{structure}=findStructure({drawDefinition,structureId});if(structure.structureType===CONTAINER)return;const matchUps=((null==(matchUpsMap=matchUpsMap||getMatchUpsMap({drawDefinition}))?void 0:matchUpsMap.mappedMatchUps)||{})[structureId].matchUps,{initialRoundNumber}=getInitialRoundNumber({drawPosition:targetDrawPosition,matchUps}),relevantMatchUps=null==matchUps?void 0:matchUps.filter((matchUp=>{var _a;return matchUp.roundNumber>=roundNumber&&matchUp.roundNumber!==initialRoundNumber&&(null==(_a=matchUp.drawPositions)?void 0:_a.includes(targetDrawPosition))})),{positionAssignments}=getPositionAssignments$1({drawDefinition,structureId});for(const matchUp of relevantMatchUps){const result=removeDrawPosition$1({inContextDrawMatchUps,sourceMatchUpStatus,positionAssignments,targetDrawPosition,tournamentRecord,sourceMatchUpId,drawDefinition,dualMatchUp,matchUpsMap,matchUp,event});if(result.error)return result}return __spreadValues$4b({},SUCCESS)}({targetDrawPosition:winningDrawPosition,inContextDrawMatchUps,sourceMatchUpStatus,tournamentRecord,sourceMatchUpId,drawDefinition,dualMatchUp,matchUpsMap,roundNumber,structureId});return result.error?decorateResult({result,stack}):__spreadValues$49({},SUCCESS)}function removeDirectedBye({inContextDrawMatchUps,tournamentRecord,sourceMatchUpId,drawDefinition,drawPosition,matchUpsMap,targetLink,event}){const structureId=targetLink.target.structureId;return clearDrawPosition({sourceMatchUpStatus:BYE,inContextDrawMatchUps,tournamentRecord,sourceMatchUpId,drawDefinition,matchUpsMap,drawPosition,structureId,event}),__spreadValues$49({},SUCCESS)}function getPairedPreviousMatchUpIsDoubleExit(params){let{sourceMatchUp}=params;const{targetMatchUp,structure,matchUpsMap,drawPosition}=params,previousRoundNumber=targetMatchUp.roundNumber>1&&targetMatchUp.roundNumber-1,structureMatchUps=getMappedStructureMatchUps({structureId:structure.structureId,matchUpsMap});!sourceMatchUp&&drawPosition&&(sourceMatchUp=structureMatchUps.find((({drawPositions,roundNumber})=>roundNumber===previousRoundNumber&&(null==drawPositions?void 0:drawPositions.includes(drawPosition)))));const sourceRoundPosition=null==sourceMatchUp?void 0:sourceMatchUp.roundPosition,pairedRoundPosition=sourceRoundPosition+(sourceRoundPosition%2?1:-1),pairedPreviousMatchUp=previousRoundNumber&&structureMatchUps.find((({roundNumber,roundPosition})=>roundNumber===previousRoundNumber&&roundPosition===pairedRoundPosition)),pairedPreviousMatchUpStatus=null==pairedPreviousMatchUp?void 0:pairedPreviousMatchUp.matchUpStatus;return{pairedPreviousMatchUp,pairedPreviousMatchUpIsDoubleExit:[DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(pairedPreviousMatchUpStatus)}}function addPositionActionTelemetry({drawDefinition,positionAction}){const{extension}=findExtension$2({name:AUDIT_POSITION_ACTIONS,element:drawDefinition}),existingValue=Array.isArray(null==extension?void 0:extension.value)?extension.value:[];if(!existingValue.length){const mainStructure=drawDefinition.structures.find((structure=>structure.stage===MAIN));if(mainStructure){const initialAssignments=getPositionAssignments$1({structure:mainStructure}).positionAssignments.map((({drawPosition,participantId,bye,qualifier})=>({drawPosition,participantId,qualifier,bye})));existingValue.push({name:"initialMainAssignments",initialAssignments})}}addExtension$1({element:drawDefinition,extension:{name:AUDIT_POSITION_ACTIONS,value:existingValue.concat(positionAction)}})}var __defProp$48=Object.defineProperty,__getOwnPropSymbols$49=Object.getOwnPropertySymbols,__hasOwnProp$49=Object.prototype.hasOwnProperty,__propIsEnum$49=Object.prototype.propertyIsEnumerable,__defNormalProp$48=(obj,key,value)=>key in obj?__defProp$48(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$48=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$49.call(b,prop)&&__defNormalProp$48(a,prop,b[prop]);if(__getOwnPropSymbols$49)for(var prop of __getOwnPropSymbols$49(b))__propIsEnum$49.call(b,prop)&&__defNormalProp$48(a,prop,b[prop]);return a};function assignDrawPositionBye$1({provisionalPositioning,isPositionAction,tournamentRecord,drawDefinition,drawPosition,matchUpsMap,structureId,structure,event}){var _a;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(structure||({structure}=findStructure({drawDefinition,structureId})),!structure)return{error:STRUCTURE_NOT_FOUND};structureId||({structureId}=structure);const stack="assignDrawPositionBye";pushGlobalLog(),matchUpsMap||(matchUpsMap=getMatchUpsMap({drawDefinition}));const{positionAssignments}=getPositionAssignments$1({structure}),{activeDrawPositions}=getStructureDrawPositionProfiles({drawDefinition,structureId}),currentAssignment=positionAssignments.find((assignment=>assignment.drawPosition===drawPosition));if(null==currentAssignment?void 0:currentAssignment.bye)return __spreadValues$48({},SUCCESS);if(null==activeDrawPositions?void 0:activeDrawPositions.includes(drawPosition))return{error:DRAW_POSITION_ACTIVE};const positionAssignment=positionAssignments.find((assignment=>assignment.drawPosition===drawPosition));if(!positionAssignment)return{error:INVALID_DRAW_POSITION};const{filled,containsBye,assignedParticipantId}=function drawPositionFilled(positionAssignment){const containsBye=positionAssignment.bye,containsQualifier=positionAssignment.qualifier,assignedParticipantId=positionAssignment.participantId,filled=containsBye||containsQualifier||assignedParticipantId;return{containsBye,containsQualifier,assignedParticipantId,filled}}(positionAssignment);if(containsBye)return __spreadValues$48({},SUCCESS);if(filled&&!containsBye)return decorateResult({result:{error:DRAW_POSITION_ASSIGNED},stack});const{matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap}),{matchUps}=getAllStructureMatchUps({provisionalPositioning,drawDefinition,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap,structure});if(positionAssignments.forEach((assignment=>{assignment.drawPosition===drawPosition&&(assignment.bye=!0)})),structure.structureType===CONTAINER)return function assignRoundRobinBYE({tournamentRecord,drawDefinition,drawPosition,matchUps,event}){matchUps.forEach((matchUp=>{var _a;(null==(_a=matchUp.drawPositions)?void 0:_a.includes(drawPosition))&&setMatchUpStatusBYE({eventId:null==event?void 0:event.eventId,tournamentRecord,drawDefinition,matchUp})}))}({tournamentRecord,drawDefinition,drawPosition,matchUps}),modifyPositionAssignmentsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,source:stack,structure,event}),successNotice({assignedParticipantId,isPositionAction,drawDefinition,drawPosition,structureId,stack});const{roundProfile,roundMatchUps}=getRoundMatchUps$1({matchUps}),matchUp=roundMatchUps[Object.keys(roundProfile).map((roundNumber2=>parseInt(roundNumber2))).reverse().find((roundNumber2=>{var _a2;return null==(_a2=roundProfile[roundNumber2].drawPositions)?void 0:_a2.includes(drawPosition)}))].find((({drawPositions})=>null==drawPositions?void 0:drawPositions.includes(drawPosition)));setMatchUpStatusBYE({tournamentRecord,drawDefinition,matchUp,event});const drawPositionToAdvance=null==(_a=matchUp.drawPositions)?void 0:_a.find((position=>position!==drawPosition));if(drawPositionToAdvance){const result=advanceDrawPosition({sourceDrawPositions:matchUp.drawPositions,matchUpId:matchUp.matchUpId,inContextDrawMatchUps,drawPositionToAdvance,tournamentRecord,drawDefinition,matchUpsMap});if(result.error)return result}return modifyPositionAssignmentsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,source:stack,structure,event}),successNotice({assignedParticipantId,isPositionAction,drawDefinition,drawPosition,structureId,stack})}function successNotice({assignedParticipantId,isPositionAction,drawDefinition,drawPosition,structureId,stack}){if(isPositionAction){addPositionActionTelemetry({drawDefinition,positionAction:{removedParticipantId:assignedParticipantId,drawPosition,structureId,name:stack}})}return decorateResult({result:__spreadValues$48({},SUCCESS),stack})}function setMatchUpStatusBYE({tournamentRecord,drawDefinition,matchUp,event}){Object.assign(matchUp,{matchUpStatus:BYE,score:void 0,winningSide:void 0}),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,context:"setMatchUpStatusBye",eventId:null==event?void 0:event.eventId,drawDefinition,matchUp})}function advanceDrawPosition({drawPositionToAdvance,inContextDrawMatchUps,sourceDrawPositions,tournamentRecord,drawDefinition,matchUpsMap,matchUpId,event}){pushGlobalLog();const matchUp=matchUpsMap.drawMatchUps.find((matchUp2=>matchUp2.matchUpId===matchUpId)),inContextMatchUp=inContextDrawMatchUps.find((matchUp2=>matchUp2.matchUpId===matchUpId)),structureId=null==inContextMatchUp?void 0:inContextMatchUp.structureId,{structure}=findStructure({drawDefinition,structureId}),{positionAssignments}=getPositionAssignments$1({structure}),byeAssignedDrawPositions=positionAssignments.filter((assignment=>assignment.bye)).map((assignment=>assignment.drawPosition)),losingDrawPosition=matchUp.drawPositions.find((drawPosition=>drawPosition!==drawPositionToAdvance)),losingDrawPosiitonIsBye=null==byeAssignedDrawPositions?void 0:byeAssignedDrawPositions.includes(losingDrawPosition),{targetLinks:{loserTargetLink},targetMatchUps:{loserMatchUp,winnerMatchUp,loserTargetDrawPosition}}=positionTargets({inContextDrawMatchUps,drawDefinition,matchUpId,structure});if(winnerMatchUp&&winnerMatchUp.structureId===structure.structureId&&function advanceWinner({drawPositionToAdvance,inContextDrawMatchUps,sourceDrawPositions,tournamentRecord,drawDefinition,winnerMatchUp,matchUpsMap,event}){var _a,_b,_c;const stack="advanceWinner",noContextWinnerMatchUp=matchUpsMap.drawMatchUps.find((matchUp=>matchUp.matchUpId===winnerMatchUp.matchUpId)),inContextMatchUp=inContextDrawMatchUps.find((matchUp=>matchUp.matchUpId===winnerMatchUp.matchUpId)),structureId=null==inContextMatchUp?void 0:inContextMatchUp.structureId,{structure}=findStructure({drawDefinition,structureId}),{positionAssignments}=getPositionAssignments$1({structure}),drawPositionToAdvanceAssigment=positionAssignments.find((({drawPosition})=>drawPosition===drawPositionToAdvance)),drawPositionToAdvanceIsBye=drawPositionToAdvanceAssigment.bye,existingDrawPositions=null==(_a=noContextWinnerMatchUp.drawPositions)?void 0:_a.filter(Boolean),existingAssignments=positionAssignments.filter((assignment=>null==existingDrawPositions?void 0:existingDrawPositions.includes(assignment.drawPosition))),advancingAssignmentIsBye=positionAssignments.find((({drawPosition})=>drawPosition===drawPositionToAdvance)),priorPair=null==sourceDrawPositions?void 0:sourceDrawPositions.find((drawPosition=>drawPosition!==drawPositionToAdvance)),priorPairAssignment=priorPair&&existingAssignments.find((({drawPosition})=>drawPosition===priorPair)),priorPairIsBye=null==priorPairAssignment?void 0:priorPairAssignment.bye,isByeAdvancedBye=drawPositionToAdvanceIsBye&&priorPairIsBye;isByeAdvancedBye&&console.log({isByeAdvancedBye});if((null==existingDrawPositions?void 0:existingDrawPositions.length)>1&&drawPositionToAdvanceIsBye&&!priorPairIsBye)return decorateResult({result:{error:DRAW_POSITION_ASSIGNED},stack});const pairedDrawPosition=null==existingDrawPositions?void 0:existingDrawPositions.find((drawPosition=>drawPosition!==drawPositionToAdvance));let drawPositionAssigned=isByeAdvancedBye;const twoDrawPositions=[].concat(...(noContextWinnerMatchUp.drawPositions||[]).filter(Boolean),void 0,void 0).slice(0,2),drawPositions=twoDrawPositions.map((position=>!position&&!drawPositionAssigned||position===drawPositionToAdvance?(drawPositionAssigned=!0,drawPositionToAdvance):position)).sort(numericSort);if(!drawPositionAssigned)return console.log("@@@@@@@",{advancingAssignmentIsBye,drawPositionToAdvance,existingAssignments}),decorateResult({result:{error:DRAW_POSITION_ASSIGNED},stack});const pairedDrawPositionIsBye=null==(_b=positionAssignments.find((({drawPosition})=>drawPosition===pairedDrawPosition)))?void 0:_b.bye,drawPositionIsBye=null==(_c=positionAssignments.find((({drawPosition})=>drawPosition===drawPositionToAdvance)))?void 0:_c.bye,matchUpStatus=drawPositionIsBye||pairedDrawPositionIsBye?BYE:TO_BE_PLAYED;Object.assign(noContextWinnerMatchUp,{matchUpStatus,score:void 0,winningSide:void 0,drawPositions}),noContextWinnerMatchUp.drawPositions.find((position=>!twoDrawPositions.includes(position))),pushGlobalLog(),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUp:noContextWinnerMatchUp,eventId:null==event?void 0:event.eventId,context:stack,drawDefinition});const{targetLinks:{loserTargetLink},targetMatchUps:{loserMatchUp,loserTargetDrawPosition}}=positionTargets({matchUpId:winnerMatchUp.matchUpId,inContextDrawMatchUps,drawDefinition,structure});if(pairedDrawPositionIsBye||drawPositionIsBye){const advancingDrawPosition=pairedDrawPositionIsBye?drawPositionToAdvance:pairedDrawPosition;if(advancingDrawPosition)advanceDrawPosition({drawPositionToAdvance:advancingDrawPosition,matchUpId:winnerMatchUp.matchUpId,inContextDrawMatchUps,tournamentRecord,drawDefinition,matchUpsMap});else if(drawPositionIsBye&&loserTargetLink&&loserMatchUp)if(loserMatchUp.feedRound)assignFedDrawPositionBye({loserTargetDrawPosition,tournamentRecord,loserTargetLink,drawDefinition,loserMatchUp,matchUpsMap});else{const targetDrawPositionIndex=1-winnerMatchUp.roundPosition%2,targetDrawPosition=loserMatchUp.drawPositions[targetDrawPositionIndex],result=assignDrawPositionBye$1({structureId:loserTargetLink.target.structureId,drawPosition:targetDrawPosition,loserTargetDrawPosition,iterative:"brightgreen",tournamentRecord,drawDefinition,event});if(result.error)return result}}}({drawPositionToAdvance,inContextDrawMatchUps,sourceDrawPositions,tournamentRecord,drawDefinition,winnerMatchUp,matchUpsMap,event}),loserMatchUp&&losingDrawPosiitonIsBye&&loserMatchUp.structureId!==structure.structureId){const{roundNumber}=loserMatchUp;if(1===roundNumber){const result=assignDrawPositionBye$1({structureId:loserTargetLink.target.structureId,drawPosition:loserTargetDrawPosition,iterative:"brightyellow",tournamentRecord,drawDefinition,event});if(result.error)return result}else assignFedDrawPositionBye({loserTargetDrawPosition,tournamentRecord,loserTargetLink,drawDefinition,loserMatchUp,matchUpsMap,event})}return __spreadValues$48({},SUCCESS)}function assignFedDrawPositionBye({loserTargetDrawPosition,tournamentRecord,loserTargetLink,drawDefinition,loserMatchUp,matchUpsMap,event}){const{roundNumber}=loserMatchUp;pushGlobalLog();const loserStructureMatchUps=((null==matchUpsMap?void 0:matchUpsMap.mappedMatchUps)||{})[loserMatchUp.structureId].matchUps,{initialRoundNumber}=getInitialRoundNumber({drawPosition:loserTargetDrawPosition,matchUps:loserStructureMatchUps});if(initialRoundNumber===roundNumber){const result=assignDrawPositionBye$1({structureId:loserTargetLink.target.structureId,drawPosition:loserTargetDrawPosition,tournamentRecord,iterative:"red",drawDefinition,event});if(result.error)return result}}var __defProp$47=Object.defineProperty,__defProps$2o=Object.defineProperties,__getOwnPropDescs$2o=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$48=Object.getOwnPropertySymbols,__hasOwnProp$48=Object.prototype.hasOwnProperty,__propIsEnum$48=Object.prototype.propertyIsEnumerable,__defNormalProp$47=(obj,key,value)=>key in obj?__defProp$47(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$47=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$48.call(b,prop)&&__defNormalProp$47(a,prop,b[prop]);if(__getOwnPropSymbols$48)for(var prop of __getOwnPropSymbols$48(b))__propIsEnum$48.call(b,prop)&&__defNormalProp$47(a,prop,b[prop]);return a},__spreadProps$2o=(a,b)=>__defProps$2o(a,__getOwnPropDescs$2o(b));function updateSideLineUp({inContextTargetMatchUp,drawPositionSideIndex,teamParticipantId,tournamentRecord,drawDefinition,matchUp,event}){var _a,_b,_c;const drawPositionSideNumber=null==(_b=null==(_a=null==inContextTargetMatchUp?void 0:inContextTargetMatchUp.sides)?void 0:_a[drawPositionSideIndex])?void 0:_b.sideNumber,sideExists=drawPositionSideNumber&&(null==(_c=matchUp.sides)?void 0:_c.find((side=>side.sideNumber===drawPositionSideNumber))),{extension:existingExtension}=findExtension$1({element:drawDefinition,name:LINEUPS}),lineUp=((null==existingExtension?void 0:existingExtension.value)||{})[teamParticipantId];if(sideExists)matchUp.sides.forEach((side=>{side.sideNumber===drawPositionSideNumber&&(side.lineUp=lineUp)}));else{matchUp.sides=[1,2].map((sideNumber=>{var _a2;const existingSide=(null==(_a2=matchUp.sides)?void 0:_a2.find((side=>side.sideNumber===sideNumber)))||{};return __spreadProps$2o(__spreadValues$47({},existingSide),{sideNumber})}));const targetSide=matchUp.sides.find((side=>side.sideNumber===drawPositionSideNumber));targetSide&&(targetSide.lineUp=lineUp)}modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,context:"updateSidLineUps",eventId:null==event?void 0:event.eventId,drawDefinition,matchUp})}function getExitWinningSide({inContextDrawMatchUps,drawPosition,matchUpId}){const sourceMatchUps=inContextDrawMatchUps.filter((({winnerMatchUpId,loserMatchUpId})=>loserMatchUpId===matchUpId||winnerMatchUpId===matchUpId)).sort(((a,b)=>a.roundPosition-b.roundPosition));return inContextDrawMatchUps.find((matchUp2=>matchUp2.matchUpId===matchUpId)).feedRound?1:sourceMatchUps.reduce(((sideNumber,sourceMatchUp,index)=>{var _a;return(null==(_a=sourceMatchUp.drawPositions)?void 0:_a.includes(drawPosition))?index+1:sideNumber}),void 0)}var __defProp$46=Object.defineProperty,__getOwnPropSymbols$47=Object.getOwnPropertySymbols,__hasOwnProp$47=Object.prototype.hasOwnProperty,__propIsEnum$47=Object.prototype.propertyIsEnumerable,__defNormalProp$46=(obj,key,value)=>key in obj?__defProp$46(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$46=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$47.call(b,prop)&&__defNormalProp$46(a,prop,b[prop]);if(__getOwnPropSymbols$47)for(var prop of __getOwnPropSymbols$47(b))__propIsEnum$47.call(b,prop)&&__defNormalProp$46(a,prop,b[prop]);return a};function assignMatchUpDrawPosition({inContextDrawMatchUps,sourceMatchUpStatus,tournamentRecord,sourceMatchUpId,drawDefinition,matchUpStatus,drawPosition,matchUpsMap,matchUpId,event}){var _a,_b,_c,_d;const stack="assignMatchUpDrawPosition";matchUpsMap||(matchUpsMap=getMatchUpsMap({drawDefinition})),inContextDrawMatchUps||({matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap}));const inContextMatchUp=inContextDrawMatchUps.find((m=>m.matchUpId===matchUpId)),structureId=null==inContextMatchUp?void 0:inContextMatchUp.structureId,structure=null==(_a=null==drawDefinition?void 0:drawDefinition.structures)?void 0:_a.find((structure2=>structure2.structureId===structureId));if(!structure)return{error:STRUCTURE_NOT_FOUND};const matchUp=null==(_b=null==matchUpsMap?void 0:matchUpsMap.drawMatchUps)?void 0:_b.find((matchUp2=>matchUp2.matchUpId===matchUpId)),drawPositions=matchUp.drawPositions||[],{positionAdded,positionAssigned,updatedDrawPositions}=function getUpdatedDrawPositions({drawPosition,drawPositions}){let positionAdded,positionAssigned=null==drawPositions?void 0:drawPositions.includes(drawPosition);return{updatedDrawPositions:positionAssigned?drawPositions||[]:[].concat(...drawPositions,void 0,void 0).slice(0,2).map((position=>position||positionAssigned?position:(positionAssigned=!0,positionAdded=!0,drawPosition))).sort(numericSort).filter(Boolean),positionAdded,positionAssigned}}({drawPosition,drawPositions}),{positionAssignments}=getPositionAssignments$1({drawDefinition,structure}),isByeMatchUp=positionAssignments.filter((assignment=>updatedDrawPositions.includes(assignment.drawPosition))).find((({bye})=>bye)),isDoubleExitExit=[WALKOVER$2,DEFAULTED].includes(matchUp.matchUpStatus)&&updatedDrawPositions.filter(Boolean).length<2;if(matchUpStatus=isByeMatchUp&&BYE||matchUpStatus||isDoubleExitExit&&matchUp.matchUpStatus||[DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(matchUp.matchUpStatus)&&matchUp.matchUpStatus||TO_BE_PLAYED,positionAdded){({matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap}));const exitWinningSide=isDoubleExitExit&&getExitWinningSide({inContextDrawMatchUps,drawPosition,matchUpId})||void 0;matchUp.matchUpStatusCodes&&updateMatchUpStatusCodes({inContextDrawMatchUps,sourceMatchUpStatus,sourceMatchUpId,matchUpsMap,matchUp}),Object.assign(matchUp,{drawPositions:updatedDrawPositions,winningSide:exitWinningSide,matchUpStatus}),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==inContextMatchUp?void 0:inContextMatchUp.eventId,context:stack,drawDefinition,matchUp})}const targetData=positionTargets({inContextDrawMatchUps,inContextMatchUp,drawDefinition,matchUpId}),{targetMatchUps:{winnerMatchUp,loserMatchUp,loserTargetDrawPosition},targetLinks:{loserTargetLink}}=targetData,structureMatchUps=getMappedStructureMatchUps({structureId:structure.structureId,matchUpsMap});if(positionAssigned&&isByeMatchUp){if(winnerMatchUp)if([BYE,DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(matchUpStatus)){const result=assignMatchUpDrawPosition({matchUpId:winnerMatchUp.matchUpId,iterative:"brightmagenta",inContextDrawMatchUps,tournamentRecord,drawDefinition,drawPosition,matchUpsMap});if(result.error)return result}else{const{structureId:structureId2}=winnerMatchUp;structureId2!==structure.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(winnerMatchUp&&!inContextMatchUp.feedRound){const{pairedPreviousMatchUpIsDoubleExit}=getPairedPreviousMatchUpIsDoubleExit({targetMatchUp:matchUp,drawPosition,matchUpsMap,structure});if(pairedPreviousMatchUpIsDoubleExit){const result=assignMatchUpDrawPosition({matchUpId:winnerMatchUp.matchUpId,iterative:"brightred",inContextDrawMatchUps,tournamentRecord,drawDefinition,drawPosition,matchUpsMap});if(result.error)return result}}if(matchUp.matchUpType===TEAM$2){const inContextTargetMatchUp=null==inContextDrawMatchUps?void 0:inContextDrawMatchUps.find((({matchUpId:matchUpId2})=>matchUpId2===matchUp.matchUpId)),drawPositionSideIndex=null==(_c=null==inContextTargetMatchUp?void 0:inContextTargetMatchUp.sides)?void 0:_c.reduce(((index,side,i)=>side.drawPosition===drawPosition?i:index),void 0),teamParticipantId=null==(_d=positionAssignments.find((assignment=>assignment.drawPosition===drawPosition)))?void 0:_d.participantId;teamParticipantId&&void 0!==drawPositionSideIndex&&updateSideLineUp({inContextTargetMatchUp,drawPositionSideIndex,teamParticipantId,tournamentRecord,drawDefinition,matchUp})}if((null==loserTargetLink?void 0:loserTargetLink.linkCondition)===FIRST_MATCHUP&&2===updatedDrawPositions.filter(Boolean).length&&!isByeMatchUp){if(structureMatchUps.filter((({drawPositions:drawPositions2,roundNumber})=>1===roundNumber&&overlap(drawPositions2,updatedDrawPositions))).every((({matchUpStatus:matchUpStatus2})=>[COMPLETED$1,RETIRED$1].includes(matchUpStatus2)))&&loserMatchUp){const{structureId:structureId2}=loserMatchUp,result=assignDrawPositionBye$1({drawPosition:loserTargetDrawPosition,tournamentRecord,drawDefinition,structureId:structureId2,matchUpsMap,event});if(result.error)return result}}return positionAssigned?__spreadValues$46({},SUCCESS):decorateResult({result:{error:DRAW_POSITION_ASSIGNED},context:{drawPosition},stack})}var __defProp$45=Object.defineProperty,__defProps$2n=Object.defineProperties,__getOwnPropDescs$2n=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$46=Object.getOwnPropertySymbols,__hasOwnProp$46=Object.prototype.hasOwnProperty,__propIsEnum$46=Object.prototype.propertyIsEnumerable,__defNormalProp$45=(obj,key,value)=>key in obj?__defProp$45(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$45=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$46.call(b,prop)&&__defNormalProp$45(a,prop,b[prop]);if(__getOwnPropSymbols$46)for(var prop of __getOwnPropSymbols$46(b))__propIsEnum$46.call(b,prop)&&__defNormalProp$45(a,prop,b[prop]);return a},__spreadProps$2n=(a,b)=>__defProps$2n(a,__getOwnPropDescs$2n(b));function doubleExitAdvancement(params){var _a;const{tournamentRecord,appliedPolicies,drawDefinition,matchUpsMap,targetData,structure,event}=params,stack="doubleExitAdvancement";if(structure.structureType===CONTAINER)return decorateResult({result:__spreadValues$45({},SUCCESS),stack});const{matchUp:sourceMatchUp,targetMatchUps,targetLinks}=targetData,{loserMatchUp,winnerMatchUp,loserTargetDrawPosition}=targetMatchUps;if(loserMatchUp&&loserMatchUp.matchUpStatus!==BYE){const{loserTargetLink}=targetLinks;if(null==(_a=null==appliedPolicies?void 0:appliedPolicies.progression)?void 0:_a.doubleExitPropagateBye){const result=advanceByeToLoserMatchUp({loserTargetDrawPosition,tournamentRecord,loserTargetLink,drawDefinition,loserMatchUp,matchUpsMap,event});if(result.error)return decorateResult({result,stack})}else{const{feedRound,drawPositions,matchUpId}=loserMatchUp,walkoverWinningSide=feedRound?2:2-drawPositions.indexOf(loserTargetDrawPosition),result=conditionallyAdvanceDrawPosition(__spreadProps$2n(__spreadValues$45({},params),{targetMatchUp:loserMatchUp,walkoverWinningSide,tournamentRecord,sourceMatchUp,matchUpId}));if(result.error)return decorateResult({result,stack})}}if(winnerMatchUp){const result=conditionallyAdvanceDrawPosition(__spreadProps$2n(__spreadValues$45({},params),{matchUpId:winnerMatchUp.matchUpId,targetMatchUp:winnerMatchUp,tournamentRecord,sourceMatchUp}));if(result.error)return decorateResult({result,stack})}return decorateResult({result:__spreadValues$45({},SUCCESS),stack})}function conditionallyAdvanceDrawPosition(params){var _a,_b,_c;const{inContextDrawMatchUps,tournamentRecord,drawDefinition,sourceMatchUp,targetMatchUp,matchUpsMap}=params,structure=drawDefinition.structures.find((({structureId})=>structureId===targetMatchUp.structureId)),DOUBLE_EXIT=params.matchUpStatus===DOUBLE_DEFAULT?DOUBLE_DEFAULT:DOUBLE_WALKOVER,EXIT=params.matchUpStatus===DOUBLE_DEFAULT?DEFAULTED:WALKOVER$2,stack="conditionallyAdvanceDrawPosition",noContextTargetMatchUp=matchUpsMap.drawMatchUps.find((matchUp=>matchUp.matchUpId===targetMatchUp.matchUpId));if(!noContextTargetMatchUp)return{error:MISSING_MATCHUP};const sourceDrawPositions=(null==sourceMatchUp?void 0:sourceMatchUp.drawPositions)||[];let targetMatchUpDrawPositions=null==(_a=noContextTargetMatchUp.drawPositions)?void 0:_a.filter(Boolean);const sameStructure=(null==sourceMatchUp?void 0:sourceMatchUp.structureId)===targetMatchUp.structureId;if(sameStructure&&overlap(sourceDrawPositions,targetMatchUpDrawPositions)&&(targetMatchUpDrawPositions=targetMatchUpDrawPositions.filter((drawPosition=>!sourceDrawPositions.includes(drawPosition)))),sameStructure&&targetMatchUpDrawPositions.length>1)return decorateResult({result:{error:DRAW_POSITION_ASSIGNED},stack});const{pairedPreviousMatchUpIsDoubleExit,pairedPreviousMatchUp}=getPairedPreviousMatchUpIsDoubleExit(params),targetData=positionTargets({matchUpId:targetMatchUp.matchUpId,inContextDrawMatchUps,drawDefinition,structure}),{targetMatchUps,targetLinks}=targetData,{loserTargetDrawPosition:nextLoserTargetDrawPosition,winnerMatchUp:nextWinnerMatchUp,loserMatchUp:nextLoserMatchUp}=targetMatchUps;if(nextLoserMatchUp){const{loserTargetLink}=targetLinks,result2=advanceByeToLoserMatchUp({loserTargetDrawPosition:nextLoserTargetDrawPosition,loserMatchUp:nextLoserMatchUp,tournamentRecord,loserTargetLink,drawDefinition,matchUpsMap});if(result2.error)return decorateResult({result:result2,stack})}const drawPositions=(null==(_b=noContextTargetMatchUp.drawPositions)?void 0:_b.filter(Boolean))||[],hasDrawPosition=1===drawPositions.length,walkoverWinningSide=params.walkoverWinningSide||hasDrawPosition&&getExitWinningSide({drawPosition:drawPositions[0],matchUpId:targetMatchUp.matchUpId,inContextDrawMatchUps})||void 0,existingExit=[WALKOVER$2,DEFAULTED].includes(noContextTargetMatchUp.matchUpStatus)&&!drawPositions.length,isFinal=1===noContextTargetMatchUp.finishingRound,matchUpStatus=existingExit&&!isFinal?DOUBLE_EXIT:EXIT,inContextPairedPreviousMatchUp=inContextDrawMatchUps.find((candidate=>candidate.matchUpId===pairedPreviousMatchUp.matchUpId));let sourceSideNumber,matchUpStatusCodes=[];sourceMatchUp&&((null==sourceMatchUp?void 0:sourceMatchUp.structureId)===(null==inContextPairedPreviousMatchUp?void 0:inContextPairedPreviousMatchUp.structureId)?sourceSideNumber=sourceMatchUp.roundPosition<(null==pairedPreviousMatchUp?void 0:pairedPreviousMatchUp.roundPosition)?1:2:targetMatchUp.feedRound?sourceSideNumber=sourceMatchUp.structureId===targetMatchUp.structureId?2:1:walkoverWinningSide&&(sourceSideNumber=3-walkoverWinningSide));const sourceMatchUpStatus=params.matchUpStatus,pairedMatchUpStatus=null==pairedPreviousMatchUp?void 0:pairedPreviousMatchUp.matchUpStatus;1===sourceSideNumber?matchUpStatusCodes=[{sideNumber:1,previousMatchUpStatus:sourceMatchUpStatus,matchUpStatus:producedMatchUpStatus(sourceMatchUpStatus)},{sideNumber:2,previousMatchUpStatus:pairedMatchUpStatus,matchUpStatus:producedMatchUpStatus(pairedMatchUpStatus)}]:2===sourceSideNumber&&(matchUpStatusCodes=[{sideNumber:1,previousMatchUpStatus:pairedMatchUpStatus,matchUpStatus:producedMatchUpStatus(pairedMatchUpStatus)},{sideNumber:2,previousMatchUpStatus:sourceMatchUpStatus,matchUpStatus:producedMatchUpStatus(sourceMatchUpStatus)}]),matchUpStatusCodes.length&&(matchUpStatusCodes=matchUpStatusCodes.map((code=>definedAttributes(code))));const result=modifyMatchUpScore(__spreadProps$2n(__spreadValues$45({},params),{matchUp:noContextTargetMatchUp,winningSide:walkoverWinningSide,matchUpStatusCodes,matchUpStatus}));if(result.error)return decorateResult({result,stack});if(existingExit)return doubleExitAdvancement(__spreadProps$2n(__spreadValues$45({},params),{matchUpStatus,targetData}));if(!nextWinnerMatchUp)return decorateResult({result:__spreadValues$45({},SUCCESS),stack});const drawPositionToAdvance=2===targetMatchUpDrawPositions.length?targetMatchUpDrawPositions[walkoverWinningSide-1]:targetMatchUpDrawPositions[0],{positionAssignments}=getPositionAssignments$1({structure}),assignment=positionAssignments.find((assignment2=>assignment2.drawPosition===drawPositionToAdvance)),noContextNextWinnerMatchUp=matchUpsMap.drawMatchUps.find((matchUp=>matchUp.matchUpId===nextWinnerMatchUp.matchUpId)),nextWinnerMatchUpDrawPositions=null==(_c=null==noContextNextWinnerMatchUp?void 0:noContextNextWinnerMatchUp.drawPositions)?void 0:_c.filter(Boolean),nextWinnerMatchUpHasDrawPosition=1===nextWinnerMatchUpDrawPositions.length;if(drawPositionToAdvance){if(assignment.bye){const targetData2=positionTargets({matchUpId:noContextNextWinnerMatchUp.matchUpId,inContextDrawMatchUps,drawDefinition,structure});if(nextWinnerMatchUpHasDrawPosition){const nextDrawPositionToAdvance=nextWinnerMatchUpDrawPositions.filter(Boolean)[0],winningSide=getExitWinningSide({drawPosition:nextDrawPositionToAdvance,matchUpId:noContextNextWinnerMatchUp.matchUpId,inContextDrawMatchUps}),result2=modifyMatchUpScore({matchUpId:noContextNextWinnerMatchUp.matchUpId,matchUp:noContextNextWinnerMatchUp,matchUpStatus:EXIT,matchUpStatusCodes:[],removeScore:!0,drawDefinition,winningSide});return result2.error?decorateResult({result:result2,stack}):advanceDrawPosition({drawPositionToAdvance:nextDrawPositionToAdvance,matchUpId:noContextNextWinnerMatchUp.matchUpId,inContextDrawMatchUps,drawDefinition,matchUpsMap})}if([WALKOVER$2,DEFAULTED].includes(nextWinnerMatchUp.matchUpStatus)){const result2=doubleExitAdvancement(__spreadProps$2n(__spreadValues$45({},params),{matchUpId:noContextNextWinnerMatchUp.matchUpId,matchUpStatus,targetData:targetData2}));if(result2.error)return decorateResult({result:result2,stack})}return decorateResult({result:__spreadValues$45({},SUCCESS),stack})}return assignMatchUpDrawPosition({matchUpId:nextWinnerMatchUp.matchUpId,drawPosition:drawPositionToAdvance,inContextDrawMatchUps,drawDefinition})}if(pairedPreviousMatchUpIsDoubleExit){if(!noContextNextWinnerMatchUp)return{error:MISSING_MATCHUP};if(nextWinnerMatchUpHasDrawPosition){const drawPosition=nextWinnerMatchUpDrawPositions[0],walkoverWinningSide2=getExitWinningSide({matchUpId:targetMatchUp.matchUpId,inContextDrawMatchUps,drawPosition});console.log("existing drawPosition is winningSide",{walkoverWinningSide:walkoverWinningSide2})}const matchUpStatus2=[WALKOVER$2,DEFAULTED].includes(noContextNextWinnerMatchUp.matchUpStatus)?EXIT:DOUBLE_EXIT,result2=modifyMatchUpScore({matchUpId:noContextNextWinnerMatchUp.matchUpId,matchUp:noContextNextWinnerMatchUp,matchUpStatusCodes:[],removeScore:!0,drawDefinition,matchUpStatus:matchUpStatus2});if(result2.error)return decorateResult({result:result2,stack});if(matchUpStatus2===DOUBLE_EXIT){const advancementResult=doubleExitAdvancement(__spreadProps$2n(__spreadValues$45({},params),{matchUpId:targetMatchUp.matchUpId,matchUpStatus:matchUpStatus2,targetData}));if(advancementResult.error)return advancementResult}}return decorateResult({result:__spreadValues$45({},SUCCESS),stack})}function advanceByeToLoserMatchUp(params){var _a;const{loserTargetDrawPosition,tournamentRecord,loserTargetLink,drawDefinition,matchUpsMap,event}=params,structureId=null==(_a=null==loserTargetLink?void 0:loserTargetLink.target)?void 0:_a.structureId,{structure}=findStructure({drawDefinition,structureId});return structure?assignDrawPositionBye$1({drawPosition:loserTargetDrawPosition,tournamentRecord,drawDefinition,structureId,matchUpsMap,event}):{error:MISSING_STRUCTURE}}function producedMatchUpStatus(previousMatchUpStatus){return previousMatchUpStatus===DOUBLE_WALKOVER?WALKOVER$2:previousMatchUpStatus===DOUBLE_DEFAULT?DEFAULTED:previousMatchUpStatus}var __defProp$44=Object.defineProperty,__getOwnPropSymbols$45=Object.getOwnPropertySymbols,__hasOwnProp$45=Object.prototype.hasOwnProperty,__propIsEnum$45=Object.prototype.propertyIsEnumerable,__defNormalProp$44=(obj,key,value)=>key in obj?__defProp$44(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$44=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$45.call(b,prop)&&__defNormalProp$44(a,prop,b[prop]);if(__getOwnPropSymbols$45)for(var prop of __getOwnPropSymbols$45(b))__propIsEnum$45.call(b,prop)&&__defNormalProp$44(a,prop,b[prop]);return a};var __defProp$43=Object.defineProperty,__defProps$2m=Object.defineProperties,__getOwnPropDescs$2m=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$44=Object.getOwnPropertySymbols,__hasOwnProp$44=Object.prototype.hasOwnProperty,__propIsEnum$44=Object.prototype.propertyIsEnumerable,__defNormalProp$43=(obj,key,value)=>key in obj?__defProp$43(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$43=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$44.call(b,prop)&&__defNormalProp$43(a,prop,b[prop]);if(__getOwnPropSymbols$44)for(var prop of __getOwnPropSymbols$44(b))__propIsEnum$44.call(b,prop)&&__defNormalProp$43(a,prop,b[prop]);return a},__spreadProps$2m=(a,b)=>__defProps$2m(a,__getOwnPropDescs$2m(b));function attemptToSetMatchUpStatus(params){const{tournamentRecord,drawDefinition,matchUpStatus,structure,matchUp}=params,isBYE=matchUpStatus===BYE,existingWinningSide=matchUp.winningSide,isDoubleExit=[DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(matchUpStatus),directing=isDirectingMatchUpStatus({matchUpStatus}),nonDirecting=isNonDirectingMatchUpStatus({matchUpStatus}),unrecognized=!directing&&!nonDirecting,onlyModifyScore=params.matchUpTieId||existingWinningSide&&directing&&!isDoubleExit,changeCompletedToDoubleExit=existingWinningSide&&isDoubleExit;return unrecognized&&{error:UNRECOGNIZED_MATCHUP_STATUS}||onlyModifyScore&&scoreModification$1(params)||changeCompletedToDoubleExit&&function removeWinningSideAndSetDoubleExit(params){let result=removeDirectedParticipants(params);return result.error?result:doubleExitAdvancement(params)}(params)||existingWinningSide&&removeDirectedParticipants(params)||nonDirecting&&modifyMatchUpScore(__spreadProps$2m(__spreadValues$43({},params),{removeScore:[CANCELLED$1,WALKOVER$2].includes(matchUpStatus),matchUpStatus:matchUpStatus||TO_BE_PLAYED}))||isBYE&&function attemptToSetMatchUpStatusBYE({tournamentRecord,drawDefinition,structure,matchUp}){var _a;if(null==matchUp?void 0:matchUp.winningSide)return decorateResult({result:{error:INVALID_MATCHUP_STATUS},context:{matchUpStatus:BYE},stack});const stack="attemptToSetMatchUpStatusBYE",{positionAssignments}=structureAssignedDrawPositions({structure}),byeAssignedDrawPositions=positionAssignments.filter((assignment=>assignment.bye)).map((assignment=>assignment.drawPosition));return(null==(_a=matchUp.drawPositions)?void 0:_a.some((position=>byeAssignedDrawPositions.includes(position))))?(matchUp.matchUpStatus=BYE,matchUp.matchUpStatusCodes=[],modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,context:stack,matchUp}),__spreadValues$44({},SUCCESS)):decorateResult({result:{error:INVALID_MATCHUP_STATUS_BYE},info:"matchUp does not include BYE",stack})}({tournamentRecord,drawDefinition,structure,matchUp})||!directing&&{error:UNRECOGNIZED_MATCHUP_STATUS}||isDoubleExit&&function modifyScoreAndAdvanceDoubleExit(params){const result=scoreModification$1(__spreadProps$2m(__spreadValues$43({},params),{removeScore:!0}));return result.error?result:doubleExitAdvancement(params)}(params)||decorateResult({result:{error:INVALID_MATCHUP_STATUS},stack:"attemptToSetMatchUpStatus"})}function scoreModification$1(params){var _a;const stack="scoreModification";if(params.isCollectionMatchUp&&(null==(_a=params.dualMatchUp)?void 0:_a.winningSide)&&!params.projectedWinningSide){const result2=removeDirectedParticipants(params);if(result2.error)return decorateResult({result:result2,stack})}const isCollectionMatchUp=Boolean(params.matchUp.collectionId),result=modifyMatchUpScore(params);if(isCollectionMatchUp){const{matchUpTieId,drawDefinition}=params,result2=updateTieMatchUpScore$1({tournamentRecord:params.tournamentRecord,matchUpId:matchUpTieId,event:params.event,drawDefinition});if(result2.error)return decorateResult({result:result2,stack})}return decorateResult({result,stack})}function getPlayoffStructures({drawDefinition,structureId}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const{structure}=findStructure({drawDefinition,structureId}),targetStructureIds=((null==drawDefinition?void 0:drawDefinition.links)||[]).filter((link=>{var _a;return(null==(_a=link.source)?void 0:_a.structureId)===structureId})).map((link=>{var _a;return null==(_a=link.target)?void 0:_a.structureId}));return{playoffStructures:((null==drawDefinition?void 0:drawDefinition.structures)||[]).filter((structure2=>targetStructureIds.includes(structure2.structureId)&&structure2.stage===PLAY_OFF)),structure}}function getEventStructures({withStageGrouping,stageSequences,stageSequence,roundTarget,stages,event,stage}){if(!event)return{error:MISSING_EVENT};const stageStructures={},structures=[];for(const drawDefinition of event.drawDefinitions||[]){const{structures:drawStructures,stageStructures:drawStageStructures}=getDrawStructures({withStageGrouping,stageSequences,drawDefinition,stageSequence,roundTarget,stages,stage});if(structures.push(...drawStructures),drawStageStructures)for(const stage2 of Object.keys(drawStageStructures))stageStructures[stage2]||(stageStructures[stage2]=[]),stageStructures[stage2].push(...drawStageStructures[stage2])}return{structures,stageStructures}}function isCompletedStructure(params){if(!(null==params?void 0:params.drawDefinition))return{error:MISSING_DRAW_DEFINITION};const structureMatchUps=getStructureMatchUps(params);let{includesTeamMatchUps,completedMatchUps,pendingMatchUps,upcomingMatchUps}=structureMatchUps||{};includesTeamMatchUps&&(completedMatchUps=completedMatchUps.filter((({matchUpType})=>matchUpType===TEAM$2)),pendingMatchUps=pendingMatchUps.filter((({matchUpType})=>matchUpType===TEAM$2)),upcomingMatchUps=upcomingMatchUps.filter((({matchUpType})=>matchUpType===TEAM$2)));return!!((null==completedMatchUps?void 0:completedMatchUps.length)&&!(null==pendingMatchUps?void 0:pendingMatchUps.length)&&!upcomingMatchUps.length)}function allPlayoffPositionsFilled(params){var _a,_b;const{drawDefinition,structureId}=params;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const{playoffStructures}=getPlayoffStructures({drawDefinition,structureId});if(!(null==playoffStructures?void 0:playoffStructures.length))return!1;const enteredParticipantsCount=(null==(_b=null==(_a=null==drawDefinition?void 0:drawDefinition.entries)?void 0:_a.filter((entry=>STRUCTURE_SELECTED_STATUSES.includes(null==entry?void 0:entry.entryStatus))))?void 0:_b.length)||0;let participantIdsCount=0;return(playoffStructures||[]).reduce(((allFilled,structure)=>{var _a2;return!(null==(_a2=null==structure?void 0:structure.positionAssignments)?void 0:_a2.filter((assignment=>(assignment.participantId&&participantIdsCount++,!(null==assignment?void 0:assignment.bye)&&!(null==assignment?void 0:assignment.participantId)))).length)&&allFilled}),!0)||participantIdsCount===enteredParticipantsCount}function checkConnectedStructures({drawDefinition,matchUpsMap,structure,matchUp}){const connectedStructureIds=[];if(structure.finishingPosition===WIN_RATIO){if(isCompletedStructure({drawDefinition,structure})){const{structureIds}=function getAffectedTargetStructureIds({drawDefinition,structure,matchUp}){var _a,_b;const{drawPositions}=matchUp,{positionAssignments}=getPositionAssignments$1({drawDefinition,structure}),finishingPositions=positionAssignments.filter((({drawPosition})=>null==drawPositions?void 0:drawPositions.includes(drawPosition))).map((assignment=>{var _a2;const{extension}=findExtension$1({element:assignment,name:TALLY});return null==(_a2=null==extension?void 0:extension.value)?void 0:_a2.groupOrder})),{containerStructures}=getContainedStructures({drawDefinition}),links=null==(_b=null==(_a=getStructureLinks({drawDefinition,structureId:containerStructures[structure.structureId]}))?void 0:_a.links)?void 0:_b.source;return{structureIds:null==links?void 0:links.filter((link=>{var _a2;return overlap(finishingPositions,(null==(_a2=link.source)?void 0:_a2.finishingPositions)||[])})).map((link=>link.source.structureId))}}({drawDefinition,matchUpsMap,structure,matchUp});(null==structureIds?void 0:structureIds.length)&&connectedStructureIds.push(...structureIds)}}return{connectedStructureIds}}function attemptToModifyScore(params){const{dualWinningSideChange,matchUpStatusCodes,tournamentRecord,drawDefinition,matchUpFormat,matchUpStatus,winningSide,matchUpId,structure,matchUp,event,score}=params,matchUpStatusIsValid=isDirectingMatchUpStatus({matchUpStatus})||[CANCELLED$1,ABANDONED].includes(matchUpStatus)&&dualWinningSideChange,isCollectionMatchUp=Boolean(matchUp.collectionId),isAdHocMatchUp=isAdHoc({drawDefinition,structure}),validToScore=isCollectionMatchUp||isAdHocMatchUp||function drawPositionsAssignedParticipantIds({structure,matchUp}){const{drawPositions}=matchUp,{positionAssignments}=structureAssignedDrawPositions({structure});return 2===positionAssignments.filter((assignment=>(null==drawPositions?void 0:drawPositions.includes(assignment.drawPosition))&&assignment.participantId)).length}({structure,matchUp});if(!validToScore)return{error:MISSING_ASSIGNMENTS};const removeScore=[WALKOVER$2].includes(matchUpStatus);return decorateResult({result:modifyMatchUpScore({matchUpStatusCodes:matchUpStatusIsValid&&matchUpStatusCodes||[],matchUpStatus:matchUpStatusIsValid&&matchUpStatus||COMPLETED$1,tournamentRecord,drawDefinition,matchUpFormat,removeScore,winningSide,matchUpId,matchUp,event,score}),stack:"attemptToModifyScore"})}function removeLineUpSubstitutions({lineUp}){if(!Array.isArray(lineUp))return;const participantAssignments={};return unique(lineUp.flatMap((({collectionAssignments})=>collectionAssignments.map((({collectionId,collectionPosition})=>[collectionId,collectionPosition].join("|")))))).forEach((permutation=>{const[collectionId,position]=permutation.split("|"),collectionPosition=parseInt(position),{assignedParticipantIds}=getCollectionPositionAssignments({collectionPosition,collectionId,lineUp});assignedParticipantIds.forEach((participantId=>{participantAssignments[participantId]||(participantAssignments[participantId]=[]),participantAssignments[participantId].push({collectionId,collectionPosition})}))})),Object.keys(participantAssignments).map((participantId=>({participantId,collectionAssignments:participantAssignments[participantId]})))}function conditionallyDisableLinkPositioning({drawPositions,structure}){if([QUALIFYING,MAIN].includes(structure.stage)&&1===structure.stageSequence)return;const{positionAssignments}=getPositionAssignments$1({structure});positionAssignments.filter((({drawPosition})=>null==drawPositions?void 0:drawPositions.includes(drawPosition))).forEach((assignment=>{addExtension$1({element:assignment,extension:{name:DISABLE_LINKS,value:!0}})}))}function getNumericSeedValue(seedValue){if(!seedValue)return;if(isConvertableInteger(seedValue))return parseInt(seedValue);const firstValue=seedValue.split("-")[0];return isConvertableInteger(firstValue)?parseInt(firstValue):void 0}const structureTemplate=({finishingPosition=ROUND_OUTCOME,structureAbbreviation,seedAssignments=[],stageSequence=1,qualifyingRoundNumber,seedingProfile,matchUpFormat,structureType,structureName,matchUps=[],structureId,roundOffset,roundLimit,stageOrder,structures,stage})=>{const structure={structureId:structureId||UUID(),structureAbbreviation,finishingPosition,seedAssignments,matchUpFormat,stageSequence,structureName};stage&&(structure.stage=stage),stageOrder&&(structure.stageOrder=stageOrder),roundLimit&&(structure.roundLimit=roundLimit),roundOffset&&(structure.roundOffset=roundOffset),structureType&&(structure.structureType=structureType),seedingProfile&&(structure.seedingProfile=seedingProfile),qualifyingRoundNumber&&(structure.qualifyingRoundNumber=qualifyingRoundNumber);const positionAssignments=[].concat(...matchUps.map((matchUp=>matchUp.drawPositions))).filter(Boolean);return structures?structure.structures=structures:(structure.matchUps=matchUps,structure.positionAssignments=unique(positionAssignments).sort(((a,b)=>a-b)).map((drawPosition=>({drawPosition})))),structure};function generateMatchUpId({idPrefix,roundNumber,roundPosition,uuids}){return idPrefix?`${idPrefix}-${roundNumber}-${roundPosition}`:(null==uuids?void 0:uuids.pop())||UUID()}function buildFeedRound({includeMatchUpType,drawPosition,roundNumber,matchUpType,idPrefix,matchUps,isMock,uuids,nodes,fed}){const feedRoundMatchUpsCount=nodes.length,initialGroupDrawPosition=drawPosition?drawPosition-feedRoundMatchUpsCount:void 0,drawPositionGroup=generateRange(0,feedRoundMatchUpsCount).map((value=>initialGroupDrawPosition?initialGroupDrawPosition+value:void 0)),roundNodes=[];for(let nodeIndex=0;nodeIndex<feedRoundMatchUpsCount;nodeIndex++){const feedDrawPosition=drawPositionGroup.shift(),feedArm={drawPosition:feedDrawPosition,fed:fed+1,feed:!0},position=nodes[nodeIndex];position.roundNumber=roundNumber-1;const matchUpId=generateMatchUpId({roundPosition:position.roundPosition,roundNumber,idPrefix,uuids}),newMatchUp={roundPosition:position.roundPosition,drawPositions:[feedDrawPosition],matchUpStatus:TO_BE_PLAYED,roundNumber,matchUpId};includeMatchUpType&&(newMatchUp.matchUpType=matchUpType),isMock&&(newMatchUp.isMock=!0),matchUps.push(newMatchUp);const roundNode={children:[position,feedArm]};roundNodes.push(roundNode)}return{roundNodes,matchUps,drawPosition:drawPosition?drawPosition-feedRoundMatchUpsCount:void 0}}function buildRound({includeMatchUpType,matchUpType,roundNumber,matchUps,idPrefix,isMock,uuids,nodes}){let index=0;const roundNodes=[];let roundPosition=1;const matchRoundNumber=roundNumber-1,roundMatchUpsCount=nodes.length;for(;index<roundMatchUpsCount;){const child1=nodes[index],child2=nodes[index+1];matchRoundNumber&&(child1.roundNumber=matchRoundNumber),child2&&matchRoundNumber&&(child2.roundNumber=matchRoundNumber);const node={roundPosition,children:[child1,child2],matchUpId:generateMatchUpId({roundPosition,roundNumber,idPrefix,uuids})};roundNodes.push(node);const matchUp={drawPositions:node.children.map((c=>null==c?void 0:c.drawPosition)).filter(Boolean),matchUpStatus:TO_BE_PLAYED,matchUpId:node.matchUpId,roundPosition,roundNumber};includeMatchUpType&&(matchUp.matchUpType=matchUpType),isMock&&(matchUp.isMock=!0),matchUps.push(matchUp),roundPosition++,index+=2}return{roundNodes,matchUps}}function feedInMatchUps({linkFedFinishingRoundNumbers=[],linkFedRoundNumbers=[],finishingPositionOffset,feedRoundsProfile=[],feedRounds=0,skipRounds=0,feedsFromFinal,isConsolation,baseDrawSize,matchUpType,idPrefix,drawSize,isMock,uuids,fmlc}){const baseDrawRounds=function roundMatchCounts({drawSize}){const rounds=Math.ceil(Math.log(drawSize)/Math.log(2));return generateRange(0,rounds).reverse().map((r=>Math.pow(2,r)))}({drawSize:baseDrawSize=baseDrawSize||function getBaseDrawSize(drawSize2){const nearestP2=nearestPowerOf2(drawSize2);return nearestP2>drawSize2?nearestP2/2:nearestP2}(drawSize)}),baseRoundsCount=baseDrawRounds.length;let positionsFed=0;if(feedRoundsProfile.length)positionsFed=feedRoundsProfile.reduce(((a,b)=>a+b),0);else if(drawSize){let positionsToFeed=drawSize-baseDrawSize;feedRoundsProfile=baseDrawRounds.filter((feedSize=>feedSize<=positionsToFeed&&(positionsToFeed-=feedSize,!0))),positionsFed=feedRoundsProfile.reduce(((a,b)=>a+b),0),feedRounds=feedRoundsProfile.length}else skipRounds>=baseRoundsCount?feedRounds=0:feedsFromFinal&&(feedRounds=baseRoundsCount-feedsFromFinal,skipRounds=0),feedRoundsProfile=baseDrawRounds.filter(((feedSize,i)=>feedsFromFinal&&!feedRounds||feedRounds&&i>=skipRounds+feedRounds||i<skipRounds?0:feedSize)),positionsFed=feedRoundsProfile.reduce(((a,b)=>a+b),0),drawSize=baseDrawSize+positionsFed,feedRounds=feedRoundsProfile.length;const allRounds=[...baseDrawRounds,...feedRoundsProfile].sort(((a,b)=>b-a)),roundsCount=allRounds.length,positionsFedByLinks=[...linkFedRoundNumbers.map((n=>n-1)),...linkFedFinishingRoundNumbers.map((n=>roundsCount-n))].map((i=>allRounds[i])).reduce(((a,b)=>a+b),0);positionsFed-=positionsFedByLinks;let roundNodes,fed=0,matchUps=[],roundNumber=1;let nodes=generateRange(0,baseDrawSize).map(((x,i)=>({drawPosition:i+1+positionsFed}))),drawPosition=positionsFed+1;for(const baseDrawRound of baseDrawRounds){if(({roundNodes,matchUps}=buildRound({matchUpType,roundNumber,idPrefix,matchUps,isMock,nodes,uuids})),roundNumber++,feedRoundsProfile.includes(baseDrawRound)){const iterationRange=generateRange(0,instanceCount(feedRoundsProfile)[baseDrawRound]),finishingRoundNumber=roundsCount+1-roundNumber,isLinkFedRound=linkFedFinishingRoundNumbers.includes(finishingRoundNumber)||linkFedRoundNumbers.includes(roundNumber);for(const roundIteration of iterationRange){const iterationDrawPosition=!isLinkFedRound&&drawPosition||void 0;({roundNodes,matchUps,drawPosition}=buildFeedRound({drawPosition:iterationDrawPosition,nodes:roundNodes,roundIteration,matchUpType,roundNumber,idPrefix,matchUps,isMock,uuids,fed})),roundNumber++,fed+=1}}nodes=roundNodes}roundsCount!==roundNumber-1&&console.log("ERROR");matchUps=addFinishingRounds({finishingPositionOffset:isConsolation?baseDrawSize-positionsFed:finishingPositionOffset,positionsFed,roundsCount,matchUps,fmlc});const draw=(null==roundNodes?void 0:roundNodes.length)?roundNodes[0]:roundNodes;return draw&&(draw.roundNumber=roundNumber-1,draw.matchUps=matchUps),{draw,matchUps,roundsCount}}function treeMatchUps({finishingPositionOffset,finishingPositionLimit,qualifyingRoundNumber,qualifyingPositions,matchUpType,roundLimit,idPrefix,drawSize,isMock,uuids}){if(isNaN(drawSize)||drawSize<2||qualifyingPositions&&drawSize<=qualifyingPositions)return{matchUps:[],roundsCount:0};if(qualifyingPositions&&(!isPowerOf2(drawSize)||drawSize%qualifyingPositions)){let requiredDrawSize=qualifyingPositions;for(;requiredDrawSize<drawSize;)requiredDrawSize*=2;drawSize=requiredDrawSize}const isValidQualifying=!(drawSize%2||isNaN(qualifyingPositions)&&isNaN(qualifyingRoundNumber)||drawSize/qualifyingPositions!==Math.round(drawSize/qualifyingPositions)&&drawSize/qualifyingRoundNumber!==Math.round(drawSize/qualifyingRoundNumber));if(!isPowerOf2(drawSize)&&!isValidQualifying)return{matchUps:[],roundsCount:0};const nodes=generateRange(1,parseInt(drawSize)+1).map((drawPosition=>({drawPosition})));let roundNodes,matchUps=[],roundNumber=1;for(({roundNodes,matchUps}=buildRound({matchUpType,roundNumber,idPrefix,matchUps,isMock,nodes,uuids})),roundNumber++,roundLimit=roundLimit||qualifyingRoundNumber||(qualifyingPositions>1?drawSize/2/qualifyingPositions:void 0);roundNodes.length>1;)qualifyingPositions&&roundNodes.length===qualifyingPositions&&(roundLimit=roundNumber-1),({roundNodes,matchUps}=buildRound({nodes:roundNodes,matchUpType,roundNumber,idPrefix,matchUps,isMock,uuids})),roundNumber++;const roundsCount=roundNumber-1;return matchUps=addFinishingRounds({finishingPositionOffset,finishingPositionLimit,roundsCount,roundLimit,matchUps}),roundLimit?matchUps=matchUps.filter((matchUp=>matchUp.roundNumber<=roundLimit)):roundLimit=roundNumber-1,{drawSize,matchUps,roundsCount,roundLimit}}var __defProp$42=Object.defineProperty,__getOwnPropSymbols$43=Object.getOwnPropertySymbols,__hasOwnProp$43=Object.prototype.hasOwnProperty,__propIsEnum$43=Object.prototype.propertyIsEnumerable,__defNormalProp$42=(obj,key,value)=>key in obj?__defProp$42(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$42=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$43.call(b,prop)&&__defNormalProp$42(a,prop,b[prop]);if(__getOwnPropSymbols$43)for(var prop of __getOwnPropSymbols$43(b))__propIsEnum$43.call(b,prop)&&__defNormalProp$42(a,prop,b[prop]);return a};function generatePlayoffStructures({finishingPositionOffset=0,addNameBaseToAttributeName,playoffStructureNameBase,finishingPositionNaming,finishingPositionLimit,playoffAttributes,stageSequence=1,exitProfile="0",exitProfileLimit,roundOffsetLimit,roundOffset=0,drawDefinition,staggeredEntry,sequenceLimit,stage=MAIN,structureId,matchUpType,idPrefix,drawSize,isMock,uuids}){if(!(!playoffAttributes||!exitProfileLimit||(null==playoffAttributes?void 0:playoffAttributes[exitProfile]))||drawSize<2||sequenceLimit&&stageSequence>sequenceLimit)return{};const allMatchUps=[],structures=[],links=[];matchUpType=matchUpType||(null==drawDefinition?void 0:drawDefinition.matchUpType);const finishingPositionsFrom=finishingPositionOffset+1,finishingPositionRange=`${finishingPositionsFrom}-${finishingPositionOffset+drawSize}`,attributeProfile=null==playoffAttributes?void 0:playoffAttributes[exitProfile],base=playoffStructureNameBase&&`${playoffStructureNameBase} `||"",customNaming=null==finishingPositionNaming?void 0:finishingPositionNaming[finishingPositionRange],structureName=(null==customNaming?void 0:customNaming.name)||(null==attributeProfile?void 0:attributeProfile.name)&&(addNameBaseToAttributeName?`${base}${null==attributeProfile?void 0:attributeProfile.name}`:attributeProfile.name)||`${base}${finishingPositionRange}`,structureAbbreviation=(null==customNaming?void 0:customNaming.abbreviation)||(null==attributeProfile?void 0:attributeProfile.abbreviation),mainParams={idPrefix:idPrefix&&`${idPrefix}-${structureName}-RP`,finishingPositionOffset,matchUpType,drawSize,isMock,uuids},{matchUps}=staggeredEntry?feedInMatchUps(mainParams):treeMatchUps(mainParams),structure=structureTemplate({structureId:structureId||(null==uuids?void 0:uuids.pop()),structureAbbreviation,stageSequence,structureName,matchUpType,roundOffset,matchUps,stage});allMatchUps.push(...matchUps),structures.push(structure);const rounds=Math.ceil(Math.log(drawSize)/Math.log(2)),roundsToPlayOff=roundOffsetLimit?Math.min(roundOffsetLimit-roundOffset,rounds):!finishingPositionLimit||finishingPositionsFrom<finishingPositionLimit?rounds:0;return drawSize>2&&generateRange(1,roundsToPlayOff+1).forEach((roundNumber=>function generateChildStructures(roundNumber){const playoffDrawPositions=drawSize/Math.pow(2,roundNumber);if(playoffDrawPositions<2)return;const childFinishingPositionOffset=drawSize/Math.pow(2,roundNumber)+finishingPositionOffset;if(childFinishingPositionOffset+1>finishingPositionLimit)return;const{structures:childStructures,structureId:targetStructureId,matchUps:childMatchUps,links:childLinks}=generatePlayoffStructures({finishingPositionOffset:childFinishingPositionOffset,exitProfile:`${exitProfile}-${roundNumber}`,roundOffset:roundOffset+roundNumber,stageSequence:stageSequence+1,drawSize:playoffDrawPositions,addNameBaseToAttributeName,playoffStructureNameBase,finishingPositionNaming,finishingPositionLimit,playoffAttributes,exitProfileLimit,roundOffsetLimit,drawDefinition,sequenceLimit,matchUpType,idPrefix,uuids,stage}),link={linkType:LOSER,source:{roundNumber,structureId:null==structure?void 0:structure.structureId},target:{roundNumber:1,feedProfile:TOP_DOWN,structureId:targetStructureId}};structure&&targetStructureId&&childLinks.push(link);(null==childLinks?void 0:childLinks.length)&&links.push(...childLinks);(null==childStructures?void 0:childStructures.length)&&structures.push(...childStructures);(null==childMatchUps?void 0:childMatchUps.length)&&allMatchUps.push(...childMatchUps);return{structureId:targetStructureId,childLinks,structures}}(roundNumber))),__spreadValues$42({structureId:structure.structureId,matchUps:allMatchUps,structureName,structures,links},SUCCESS)}function feedInLinks({consolationStructure,roundOffset=0,mainStructure,roundsCount,feedPolicy,fmlc}){const roundsFed=consolationStructure.matchUps.reduce(((p,matchUp)=>(matchUp.drawPositions||[]).filter(Boolean).length&&!p.includes(matchUp.roundNumber)?p.concat(matchUp.roundNumber):p),[]),roundGroupedOrder=(null==feedPolicy?void 0:feedPolicy.roundGroupedOrder)||[],roundFeedProfiles=null==feedPolicy?void 0:feedPolicy.roundFeedProfiles;return generateRange(1+roundOffset,roundsCount+1+roundOffset).map((roundNumber=>{const feedProfile=roundFeedProfiles&&roundFeedProfiles[roundNumber-1]?roundFeedProfiles[roundNumber-1]:roundNumber%2?TOP_DOWN:BOTTOM_UP,targetRound=roundNumber-roundOffset<=2?roundNumber-roundOffset:2*(roundNumber-roundOffset-2)+2,link={linkType:LOSER,source:{roundNumber,structureId:mainStructure.structureId},target:{feedProfile,roundNumber:targetRound,structureId:consolationStructure.structureId}},groupedOrder=roundGroupedOrder[roundNumber-1];return groupedOrder&&(link.target.groupedOrder=groupedOrder),getDevContext()&&(link.source.structureName=mainStructure.structureName,link.target.structureName=consolationStructure.structureName),2===roundNumber&&fmlc&&(link.linkCondition=FIRST_MATCHUP,link.target.feedProfile=TOP_DOWN),roundsFed.includes(targetRound)?link:void 0})).filter(Boolean)}var __defProp$41=Object.defineProperty,__defProps$2l=Object.defineProperties,__getOwnPropDescs$2l=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$42=Object.getOwnPropertySymbols,__hasOwnProp$42=Object.prototype.hasOwnProperty,__propIsEnum$42=Object.prototype.propertyIsEnumerable,__defNormalProp$41=(obj,key,value)=>key in obj?__defProp$41(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$41=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$42.call(b,prop)&&__defNormalProp$41(a,prop,b[prop]);if(__getOwnPropSymbols$42)for(var prop of __getOwnPropSymbols$42(b))__propIsEnum$42.call(b,prop)&&__defNormalProp$41(a,prop,b[prop]);return a},__spreadProps$2l=(a,b)=>__defProps$2l(a,__getOwnPropDescs$2l(b));function feedInChampionship(params={}){const{finishingPositionOffset,policyDefinitions,stageSequence=1,feedsFromFinal,staggeredEntry,structureName,structureId,matchUpType,skipRounds,feedRounds,idPrefix,drawSize,isMock,uuids,fmlc}=params,feedPolicy=params.feedPolicy||(null==policyDefinitions?void 0:policyDefinitions[POLICY_TYPE_FEED_IN]),mainParams={finishingPositionOffset,matchUpType,skipRounds,drawSize,idPrefix,isMock,uuids},{matchUps}=staggeredEntry?feedInMatchUps(mainParams):treeMatchUps(mainParams),mainStructure=structureTemplate({structureId:structureId||(null==uuids?void 0:uuids.pop()),structureName:structureName||MAIN,stageSequence,stage:MAIN,matchUpType,matchUps}),structures=[mainStructure],links=[],baseDrawSize=drawSize/2,{matchUps:consolationMatchUps,roundsCount}=feedInMatchUps({finishingPositionOffset:baseDrawSize,idPrefix:idPrefix&&`${idPrefix}-c`,isConsolation:!0,feedsFromFinal,baseDrawSize,matchUpType,feedRounds,skipRounds,isMock,uuids,fmlc});if(drawSize>2){const consolationStructure=structureTemplate({matchUps:consolationMatchUps,structureId:null==uuids?void 0:uuids.pop(),structureName:CONSOLATION,stage:CONSOLATION,stageSequence:1,matchUpType});structures.push(consolationStructure);const feedLinks=feedInLinks({consolationStructure,mainStructure,roundsCount,feedPolicy,fmlc});links.push(...feedLinks)}return __spreadProps$2l(__spreadValues$41({},SUCCESS),{structures,links})}function processPlayoffGroups({compassAttributes=COMPASS_ATTRIBUTES,olympicAttributes=OLYMPIC_ATTRIBUTES,playoffMatchUpFormat,sourceStructureId,policyDefinitions,stageSequence,playoffGroups,matchUpType,feedPolicy,groupCount,groupSize,idPrefix,isMock,uuids}){var _a,_b;feedPolicy=feedPolicy||(null==policyDefinitions?void 0:policyDefinitions[POLICY_TYPE_FEED_IN]);let finishingPositionOffset=0;const finishingPositionTargets=[],structures=[],links=[];for(const playoffGroup of playoffGroups){const validFinishingPositions=generateRange(1,groupSize+1),finishingPositions=playoffGroup.finishingPositions;if(!finishingPositions.reduce(((p,finishingPosition)=>validFinishingPositions.includes(finishingPosition)&&p),!0))return;const playoffDrawType=playoffGroup.drawType||SINGLE_ELIMINATION,participantsInDraw=groupCount*finishingPositions.length,drawSize=nextPowerOf2(participantsInDraw);if(playoffDrawType===SINGLE_ELIMINATION){const{matchUps}=treeMatchUps({idPrefix:idPrefix&&`${idPrefix}-po`,finishingPositionLimit:finishingPositionOffset+participantsInDraw,finishingPositionOffset,matchUpType,drawSize}),playoffStructure=structureTemplate({structureName:playoffGroup.structureName,matchUpFormat:playoffMatchUpFormat,structureId:null==uuids?void 0:uuids.pop(),stage:PLAY_OFF,stageSequence,matchUpType,matchUps});structures.push(playoffStructure);const playoffLink=generatePlayoffLink({playoffStructureId:playoffStructure.structureId,finishingPositions,sourceStructureId});links.push(playoffLink),finishingPositionOffset+=participantsInDraw,finishingPositionTargets.push({structureId:playoffStructure.structureId,finishingPositions})}else if([COMPASS,OLYMPIC,PLAY_OFF].includes(playoffDrawType)){const{structureName}=playoffGroup,params={playoffStructureNameBase:structureName,addNameBaseToAttributeName:!0,finishingPositionOffset,stage:PLAY_OFF,roundOffset:0,stageSequence,drawSize,idPrefix,isMock,uuids};playoffDrawType===COMPASS?Object.assign(params,{roundOffsetLimit:3,playoffAttributes:compassAttributes}):playoffDrawType===OLYMPIC&&Object.assign(params,{roundOffsetLimit:2,playoffAttributes:olympicAttributes});const result=generatePlayoffStructures(params);if(result.error)return result;if((null==(_a=result.links)?void 0:_a.length)&&links.push(...result.links),(null==(_b=result.structures)?void 0:_b.length)&&structures.push(...result.structures),structures.sort(structureSort),result.structureId){const playoffLink=generatePlayoffLink({playoffStructureId:result.structureId,finishingPositions,sourceStructureId});links.push(playoffLink),finishingPositionTargets.push({structureId:result.structureId,finishingPositions})}finishingPositionOffset+=participantsInDraw}else if(playoffDrawType===FIRST_MATCH_LOSER_CONSOLATION){console.log("RRw/PO FIRST_MATCH_LOSER_CONSOLATION");const uuidsFMLC=[null==uuids?void 0:uuids.pop(),null==uuids?void 0:uuids.pop()],{structures:champitionShipStructures,links:feedInLinks}=feedInChampionship({structureName:playoffGroup.structureName,idPrefix:idPrefix&&`${idPrefix}-po`,finishingPositionOffset,uuids:uuidsFMLC,stage:PLAY_OFF,feedRounds:1,matchUpType,feedPolicy,fmlc:!0,drawSize}),[playoffStructure]=structures,playoffLink=generatePlayoffLink({playoffStructureId:playoffStructure.structureId,finishingPositions,sourceStructureId});links.push(playoffLink),links.push(...feedInLinks),structures.push(...champitionShipStructures),finishingPositionTargets.push({structureId:playoffStructure.structureId,finishingPositions}),finishingPositionOffset+=participantsInDraw}}return{finishingPositionTargets,structures,links}}function generatePlayoffLink({playoffStructureId,finishingPositions,sourceStructureId}){return{linkType:POSITION,source:{structureId:sourceStructureId,finishingPositions},target:{structureId:playoffStructureId,feedProfile:DRAW,roundNumber:1}}}function getRoundRobinGroupMatchUps({drawPositions}){const groupMatchUps=[].concat(...drawPositions.map((position=>drawPositions.filter((p=>p!==position)).map((o=>[position,o]))))),uniqueMatchUpGroupings=unique(groupMatchUps.map(drawPositionsHash)).map((h=>h.split("|").map((p=>+p))));return{groupMatchUps,uniqueMatchUpGroupings}}function drawPositionsHash(drawPositions){return drawPositions.sort(numericSort).join("|")}var __defProp$40=Object.defineProperty,__defProps$2k=Object.defineProperties,__getOwnPropDescs$2k=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$41=Object.getOwnPropertySymbols,__hasOwnProp$41=Object.prototype.hasOwnProperty,__propIsEnum$41=Object.prototype.propertyIsEnumerable,__defNormalProp$40=(obj,key,value)=>key in obj?__defProp$40(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$40=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$41.call(b,prop)&&__defNormalProp$40(a,prop,b[prop]);if(__getOwnPropSymbols$41)for(var prop of __getOwnPropSymbols$41(b))__propIsEnum$41.call(b,prop)&&__defNormalProp$40(a,prop,b[prop]);return a},__spreadProps$2k=(a,b)=>__defProps$2k(a,__getOwnPropDescs$2k(b));function generateRoundRobin({structureName=MAIN,stageSequence=1,structureOptions,appliedPolicies,seedingProfile,stage=MAIN,matchUpType,roundTarget,structureId,drawSize,idPrefix,isMock,uuids}){const{groupCount,groupSize}=function deriveGroups({appliedPolicies,structureOptions,drawSize}){let groupSize=null==structureOptions?void 0:structureOptions.groupSize;const groupSizeLimit=(null==structureOptions?void 0:structureOptions.groupSizeLimit)||8,{validGroupSizes}=getValidGroupSizes({groupSizeLimit,drawSize}),maxValidGroupSize=Math.max(...validGroupSizes),validGroupSize=groupSize&&validGroupSizes.includes(groupSize);validGroupSize||(groupSize=groupSize&&groupSize>4||!validGroupSizes.includes(4)?maxValidGroupSize:4);const groupCount=Math.ceil(drawSize/groupSize);return{groupSize,groupCount}}({structureOptions,appliedPolicies,drawSize}),finishingPosition=WIN_RATIO;let maxRoundNumber;const structures=generateRange(1,groupCount+1).map((structureOrder=>{const matchUps=function roundRobinMatchUps({structureOrder,matchUpType,groupSize,idPrefix,drawSize,isMock,uuids}){const drawPositionOffset=(structureOrder-1)*groupSize,drawPositions=generateRange(1+drawPositionOffset,groupSize+1+drawPositionOffset),{uniqueMatchUpGroupings}=getRoundRobinGroupMatchUps({drawPositions}),rounds=function groupRounds({groupSize,drawPositionOffset}){const numArr=count=>[...Array(count)].map(((_,i)=>i)),groupPositions=numArr(2*Math.round(groupSize/2)+1).slice(1),rounds=numArr(groupPositions.length-1).map((()=>[]));let aRow=groupPositions.slice(0,groupPositions.length/2),bRow=groupPositions.slice(groupPositions.length/2);groupPositions.slice(1).forEach(((p,i)=>{aRow.forEach(((a,j)=>{rounds[i].push([aRow[j],bRow[j]])}));const aHead2=aRow.shift(),aDown2=aRow.pop(),bUp2=bRow.shift();aRow=[].concat(aHead2,bUp2,...aRow),bRow=[].concat(...bRow,aDown2)}));const aHead=aRow.shift(),aDown=aRow.pop(),bUp=bRow.shift();aRow=[].concat(aHead,bUp,...aRow),bRow=[].concat(...bRow,aDown);const sum=x=>x[0].reduce(((a,b)=>a+b));return rounds.reverse().sort(((a,b)=>sum(a)-sum(b))).map((round=>round.filter((groupPositions2=>groupPositions2.every((position=>position<=groupSize)))).map((groupPositions2=>drawPositionsHash(groupPositions2.map((groupPosition=>groupPosition+drawPositionOffset)))))))}({groupSize,drawPositionOffset}),matchUps=uniqueMatchUpGroupings.map(positionMatchUp).sort(((a,b)=>(a.roundNumber||1/0)-(b.roundNumber||1/0)));return matchUps;function determineRoundNumber(hash){return rounds.reduce(((p,round,i)=>round.includes(hash)?i+1:p),void 0)}function positionMatchUp(drawPositions2){const roundNumber=determineRoundNumber(drawPositionsHash(drawPositions2)),range=[1,drawSize],matchUpId=function roundRobinMatchUpId({structureOrder,drawPositions,roundNumber,idPrefix,uuids}){return idPrefix?`${idPrefix}-${structureOrder}-${roundNumber}-DP-${drawPositions.join("-")}`:(null==uuids?void 0:uuids.pop())||UUID()}({structureOrder,drawPositions:drawPositions2,roundNumber,idPrefix,uuids}),matchUp={matchUpStatus:roundNumber?TO_BE_PLAYED:BYE,matchUpType,finishingPositionRange:{winner:range,loser:range},drawPositions:drawPositions2,roundNumber,matchUpId};return isMock&&(matchUp.isMock=!0),matchUp}}({groupSize,structureOrder,matchUpType,drawSize,idPrefix,isMock});return maxRoundNumber=Math.max(...matchUps.map((({roundNumber})=>roundNumber))),structureTemplate({structureName:`Group ${structureOrder}`,structureId:null==uuids?void 0:uuids.pop(),structureType:ITEM,finishingPosition,structureOrder,matchUpType,matchUps})})),structure=structureTemplate({structureId:structureId||(null==uuids?void 0:uuids.pop()),structureType:CONTAINER,finishingPosition,seedingProfile,structureName,stageSequence,matchUpType,structures,stage});return roundTarget&&addExtension$1({extension:{name:ROUND_TARGET,value:roundTarget},element:structure}),__spreadValues$40({structures:[structure],maxRoundNumber,groupCount,links:[],groupSize},SUCCESS)}function getValidGroupSizes({drawSize,groupSizeLimit=10}){const validGroupSizes=generateRange(3,groupSizeLimit+1).filter((groupSize=>{const groupsCount=Math.ceil(drawSize/groupSize),byesCount=groupsCount*groupSize-drawSize,maxParticipantsPerGroup=Math.ceil(drawSize/groupsCount),maxByesPerGroup=Math.ceil(byesCount/groupsCount);return(!byesCount||byesCount<groupSize)&&maxParticipantsPerGroup===groupSize&&maxParticipantsPerGroup>=3&&maxByesPerGroup<2}));return __spreadProps$2k(__spreadValues$40({},SUCCESS),{validGroupSizes})}var __defProp$3$=Object.defineProperty,__defProps$2j=Object.defineProperties,__getOwnPropDescs$2j=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$40=Object.getOwnPropertySymbols,__hasOwnProp$40=Object.prototype.hasOwnProperty,__propIsEnum$40=Object.prototype.propertyIsEnumerable,__defNormalProp$3$=(obj,key,value)=>key in obj?__defProp$3$(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3$=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$40.call(b,prop)&&__defNormalProp$3$(a,prop,b[prop]);if(__getOwnPropSymbols$40)for(var prop of __getOwnPropSymbols$40(b))__propIsEnum$40.call(b,prop)&&__defNormalProp$3$(a,prop,b[prop]);return a},__spreadProps$2j=(a,b)=>__defProps$2j(a,__getOwnPropDescs$2j(b));function getSeedBlocks({roundRobinGroupsCount,participantsCount,cluster}){if(!isConvertableInteger(participantsCount))return decorateResult({result:{error:INVALID_VALUES},context:{participantsCount},stack:"getSeedBlocks"});const drawSize=nextPowerOf2(participantsCount);if(roundRobinGroupsCount){const increment=Math.min(roundRobinGroupsCount,drawSize),seedBlocks2=[];let position=1;for(generateRange(0,increment).forEach((()=>{seedBlocks2.push([position]),position++}));position<drawSize;){const range2=generateRange(position,position+increment);position+=increment,seedBlocks2.push(range2)}return __spreadProps$2j(__spreadValues$3$({},SUCCESS),{seedBlocks:seedBlocks2})}const range=generateRange(1,drawSize+1);let positions=[],chunkSize=drawSize/2;for(;chunkSize>1;){const chunks=chunkArray(range,chunkSize),chunksCount=chunks.length;chunks.forEach(((chunk,i)=>{let candidate;const top=i<chunksCount/2,isEven=i%2==0,first=chunk[0],last=chunk[chunk.length-1];candidate=cluster&&chunksCount>4?8===chunksCount?top?last:first:isEven?first:last:top?first:last,overlap(chunk,positions)||positions.push(candidate)})),chunkSize/=2}const remainingPositions=range.filter((position=>!positions.includes(position)));for(;remainingPositions.length;)remainingPositions.length%2==0?positions.push(remainingPositions.pop()):positions.push(remainingPositions.shift());const seedBlockSizes=generateRange(0,20).map((x=>Math.pow(2,x)));seedBlockSizes.unshift(1);const iterations=seedBlockSizes.indexOf(drawSize);let sum=0;const seedBlocks=[];return generateRange(0,iterations).forEach((i=>{seedBlocks.push(positions.slice(sum,sum+seedBlockSizes[i])),sum+=seedBlockSizes[i]})),__spreadProps$2j(__spreadValues$3$({},SUCCESS),{seedBlocks})}function getSeedGroups({drawSize,roundRobinGroupsCount}){if(!isConvertableInteger(drawSize))return decorateResult({result:{error:INVALID_VALUES},context:{drawSize},stack:"getSeedGroups"});if(roundRobinGroupsCount){if(!isConvertableInteger(roundRobinGroupsCount))return decorateResult({result:{error:INVALID_VALUES},context:{roundRobinGroupsCount},stack:"getSeedGroups"});let seedNumber=1;return{seedGroups:generateRange(0,Math.floor(drawSize/roundRobinGroupsCount)).map((()=>{const seedNumbers=generateRange(seedNumber,seedNumber+roundRobinGroupsCount);return seedNumber+=roundRobinGroupsCount,seedNumbers}))}}{const{seedBlocks}=getSeedBlocks({participantsCount:drawSize,roundRobinGroupsCount});let seedNumber=0;return{seedGroups:(seedBlocks||[]).map((seedBlock=>(seedBlock||[]).map((()=>(seedNumber+=1,seedNumber)))))}}}function getValidSeedBlocks({provisionalPositioning,appliedPolicies,drawDefinition,allPositions,structure}){var _a;let validSeedBlocks=[];if(!structure)return{error:MISSING_STRUCTURE};const{roundMatchUps}=getAllStructureMatchUps({matchUpFilters:{roundNumbers:[1]},provisionalPositioning,structure}),{seedAssignments}=getStructureSeedAssignments({provisionalPositioning,drawDefinition,structure}),{positionAssignments}=structureAssignedDrawPositions({structure}),positionsCount=positionAssignments.length,seedsCount=(null==seedAssignments?void 0:seedAssignments.length)||0;let allDrawPositions=[];const uniqueDrawPositionsByRound=Object.keys(roundMatchUps).sort(((a,b)=>a-b)).map((roundNumber=>{const roundDrawPositions=roundMatchUps[roundNumber].map((matchUp=>matchUp.drawPositions)).flat(1/0).filter(Boolean),uniqueRoundDrawPositions=roundDrawPositions.filter((drawPosition=>!allDrawPositions.includes(drawPosition)));return allDrawPositions=allDrawPositions.concat(...roundDrawPositions),uniqueRoundDrawPositions})).filter((f=>f.length)).reverse(),firstRoundDrawPositions=uniqueDrawPositionsByRound.pop(),firstRoundDrawPositionOffset=firstRoundDrawPositions&&Math.min(...firstRoundDrawPositions)-1||0,seedingProfile=null==(_a=null==appliedPolicies?void 0:appliedPolicies.seeding)?void 0:_a.seedingProfile,baseDrawSize=(null==firstRoundDrawPositions?void 0:firstRoundDrawPositions.length)||0,seedRangeDrawPositionBlocks=uniqueDrawPositionsByRound.filter((block=>block.filter((drawPosition=>drawPosition<=seedsCount)).length)),{stage,structureType,roundLimit}=structure,isContainer=structureType===CONTAINER,isFeedIn=!isContainer&&(null==uniqueDrawPositionsByRound?void 0:uniqueDrawPositionsByRound.length),isLucky=(null==firstRoundDrawPositions?void 0:firstRoundDrawPositions.length)&&!isPowerOf2(baseDrawSize),qualifyingBlocks=!isContainer&&stage===QUALIFYING&&roundLimit,fedSeedBlockPositions=seedRangeDrawPositionBlocks.flat(1/0),fedSeedNumberOffset=isFeedIn?null==fedSeedBlockPositions?void 0:fedSeedBlockPositions.length:0,countLimit=allPositions?positionsCount:seedsCount,firstRoundSeedsCount=!isFeedIn&&countLimit||fedSeedBlockPositions.length<countLimit&&countLimit-fedSeedBlockPositions.length||0;if(qualifyingBlocks){const seedingBlocksCount=structure.matchUps.filter((({roundNumber})=>roundNumber===structure.roundLimit)).length,chunkSize=firstRoundDrawPositions.length/seedingBlocksCount;if(isFeedIn);else{const positioning=getSeedPattern(seedingProfile),drawPositionChunks=chunkArray(firstRoundDrawPositions,chunkSize);let groupNumber=1;const seedGroups=generateRange(0,drawPositionChunks[0].length).map((()=>{const seedNumbers=generateRange(groupNumber,groupNumber+drawPositionChunks.length);return groupNumber+=drawPositionChunks.length,seedNumbers}));({validSeedBlocks}=getSeedBlockPattern({drawPositionBlocks:drawPositionChunks,positioning,seedGroups}))}}else if(isContainer){const result=function getContainerBlocks({seedingProfile,structure}){var _a;const containedStructures=structure.structures||[],roundRobinGroupsCount=containedStructures.length,positionAssignments=null==(_a=getPositionAssignments$1({structure}))?void 0:_a.positionAssignments,positioning=getSeedPattern(seedingProfile),{seedGroups}=getSeedGroups({drawSize:positionAssignments.length,roundRobinGroupsCount});return getSeedBlockPattern({drawPositionBlocks:containedStructures.map((containedStructure=>getPositionAssignments$1({structure:containedStructure}).positionAssignments.map((assignment=>assignment.drawPosition)))),positioning,seedGroups})}({seedingProfile,structure});if(!result||result.error)return console.log(result),result;({validSeedBlocks}=result)}else if(isFeedIn)validSeedBlocks=seedRangeDrawPositionBlocks.map((block=>({seedNumbers:block,drawPositions:block})));else if(isLucky){chunkArray(firstRoundDrawPositions,2).map(((block,i)=>({drawPositions:[block[0]],seedNumbers:[i+1]}))).forEach((block=>validSeedBlocks.push(block)))}if(!isContainer&&!isLucky&&!qualifyingBlocks){const{blocks,error}=function constructPower2Blocks({roundRobinGroupsCount,drawPositionOffset=0,seedNumberOffset=0,seedingProfile,seedCountGoal,baseDrawSize}){let count=1;const blocks=[],{seedBlocks}=getSeedBlocks({cluster:getSeedPattern(seedingProfile)===CLUSTER,participantsCount:baseDrawSize,roundRobinGroupsCount});count=0;for(const seedBlock of seedBlocks){if(count+1>seedCountGoal)break;const drawPositions=seedBlock.map((drawPosition=>drawPosition+drawPositionOffset)),seedNumbers=getSeeds(count+1,seedBlock.length).map((seedNumber=>+seedNumber+seedNumberOffset));count+=seedBlock.length,blocks.push({drawPositions,seedNumbers})}return{blocks};function getSeeds(s,n){return Array.from(new Array(n),((val,i)=>i+s))}}({drawPositionOffset:firstRoundDrawPositionOffset,seedNumberOffset:fedSeedNumberOffset,seedCountGoal:firstRoundSeedsCount,seedingProfile,baseDrawSize});if(error)return{validSeedBlocks:[],isContainer,isFeedIn,error};blocks.forEach((block=>validSeedBlocks.push(block)))}const validSeedPositions=[].concat(...validSeedBlocks.map((seedBlock=>seedBlock.drawPositions))).reduce(((result,drawPosition)=>(null==firstRoundDrawPositions?void 0:firstRoundDrawPositions.includes(drawPosition))&&result),!0);return isLucky||isFeedIn||isContainer||validSeedPositions?{validSeedBlocks,isContainer,isFeedIn,isLucky}:{error:INVALID_SEED_POSITION,validSeedBlocks:[],isContainer,isFeedIn}}function getSeedBlockPattern({positioning,seedGroups,drawPositionBlocks}){const validSeedBlocks=[],topDown=(a,b)=>a-b,bottomUp=(a,b)=>b-a,assignedPositions=[];return seedGroups.forEach(((seedGroup,i)=>{i&&positioning!==WATERFALL&&shuffleArray(seedGroup),seedGroup.forEach(((seedNumber,j)=>{const blockIndex=i%2?drawPositionBlocks.length-j-1:j,drawPosition=drawPositionBlocks[blockIndex].sort(i%2?bottomUp:topDown).find((drawPosition2=>!assignedPositions.includes(drawPosition2)));assignedPositions.push(drawPosition),validSeedBlocks.push({seedNumbers:[seedNumber],drawPositions:[drawPosition]})}))})),{validSeedBlocks}}function isValidSeedPosition({drawDefinition,seedBlockInfo,drawPosition,structureId,seedNumber}){var _a,_b,_c,_d,_e;const{structure}=findStructure({drawDefinition,structureId}),{appliedPolicies}=getAppliedPolicies({drawDefinition});let validSeedBlocks=null==seedBlockInfo?void 0:seedBlockInfo.validSeedBlocks;if(validSeedBlocks||(validSeedBlocks=null==(_a=getValidSeedBlocks({appliedPolicies,drawDefinition,structure}))?void 0:_a.validSeedBlocks),null==(_c=null==(_b=null==appliedPolicies?void 0:appliedPolicies.seeding)?void 0:_b.validSeedPositions)?void 0:_c.ignore)return!0;if(null==(_e=null==(_d=null==appliedPolicies?void 0:appliedPolicies.seeding)?void 0:_d.validSeedPositions)?void 0:_e.strict){const targetSeedBlock=validSeedBlocks.find((seedBlock=>seedBlock.seedNumbers.includes(seedNumber)));return((null==targetSeedBlock?void 0:targetSeedBlock.drawPositions)||[]).includes(drawPosition)}return[].concat(...validSeedBlocks.map((seedBlock=>seedBlock.drawPositions))).includes(drawPosition)}function getNextSeedBlock({provisionalPositioning,drawDefinition,seedBlockInfo,structureId,randomize}){var _a,_b;const{structure}=findStructure({drawDefinition,structureId}),{seedAssignments}=getStructureSeedAssignments({provisionalPositioning,drawDefinition,structure}),{positionAssignments}=structureAssignedDrawPositions({structure}),assignedDrawPositions=positionAssignments.filter((assignment=>assignment.participantId||assignment.bye||assignment.qualifier)).map((assignment=>assignment.drawPosition)).filter(Boolean),{appliedPolicies}=getAppliedPolicies({drawDefinition}),nextSeedBlock=((null==seedBlockInfo?void 0:seedBlockInfo.validSeedBlocks)||(null==(_a=getValidSeedBlocks({provisionalPositioning,appliedPolicies,drawDefinition,structure}))?void 0:_a.validSeedBlocks)||[]).filter((seedBlock=>seedBlock.drawPositions.filter((drawPosition=>!assignedDrawPositions.includes(drawPosition))).length))[0],assignedSeedParticipantIds=seedAssignments.map((assignment=>assignment.participantId)).filter(Boolean),assignedPositionParticipantIds=positionAssignments.map((assignment=>assignment.participantId)).filter(Boolean),placedSeedParticipantIds=assignedSeedParticipantIds.filter((participantId=>assignedPositionParticipantIds.includes(participantId))),unplacedSeedIds=assignedSeedParticipantIds.filter((participantId=>!assignedPositionParticipantIds.includes(participantId))),unplacedSeedAssignments=seedAssignments.filter((assignment=>unplacedSeedIds.includes(assignment.participantId))),seedsWithoutDrawPositions=seedAssignments.filter((assignment=>!assignment.participantId)),unfilled=(unplacedSeedAssignments.length||seedsWithoutDrawPositions.length)&&(null==nextSeedBlock?void 0:nextSeedBlock.drawPositions.filter((drawPosition=>!assignedDrawPositions.includes(drawPosition))))||[],unfilledPositions=randomize?shuffleArray(unfilled):unfilled,selectedParticipantIds=[],randomlySelectedUnplacedSeedValueIds=unfilledPositions.map((()=>{const assignment=function randomlySelectLowestSeedValue(assignments,selectedParticipantIds2){const filteredAssignments=assignments.filter((assignment=>!selectedParticipantIds2.includes(assignment.participantId))),lowestSeedValue=Math.min(...filteredAssignments.map((assignment=>getNumericSeedValue(assignment.seedValue)))),assignmentsWithLowestSeedValue=filteredAssignments.filter((assignment=>getNumericSeedValue(assignment.seedValue)===lowestSeedValue));return shuffleArray(assignmentsWithLowestSeedValue).pop()}(unplacedSeedAssignments,selectedParticipantIds),participantId=null==assignment?void 0:assignment.participantId;return participantId&&selectedParticipantIds.push(participantId),participantId})).filter(Boolean),placedSeedNumbers=seedAssignments.filter((assignment=>placedSeedParticipantIds.includes(assignment.participantId))).map((assignment=>assignment.seedNumber)),unplacedSeedNumbers=((null==nextSeedBlock?void 0:nextSeedBlock.seedNumbers)||[]).filter((seedNumber=>!placedSeedNumbers.includes(seedNumber))),unplacedSeedNumberIds=seedAssignments.filter((assignment=>unplacedSeedNumbers.includes(assignment.seedNumber))).map((assignment=>assignment.participantId)),duplicateSeedNumbers=null==(_b=null==appliedPolicies?void 0:appliedPolicies.seeding)?void 0:_b.duplicateSeedNumbers;return{nextSeedBlock,unplacedSeedParticipantIds:void 0===duplicateSeedNumbers||duplicateSeedNumbers?randomlySelectedUnplacedSeedValueIds:unplacedSeedNumberIds,unplacedSeedNumbers,unfilledPositions,unplacedSeedAssignments}}function getSeedPattern(seedingProfile){return"string"==typeof seedingProfile?seedingProfile:"object"==typeof seedingProfile?seedingProfile.positioning:void 0}function participantInEntries({participantId,drawDefinition,entryStatus,entryStage}){var _a;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const inEntries=null==(_a=drawDefinition.entries)?void 0:_a.find((entry=>!(entry.participantId!==participantId||entryStatus&&entryStatus!==entry.entryStatus||entryStage&&entryStage!==entry.entryStage)));return participantId&&inEntries}var __defProp$3_=Object.defineProperty,__getOwnPropSymbols$3$=Object.getOwnPropertySymbols,__hasOwnProp$3$=Object.prototype.hasOwnProperty,__propIsEnum$3$=Object.prototype.propertyIsEnumerable,__defNormalProp$3_=(obj,key,value)=>key in obj?__defProp$3_(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3_=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3$.call(b,prop)&&__defNormalProp$3_(a,prop,b[prop]);if(__getOwnPropSymbols$3$)for(var prop of __getOwnPropSymbols$3$(b))__propIsEnum$3$.call(b,prop)&&__defNormalProp$3_(a,prop,b[prop]);return a};function assignSeed({provisionalPositioning,tournamentRecord,drawDefinition,seedingProfile,participantId,seedBlockInfo,structureId,seedNumber,seedValue,eventId,event}){var _a,_b;const stack="assignSeed",{structure}=findStructure({drawDefinition,structureId}),{positionAssignments}=structureAssignedDrawPositions({structure}),{seedAssignments}=getStructureSeedAssignments({provisionalPositioning,drawDefinition,structure}),seedNumbers=seedAssignments.map((assignment=>assignment.seedNumber)),validParticipantId=participantInEntries({drawDefinition,participantId});if(participantId&&!validParticipantId)return decorateResult({result:{error:INVALID_PARTICIPANT_ID},context:{participantId},stack});const flightsCount=null==(_b=null==(_a=getFlightProfile({event}).flightProfile)?void 0:_a.flights)?void 0:_b.length,flighted=flightsCount&&flightsCount>1,relevantAssignment=positionAssignments.find((assignment=>assignment.participantId===participantId)),assignedDrawPosition=null==relevantAssignment?void 0:relevantAssignment.drawPosition;if(assignedDrawPosition){const{appliedPolicies}=getAppliedPolicies({tournamentRecord,drawDefinition,event});if(!isValidSeedPosition({drawPosition:assignedDrawPosition,appliedPolicies,drawDefinition,seedBlockInfo,structureId,seedNumber}))return decorateResult({result:{error:INVALID_DRAW_POSITION_FOR_SEEDING},context:{assignedDrawPosition},info:"invalid seed position",stack})}let success;return seedNumbers.includes(seedNumber)||seedAssignments.push({seedNumber,seedValue}),seedAssignments.forEach((assignment=>{assignment.participantId===participantId&&assignment.seedNumber!==seedNumber&&(assignment.participantId=void 0),assignment.seedNumber===seedNumber&&(assignment.participantId=participantId,(null==seedingProfile?void 0:seedingProfile.groupSeedingThreshold)||flighted||(assignment.seedValue=seedValue||seedNumber),success=!0)})),success?(modifySeedAssignmentsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,structureIds:[structureId],drawDefinition,structure,eventId}),__spreadValues$3_({},SUCCESS)):decorateResult({result:{error:INVALID_SEED_NUMBER},stack})}function getTargetMatchUps({inContextDrawMatchUps,drawDefinition,assignments,matchUpsMap,structure}){var _a,_b,_c;const containedStructures=null==(_a=getContainedStructures({drawDefinition}))?void 0:_a.containedStructures,targetStructureIds=(null==(_b=null==containedStructures?void 0:containedStructures[structure.structureId])?void 0:_b.map((({structureId})=>structureId)))||[];targetStructureIds.push(null==structure?void 0:structure.structureId);const drawPositions=(null==assignments?void 0:assignments.map((({drawPosition})=>drawPosition)))||[],targetMatchUps=(null==inContextDrawMatchUps?void 0:inContextDrawMatchUps.filter((matchUp=>targetStructureIds.includes(matchUp.structureId)&&intersection(matchUp.drawPositions||[],drawPositions).length)))||[],targetMatchUpIds=targetMatchUps.map((({matchUpId})=>matchUpId)),matchUps=(null==(_c=null==matchUpsMap?void 0:matchUpsMap.drawMatchUps)?void 0:_c.filter((matchUp=>targetMatchUpIds.includes(matchUp.matchUpId))))||[];return{drawPositions,matchUps,targetMatchUps}}var __defProp$3Z=Object.defineProperty,__getOwnPropSymbols$3_=Object.getOwnPropertySymbols,__hasOwnProp$3_=Object.prototype.hasOwnProperty,__propIsEnum$3_=Object.prototype.propertyIsEnumerable,__defNormalProp$3Z=(obj,key,value)=>key in obj?__defProp$3Z(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3Z=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3_.call(b,prop)&&__defNormalProp$3Z(a,prop,b[prop]);if(__getOwnPropSymbols$3_)for(var prop of __getOwnPropSymbols$3_(b))__propIsEnum$3_.call(b,prop)&&__defNormalProp$3Z(a,prop,b[prop]);return a};function cleanupLineUps({inContextDrawMatchUps,tournamentRecord,drawDefinition,matchUpsMap,assignments,structure,event}){const{drawPositions,matchUps,targetMatchUps}=getTargetMatchUps({inContextDrawMatchUps,matchUpsMap,assignments,structure});for(const inContextMatchUp of targetMatchUps)inContextMatchUp.matchUpType===TEAM_MATCHUP&&(inContextMatchUp.sides||[]).forEach(((side,sideIndex)=>{var _a;if((null==side?void 0:side.drawPosition)&&(null==drawPositions?void 0:drawPositions.includes(side.drawPosition))){const matchUp=matchUps.find((({matchUpId})=>matchUpId===inContextMatchUp.matchUpId));(null==(_a=matchUp.sides)?void 0:_a[sideIndex])&&(delete matchUp.sides[sideIndex].lineUp,modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,context:"cleanupLineUps",eventId:null==event?void 0:event.eventId,drawDefinition,matchUp}))}}));return __spreadValues$3Z({},SUCCESS)}var __defProp$3Y=Object.defineProperty,__defProps$2i=Object.defineProperties,__getOwnPropDescs$2i=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3Z=Object.getOwnPropertySymbols,__hasOwnProp$3Z=Object.prototype.hasOwnProperty,__propIsEnum$3Z=Object.prototype.propertyIsEnumerable,__defNormalProp$3Y=(obj,key,value)=>key in obj?__defProp$3Y(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3Y=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3Z.call(b,prop)&&__defNormalProp$3Y(a,prop,b[prop]);if(__getOwnPropSymbols$3Z)for(var prop of __getOwnPropSymbols$3Z(b))__propIsEnum$3Z.call(b,prop)&&__defNormalProp$3Y(a,prop,b[prop]);return a},__spreadProps$2i=(a,b)=>__defProps$2i(a,__getOwnPropDescs$2i(b));function assignDrawPosition$1({provisionalPositioning,inContextDrawMatchUps,isQualifierPosition,sourceMatchUpStatus,automaticPlacement,drawPositionIndex,tournamentRecord,drawDefinition,seedingProfile,participantId,seedBlockInfo,drawPosition,matchUpsMap,structureId,event}){var _a;const stack="assignDrawPosition";if(!participantId&&!isQualifierPosition)return decorateResult({result:{error:MISSING_PARTICIPANT_ID},stack});matchUpsMap=matchUpsMap||getMatchUpsMap({drawDefinition}),inContextDrawMatchUps||({matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap}));const result=findStructure({drawDefinition,structureId});if(result.error)return decorateResult({result,stack});const{structure}=result;if(isAdHoc({drawDefinition,structure}))return decorateResult({result:{error:INVALID_MATCHUP},stack});const{seedAssignments}=getStructureSeedAssignments({provisionalPositioning,drawDefinition,structure}),relevantAssignment=seedAssignments.find((assignment=>assignment.participantId===participantId)),participantSeedNumber=null==relevantAssignment?void 0:relevantAssignment.seedNumber,{appliedPolicies}=getAppliedPolicies({tournamentRecord,drawDefinition,structure,event});if(participantSeedNumber){if(!isValidSeedPosition({seedNumber:participantSeedNumber,appliedPolicies,drawDefinition,seedBlockInfo,drawPosition,structureId}))return decorateResult({result:{error:INVALID_DRAW_POSITION_FOR_SEEDING},context:{drawPosition},stack})}const{positionAssignments}=structureAssignedDrawPositions({structure}),positionAssignment=positionAssignments.find((assignment=>assignment.drawPosition===drawPosition));if(!positionAssignment)return decorateResult({result:{error:INVALID_DRAW_POSITION},context:{drawPosition},stack});if(positionAssignments.map(getParticipantId).includes(participantId))return decorateResult({result:{error:EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT},context:{drawPosition},stack});const{containsParticipant,containsBye}=function drawPositionFilled(positionAssignment2){const containsBye2=positionAssignment2.bye,containsQualifier=positionAssignment2.qualifier,containsParticipant2=positionAssignment2.participantId;return{containsBye:containsBye2,containsQualifier,containsParticipant:containsParticipant2,filled:containsBye2||containsQualifier||containsParticipant2}}(positionAssignment);if(containsBye){let result2=clearDrawPosition({inContextDrawMatchUps,tournamentRecord,drawDefinition,drawPosition,structureId,matchUpsMap,event});if(result2.error)return decorateResult({result:result2,stack})}if(containsParticipant&&positionAssignment.participantId!==participantId){const{activeDrawPositions}=getStructureDrawPositionProfiles({drawDefinition,structureId});if(activeDrawPositions.includes(drawPosition))return decorateResult({result:{error:DRAW_POSITION_ACTIVE},stack});cleanupLineUps({assignments:[positionAssignment],inContextDrawMatchUps,tournamentRecord,drawDefinition,matchUpsMap,structure})}if(positionAssignment.participantId=participantId,isQualifierPosition&&(positionAssignment.qualifier=!0),(null==structure?void 0:structure.stageSequence)>1||[CONSOLATION,PLAY_OFF].includes(structure.stage)){const targetStage=structure.stage===QUALIFYING?QUALIFYING:MAIN,assignment=(drawDefinition.structures.find((structure2=>structure2.stage===targetStage&&1===structure2.stageSequence)).seedAssignments||[]).find((assignment2=>assignment2.participantId===participantId));assignment&&assignSeed(__spreadProps$2i(__spreadValues$3Y({eventId:null==event?void 0:event.eventId,provisionalPositioning,tournamentRecord,drawDefinition,seedingProfile},assignment),{structureId,event}))}if(structure.structureType!==CONTAINER)!function addDrawPositionToMatchUps({provisionalPositioning,inContextDrawMatchUps,sourceMatchUpStatus,automaticPlacement,drawPositionIndex,tournamentRecord,drawDefinition,drawPosition,matchUpsMap,structure,event}){const matchUpFilters={isCollectionMatchUp:!1},{matchUps}=getAllStructureMatchUps({provisionalPositioning,inContextDrawMatchUps,drawDefinition,matchUpFilters,matchUpsMap,structure,event}),{roundMatchUps}=getRoundMatchUps$1({matchUps}),{initialRoundNumber}=getInitialRoundNumber({drawPosition,matchUps}),matchUp=roundMatchUps[initialRoundNumber].find((matchUp2=>{var _a;return null==(_a=matchUp2.drawPositions)?void 0:_a.includes(drawPosition)}));if(matchUp){const result=assignMatchUpDrawPosition({matchUpId:matchUp.matchUpId,inContextDrawMatchUps,sourceMatchUpStatus,automaticPlacement,drawPositionIndex,tournamentRecord,drawDefinition,drawPosition,matchUpsMap});if(result.error)return decorateResult({stack:"assignDrawPositionToMatchUps",context:{drawPosition},result})}}({provisionalPositioning,inContextDrawMatchUps,positionAssignments,sourceMatchUpStatus,automaticPlacement,drawPositionIndex,tournamentRecord,drawDefinition,drawPosition,matchUpsMap,structure,event});else{modifyRoundRobinMatchUpsStatus({inContextDrawMatchUps,positionAssignments,tournamentRecord,drawDefinition,matchUpsMap,structure});const{drawPositions,matchUps,targetMatchUps}=getTargetMatchUps({assignments:[positionAssignment],inContextDrawMatchUps,drawDefinition,matchUpsMap,structure});if(1===(null==matchUps?void 0:matchUps.length)&&matchUps[0].matchUpType===TEAM$2){const drawPositionSideIndex=null==(_a=null==targetMatchUps?void 0:targetMatchUps[0])?void 0:_a.sides.reduce(((sideIndex,side,i)=>(null==drawPositions?void 0:drawPositions.includes(side.drawPosition))?i:sideIndex),void 0);updateSideLineUp({inContextTargetMatchUp:targetMatchUps[0],teamParticipantId:participantId,matchUp:matchUps[0],drawPositionSideIndex,tournamentRecord,drawDefinition})}}if(!automaticPlacement){conditionallyDisableLinkPositioning({drawPositions:[drawPosition],structure});addPositionActionTelemetry({drawDefinition,positionAction:{name:"positionAssignment",participantId,drawPosition,structureId}})}return modifyPositionAssignmentsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,source:stack,structure,event}),Object.assign({positionAssignments},SUCCESS)}var __defProp$3X=Object.defineProperty,__defProps$2h=Object.defineProperties,__getOwnPropDescs$2h=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3Y=Object.getOwnPropertySymbols,__hasOwnProp$3Y=Object.prototype.hasOwnProperty,__propIsEnum$3Y=Object.prototype.propertyIsEnumerable,__defNormalProp$3X=(obj,key,value)=>key in obj?__defProp$3X(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3X=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3Y.call(b,prop)&&__defNormalProp$3X(a,prop,b[prop]);if(__getOwnPropSymbols$3Y)for(var prop of __getOwnPropSymbols$3Y(b))__propIsEnum$3Y.call(b,prop)&&__defNormalProp$3X(a,prop,b[prop]);return a},__spreadProps$2h=(a,b)=>__defProps$2h(a,__getOwnPropDescs$2h(b));var __defProp$3W=Object.defineProperty,__defProps$2g=Object.defineProperties,__getOwnPropDescs$2g=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3X=Object.getOwnPropertySymbols,__hasOwnProp$3X=Object.prototype.hasOwnProperty,__propIsEnum$3X=Object.prototype.propertyIsEnumerable,__defNormalProp$3W=(obj,key,value)=>key in obj?__defProp$3W(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3W=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3X.call(b,prop)&&__defNormalProp$3W(a,prop,b[prop]);if(__getOwnPropSymbols$3X)for(var prop of __getOwnPropSymbols$3X(b))__propIsEnum$3X.call(b,prop)&&__defNormalProp$3W(a,prop,b[prop]);return a},__spreadProps$2g=(a,b)=>__defProps$2g(a,__getOwnPropDescs$2g(b));var __defProp$3V=Object.defineProperty,__getOwnPropSymbols$3W=Object.getOwnPropertySymbols,__hasOwnProp$3W=Object.prototype.hasOwnProperty,__propIsEnum$3W=Object.prototype.propertyIsEnumerable,__defNormalProp$3V=(obj,key,value)=>key in obj?__defProp$3V(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3V=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3W.call(b,prop)&&__defNormalProp$3V(a,prop,b[prop]);if(__getOwnPropSymbols$3W)for(var prop of __getOwnPropSymbols$3W(b))__propIsEnum$3W.call(b,prop)&&__defNormalProp$3V(a,prop,b[prop]);return a};function directParticipants(params){const result=attemptToModifyScore(params);if(result.error)return result;const matchUpStatusIsValid=isDirectingMatchUpStatus({matchUpStatus:params.matchUpStatus}),{dualWinningSideChange,projectedWinningSide,inContextDrawMatchUps,tournamentRecord,drawDefinition,matchUpStatus,dualMatchUp,matchUpsMap,winningSide,targetData,matchUpId,structure,matchUp,event}=params,stack="directParticipants",isCollectionMatchUp=Boolean(matchUp.collectionId),isAdHocMatchUp=isAdHoc({drawDefinition,structure});let drawPositions=matchUp.drawPositions;if(isCollectionMatchUp){const{matchUpTieId}=params;updateTieMatchUpScore$1({matchUpId:matchUpTieId,tournamentRecord,drawDefinition,event});const matchUpTie=inContextDrawMatchUps.find((({matchUpId:matchUpId2})=>matchUpId2===matchUpTieId));if(drawPositions=null==matchUpTie?void 0:matchUpTie.drawPositions,!dualWinningSideChange)return decorateResult({result:__spreadValues$3V({},SUCCESS),stack})}if(isAdHocMatchUp)return decorateResult({result:__spreadValues$3V({},SUCCESS),stack});if(!drawPositions)return decorateResult({result:{error:MISSING_DRAW_POSITIONS},stack});{const winningIndex=projectedWinningSide?projectedWinningSide-1:winningSide-1,losingIndex=1-winningIndex,winningDrawPosition=drawPositions[winningIndex],loserDrawPosition=drawPositions[losingIndex],{targetLinks:{loserTargetLink,winnerTargetLink,byeTargetLink},targetMatchUps:{winnerMatchUpDrawPositionIndex,loserMatchUpDrawPositionIndex,winnerMatchUp,loserMatchUp,byeMatchUp}}=targetData;if(winnerMatchUp){const result2=function directWinner({winnerMatchUpDrawPositionIndex,inContextDrawMatchUps,projectedWinningSide,sourceMatchUpStatus,winningDrawPosition,tournamentRecord,winnerTargetLink,sourceMatchUpId,drawDefinition,winnerMatchUp,dualMatchUp,matchUpsMap,event}){var _a,_b,_c;if(winnerTargetLink){const targetMatchUpDrawPositions=winnerMatchUp.drawPositions||[],targetMatchUpDrawPosition=targetMatchUpDrawPositions[winnerMatchUpDrawPositionIndex],sourceStructureId=winnerTargetLink.source.structureId,result=findStructure({structureId:sourceStructureId,drawDefinition});if(result.error)return result;const{structure}=result,{positionAssignments:sourcePositionAssignments}=structureAssignedDrawPositions({structureId:sourceStructureId,drawDefinition}),relevantSourceAssignment=sourcePositionAssignments.find((assignment=>assignment.drawPosition===winningDrawPosition)),winnerParticipantId=null==relevantSourceAssignment?void 0:relevantSourceAssignment.participantId,targetStructureId=winnerTargetLink.target.structureId,{positionAssignments:targetPositionAssignments}=structureAssignedDrawPositions({structureId:targetStructureId,drawDefinition}),relevantAssignment=targetPositionAssignments.find((assignment=>assignment.participantId===winnerParticipantId)),winnerExistingDrawPosition=null==relevantAssignment?void 0:relevantAssignment.drawPosition,unfilledTargetMatchUpDrawPositions=targetPositionAssignments.filter((assignment=>{const inTarget=targetMatchUpDrawPositions.includes(assignment.drawPosition),unfilled=!assignment.participantId&&!assignment.bye&&!assignment.qualifier;return inTarget&&unfilled})).map((assignment=>assignment.drawPosition)),targetDrawPositionIsUnfilled=unfilledTargetMatchUpDrawPositions.includes(targetMatchUpDrawPosition);if(1===winnerTargetLink.target.roundNumber&&targetDrawPositionIsUnfilled)assignDrawPosition$1({drawPositionIndex:winnerMatchUpDrawPositionIndex,drawPosition:targetMatchUpDrawPosition,participantId:winnerParticipantId,structureId:targetStructureId,inContextDrawMatchUps,sourceMatchUpStatus,tournamentRecord,sourceMatchUpId,drawDefinition,matchUpsMap,event});else if(unfilledTargetMatchUpDrawPositions.length){const drawPosition=unfilledTargetMatchUpDrawPositions.pop();assignDrawPosition$1({drawPositionIndex:winnerMatchUpDrawPositionIndex,participantId:winnerParticipantId,structureId:targetStructureId,inContextDrawMatchUps,sourceMatchUpStatus,tournamentRecord,sourceMatchUpId,drawDefinition,drawPosition,matchUpsMap,event})}else if(winnerExistingDrawPosition){const result2=assignMatchUpDrawPosition({drawPositionIndex:winnerMatchUpDrawPositionIndex,drawPosition:winnerExistingDrawPosition,matchUpId:winnerMatchUp.matchUpId,inContextDrawMatchUps,sourceMatchUpStatus,tournamentRecord,sourceMatchUpId,drawDefinition,matchUpsMap});if(result2.error)return decorateResult({result:result2,stack:"directWinner"})}else if(structure.stage!==QUALIFYING){const error="winner target position unavaiallble";return console.log(error),{error}}if((null==structure?void 0:structure.seedAssignments)&&structure.structureId!==targetStructureId){const seedAssignment=structure.seedAssignments.find((({participantId})=>participantId===winnerParticipantId));seedAssignment&&assignSeed(__spreadProps$2h(__spreadValues$3X({eventId:null==winnerMatchUp?void 0:winnerMatchUp.eventId,structureId:targetStructureId},seedAssignment),{tournamentRecord,drawDefinition}))}}else{const result=assignMatchUpDrawPosition({drawPositionIndex:winnerMatchUpDrawPositionIndex,matchUpId:winnerMatchUp.matchUpId,drawPosition:winningDrawPosition,inContextDrawMatchUps,sourceMatchUpStatus,tournamentRecord,sourceMatchUpId,drawDefinition,matchUpsMap});if(result.error)return result}if(dualMatchUp&&projectedWinningSide){const side=null==(_a=dualMatchUp.sides)?void 0:_a.find((side2=>side2.sideNumber===projectedWinningSide));if(null==side?void 0:side.lineUp){const source=dualMatchUp.roundPosition,target=winnerMatchUp.roundPosition,targetSideNumber=source===target&&1!==source||Math.floor(source/2)===target?2:1,targetMatchUp=null==(_b=null==matchUpsMap?void 0:matchUpsMap.drawMatchUps)?void 0:_b.find((({matchUpId})=>matchUpId===winnerMatchUp.matchUpId)),updatedSides=[1,2].map((sideNumber=>{var _a2;const existingSide=(null==(_a2=targetMatchUp.sides)?void 0:_a2.find((side2=>side2.sideNumber===sideNumber)))||{};return __spreadProps$2h(__spreadValues$3X({},existingSide),{sideNumber})}));targetMatchUp.sides=updatedSides;const targetSide=targetMatchUp.sides.find((side2=>side2.sideNumber===targetSideNumber));if(targetSide){const filteredLineUp=null==(_c=side.lineUp)?void 0:_c.filter((assignment=>null==assignment?void 0:assignment.participantId));targetSide.lineUp=removeLineUpSubstitutions({lineUp:filteredLineUp}),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==winnerMatchUp?void 0:winnerMatchUp.eventId,matchUp:targetMatchUp,context:"directWinner",drawDefinition})}}}return __spreadValues$3X({},SUCCESS)}({sourceMatchUpStatus:matchUpStatusIsValid&&matchUpStatus||COMPLETED$1,winnerMatchUpDrawPositionIndex,sourceMatchUpId:matchUpId,inContextDrawMatchUps,projectedWinningSide,winningDrawPosition,tournamentRecord,winnerTargetLink,drawDefinition,winnerMatchUp,dualMatchUp,matchUpsMap,event});if(result2.error)return decorateResult({result:result2,stack})}if(loserMatchUp){const result2=function directLoser(params){var _a,_b;const{loserMatchUpDrawPositionIndex,inContextDrawMatchUps,projectedWinningSide,sourceMatchUpStatus,loserDrawPosition,tournamentRecord,loserTargetLink,sourceMatchUpId,drawDefinition,loserMatchUp,dualMatchUp,matchUpsMap,event}=params,stack="directLoser",loserLinkCondition=loserTargetLink.linkCondition,targetMatchUpDrawPositions=loserMatchUp.drawPositions||[],fedDrawPositionFMLC=loserLinkCondition===FIRST_MATCHUP&&2===loserMatchUp.roundNumber&&Math.min(...targetMatchUpDrawPositions.filter(Boolean)),targetMatchUpDrawPosition=fedDrawPositionFMLC||targetMatchUpDrawPositions[loserMatchUpDrawPositionIndex],loserBackdrawPosition=fedDrawPositionFMLC||targetMatchUpDrawPositions[1-loserMatchUpDrawPositionIndex],sourceStructureId=loserTargetLink.source.structureId,{structure}=findStructure({structureId:sourceStructureId,drawDefinition}),{matchUps:sourceMatchUps}=getAllStructureMatchUps({afterRecoveryTimes:!1,inContext:!0,drawDefinition,structure,event}),loserDrawPositionWins=sourceMatchUps.filter((matchUp=>{var _a2;return null==(_a2=matchUp.drawPositions)?void 0:_a2.includes(loserDrawPosition)})).filter((matchUp=>{const drawPositionSide=matchUp.sides.find((side=>side.drawPosition===loserDrawPosition)),unscoredOutcome=matchUp.matchUpStatus===WALKOVER$2||matchUp.matchUpStatus===DEFAULTED&&!scoreHasValue(matchUp);return(null==drawPositionSide?void 0:drawPositionSide.sideNumber)===matchUp.winningSide&&!unscoredOutcome})),validForConsolation=loserLinkCondition===FIRST_MATCHUP&&0===loserDrawPositionWins.length,{positionAssignments:sourcePositionAssignments}=structureAssignedDrawPositions({structureId:sourceStructureId,drawDefinition}),relevantAssignment=sourcePositionAssignments.find((assignment=>assignment.drawPosition===loserDrawPosition)),loserParticipantId=null==relevantAssignment?void 0:relevantAssignment.participantId,targetStructureId=loserTargetLink.target.structureId,{positionAssignments:targetPositionAssignments}=structureAssignedDrawPositions({structureId:targetStructureId,drawDefinition}),targetMatchUpPositionAssignments=targetPositionAssignments.filter((({drawPosition})=>targetMatchUpDrawPositions.includes(drawPosition)));if(targetMatchUpPositionAssignments.some((assignment=>assignment.participantId===loserParticipantId)))return __spreadValues$3W({},SUCCESS);const unfilledTargetMatchUpDrawPositions=targetMatchUpPositionAssignments.filter((assignment=>{const inTarget=targetMatchUpDrawPositions.includes(assignment.drawPosition),unfilled=!assignment.participantId&&!assignment.bye&&!assignment.qualifier;return inTarget&&unfilled})).map((assignment=>assignment.drawPosition)),targetDrawPositionIsUnfilled=unfilledTargetMatchUpDrawPositions.includes(targetMatchUpDrawPosition),isFeedRound=loserTargetLink.target.roundNumber>1&&unfilledTargetMatchUpDrawPositions.length,isFirstRoundValidDrawPosition=1===loserTargetLink.target.roundNumber&&targetDrawPositionIsUnfilled;if(fedDrawPositionFMLC){const result=function loserLinkFedFMLC(){const stack2="loserLinkFedFMLC";return decorateResult(validForConsolation?{result:asssignLoserDrawPosition(),stack:stack2}:{result:assignLoserPositionBye(),stack:stack2})}();if(result.error)return decorateResult({result,stack})}else if(isFirstRoundValidDrawPosition){const result=asssignLoserDrawPosition();if(result.error)return decorateResult({result,stack})}else{if(!isFeedRound)return decorateResult({result:{error:INVALID_DRAW_POSITION},context:{loserDrawPosition,loserTargetLink},stack});{const fedDrawPosition=unfilledTargetMatchUpDrawPositions.sort(numericSort)[0],result=assignDrawPosition$1({drawPositionIndex:loserMatchUpDrawPositionIndex,participantId:loserParticipantId,structureId:targetStructureId,drawPosition:fedDrawPosition,automaticPlacement:!0,inContextDrawMatchUps,sourceMatchUpStatus,tournamentRecord,sourceMatchUpId,drawDefinition,matchUpsMap,event});if(result.error)return decorateResult({result,stack})}}if((null==structure?void 0:structure.seedAssignments)&&structure.structureId!==targetStructureId){const seedAssignment=structure.seedAssignments.find((({participantId})=>participantId===loserParticipantId));seedAssignment&&assignSeed(__spreadProps$2g(__spreadValues$3W({eventId:null==loserMatchUp?void 0:loserMatchUp.eventId,structureId:targetStructureId},seedAssignment),{tournamentRecord,drawDefinition}))}if(dualMatchUp&&projectedWinningSide){const side=null==(_a=dualMatchUp.sides)?void 0:_a.find((side2=>side2.sideNumber===3-projectedWinningSide));if(null==side?void 0:side.lineUp){const{roundNumber,eventId}=loserMatchUp,{roundPosition}=dualMatchUp,targetSideNumber=1===roundNumber?2-roundPosition%2:1,targetMatchUp=null==(_b=null==matchUpsMap?void 0:matchUpsMap.drawMatchUps)?void 0:_b.find((({matchUpId})=>matchUpId===loserMatchUp.matchUpId)),updatedSides=[1,2].map((sideNumber=>{var _a2;const existingSide=(null==(_a2=targetMatchUp.sides)?void 0:_a2.find((side2=>side2.sideNumber===sideNumber)))||{};return __spreadProps$2g(__spreadValues$3W({},existingSide),{sideNumber})}));targetMatchUp.sides=updatedSides;const targetSide=targetMatchUp.sides.find((side2=>side2.sideNumber===targetSideNumber));targetSide&&(targetSide.lineUp=removeLineUpSubstitutions({lineUp:side.lineUp}),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUp:targetMatchUp,context:stack,drawDefinition,eventId}))}}return __spreadValues$3W({},SUCCESS);function assignLoserPositionBye(){return decorateResult({result:assignDrawPositionBye$1({drawPositionIndex:loserMatchUpDrawPositionIndex,drawPosition:loserBackdrawPosition,structureId:targetStructureId,tournamentRecord,sourceMatchUpId,drawDefinition,event}),stack:"assignLoserPositionBye"})}function asssignLoserDrawPosition(){return decorateResult({result:assignDrawPosition$1({drawPositionIndex:loserMatchUpDrawPositionIndex,drawPosition:targetMatchUpDrawPosition,participantId:loserParticipantId,structureId:targetStructureId,automaticPlacement:!0,inContextDrawMatchUps,sourceMatchUpStatus,tournamentRecord,sourceMatchUpId,drawDefinition,matchUpsMap,event}),stack:"assignLoserDrawPosition"})}}({sourceMatchUpStatus:matchUpStatusIsValid&&matchUpStatus||COMPLETED$1,loserMatchUpDrawPositionIndex,sourceMatchUpId:matchUpId,inContextDrawMatchUps,projectedWinningSide,loserDrawPosition,tournamentRecord,loserTargetLink,drawDefinition,loserMatchUp,winningSide,matchUpsMap,dualMatchUp,event});if(result2.error)return decorateResult({result:result2,stack})}if(byeMatchUp){const targetMatchUpDrawPositions=byeMatchUp.drawPositions||[],result2=assignDrawPositionBye$1({drawPosition:Math.min(...targetMatchUpDrawPositions.filter(Boolean)),structureId:byeTargetLink.target.structureId,tournamentRecord,drawDefinition,event});if(result2.error)return decorateResult({result:result2,stack})}}return decorateResult({result:__spreadValues$3V({},SUCCESS),stack})}function isActiveDownstream(params){var _a,_b;const{inContextDrawMatchUps,targetData,drawDefinition,relevantLink}=params;if((null==relevantLink?void 0:relevantLink.linkCondition)===FIRST_MATCHUP&&(null==(_a=null==targetData?void 0:targetData.matchUp)?void 0:_a.matchUpStatus)===BYE)return!1;const{targetMatchUps:{loserMatchUp,winnerMatchUp},targetLinks}=targetData,loserMatchUpExit=[DEFAULTED,WALKOVER$2].includes(null==loserMatchUp?void 0:loserMatchUp.matchUpStatus),winnerDrawPositionsCount=(null==(_b=null==winnerMatchUp?void 0:winnerMatchUp.drawPositions)?void 0:_b.filter(Boolean).length)||0;if((null==loserMatchUp?void 0:loserMatchUp.winningSide)&&!loserMatchUpExit||(null==winnerMatchUp?void 0:winnerMatchUp.winningSide)&&2===winnerDrawPositionsCount&&(!winnerMatchUp.feedRound||![WALKOVER$2,DEFAULTED].includes(null==winnerMatchUp?void 0:winnerMatchUp.matchUpStatus)))return!0;let loserTargetData=loserMatchUp&&positionTargets({matchUpId:loserMatchUp.matchUpId,inContextDrawMatchUps,drawDefinition}),winnerTargetData=winnerMatchUp&&positionTargets({matchUpId:winnerMatchUp.matchUpId,inContextDrawMatchUps,drawDefinition});const loserActive=loserTargetData&&isActiveDownstream({relevantLink:null==targetLinks?void 0:targetLinks.loserTargetLink,targetData:loserTargetData,inContextDrawMatchUps,drawDefinition});return!(!(winnerTargetData&&isActiveDownstream({targetData:winnerTargetData,inContextDrawMatchUps,drawDefinition}))&&!loserActive)}var __defProp$3U=Object.defineProperty,__defProps$2f=Object.defineProperties,__getOwnPropDescs$2f=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3V=Object.getOwnPropertySymbols,__hasOwnProp$3V=Object.prototype.hasOwnProperty,__propIsEnum$3V=Object.prototype.propertyIsEnumerable,__defNormalProp$3U=(obj,key,value)=>key in obj?__defProp$3U(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3U=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3V.call(b,prop)&&__defNormalProp$3U(a,prop,b[prop]);if(__getOwnPropSymbols$3V)for(var prop of __getOwnPropSymbols$3V(b))__propIsEnum$3V.call(b,prop)&&__defNormalProp$3U(a,prop,b[prop]);return a},__spreadProps$2f=(a,b)=>__defProps$2f(a,__getOwnPropDescs$2f(b));var __defProp$3T=Object.defineProperty,__defProps$2e=Object.defineProperties,__getOwnPropDescs$2e=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3U=Object.getOwnPropertySymbols,__hasOwnProp$3U=Object.prototype.hasOwnProperty,__propIsEnum$3U=Object.prototype.propertyIsEnumerable,__defNormalProp$3T=(obj,key,value)=>key in obj?__defProp$3T(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3T=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3U.call(b,prop)&&__defNormalProp$3T(a,prop,b[prop]);if(__getOwnPropSymbols$3U)for(var prop of __getOwnPropSymbols$3U(b))__propIsEnum$3U.call(b,prop)&&__defNormalProp$3T(a,prop,b[prop]);return a},__spreadProps$2e=(a,b)=>__defProps$2e(a,__getOwnPropDescs$2e(b));var __defProp$3S=Object.defineProperty,__getOwnPropSymbols$3T=Object.getOwnPropertySymbols,__hasOwnProp$3T=Object.prototype.hasOwnProperty,__propIsEnum$3T=Object.prototype.propertyIsEnumerable,__defNormalProp$3S=(obj,key,value)=>key in obj?__defProp$3S(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3S=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3T.call(b,prop)&&__defNormalProp$3S(a,prop,b[prop]);if(__getOwnPropSymbols$3T)for(var prop of __getOwnPropSymbols$3T(b))__propIsEnum$3T.call(b,prop)&&__defNormalProp$3S(a,prop,b[prop]);return a};function attemptToSetWinningSide(params){var _a,_b;const stack="attemptToSetWinningSide";let connectedStructures;const{appliedPolicies,disableAutoCalc,drawDefinition,matchUpsMap,dualMatchUp,winningSide,structure,matchUp}=params;if((null==dualMatchUp?void 0:dualMatchUp._disableAutoCalc)&&!1!==disableAutoCalc)return attemptToModifyScore(params);if(matchUp.winningSide&&matchUp.winningSide!==winningSide){const{connectedStructureIds}=checkConnectedStructures({drawDefinition,matchUpsMap,structure,matchUp});connectedStructureIds.length&&(console.log({connectedStructureIds}),connectedStructures=!0);const result2=removeDirectedParticipants(params);if(result2.error)return result2}const result=directParticipants(params);if(result.error)return decorateResult({result,stack});let qualifierReplaced,qualifierPlaced;return params.qualifierChanging&&(null==(_a=null==appliedPolicies?void 0:appliedPolicies[POLICY_TYPE_PROGRESSION])?void 0:_a.autoReplaceQualifiers)&&(qualifierReplaced=function replaceQualifier(params){var _a,_b;let qualifierReplaced;const{inContextDrawMatchUps,inContextMatchUp,drawDefinition,winningSide}=params,winnerTargetLink=null==(_a=params.targetData.targetLinks)?void 0:_a.winnerTargetLink;if(winnerTargetLink.target.feedProfile===DRAW){const previousWinningParticipantId=inContextMatchUp.sides.find((({sideNumber})=>sideNumber!==winningSide)).participantId,mainDrawTargetMatchUp=inContextDrawMatchUps.find((m=>m.structureId===winnerTargetLink.target.structureId&&m.roundNumber===winnerTargetLink.target.roundNumber&&m.sides.some((({participantId})=>participantId===previousWinningParticipantId))));if((null==mainDrawTargetMatchUp?void 0:mainDrawTargetMatchUp.matchUpStatus)===TO_BE_PLAYED&&!isActiveDownstream({inContextDrawMatchUps,drawDefinition,targetData:positionTargets({matchUpId:mainDrawTargetMatchUp.matchUpId,inContextDrawMatchUps,drawDefinition})})){const{structure}=findStructure({structureId:mainDrawTargetMatchUp.structureId,drawDefinition}),positionAssignments=getPositionAssignments$1({structure}).positionAssignments;for(const positionAssignment of positionAssignments)if(positionAssignment.participantId===previousWinningParticipantId){const newWinningParticipantId=inContextMatchUp.sides.find((({sideNumber})=>sideNumber===winningSide)).participantId;if(positionAssignment.participantId=newWinningParticipantId,structure.positionAssignments)structure.positionAssignments=positionAssignments;else if(structure.structures){const assignmentMap=Object.assign({},...positionAssignments.map((assignment=>({[assignment.drawPosition]:assignment.participantId}))));for(const subStructure of structure.structures)subStructure.positionAssignments.forEach((assignment=>assignment.participantId=assignmentMap[assignment.drawPosition]))}modifyPositionAssignmentsNotice({tournamentId:null==(_b=params.tournamentRecord)?void 0:_b.tournamentId,event:params.event,drawDefinition,source:"replaceQualifier",structure}),qualifierReplaced=!0}}}return __spreadProps$2f(__spreadValues$3U({},SUCCESS),{qualifierReplaced})}(params).qualifierReplaced),params.qualifierAdvancing&&(null==(_b=null==appliedPolicies?void 0:appliedPolicies[POLICY_TYPE_PROGRESSION])?void 0:_b.autoPlaceQualifiers)&&(qualifierPlaced=function placeQualifier(params){var _a,_b,_c,_d;let qualifierPlaced;const{inContextDrawMatchUps,inContextMatchUp,drawDefinition,winningSide}=params,winnerTargetLink=null==(_a=params.targetData.targetLinks)?void 0:_a.winnerTargetLink;if(winnerTargetLink.target.feedProfile===DRAW){const winningQualifierId=null==(_b=inContextMatchUp.sides.find((({sideNumber})=>sideNumber===winningSide)))?void 0:_b.participantId,mainDrawTargetMatchUp=randomMember(inContextDrawMatchUps.filter((m=>m.structureId===winnerTargetLink.target.structureId&&m.roundNumber===winnerTargetLink.target.roundNumber&&m.sides.some((({participantId,qualifier})=>qualifier&&!participantId)))));if((null==mainDrawTargetMatchUp?void 0:mainDrawTargetMatchUp.matchUpStatus)===TO_BE_PLAYED&&!isActiveDownstream({inContextDrawMatchUps,drawDefinition,targetData:positionTargets({matchUpId:mainDrawTargetMatchUp.matchUpId,inContextDrawMatchUps,drawDefinition})})){const targetDrawPosition=null==(_c=mainDrawTargetMatchUp.sides.find((side=>side.qualifier&&!side.participantId)))?void 0:_c.drawPosition,{structure}=findStructure({structureId:mainDrawTargetMatchUp.structureId,drawDefinition}),positionAssignments=getPositionAssignments$1({structure}).positionAssignments;for(const positionAssignment of positionAssignments)if(positionAssignment.drawPosition===targetDrawPosition&&!positionAssignment.participantId){if(positionAssignment.participantId=winningQualifierId,structure.positionAssignments)structure.positionAssignments=positionAssignments;else if(structure.structures){const assignmentMap=Object.assign({},...positionAssignments.map((assignment=>({[assignment.drawPosition]:assignment.participantId}))));for(const subStructure of structure.structures)subStructure.positionAssignments.forEach((assignment=>assignment.participantId=assignmentMap[assignment.drawPosition]))}modifyPositionAssignmentsNotice({tournamentId:null==(_d=params.tournamentRecord)?void 0:_d.tournamentId,event:params.event,drawDefinition,source:"placeQualifier",structure}),qualifierPlaced=!0}}}return __spreadProps$2e(__spreadValues$3T({},SUCCESS),{qualifierPlaced})}(params).qualifierPlaced),decorateResult({result:definedAttributes(__spreadValues$3S({connectedStructures,qualifierReplaced,qualifierPlaced},SUCCESS)),stack})}var __defProp$3R=Object.defineProperty,__defProps$2d=Object.defineProperties,__getOwnPropDescs$2d=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3S=Object.getOwnPropertySymbols,__hasOwnProp$3S=Object.prototype.hasOwnProperty,__propIsEnum$3S=Object.prototype.propertyIsEnumerable,__defNormalProp$3R=(obj,key,value)=>key in obj?__defProp$3R(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3R=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3S.call(b,prop)&&__defNormalProp$3R(a,prop,b[prop]);if(__getOwnPropSymbols$3S)for(var prop of __getOwnPropSymbols$3S(b))__propIsEnum$3S.call(b,prop)&&__defNormalProp$3R(a,prop,b[prop]);return a},__spreadProps$2d=(a,b)=>__defProps$2d(a,__getOwnPropDescs$2d(b));function removeDoubleExit(params){var _a;const{inContextDrawMatchUps,appliedPolicies,drawDefinition,matchUpsMap,targetData,matchUp}=params;let{iteration=0}=params;iteration+=1;const stack="removeDoubleExit";pushGlobalLog();const{targetLinks:{loserTargetLink},targetMatchUps:{loserMatchUp,winnerMatchUp,loserTargetDrawPosition}}=targetData;if(winnerMatchUp&&winnerMatchUp.matchUpStatus!==BYE&&(pushGlobalLog(),conditionallyRemoveDrawPosition(__spreadProps$2d(__spreadValues$3R({},params),{targetMatchUp:winnerMatchUp,sourceMatchUp:matchUp,iteration}))),loserMatchUp&&loserMatchUp.matchUpStatus!==BYE){const inContextLoserMatchUp=inContextDrawMatchUps.find((({matchUpId})=>matchUpId===loserMatchUp.matchUpId)),{structure:loserStructure}=findStructure({drawDefinition,structureId:inContextLoserMatchUp.structureId});if(pushGlobalLog(),null==(_a=null==appliedPolicies?void 0:appliedPolicies.progression)?void 0:_a.doubleExitPropagateBye){const result=removeDirectedBye({targetLink:loserTargetLink,drawPosition:loserTargetDrawPosition,inContextDrawMatchUps,drawDefinition,matchUpsMap});if(result.error)return decorateResult({result,stack})}else{const result=conditionallyRemoveDrawPosition(__spreadProps$2d(__spreadValues$3R({},params),{structure:loserStructure,targetMatchUp:loserMatchUp,iteration}));if(result.error)return decorateResult({result,stack})}}return decorateResult({result:__spreadValues$3R({},SUCCESS),stack})}function conditionallyRemoveDrawPosition(params){var _a,_b,_c,_d,_e;const{inContextDrawMatchUps,appliedPolicies,drawDefinition,sourceMatchUp,targetMatchUp,matchUpsMap,structure,iteration}=params,stack="conditionallyRemoveDrawPosition";pushGlobalLog();const nextTargetData=positionTargets({matchUpId:targetMatchUp.matchUpId,inContextDrawMatchUps,drawDefinition}),{targetMatchUps:{winnerMatchUp:nextWinnerMatchUp}}=nextTargetData,noContextTargetMatchUp=null==matchUpsMap?void 0:matchUpsMap.drawMatchUps.find((matchUp=>matchUp.matchUpId===targetMatchUp.matchUpId));let pairedPreviousDoubleExit,pairedPreviousMatchUp,drawPositionToRemove,pairedPreviousDrawPositions=[];if(targetMatchUp.feedRound){const nextWinnerDrawPositions=null==(_a=null==nextWinnerMatchUp?void 0:nextWinnerMatchUp.drawPositions)?void 0:_a.filter(Boolean);drawPositionToRemove=null==nextWinnerDrawPositions?void 0:nextWinnerDrawPositions.find((drawPosition=>targetMatchUp.drawPositions.includes(drawPosition)))}else if(sourceMatchUp){pairedPreviousMatchUp=null==(_c=getPairedPreviousMatchUp({structureId:structure.structureId,matchUp:sourceMatchUp,matchUpsMap}))?void 0:_c.pairedPreviousMatchUp,pairedPreviousDoubleExit=[DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(null==pairedPreviousMatchUp?void 0:pairedPreviousMatchUp.matchUpStatus),pairedPreviousDrawPositions=(null==(_d=null==pairedPreviousMatchUp?void 0:pairedPreviousMatchUp.drawPositions)?void 0:_d.filter(Boolean))||[];if([...completedMatchUpStatuses,BYE].includes(null==pairedPreviousMatchUp?void 0:pairedPreviousMatchUp.matchUpStatus)||(null==pairedPreviousMatchUp?void 0:pairedPreviousMatchUp.winningSide)){const sourceDrawPositions=sourceMatchUp.drawPositions||[];let targetDrawPositions=null==(_e=targetMatchUp.drawPositions)?void 0:_e.filter(Boolean);overlap(sourceDrawPositions,targetDrawPositions)&&(targetDrawPositions=null==targetDrawPositions?void 0:targetDrawPositions.filter((drawPosition=>!sourceDrawPositions.includes(drawPosition))));drawPositionToRemove=sourceDrawPositions.concat(pairedPreviousDrawPositions).find((drawPosition=>null==targetDrawPositions?void 0:targetDrawPositions.includes(drawPosition)))}}else drawPositionToRemove=null==(_b=intersection((null==targetMatchUp?void 0:targetMatchUp.drawPositions)||[],(null==nextWinnerMatchUp?void 0:nextWinnerMatchUp.drawPositions)||[]))?void 0:_b[0];if(nextWinnerMatchUp&&drawPositionToRemove){pushGlobalLog();const result2=removeDirectedWinner({winningDrawPosition:drawPositionToRemove,winnerMatchUp:nextWinnerMatchUp,inContextDrawMatchUps,drawDefinition,matchUpsMap});if(result2.error)return decorateResult({result:result2,stack})}let result=removeDoubleExit({targetData:nextTargetData,matchUp:targetMatchUp,inContextDrawMatchUps,appliedPolicies,drawDefinition,matchUpsMap,structure,iteration});if(result.error)return decorateResult({result,stack});const matchUpStatus=function getMatchUpStatus({pairedPreviousDoubleExit,noContextTargetMatchUp}){return noContextTargetMatchUp.matchUpStatus===BYE?BYE:pairedPreviousDoubleExit?[DOUBLE_DEFAULT,DEFAULTED].includes(null==noContextTargetMatchUp?void 0:noContextTargetMatchUp.matchUpStatus)?DEFAULTED:WALKOVER$2:TO_BE_PLAYED}({pairedPreviousDoubleExit,noContextTargetMatchUp}),removeScore=!pairedPreviousDoubleExit;return result=modifyMatchUpScore(__spreadProps$2d(__spreadValues$3R({},params),{matchUpStatus,removeScore,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},removeWinningSide:!0,matchUp:noContextTargetMatchUp,matchUpId:targetMatchUp.matchUpId,matchUpStatusCodes:[]})),result.error?decorateResult({result,stack}):__spreadValues$3R({},SUCCESS)}var __defProp$3Q=Object.defineProperty,__defProps$2c=Object.defineProperties,__getOwnPropDescs$2c=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3R=Object.getOwnPropertySymbols,__hasOwnProp$3R=Object.prototype.hasOwnProperty,__propIsEnum$3R=Object.prototype.propertyIsEnumerable,__defNormalProp$3Q=(obj,key,value)=>key in obj?__defProp$3Q(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3Q=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3R.call(b,prop)&&__defNormalProp$3Q(a,prop,b[prop]);if(__getOwnPropSymbols$3R)for(var prop of __getOwnPropSymbols$3R(b))__propIsEnum$3R.call(b,prop)&&__defNormalProp$3Q(a,prop,b[prop]);return a},__spreadProps$2c=(a,b)=>__defProps$2c(a,__getOwnPropDescs$2c(b));function noDownstreamDependencies(params){const{matchUp,matchUpStatus,score,winningSide}=params,stack="noDownStreamDependencies";if([DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(null==matchUp?void 0:matchUp.matchUpStatus)&&![DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(matchUpStatus)){const result2=removeDoubleExit(params);if(result2.error)return decorateResult({result:result2,stack})}const doubleWalkover=matchUpStatus===DOUBLE_WALKOVER,scoreWithNoWinningSide=scoreHasValue({score})&&!doubleWalkover&&(params.isCollectionMatchUp&&!params.projectedWinningSide||!winningSide),removeScore=params.removeScore||![INCOMPLETE,ABANDONED].includes(matchUpStatus||INCOMPLETE),removeWinningSide=params.isCollectionMatchUp&&params.dualMatchUp.winningSide&&!params.projectedWinningSide||matchUp.winningSide&&!winningSide&&!scoreHasValue({score}),statusNotTBP=matchUpStatus&&matchUpStatus!==TO_BE_PLAYED,removeDirected=({removeScore:removeScore2}={})=>{var _a,_b;let connectedStructures;const{structure,drawDefinition,dualMatchUp,disableAutoCalc}=params;if((null==dualMatchUp?void 0:dualMatchUp._disableAutoCalc)&&!1!==disableAutoCalc)return attemptToModifyScore(params);const{connectedStructureIds}=checkConnectedStructures({drawDefinition,structure,matchUp});connectedStructureIds.length&&(console.log({connectedStructureIds}),connectedStructures=!0),Object.assign(params,{removeScore:removeScore2});const result2=removeDirectedParticipants(params);if(result2.error)return result2;if(params.removingQualifier&&(null==(_b=null==(_a=params.appliedPolicies)?void 0:_a[POLICY_TYPE_PROGRESSION])?void 0:_b.autoRemoveQualifiers)){const result3=function removeQualifier(params){var _a,_b,_c;let qualifierRemoved;const{inContextDrawMatchUps,inContextMatchUp,drawDefinition}=params,winnerTargetLink=null==(_a=params.targetData.targetLinks)?void 0:_a.winnerTargetLink;if(winnerTargetLink.target.feedProfile===DRAW){const previousWinningParticipantId=null==(_b=inContextMatchUp.sides.find((({sideNumber})=>sideNumber===inContextMatchUp.winningSide)))?void 0:_b.participantId,mainDrawTargetMatchUp=inContextDrawMatchUps.find((m=>m.structureId===winnerTargetLink.target.structureId&&m.roundNumber===winnerTargetLink.target.roundNumber&&m.sides.some((({participantId})=>participantId===previousWinningParticipantId))));if((null==mainDrawTargetMatchUp?void 0:mainDrawTargetMatchUp.matchUpStatus)===TO_BE_PLAYED&&!isActiveDownstream({inContextDrawMatchUps,drawDefinition,targetData:positionTargets({matchUpId:mainDrawTargetMatchUp.matchUpId,inContextDrawMatchUps,drawDefinition})})){const{structure}=findStructure({structureId:mainDrawTargetMatchUp.structureId,drawDefinition}),positionAssignments=getPositionAssignments$1({structure}).positionAssignments;for(const positionAssignment of positionAssignments)if(positionAssignment.participantId===previousWinningParticipantId){if(positionAssignment.participantId=void 0,structure.positionAssignments)structure.positionAssignments=positionAssignments;else if(structure.structures){const assignmentMap=Object.assign({},...positionAssignments.map((assignment=>({[assignment.drawPosition]:assignment.participantId}))));for(const subStructure of structure.structures)subStructure.positionAssignments.forEach((assignment=>assignment.participantId=assignmentMap[assignment.drawPosition]))}modifyPositionAssignmentsNotice({tournamentId:null==(_c=params.tournamentRecord)?void 0:_c.tournamentId,event:params.event,drawDefinition,source:"removeQualifier",structure}),qualifierRemoved=!0}}}return{qualifierRemoved}}(params);return result3.error?result3:__spreadValues$3Q(__spreadProps$2c(__spreadValues$3Q({},SUCCESS),{connectedStructures}),result3)}return __spreadProps$2c(__spreadValues$3Q({},SUCCESS),{connectedStructures})};if(removeWinningSide&&winningSide&&params.isCollectionMatchUp)return scoreModification(params);const triggerDualWinningSide=[CANCELLED$1,ABANDONED].includes(matchUpStatus)&&params.dualWinningSideChange;return decorateResult({result:(winningSide||triggerDualWinningSide)&&attemptToSetWinningSide(params)||scoreWithNoWinningSide&&removeDirected({removeScore})||statusNotTBP&&attemptToSetMatchUpStatus(params)||removeWinningSide&&removeDirected({removeScore})||matchUp&&scoreModification(__spreadProps$2c(__spreadValues$3Q({},params),{removeScore:!0}))||console.log("unknown condition")&&__spreadValues$3Q({},SUCCESS),stack})}function scoreModification(params){var _a;if(params.isCollectionMatchUp&&(null==(_a=params.dualMatchUp)?void 0:_a.winningSide)&&!params.projectedWinningSide){const result2=removeDirectedParticipants(params);if(result2.error)return result2}const result=modifyMatchUpScore(__spreadValues$3Q({},params));if(params.isCollectionMatchUp){const{matchUpTieId,drawDefinition,event}=params,{removeWinningSide}=updateTieMatchUpScore$1({tournamentRecord:params.tournamentRecord,matchUpId:matchUpTieId,drawDefinition,event});removeWinningSide&&console.log("REMOVE WINNING SIDE")}return decorateResult({result,stack:"scoreModification"})}var __defProp$3P=Object.defineProperty,__defProps$2b=Object.defineProperties,__getOwnPropDescs$2b=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3Q=Object.getOwnPropertySymbols,__hasOwnProp$3Q=Object.prototype.hasOwnProperty,__propIsEnum$3Q=Object.prototype.propertyIsEnumerable,__defNormalProp$3P=(obj,key,value)=>key in obj?__defProp$3P(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3P=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3Q.call(b,prop)&&__defNormalProp$3P(a,prop,b[prop]);if(__getOwnPropSymbols$3Q)for(var prop of __getOwnPropSymbols$3Q(b))__propIsEnum$3Q.call(b,prop)&&__defNormalProp$3P(a,prop,b[prop]);return a},__spreadProps$2b=(a,b)=>__defProps$2b(a,__getOwnPropDescs$2b(b));function setMatchUpStatus$2(params){var _a,_b;[WALKOVER$2,DOUBLE_WALKOVER].includes(params.matchUpStatus)&&(params.score=void 0);const{allowChangePropagation,disableScoreValidation,tournamentRecords,tournamentRecord,disableAutoCalc,enableAutoCalc,drawDefinition,matchUpStatus,winningSide,matchUpId,event,score}=params;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if([CANCELLED$1,INCOMPLETE,ABANDONED,TO_BE_PLAYED].includes(matchUpStatus)&&winningSide)return{error:INVALID_VALUES,winningSide,matchUpStatus};if(![void 0,...validMatchUpStatuses].includes(matchUpStatus))return decorateResult({result:{error:INVALID_MATCHUP_STATUS},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});const matchUpsMap=getMatchUpsMap({drawDefinition});let{matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,nextMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap});const matchUp=matchUpsMap.drawMatchUps.find((matchUp2=>matchUp2.matchUpId===matchUpId)),inContextMatchUp=inContextDrawMatchUps.find((matchUp2=>matchUp2.matchUpId===matchUpId));if(!matchUp||!inContextDrawMatchUps)return{error:MATCHUP_NOT_FOUND};if((matchUp.winningSide||winningSide)&&matchUpStatus===BYE)return{context:"Cannot have Bye with winningSide",error:INCOMPATIBLE_MATCHUP_STATUS,matchUpStatus};const assignedDrawPositions=null==(_a=inContextMatchUp.drawPositions)?void 0:_a.filter(Boolean);let dualWinningSideChange;if(matchUp.matchUpType===TEAM$2)if(disableAutoCalc)addExtension$1({extension:{name:DISABLE_AUTO_CALC,value:!0},element:matchUp});else if(enableAutoCalc){const existingDualMatchUpWinningSide=matchUp.winningSide;removeExtension$1({name:DISABLE_AUTO_CALC,element:matchUp});const{winningSide:projectedWinningSide,scoreStringSide1,scoreStringSide2,set}=generateTieMatchUpScore({matchUp}),score2={scoreStringSide1,scoreStringSide2,sets:set?[set]:[]};dualWinningSideChange=projectedWinningSide!==existingDualMatchUpWinningSide,Object.assign(params,{winningSide:projectedWinningSide,dualWinningSideChange,projectedWinningSide,score:score2})}if(matchUp.matchUpType===TEAM$2&&[AWAITING_RESULT].includes(matchUpStatus))return{error:INVALID_VALUES,info:"Not supported for matchUpType: TEAM"};const matchUpTieId=inContextMatchUp.matchUpTieId,targetData=positionTargets({matchUpId:matchUpTieId||matchUpId,inContextDrawMatchUps,drawDefinition}),structureId=inContextMatchUp.structureId,{structure}=findStructure({drawDefinition,structureId});if(score&&matchUp.matchUpType!==TEAM$2&&!disableScoreValidation){const matchUpFormat=matchUp.matchUpFormat||(null==structure?void 0:structure.matchUpFormat)||(null==drawDefinition?void 0:drawDefinition.matchUpFormat)||(null==event?void 0:event.matchUpFormat),result2=validateScore({existingMatchUpStatus:matchUp.matchUpStatus,matchUpFormat,matchUpStatus,winningSide,score});if(result2.error)return result2}const bothSideParticipants=2===(null==(_b=matchUp.sides)?void 0:_b.map((side=>side.participantId)).filter(Boolean).length)||2===(null==assignedDrawPositions?void 0:assignedDrawPositions.length);if(matchUpStatus&&particicipantsRequiredMatchUpStatuses.includes(matchUpStatus)&&!bothSideParticipants)return decorateResult({result:{error:INVALID_MATCHUP_STATUS},info:"present in participantRequiredMatchUpStatuses",context:{matchUpStatus,bothSideParticipants}});const{appliedPolicies}=getAppliedPolicies({policyTypes:[POLICY_TYPE_PROGRESSION],tournamentRecord,drawDefinition,event});"object"==typeof params.policyDefinitions&&Object.assign(appliedPolicies,params.policyDefinitions);const qualifyingMatch=inContextMatchUp.stage===QUALIFYING&&1===inContextMatchUp.finishingRound,qualifierAdvancing=qualifyingMatch&&winningSide,removingQualifier=qualifyingMatch&&matchUp.winningSide&&!winningSide&&(!params.matchUpStatus||isNonDirectingMatchUpStatus(params.matchUpStatus))&&!scoreHasValue(params.outcome),qualifierChanging=qualifierAdvancing&&winningSide!==matchUp.winningSide&&matchUp.winningSide;if(Object.assign(params,{inContextDrawMatchUps,qualifierAdvancing,qualifierChanging,removingQualifier,inContextMatchUp,appliedPolicies,matchUpTieId,matchUpsMap,targetData,structure,matchUp}),matchUpTieId){const{matchUp:dualMatchUp}=findMatchUp$1({matchUpId:matchUpTieId,inContext:!0,drawDefinition,matchUpsMap,event}),tieFormat=(null==dualMatchUp?void 0:dualMatchUp.tieFormat)||(null==structure?void 0:structure.tieFormat)||(null==drawDefinition?void 0:drawDefinition.tieFormat)||(null==event?void 0:event.tieFormat)||void 0,{projectedWinningSide}=function getProjectedDualWinningSide({drawDefinition,matchUpStatus,winningSide,dualMatchUp,tieFormat,structure,matchUp,event,score}){const projectedDualMatchUp=makeDeepCopy(dualMatchUp,void 0,!0);for(const tieMatchUp of(null==projectedDualMatchUp?void 0:projectedDualMatchUp.tieMatchUps)||[])tieMatchUp.matchUpId===matchUp.matchUpId&&(tieMatchUp.winningSide=winningSide,tieMatchUp.score=score,scoreHasValue({score})||matchUpStatus?matchUpStatus&&(tieMatchUp.matchUpStatus=matchUpStatus):Object.assign(tieMatchUp,__spreadValues$4d({},toBePlayed)));tieFormat=tieFormat||(null==matchUp?void 0:matchUp.tieFormat)||(null==structure?void 0:structure.tieFormat)||(null==drawDefinition?void 0:drawDefinition.tieFormat)||(null==event?void 0:event.tieFormat);const{winningSide:projectedWinningSide}=generateTieMatchUpScore({matchUp:projectedDualMatchUp,drawDefinition,tieFormat,event});return{projectedWinningSide}}({matchUpStatus,dualMatchUp,winningSide,tieFormat,structure,matchUp,event,score});dualWinningSideChange=projectedWinningSide!==dualMatchUp.winningSide,Object.assign(params,{isCollectionMatchUp:!0,dualWinningSideChange,projectedWinningSide,matchUpTieId,dualMatchUp,tieFormat})}const activeDownstream=isActiveDownstream(params),directingMatchUpStatus=isDirectingMatchUpStatus({matchUpStatus});if(!matchUpTieId){if(activeDownstream&&!winningSide&&(isNonDirectingMatchUpStatus({matchUpStatus})||[DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(matchUpStatus)))return{error:INCOMPATIBLE_MATCHUP_STATUS,activeDownstream,winningSide};if(winningSide&&winningSide===matchUp.winningSide&&matchUpStatus&&!directingMatchUpStatus)return{context:"winningSide must include directing matchUpStatus",error:INCOMPATIBLE_MATCHUP_STATUS,directingMatchUpStatus,matchUpStatus}}const{schedule}=params;if(schedule){const result2=addMatchUpScheduleItems$2({disableNotice:!0,tournamentRecords,tournamentRecord,drawDefinition,matchUpId,schedule});if(result2.error)return result2}const validWinningSideSwap=matchUp.matchUpType!==TEAM$2&&!dualWinningSideChange&&winningSide&&matchUp.winningSide&&matchUp.winningSide!==winningSide;if(allowChangePropagation&&validWinningSideSwap&&matchUp.roundPosition)return function swapWinnerLoser(params){var _a;const{tournamentRecord,inContextMatchUp,structure,drawDefinition}=params,matchUpRoundNumber=inContextMatchUp.roundNumber,existingWinnerSide=inContextMatchUp.sides.find((side=>side.sideNumber===inContextMatchUp.winningSide)),existingLoserSide=inContextMatchUp.sides.find((side=>side.sideNumber!==inContextMatchUp.winningSide)),{drawPosition:existingWinnerDrawPosition,participantId:existingWinnerParticipantId}=existingWinnerSide,{drawPosition:existingLoserDrawPosition,participantId:existingLoserParticipantId}=existingLoserSide,{matchUps}=getAllStructureMatchUps(params),existingWinnerSubsequentMatchUps=matchUps.filter((({drawPositions,roundNumber})=>(null==drawPositions?void 0:drawPositions.includes(existingWinnerDrawPosition))&&roundNumber>matchUpRoundNumber));getDevContext({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps}),existingWinnerSubsequentMatchUps.forEach((matchUp=>{var _a2,_b;matchUp.drawPositions=(null==(_a2=matchUp.drawPositions)?void 0:_a2.map((drawPosition=>drawPosition===existingWinnerDrawPosition?existingLoserDrawPosition:drawPosition)))||[],modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==(_b=params.event)?void 0:_b.eventId,context:"swapWinnerLoser",drawDefinition,matchUp})}));const{stage:currentStage,stageSequence:currentStageSequence}=structure,subsequentStructureIds=drawDefinition.structures.filter((({stage,stageSequence})=>stage===currentStage&&stageSequence>currentStageSequence)).map((({structureId})=>structureId)),{targetLinks:{loserTargetLink,winnerTargetLink}}=params.targetData,targetStructureIds=[null==loserTargetLink?void 0:loserTargetLink.target.structureId,null==(_a=null==winnerTargetLink?void 0:winnerTargetLink.target)?void 0:_a.structureId].filter(Boolean);return drawDefinition.structures.filter((({stage,structureId})=>stage!==currentStage&&targetStructureIds.includes(structureId))).forEach((({stage:targetStage,stageSequence:targetStageSequence,structureId})=>{subsequentStructureIds.includes(structureId)||subsequentStructureIds.push(structureId),drawDefinition.structures.filter((({stage,stageSequence})=>stage===targetStage&&stageSequence>targetStageSequence)).forEach((({structureId:structureId2})=>{subsequentStructureIds.includes(structureId2)||subsequentStructureIds.push(structureId2)}))})),drawDefinition.structures.filter((({structureId})=>subsequentStructureIds.includes(structureId))).forEach((structure2=>{const{positionAssignments}=getPositionAssignments$1({structure:structure2}),existingWinnerAssignment=positionAssignments.find((({participantId})=>participantId===existingWinnerParticipantId)),existingLoserAssignment=positionAssignments.find((({participantId})=>participantId===existingLoserParticipantId));existingWinnerAssignment&&(existingWinnerAssignment.participantId=existingLoserParticipantId),existingLoserAssignment&&(existingLoserAssignment.participantId=existingWinnerParticipantId)})),modifyMatchUpScore(params)}(params);const matchUpWinner=winningSide&&!matchUpTieId||params.projectedWinningSide;pushGlobalLog();const result=!activeDownstream&&noDownstreamDependencies(params)||matchUpWinner&&function winningSideWithDownstreamDependencies(params){const{matchUp,winningSide,matchUpTieId,dualWinningSideChange}=params;return winningSide===matchUp.winningSide||matchUpTieId&&!dualWinningSideChange?applyMatchUpValues(params):decorateResult({result:{error:CANNOT_CHANGE_WINNING_SIDE},stack:"winningSideWithDownstreamDependencies",context:{winningSide,matchUp}})}(params)||directingMatchUpStatus&&applyMatchUpValues(params)||{error:NO_VALID_ACTIONS};return decorateResult({result,stack:"setMatchUpStatus"})}function applyMatchUpValues(params){const{tournamentRecord,matchUp,event}=params,removeWinningSide=params.isCollectionMatchUp&&matchUp.winningSide&&!params.winningSide&&!scoreHasValue({score:params.score}),newMatchUpStatus=params.isCollectionMatchUp?params.matchUpStatus||removeWinningSide&&TO_BE_PLAYED||COMPLETED$1:params.matchUpStatus||COMPLETED$1,removeScore=params.removeScore||[CANCELLED$1,WALKOVER$2].includes(newMatchUpStatus)&&![INCOMPLETE,ABANDONED].includes(newMatchUpStatus),result=modifyMatchUpScore(__spreadProps$2b(__spreadValues$3P({},params),{matchUpStatus:newMatchUpStatus,removeWinningSide,removeScore}));if(result.error)return result;if(params.isCollectionMatchUp){const{matchUpTieId,drawDefinition}=params,result2=updateTieMatchUpScore$1({matchUpId:matchUpTieId,tournamentRecord,drawDefinition,event});if(result2.error)return result2}return result}var __defProp$3O=Object.defineProperty,__getOwnPropSymbols$3P=Object.getOwnPropertySymbols,__hasOwnProp$3P=Object.prototype.hasOwnProperty,__propIsEnum$3P=Object.prototype.propertyIsEnumerable,__defNormalProp$3O=(obj,key,value)=>key in obj?__defProp$3O(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3O=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3P.call(b,prop)&&__defNormalProp$3O(a,prop,b[prop]);if(__getOwnPropSymbols$3P)for(var prop of __getOwnPropSymbols$3P(b))__propIsEnum$3P.call(b,prop)&&__defNormalProp$3O(a,prop,b[prop]);return a};function setMatchUpFormat$1(params){const{tournamentRecord,drawDefinition,matchUpFormat,structureId,matchUpId,event}=params;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!matchUpFormat)return{error:MISSING_MATCHUP_FORMAT};if(!isValid(matchUpFormat))return{error:UNRECOGNIZED_MATCHUP_FORMAT};if(matchUpId){const result=findMatchUp$1({drawDefinition,matchUpId,event});if(result.error)return result;const matchUp=result.matchUp;if((null==matchUp?void 0:matchUp.matchUpType)===TEAM$1)return{error:INVALID_MATCHUP,info:"Cannot set matchUpFormat when { matchUpType: TEAM }"};matchUp.matchUpFormat=matchUpFormat,modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,context:"setMatchUpFormat",drawDefinition,matchUp})}else if(structureId){if((null==event?void 0:event.eventType)===TEAM$1)return{error:INVALID_EVENT_TYPE};const result=findStructure({drawDefinition,structureId});if(result.error)return result;if(!result.structure)return{error:STRUCTURE_NOT_FOUND};result.structure.matchUpFormat=matchUpFormat}else drawDefinition&&(drawDefinition.matchUpFormat=matchUpFormat);return modifyDrawNotice({drawDefinition,structureIds:structureId?[structureId]:void 0}),__spreadValues$3O({},SUCCESS)}function matchUpScore({matchUpFormat,matchUpStatus,winningSide,score}={}){if(!score)return{sets:[]};const sets=score.sets||[];let scoreStringSide1=generateScoreString({winnerFirst:!1,matchUpFormat,matchUpStatus,sets}),scoreStringSide2=generateScoreString({winnerFirst:!1,reversed:!0,matchUpFormat,matchUpStatus,sets}),winnerPerspective=generateScoreString({matchUpFormat,matchUpStatus,winningSide,sets}),loserPerspective=scoreStringSide1===winnerPerspective?scoreStringSide2:scoreStringSide1;return winningSide&&(scoreStringSide1=1===winningSide?winnerPerspective:loserPerspective,scoreStringSide2=2===winningSide?winnerPerspective:loserPerspective),{score:{sets,scoreStringSide1,scoreStringSide2}}}var __defProp$3N=Object.defineProperty,__getOwnPropSymbols$3O=Object.getOwnPropertySymbols,__hasOwnProp$3O=Object.prototype.hasOwnProperty,__propIsEnum$3O=Object.prototype.propertyIsEnumerable,__defNormalProp$3N=(obj,key,value)=>key in obj?__defProp$3N(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3N=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3O.call(b,prop)&&__defNormalProp$3N(a,prop,b[prop]);if(__getOwnPropSymbols$3O)for(var prop of __getOwnPropSymbols$3O(b))__propIsEnum$3O.call(b,prop)&&__defNormalProp$3N(a,prop,b[prop]);return a};function setMatchUpStatus$1(params){var _a;const{policyDefinitions,tournamentRecords,tournamentRecord,disableAutoCalc,enableAutoCalc,drawDefinition,matchUpFormat,matchUpId,schedule,event,notes}=params;if(!drawDefinition)return{error:MISSING_DRAW_ID};if(!matchUpId)return{error:MISSING_MATCHUP_ID};const{policy}=findPolicy({policyType:POLICY_TYPE_SCORING,tournamentRecord,event}),allowChangePropagation=void 0!==params.allowChangePropagation&&params.allowChangePropagation||void 0!==(null==policy?void 0:policy.allowChangePropagation)&&policy.allowChangePropagation||void 0;let{outcome}=params;if(matchUpFormat){const result=setMatchUpFormat$1({tournamentRecord,drawDefinition,matchUpFormat,matchUpId,event});if(result.error)return result}if((null==(_a=null==outcome?void 0:outcome.score)?void 0:_a.sets)&&!outcome.score.scoreStringSide1){const{score:scoreObject}=matchUpScore(outcome);outcome.score=scoreObject,outcome.score.sets=outcome.score.sets.filter((set=>set.side1Score||set.side2Score||set.side1TiebreakScore||set.side2TiebreakScore))}return setMatchUpStatus$2({matchUpStatusCodes:null==outcome?void 0:outcome.matchUpStatusCodes,matchUpStatus:null==outcome?void 0:outcome.matchUpStatus,winningSide:null==outcome?void 0:outcome.winningSide,allowChangePropagation,score:null==outcome?void 0:outcome.score,policyDefinitions,tournamentRecords,tournamentRecord,disableAutoCalc,enableAutoCalc,drawDefinition,matchUpFormat,matchUpId,schedule,event,notes})}function bulkMatchUpStatusUpdate$1(params){if(!params.tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{tournamentRecords,tournamentRecord,outcomes}=params,events={};outcomes.forEach((outcome=>{const{eventId}=outcome;events[eventId]||(events[eventId]=[]),events[eventId].push(outcome)}));for(const eventId of Object.keys(events)){const{event}=findEvent({tournamentRecord,eventId});for(const outcome of events[eventId]){const{drawId}=outcome,drawDefinition=event.drawDefinitions.find((drawDefinition2=>drawDefinition2.drawId===drawId));if(drawDefinition){const{matchUpFormat,matchUpId}=outcome,result=setMatchUpStatus$1({schedule:null==outcome?void 0:outcome.schedule,tournamentRecords,tournamentRecord,drawDefinition,matchUpFormat,matchUpId,outcome,drawId,event});if(result.error)return result}}}return __spreadValues$3N({},SUCCESS)}var __defProp$3M=Object.defineProperty,__defProps$2a=Object.defineProperties,__getOwnPropDescs$2a=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3N=Object.getOwnPropertySymbols,__hasOwnProp$3N=Object.prototype.hasOwnProperty,__propIsEnum$3N=Object.prototype.propertyIsEnumerable,__defNormalProp$3M=(obj,key,value)=>key in obj?__defProp$3M(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3M=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3N.call(b,prop)&&__defNormalProp$3M(a,prop,b[prop]);if(__getOwnPropSymbols$3N)for(var prop of __getOwnPropSymbols$3N(b))__propIsEnum$3N.call(b,prop)&&__defNormalProp$3M(a,prop,b[prop]);return a};function courtGridRows({courtPrefix="C|",minRowsCount,courtsData}){if(!Array.isArray(courtsData))return{error:INVALID_VALUES};const maxCourtOrder=null==courtsData?void 0:courtsData.reduce(((order,court)=>{const matchUps=court.matchUps||[],courtOrder=Math.max(0,...matchUps.map((m=>m.schedule.courtOrder||0)));return courtOrder>order?courtOrder:order}),1),rowBuilder=generateRange(0,minRowsCount?Math.max(minRowsCount,maxCourtOrder):maxCourtOrder).map((rowIndex=>({matchUps:generateRange(0,courtsData.length).map((courtIndex=>{const courtInfo=courtsData[courtIndex],{courtId,venueId}=courtInfo;return{schedule:{courtOrder:rowIndex+1,venueId,courtId}}}))})));return courtsData.forEach(((courtInfo,i)=>{var _a;for(const matchUp of courtInfo.matchUps){const courtOrder=null==(_a=matchUp.schedule)?void 0:_a.courtOrder;courtOrder&&(rowBuilder[courtOrder-1].matchUps[i]=matchUp)}})),{courtPrefix,rows:rowBuilder.map(((row,i)=>Object.assign({rowId:`rowId-${i+1}`},...row.matchUps.map(((matchUp,i2)=>({[`${courtPrefix}${i2}`]:matchUp}))))))}}var __defProp$3L=Object.defineProperty,__defProps$29=Object.defineProperties,__getOwnPropDescs$29=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3M=Object.getOwnPropertySymbols,__hasOwnProp$3M=Object.prototype.hasOwnProperty,__propIsEnum$3M=Object.prototype.propertyIsEnumerable,__defNormalProp$3L=(obj,key,value)=>key in obj?__defProp$3L(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3L=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3M.call(b,prop)&&__defNormalProp$3L(a,prop,b[prop]);if(__getOwnPropSymbols$3M)for(var prop of __getOwnPropSymbols$3M(b))__propIsEnum$3M.call(b,prop)&&__defNormalProp$3L(a,prop,b[prop]);return a},__spreadProps$29=(a,b)=>__defProps$29(a,__getOwnPropDescs$29(b));function addDrawDefinition$1({flight:flightDefinition,suppressNotifications,modifyEventEntries,existingDrawCount,allowReplacement,checkEntryStatus,tournamentRecord,drawDefinition,event}){var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k;if(!drawDefinition)return{error:MISSING_DRAW_ID};if(!event)return{error:MISSING_EVENT};event.drawDefinitions||(event.drawDefinitions=[]);const{drawId,drawName,entries:drawEntries}=drawDefinition,{entries:eventEntries}=event;let modifiedEventEntryStatusCount=0;if(void 0!==existingDrawCount&&existingDrawCount!==event.drawDefinitions.length)return{error:INVALID_VALUES,info:"drawDefintions count mismatch"};const{flightProfile}=getFlightProfile({event}),relevantFlight=flightDefinition&&(null==(_a=null==flightProfile?void 0:flightProfile.flights)?void 0:_a.find((flight2=>flight2.flightNumber===flightDefinition.flightNumber))),sourceDrawId=null==(_d=null==(_c=null==(_b=null==flightProfile?void 0:flightProfile.links)?void 0:_b.find((link=>{var _a2;return(null==(_a2=null==link?void 0:link.target)?void 0:_a2.drawId)===drawId})))?void 0:_c.source)?void 0:_d.drawId;if(sourceDrawId&&!event.drawDefinitions.find((drawDefinition2=>drawDefinition2.drawId===sourceDrawId)))return{error:MISSING_DRAW_DEFINITION,sourceDrawId};if(relevantFlight&&relevantFlight.drawId!==drawDefinition.drawId)return{error:INVALID_DRAW_DEFINITION,relevantFlight};const drawEntriesPresentInFlight=drawEntries.every((({participantId,entryStatus})=>{const flightEntry=null==relevantFlight?void 0:relevantFlight.drawEntries.find((entry=>entry.participantId===participantId));return!entryStatus||(null==flightEntry?void 0:flightEntry.entryStatus)===entryStatus})),matchingEventEntries=!checkEntryStatus||eventEntries&&(null==drawEntries?void 0:drawEntries.every((({participantId,entryStatus,entryStage})=>{const eventEntry=eventEntries.find((eventEntry2=>eventEntry2.participantId===participantId&&(!eventEntry2.entryStage||eventEntry2.entryStage===entryStage)));return(null==eventEntry?void 0:eventEntry.entryStatus)===entryStatus})));if(relevantFlight&&!drawEntriesPresentInFlight)return decorateResult({result:{error:INVALID_DRAW_DEFINITION,context:{drawEntriesPresentInFlight,matchingEventEntries,relevantFlight},info:"Draw entries are not present in flight or do not match entryStatuses"}});if(modifyEventEntries&&drawEntries.filter(Boolean).forEach((drawEntry=>{if(STRUCTURE_SELECTED_STATUSES.includes(null==drawEntry?void 0:drawEntry.entryStatus)){const eventEntry=eventEntries.filter(Boolean).find((eventEntry2=>eventEntry2.participantId===drawEntry.participantId));drawEntry.entryStatus&&eventEntry.entryStatus!==drawEntry.entryStatus&&(eventEntry.entryStatus=drawEntry.entryStatus,modifiedEventEntryStatusCount+=1)}})),eventEntries&&!matchingEventEntries)return decorateResult({result:{error:INVALID_DRAW_DEFINITION,context:{matchingEventEntries,eventEntries},info:"Draw entries do not match event entryStatuses"}});const flightNumbers=(null==(_f=null==(_e=null==flightProfile?void 0:flightProfile.flights)?void 0:_e.map((({flightNumber})=>!isNaN(flightNumber)&&parseInt(flightNumber))))?void 0:_f.filter(Boolean))||[],drawOrders=(null==(_g=event.drawDefinitions.map((({drawOrder:drawOrder2})=>!isNaN(drawOrder2)&&parseInt(drawOrder2))))?void 0:_g.filter(Boolean))||[];let drawOrder=Math.max(0,...drawOrders,...flightNumbers)+1;const flight=null==(_h=null==flightProfile?void 0:flightProfile.flights)?void 0:_h.find((flight2=>flight2.drawId===drawId));let extension;if(flight){flight.drawName=drawDefinition.drawName,extension={name:FLIGHT_PROFILE,value:__spreadProps$29(__spreadValues$3L({},flightProfile),{flights:flightProfile.flights})};const flightNumber=flight.flightNumber;flightNumber&&!drawOrders.includes(flightNumber)?drawOrder=flightNumber:flight.flightNumber=drawOrder}else{const flights=(null==flightProfile?void 0:flightProfile.flights)||[];flights.push({manuallyAdded:!0,flightNumber:drawOrder,drawEntries,drawName,drawId}),extension={name:FLIGHT_PROFILE,value:__spreadProps$29(__spreadValues$3L({},flightProfile||{}),{flights})}}addEventExtension$1({event,extension}),Object.assign(drawDefinition,{drawOrder});const existingDrawDefinition=event.drawDefinitions.find((drawDefinition2=>drawDefinition2.drawId===drawId)),tournamentId=null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId=event.eventId;if(existingDrawDefinition){if(!allowReplacement)return{error:DRAW_ID_EXISTS};const existingMatchUps=null==(_i=allDrawMatchUps$1({drawDefinition:existingDrawDefinition}))?void 0:_i.matchUps,existingMatchUpIds=null==existingMatchUps?void 0:existingMatchUps.map(getMatchUpId),incomingMatchUps=null==(_j=allDrawMatchUps$1({drawDefinition}))?void 0:_j.matchUps;if(!suppressNotifications){(null==existingMatchUpIds?void 0:existingMatchUpIds.length)&&deleteMatchUpsNotice({matchUpIds:existingMatchUpIds,action:"modifyDrawDefinition",tournamentId,eventId}),(null==incomingMatchUps?void 0:incomingMatchUps.length)&&addMatchUpsNotice({matchUps:incomingMatchUps,tournamentId,eventId}),event.drawDefinitions=event.drawDefinitions.map((d=>d.drawId===drawId?drawDefinition:d));const structureIds=null==(_k=drawDefinition.structures)?void 0:_k.map((({structureId})=>structureId));modifyDrawNotice({drawDefinition,tournamentId,structureIds,eventId})}}else if(event.drawDefinitions.push(drawDefinition),!suppressNotifications){const{matchUps}=allDrawMatchUps$1({drawDefinition,event});addMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUps}),addDrawNotice({drawDefinition,tournamentId,eventId})}return __spreadProps$29(__spreadValues$3L({},SUCCESS),{modifiedEventEntryStatusCount})}var __defProp$3K=Object.defineProperty,__defProps$28=Object.defineProperties,__getOwnPropDescs$28=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3L=Object.getOwnPropertySymbols,__hasOwnProp$3L=Object.prototype.hasOwnProperty,__propIsEnum$3L=Object.prototype.propertyIsEnumerable,__defNormalProp$3K=(obj,key,value)=>key in obj?__defProp$3K(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3K=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3L.call(b,prop)&&__defNormalProp$3K(a,prop,b[prop]);if(__getOwnPropSymbols$3L)for(var prop of __getOwnPropSymbols$3L(b))__propIsEnum$3L.call(b,prop)&&__defNormalProp$3K(a,prop,b[prop]);return a},__spreadProps$28=(a,b)=>__defProps$28(a,__getOwnPropDescs$28(b));function addParticipant$1({allowDuplicateParticipantIdPairs,returnParticipant,tournamentRecord,disableNotice,pairOverride,participant}){const stack="addParticipant";if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participant)return decorateResult({result:{error:MISSING_PARTICIPANT},stack});participant.participantId||(participant.participantId=UUID()),tournamentRecord.participants||(tournamentRecord.participants=[]);const{participantId,individualParticipantIds}=participant;if(tournamentRecord.participants.reduce(((p,c)=>c.participantId===participantId||p),!1))return{error:PARTICIPANT_ID_EXISTS};const{participantType,participantRole}=participant;if(!Object.keys(participantTypes).includes(participantType))return{error:INVALID_PARTICIPANT_TYPE,participantType};if(!participantRole)return{error:MISSING_PARTICIPANT_ROLE};const tournamentParticipants=tournamentRecord.participants||[],tournamentIndividualParticipantIds=tournamentParticipants.filter((tournamentParticipant=>tournamentParticipant.participantType===INDIVIDUAL)).map((individualParticipant=>individualParticipant.participantId));if(participantType!==INDIVIDUAL&&participant.person)return{error:INVALID_VALUES,person:participant.person};if(individualParticipantIds&&!Array.isArray(individualParticipantIds))return{error:INVALID_VALUES,individualParticipantIds};if(participantType===PAIR){if(participant.person)return{error:INVALID_VALUES,person:participant.person};if(!participant.individualParticipantIds)return decorateResult({result:{error:MISSING_PARTICIPANT_IDS},stack});if(2!==participant.individualParticipantIds.length&&!pairOverride)return decorateResult({result:{error:INVALID_PARTICIPANT_IDS,info:"PAIR must be 2 individualParticipantIds"},stack});{const individualParticipantIds2=tournamentParticipants.filter((participant2=>participant2.participantType===INDIVIDUAL)).map((participant2=>participant2.participantId));if(!Array.isArray(participant.individualParticipantIds))return decorateResult({result:{error:INVALID_PARTICIPANT_IDS},stack});if(!participant.individualParticipantIds.reduce(((valid,participantId2)=>individualParticipantIds2.includes(participantId2)&&valid),!0))return decorateResult({result:{error:INVALID_PARTICIPANT_IDS},stack})}const existingPairParticipants=tournamentParticipants.filter((participant2=>participant2.participantType===PAIR)).map((participant2=>({individualParticipantIds:participant2.individualParticipantIds,participant:participant2}))),existingPairParticipant=participant.participantType===PAIR&&existingPairParticipants.find((existingPairParticipant2=>2===intersection(existingPairParticipant2.individualParticipantIds,participant.individualParticipantIds).length));if(existingPairParticipant&&!allowDuplicateParticipantIdPairs)return __spreadProps$28(__spreadValues$3K({},SUCCESS),{existingParticipant:!0,participant:returnParticipant&&makeDeepCopy(existingPairParticipant.participant)});if(!participant.participantName){const individualParticipants=tournamentParticipants.filter((tournamentParticipant=>participant.individualParticipantIds.includes(tournamentParticipant.participantId)));let participantName=individualParticipants.map((participant2=>{var _a;return null==(_a=participant2.person)?void 0:_a.standardFamilyName})).filter(Boolean).join("/");1===individualParticipants.length&&(participantName+="/Unknown"),participant.participantName=participantName}}else if(participantType===INDIVIDUAL){if(!participant.person||!participant.person.standardFamilyName||!participant.person.standardGivenName)return{error:MISSING_PERSON_DETAILS};if(!participant.participantName){const participantName=`${participant.person.standardFamilyName.toUpperCase()}, ${participant.person.standardGivenName}`;participant.participantName=participantName,participant.name=participantName}}else{if(![TEAM,GROUP].includes(participantType))return{error:INVALID_PARTICIPANT_TYPE};if(individualParticipantIds||(participant.individualParticipantIds=[]),participant.individualParticipantIds.length)for(const individualParticipantId of participant.individualParticipantIds){if("string"!=typeof individualParticipantId)return decorateResult({result:{participantId:individualParticipantId,error:INVALID_VALUES},stack});if(!tournamentIndividualParticipantIds.includes(individualParticipantId))return decorateResult({result:{participantId:individualParticipantId,error:PARTICIPANT_NOT_FOUND},stack})}}tournamentRecord.participants.push(participant),disableNotice||addNotice({payload:{tournamentId:tournamentRecord.tournamentId,participants:[participant]},topic:ADD_PARTICIPANTS});return definedAttributes(__spreadValues$3K({participant:returnParticipant&&makeDeepCopy(participant)},SUCCESS))}function addParticipants({allowDuplicateParticipantIdPairs,returnParticipants,participants=[],tournamentRecord}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};tournamentRecord.participants||(tournamentRecord.participants=[]);const existingParticipantIds=tournamentRecord.participants.map((p=>p.participantId))||[];participants.forEach((participant=>{participant.participantId||(participant.participantId=UUID())}));const newParticipants=participants.filter((participant=>!existingParticipantIds.includes(participant.participantId))),notAdded=participants.filter((participant=>existingParticipantIds.includes(participant.participantId))),individualParticipants=newParticipants.filter((participant=>participant.participantType===INDIVIDUAL)),groupedParticipants=newParticipants.filter((participant=>participant.participantType!==INDIVIDUAL)),participantsToAdd=individualParticipants.concat(...groupedParticipants),addedParticipants=[];if(participantsToAdd.length){for(const participant of participantsToAdd){const result2=addParticipant$1({allowDuplicateParticipantIdPairs,returnParticipant:!0,disableNotice:!0,tournamentRecord,participant});if(result2.error)return result2;result2.success&&!result2.existingParticipant&&addedParticipants.push(result2.participant)}addedParticipants.length&&addNotice({topic:ADD_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:addedParticipants}});const result=__spreadValues$3K({participants:returnParticipants&&makeDeepCopy(addedParticipants),addedCount:addedParticipants.length},SUCCESS);return notAdded.length&&Object.assign(result,{notAdded,info:EXISTING_PARTICIPANT}),definedAttributes(result)}return __spreadValues$3K({info:"No new participants to add",addedCount:0},SUCCESS)}function getEventPublishStatuses({event}){var _a;const itemType=`${PUBLISH}.${STATUS$1}`,{timeItem}=getTimeItem({element:event,itemType});if(null==(_a=null==timeItem?void 0:timeItem.itemValue)?void 0:_a.PUBLIC){const{drawIds:publishedDrawIds=[],seeding}=timeItem.itemValue.PUBLIC||{},publishedSeeding={published:void 0,seedingScaleNames:[],drawIds:[]};return seeding&&Object.assign(publishedSeeding,timeItem.itemValue.PUBLIC.seeding),{publishedDrawIds,publishedSeeding}}}function getAccessorValue({element,accessor}){if("string"!=typeof accessor)return{values:[]};const targetElement=makeDeepCopy(element),attributes=accessor.split(".");let value,values=[];!function processKeys({targetElement:targetElement2,attributes:attributes2=[],significantCharacters}){for(const[index,attribute]of attributes2.entries())if(targetElement2&&targetElement2[attribute])if(Array.isArray(targetElement2[attribute])){const values2=targetElement2[attribute],remainingKeys=attributes2.slice(index);values2.forEach((nestedTarget=>processKeys({targetElement:nestedTarget,attributes:remainingKeys})))}else checkValue({targetElement:targetElement2=targetElement2[attribute],index});function checkValue({targetElement:targetElement3,index}){if(targetElement3&&index===attributes2.length-1&&["string","number"].includes(typeof targetElement3)){const extractedValue=significantCharacters?targetElement3.slice(0,significantCharacters):targetElement3;value?values.includes(extractedValue)||values.push(extractedValue):(value=extractedValue,values.push(extractedValue))}}}({targetElement,attributes});const result={value};return values.length&&(result.values=values),result}function participantScaleItem({requireTimeStamp,scaleAttributes,participant}){var _a;if(!participant)return{error:MISSING_PARTICIPANT};if("object"!=typeof scaleAttributes)return{error:INVALID_VALUES};if(participant.timeItems||(participant.timeItems=[]),participant&&Array.isArray(participant.timeItems)){const{accessor,scaleType,eventType,scaleName}=scaleAttributes,filterType=[SCALE$1,scaleType,eventType,scaleName].join("."),timeItem=participant.timeItems.filter((timeItem2=>(null==timeItem2?void 0:timeItem2.itemType)===filterType)).filter((timeItem2=>!requireTimeStamp||(null==timeItem2?void 0:timeItem2.itemDate))).sort(((a,b)=>(a.createdAt?new Date(a.createdAt).getTime():0)-(b.createdAt?new Date(b.createdAt).getTime():0))).pop();if(timeItem){const[itemSubject,scaleType2,eventType2,scaleName2]=(null==(_a=timeItem.itemType)?void 0:_a.split("."))||[];if(itemSubject!==SCALE$1)return{error:INVALID_SCALE_ITEM};const accessorValue=accessor&&getAccessorValue({element:timeItem.itemValue,accessor}),scaleValue=(null==accessorValue?void 0:accessorValue.value)||timeItem.itemValue;return{scaleItem:{scaleDate:timeItem.itemDate,scaleName:scaleName2,scaleType:scaleType2,eventType:eventType2,scaleValue}}}return{error:SCALE_ITEM_NOT_FOUND}}return{error:MISSING_PARTICIPANT}}function getEventSeedAssignments({publishedSeeding,usePublishState,withSeeding,participant,event}){var _a,_b,_c;const eventSeedAssignments={},getScaleAccessor=scaleName=>[SCALE$1,SEEDING$1,event.eventType,scaleName].join("."),seedingScales=Object.assign({},...(participant.timeItems||[]).filter((({itemType})=>itemType.split(".")[1]===SEEDING$1)).map((({itemType:seedingScaleName,itemValue:seedValue})=>({[seedingScaleName]:seedValue})))),eventSeedingScaleNames=((null==publishedSeeding?void 0:publishedSeeding.stageSeedingScaleNames)&&Object.values(null==publishedSeeding?void 0:publishedSeeding.stageSeedingScaleNames)||Array.isArray(null==publishedSeeding?void 0:publishedSeeding.seedingScaleNames)&&publishedSeeding.seedingScaleNames||[]).map(getScaleAccessor),publishedEventSeedingScaleNames=intersection(Object.keys(seedingScales),eventSeedingScaleNames);if(!(usePublishState&&(Object.keys(seedingScales).length||(null==(_a=null==publishedSeeding?void 0:publishedSeeding.drawIds)?void 0:_a.length))&&!publishedEventSeedingScaleNames.length)&&publishedEventSeedingScaleNames.length){if(null==publishedSeeding?void 0:publishedSeeding.stageSeedingScaleNames){const scaleValues=Object.keys(publishedSeeding.stageSeedingScaleNames).map((key=>{const accessor=getScaleAccessor(publishedSeeding.stageSeedingScaleNames[key]);return[key,seedingScales[accessor]]})).filter((pair=>pair[1])).map((pair=>({[pair[0]]:{seedValue:pair[1]}}))),seedAssignments=Object.assign({},...scaleValues);eventSeedAssignments.seedAssignments=seedAssignments}else if(publishedEventSeedingScaleNames){const seedValues=publishedEventSeedingScaleNames.map((scaleName=>seedingScales[scaleName]));eventSeedAssignments.seedValue=seedValues.pop()}}else if(usePublishState||"object"!=typeof withSeeding){const{categoryName,ageCategoryCode}=event.category||{};let scaleItem;for(const scaleName of[ageCategoryCode,event.eventId,categoryName]){const result=participantScaleItem({scaleAttributes:{eventType:event.eventType,scaleType:SEEDING$1,scaleName},participant});if(result.scaleItem){scaleItem=result.scaleItem;break}}if(scaleItem){if(!usePublishState||(null==publishedSeeding?void 0:publishedSeeding.published)&&!(null==(_c=null==(_b=null==publishedSeeding?void 0:publishedSeeding.published)?void 0:_b.drawIds)?void 0:_c.length)){const seedValue=scaleItem.scaleValue;eventSeedAssignments.seedValue=seedValue}}}else{const scaleValues=Object.keys(withSeeding).map((key=>{const accessor=getScaleAccessor(withSeeding[key]);return[key,seedingScales[accessor]]})).filter((pair=>pair[1])).map((pair=>({[pair[0]]:{seedValue:pair[1]}}))),seedAssignments=Object.assign({},...scaleValues);eventSeedAssignments.seedAssignments=seedAssignments}return eventSeedAssignments}var __defProp$3J=Object.defineProperty,__defProps$27=Object.defineProperties,__getOwnPropDescs$27=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3K=Object.getOwnPropertySymbols,__hasOwnProp$3K=Object.prototype.hasOwnProperty,__propIsEnum$3K=Object.prototype.propertyIsEnumerable,__defNormalProp$3J=(obj,key,value)=>key in obj?__defProp$3J(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3J=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3K.call(b,prop)&&__defNormalProp$3J(a,prop,b[prop]);if(__getOwnPropSymbols$3K)for(var prop of __getOwnPropSymbols$3K(b))__propIsEnum$3K.call(b,prop)&&__defNormalProp$3J(a,prop,b[prop]);return a},__spreadProps$27=(a,b)=>__defProps$27(a,__getOwnPropDescs$27(b));function getModifiedMatchUpFormatTiming({tournamentRecord,matchUpFormat,event}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!isValid(matchUpFormat))return{error:UNRECOGNIZED_MATCHUP_FORMAT};const{extension:eventExtension}=findEventExtension({event,name:SCHEDULE_TIMING}),eventScheduling=null==eventExtension?void 0:eventExtension.value,{extension:tournamentExtension}=findTournamentExtension({tournamentRecord,name:SCHEDULE_TIMING}),tournamentScheduling=null==tournamentExtension?void 0:tournamentExtension.value;return{matchUpFormat,averageTimes:[(null==eventScheduling?void 0:eventScheduling.matchUpAverageTimes)&&findMatchupFormatAverageTimes(__spreadProps$27(__spreadValues$3J({},eventScheduling),{matchUpFormat})),(null==tournamentScheduling?void 0:tournamentScheduling.matchUpAverageTimes)&&findMatchupFormatAverageTimes(__spreadProps$27(__spreadValues$3J({},tournamentScheduling),{matchUpFormat}))].find((f=>f)),recoveryTimes:[(null==eventScheduling?void 0:eventScheduling.matchUpRecoveryTimes)&&findMatchupFormatRecoveryTimes(__spreadProps$27(__spreadValues$3J({},eventScheduling),{matchUpFormat})),(null==tournamentScheduling?void 0:tournamentScheduling.matchUpRecoveryTimes)&&findMatchupFormatRecoveryTimes(__spreadProps$27(__spreadValues$3J({},tournamentScheduling),{matchUpFormat}))].find((f=>f))}}var __defProp$3I=Object.defineProperty,__defProps$26=Object.defineProperties,__getOwnPropDescs$26=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3J=Object.getOwnPropertySymbols,__hasOwnProp$3J=Object.prototype.hasOwnProperty,__propIsEnum$3J=Object.prototype.propertyIsEnumerable,__defNormalProp$3I=(obj,key,value)=>key in obj?__defProp$3I(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3I=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3J.call(b,prop)&&__defNormalProp$3I(a,prop,b[prop]);if(__getOwnPropSymbols$3J)for(var prop of __getOwnPropSymbols$3J(b))__propIsEnum$3J.call(b,prop)&&__defNormalProp$3I(a,prop,b[prop]);return a},__spreadProps$26=(a,b)=>__defProps$26(a,__getOwnPropDescs$26(b));function modifyMatchUpFormatTiming$1({tournamentRecord,matchUpFormat,averageTimes,recoveryTimes,event}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(averageTimes&&!Array.isArray(averageTimes))return{error:INVALID_VALUES};if(recoveryTimes&&!Array.isArray(recoveryTimes))return{error:INVALID_VALUES};const name=SCHEDULE_TIMING;if(event){const{extension}=findEventExtension({event,name}),eventScheduling=(null==extension?void 0:extension.value)||{};addEventExtension$1({event,extension:{name,value:modifyScheduling(__spreadProps$26(__spreadValues$3I({},eventScheduling),{matchUpFormat,averageTimes,recoveryTimes}))}})}else{const{extension}=findTournamentExtension({tournamentRecord,name}),tournamentScheduling=(null==extension?void 0:extension.value)||{};addTournamentExtension({tournamentRecord,extension:{name,value:modifyScheduling(__spreadProps$26(__spreadValues$3I({},tournamentScheduling),{matchUpFormat,averageTimes,recoveryTimes}))}})}return __spreadValues$3I({},SUCCESS)}function modifyScheduling({matchUpAverageTimes=[],matchUpRecoveryTimes=[],averageTimes:formatAverageTimes,recoveryTimes:formatRecoveryTimes,matchUpFormat}){const updatedMatchUpAverageTimes=(null==(formatAverageTimes=(formatAverageTimes||[]).filter((averageTime=>{var _a,_b;return(null==(_a=null==averageTime?void 0:averageTime.categoryNames)?void 0:_a.length)||(null==(_b=null==averageTime?void 0:averageTime.categoryTypes)?void 0:_b.length)})))?void 0:formatAverageTimes.length)&&matchUpAverageTimes.map((definition=>{var _a;return(null==definition?void 0:definition.matchUpFormatCodes.includes(matchUpFormat))?__spreadProps$26(__spreadValues$3I({},definition),{matchUpFormatCodes:null==(_a=definition.matchUpFormatCodes)?void 0:_a.filter((code=>code!==matchUpFormat))}):definition})).filter((({matchUpFormatCodes})=>null==matchUpFormatCodes?void 0:matchUpFormatCodes.length)).concat({matchUpFormatCodes:[matchUpFormat],averageTimes:formatAverageTimes}),updatedMatchUpRecoveryTimes=(null==(formatRecoveryTimes=(formatRecoveryTimes||[]).filter((recoveryTime=>{var _a,_b;return(null==(_a=null==recoveryTime?void 0:recoveryTime.categoryNames)?void 0:_a.length)||(null==(_b=null==recoveryTime?void 0:recoveryTime.categoryTypes)?void 0:_b.length)})))?void 0:formatRecoveryTimes.length)&&matchUpRecoveryTimes.map((definition=>{var _a;return(null==definition?void 0:definition.matchUpFormatCodes.includes(matchUpFormat))?__spreadProps$26(__spreadValues$3I({},definition),{matchUpFormatCodes:null==(_a=definition.matchUpFormatCodes)?void 0:_a.filter((code=>code!==matchUpFormat))}):definition})).filter((({matchUpFormatCodes,averageTimes})=>(null==matchUpFormatCodes?void 0:matchUpFormatCodes.length)||averageTimes)).concat({matchUpFormatCodes:[matchUpFormat],recoveryTimes:formatRecoveryTimes});return{matchUpAverageTimes:(null==updatedMatchUpAverageTimes?void 0:updatedMatchUpAverageTimes.length)&&updatedMatchUpAverageTimes||matchUpAverageTimes,matchUpRecoveryTimes:(null==updatedMatchUpRecoveryTimes?void 0:updatedMatchUpRecoveryTimes.length)&&updatedMatchUpRecoveryTimes||matchUpRecoveryTimes}}function modifyEventMatchUpFormatTiming$1({tournamentRecord,recoveryMinutes,averageMinutes,matchUpFormat,categoryType,event}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!isValid(matchUpFormat))return{error:INVALID_VALUES};if(!event)return{error:MISSING_EVENT};const{averageTimes=[],recoveryTimes=[]}=getModifiedMatchUpFormatTiming({tournamentRecord,matchUpFormat,event}),category=event.category,categoryName=(null==category?void 0:category.categoryName)||(null==category?void 0:category.ageCategoryCode)||(null==event?void 0:event.eventId);let currentAverageTime={categoryNames:[categoryName],minutes:{}},currentRecoveryTime={categoryNames:[categoryName],minutes:{}};const newTiming=timing=>{var _a,_b;if((null==(_a=timing.categoryTypes)?void 0:_a.includes(categoryType))&&console.log("encountered:",{categoryType}),!(null==(_b=timing.categoryNames)?void 0:_b.includes(categoryName))||(timing.categoryNames=timing.categoryNames.filter((c=>c!==categoryName)),currentAverageTime={minutes:timing.minutes,categoryNames:[categoryName]},timing.categoryNames.length))return timing},validAverageMinutes=!isNaN(parseInt(averageMinutes)),validRecoveryMinutes=!isNaN(parseInt(recoveryMinutes)),newAverageTimes=averageTimes.map(newTiming).filter((f=>{var _a;return null==(_a=null==f?void 0:f.categoryNames)?void 0:_a.length})),newRecoveryTimes=recoveryTimes.map(newTiming).filter((f=>{var _a;return null==(_a=null==f?void 0:f.categoryNames)?void 0:_a.length}));return validAverageMinutes&&(Object.assign(currentAverageTime.minutes,{[(null==event?void 0:event.eventType)||SINGLES$1]:averageMinutes}),newAverageTimes.push(currentAverageTime)),validRecoveryMinutes&&(Object.assign(currentRecoveryTime.minutes,{[(null==event?void 0:event.eventType)||SINGLES$1]:recoveryMinutes}),newRecoveryTimes.push(currentRecoveryTime)),validAverageMinutes||validRecoveryMinutes?modifyMatchUpFormatTiming$1({tournamentRecord,event,matchUpFormat,averageTimes:validAverageMinutes&&newAverageTimes,recoveryTimes:validRecoveryMinutes&&newRecoveryTimes}):{error:INVALID_VALUES}}const hasSchedule=({scheduleAttributes=["scheduledDate","scheduledTime"],schedule={}})=>!!Object.keys(schedule).filter((key=>scheduleAttributes.includes(key))).filter((key=>schedule[key])).length;var __defProp$3H=Object.defineProperty,__defProps$25=Object.defineProperties,__getOwnPropDescs$25=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3I=Object.getOwnPropertySymbols,__hasOwnProp$3I=Object.prototype.hasOwnProperty,__propIsEnum$3I=Object.prototype.propertyIsEnumerable,__defNormalProp$3H=(obj,key,value)=>key in obj?__defProp$3H(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3H=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3I.call(b,prop)&&__defNormalProp$3H(a,prop,b[prop]);if(__getOwnPropSymbols$3I)for(var prop of __getOwnPropSymbols$3I(b))__propIsEnum$3I.call(b,prop)&&__defNormalProp$3H(a,prop,b[prop]);return a},__spreadProps$25=(a,b)=>__defProps$25(a,__getOwnPropDescs$25(b));function getTournamentInfo({tournamentRecord}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const tournamentInfo=(({tournamentId,tournamentRank,tournamentStatus,formalName,tournamentName,promotionalName,onlineResources,localTimeZone,startDate,endDate,hostCountryCode,tournamentContacts,tournamentAddresses})=>({tournamentId,tournamentRank,tournamentStatus,formalName,tournamentName,promotionalName,onlineResources,localTimeZone,startDate,endDate,hostCountryCode,tournamentContacts,tournamentAddresses}))(tournamentRecord);return __spreadProps$25(__spreadValues$3H({},SUCCESS),{tournamentInfo:makeDeepCopy(tournamentInfo,!1,!0)})}var __defProp$3G=Object.defineProperty,__getOwnPropSymbols$3H=Object.getOwnPropertySymbols,__hasOwnProp$3H=Object.prototype.hasOwnProperty,__propIsEnum$3H=Object.prototype.propertyIsEnumerable,__defNormalProp$3G=(obj,key,value)=>key in obj?__defProp$3G(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3G=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3H.call(b,prop)&&__defNormalProp$3G(a,prop,b[prop]);if(__getOwnPropSymbols$3H)for(var prop of __getOwnPropSymbols$3H(b))__propIsEnum$3H.call(b,prop)&&__defNormalProp$3G(a,prop,b[prop]);return a},__objRest$a=(source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$3H.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols$3H)for(var prop of __getOwnPropSymbols$3H(source))exclude.indexOf(prop)<0&&__propIsEnum$3H.call(source,prop)&&(target[prop]=source[prop]);return target};function getDerivedPositionAssignments({derivedDrawInfo,participantId,drawId}){var _a,_b,_c,_d;const mainPositionAssignment=null==(_b=null==(_a=derivedDrawInfo[drawId])?void 0:_a.mainPositionAssignments)?void 0:_b.find((assignment=>assignment.participantId===participantId)),qualifyingPositionAssignment=null==(_d=null==(_c=derivedDrawInfo[drawId])?void 0:_c.qualifyingPositionAssignments)?void 0:_d.find((assignment=>assignment.participantId===participantId)),positionAssignments={};if(mainPositionAssignment){const _e=mainPositionAssignment,{participantId:participantId2}=_e,props=__objRest$a(_e,["participantId"]);participantId2&&(positionAssignments[MAIN]=__spreadValues$3G({},props))}if(qualifyingPositionAssignment){const _f=qualifyingPositionAssignment,{participantId:participantId2}=_f,props=__objRest$a(_f,["participantId"]);participantId2&&(positionAssignments[QUALIFYING]=__spreadValues$3G({},props))}return Object.keys(positionAssignments).length?positionAssignments:void 0}var __defProp$3F=Object.defineProperty,__getOwnPropSymbols$3G=Object.getOwnPropertySymbols,__hasOwnProp$3G=Object.prototype.hasOwnProperty,__propIsEnum$3G=Object.prototype.propertyIsEnumerable,__defNormalProp$3F=(obj,key,value)=>key in obj?__defProp$3F(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3F=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3G.call(b,prop)&&__defNormalProp$3F(a,prop,b[prop]);if(__getOwnPropSymbols$3G)for(var prop of __getOwnPropSymbols$3G(b))__propIsEnum$3G.call(b,prop)&&__defNormalProp$3F(a,prop,b[prop]);return a},__objRest$9=(source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$3G.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols$3G)for(var prop of __getOwnPropSymbols$3G(source))exclude.indexOf(prop)<0&&__propIsEnum$3G.call(source,prop)&&(target[prop]=source[prop]);return target};function getDerivedSeedAssignments({derivedDrawInfo,participantId,drawId}){var _a,_b,_c,_d;const mainSeedAssignment=null==(_b=null==(_a=derivedDrawInfo[drawId])?void 0:_a.mainSeedAssignments)?void 0:_b.find((assignment=>assignment.participantId===participantId)),qualifyingSeedAssignment=null==(_d=null==(_c=derivedDrawInfo[drawId])?void 0:_c.qualifyingSeedAssignments)?void 0:_d.find((assignment=>assignment.participantId===participantId)),seedAssignments={};if(mainSeedAssignment){const _e=mainSeedAssignment,{participantId:participantId2}=_e,props=__objRest$9(_e,["participantId"]);participantId2&&(seedAssignments[MAIN]=__spreadValues$3F({},props))}if(qualifyingSeedAssignment){const _f=qualifyingSeedAssignment,{participantId:participantId2}=_f,props=__objRest$9(_f,["participantId"]);participantId2&&(seedAssignments[QUALIFYING]=__spreadValues$3F({},props))}return Object.keys(seedAssignments).length?seedAssignments:void 0}function participantScheduledMatchUps({matchUps=[],scheduleAttributes=["scheduledDate","scheduledTime"]}){if(!Array.isArray(matchUps))return{error:MISSING_MATCHUPS};if(!Array.isArray(scheduleAttributes))return{error:INVALID_VALUES};const scheduledMatchUps=matchUps.filter(Boolean).filter((({schedule})=>hasSchedule({schedule,scheduleAttributes}))).reduce(((dateMatchUps,matchUp)=>{const{schedule}=matchUp,date=extractDate(null==schedule?void 0:schedule.scheduledDate),time=extractTime(null==schedule?void 0:schedule.scheduledTime);return date&&time&&(dateMatchUps[date]?dateMatchUps[date].push(matchUp):dateMatchUps[date]=[matchUp]),dateMatchUps}),{});return Object.keys(scheduledMatchUps).forEach((date=>{scheduledMatchUps[date].sort(((a,b)=>{var _a,_b;return timeSort(extractTime(null==(_a=a.schedule)?void 0:_a.scheduledTime),extractTime(null==(_b=b.schedule)?void 0:_b.scheduledTime))}))})),{scheduledMatchUps}}var __defProp$3E=Object.defineProperty,__defProps$24=Object.defineProperties,__getOwnPropDescs$24=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3F=Object.getOwnPropertySymbols,__hasOwnProp$3F=Object.prototype.hasOwnProperty,__propIsEnum$3F=Object.prototype.propertyIsEnumerable,__defNormalProp$3E=(obj,key,value)=>key in obj?__defProp$3E(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3E=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3F.call(b,prop)&&__defNormalProp$3E(a,prop,b[prop]);if(__getOwnPropSymbols$3F)for(var prop of __getOwnPropSymbols$3F(b))__propIsEnum$3F.call(b,prop)&&__defNormalProp$3E(a,prop,b[prop]);return a},__spreadProps$24=(a,b)=>__defProps$24(a,__getOwnPropDescs$24(b));var __defProp$3D=Object.defineProperty,__defProps$23=Object.defineProperties,__getOwnPropDescs$23=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3E=Object.getOwnPropertySymbols,__hasOwnProp$3E=Object.prototype.hasOwnProperty,__propIsEnum$3E=Object.prototype.propertyIsEnumerable,__defNormalProp$3D=(obj,key,value)=>key in obj?__defProp$3D(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3D=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3E.call(b,prop)&&__defNormalProp$3D(a,prop,b[prop]);if(__getOwnPropSymbols$3E)for(var prop of __getOwnPropSymbols$3E(b))__propIsEnum$3E.call(b,prop)&&__defNormalProp$3D(a,prop,b[prop]);return a},__spreadProps$23=(a,b)=>__defProps$23(a,__getOwnPropDescs$23(b));function addParticipantContext(params){var _a,_b;const participantIdsWithConflicts=[],eventsPublishStatuses={},derivedDrawInfo={},participantIdMap={},initializeParticipantId=participantId=>{participantIdMap[participantId]||(participantIdMap[participantId]={groupParticipantIds:[],teamParticipantIds:[],pairParticipantIds:[],potentialMatchUps:{},scheduleItems:[],opponents:{},matchUps:{},events:{},groups:[],teams:[],draws:{},losses:0,wins:0})},{tournamentRecord,participantFilters,allTournamentParticipants}=params,{relevantParticipantIdsMap}=function getRelevantParticipantIdsMap({processParticipantId,tournamentRecords,tournamentRecord}){if("object"!=typeof tournamentRecord&&"object"!=typeof tournamentRecords)return{error:MISSING_TOURNAMENT_RECORD};const allParticipants=tournamentRecords?Object.values(tournamentRecords).map((({participants=[]})=>participants)).flat():tournamentRecord.participants||[];return{relevantParticipantIdsMap:Object.assign({},...allParticipants.map((({participantId,participantType,individualParticipantIds})=>("function"==typeof processParticipantId&&processParticipantId(participantId),{[participantId]:(individualParticipantIds||[]).map((relevantParticipantId=>({participantType:INDIVIDUAL,relevantParticipantId}))).concat({relevantParticipantId:participantId,participantType})}))))}}({processParticipantId:initializeParticipantId,tournamentRecord}),targetParticipantIds=null==participantFilters?void 0:participantFilters.participantIds,getRelevantParticipantIds=participantId=>{const relevantParticipantIds=participantId&&relevantParticipantIdsMap[participantId]||[];return relevantParticipantIds.push(participantId),relevantParticipantIds.some((obj=>!targetParticipantIds||targetParticipantIds.includes(obj.relevantParticipantId)))?relevantParticipantIds:[]};return params.withGroupings&&allTournamentParticipants.forEach((participant=>{var _a2,_b2,_c;if(participant.participantType===GROUP){const groupParticipantId=participant.participantId;null==(_a2=null==participant?void 0:participant.individualParticipantIds)||_a2.forEach((participantId=>{participantIdMap[participantId].groupParticipantIds.includes(groupParticipantId)||(participantIdMap[participantId].groupParticipantIds.push(groupParticipantId),participantIdMap[participantId].groups.push({participantRoleResponsibilities:participant.participantRoleResponsibilities,participantOtherName:participant.participantOtherName,participantName:participant.participantName,participantId:participant.participantId}))}))}if(participant.participantType===TEAM$2){const teamParticipantId=participant.participantId;null==(_b2=null==participant?void 0:participant.individualParticipantIds)||_b2.forEach((participantId=>{var _a3,_b3,_c2,_d;(null==(_b3=null==(_a3=participantIdMap[participantId])?void 0:_a3.teamParticipantIds)?void 0:_b3.includes(teamParticipantId))||(null==(_c2=participantIdMap[participantId])||_c2.teamParticipantIds.push(teamParticipantId),null==(_d=participantIdMap[participantId])||_d.teams.push({participantRoleResponsibilities:participant.participantRoleResponsibilities,participantOtherName:participant.participantOtherName,participantName:participant.participantName,participantId:participant.participantId,teamId:participant.teamId}))}))}if(participant.participantType===PAIR){const pairParticipantId=participant.participantId;null==(_c=null==participant?void 0:participant.individualParticipantIds)||_c.forEach((participantId=>{participantIdMap[participantId]&&!participantIdMap[participantId].pairParticipantIds.includes(pairParticipantId)&&participantIdMap[participantId].pairParticipantIds.push(pairParticipantId)}))}})),params.withMatchUps&&getMatchUpDependencies({tournamentRecord}),(params.withScheduleItems||params.scheduleAnalysis||params.withStatistics||params.withOpponents||params.withMatchUps||params.withSeeding||params.withEvents||params.withDraws)&&(null==(_a=params.tournamentEvents)||_a.forEach((rawEvent=>{var _a2,_b2,_c,_d,_e,_f,_g;const event=makeDeepCopy(rawEvent,!0,!0),flightProfile=getFlightProfile({event}).flightProfile,eventDrawsCount=(null==(_a2=null==flightProfile?void 0:flightProfile.flights)?void 0:_a2.length)||(null==(_b2=event.drawDefinitions)?void 0:_b2.length)||0;(event.drawDefinitions||[]).forEach(((drawDefinition,i)=>{if((null==event?void 0:event.eventType)===TEAM$2){const{extension}=findExtension$1({element:rawEvent.drawDefinitions[i],name:LINEUPS});extension&&(drawDefinition.extensions=[extension])}}));const{eventId,eventName,eventType,category}=event,eventInfo={eventId,eventName,eventType,category},extensionKeys=event&&Object.keys(event).filter((key=>"_"===key[0]));null==extensionKeys||extensionKeys.forEach((extensionKey=>eventInfo[extensionKey]=event[extensionKey]));const eventEntries=event.entries||[],itemType=`${PUBLISH}.${STATUS$1}`,{timeItem}=getEventTimeItem({itemType,event});if(null==(_c=null==timeItem?void 0:timeItem.itemValue)?void 0:_c.PUBLIC){const{drawIds:publishedDrawIds=[],seeding}=timeItem.itemValue.PUBLIC||{},publishedSeeding={published:void 0,seedingScaleNames:[],drawIds:[]};seeding&&Object.assign(publishedSeeding,timeItem.itemValue.PUBLIC.seeding),eventsPublishStatuses[eventId]={publishedDrawIds,publishedSeeding}}const disallowedKeys=[].concat(...Object.values(extensionConstants)).map((constant=>`_${constant}`)),filteredEventInfo=eventInfo&&Object.keys(eventInfo).filter((key=>!disallowedKeys.includes(key))).reduce(((obj,key)=>(obj[key]=eventInfo[key],obj)),{});null==eventEntries||eventEntries.filter((entry=>null==entry?void 0:entry.participantId)).forEach((entry=>{const{participantId,entryStage,entryStatus,entryPosition}=entry,relevantParticipantIds=getRelevantParticipantIds(participantId);null==relevantParticipantIds||relevantParticipantIds.forEach((({relevantParticipantId})=>{participantIdMap[relevantParticipantId]||initializeParticipantId(relevantParticipantId),participantIdMap[relevantParticipantId].events[eventId]=__spreadProps$23(__spreadValues$3D({},filteredEventInfo),{partnerParticipantIds:[],entryPosition,entryStatus,entryStage,drawIds:[],eventId})}))}));const drawIdsWithDefinitions=(null==(_d=event.drawDefinitions)?void 0:_d.map((({drawId})=>drawId)))||[];null==(_f=null==(_e=eventInfo._flightProfile)?void 0:_e.flights)||_f.forEach((flight=>{const{drawId,drawEntries}=flight;drawIdsWithDefinitions.includes(drawId)||null==drawEntries||drawEntries.forEach((drawEntry=>(({drawEntry,drawId})=>{const{participantId,entryStage,entryStatus,entryPosition}=drawEntry,relevantParticipantIds=getRelevantParticipantIds(participantId);null==relevantParticipantIds||relevantParticipantIds.forEach((({relevantParticipantId})=>{var _a3,_b3;if(participantIdMap[relevantParticipantId].events[eventId]||(participantIdMap[relevantParticipantId].events[eventId]=__spreadProps$23(__spreadValues$3D({},filteredEventInfo),{partnerParticipantIds:[],entryPosition,entryStatus,entryStage,drawIds:[],eventId})),!participantIdMap[relevantParticipantId].draws[drawId]){const positionAssignments=getDerivedPositionAssignments({participantId:relevantParticipantId,derivedDrawInfo,drawId}),seedAssignments=getDerivedSeedAssignments({participantId:relevantParticipantId,derivedDrawInfo,drawId});participantIdMap[relevantParticipantId].draws[drawId]=definedAttributes({qualifyingDrawSize:null==(_a3=derivedDrawInfo[drawId])?void 0:_a3.qualifyingDrawSize,drawSize:null==(_b3=derivedDrawInfo[drawId])?void 0:_b3.drawSize,partnerParticipantIds:[],positionAssignments,eventDrawsCount,seedAssignments,entryPosition,entryStatus,entryStage,eventId,drawId})}const eventDrawIds=participantIdMap[relevantParticipantId].events[eventId].drawIds;eventDrawIds&&!(null==eventDrawIds?void 0:eventDrawIds.includes(drawId))&&participantIdMap[relevantParticipantId].events[eventId].drawIds.push(drawId)}))})({drawEntry,drawId})))}));const{drawDetails,derivedInfo}=function getDrawDetails({event,eventEntries,sortConfig}){const derivedInfo={},drawDetails=Object.assign({},...(event.drawDefinitions||[]).map((drawDefinition=>{var _a,_b,_c,_d,_e,_f,_g,_h,_i;const entriesMap=Object.assign({},...(eventEntries||[]).filter((entry=>entry.participantId)).map((entry=>({[entry.participantId]:entry}))),...drawDefinition.entries.filter((entry=>entry.participantId)).map((entry=>({[entry.participantId]:entry})))),drawEntries=Object.values(entriesMap),mainStructure=null==(_b=null==(_a=getDrawStructures({stageSequence:1,drawDefinition,stage:MAIN}))?void 0:_a.structures)?void 0:_b[0],mainPositionAssignments=mainStructure&&(null==(_c=getPositionAssignments$1({structure:mainStructure}))?void 0:_c.positionAssignments),drawSize=null==mainPositionAssignments?void 0:mainPositionAssignments.length,qualifyingStructure=null==(_e=null==(_d=getDrawStructures({stageSequence:1,stage:QUALIFYING,drawDefinition}))?void 0:_d.structures)?void 0:_e[0],qualifyingPositionAssignments=mainStructure&&(null==(_f=getPositionAssignments$1({structure:qualifyingStructure}))?void 0:_f.positionAssignments),qualifyingDrawSize=null==qualifyingPositionAssignments?void 0:qualifyingPositionAssignments.length,mainSeedAssignments=null==mainStructure?void 0:mainStructure.seedAssignments,qualifyingSeedAssignments=null==qualifyingStructure?void 0:qualifyingStructure.seedAssignments,orderedStructureIds=(drawDefinition.structures||[]).sort(((a,b)=>structureSort(a,b,sortConfig))).map((({structureId,structures})=>[structureId,...(structures||[]).map((({structureId:structureId2})=>structureId2))])).flat(1/0),flightNumber=null==(_i=null==(_h=null==(_g=null==event?void 0:event._flightProfile)?void 0:_g.flights)?void 0:_h.find((flight=>flight.drawId===drawDefinition.drawId)))?void 0:_i.flightNumber;return derivedInfo[drawDefinition.drawId]={qualifyingPositionAssignments,qualifyingSeedAssignments,mainPositionAssignments,mainSeedAssignments,orderedStructureIds,qualifyingDrawSize,flightNumber,drawSize},{[drawDefinition.drawId]:{drawType:drawDefinition.drawType,drawEntries}}})));return{derivedInfo,drawDetails}}({eventEntries,event});if(Object.assign(derivedDrawInfo,derivedInfo),event.eventType===TEAM$2||params.withScheduleItems||params.scheduleAnalysis||params.withStatistics||params.withOpponents||params.withMatchUps||params.withDraws){const matchUps=null==(_g=allEventMatchUps({afterRecoveryTimes:params.scheduleAnalysis,participants:allTournamentParticipants,nextMatchUps:!0,tournamentRecord,inContext:!0,event}))?void 0:_g.matchUps;null==matchUps||matchUps.forEach((matchUp=>function processMatchUp({relevantParticipantIdsMap,participantFilters,participantIdMap,derivedDrawInfo,eventDrawsCount,drawDetails,eventType,matchUp}){var _a;const{collectionId,collectionPosition,drawId,drawName,eventId,eventName,finishingRound,finishingPositionRange,processCodes,loserTo,matchUpId,matchUpType,matchUpFormat,matchUpStatus,matchUpStatusCodes,matchUpTieId,roundName,roundNumber,roundPosition,score,sides,stage,stageSequence,schedule,structureName,structureId,tieFormat,tieMatchUps,tournamentId,winnerTo,winningSide}=matchUp,targetParticipantIds=null==participantFilters?void 0:participantFilters.participantIds,getRelevantParticipantIds=participantId=>{const relevantParticipantIds=participantId&&relevantParticipantIdsMap[participantId]||[];return relevantParticipantIds.push(participantId),relevantParticipantIds.some((obj=>!targetParticipantIds||targetParticipantIds.includes(obj.relevantParticipantId)))?relevantParticipantIds:[]},{winner,loser}=finishingPositionRange||{},doublesTieParticipants=(null==tieMatchUps?void 0:tieMatchUps.length)&&tieMatchUps.filter((({matchUpType:matchUpType2})=>matchUpType2===DOUBLES_MATCHUP)).map((({sides:sides2})=>sides2.map((({sideNumber,participantId,participant})=>sideNumber&&participantId&&{sideNumber,participantId,participant})))).flat().filter(Boolean)||[];if(eventType===TEAM_EVENT&&matchUpType===DOUBLES_MATCHUP){const participants=((null==(_a=matchUp.sides)?void 0:_a.filter(Boolean))||[]).map((({sideNumber,participantId,participant})=>sideNumber&&participantId&&{sideNumber,participantId,participant})).filter(Boolean);doublesTieParticipants.push(...participants)}if(null==sides||sides.forEach((({participantId,sideNumber}={})=>{if(!participantId)return;const{drawType,drawEntries}=drawDetails[drawId],participantScore=1===sideNumber?null==score?void 0:score.scoreStringSide1:null==score?void 0:score.scoreStringSide2,participantWon=winningSide&&sideNumber===winningSide,opponent=matchUp.sides.find((({sideNumber:otherSideNumber}={})=>otherSideNumber===3-sideNumber)),opponentParticipantId=null==opponent?void 0:opponent.participantId,relevantOpponents=opponentParticipantId&&relevantParticipantIdsMap[opponentParticipantId]||[],finishingPositionRange2=participantWon?winner:loser,drawEntry=drawEntries.find((entry=>entry.participantId===participantId)),relevantParticipantIds=getRelevantParticipantIds(participantId),addedPairParticipantIds=[];null==doublesTieParticipants||doublesTieParticipants.filter((participant=>participant.sideNumber===sideNumber)).forEach((({participantId:participantId2})=>{participantId2&&!addedPairParticipantIds.includes(participantId2)&&(relevantParticipantIds.push({relevantParticipantId:participantId2,participantType:PAIR}),addedPairParticipantIds.push(participantId2))}));const filteredRelevantParticipantIds=relevantParticipantIds.filter((opponent2=>eventType!==TEAM_EVENT||eventType===TEAM_EVENT&&[DOUBLES_MATCHUP,TEAM_MATCHUP].includes(matchUpType)&&[PAIR,TEAM_PARTICIPANT].includes(opponent2.participantType)||eventType===TEAM_EVENT&&[SINGLES_MATCHUP,DOUBLES_MATCHUP].includes(matchUpType)&&[INDIVIDUAL].includes(opponent2.participantType)));null==filteredRelevantParticipantIds||filteredRelevantParticipantIds.forEach((({relevantParticipantId,participantType})=>{var _a2,_b;const{entryStage,entryStatus,entryPosition}=drawEntry||{};if(!participantIdMap[relevantParticipantId].draws[drawId]){const positionAssignments=getDerivedPositionAssignments({participantId:relevantParticipantId,derivedDrawInfo,drawId}),seedAssignments=getDerivedSeedAssignments({participantId:relevantParticipantId,derivedDrawInfo,drawId});participantIdMap[relevantParticipantId].draws[drawId]=definedAttributes({qualifyingDrawSize:null==(_a2=derivedDrawInfo[drawId])?void 0:_a2.qualifyingDrawSize,drawSize:null==(_b=derivedDrawInfo[drawId])?void 0:_b.drawSize,partnerParticipantIds:[],positionAssignments,seedAssignments,entryPosition,entryStatus,entryStage,drawName,drawType,eventId,drawId})}participantIdMap[relevantParticipantId].events[eventId]||(participantIdMap[relevantParticipantId].events[eventId]={partnerParticipantIds:[],drawIds:[],eventName,eventId});const eventDrawIds=participantIdMap[relevantParticipantId].events[eventId].drawIds;let partnerParticipantId;if(eventDrawIds&&!(null==eventDrawIds?void 0:eventDrawIds.includes(drawId))&&participantIdMap[relevantParticipantId].events[eventId].drawIds.push(drawId),participantType===INDIVIDUAL&&matchUpType===DOUBLES_MATCHUP){const relevantParticipantInfo=filteredRelevantParticipantIds.find((participantInfo=>participantInfo.relevantParticipantId!==relevantParticipantId&&participantInfo.participantType===INDIVIDUAL));partnerParticipantId=null==relevantParticipantInfo?void 0:relevantParticipantInfo.relevantParticipantId}const filteredRelevantOpponents=(null==relevantOpponents?void 0:relevantOpponents.filter((opponent2=>matchUpType===TEAM_MATCHUP&&participantType===TEAM_PARTICIPANT&&opponent2.participantType===TEAM_PARTICIPANT||matchUpType===SINGLES_MATCHUP&&opponent2.participantType===INDIVIDUAL||matchUpType===DOUBLES_MATCHUP&&(participantType===INDIVIDUAL?[INDIVIDUAL,PAIR].includes(opponent2.participantType):opponent2.participantType===PAIR))))||[];filteredRelevantOpponents.forEach((({relevantParticipantId:opponentParticipantId2,participantType:opponentParticipantType})=>{participantIdMap[relevantParticipantId].opponents||(participantIdMap[relevantParticipantId].opponents={}),participantIdMap[relevantParticipantId].opponents[opponentParticipantId2]={eventId,drawId,matchUpId,participantType:opponentParticipantType,participantId:opponentParticipantId2}}));const opponentParticipantInfo=filteredRelevantOpponents.map((({relevantParticipantId:relevantParticipantId2,participantType:participantType2})=>({participantId:relevantParticipantId2,participantType:participantType2})));(matchUpType!==TEAM_MATCHUP&&[INDIVIDUAL,PAIR].includes(participantType)||matchUpType===TEAM_MATCHUP&&participantType===TEAM_PARTICIPANT)&&(participantIdMap[relevantParticipantId].matchUps[matchUpId]=definedAttributes({collectionId,collectionPosition,drawId,eventId,eventType,eventDrawsCount,finishingRound,finishingPositionRange:finishingPositionRange2,loserTo,matchUpId,matchUpType,matchUpFormat,matchUpStatus,matchUpStatusCodes,matchUpTieId,opponentParticipantInfo,participantWon,partnerParticipantId,perspectiveScoreString:participantScore,processCodes,roundName,roundNumber,roundPosition,schedule,score,sides,stage,stageSequence,structureName,structureId,tieFormat,tournamentId,winnerTo,winningSide})),partnerParticipantId&&(participantIdMap[relevantParticipantId].events[eventId].partnerParticipantIds.push(partnerParticipantId),participantIdMap[relevantParticipantId].draws[drawId].partnerParticipantIds.push(partnerParticipantId),participantIdMap[relevantParticipantId].events[eventId].partnerParticipantId=partnerParticipantId,participantIdMap[relevantParticipantId].draws[drawId].partnerParticipantId=partnerParticipantId),winningSide&&(participantWon?participantIdMap[relevantParticipantId].wins++:participantIdMap[relevantParticipantId].losses++)}))})),Array.isArray(matchUp.potentialParticipants)){const potentialParticipantIds=getParticipantIds(matchUp.potentialParticipants.flat());null==potentialParticipantIds||potentialParticipantIds.forEach((participantId=>{const relevantParticipantIds=getRelevantParticipantIds(participantId);null==relevantParticipantIds||relevantParticipantIds.forEach((({relevantParticipantId})=>{participantIdMap[relevantParticipantId].potentialMatchUps[matchUpId]=definedAttributes({drawId,eventId,eventType,matchUpId,matchUpType,matchUpFormat,roundName,roundNumber,roundPosition,schedule,tieFormat,structureName,tournamentId,potential:!0})}))}))}}({relevantParticipantIdsMap,participantFilters,participantIdMap,derivedDrawInfo,eventDrawsCount,drawDetails,eventType,matchUp})))}}))),null==(_b=params.tournamentParticipants)||_b.forEach((participant=>{const{scheduleConflicts,scheduleItems}=function annotateParticipant({withScaleValues=!0,eventsPublishStatuses,withEvents=!0,withDraws=!0,participantIdMap,scheduleAnalysis,derivedDrawInfo,usePublishState,withStatistics,withOpponents,withMatchUps,withSeeding,participant,withISO2,withIOC}){var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j;const scheduleConflicts=[],scheduleItems=[];if((withIOC||withISO2)&&addNationalityCode({participant,withIOC,withISO2}),withScaleValues){const{ratings,rankings}=getScaleValues({participant});participant.rankings=rankings,participant.ratings=ratings}const participantId=null==participant?void 0:participant.participantId;if(!participantId||!participantIdMap[participantId])return{};const{potentialMatchUps,opponents,matchUps,events,losses,draws,wins}=participantIdMap[participantId],denominator=wins+losses,winRatioStat={statCode:WIN_RATIO$1,denominator,numerator:wins,statValue:denominator&&wins/denominator},participantDraws=Object.values(draws),participantEvents=Object.values(events);if(withDraws&&participantDraws){participant.draws=participantDraws;for(const participantDraw of participantDraws){const publishedSeeding=null==(_a=eventsPublishStatuses[participantDraw.eventId])?void 0:_a.publishedSeeding;if(!usePublishState||(null==publishedSeeding?void 0:publishedSeeding.published)&&(0===(null==(_b=null==publishedSeeding?void 0:publishedSeeding.drawIds)?void 0:_b.length)||(null==(_c=null==publishedSeeding?void 0:publishedSeeding.drawIds)?void 0:_c.includes(participantDraw.drawId)))){const seedAssignments=getDerivedSeedAssignments({drawId:participantDraw.drawId,derivedDrawInfo,participantId});seedAssignments&&(participantDraw.seedAssignments=seedAssignments)}}}if(withEvents&&participantEvents&&(participant.events=participantEvents,withSeeding)){const seedingScales=Object.assign({},...(participant.timeItems||[]).filter((({itemType})=>itemType.split(".")[1]===SEEDING$1)).map((({itemType:seedingScaleName,itemValue:seedValue})=>({[seedingScaleName]:seedValue}))));for(const participantEvent of participantEvents){const getScaleAccessor=scaleName=>[SCALE$1,SEEDING$1,participantEvent.eventType,scaleName].join("."),publishedSeeding=null==(_d=eventsPublishStatuses[participantEvent.eventId])?void 0:_d.publishedSeeding,eventSeedingScaleNames=((null==publishedSeeding?void 0:publishedSeeding.stageSeedingScaleNames)&&Object.values(null==publishedSeeding?void 0:publishedSeeding.stageSeedingScaleNames)||Array.isArray(null==publishedSeeding?void 0:publishedSeeding.seedingScaleNames)&&publishedSeeding.seedingScaleNames||[]).map(getScaleAccessor),publishedEventSeedingScaleNames=intersection(Object.keys(seedingScales),eventSeedingScaleNames),eventSeedingPublished=!(usePublishState&&(Object.keys(seedingScales).length||(null==(_e=null==publishedSeeding?void 0:publishedSeeding.drawIds)?void 0:_e.length))&&!publishedEventSeedingScaleNames.length);if(eventSeedingPublished&&publishedEventSeedingScaleNames.length){if(null==publishedSeeding?void 0:publishedSeeding.stageSeedingScaleNames){const scaleValues=Object.keys(publishedSeeding.stageSeedingScaleNames).map((key=>{const accessor=getScaleAccessor(publishedSeeding.stageSeedingScaleNames[key]);return[key,seedingScales[accessor]]})).filter((pair=>pair[1])).map((pair=>({[pair[0]]:{seedValue:pair[1]}}))),seedAssignments=Object.assign({},...scaleValues);participantEvent.seedAssignments=seedAssignments}else if(publishedEventSeedingScaleNames){const seedValues=publishedEventSeedingScaleNames.map((scaleName=>seedingScales[scaleName]));participantEvent.seedValue=seedValues.pop()}}else if(usePublishState||"object"!=typeof withSeeding){const{categoryName,ageCategoryCode}=participantEvent.category||{};let scaleItem;for(const scaleName of[participantEvent.eventId,ageCategoryCode,categoryName]){const result=participantScaleItem({scaleAttributes:{eventType:participantEvent.eventType,scaleType:SEEDING$1,scaleName},participant});if(result.scaleItem){scaleItem=result.scaleItem;break}}if(scaleItem){const seedValue=scaleItem.scaleValue;(!usePublishState||(null==publishedSeeding?void 0:publishedSeeding.published)&&(0===(null==(_f=null==publishedSeeding?void 0:publishedSeeding.drawIds)?void 0:_f.length)||(null==(_g=null==publishedSeeding?void 0:publishedSeeding.drawIds)?void 0:_g.includes(participantEvent.drawId))))&&(participantEvent.seedValue=seedValue)}}else{const scaleValues=Object.keys(withSeeding).map((key=>{const accessor=getScaleAccessor(withSeeding[key]);return[key,seedingScales[accessor]]})).filter((pair=>pair[1])).map((pair=>({[pair[0]]:{seedValue:pair[1]}}))),seedAssignments=Object.assign({},...scaleValues);participantEvent.seedAssignments=seedAssignments}if(null==(_h=participantEvent.drawIds)?void 0:_h.length)for(const flightDrawId of participantEvent.drawIds||[]){const drawSeedPublishingDisabled=(null==(_i=null==publishedSeeding?void 0:publishedSeeding.drawIds)?void 0:_i.length)&&!(null==(_j=null==publishedSeeding?void 0:publishedSeeding.drawIds)?void 0:_j.includes(flightDrawId));if(eventSeedingPublished&&!drawSeedPublishingDisabled){const seedAssignments=getDerivedSeedAssignments({drawId:flightDrawId,derivedDrawInfo,participantId});if(seedAssignments&&participantEvent.seedAssignments)for(const key of Object.keys(participantEvent.seedAssignments))participantEvent.seedAssignments[key]=seedAssignments[key];else participantEvent.seedAssignments=seedAssignments}}}}const participantOpponents=Object.values(opponents).flat();withOpponents&&(null==participantOpponents?void 0:participantOpponents.length)&&(participant.opponents=participantOpponents,null==participantDraws||participantDraws.forEach((draw=>{draw.opponents=participantOpponents.filter((opponent=>opponent.drawId===draw.drawId))})));const participantPotentialMatchUps=Object.values(potentialMatchUps),participantMatchUps=Object.values(matchUps);withMatchUps&&(participant.potentialMatchUps=participantPotentialMatchUps,participant.matchUps=participantMatchUps);const allParticipantMatchUps=participantMatchUps.concat(participantPotentialMatchUps),{scheduledMatchUps}=participantScheduledMatchUps({matchUps:allParticipantMatchUps}),{scheduledMinutesDifference}=scheduleAnalysis||{};return Object.keys(scheduledMatchUps).forEach((date=>{scheduledMatchUps[date].filter(Boolean).forEach(((matchUp,i)=>{var _a2,_b2,_c2,_d2;const{schedule:{scheduledTime,timeAfterRecovery,typeChangeTimeAfterRecovery},matchUpStatus,roundPosition,structureName,matchUpType,roundNumber,matchUpId,drawId,score}=matchUp;scheduleItems.push(__spreadProps$24(__spreadValues$3E({},matchUp.schedule),{scheduledTime:extractTime(null==(_a2=matchUp.schedule)?void 0:_a2.scheduledTime),roundPosition,structureName,matchUpType,roundNumber,matchUpId,drawId}));const ignoreMatchUp=matchUpStatus===BYE||[WALKOVER$2,DEFAULTED].includes(matchUpStatus)&&!scoreHasValue({score});if(scheduledTime&&!ignoreMatchUp){const scheduledMinutes=timeStringMinutes(scheduledTime),matchUpsToConsider=scheduledMatchUps[date].slice(i+1);for(const consideredMatchUp of matchUpsToConsider)if(consideredMatchUp.matchUpStatus!==BYE&&(![WALKOVER$2,DEFAULTED].includes(consideredMatchUp.matchUpStatus)||scoreHasValue(consideredMatchUp))&&(null==(_b2=consideredMatchUp.schedule)?void 0:_b2.scheduledTime)){const notBeforeTime=matchUp.matchUpType!==consideredMatchUp.matchUpType&&typeChangeTimeAfterRecovery||timeAfterRecovery,sameDraw=matchUp.drawId===consideredMatchUp.drawId,bothPotential=matchUp.potential&&consideredMatchUp.potential,minutesDifference=timeStringMinutes(null==(_c2=consideredMatchUp.schedule)?void 0:_c2.scheduledTime)-scheduledMinutes;!(scheduledMinutesDifference&&!isNaN(scheduledMinutesDifference)?minutesDifference<=scheduledMinutesDifference:timeStringMinutes(notBeforeTime)>timeStringMinutes(null==(_d2=consideredMatchUp.schedule)?void 0:_d2.scheduledTime))||bothPotential&&sameDraw||scheduleConflicts.push({priorScheduledMatchUpId:consideredMatchUp.matchUpId,matchUpIdWithConflict:matchUpId})}}}))})),withStatistics&&(participant.statistics=[winRatioStat]),{scheduleConflicts,scheduleItems}}(__spreadProps$23(__spreadValues$3D({},params),{eventsPublishStatuses,participantIdMap,derivedDrawInfo,participant}));if(params.withSignInStatus){const{timeItem}=getTimeItem({itemType:SIGN_IN_STATUS,element:participant});participant.signedIn=(null==timeItem?void 0:timeItem.itemValue)===SIGNED_IN}if(params.withScheduleItems&&(participant.scheduleItems=scheduleItems),params.scheduleAnalysis&&(participant.scheduleConflicts=scheduleConflicts,(null==scheduleConflicts?void 0:scheduleConflicts.length)&&(participantIdsWithConflicts.includes(participant.participantId)||participantIdsWithConflicts.push(participant.participantId))),!1!==params.withGroupings){const participantAttributes=participantIdMap[participant.participantId];participant.groupParticipantIds=null==participantAttributes?void 0:participantAttributes.groupParticipantIds,participant.pairParticipantIds=null==participantAttributes?void 0:participantAttributes.pairParticipantIds,participant.teamParticipantIds=null==participantAttributes?void 0:participantAttributes.teamParticipantIds,participant.groups=null==participantAttributes?void 0:participantAttributes.groups,participant.teams=null==participantAttributes?void 0:participantAttributes.teams}params.withTeamMatchUps})),{participantIdsWithConflicts,eventsPublishStatuses}}function filterParticipants({participantFilters={},tournamentRecord,participants=[]}){var _a;if(!Object.keys(participantFilters).length)return participants;const{accessorValues,drawEntryStatuses,positionedParticipants,eventEntryStatuses,participantRoles,participantRoleResponsibilities,participantTypes,participantIds,signInStatus,enableOrFiltering,eventIds,genders}=participantFilters,tournamentEvents=isValidFilterArray(eventIds)&&(null==(_a=null==tournamentRecord?void 0:tournamentRecord.events)?void 0:_a.filter((event=>eventIds.includes(event.eventId))))||(null==tournamentRecord?void 0:tournamentRecord.events)||[],drawEnteredParticipantIds=drawEntryStatuses&&function getDrawEntries({drawEntryStatuses,tournamentEvents}){const statusFilter=({entryStatus})=>!Array.isArray(drawEntryStatuses)||drawEntryStatuses.includes(entryStatus);return unique(tournamentEvents.reduce(((entries,event)=>{var _a,_b;const{flightProfile}=getFlightProfile({event}),flightEntries=(null==(_a=null==flightProfile?void 0:flightProfile.flights)?void 0:_a.map((({drawEntries})=>Array.isArray(drawEntries)?drawEntries.filter(statusFilter).map(getParticipantId):[])).flat())||[],drawEnteredParticipantIds=(null==(_b=event.drawDefinitions)?void 0:_b.map((({entries:entries2})=>entries2?entries2.filter(statusFilter).map(getParticipantId):[])))||[];return entries.concat(...flightEntries,...drawEnteredParticipantIds)}),[]))}({drawEntryStatuses,tournamentEvents}),eventEnteredParticipantIds=eventEntryStatuses&&function getEventEntries({eventEntryStatuses,tournamentEvents}){return unique(tournamentEvents.reduce(((entries,event)=>{const eventEntries=(event.entries||[]).filter((({entryStatus})=>!Array.isArray(eventEntryStatuses)||eventEntryStatuses.includes(entryStatus))).map(getParticipantId);return entries.concat(...eventEntries)}),[]))}({eventEntryStatuses,tournamentEvents}),positionedParticipantIds=[!0,!1].includes(positionedParticipants)&&tournamentEvents.reduce(((participantIds2,event)=>participantIds2.concat(...(event.drawDefinitions||[]).map((drawDefinition=>getAllPositionedParticipantIds({drawDefinition}).allPositionedParticipantIds)).filter(Boolean))),[]),participantHasAccessorValues=participant=>accessorValues.reduce(((hasValues,keyValue)=>{const{accessor,value}=keyValue,{values}=getAccessorValue({element:participant,accessor});return hasValues&&(null==values?void 0:values.includes(value))}),!0);if(participants=null==participants?void 0:participants.filter((participant=>{const participantSignInStatus=getTimeItem({element:participant,itemType:SIGN_IN_STATUS}),{participantRoleResponsibilities:responsibilities,participantType,participantRole,participantId,person}=participant,hasGender=Array.isArray(genders)&&(null==genders?void 0:genders.length)&&(null==person?void 0:person.sex)&&genders.includes(person.sex);return enableOrFiltering?genders&&hasGender||positionedParticipants&&positionedParticipantIds.includes(participantId)||!1===positionedParticipants&&!positionedParticipantIds.includes(participantId)||drawEnteredParticipantIds&&drawEnteredParticipantIds.includes(participantId)||eventEnteredParticipantIds&&eventEnteredParticipantIds.includes(participantId)||participantIds&&participantIds.includes(participantId)||signInStatus&&participantSignInStatus===signInStatus||participantTypes&&isValidFilterArray(participantTypes)&&participantTypes.includes(participantType)||participantRoles&&isValidFilterArray(participantRoles)&&participantRoles.includes(participantRole)||participantRoleResponsibilities&&isValidFilterArray(responsibilities)&&isValidFilterArray(participantRoleResponsibilities)&&participantRoleResponsibilities.find((roleResponsbility=>null==responsibilities?void 0:responsibilities.includes(roleResponsbility)))||(null==accessorValues?void 0:accessorValues.length)&&isValidFilterArray(accessorValues)&&participantHasAccessorValues(participant):(!genders||hasGender)&&(void 0===positionedParticipants||positionedParticipants&&positionedParticipantIds.includes(participantId)||!1===positionedParticipants&&!positionedParticipantIds.includes(participantId))&&(!drawEnteredParticipantIds||drawEnteredParticipantIds.includes(participantId))&&(!eventEnteredParticipantIds||eventEnteredParticipantIds.includes(participantId))&&(!participantIds||participantIds.includes(participantId))&&(!signInStatus||participantSignInStatus===signInStatus)&&(!participantTypes||isValidFilterArray(participantTypes)&&participantTypes.includes(participantType))&&(!participantRoles||isValidFilterArray(participantRoles)&&participantRoles.includes(participantRole))&&(!participantRoleResponsibilities||isValidFilterArray(responsibilities)&&isValidFilterArray(participantRoleResponsibilities)&&participantRoleResponsibilities.find((roleResponsbility=>null==responsibilities?void 0:responsibilities.includes(roleResponsbility))))&&(!(null==accessorValues?void 0:accessorValues.length)||isValidFilterArray(accessorValues)&&participantHasAccessorValues(participant))})),tournamentEvents.length&&eventIds){const participantIds2=tournamentEvents.filter((event=>eventIds.includes(event.eventId))).map((event=>{const enteredParticipantIds=(event.entries||[]).map((entry=>entry.participantId));if(event.eventType===SINGLES)return enteredParticipantIds;const individualParticipantIds=((null==tournamentRecord?void 0:tournamentRecord.participants)||[]).filter((participant=>enteredParticipantIds.includes(participant.participantId))).map((participant=>participant.individualParticipantIds)).flat(1);return enteredParticipantIds.concat(...individualParticipantIds)})).flat(1);participants=null==participants?void 0:participants.filter((participant=>participantIds2.includes(participant.participantId)))}return participants}function isValidFilterArray(filter){return filter&&Array.isArray(filter)&&filter.length}function getTournamentParticipants({participantFilters={},convertExtensions,policyDefinitions,withScheduleItems,scheduleAnalysis,withSignInStatus,withTeamMatchUps,tournamentRecord,usePublishState,withScaleValues,withStatistics,withGroupings,withOpponents,withMatchUps,withSeeding,withEvents,withDraws,inContext,withISO2,withIOC}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!tournamentRecord.participants)return{error:MISSING_PARTICIPANTS};const allTournamentParticipants=tournamentRecord.participants.map((participant=>makeDeepCopy(participant,convertExtensions)));if("object"!=typeof participantFilters)return{error:INVALID_OBJECT,participantFilters};inContext&&(null==allTournamentParticipants||allTournamentParticipants.forEach((participant=>{var _a;[PAIR,TEAM,GROUP].includes(participant.participantType)&&(participant.individualParticipants=null==(_a=participant.individualParticipantIds)?void 0:_a.map((participantId=>{const individualParticipant=makeDeepCopy(tournamentRecord.participants.find((p=>p.participantId===participantId)),convertExtensions,!0);if(withScaleValues){const{ratings,rankings}=getScaleValues({participant:individualParticipant});individualParticipant.ratings=ratings,individualParticipant.rankings=rankings}return(withIOC||withISO2)&&addNationalityCode({participant:individualParticipant,withISO2,withIOC}),individualParticipant})))})));let participantIdsWithConflicts,eventsPublishStatuses,tournamentParticipants=participantFilters?filterParticipants({participants:allTournamentParticipants,participantFilters,tournamentRecord}):allTournamentParticipants;if(withScheduleItems||withSignInStatus||scheduleAnalysis||withScaleValues||withStatistics||withGroupings||withOpponents||withMatchUps||withSeeding||withEvents||withDraws||withISO2||withIOC){const result=addParticipantContext({tournamentEvents:tournamentRecord.events,allTournamentParticipants,tournamentParticipants,participantFilters,withScheduleItems,withSignInStatus,tournamentRecord,scheduleAnalysis,withTeamMatchUps,usePublishState,withScaleValues,withStatistics,withGroupings,withOpponents,withMatchUps,withSeeding,withEvents,withDraws,withISO2,withIOC});participantIdsWithConflicts=null==result?void 0:result.participantIdsWithConflicts,eventsPublishStatuses=null==result?void 0:result.eventsPublishStatuses}const participantAttributes=null==policyDefinitions?void 0:policyDefinitions[POLICY_TYPE_PARTICIPANT];return(null==participantAttributes?void 0:participantAttributes.participant)&&(tournamentParticipants=tournamentParticipants.map((participant=>attributeFilter({template:participantAttributes.participant,source:participant})))),{participantIdsWithConflicts,tournamentParticipants,eventsPublishStatuses}}const COMPETITOR="COMPETITOR",OFFICIAL="OFFICIAL",participantRoles={ADMINISTRATION:"ADMINISTRATION",CAPTAIN:"CAPTAIN",COACH:"COACH",COMPETITOR,MEDIA:"MEDIA",MEDICAL:"MEDICAL",OFFICIAL,OTHER:"OTHER",SECURITY:"SECURITY"};function addMatchUpScheduleItems$1(params){return addMatchUpScheduleItems$2(params)}function addMatchUpScheduledDate$1({removePriorValues,tournamentRecord,drawDefinition,disableNotice,scheduledDate,matchUpId}){return addMatchUpScheduledDate$2({removePriorValues,tournamentRecord,drawDefinition,disableNotice,scheduledDate,matchUpId})}function addMatchUpScheduledTime$1({removePriorValues,tournamentRecord,drawDefinition,scheduledTime,disableNotice,matchUpId}){return addMatchUpScheduledTime$2({removePriorValues,tournamentRecord,drawDefinition,scheduledTime,disableNotice,matchUpId})}function addMatchUpStartTime$1({tournamentRecord,drawDefinition,disableNotice,matchUpId,startTime}){return addMatchUpStartTime$2({tournamentRecord,drawDefinition,disableNotice,matchUpId,startTime})}function addMatchUpEndTime$1({tournamentRecord,drawDefinition,disableNotice,matchUpId,endTime}){return addMatchUpEndTime$2({tournamentRecord,drawDefinition,disableNotice,matchUpId,endTime})}function addMatchUpStopTime$1({tournamentRecord,drawDefinition,disableNotice,matchUpId,stopTime}){return addMatchUpStopTime$2({tournamentRecord,drawDefinition,disableNotice,matchUpId,stopTime})}function addMatchUpResumeTime$1({tournamentRecord,drawDefinition,disableNotice,resumeTime,matchUpId}){return addMatchUpResumeTime$2({tournamentRecord,drawDefinition,disableNotice,resumeTime,matchUpId})}function addMatchUpOfficial$1({tournamentRecord,drawDefinition,disableNotice,participantId,officialType,matchUpId}){if(!participantId)return{error:MISSING_PARTICIPANT_ID};const{tournamentParticipants}=getTournamentParticipants({tournamentRecord,participantFilters:{participantTypes:[INDIVIDUAL],participantRoles:[OFFICIAL]}});return findParticipant({tournamentParticipants,participantId})?addMatchUpOfficial$2({drawDefinition,disableNotice,participantId,officialType,matchUpId}):{error:PARTICIPANT_NOT_FOUND}}var __defProp$3C=Object.defineProperty,__defProps$22=Object.defineProperties,__getOwnPropDescs$22=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3D=Object.getOwnPropertySymbols,__hasOwnProp$3D=Object.prototype.hasOwnProperty,__propIsEnum$3D=Object.prototype.propertyIsEnumerable,__defNormalProp$3C=(obj,key,value)=>key in obj?__defProp$3C(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3C=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3D.call(b,prop)&&__defNormalProp$3C(a,prop,b[prop]);if(__getOwnPropSymbols$3D)for(var prop of __getOwnPropSymbols$3D(b))__propIsEnum$3D.call(b,prop)&&__defNormalProp$3C(a,prop,b[prop]);return a},__spreadProps$22=(a,b)=>__defProps$22(a,__getOwnPropDescs$22(b));function bulkRescheduleMatchUps$1({tournamentRecord,scheduleChange,matchUpIds,dryRun}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!matchUpIds||!Array.isArray(matchUpIds))return{error:MISSING_MATCHUP_IDS};if("object"!=typeof scheduleChange)return{error:INVALID_VALUES};const rescheduledMatchUpIds=[],notRescheduledMatchUpIds=[],{minutesChange,daysChange}=scheduleChange;if(!minutesChange&&!daysChange)return __spreadValues$3C({},SUCCESS);if(minutesChange&&isNaN(minutesChange))return{error:INVALID_VALUES};if(daysChange&&isNaN(daysChange))return{error:INVALID_VALUES};const{matchUps}=allTournamentMatchUps({matchUpFilters:{matchUpIds},tournamentRecord}),scheduledNotCompletedMatchUps=null==matchUps?void 0:matchUps.filter(hasSchedule).filter((({matchUpStatus})=>!completedMatchUpStatuses.includes(matchUpStatus)));if(!scheduledNotCompletedMatchUps.length)return __spreadValues$3C({},SUCCESS);const{tournamentInfo}=getTournamentInfo({tournamentRecord}),{startDate,endDate}=tournamentInfo,drawIdMap=scheduledNotCompletedMatchUps.reduce(((drawIdMap2,matchUp)=>{const{matchUpId,drawId}=matchUp;return drawIdMap2[drawId]?drawIdMap2[drawId].push(matchUpId):drawIdMap2[drawId]=[matchUpId],drawIdMap2}),{});for(const drawId of Object.keys(drawIdMap)){const result=getDrawDefinition$2({tournamentRecord,drawId});if(result.error)return result;const drawDefinition=result.drawDefinition,drawMatchUpIds=drawIdMap[drawId].filter((matchUpId=>matchUpIds.includes(matchUpId)));for(const matchUpId of drawMatchUpIds)if(matchUpId&&drawDefinition){const schedule=scheduledNotCompletedMatchUps.find((matchUp=>matchUp.matchUpId===matchUpId)).schedule,{scheduledTime,scheduledDate}=schedule;let doNotReschedule,newScheduledTime,newScheduledDate;if(minutesChange&&scheduledTime){const scheduledTimeDate=extractDate(scheduledTime),newTime=timeStringMinutes(extractTime(scheduledTime))+minutesChange;if(doNotReschedule=newTime<0||newTime>1440,!doNotReschedule){let timeString=addMinutesToTimeString(scheduledTime,minutesChange);newScheduledTime=scheduledTimeDate?`${scheduledTimeDate}T${timeString}`:timeString}}if(!doNotReschedule&&daysChange&&scheduledDate){newScheduledDate=dateStringDaysChange(extractDate(scheduledDate),daysChange),doNotReschedule=new Date(newScheduledDate)<new Date(startDate)||new Date(newScheduledDate)>new Date(endDate)}if(doNotReschedule)notRescheduledMatchUpIds.push(matchUpId);else{if(!dryRun){if(newScheduledTime){const result2=addMatchUpScheduledTime$1({scheduledTime:newScheduledTime,drawDefinition,matchUpId});if(result2.error)return result2}if(newScheduledDate){const result2=addMatchUpScheduledDate$1({scheduledDate:newScheduledDate,drawDefinition,matchUpId});if(result2.error)return result2}}(newScheduledTime||newScheduledDate)&&rescheduledMatchUpIds.push(matchUpId)}}}const{matchUps:updatedInContext}=allTournamentMatchUps({matchUpFilters:{matchUpIds},tournamentRecord}),rescheduled=updatedInContext.filter((({matchUpId})=>rescheduledMatchUpIds.includes(matchUpId))),notRescheduled=updatedInContext.filter((({matchUpId})=>notRescheduledMatchUpIds.includes(matchUpId))),allRescheduled=rescheduled.length&&!notRescheduled.length;return __spreadProps$22(__spreadValues$3C({},SUCCESS),{rescheduled,notRescheduled,allRescheduled})}var __defProp$3B=Object.defineProperty,__defProps$21=Object.defineProperties,__getOwnPropDescs$21=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3C=Object.getOwnPropertySymbols,__hasOwnProp$3C=Object.prototype.hasOwnProperty,__propIsEnum$3C=Object.prototype.propertyIsEnumerable,__defNormalProp$3B=(obj,key,value)=>key in obj?__defProp$3B(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function setMatchUpDailyLimits$1({tournamentRecord,dailyLimits}){return tournamentRecord?"object"!=typeof dailyLimits?{error:INVALID_OBJECT}:addTournamentExtension({extension:{name:SCHEDULE_LIMITS,value:{dailyLimits}},tournamentRecord}):{error:MISSING_TOURNAMENT_RECORD}}var __defProp$3A=Object.defineProperty,__getOwnPropSymbols$3B=Object.getOwnPropertySymbols,__hasOwnProp$3B=Object.prototype.hasOwnProperty,__propIsEnum$3B=Object.prototype.propertyIsEnumerable,__defNormalProp$3A=(obj,key,value)=>key in obj?__defProp$3A(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$3z=Object.defineProperty,__defProps$20=Object.defineProperties,__getOwnPropDescs$20=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3A=Object.getOwnPropertySymbols,__hasOwnProp$3A=Object.prototype.hasOwnProperty,__propIsEnum$3A=Object.prototype.propertyIsEnumerable,__defNormalProp$3z=(obj,key,value)=>key in obj?__defProp$3z(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3z=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3A.call(b,prop)&&__defNormalProp$3z(a,prop,b[prop]);if(__getOwnPropSymbols$3A)for(var prop of __getOwnPropSymbols$3A(b))__propIsEnum$3A.call(b,prop)&&__defNormalProp$3z(a,prop,b[prop]);return a},__spreadProps$20=(a,b)=>__defProps$20(a,__getOwnPropDescs$20(b));function processEventEntry({extensionConversions,seedAssignments,participant,withSeeding,seedValue,eventId,ranking,entry}){const{entryStatus,entryStage,entryPosition}=entry;participant.events[eventId]=definedAttributes(__spreadProps$20(__spreadValues$3z({},extensionConversions),{entryPosition,entryStatus,entryStage,ranking,eventId}),!1,!1,!0),withSeeding&&(seedAssignments&&(participant.events[eventId].seedAssignments=seedAssignments),seedValue&&(participant.events[eventId].seedValue=seedValue))}var __defProp$3y=Object.defineProperty,__defProps$1$=Object.defineProperties,__getOwnPropDescs$1$=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3z=Object.getOwnPropertySymbols,__hasOwnProp$3z=Object.prototype.hasOwnProperty,__propIsEnum$3z=Object.prototype.propertyIsEnumerable,__defNormalProp$3y=(obj,key,value)=>key in obj?__defProp$3y(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3y=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3z.call(b,prop)&&__defNormalProp$3y(a,prop,b[prop]);if(__getOwnPropSymbols$3z)for(var prop of __getOwnPropSymbols$3z(b))__propIsEnum$3z.call(b,prop)&&__defNormalProp$3y(a,prop,b[prop]);return a},__spreadProps$1$=(a,b)=>__defProps$1$(a,__getOwnPropDescs$1$(b));function addScheduleItem({participantMap,participantId,matchUpStatus,roundPosition,structureId,matchUpType,roundNumber,matchUpId,potential,schedule,drawId,score}){if(!schedule||!Object.keys(schedule).length)return;matchUpStatus===BYE||participantMap[participantId].scheduleItems.push(__spreadProps$1$(__spreadValues$3y({},schedule),{scheduledDate:extractDate(null==schedule?void 0:schedule.scheduledDate),scheduledTime:extractTime(null==schedule?void 0:schedule.scheduledTime),scoreHasValue:scoreHasValue({score}),matchUpStatus,roundPosition,structureId,matchUpType,roundNumber,matchUpId,potential,drawId}))}function addStructureParticipation({finishingPositionRange:matchUpFinishingPositionRanges={},participantMap,finishingRound,participantWon,matchUpStatus,participantId,stageSequence,roundNumber,structureId,matchUpId,drawId,stage}){const participantAggregator=participantMap[participantId],diff=range=>Math.abs(range[0]-range[1]);participantAggregator.structureParticipation[structureId]||(participantAggregator.structureParticipation[structureId]={structureId,rankingStage:stage,walkoverWinCount:0,defaultWinCount:0,stageSequence,winCount:0,drawId});const structureParticipation=participantAggregator.structureParticipation[structureId],{winner,loser}=matchUpFinishingPositionRanges,finishingPositionRange=participantWon?winner:loser;participantWon&&(structureParticipation.winCount+=1,matchUpStatus===WALKOVER$2&&(structureParticipation.walkoverWinCount+=1),matchUpStatus===DEFAULTED&&(structureParticipation.defaultWinCount+=1)),finishingPositionRange&&(!structureParticipation.finishingPositionRange||diff(finishingPositionRange)<diff(structureParticipation.finishingPositionRange))&&(structureParticipation.finishingPositionRange=finishingPositionRange),finishingRound&&((!structureParticipation.finishingRound||finishingRound<structureParticipation.finishingRound)&&(structureParticipation.finishingMatchUpId=matchUpId,structureParticipation.finishingRound=finishingRound,structureParticipation.roundNumber=roundNumber),1===finishingRound&&(structureParticipation.participantWon=participantWon))}function processSides({withScheduleTimes,scheduleAnalysis,withTeamMatchUps,participantMap,withOpponents,withMatchUps,withEvents,withDraws,finishingPositionRange,finishingRound,matchUpStatus,stageSequence,roundNumber,structureId,score,stage,withRankingProfile,tieWinningSide,roundPosition,matchUpTieId,matchUpSides,collectionId,matchUpType,winningSide,matchUpId,schedule,eventId,drawId,sides}){var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j;const opponents=withOpponents&&2===(null==sides?void 0:sides.length)&&Object.assign({},...sides.map((({sideNumber},i)=>{const opponentParticipantId=sides[1-i].participantId;return sideNumber&&{[sideNumber]:opponentParticipantId}})).filter(Boolean));for(const side of sides){const{participantId,sideNumber,bye}=side;if(bye)continue;const participantWon=winningSide===sideNumber,getOpponentInfo=opponentParticipantId=>{var _a2,_b2;const opponent=null==(_a2=participantMap[opponentParticipantId])?void 0:_a2.participant,participantType=null==opponent?void 0:opponent.participantType,info=[{participantId:opponentParticipantId,participantType}];if(participantType!==TEAM_PARTICIPANT)for(const participantId2 of(null==opponent?void 0:opponent.individualParticipantIds)||[]){const participant=null==(_b2=participantMap[participantId2])?void 0:_b2.participant;info.push({participantType:null==participant?void 0:participant.participantType,participantId:participantId2})}return info},addMatchUp=(participantId2,opponentParticipantId)=>{if(withMatchUps){if(participantMap[participantId2].matchUps[matchUpId]={participantWon,matchUpType,structureId,sideNumber,matchUpId,eventId,drawId},withOpponents){const opponentParticipantInfo=getOpponentInfo(opponentParticipantId);participantMap[participantId2].matchUps[matchUpId].opponentParticipantInfo=opponentParticipantInfo}collectionId&&(participantMap[participantId2].matchUps[matchUpId].collectionId=collectionId)}withRankingProfile&&addStructureParticipation({finishingPositionRange,participantMap,participantWon,finishingRound,matchUpStatus,participantId:participantId2,stageSequence,roundNumber,structureId,matchUpId,drawId,stage}),(scheduleAnalysis||withScheduleTimes)&&addScheduleItem({participantMap,participantId:participantId2,matchUpStatus,roundPosition,matchUpType,roundNumber,structureId,matchUpId,schedule,drawId,score})},addPartnerParticiapntId=(element,partnerParticipantId)=>{element&&(element.partnerParticipantIds||(element.partnerParticipantIds=[]),element.partnerParticipantIds.includes(partnerParticipantId)||element.partnerParticipantIds.push(partnerParticipantId))},addPartner=({participantId:participantId2,partnerParticipantId})=>{var _a2,_b2,_c2,_d2,_e2,_f2;withDraws&&addPartnerParticiapntId(null==(_b2=null==(_a2=participantMap[participantId2])?void 0:_a2.draws)?void 0:_b2[drawId],partnerParticipantId),withEvents&&addPartnerParticiapntId(null==(_d2=null==(_c2=participantMap[participantId2])?void 0:_c2.events)?void 0:_d2[eventId],partnerParticipantId),withMatchUps&&addPartnerParticiapntId(null==(_f2=null==(_e2=participantMap[participantId2])?void 0:_e2.matchUps)?void 0:_f2[matchUpId],partnerParticipantId)};if(participantId&&participantMap[participantId]){const opponentParticipantId=null==opponents?void 0:opponents[sideNumber];addMatchUp(participantId,opponentParticipantId),withOpponents&&opponentParticipantId&&(participantMap[participantId].opponents[opponentParticipantId]={participantId:opponentParticipantId,matchUpId,eventId,drawId});const isPair=(null==(_a=participantMap[participantId])?void 0:_a.participant.participantType)===PAIR,individualParticipantIds=(null==(_b=participantMap[participantId])?void 0:_b.participant.individualParticipantIds)||[];if(matchUpTieId){if(withTeamMatchUps){const addTeamMatchUp=participantId2=>participantMap[participantId2].matchUps[matchUpTieId]={participantWon:tieWinningSide===sideNumber,matchUpType:TEAM_MATCHUP,matchUpId:matchUpTieId,sideNumber};addTeamMatchUp(participantId),individualParticipantIds.forEach(addTeamMatchUp)}if(withDraws&&!participantMap[participantId].draws[drawId]){const teamParticipantId=null==(_d=null==(_c=matchUpSides.find((s=>s.sideNumber===sideNumber)))?void 0:_c.participant)?void 0:_d.participantId,teamEntryStatus=null==(_g=null==(_f=null==(_e=participantMap[teamParticipantId])?void 0:_e.draws)?void 0:_f[drawId])?void 0:_g.entryStatus,addDrawData=participantId2=>participantMap[participantId2].draws[drawId]={entryStatus:teamEntryStatus,eventId,drawId};addDrawData(participantId),individualParticipantIds.forEach(addDrawData)}}if(isPair&&(individualParticipantIds.forEach((participantId2=>participantMap[participantId2]&&addMatchUp(participantId2,opponentParticipantId))),individualParticipantIds.forEach(((participantId2,i)=>{const partnerParticipantId=individualParticipantIds[1-i];addPartner({participantId:participantId2,partnerParticipantId})})),withEvents&&matchUpSides)){const teamParticipantId=null==(_i=null==(_h=matchUpSides.find((s=>s.sideNumber===sideNumber)))?void 0:_h.participant)?void 0:_i.participantId;if(teamParticipantId){const teamEntry=null==(_j=participantMap[teamParticipantId])?void 0:_j.events[eventId];teamEntry?(participantMap[participantId].events[eventId]=teamEntry,individualParticipantIds.forEach((individualParticiapntId=>participantMap[individualParticiapntId].events[eventId]=teamEntry))):console.log("Missing teamEntry",{eventId,teamParticipantId})}}if(winningSide){const processParticipantId=id=>{participantWon?(participantMap[id].counters[matchUpType].wins+=1,participantMap[id].counters.wins+=1,matchUpStatus===WALKOVER$2&&(participantMap[id].counters[matchUpType].walkoverWins+=1,participantMap[id].counters.walkoverWins+=1),matchUpStatus===DEFAULTED&&(participantMap[id].counters[matchUpType].defaultWins+=1,participantMap[id].counters.defaultWins+=1)):(participantMap[id].counters[matchUpType].losses+=1,participantMap[id].counters.losses+=1,matchUpStatus===WALKOVER$2&&(participantMap[id].counters[matchUpType].walkovers+=1,participantMap[id].counters.walkovers+=1),matchUpStatus===DEFAULTED&&(participantMap[id].counters[matchUpType].defaults+=1,participantMap[id].counters.defaults+=1))};processParticipantId(participantId),individualParticipantIds.forEach(processParticipantId)}}}}var __defProp$3x=Object.defineProperty,__defProps$1_=Object.defineProperties,__getOwnPropDescs$1_=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3y=Object.getOwnPropertySymbols,__hasOwnProp$3y=Object.prototype.hasOwnProperty,__propIsEnum$3y=Object.prototype.propertyIsEnumerable,__defNormalProp$3x=(obj,key,value)=>key in obj?__defProp$3x(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3x=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3y.call(b,prop)&&__defNormalProp$3x(a,prop,b[prop]);if(__getOwnPropSymbols$3y)for(var prop of __getOwnPropSymbols$3y(b))__propIsEnum$3y.call(b,prop)&&__defNormalProp$3x(a,prop,b[prop]);return a},__spreadProps$1_=(a,b)=>__defProps$1_(a,__getOwnPropDescs$1_(b));var __defProp$3w=Object.defineProperty,__defProps$1Z=Object.defineProperties,__getOwnPropDescs$1Z=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3x=Object.getOwnPropertySymbols,__hasOwnProp$3x=Object.prototype.hasOwnProperty,__propIsEnum$3x=Object.prototype.propertyIsEnumerable,__defNormalProp$3w=(obj,key,value)=>key in obj?__defProp$3w(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3w=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3x.call(b,prop)&&__defNormalProp$3w(a,prop,b[prop]);if(__getOwnPropSymbols$3x)for(var prop of __getOwnPropSymbols$3x(b))__propIsEnum$3x.call(b,prop)&&__defNormalProp$3w(a,prop,b[prop]);return a},__spreadProps$1Z=(a,b)=>__defProps$1Z(a,__getOwnPropDescs$1Z(b)),__objRest$8=(source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$3x.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols$3x)for(var prop of __getOwnPropSymbols$3x(source))exclude.indexOf(prop)<0&&__propIsEnum$3x.call(source,prop)&&(target[prop]=source[prop]);return target};function getParticipants$1({withIndividualParticipants,participantFilters={},withPotentialMatchUps,withRankingProfile,convertExtensions,policyDefinitions,withScheduleItems,tournamentRecord,scheduleAnalysis,withSignInStatus,withTeamMatchUps,withScaleValues,usePublishState,contextProfile,withStatistics,withOpponents,withMatchUps,internalUse,withSeeding,withEvents,withDraws,withISO2,withIOC}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};(withMatchUps||withRankingProfile)&&getMatchUpDependencies({tournamentRecord});let participantIdsWithConflicts,eventsPublishStatuses,derivedEventInfo,derivedDrawInfo,mappedMatchUps,matchUps,{participantMap}=getParticipantMap({withIndividualParticipants,convertExtensions,policyDefinitions,tournamentRecord,withSignInStatus,withScaleValues,internalUse,withISO2,withIOC});({participantIdsWithConflicts,eventsPublishStatuses,derivedEventInfo,derivedDrawInfo,participantMap,mappedMatchUps,matchUps}=function getParticipantEntries({participantFilters,convertExtensions,policyDefinitions,tournamentRecord,usePublishState,contextProfile,participantMap,withPotentialMatchUps,withRankingProfile,withScheduleTimes,scheduleAnalysis,withTeamMatchUps,withStatistics,withOpponents,withMatchUps,withSeeding,withEvents,withDraws}){var _a,_b,_c,_d,_e;const targetParticipantIds=null==participantFilters?void 0:participantFilters.participantIds,getRelevantParticipantIds=participantId=>{var _a2;const relevantParticipantIds=[participantId];return relevantParticipantIds.push(participantId),null==(_a2=participantMap[participantId].participant.individualParticipantIds)||_a2.forEach((individualParticiapntId=>relevantParticipantIds.push(individualParticiapntId))),relevantParticipantIds.some((obj=>!(null==targetParticipantIds?void 0:targetParticipantIds.length)||targetParticipantIds.includes(obj.relevantParticipantId)))?relevantParticipantIds:[]},withOpts={withMatchUps:withMatchUps||withRankingProfile,withEvents:withEvents||withRankingProfile,withDraws:withDraws||withRankingProfile,withPotentialMatchUps,withRankingProfile,withScheduleTimes,scheduleAnalysis,withTeamMatchUps,withStatistics,participantMap,withOpponents,withSeeding},participantIdsWithConflicts=[],eventsPublishStatuses={},derivedEventInfo={},derivedDrawInfo={},mappedMatchUps={};let matchUps=[];const getRanking=({eventType,scaleNames,participantId})=>{var _a2,_b2,_c2,_d2;return null==(_d2=null==(_c2=null==(_b2=null==(_a2=participantMap[participantId].participant)?void 0:_a2.rankings)?void 0:_b2[eventType])?void 0:_c2.find((ranking=>scaleNames.includes(ranking.scaleName))))?void 0:_d2.scaleValue};for(const event of(null==tournamentRecord?void 0:tournamentRecord.events)||[]){if((null==participantFilters?void 0:participantFilters.eventIds)&&!participantFilters.eventIds.includes(event.eventId))continue;const{drawDefinitions=[],extensions,eventType,eventName,category,entries,eventId,gender}=event,{flightProfile}=getFlightProfile({event}),flights=null==flightProfile?void 0:flightProfile.flights,publishStatuses=getEventPublishStatuses({event}),publishedSeeding=null==publishStatuses?void 0:publishStatuses.publishedSeeding;if(publishStatuses&&(eventsPublishStatuses[eventId]=publishStatuses),withEvents||withSeeding||withRankingProfile){const extensionConversions=convertExtensions?Object.assign({},...extensionsToAttributes(extensions)):{};derivedEventInfo[eventId]=__spreadProps$1_(__spreadValues$3x({},extensionConversions),{eventName,eventType,category,eventId,gender});const scaleNames=[null==category?void 0:category.categoryName,null==category?void 0:category.ageCategoryCode].filter(Boolean);for(const entry of entries){const{participantId}=entry;if(!participantId||!participantMap[participantId])continue;const ranking=getRanking({eventType,scaleNames,participantId});let seedAssignments,seedValue;if(withSeeding){const participant=participantMap[participantId].participant;({seedAssignments,seedValue}=getEventSeedAssignments({publishedSeeding,usePublishState,withSeeding,participant,event}))}const addEventEntry=id=>{var _a2;if(null==(_a2=participantMap[id])?void 0:_a2.events[eventId])return;const participant=participantMap[id];processEventEntry({extensionConversions,seedAssignments,participant,withSeeding,seedValue,eventId,ranking,entry})};addEventEntry(participantId),(participantMap[participantId].participant.individualParticipantIds||[]).forEach(addEventEntry)}}if(withDraws||withRankingProfile||withSeeding){const getSeedingMap=assignments=>assignments?Object.assign({},...assignments.map((assignment=>({[assignment.participantId]:assignment})))):void 0;for(const drawDefinition of drawDefinitions){const{structures=[],drawOrder,drawType,entries:entries2,drawId}=drawDefinition,flightNumber=null==(_a=null==flights?void 0:flights.find((flight=>flight.drawId===drawId)))?void 0:_a.flightNumber,scaleNames=[null==category?void 0:category.categoryName,null==category?void 0:category.ageCategoryCode].filter(Boolean),orderedStructureIds=(drawDefinition.structures||[]).sort(((a,b)=>structureSort(a,b))).map((({structureId,structures:structures2})=>[structureId,...(structures2||[]).map((({structureId:structureId2})=>structureId2))])).flat(1/0);let qualifyingPositionAssignments,qualifyingSeedAssignments,mainPositionAssignments,mainSeedAssignments,drawSize=0;const assignedParticipantIds=structures.filter((({stage,stageSequence})=>stage===MAIN&&1===stageSequence||stage===QUALIFYING)).flatMap((structure=>{const{seedAssignments,stageSequence,stage}=structure,{positionAssignments}=getPositionAssignments$1({structure});return stage===MAIN?(drawSize=(null==positionAssignments?void 0:positionAssignments.length)||0,mainPositionAssignments=positionAssignments,mainSeedAssignments=seedAssignments):1===stageSequence&&(qualifyingPositionAssignments=positionAssignments,qualifyingSeedAssignments=seedAssignments),positionAssignments})).map((({participantId})=>participantId)).filter(Boolean),mainSeedingMap=getSeedingMap(mainSeedAssignments),qualifyingSeedingMap=getSeedingMap(qualifyingSeedAssignments),relevantEntries=entries2.filter((({participantId})=>assignedParticipantIds.includes(participantId))),publishedSeeding2=null==(_b=eventsPublishStatuses[eventId])?void 0:_b.publishedSeeding,seedingPublished=!usePublishState||(null==publishedSeeding2?void 0:publishedSeeding2.published)&&(0===(null==(_c=null==publishedSeeding2?void 0:publishedSeeding2.drawIds)?void 0:_c.length)||(null==(_d=null==publishedSeeding2?void 0:publishedSeeding2.drawIds)?void 0:_d.includes(drawId)));for(const entry of relevantEntries){const{entryStatus,entryStage,entryPosition,participantId}=entry,ranking=getRanking({participantId,scaleNames,eventType}),addDrawEntry=id=>{var _a2,_b2,_c2,_d2;if(participantMap[id].draws[drawId])return;const includeSeeding=withSeeding&&seedingPublished,seedAssignments=includeSeeding?{}:void 0,mainSeeding=includeSeeding?(null==(_a2=null==mainSeedingMap?void 0:mainSeedingMap[participantId])?void 0:_a2.seedValue)||(null==(_b2=null==mainSeedingMap?void 0:mainSeedingMap[participantId])?void 0:_b2.seedNumber):void 0,qualifyingSeeding=includeSeeding?(null==(_c2=null==qualifyingSeedingMap?void 0:qualifyingSeedingMap[participantId])?void 0:_c2.seedValue)||(null==(_d2=null==qualifyingSeedingMap?void 0:qualifyingSeedingMap[participantId])?void 0:_d2.seedNumber):void 0;mainSeeding&&(seedAssignments[MAIN]=mainSeeding),qualifyingSeeding&&(seedAssignments[QUALIFYING]=mainSeeding),(withEvents||withRankingProfile)&&(includeSeeding?participantMap[id].events[eventId].seedValue=mainSeeding||qualifyingSeeding:participantMap[id].events[eventId].seedValue&&(participantMap[id].events[eventId].seedValue=void 0)),(withDraws||withRankingProfile)&&(participantMap[id].draws[drawId]=definedAttributes({seedAssignments,entryPosition,entryStatus,entryStage,eventId,ranking,drawId},!1,!1,!0))};if(![UNGROUPED,UNPAIRED].includes(entryStatus)){addDrawEntry(participantId);const individualParticipantIds=participantMap[participantId].participant.individualParticipantIds||[];null==individualParticipantIds||individualParticipantIds.forEach(addDrawEntry)}}derivedDrawInfo[drawId]={qualifyingPositionAssignments,qualifyingSeedAssignments,mainPositionAssignments,qualifyingSeedingMap,mainSeedAssignments,orderedStructureIds,mainSeedingMap,flightNumber,drawOrder,drawType,drawSize,drawId}}}if(withRankingProfile||scheduleAnalysis||withTeamMatchUps||withStatistics||withOpponents||withMatchUps||withDraws){const nextMatchUps=scheduleAnalysis||withPotentialMatchUps,eventMatchUps=null==(_e=allEventMatchUps({afterRecoveryTimes:scheduleAnalysis,policyDefinitions,tournamentRecord,inContext:!0,contextProfile,participantMap,nextMatchUps,event}))?void 0:_e.matchUps;for(const matchUp of eventMatchUps){const{finishingPositionRange,potentialParticipants,tieMatchUps=[],sides=[],winningSide,matchUpType,matchUpId,eventId:eventId2,drawId,collectionId,stageSequence,finishingRound,matchUpStatus,roundPosition,roundNumber,structureId,schedule,score,stage}=matchUp;mappedMatchUps[matchUpId]=matchUp;const baseAttrs={finishingPositionRange,finishingRound,stageSequence,roundPosition,collectionId,roundNumber,structureId,schedule,eventId:eventId2,drawId,score,stage};processSides(__spreadProps$1_(__spreadValues$3x(__spreadValues$3x({},baseAttrs),withOpts),{matchUpStatus,winningSide,matchUpType,matchUpId,sides}));for(const tieMatchUp of tieMatchUps){const{winningSide:tieMatchUpWinningSide,sides:tieMatchUpSides=[],matchUpId:tieMatchUpId,matchUpStatus:matchUpStatus2,matchUpType:matchUpType2}=tieMatchUp;processSides(__spreadProps$1_(__spreadValues$3x(__spreadValues$3x({},baseAttrs),withOpts),{winningSide:tieMatchUpWinningSide,tieWinningSide:winningSide,matchUpTieId:matchUpId,matchUpId:tieMatchUpId,sides:tieMatchUpSides,matchUpSides:sides,matchUpStatus:matchUpStatus2,matchUpType:matchUpType2}))}if(Array.isArray(potentialParticipants)&&(nextMatchUps||scheduleAnalysis||withScheduleTimes)){const potentialParticipantIds=getParticipantIds(potentialParticipants.flat());null==potentialParticipantIds||potentialParticipantIds.forEach((participantId=>{const relevantParticipantIds=getRelevantParticipantIds(participantId);null==relevantParticipantIds||relevantParticipantIds.forEach((relevantParticipantId=>{participantMap[relevantParticipantId].potentialMatchUps[matchUpId]=definedAttributes({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUpId,eventId:eventId2,drawId})})),(scheduleAnalysis||withScheduleTimes)&&addScheduleItem({potential:!0,participantMap,participantId,matchUpStatus,roundPosition,structureId,matchUpType,roundNumber,matchUpId,schedule,drawId,score})}))}}matchUps.push(...eventMatchUps)}}if(withStatistics||withRankingProfile||scheduleAnalysis)for(const participantAggregator of Object.values(participantMap)){const{wins,losses,[SINGLES$1]:{wins:singlesWins,losses:singlesLosses},[DOUBLES$1]:{wins:doublesWins,losses:doublesLosses}}=participantAggregator.counters,addStatValue=(statCode,wins2,losses2)=>{const denominator=wins2+losses2,numerator=wins2,statValue=denominator&&numerator/denominator;participantAggregator.statistics[statCode]={denominator,numerator,statValue,statCode}};if(withStatistics&&(addStatValue(WIN_RATIO$1,wins,losses),addStatValue(`${WIN_RATIO$1}.${SINGLES$1}`,singlesWins,singlesLosses),addStatValue(`${WIN_RATIO$1}.${DOUBLES$1}`,doublesWins,doublesLosses)),withRankingProfile){const diff=(range=[])=>Math.abs(range[0]-range[1]);for(const drawId of Object.keys(participantAggregator.draws)){const{orderedStructureIds=[],flightNumber}=derivedDrawInfo[drawId]||{};if(participantAggregator.structureParticipation&&orderedStructureIds.length){let finishingPositionRange,nonQualifyingOrder=0;const orderedParticipation=orderedStructureIds.map((structureId=>{const participation=participantAggregator.structureParticipation[structureId];if(!participation)return;finishingPositionRange||(finishingPositionRange=participation.finishingPositionRange),diff(finishingPositionRange)>diff(participation.finishingPositionRange)&&(finishingPositionRange=participation.finishingPositionRange);const notQualifying=participation.stage!==QUALIFYING;notQualifying&&(nonQualifyingOrder+=1);const participationOrder=notQualifying?nonQualifyingOrder:void 0;return definedAttributes(__spreadProps$1_(__spreadValues$3x({},participation),{participationOrder,flightNumber}))})).filter(Boolean);participantAggregator.draws[drawId].finishingPositionRange=finishingPositionRange,participantAggregator.draws[drawId].structureParticipation=orderedParticipation}}}if(scheduleAnalysis){const{scheduledMinutesDifference}=scheduleAnalysis,scheduleItems=participantAggregator.scheduleItems||[],potentialMatchUps=participantAggregator.potentialMatchUps||{},dateItems=scheduleItems.reduce(((dateItems2,scheduleItem)=>{const{scheduledDate,scheduledTime}=scheduleItem;return dateItems2[scheduledDate]||(dateItems2[scheduledDate]=[]),scheduledTime&&dateItems2[scheduledDate].push(scheduleItem),dateItems2}),{});Object.values(dateItems).forEach((items=>items.sort(timeSort)));for(const scheduleItem of scheduleItems){const{typeChangeTimeAfterRecovery,timeAfterRecovery,scheduledDate,scheduledTime}=scheduleItem,scheduleItemsToConsider=dateItems[scheduledDate],scheduledMinutes=timeStringMinutes(scheduledTime);for(const consideredItem of scheduleItemsToConsider){if(consideredItem.matchUpId===scheduleItem.matchUpId||[WALKOVER$2,DEFAULTED].includes(consideredItem.matchUpStatus)&&!consideredItem.scoreHasValue)continue;const notBeforeTime=scheduleItem.matchUpType!==consideredItem.matchUpType&&typeChangeTimeAfterRecovery||timeAfterRecovery,sameDraw=scheduleItem.drawId===consideredItem.drawId,bothPotential=potentialMatchUps[scheduleItem.matchUpId]&&potentialMatchUps[consideredItem.matchUpId],minutesDifference=timeStringMinutes(consideredItem.scheduledTime)-scheduledMinutes;!(scheduledMinutesDifference&&!isNaN(scheduledMinutesDifference)?minutesDifference<=scheduledMinutesDifference:timeStringMinutes(notBeforeTime)>timeStringMinutes(consideredItem.scheduledTime))||bothPotential&&sameDraw||participantAggregator.scheduleConflicts.push({priorScheduledMatchUpId:consideredItem.matchUpId,matchUpIdWithConflict:scheduleItem.matchUpId})}}participantAggregator.scheduleConflicts.length&&participantIdsWithConflicts.push(participantAggregator.participant.participantId)}}return{participantIdsWithConflicts,eventsPublishStatuses,derivedEventInfo,derivedDrawInfo,mappedMatchUps,participantMap,matchUps}}({withMatchUps:withMatchUps||withRankingProfile,withEvents:withEvents||withRankingProfile,withDraws:withDraws||withRankingProfile,withPotentialMatchUps,participantFilters,withRankingProfile,policyDefinitions,convertExtensions,withScheduleItems,tournamentRecord,scheduleAnalysis,withTeamMatchUps,usePublishState,withStatistics,contextProfile,participantMap,withOpponents,withSeeding}));const nextMatchUps=scheduleAnalysis||withPotentialMatchUps;let participants=filterParticipants({participants:Object.values(participantMap).map((_a=>{var _b=_a,{potentialMatchUps,statistics,opponents,matchUps:matchUps2,events,draws}=_b,p=__objRest$8(_b,["potentialMatchUps","statistics","opponents","matchUps","events","draws"]);const participantDraws=Object.values(draws),participantOpponents=Object.values(opponents);return withOpponents&&(null==participantDraws||participantDraws.forEach((draw=>{draw.opponents=participantOpponents.filter((opponent=>opponent.drawId===draw.drawId))}))),definedAttributes(__spreadProps$1Z(__spreadValues$3w({},p.participant),{draws:withDraws||withRankingProfile?participantDraws:void 0,events:withEvents||withRankingProfile?Object.values(events):void 0,matchUps:withMatchUps||withRankingProfile?Object.values(matchUps2):void 0,opponents:withOpponents?participantOpponents:void 0,potentialMatchUps:nextMatchUps?Object.values(potentialMatchUps):void 0,statistics:withStatistics?Object.values(statistics):void 0}),!1,!1,!0)})),participantFilters,tournamentRecord});return __spreadProps$1Z(__spreadValues$3w({participantIdsWithConflicts,eventsPublishStatuses,derivedEventInfo,derivedDrawInfo,mappedMatchUps,participantMap,participants},SUCCESS),{matchUps})}function deepMerge(existing,incoming,arrayMerge){if(!existing&&incoming)return incoming;if(existing&&!incoming)return existing;if("object"!=typeof existing||"object"!=typeof incoming)return existing;return unique(Object.keys(existing).concat(Object.keys(incoming))).reduce(((merged,key)=>{if(incoming[key])if(existing[key])if(typeof existing[key]!=typeof incoming[key])merged[key]=incoming[key];else if(Array.isArray(existing[key]))if(!0===arrayMerge||Array.isArray(arrayMerge)&&arrayMerge.includes(key)){const mergedArrays=unique(existing[key].map((e=>JSON.stringify(e))).concat(incoming[key].map((i=>JSON.stringify(i))))).map((u=>JSON.parse(u)));merged[key]=mergedArrays}else merged[key]=incoming[key];else"object"==typeof existing[key]?merged[key]=deepMerge(existing[key],incoming[key],arrayMerge):merged[key]=incoming[key];else merged[key]=incoming[key];else merged[key]=existing[key];return merged}),{})}var __defProp$3v=Object.defineProperty,__defProps$1Y=Object.defineProperties,__getOwnPropDescs$1Y=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3w=Object.getOwnPropertySymbols,__hasOwnProp$3w=Object.prototype.hasOwnProperty,__propIsEnum$3w=Object.prototype.propertyIsEnumerable,__defNormalProp$3v=(obj,key,value)=>key in obj?__defProp$3v(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3v=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3w.call(b,prop)&&__defNormalProp$3v(a,prop,b[prop]);if(__getOwnPropSymbols$3w)for(var prop of __getOwnPropSymbols$3w(b))__propIsEnum$3w.call(b,prop)&&__defNormalProp$3v(a,prop,b[prop]);return a};function publicFindParticipant({policyDefinitions,tournamentRecords,participantId,inContext,personId}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if("string"!=typeof participantId&&"string"!=typeof personId)return{error:MISSING_VALUE,stack:"publicFindParticipant"};let participant,tournamentId;for(const tournamentRecord of Object.values(tournamentRecords)){tournamentId=tournamentRecord.tournamentId;const{tournamentParticipants}=getTournamentParticipants({policyDefinitions,tournamentRecord,inContext});if(participant=findParticipant({tournamentParticipants,internalUse:!0,policyDefinitions,participantId,personId}),participant)break}return __spreadValues$3v({participant,tournamentId},SUCCESS)}const penaltyTemplate=({penaltyId=UUID()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId});var __defProp$3u=Object.defineProperty,__defProps$1X=Object.defineProperties,__getOwnPropDescs$1X=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3v=Object.getOwnPropertySymbols,__hasOwnProp$3v=Object.prototype.hasOwnProperty,__propIsEnum$3v=Object.prototype.propertyIsEnumerable,__defNormalProp$3u=(obj,key,value)=>key in obj?__defProp$3u(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3u=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3v.call(b,prop)&&__defNormalProp$3u(a,prop,b[prop]);if(__getOwnPropSymbols$3v)for(var prop of __getOwnPropSymbols$3v(b))__propIsEnum$3v.call(b,prop)&&__defNormalProp$3u(a,prop,b[prop]);return a},__spreadProps$1X=(a,b)=>__defProps$1X(a,__getOwnPropDescs$1X(b));function addPenalty$1({refereeParticipantId,tournamentRecord,participantIds,penaltyCode,penaltyType,extensions,penaltyId,matchUpId,issuedAt,notes}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participantIds)return{error:MISSING_PARTICIPANT_ID};if(!penaltyType)return{error:MISSING_PENALTY_TYPE};const relevantParticipants=((null==tournamentRecord?void 0:tournamentRecord.participants)||[]).filter((participant=>participantIds.includes(participant.participantId)));if(!relevantParticipants.length)return{error:PARTICIPANT_NOT_FOUND};const createdAt=(new Date).toISOString(),penaltyItem=Object.assign(penaltyTemplate({penaltyId}),{refereeParticipantId,penaltyCode,penaltyType,matchUpId,notes,issuedAt,createdAt});return Array.isArray(extensions)&&extensions.forEach((extension=>addExtension$1({element:penaltyItem,extension}))),relevantParticipants.forEach((participant=>{participant.penalties||(participant.penalties=[]),participant.penalties.push(penaltyItem)})),addNotice({topic:MODIFY_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:relevantParticipants}}),__spreadProps$1X(__spreadValues$3u({},SUCCESS),{penaltyId:penaltyItem.penaltyId})}function removePenalty$1({tournamentRecord,penaltyId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!penaltyId)return{error:MISSING_PENALTY_ID};const participants=(null==tournamentRecord?void 0:tournamentRecord.participants)||[],modifiedParticipants=[];let removedPenalty,penaltyRemoved=!1;return participants.forEach((participant=>{let participantModified=!1;participant.penalties=(participant.penalties||[]).filter((penalty=>(penalty.penaltyId===penaltyId&&(participantModified=!0,penaltyRemoved||(removedPenalty=penalty,penaltyRemoved=!0)),participantModified&&modifiedParticipants.push(participant),penalty.penaltyId!==penaltyId)))})),removedPenalty&&addNotice({topic:MODIFY_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:modifiedParticipants}}),removedPenalty?__spreadProps$1X(__spreadValues$3u({},SUCCESS),{penalty:removedPenalty}):{error:PENALTY_NOT_FOUND}}function getTournamentPenalties({tournamentRecord}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const allPenalties=((null==tournamentRecord?void 0:tournamentRecord.participants)||[]).reduce(((penalties,participant)=>{const{participantId}=participant;return(participant.penalties||[]).forEach((penalty=>{const{penaltyId}=penalty||{};penalties[penaltyId]?penalties[penaltyId].participants.push(participantId):penalties[penaltyId]=__spreadProps$1X(__spreadValues$3u({},penalty),{participantIds:[participantId]})})),penalties}),{});return{penalties:Object.values(allPenalties)}}function modifyPenalty$1({tournamentRecord,penaltyId,modifications}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!modifications)return{error:INVALID_VALUES,modifications};if(!penaltyId)return{error:MISSING_PENALTY_ID};const participants=(null==tournamentRecord?void 0:tournamentRecord.participants)||[],validAttributes=Object.keys(penaltyTemplate()).filter((attribute=>"penaltyId"!==attribute)),validModificationAttributes=Object.keys(modifications).filter((attribute=>validAttributes.includes(attribute)));if(!validModificationAttributes.length)return{error:NO_VALID_ATTRIBUTES};let updatedPenalty;const modifiedParticipants=[];return participants.forEach((participant=>{let participantModified=!1;participant.penalties=(participant.penalties||[]).map((penalty=>(penalty.penaltyId===penaltyId&&(participantModified=!0,validModificationAttributes.forEach((attribute=>Object.assign(penalty,{[attribute]:modifications[attribute]}))),updatedPenalty||(updatedPenalty=penalty)),penalty))),participantModified&&modifiedParticipants.push(participant)})),updatedPenalty&&addNotice({topic:MODIFY_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:modifiedParticipants}}),updatedPenalty?__spreadProps$1X(__spreadValues$3u({},SUCCESS),{penalty:updatedPenalty}):{error:PENALTY_NOT_FOUND}}var __defProp$3t=Object.defineProperty,__defProps$1W=Object.defineProperties,__getOwnPropDescs$1W=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3u=Object.getOwnPropertySymbols,__hasOwnProp$3u=Object.prototype.hasOwnProperty,__propIsEnum$3u=Object.prototype.propertyIsEnumerable,__defNormalProp$3t=(obj,key,value)=>key in obj?__defProp$3t(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3t=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3u.call(b,prop)&&__defNormalProp$3t(a,prop,b[prop]);if(__getOwnPropSymbols$3u)for(var prop of __getOwnPropSymbols$3u(b))__propIsEnum$3u.call(b,prop)&&__defNormalProp$3t(a,prop,b[prop]);return a},__spreadProps$1W=(a,b)=>__defProps$1W(a,__getOwnPropDescs$1W(b));const competitionGovernor={addExtension,findExtension,removeExtension,addEventExtension:function addEventExtension({tournamentRecords,eventId,extension}){if("string"!=typeof eventId)return{error:MISSING_EVENT};if(!isValidExtension({extension}))return{error:INVALID_VALUES};for(const tournamentRecord of Object.values(tournamentRecords)){const{event}=findEvent({tournamentRecord,eventId});if(event)return addEventExtension$1({event,extension})}return{error:EVENT_NOT_FOUND}},linkTournaments:function linkTournaments({tournamentRecords}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const result=getTournamentIds$1(tournamentRecords);if(result.error)return result;const{tournamentIds}=result;if((null==tournamentIds?void 0:tournamentIds.length)>1){return addExtension({tournamentRecords,extension:{name:LINKED_TOURNAMENTS,value:{tournamentIds}}})}return __spreadValues$4G({},SUCCESS)},unlinkTournament:function unlinkTournament({tournamentRecords,tournamentId}){if("object"!=typeof tournamentRecords)return{error:INVALID_VALUES};if(!tournamentId)return{error:MISSING_TOURNAMENT_ID};const result=getTournamentIds$1(tournamentRecords);if(result.error)return result;const{tournamentIds}=result;if(!tournamentIds.includes(tournamentId))return{error:MISSING_TOURNAMENT_ID};let unlinkError;return tournamentIds.every((currentTournamentId=>{var _a;const tournamentRecord=tournamentRecords[currentTournamentId],{extension}=findTournamentExtension({tournamentRecord,name:LINKED_TOURNAMENTS});if(!extension)return!0;let linkedTournamentIds=(null==(_a=null==extension?void 0:extension.value)?void 0:_a.tournamentIds)||[];if(!(null==linkedTournamentIds?void 0:linkedTournamentIds.length)||1===linkedTournamentIds.length&&linkedTournamentIds.includes(tournamentId)||currentTournamentId===tournamentId){const result3=removeTournamentExtension({tournamentRecord,name:LINKED_TOURNAMENTS});return result3.error&&(unlinkError=result3.error),result3.success}const tournamentIds2=linkedTournamentIds.filter((linkedTournamentId=>linkedTournamentId!==tournamentId));extension.value={tournamentIds:tournamentIds2};const result2=addTournamentExtension({tournamentRecord,extension});return result2.error&&(unlinkError=result2.error),result2.success})),unlinkError?{error:unlinkError}:__spreadValues$4G({},SUCCESS)},unlinkTournaments:function unlinkTournaments({tournamentRecords}){return"object"==typeof tournamentRecords&&Object.keys(tournamentRecords).length?decorateResult({result:removeExtension({name:LINKED_TOURNAMENTS,tournamentRecords}),stack:"unlinkTournaments"}):{error:MISSING_TOURNAMENT_RECORDS}},getLinkedTournamentIds,addDrawDefinition:function addDrawDefinition({tournamentRecords,existingDrawCount,allowReplacement,drawDefinition,tournamentId,eventId,flight}){if(!eventId)return{error:MISSING_EVENT};if(!(tournamentId=tournamentId||findTournamentId({tournamentRecords,eventId})))return{error:MISSING_TOURNAMENT_ID};const tournamentRecord=tournamentRecords[tournamentId];if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const result=findEvent({tournamentRecord,eventId});return result.error?result:addDrawDefinition$1({event:result.event,existingDrawCount,allowReplacement,drawDefinition,flight})},getCompetitionParticipants:function getCompetitionParticipants(params){const{tournamentRecords}=params||{};if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const participantIdsWithConflicts=[],competitionParticipantIds=[];let competitionParticipants=[];for(const tournamentRecord of Object.values(tournamentRecords)){const{tournamentParticipants,participantIdsWithConflicts:idsWithConflicts}=getTournamentParticipants(__spreadValues$3v({tournamentRecord},params));for(const tournamentParticipant of tournamentParticipants){const{participantId}=tournamentParticipant;competitionParticipantIds.includes(participantId)?competitionParticipants=competitionParticipants.map((participant=>participant.participantId!==participantId?participant:deepMerge(participant,tournamentParticipant,!0))):(competitionParticipantIds.push(participantId),competitionParticipants.push(tournamentParticipant))}idsWithConflicts&&idsWithConflicts.forEach((participantId=>{participantIdsWithConflicts.includes(participantId)||participantIdsWithConflicts.push(participantId)}))}return __spreadValues$3v({competitionParticipants,participantIdsWithConflicts},SUCCESS)},getParticipants:function getParticipants(params){const{tournamentRecords}=params||{};if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const derivedEventInfo={},derivedDrawInfo={},mappedMatchUps={},matchUps=[],participantIdsWithConflicts=[];for(const tournamentRecord of Object.values(tournamentRecords)){const{participantIdsWithConflicts:idsWithConflicts,mappedMatchUps:tournamentMappedMatchUps,participantMap:tournamentParticipants,matchUps:tournamentMatchUps,derivedEventInfo:eventInfo,derivedDrawInfo:drawInfo,participants:participants2}=getParticipants$1(__spreadValues$3v({tournamentRecord},params));Object.assign(mappedMatchUps,tournamentMappedMatchUps),Object.assign(derivedEventInfo,eventInfo),Object.assign(derivedDrawInfo,drawInfo),participants2.push(tournamentParticipants),matchUps.push(...tournamentMatchUps),null==idsWithConflicts||idsWithConflicts.forEach((participantId=>{participantIdsWithConflicts.includes(participantId)||participantIdsWithConflicts.push(participantId)}))}return a=__spreadValues$3v({participantIdsWithConflicts,derivedEventInfo,derivedDrawInfo,partiicipantMap:{},mappedMatchUps,participants:[]},SUCCESS),__defProps$1Y(a,__getOwnPropDescs$1Y({matchUps}));var a},addParticipant:function addParticipant({tournamentRecords,returnParticipant,pairOverride,tournamentId,participant}){if("string"!=typeof tournamentId)return{error:MISSING_TOURNAMENT_ID};const tournamentRecord=tournamentRecords[tournamentId];return tournamentRecord?addParticipant$1({returnParticipant,tournamentRecord,pairOverride,participant}):{error:MISSING_TOURNAMENT_RECORD}},courtGridRows,setMatchUpStatus:function setMatchUpStatus(params){const tournamentRecords=params.tournamentRecords,tournamentId=params.tournamentId||findTournamentId(params);if("string"!=typeof tournamentId)return{error:MISSING_TOURNAMENT_ID};const tournamentRecord=tournamentRecords[tournamentId];if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{drawDefinition,event}=findEvent({eventId:params.eventId,drawId:params.drawId,tournamentRecord});return setMatchUpStatus$1((a=__spreadValues$3M({tournamentRecord},params),__defProps$2a(a,__getOwnPropDescs$2a({drawDefinition,event}))));var a},bulkMatchUpStatusUpdate:function bulkMatchUpStatusUpdate(params){const{tournamentRecords,outcomes}=params;if(!Array.isArray(outcomes))return{error:MISSING_VALUE,info:mustBeAnArray("outcomes")};const tournamentIds=outcomes.reduce(((tournamentIds2,outcome)=>tournamentIds2.includes(outcome.tournamentId)?tournamentIds2:tournamentIds2.concat(outcome.tournamentId)),[]);for(const tournamentId of tournamentIds){const tournamentRecord=tournamentRecords[tournamentId];if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const tournamentOutcomes=outcomes.filter((outcome=>outcome.tournamentId===tournamentId));if(tournamentOutcomes.length){const result=bulkMatchUpStatusUpdate$1({tournamentRecord,outcomes:tournamentOutcomes});if(result.error)return result}}return __spreadValues$3M({},SUCCESS)},bulkScheduleMatchUps,addPenalty:function addPenalty(params){const{tournamentRecords,participantIds}=params;let penaltyId;for(const tournamentRecord of Object.values(tournamentRecords)){const{tournamentParticipants}=getTournamentParticipants({tournamentRecord}),tournamentParticipantIds=getParticipantIds(tournamentParticipants).filter((participantId=>participantIds.includes(participantId)));if(tournamentParticipantIds.length){penaltyId=addPenalty$1(__spreadProps$1W(__spreadValues$3t({},params),{penaltyId:params.penaltyId||penaltyId,tournamentRecord,participantIds:tournamentParticipantIds})).penaltyId}}return penaltyId?__spreadProps$1W(__spreadValues$3t({},SUCCESS),{penaltyId}):{error:PARTICIPANT_NOT_FOUND}},removePenalty:function removePenalty(params){const{tournamentRecords}=params;if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};for(const tournamentRecord of Object.values(tournamentRecords)){const result=removePenalty$1(__spreadValues$3t({tournamentRecord},params));if(result.error&&result.error!==PENALTY_NOT_FOUND)return result}return __spreadValues$3t({},SUCCESS)},modifyPenalty:function modifyPenalty(params){const{tournamentRecords}=params;if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};for(const tournamentRecord of Object.values(tournamentRecords)){const result=modifyPenalty$1(__spreadValues$3t({tournamentRecord},params));if(result.error&&result.error!==PENALTY_NOT_FOUND)return result}return __spreadValues$3t({},SUCCESS)},getCompetitionPenalties:function getCompetitionPenalties({tournamentRecords}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const allPenalties=[];for(const tournamentRecord of Object.values(tournamentRecords)){const{penalties}=getTournamentPenalties({tournamentRecord});allPenalties.push(...penalties)}return{penalties:allPenalties}},findParticipant:publicFindParticipant};var __defProp$3s=Object.defineProperty,__getOwnPropSymbols$3t=Object.getOwnPropertySymbols,__hasOwnProp$3t=Object.prototype.hasOwnProperty,__propIsEnum$3t=Object.prototype.propertyIsEnumerable,__defNormalProp$3s=(obj,key,value)=>key in obj?__defProp$3s(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3s=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3t.call(b,prop)&&__defNormalProp$3s(a,prop,b[prop]);if(__getOwnPropSymbols$3t)for(var prop of __getOwnPropSymbols$3t(b))__propIsEnum$3t.call(b,prop)&&__defNormalProp$3s(a,prop,b[prop]);return a};function unPublishOrderOfPlay$1({removePriorValues=!0,tournamentRecord,status=PUBLIC}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const itemType=`${PUBLISH}.${STATUS$1}`,{timeItem}=getTournamentTimeItem({itemType}),itemValue=(null==timeItem?void 0:timeItem.itemValue)||{[status]:{}};itemValue[status]&&delete itemValue[status].orderOfPlay;return addTournamentTimeItem({timeItem:{itemValue,itemType},removePriorValues,tournamentRecord}),addNotice({topic:UNPUBLISH_ORDER_OF_PLAY,payload:{tournamentId:tournamentRecord.tournamentId}}),__spreadValues$3s({},SUCCESS)}function publishOrderOfPlay$1({scheduledDates=[],removePriorValues,tournamentRecord,status=PUBLIC,eventIds=[]}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const itemType=`${PUBLISH}.${STATUS$1}`,{timeItem}=getTournamentTimeItem({itemType}),itemValue=(null==timeItem?void 0:timeItem.itemValue)||{[status]:{}};itemValue[status].orderOfPlay={published:!0,scheduledDates,eventIds};return addTournamentTimeItem({timeItem:{itemValue,itemType},removePriorValues,tournamentRecord}),addNotice({topic:PUBLISH_ORDER_OF_PLAY,payload:{tournamentId:tournamentRecord.tournamentId,scheduledDates,eventIds}}),__spreadValues$3s({},SUCCESS)}var __defProp$3r=Object.defineProperty,__getOwnPropSymbols$3s=Object.getOwnPropertySymbols,__hasOwnProp$3s=Object.prototype.hasOwnProperty,__propIsEnum$3s=Object.prototype.propertyIsEnumerable,__defNormalProp$3r=(obj,key,value)=>key in obj?__defProp$3r(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3r=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3s.call(b,prop)&&__defNormalProp$3r(a,prop,b[prop]);if(__getOwnPropSymbols$3s)for(var prop of __getOwnPropSymbols$3s(b))__propIsEnum$3s.call(b,prop)&&__defNormalProp$3r(a,prop,b[prop]);return a};const publishingGovernor$1={unPublishOrderOfPlay:function unPublishOrderOfPlay(params){const tournamentRecords=null==params?void 0:params.tournamentRecords;if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};for(const tournamentRecord of Object.values(tournamentRecords)){const result=unPublishOrderOfPlay$1(__spreadValues$3r({tournamentRecord},params));if(result.error)return result}return __spreadValues$3r({},SUCCESS)},publishOrderOfPlay:function publishOrderOfPlay(params){const tournamentRecords=null==params?void 0:params.tournamentRecords;if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};for(const tournamentRecord of Object.values(tournamentRecords)){const result=publishOrderOfPlay$1(__spreadValues$3r({tournamentRecord},params));if(result.error)return result}return __spreadValues$3r({},SUCCESS)}};function getExtensionUpdate({tournamentRecords,extensionName}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const methods=[];let tournamentExtensionAdded;for(const tournamentRecord of Object.values(tournamentRecords)){const{extension}=findTournamentExtension({name:extensionName,tournamentRecord});extension&&!tournamentExtensionAdded&&(methods.push({method:"addExtension",params:{extension}}),tournamentExtensionAdded=!0);const tournamentEvents=tournamentRecord.events||[];for(const event of tournamentEvents){const{eventId}=event,{extension:extension2}=findEventExtension({name:extensionName,event});extension2&&methods.push({params:{eventId,extension:extension2},method:"addEventExtension"})}}return{methods}}var __defProp$3q=Object.defineProperty,__defProps$1V=Object.defineProperties,__getOwnPropDescs$1V=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3r=Object.getOwnPropertySymbols,__hasOwnProp$3r=Object.prototype.hasOwnProperty,__propIsEnum$3r=Object.prototype.propertyIsEnumerable,__defNormalProp$3q=(obj,key,value)=>key in obj?__defProp$3q(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3q=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3r.call(b,prop)&&__defNormalProp$3q(a,prop,b[prop]);if(__getOwnPropSymbols$3r)for(var prop of __getOwnPropSymbols$3r(b))__propIsEnum$3r.call(b,prop)&&__defNormalProp$3q(a,prop,b[prop]);return a},__spreadProps$1V=(a,b)=>__defProps$1V(a,__getOwnPropDescs$1V(b));function getEventMatchUpFormatTiming$1({tournamentRecord,matchUpFormats,categoryType,event}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};let matchUpFormatDefinitions=[];if(null==matchUpFormats?void 0:matchUpFormats.length){const uniqueMatchUpFormats=[];matchUpFormatDefinitions=matchUpFormats.map((definition=>{let definitionObject="string"==typeof definition?{matchUpFormat:definition}:definition;if(!uniqueMatchUpFormats.includes(null==definitionObject?void 0:definitionObject.matchUpFormat)&&isValid(null==definitionObject?void 0:definitionObject.matchUpFormat))return uniqueMatchUpFormats.push(definitionObject.matchUpFormat),definitionObject})).filter(Boolean)}else{const{policy}=findPolicy({policyType:POLICY_TYPE_SCORING,tournamentRecord,event});if(null==policy?void 0:policy.matchUpFormats)matchUpFormatDefinitions=null==policy?void 0:policy.matchUpFormats;else{const{extension}=findEventExtension({name:SCHEDULE_TIMING,event});if(!(null==extension?void 0:extension.value))return{error:MISSING_SCORING_POLICY};matchUpFormatDefinitions=unique([...(extension.value.matchUpAverageTimes||[]).map((at=>at.matchUpFormatCodes)),...(extension.value.matchUpRecoveryTimes||[]).map((at=>at.matchUpFormatCodes))].flat()).map((matchUpFormat=>({matchUpFormat})))}}const{eventType,eventId,category}=event,categoryName=(null==category?void 0:category.categoryName)||(null==category?void 0:category.ageCategoryCode)||eventId;if(!eventId)return{error:MISSING_EVENT};return{eventMatchUpFormatTiming:matchUpFormatDefinitions.map((({matchUpFormat,description})=>{const timing=getMatchUpFormatTiming({tournamentRecord,matchUpFormat,categoryName,categoryType,eventType,event});return Object.assign({},__spreadProps$1V(__spreadValues$3q({},timing),{description,matchUpFormat}))}))}}function validateSchedulingProfile({tournamentRecords,schedulingProfile}){if(!schedulingProfile)return{valid:!0};if(!Array.isArray(schedulingProfile))return{valid:!1,error:INVALID_VALUES};const{venueIds,tournamentsMap}=function getAllRelevantSchedulingIds({tournamentRecords={}}={}){const records=tournamentRecords&&Object.values(tournamentRecords)||[],tournamentsMap={},{venueIds,eventIds,drawIds,structureIds,tournamentIds}=records.reduce(((aggregator,tournamentRecord)=>{const{tournamentIds:tournamentIds2,tournamentMap,structureIds:structureIds2,venueIds:venueIds2,eventIds:eventIds2,drawIds:drawIds2}=tournamentRelevantSchedulingIds({tournamentRecord});return venueIds2.forEach((venueId=>{aggregator.venueIds.includes(venueId)||aggregator.venueIds.push(venueId)})),aggregator.tournamentIds.push(...tournamentIds2),aggregator.structureIds.push(...structureIds2),aggregator.eventIds.push(...eventIds2),aggregator.drawIds.push(...drawIds2),Object.assign(tournamentsMap,tournamentMap),aggregator}),{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap,tournamentIds,structureIds,venueIds,eventIds,drawIds}}({tournamentRecords});let error,info;const isValid=schedulingProfile.every((dateSchedule=>{const{scheduleDate,venues}=dateSchedule;return!!isValidDateString(scheduleDate)&&venues.every((venueProfile=>{const{venueId,rounds}=venueProfile;if("string"!=typeof venueId)return info="venueId should be a string",!1;if(!Array.isArray(rounds))return info="rounds should be an array",!1;if(!venueIds.includes(venueId))return error=VENUE_NOT_FOUND,!1;return!!rounds.every((round=>{if(!round)return info="empty round",!1;const{roundSegment,tournamentId,structureId,roundNumber,eventId,drawId}=round,rounds2=tournamentsMap[tournamentId]&&tournamentsMap[tournamentId][eventId]&&tournamentsMap[tournamentId][eventId][drawId]&&tournamentsMap[tournamentId][eventId][drawId][structureId],validRound=null==rounds2?void 0:rounds2.includes(roundNumber);validRound||(info="Invalid rounds");const{segmentNumber,segmentsCount}=roundSegment||{},validSegment=!roundSegment||isConvertableInteger(segmentNumber)&&isPowerOf2(segmentsCount)&&segmentNumber<=segmentsCount;return validSegment||(info="Invalid segment"),validRound&&validSegment}))}))}));return isValid||error||(error=INVALID_VALUES),{valid:!!isValid,error,info}}function tournamentRelevantSchedulingIds({tournamentRecord={},tournamentMap={},requireCourts}={}){const drawIds=[],eventIds=[],structureIds=[],tournamentIds=[],venueIds=((null==tournamentRecord?void 0:tournamentRecord.venues)||[]).map((({venueId,courts})=>(!requireCourts||(null==courts?void 0:courts.length))&&venueId)),tournamentId=null==tournamentRecord?void 0:tournamentRecord.tournamentId;if(tournamentId){tournamentIds.push(tournamentId),tournamentMap[tournamentId]={};((null==tournamentRecord?void 0:tournamentRecord.events)||[]).forEach((event=>{const eventId=event.eventId;eventIds.push(eventId),tournamentMap[tournamentId][eventId]={},(event.drawDefinitions||[]).forEach((drawDefinition=>{const drawId=drawDefinition.drawId;drawIds.push(drawId),tournamentMap[tournamentId][eventId][drawId]={};const{structures}=getDrawStructures({drawDefinition});(structures||[]).forEach((structure=>{var _a;const structureId=structure.structureId,{matchUps}=getAllStructureMatchUps({structure}),{roundMatchUps}=getRoundMatchUps$1({matchUps}),rounds=roundMatchUps&&Object.keys(roundMatchUps).map((roundNumber=>parseInt(roundNumber)));tournamentMap[tournamentId][eventId][drawId][structureId]=rounds,structureIds.push(structureId),(null==(_a=structure.structures)?void 0:_a.length)&&structure.structures.forEach((itemStructure=>{structureIds.push(itemStructure.structureId),tournamentMap[tournamentId][eventId][drawId][itemStructure.structureId]=rounds}))}))}))}))}return{tournamentMap,tournamentIds,structureIds,venueIds,eventIds,drawIds}}var __defProp$3p=Object.defineProperty,__getOwnPropSymbols$3q=Object.getOwnPropertySymbols,__hasOwnProp$3q=Object.prototype.hasOwnProperty,__propIsEnum$3q=Object.prototype.propertyIsEnumerable,__defNormalProp$3p=(obj,key,value)=>key in obj?__defProp$3p(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function getMatchUpFormat({tournamentRecord,drawDefinition,structureId,matchUpId,drawId,event}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!(drawId||event||structureId||matchUpId))return decorateResult({result:{error:MISSING_VALUE},stack:"getMatchUpFormat"});const matchUpResult=findMatchUp({tournamentRecord,drawDefinition,matchUpId,drawId,event});if(matchUpId&&(null==matchUpResult?void 0:matchUpResult.error))return matchUpResult;!drawDefinition&&(null==matchUpResult?void 0:matchUpResult.drawDefinition)&&(drawDefinition=null==matchUpResult?void 0:matchUpResult.drawDefinition);let structure=null==matchUpResult?void 0:matchUpResult.structure;if(!structure&&structureId&&!matchUpId){if(!drawDefinition)return{error:MISSING_DRAW_ID};const structureResult=findStructure({drawDefinition,structureId});if(structureResult.error)return structureResult;structure=structureResult.structure}const structureDefaultMatchUpFormat=null==structure?void 0:structure.matchUpFormat,drawDefaultMatchUpFormat=null==drawDefinition?void 0:drawDefinition.matchUpFormat,eventDefaultMatchUpFormat=null==event?void 0:event.matchUpFormat;return{structureDefaultMatchUpFormat,eventDefaultMatchUpFormat,drawDefaultMatchUpFormat,matchUpFormat:(null==(_a=null==matchUpResult?void 0:matchUpResult.matchUp)?void 0:_a.matchUpFormat)||structureDefaultMatchUpFormat||drawDefaultMatchUpFormat||eventDefaultMatchUpFormat}}function findMatchUpFormatTiming({defaultRecoveryMinutes=0,defaultAverageMinutes,tournamentRecords,tournamentId,matchUpFormat,categoryName,categoryType,eventType,eventId}){if(!isValid(matchUpFormat))return{error:UNRECOGNIZED_MATCHUP_FORMAT};let timing;return Object.keys(tournamentRecords).filter((currentTournamentId=>!tournamentId||currentTournamentId===tournamentId)).find((currentTournamentId=>{var _a;const tournamentRecord=tournamentRecords[currentTournamentId],event=eventId&&(null==(_a=findEvent({tournamentRecord,eventId}))?void 0:_a.event);return timing=getMatchUpFormatTiming({tournamentRecord,matchUpFormat,categoryName,categoryType,eventType,event}),(null==timing?void 0:timing.averageMinutes)||(null==timing?void 0:timing.recoveryMinutes)})),{averageMinutes:(null==timing?void 0:timing.averageMinutes)||defaultAverageMinutes,recoveryMinutes:(null==timing?void 0:timing.recoveryMinutes)||defaultRecoveryMinutes,typeChangeRecoveryMinutes:(null==timing?void 0:timing.typeChangeRecoveryMinutes)||(null==timing?void 0:timing.recoveryMinutes)||defaultRecoveryMinutes}}var __defProp$3o=Object.defineProperty,__getOwnPropSymbols$3p=Object.getOwnPropertySymbols,__hasOwnProp$3p=Object.prototype.hasOwnProperty,__propIsEnum$3p=Object.prototype.propertyIsEnumerable,__defNormalProp$3o=(obj,key,value)=>key in obj?__defProp$3o(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3o=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3p.call(b,prop)&&__defNormalProp$3o(a,prop,b[prop]);if(__getOwnPropSymbols$3p)for(var prop of __getOwnPropSymbols$3p(b))__propIsEnum$3p.call(b,prop)&&__defNormalProp$3o(a,prop,b[prop]);return a};function getScheduledRoundsDetails({scheduleCompletedMatchUps,containedStructureIds,tournamentRecords,periodLength=30,matchUps,rounds}){if("object"!=typeof tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!Array.isArray(rounds))return{error:MISSING_VALUE,info:mustBeAnArray("rounds")};const orderedMatchUpIds=[],sortedRounds=rounds.sort(((a,b)=>(a.sortOrder||0)-(b.sortOrder||0)));containedStructureIds=containedStructureIds||Object.assign({},...Object.values(tournamentRecords).map((tournamentRecord=>getContainedStructures({tournamentRecord}).containedStructures))),matchUps||({matchUps}=allCompetitionMatchUps({tournamentRecords,nextMatchUps:!0}));const minutesMap={},recoveryMinutesMap={},averageMinutesMap={};let greatestAverageMinutes=0;const scheduledRoundsDetails=sortedRounds.map((round=>{var _a;const roundPeriodLength=round.periodLength||periodLength,structureIds=containedStructureIds[round.structureId]||[round.structureId],roundMatchUpFilters={tournamentIds:[round.tournamentId],roundNumbers:[round.roundNumber],matchUpIds:round.matchUpIds,eventIds:[round.eventId],drawIds:[round.drawId],structureIds};let roundMatchUps=filterMatchUps(__spreadValues$3o({matchUps,processContext:!0},roundMatchUpFilters)).sort(matchUpSort);const{segmentNumber,segmentsCount}=round.roundSegment||{};if(isConvertableInteger(segmentNumber)&&isPowerOf2(null==roundMatchUps?void 0:roundMatchUps.length)&&isPowerOf2(segmentsCount)&&segmentNumber>0&&segmentNumber<=segmentsCount&&segmentsCount<(null==roundMatchUps?void 0:roundMatchUps.length)&&!(null==(_a=round.matchUpIds)?void 0:_a.length)){const segmentSize=roundMatchUps.length/segmentsCount,firstSegmentIndex=segmentSize*(segmentNumber-1);roundMatchUps=roundMatchUps.slice(firstSegmentIndex,firstSegmentIndex+segmentSize)}const tournamentRecord=tournamentRecords[round.tournamentId],{drawDefinition,event}=findEvent({drawId:round.drawId,tournamentRecord}),{matchUpFormat}=getMatchUpFormat({structureId:round.structureId,tournamentRecord,drawDefinition,event}),{eventType,category,categoryType}=event||{},{categoryName,ageCategoryCode}=category||{},{typeChangeRecoveryMinutes,recoveryMinutes,averageMinutes,error}=findMatchUpFormatTiming({categoryName:categoryName||ageCategoryCode,tournamentId:round.tournamentId,eventId:round.eventId,tournamentRecords,matchUpFormat,categoryType,eventType});if(error)return{error,round};const matchUpIds=roundMatchUps.filter((({matchUpStatus})=>(scheduleCompletedMatchUps||!completedMatchUpStatuses.includes(matchUpStatus))&&matchUpStatus!==BYE)).map(getMatchUpId);matchUpIds.forEach((matchUpId=>{minutesMap[matchUpId]={typeChangeRecoveryMinutes,recoveryMinutes,averageMinutes},recoveryMinutesMap[matchUpId]=recoveryMinutes,averageMinutesMap[matchUpId]=averageMinutes})),orderedMatchUpIds.push(...matchUpIds),greatestAverageMinutes=Math.max(averageMinutes||0,greatestAverageMinutes);return{roundPeriodLength,recoveryMinutes,averageMinutes,matchUpIds,hash:`${averageMinutes}|${roundPeriodLength}`}}));return __spreadValues$3o({scheduledRoundsDetails,greatestAverageMinutes,recoveryMinutesMap,averageMinutesMap,orderedMatchUpIds,minutesMap},SUCCESS)}function getCompetitionDateRange({tournamentRecords}){const dateRange=Object.keys(tournamentRecords).reduce(((dateRange2,tournamentId)=>{const tournamentRecord=tournamentRecords[tournamentId],{tournamentInfo:{startDate:startDate2,endDate:endDate2}}=getTournamentInfo({tournamentRecord}),dateOfStart=startDate2&&new Date(extractDate(startDate2));(!dateRange2.startDate||dateOfStart&&dateOfStart<dateRange2.startDate)&&(dateRange2.startDate=dateOfStart);const dateOfEnd=endDate2&&new Date(extractDate(endDate2));return(!dateRange2.endDate||dateOfEnd&&dateOfEnd>dateRange2.endDate)&&(dateRange2.endDate=dateOfEnd),dateRange2}),{startDate:void 0,endDate:void 0}),startDate=dateRange.startDate&&extractDate(dateRange.startDate.toISOString()),endDate=dateRange.endDate&&extractDate(dateRange.endDate.toISOString());return startDate&&endDate?{startDate,endDate}:{error:MISSING_DATE}}var __defProp$3n=Object.defineProperty,__defProps$1U=Object.defineProperties,__getOwnPropDescs$1U=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3o=Object.getOwnPropertySymbols,__hasOwnProp$3o=Object.prototype.hasOwnProperty,__propIsEnum$3o=Object.prototype.propertyIsEnumerable,__defNormalProp$3n=(obj,key,value)=>key in obj?__defProp$3n(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3n=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3o.call(b,prop)&&__defNormalProp$3n(a,prop,b[prop]);if(__getOwnPropSymbols$3o)for(var prop of __getOwnPropSymbols$3o(b))__propIsEnum$3o.call(b,prop)&&__defNormalProp$3n(a,prop,b[prop]);return a},__spreadProps$1U=(a,b)=>__defProps$1U(a,__getOwnPropDescs$1U(b));function getSchedulingProfile$1({tournamentRecords}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const{extension}=findExtension({name:SCHEDULING_PROFILE,tournamentRecords});let schedulingProfile=(null==extension?void 0:extension.value)||[];if(schedulingProfile.length){const{venueIds}=getCompetitionVenues({tournamentRecords,requireCourts:!0}),{eventIds,drawIds}=getEventIdsAndDrawIds({tournamentRecords}),{updatedSchedulingProfile,modifications,issues}=getUpdatedSchedulingProfile({schedulingProfile,venueIds,eventIds,drawIds});if(modifications){schedulingProfile=updatedSchedulingProfile;const result=setSchedulingProfile$1({tournamentRecords,schedulingProfile});return result.error?result:{schedulingProfile,modifications,issues}}}return{schedulingProfile,modifications:0}}function setSchedulingProfile$1({tournamentRecords,schedulingProfile}){const profileValidity=validateSchedulingProfile({tournamentRecords,schedulingProfile});if(profileValidity.error)return profileValidity;if(!schedulingProfile)return removeExtension({tournamentRecords,name:SCHEDULING_PROFILE});return addExtension({tournamentRecords,extension:{name:SCHEDULING_PROFILE,value:schedulingProfile}})}function addSchedulingProfileRound({tournamentRecords,scheduleDate,venueId,round}){if(!isValidDateString(scheduleDate))return{error:INVALID_DATE};const{extension}=findExtension({tournamentRecords,name:SCHEDULING_PROFILE}),schedulingProfile=(null==extension?void 0:extension.value)||[];let dateProfile=schedulingProfile.find((dateProfile2=>sameDay(scheduleDate,dateProfile2.scheduleDate)));if(!dateProfile){const{startDate,endDate}=getCompetitionDateRange({tournamentRecords}),dateObject=new Date(scheduleDate);if(dateObject<new Date(startDate)||dateObject>new Date(endDate))return{error:INVALID_DATE};dateProfile={scheduleDate,venues:[]},schedulingProfile.push(dateProfile)}let venueOnDate=dateProfile.venues.find((venue=>venue.venueId===venueId));venueOnDate||(venueOnDate={venueId,rounds:[]},dateProfile.venues.push(venueOnDate));const excludeKeys=["notBeforeTime"],hashRound=r=>Object.keys(r).filter((key=>!excludeKeys.includes(key))).sort().map((k=>isObject(r[k])?hashRound(r[k]):r[k])).flat().join("|");if(venueOnDate.rounds.find((existingRound=>hashRound(existingRound)===hashRound(round))))return decorateResult({result:{error:EXISTING_ROUND},stack:"addSchedulingProfileRound"});venueOnDate.rounds.push(round);const result=setSchedulingProfile$1({tournamentRecords,schedulingProfile});return result.error?result:__spreadValues$3n({},SUCCESS)}function getUpdatedSchedulingProfile({schedulingProfile,venueIds,eventIds,drawIds}){const issues=[];return{updatedSchedulingProfile:null==schedulingProfile?void 0:schedulingProfile.map((dateSchedulingProfile=>{const date=extractDate(null==dateSchedulingProfile?void 0:dateSchedulingProfile.scheduleDate);if(!date)return void issues.push(`Invalid date: ${null==dateSchedulingProfile?void 0:dateSchedulingProfile.scheduledDate}`);const venues=((null==dateSchedulingProfile?void 0:dateSchedulingProfile.venues)||[]).map((venue=>{const{rounds,venueId}=venue;if(!venueIds.includes(venueId))return void issues.push(`Missing venueId: ${venueId}`);const filteredRounds=rounds.filter((round=>{const validEventIdAndDrawId=eventIds.includes(round.eventId)&&drawIds.includes(round.drawId);return validEventIdAndDrawId||issues.push(`Invalid eventId: ${round.eventId} or drawId: ${round.drawId}`),validEventIdAndDrawId}));return filteredRounds.length?{venueId,rounds:filteredRounds}:void 0})).filter(Boolean);return venues.length&&date&&__spreadProps$1U(__spreadValues$3n({},dateSchedulingProfile),{venues})})).filter(Boolean),modifications:issues.length,issues}}function checkSchedulingProfile$1({tournamentRecords}){const{schedulingProfile}=getSchedulingProfile$1({tournamentRecords,requireCourts:!0});if(schedulingProfile){const{venueIds}=getCompetitionVenues({tournamentRecords}),{eventIds,drawIds}=getEventIdsAndDrawIds({tournamentRecords}),{updatedSchedulingProfile,modifications}=getUpdatedSchedulingProfile({schedulingProfile,venueIds,eventIds,drawIds});if(modifications)return setSchedulingProfile$1({tournamentRecords,schedulingProfile:updatedSchedulingProfile})}return __spreadValues$3n({},SUCCESS)}function scheduledSortedMatchUps({matchUps=[],schedulingProfile}){const profileHash={},getHash=({eventId,drawId,structureId,roundNumber})=>`${eventId}|${drawId}|${structureId}${roundNumber}`;if(null==schedulingProfile?void 0:schedulingProfile.length){schedulingProfile.map((({venues})=>venues.map((({rounds})=>rounds)))).flat().forEach((grouping=>{grouping.sort(((a,b)=>(a.sortOrder||0)-(b.sortOrder||0))).forEach((({eventId,drawId,structureId,roundNumber},index)=>{const hash=getHash({eventId,drawId,structureId,roundNumber});profileHash[hash]=index}))}))}const sortedMatchUps=[],dateGroups={noScheduledDate:[]};for(const matchUp of matchUps){const schedule=matchUp.schedule||{},scheduledDate=schedule.scheduledDate&&extractDate(schedule.scheduledDate)||schedule.scheduledTime&&extractDate(schedule.scheduledTime)||"noScheduledDate";dateGroups[scheduledDate]||(dateGroups[scheduledDate]=[]),dateGroups[scheduledDate].push(matchUp)}const sortedDateKeys=Object.keys(dateGroups).sort();for(const scheduledDate of sortedDateKeys){const dateGroup=dateGroups[scheduledDate],timeGroups={noScheduledTime:[]};for(const matchUp of dateGroup){const schedule=matchUp.schedule||{},scheduledTime=schedule.scheduledTime&&extractTime(schedule.scheduledTime)||"noScheduledTime";timeGroups[scheduledTime]||(timeGroups[scheduledTime]=[]),timeGroups[scheduledTime].push(matchUp)}const sortedTimeKeys=Object.keys(timeGroups).sort();for(const scheduledTime of sortedTimeKeys){const timeGroup=timeGroups[scheduledTime];timeGroup.sort(((a,b)=>(profileHash[getHash(a)]||0)-(profileHash[getHash(b)]||0))),sortedMatchUps.push(...timeGroup)}}return sortedMatchUps}var __defProp$3m=Object.defineProperty,__defProps$1T=Object.defineProperties,__getOwnPropDescs$1T=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3n=Object.getOwnPropertySymbols,__hasOwnProp$3n=Object.prototype.hasOwnProperty,__propIsEnum$3n=Object.prototype.propertyIsEnumerable,__defNormalProp$3m=(obj,key,value)=>key in obj?__defProp$3m(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3m=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3n.call(b,prop)&&__defNormalProp$3m(a,prop,b[prop]);if(__getOwnPropSymbols$3n)for(var prop of __getOwnPropSymbols$3n(b))__propIsEnum$3n.call(b,prop)&&__defNormalProp$3m(a,prop,b[prop]);return a},__spreadProps$1T=(a,b)=>__defProps$1T(a,__getOwnPropDescs$1T(b));function competitionScheduleMatchUps(params){var _a,_b,_c,_d;if("object"!=typeof(null==params?void 0:params.tournamentRecords)||!Object.keys(null==params?void 0:params.tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const{courts,venues}=getVenuesAndCourts(params),schedulingProfile=getSchedulingProfile$1(params).schedulingProfile,{matchUpFilters={},contextFilters={}}=params,{sortDateMatchUps=!0,courtCompletedMatchUps,alwaysReturnCompleted,activeTournamentId,tournamentRecords,withCourtGridRows,minCourtGridRows,usePublishState,status=PUBLIC,sortCourtsData}=params,timeItem=usePublishState&&getTournamentTimeItem({tournamentRecord:tournamentRecords[activeTournamentId],itemType:`${PUBLISH}.${STATUS$1}`}).timeItem,publishStatus=null==(_a=null==timeItem?void 0:timeItem.itemValue)?void 0:_a[status],allCompletedMatchUps=alwaysReturnCompleted?competitionMatchUps(__spreadProps$1T(__spreadValues$3m({},params),{matchUpFilters:__spreadProps$1T(__spreadValues$3m({},matchUpFilters),{matchUpStatuses:[COMPLETED$1]}),contextFilters})).completedMatchUps:[];if(usePublishState&&(!publishStatus||!Object.keys(publishStatus).length))return{completedMatchUps:allCompletedMatchUps,dateMatchUps:[],courtsData:[],venues};const publishedDrawIds=usePublishState&&function getCompetitionPublishedDrawIds({tournamentRecords}){var _a,_b;const drawIds=[];for(const tournamentRecord of Object.values(tournamentRecords))for(const event of tournamentRecord.events||[]){const{timeItem}=getEventTimeItem({itemType:`${PUBLISH}.${STATUS$1}`,event}),pubState=null==(_a=null==timeItem?void 0:timeItem.itemValue)?void 0:_a[PUBLIC];if(null==(_b=null==pubState?void 0:pubState.drawIds)?void 0:_b.length)drawIds.push(...pubState.drawIds);else{const eventDrawIds=(event.drawDefinitions||[]).map((({drawId})=>drawId)).filter(Boolean);drawIds.push(...eventDrawIds)}}return{drawIds}}({tournamentRecords}).drawIds;(null==publishedDrawIds?void 0:publishedDrawIds.length)&&(contextFilters.drawIds?contextFilters.drawIds=contextFilters.drawIds.filter((drawId=>publishedDrawIds.includes(drawId))):contextFilters.drawIds=publishedDrawIds),(null==(_b=null==publishStatus?void 0:publishStatus.eventIds)?void 0:_b.length)&&(matchUpFilters.eventIds&&matchUpFilters.eventIds.length?matchUpFilters.eventIds=matchUpFilters.eventIds.filter((eventId=>publishStatus.eventIds.includes(eventId))):matchUpFilters.eventIds=publishStatus.eventIds),(null==(_c=null==publishStatus?void 0:publishStatus.scheduledDates)?void 0:_c.length)&&(matchUpFilters.scheduledDates&&matchUpFilters.scheduledDates.length?matchUpFilters.scheduledDates=matchUpFilters.scheduledDates.filter((scheduledDate=>publishStatus.scheduledDates.includes(scheduledDate))):matchUpFilters.scheduledDates=publishStatus.scheduledDates),alwaysReturnCompleted&&((null==(_d=matchUpFilters.excludeMatchUpStatuses)?void 0:_d.length)?matchUpFilters.excludeMatchUpStatuses.includes(COMPLETED$1)||matchUpFilters.excludeMatchUpStatuses.push(COMPLETED$1):matchUpFilters.excludeMatchUpStatuses=[COMPLETED$1]);const{completedMatchUps,upcomingMatchUps,pendingMatchUps}=competitionMatchUps(__spreadProps$1T(__spreadValues$3m({},params),{matchUpFilters,contextFilters})),relevantMatchUps=[...upcomingMatchUps||[],...pendingMatchUps||[]],dateMatchUps=sortDateMatchUps?scheduledSortedMatchUps({matchUps:relevantMatchUps,schedulingProfile}):relevantMatchUps,courtsData=courts.map((court=>{const matchUps=function getCourtMatchUps({courtId}){const courtMatchUps=(courtCompletedMatchUps?dateMatchUps.concat(completedMatchUps||[]):dateMatchUps).filter((matchUp=>{var _a2,_b2,_c2;return(null==(_a2=matchUp.schedule)?void 0:_a2.courtId)===courtId||(null==(_c2=null==(_b2=matchUp.schedule)?void 0:_b2.allocatedCourts)?void 0:_c2.map((({courtId:courtId2})=>courtId2)).includes(courtId))}));return sortCourtsData?scheduledSortedMatchUps({matchUps:courtMatchUps,schedulingProfile}):courtMatchUps}(court);return __spreadValues$3m({surfaceCategory:(null==court?void 0:court.surfaceCategory)||"",matchUps},court)})),result={courtsData,completedMatchUps:alwaysReturnCompleted?allCompletedMatchUps:completedMatchUps,dateMatchUps,venues};if(withCourtGridRows){const{rows,courtPrefix}=courtGridRows({minRowsCount:minCourtGridRows,courtsData});result.courtPrefix=courtPrefix,result.rows=rows}return result}var __defProp$3l=Object.defineProperty,__defProps$1S=Object.defineProperties,__getOwnPropDescs$1S=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3m=Object.getOwnPropertySymbols,__hasOwnProp$3m=Object.prototype.hasOwnProperty,__propIsEnum$3m=Object.prototype.propertyIsEnumerable,__defNormalProp$3l=(obj,key,value)=>key in obj?__defProp$3l(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3l=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3m.call(b,prop)&&__defNormalProp$3l(a,prop,b[prop]);if(__getOwnPropSymbols$3m)for(var prop of __getOwnPropSymbols$3m(b))__propIsEnum$3m.call(b,prop)&&__defNormalProp$3l(a,prop,b[prop]);return a},__spreadProps$1S=(a,b)=>__defProps$1S(a,__getOwnPropDescs$1S(b));function calculateScheduleTimes({calculateStartTimeFromCourts=!0,defaultRecoveryMinutes=0,averageMatchUpMinutes=90,remainingScheduleTimes,clearScheduleDates,tournamentRecords,periodLength,scheduleDate,startTime,venueIds,endTime}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};periodLength=periodLength||calculatePeriodLength({recoveryMinutes:defaultRecoveryMinutes,averageMatchUpMinutes});const{courts:allCourts,venues}=getVenuesAndCourts({dates:[scheduleDate],ignoreDisabled:!0,tournamentRecords}),courts=allCourts.filter((court=>!venueIds||venueIds.includes(court.venueId)));startTime||(startTime=courts.reduce(((minStartTime,court)=>{var _a;const dateAvailability=null==(_a=court.dateAvailability)?void 0:_a.find((availability=>!availability.date||sameDay(scheduleDate,availability.date))),comparisonStartTime=(null==dateAvailability?void 0:dateAvailability.startTime)||court.startTime;return comparisonStartTime&&(!minStartTime||timeStringMinutes(comparisonStartTime)<timeStringMinutes(minStartTime))?comparisonStartTime:minStartTime}),void 0)),endTime||(endTime=courts.reduce(((maxEndTime,court)=>{var _a;const dateAvailability=null==(_a=court.dateAvailability)?void 0:_a.find((availability=>!availability.date||sameDay(scheduleDate,availability.date))),comparisonEndTime=(null==dateAvailability?void 0:dateAvailability.endTime)||court.endTime;return comparisonEndTime&&(!maxEndTime||timeStringMinutes(comparisonEndTime)>timeStringMinutes(maxEndTime))?comparisonEndTime:maxEndTime}),void 0));const eventDetails=Object.assign({},...Object.values(tournamentRecords).map((tournamentRecord=>(tournamentRecord.events||[]).map((event=>{const{scheduleTiming}=getScheduleTiming({tournamentRecord,event});return{[event.eventId]:{event,scheduleTiming}}})))).flat()),matchUpsWithSchedule=competitionScheduleMatchUps({afterRecoveryTimes:!0,sortDateMatchUps:!1,tournamentRecords,matchUpFilters:{scheduledDate:scheduleDate,venueIds}}),relevantMatchUps=[].concat(...matchUpsWithSchedule.dateMatchUps||[],...matchUpsWithSchedule.completedMatchUps||[]),defaultTiming={averageTimes:[{minutes:{default:averageMatchUpMinutes}}],recoveryTimes:[{minutes:{default:defaultRecoveryMinutes}}]},bookings=null==relevantMatchUps?void 0:relevantMatchUps.map((({eventId,schedule,matchUpFormat})=>{const{event,scheduleTiming}=eventDetails[eventId],eventType=null==event?void 0:event.eventType,timingDetails=__spreadProps$1S(__spreadValues$3l({},scheduleTiming),{defaultTiming,matchUpFormat}),{averageMinutes,recoveryMinutes}=matchUpFormatTimes({eventType,timingDetails}),{courtId,venueId:venueId2}=schedule,startTime2=extractTime(schedule.scheduledTime),endTime2=addMinutesToTimeString(startTime2,averageMinutes);return{recoveryMinutes,averageMinutes,periodLength,startTime:startTime2,endTime:endTime2,courtId,venueId:venueId2}})),timingParameters={calculateStartTimeFromCourts,remainingScheduleTimes,averageMatchUpMinutes,date:scheduleDate,clearScheduleDates,periodLength,startTime,endTime,bookings,courts},{scheduleTimes}=getScheduleTimes(timingParameters);return{venueId:1===(null==venueIds?void 0:venueIds.length)&&venueIds[0]||1===(null==venues?void 0:venues.length)&&venues[0].venueId||void 0,scheduleTimes,dateScheduledMatchUpIds:relevantMatchUps.map(getMatchUpId)}}function checkDependenciesScheduled({matchUpScheduleTimes,matchUpDependencies,allDateMatchUpIds,matchUp}){var _a;const matchUpIdDependencies=((null==(_a=null==matchUpDependencies?void 0:matchUpDependencies[matchUp.matchUpId])?void 0:_a.matchUpIds)||[]).filter((matchUpId=>allDateMatchUpIds.includes(matchUpId))),remainingDependencies=matchUpIdDependencies.filter((matchUpId=>!matchUpScheduleTimes[matchUpId]));return{dependenciesScheduled:!(null==remainingDependencies?void 0:remainingDependencies.length),remainingDependencies}}function processNextMatchUps({matchUpPotentialParticipantIds,matchUpNotBeforeTimes,timeAfterRecovery,matchUp}){var _a,_b,_c,_d;const{individualParticipantIds}=getIndividualParticipantIds(matchUp);timeAfterRecovery=timeAfterRecovery||(null==(_a=matchUp.schedule)?void 0:_a.timeAfterRecovery);const addPotentialParticipantIds=targetMatchUpId=>{matchUpPotentialParticipantIds[targetMatchUpId]||(matchUpPotentialParticipantIds[targetMatchUpId]=[]),matchUpPotentialParticipantIds[targetMatchUpId]=unique(matchUpPotentialParticipantIds[targetMatchUpId].concat(...individualParticipantIds))},updateNotBeforeTime=matchUpId=>{(!matchUpNotBeforeTimes[matchUpId]||timeAfterRecovery>matchUpNotBeforeTimes[matchUpId])&&(matchUpNotBeforeTimes[matchUpId]=timeAfterRecovery)},winnerMatchUpId=(null==(_b=matchUp.winnerTo)?void 0:_b.matchUpId)||matchUp.winnerMatchUpId;winnerMatchUpId&&(timeAfterRecovery&&updateNotBeforeTime(winnerMatchUpId),addPotentialParticipantIds(winnerMatchUpId));const loserMatchUpId=(null==(_c=matchUp.loserTo)?void 0:_c.matchUpId)||matchUp.loserMatchUpId;loserMatchUpId&&(timeAfterRecovery&&updateNotBeforeTime(loserMatchUpId),addPotentialParticipantIds(loserMatchUpId)),(null==(_d=matchUp.sidesTo)?void 0:_d.length)&&matchUp.sidesTo.forEach((({matchUpId})=>{matchUpId&&(timeAfterRecovery&&updateNotBeforeTime(matchUpId),addPotentialParticipantIds(matchUpId))}))}function checkParticipantProfileInitialization({individualParticipantProfiles,participantId}){individualParticipantProfiles[participantId]||(individualParticipantProfiles[participantId]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function updateTimeAfterRecovery({individualParticipantProfiles,matchUpPotentialParticipantIds,matchUpNotBeforeTimes,matchUpDependencies,averageMatchUpMinutes=0,typeChangeRecoveryMinutes,recoveryMinutes=0,scheduleTime,matchUp}){var _a,_b;const endTime=extractTime(null==(_a=null==matchUp?void 0:matchUp.schedule)?void 0:_a.endTime),timeAfterRecovery=endTime?addMinutesToTimeString(endTime,parseInt(recoveryMinutes)):addMinutesToTimeString(scheduleTime,parseInt(averageMatchUpMinutes)+parseInt(recoveryMinutes)),typeChangeTimeAfterRecovery=typeChangeRecoveryMinutes&&(endTime?addMinutesToTimeString(extractTime(endTime),typeChangeRecoveryMinutes):addMinutesToTimeString(scheduleTime,parseInt(averageMatchUpMinutes)+parseInt(typeChangeRecoveryMinutes))),participantIdDependencies=(null==(_b=null==matchUpDependencies?void 0:matchUpDependencies[matchUp.matchUpId])?void 0:_b.participantIds)||[],potentialIndividualParticipantIds=(matchUp.roundPosition&&matchUpPotentialParticipantIds[matchUp.matchUpId]||[]).flat();participantIdDependencies.forEach((participantId=>{checkParticipantProfileInitialization({individualParticipantProfiles,participantId});const recoveryValue=individualParticipantProfiles[participantId].priorMatchUpType!==matchUp.matchUpType&&typeChangeTimeAfterRecovery||timeAfterRecovery;potentialIndividualParticipantIds.includes(participantId)?function addParticipantPotentialRecovery({individualParticipantProfiles,recoveryValue,participantId,scheduleTime,drawId}){individualParticipantProfiles[participantId].potentialRecovery[drawId]||(individualParticipantProfiles[participantId].potentialRecovery[drawId]=[]),individualParticipantProfiles[participantId].potentialRecovery[drawId].push(recoveryValue),individualParticipantProfiles[participantId].potentialBookings[drawId]||(individualParticipantProfiles[participantId].potentialBookings[drawId]=[]),individualParticipantProfiles[participantId].potentialBookings[drawId].push({timeAfterRecovery:recoveryValue,scheduleTime})}({individualParticipantProfiles,drawId:matchUp.drawId,recoveryValue,participantId,scheduleTime}):(individualParticipantProfiles[participantId].timeAfterRecovery=recoveryValue,individualParticipantProfiles[participantId].bookings.push({scheduleTime,timeAfterRecovery:recoveryValue}))})),processNextMatchUps({matchUpPotentialParticipantIds,matchUpNotBeforeTimes,timeAfterRecovery,matchUp})}function checkDependendantTiming({matchUpScheduleTimes,matchUpDependencies,scheduleTime,matchUpId,details}){var _a,_b,_c,_d,_e;let scheduledDependent;const recoveryMinutes=null==(_b=null==(_a=details.minutesMap)?void 0:_a[matchUpId])?void 0:_b.recoveryMinutes,dependentNotBeforeTime=addMinutesToTimeString(scheduleTime,((null==(_d=null==(_c=details.minutesMap)?void 0:_c[matchUpId])?void 0:_d.averageMinutes)||0)+(recoveryMinutes||0)),matchUpIdDependents=(null==(_e=null==matchUpDependencies?void 0:matchUpDependencies[matchUpId])?void 0:_e.dependentMatchUpIds)||[];if(matchUpIdDependents.length){const earliestDependent=matchUpIdDependents.reduce(((dependent,candidateId)=>{const candidateScheduleTime=matchUpScheduleTimes[candidateId];if(!candidateScheduleTime)return dependent;const candidateDependent={scheduleTime:candidateScheduleTime,matchUpId:candidateId};return candidateScheduleTime&&!dependent.matchUpId||timeStringMinutes(candidateScheduleTime)<timeStringMinutes(dependent.scheduleTime)?candidateDependent:dependent}),{});earliestDependent.scheduleTime&&timeStringMinutes(dependentNotBeforeTime)>timeStringMinutes(earliestDependent.scheduleTime)&&(scheduledDependent=earliestDependent)}return{scheduledDependent}}const DO_NOT_SCHEDULE="DO_NOT_SCHEDULE";var __defProp$3k=Object.defineProperty,__defProps$1R=Object.defineProperties,__getOwnPropDescs$1R=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3l=Object.getOwnPropertySymbols,__hasOwnProp$3l=Object.prototype.hasOwnProperty,__propIsEnum$3l=Object.prototype.propertyIsEnumerable,__defNormalProp$3k=(obj,key,value)=>key in obj?__defProp$3k(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3k=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3l.call(b,prop)&&__defNormalProp$3k(a,prop,b[prop]);if(__getOwnPropSymbols$3l)for(var prop of __getOwnPropSymbols$3l(b))__propIsEnum$3l.call(b,prop)&&__defNormalProp$3k(a,prop,b[prop]);return a},__spreadProps$1R=(a,b)=>__defProps$1R(a,__getOwnPropDescs$1R(b));function checkRequestConflicts({averageMatchUpMinutes=90,requestConflicts={},potentials=!0,personRequests,scheduleTime,scheduleDate,matchUp}){const personIds=function getIndividualParticipants(matchUp){const{sides,matchUpType}=matchUp||{};return(sides||[]).map((side=>{var _a;return matchUpType===DOUBLES$1?(null==(_a=null==side?void 0:side.participant)?void 0:_a.individualParticipants)||[]:(null==side?void 0:side.participant)?[side.participant]:[]})).flat()}(matchUp).map((({person})=>null==person?void 0:person.personId));if(potentials){const potentialPersonIds=((null==matchUp?void 0:matchUp.potentialParticipants)||[]).flat().map((({person})=>null==person?void 0:person.personId));personIds.push(...potentialPersonIds)}const relevantPersonRequests=personIds.map((personId=>{var _a;return null==(_a=personRequests[personId])?void 0:_a.map((request=>__spreadProps$1R(__spreadValues$3k({},request),{personId})))})).filter(Boolean).flat().filter((request=>request.requestType===DO_NOT_SCHEDULE&&sameDay(scheduleDate,request.date))),conflicts=[],matchUpId=null==matchUp?void 0:matchUp.matchUpId,scheduleStart=timeToDate(extractTime(scheduleTime),extractDate(scheduleDate)),averageEnd=extractTime(addMinutes(scheduleStart,averageMatchUpMinutes).toISOString());for(const request of relevantPersonRequests){const{requestId,startTime,endTime}=request;(scheduleTime>startTime&&scheduleTime<endTime||averageEnd>startTime&&averageEnd<endTime)&&(conflicts.push({matchUpId,request,scheduleTime}),requestConflicts[requestId]?(requestConflicts[requestId].scheduleTimes.includes(scheduleTime)||requestConflicts[requestId].scheduleTimes.push(scheduleTime),requestConflicts[requestId].matchUpIds.includes(matchUpId)||requestConflicts[requestId].matchUpIds.push(matchUpId)):requestConflicts[requestId]={request,scheduleTimes:[scheduleTime],matchUpIds:[matchUpId]})}return{conflicts}}function modifyParticipantMatchUpsCount({matchUpPotentialParticipantIds,individualParticipantProfiles,matchUp,value}){const{matchUpType}=matchUp,{individualParticipantIds}=getIndividualParticipantIds(matchUp),filteredPotentials=(matchUpPotentialParticipantIds[matchUp.matchUpId]||[]).filter((potentials=>!overlap(potentials,individualParticipantIds))).flat();[...individualParticipantIds,...filteredPotentials].forEach((participantId=>{if(checkParticipantProfileInitialization({individualParticipantProfiles,participantId}),!individualParticipantProfiles[participantId].potentialCounted[matchUp.drawId]){const counters=individualParticipantProfiles[participantId].counters;counters[matchUpType]?counters[matchUpType]+=value:value>0&&(counters[matchUpType]=value),counters[TOTAL]?counters[TOTAL]+=value:value>0&&(counters[TOTAL]=value),filteredPotentials.includes(participantId)&&(individualParticipantProfiles[participantId].potentialCounted[matchUp.drawId]=!0)}}))}function processAlreadyScheduledMatchUps({matchUpPotentialParticipantIds,individualParticipantProfiles,dateScheduledMatchUpIds,greatestAverageMinutes,dateScheduledMatchUps,matchUpNotBeforeTimes,matchUpScheduleTimes,matchUpDependencies,clearScheduleDates,scheduleDate,minutesMap,matchUps}){var _a,_b;dateScheduledMatchUpIds||(dateScheduledMatchUps=null==matchUps?void 0:matchUps.filter((matchUp=>hasSchedule(matchUp)&&(!scheduleDate||matchUp.schedule.scheduledDate===scheduleDate))),dateScheduledMatchUpIds=dateScheduledMatchUps.map(getMatchUpId));const clearDate=Array.isArray(clearScheduleDates)?clearScheduleDates.includes(scheduleDate):clearScheduleDates,alreadyScheduled=clearDate?[]:matchUps.filter((({matchUpId})=>dateScheduledMatchUpIds.includes(matchUpId)));for(const matchUp of alreadyScheduled){modifyParticipantMatchUpsCount({matchUpPotentialParticipantIds,individualParticipantProfiles,scheduleDate,matchUp,value:1});const scheduleTime=null==(_a=matchUp.schedule)?void 0:_a.scheduledTime;if(scheduleTime){matchUpScheduleTimes[matchUp.matchUpId]=scheduleTime;updateTimeAfterRecovery({individualParticipantProfiles,matchUpPotentialParticipantIds,matchUpNotBeforeTimes,matchUpDependencies,recoveryMinutes:null==(_b=null==minutesMap?void 0:minutesMap[matchUp.matchUpId])?void 0:_b.recoveryMinutes,averageMatchUpMinutes:greatestAverageMinutes,scheduleDate,scheduleTime,matchUp})}}return{clearDate,dateScheduledMatchUpIds,dateScheduledMatchUps}}function getGroupedRounds({scheduledRoundsDetails,greatestAverageMinutes,garmanSinglePass}){let lastHash,averageMinutes,recoveryMinutes,roundPeriodLength,groupedMatchUpIds=[],groupedRounds=[];for(const roundDetails of scheduledRoundsDetails)lastHash||(lastHash=roundDetails.hash),(roundDetails.hash===lastHash||garmanSinglePass)&&(groupedMatchUpIds=groupedMatchUpIds.concat(roundDetails.matchUpIds)),roundDetails.hash===lastHash||garmanSinglePass||(lastHash=roundDetails.hash,groupedRounds.push({averageMinutes,recoveryMinutes,roundPeriodLength,matchUpIds:groupedMatchUpIds}),groupedMatchUpIds=roundDetails.matchUpIds),averageMinutes=garmanSinglePass?greatestAverageMinutes:roundDetails.averageMinutes,recoveryMinutes=roundDetails.recoveryMinutes,roundPeriodLength=roundDetails.roundPeriodLength;return groupedMatchUpIds.length&&groupedRounds.push({averageMinutes,recoveryMinutes,roundPeriodLength,matchUpIds:groupedMatchUpIds}),{groupedRounds}}function getMatchUpsToSchedule({matchUpPotentialParticipantIds,scheduleCompletedMatchUps,dateScheduledMatchUpIds,matchUpNotBeforeTimes,orderedMatchUpIds,clearDate,matchUps}){const matchUpsToSchedule=orderedMatchUpIds.map((matchUpId=>matchUps.find((matchUp=>matchUp.matchUpId===matchUpId)))).filter(Boolean).filter((matchUp=>{const alreadyScheduled=!clearDate&&dateScheduledMatchUpIds.includes(matchUp.matchUpId),doNotSchedule=[BYE,DEFAULTED,COMPLETED$1,ABANDONED,RETIRED$1,WALKOVER$2,DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(null==matchUp?void 0:matchUp.matchUpStatus);return scheduleCompletedMatchUps||!alreadyScheduled&&!matchUp.winningSide&&!doNotSchedule})),{matchUpMap}=matchUpsToSchedule.reduce(((aggregator,matchUp)=>{const{drawId,tournamentId}=matchUp;return aggregator.matchUpMap[tournamentId]||(aggregator.matchUpMap[tournamentId]={}),aggregator.matchUpMap[tournamentId][drawId]?aggregator.matchUpMap[tournamentId][drawId].push(matchUp):aggregator.matchUpMap[tournamentId][drawId]=[matchUp],processNextMatchUps({matchUpPotentialParticipantIds,matchUpNotBeforeTimes,matchUp}),aggregator}),{matchUpMap:{}});return{matchUpsToSchedule,matchUpMap}}var __defProp$3j=Object.defineProperty,__defProps$1Q=Object.defineProperties,__getOwnPropDescs$1Q=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3k=Object.getOwnPropertySymbols,__hasOwnProp$3k=Object.prototype.hasOwnProperty,__propIsEnum$3k=Object.prototype.propertyIsEnumerable,__defNormalProp$3j=(obj,key,value)=>key in obj?__defProp$3j(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3j=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3k.call(b,prop)&&__defNormalProp$3j(a,prop,b[prop]);if(__getOwnPropSymbols$3k)for(var prop of __getOwnPropSymbols$3k(b))__propIsEnum$3k.call(b,prop)&&__defNormalProp$3j(a,prop,b[prop]);return a},__spreadProps$1Q=(a,b)=>__defProps$1Q(a,__getOwnPropDescs$1Q(b));function generateBookings({defaultRecoveryMinutes=0,averageMatchUpMinutes=90,dateScheduledMatchUps,tournamentRecords,venueIds=[],periodLength,scheduleDate,matchUps}){if("object"!=typeof tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!Array.isArray(matchUps)&&!Array.isArray(dateScheduledMatchUps))return{error:MISSING_MATCHUPS};periodLength=periodLength||calculatePeriodLength({recoveryMinutes:defaultRecoveryMinutes,averageMatchUpMinutes});const eventDetails=Object.assign({},...Object.values(tournamentRecords).map((tournamentRecord=>(tournamentRecord.events||[]).map((event=>{const{scheduleTiming}=getScheduleTiming({tournamentRecord,event});return{[event.eventId]:{event,scheduleTiming}}})))).flat()),defaultTiming={averageTimes:[{minutes:{default:averageMatchUpMinutes}}],recoveryTimes:[{minutes:{default:defaultRecoveryMinutes}}]};dateScheduledMatchUps||(dateScheduledMatchUps=null==matchUps?void 0:matchUps.filter((matchUp=>hasSchedule(matchUp)&&(!scheduleDate||matchUp.schedule.scheduledDate===scheduleDate))));const relevantMatchUps=null==dateScheduledMatchUps?void 0:dateScheduledMatchUps.filter((matchUp=>!venueIds.length||venueIds.includes(matchUp.schedule.venueId)));return{bookings:null==relevantMatchUps?void 0:relevantMatchUps.map((({eventId,schedule,matchUpFormat})=>{const{event,scheduleTiming}=eventDetails[eventId],eventType=null==event?void 0:event.eventType,timingDetails=__spreadProps$1Q(__spreadValues$3j({},scheduleTiming),{defaultTiming,matchUpFormat}),{averageMinutes,recoveryMinutes}=matchUpFormatTimes({timingDetails,eventType}),{courtId,venueId}=schedule,startTime=extractTime(schedule.scheduledTime),endTime=addMinutesToTimeString(startTime,averageMinutes);return{recoveryMinutes,averageMinutes,periodLength,startTime,courtId,endTime,venueId}})).filter(Boolean),relevantMatchUps,dateScheduledMatchUps}}function generateScheduleTimes({calculateStartTimeFromCourts=!0,remainingScheduleTimes,defaultRecoveryMinutes,averageMatchUpMinutes,clearScheduleDates,tournamentRecords,tournamentRecord,periodLength,scheduleDate,startTime,venueIds,matchUps,endTime}){if(tournamentRecord&&!tournamentRecords&&(tournamentRecords={[tournamentRecord.tournamentId]:tournamentRecord}),"object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};periodLength=periodLength||calculatePeriodLength({recoveryMinutes:defaultRecoveryMinutes,averageMatchUpMinutes});const{courts:allCourts,venues}=getVenuesAndCourts({dates:[scheduleDate],ignoreDisabled:!0,tournamentRecords}),courts=allCourts.filter((court=>!venueIds||venueIds.includes(court.venueId)));startTime=startTime||getDateTimeBoundary({courts,scheduleDate,startTime:!0}),endTime=endTime||getDateTimeBoundary({courts,scheduleDate,endTime:!0});const{bookings,dateScheduledMatchUps}=generateBookings({defaultRecoveryMinutes,averageMatchUpMinutes,tournamentRecords,scheduleDate,periodLength,venueIds,matchUps}),timingParameters={calculateStartTimeFromCourts,remainingScheduleTimes,averageMatchUpMinutes,clearScheduleDates,date:scheduleDate,periodLength,startTime,bookings,endTime,courts},{scheduleTimes}=getScheduleTimes(timingParameters),venueId=1===(null==venueIds?void 0:venueIds.length)?venueIds[0]:1===(null==venues?void 0:venues.length)?venues[0].venueId:void 0;return{dateScheduledMatchUpIds:null==dateScheduledMatchUps?void 0:dateScheduledMatchUps.map(getMatchUpId),dateScheduledMatchUps,scheduleTimes,venueId}}function getVenueSchedulingDetails({matchUpPotentialParticipantIds,individualParticipantProfiles,scheduleCompletedMatchUps,containedStructureIds,matchUpNotBeforeTimes,matchUpScheduleTimes,matchUpDependencies,clearScheduleDates,tournamentRecords,periodLength,scheduleDate,useGarman,matchUps,courts,venues}){var _a;const venueScheduledRoundDetails={},allDateScheduledMatchUpIds=[],allDateMatchUpIds=[];for(const venue of venues){const{rounds=[],venueId}=venue,{scheduledRoundsDetails,greatestAverageMinutes,orderedMatchUpIds,minutesMap}=getScheduledRoundsDetails({scheduleCompletedMatchUps,containedStructureIds,tournamentRecords,periodLength,matchUps,rounds});allDateMatchUpIds.push(...orderedMatchUpIds);const{groupedRounds}=getGroupedRounds({scheduledRoundsDetails,greatestAverageMinutes,garmanSinglePass:!0});let dateScheduledMatchUpIds,dateScheduledMatchUps,clearDate,scheduleTimes=[];useGarman&&({scheduleTimes,dateScheduledMatchUpIds,dateScheduledMatchUps}=generateScheduleTimes({averageMatchUpMinutes:null==(_a=groupedRounds[0])?void 0:_a.averageMinutes,scheduleDate:extractDate(scheduleDate),venueIds:[venue.venueId],clearScheduleDates,tournamentRecords,periodLength,matchUps})),({clearDate,dateScheduledMatchUpIds,dateScheduledMatchUps}=processAlreadyScheduledMatchUps({matchUpPotentialParticipantIds,individualParticipantProfiles,dateScheduledMatchUpIds,greatestAverageMinutes,matchUpNotBeforeTimes,matchUpScheduleTimes,matchUpDependencies,clearScheduleDates,scheduleDate,minutesMap,matchUps}));const{matchUpsToSchedule,matchUpMap}=getMatchUpsToSchedule({matchUpPotentialParticipantIds,scheduleCompletedMatchUps,dateScheduledMatchUpIds,matchUpNotBeforeTimes,orderedMatchUpIds,clearDate,matchUps}),venueCourts=courts.filter((court=>court.venueId===venueId));venueScheduledRoundDetails[venueId]={previousRemainingScheduleTimes:[],courtsCount:venueCourts.length,greatestAverageMinutes,scheduledRoundsDetails,dateScheduledMatchUps,matchUpsToSchedule,scheduleTimes,groupedRounds,venueCourts,minutesMap,matchUpMap},clearScheduleDates||allDateScheduledMatchUpIds.push(...dateScheduledMatchUpIds)}return{allDateScheduledMatchUpIds,venueScheduledRoundDetails,allDateMatchUpIds}}function checkRecoveryTime({individualParticipantProfiles,matchUpNotBeforeTimes,matchUpDependencies,scheduleTime,matchUp,details}){var _a,_b,_c,_d,_e;const participantIdDependencies=((null==(_a=null==matchUpDependencies?void 0:matchUpDependencies[matchUp.matchUpId])?void 0:_a.participantIds)||[]).flat(),averageMatchUpMinutes=(null==(_c=null==(_b=null==details?void 0:details.minutesMap)?void 0:_b[matchUp.matchUpId])?void 0:_c.averageMinutes)||0,recoveryMinutes=(null==(_e=null==(_d=null==details?void 0:details.minutesMap)?void 0:_d[matchUp.matchUpId])?void 0:_e.recoveryMinutes)||0,sufficientTimeForIndiiduals=participantIdDependencies.every((participantId=>{var _a2;checkParticipantProfileInitialization({individualParticipantProfiles,participantId});let profile=individualParticipantProfiles[participantId];if(!profile.timeAfterRecovery)return!0;const endTime=extractTime(null==(_a2=null==matchUp?void 0:matchUp.schedule)?void 0:_a2.endTime),timeAfterRecovery=endTime?addMinutesToTimeString(endTime,parseInt(recoveryMinutes)):addMinutesToTimeString(scheduleTime,parseInt(averageMatchUpMinutes)+parseInt(recoveryMinutes));return!!![...Object.keys(profile.potentialBookings).filter((drawId=>drawId!==matchUp.drawId)).map((drawId=>profile.potentialBookings[drawId])).flat(),...profile.bookings].find((booking=>function analyzeScheduleOverlap(a,b){const startA=timeStringMinutes(a.scheduleTime),endA=timeStringMinutes(a.timeAfterRecovery),startB=timeStringMinutes(b.scheduleTime),endB=timeStringMinutes(b.timeAfterRecovery),startAisContained=startA>startB&&startA<endB,startBisContained=startB>startA&&startB<endA,endAisContained=endA>startB&&endA<endB,endBisContained=endB>startA&&endB<endA;return definedAttributes({hasOverlap:startA===startB||endA===endB||startAisContained||endAisContained||startBisContained||endBisContained,startAisContained,endAisContained,startBisContained,endBisContained},!0)}({scheduleTime,timeAfterRecovery},booking).hasOverlap))})),notBeforeTime=matchUpNotBeforeTimes[matchUp.matchUpId],timeBetweenMatchUps=notBeforeTime?minutesDifference(timeToDate(notBeforeTime),timeToDate(scheduleTime),!1):0;return{enoughTime:sufficientTimeForIndiiduals&&timeBetweenMatchUps>=0}}function checkDailyLimits({individualParticipantProfiles,matchUpPotentialParticipantIds,matchUpDailyLimits={},matchUp}){const{matchUpId,matchUpType}=matchUp,{enteredIndividualParticipantIds}=getIndividualParticipantIds(matchUp),potentialParticipantIds=(matchUp.roundPosition&&matchUpPotentialParticipantIds[matchUpId]||[]).flat(),relevantParticipantIds=unique(enteredIndividualParticipantIds.concat(...potentialParticipantIds));relevantParticipantIds.forEach((participantId=>{checkParticipantProfileInitialization({individualParticipantProfiles,participantId})}));return{participantIdsAtLimit:relevantParticipantIds.filter((participantId=>{const profile=individualParticipantProfiles[participantId];if(profile)return[matchUpType,TOTAL].find((counterName=>{const participantCount=profile.counters&&profile.counters[counterName]||0,dailyLimit=matchUpDailyLimits[counterName]||0;return participantCount&&dailyLimit&&participantCount>=dailyLimit}))})),relevantParticipantIds}}const DELETE_DRAW_DEFINITIONS="deleteDrawDefinitions",AUTO_SCHEDULING_AUDIT="autoSchedulingAudit";function auditAutoScheduling({autoSchedulingAudit,tournamentRecords}){var _a;addNotice({topic:AUDIT,payload:autoSchedulingAudit});const getCount=obj=>{if(!obj)return 0;return Object.values(obj).reduce(((count,value)=>count+value.length||0),0)},profileRoundsCount=((null==autoSchedulingAudit?void 0:autoSchedulingAudit.schedulingProfile)||[]).reduce(((count,dateProfile)=>count+dateProfile.venues.reduce(((vc,venue)=>vc+venue.rounds.length),0)),0),itemValue={scheduledDatesCount:null==(_a=autoSchedulingAudit.scheduledDates)?void 0:_a.length,noTimeMatchUpIdsCount:getCount(null==autoSchedulingAudit?void 0:autoSchedulingAudit.noTimeMatchUpIds),scheduledMatchUpIdsCount:getCount(null==autoSchedulingAudit?void 0:autoSchedulingAudit.scheduledMatchUpIds),overLimitMatchUpIdsCount:getCount(null==autoSchedulingAudit?void 0:autoSchedulingAudit.overLimitMatchUpIds),requestConflictsCount:getCount(null==autoSchedulingAudit?void 0:autoSchedulingAudit.requestConflicts),profileRoundsCount},timeItem={itemType:AUTO_SCHEDULING_AUDIT,itemValue};for(const tournamentRecord of Object.values(tournamentRecords))addTournamentTimeItem({tournamentRecord,timeItem})}var __defProp$3i=Object.defineProperty,__defProps$1P=Object.defineProperties,__getOwnPropDescs$1P=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3j=Object.getOwnPropertySymbols,__hasOwnProp$3j=Object.prototype.hasOwnProperty,__propIsEnum$3j=Object.prototype.propertyIsEnumerable,__defNormalProp$3i=(obj,key,value)=>key in obj?__defProp$3i(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3i=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3j.call(b,prop)&&__defNormalProp$3i(a,prop,b[prop]);if(__getOwnPropSymbols$3j)for(var prop of __getOwnPropSymbols$3j(b))__propIsEnum$3j.call(b,prop)&&__defNormalProp$3i(a,prop,b[prop]);return a},__spreadProps$1P=(a,b)=>__defProps$1P(a,__getOwnPropDescs$1P(b));function getEarliestCourtTime({averageMinutes,startTime,endTime,court,date}){if(!Array.isArray(court.dateAvailability))return{error:MISSING_VALUE,stack:"getEarliestCourtTime"};const courtStartTime=getDateTimeBoundary({scheduleDate:date,courts:[court],startTime:!0}),courtEndTime=getDateTimeBoundary({scheduleDate:date,courts:[court],endTime:!0});startTime=startTime||courtStartTime,endTime=endTime||courtEndTime;const timeSlots=generateTimeSlots({courtDate:getCourtDateAvailability({court,date})}),dateStartTime=timeToDate(startTime),dateEndTime=timeToDate(endTime);return{earliestCourtTime:timeSlots.reduce(((first,timeSlot)=>{const timeSlotStartTime=timeToDate(timeSlot.startTime),timeSlotEndTime=timeToDate(timeSlot.endTime);if(timeSlotStartTime>dateEndTime||timeSlotEndTime<dateStartTime)return first;const consideredStartTime=dateStartTime>timeSlotStartTime?dateStartTime:timeSlotStartTime;if(minutesDifference(consideredStartTime,timeSlotEndTime)>=averageMinutes){const timeString=extractTime(consideredStartTime.toISOString());(!first||timeString<first)&&(first=timeString)}return first}),void 0),courtStartTime,courtEndTime}}var __defProp$3h=Object.defineProperty,__defProps$1O=Object.defineProperties,__getOwnPropDescs$1O=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3i=Object.getOwnPropertySymbols,__hasOwnProp$3i=Object.prototype.hasOwnProperty,__propIsEnum$3i=Object.prototype.propertyIsEnumerable,__defNormalProp$3h=(obj,key,value)=>key in obj?__defProp$3h(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3h=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3i.call(b,prop)&&__defNormalProp$3h(a,prop,b[prop]);if(__getOwnPropSymbols$3i)for(var prop of __getOwnPropSymbols$3i(b))__propIsEnum$3i.call(b,prop)&&__defNormalProp$3h(a,prop,b[prop]);return a},__spreadProps$1O=(a,b)=>__defProps$1O(a,__getOwnPropDescs$1O(b));var __defProp$3g=Object.defineProperty,__getOwnPropSymbols$3h=Object.getOwnPropertySymbols,__hasOwnProp$3h=Object.prototype.hasOwnProperty,__propIsEnum$3h=Object.prototype.propertyIsEnumerable,__defNormalProp$3g=(obj,key,value)=>key in obj?__defProp$3g(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3g=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3h.call(b,prop)&&__defNormalProp$3g(a,prop,b[prop]);if(__getOwnPropSymbols$3h)for(var prop of __getOwnPropSymbols$3h(b))__propIsEnum$3h.call(b,prop)&&__defNormalProp$3g(a,prop,b[prop]);return a};function getPersonRequests({tournamentRecords,requestType}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const personRequests={};for(const tournamentRecord of Object.values(tournamentRecords)){const{extension}=findTournamentExtension({name:PERSON_REQUESTS,tournamentRecord}),requestObjects=(null==extension?void 0:extension.value)||[];for(const requestObject of requestObjects){const{personId,requests}=requestObject||{};personRequests[personId]||(personRequests[personId]=[]);for(const request of requests)requestType&&request.requestType!==requestType||personRequests[personId].push(request)}}return{personRequests}}function savePersonRequests({tournamentRecords,personRequests}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};for(const tournamentRecord of Object.values(tournamentRecords)){const{participants:tournamentParticipants}=tournamentRecord,relevantPersonRequests=[];for(const personId of Object.keys(personRequests))if(findParticipant({tournamentParticipants,personId})){const requests=personRequests[personId];requests.length&&relevantPersonRequests.push({personId,requests})}if(Object.keys(relevantPersonRequests).length){addTournamentExtension({tournamentRecord,extension:{name:PERSON_REQUESTS,value:relevantPersonRequests}})}}return __spreadValues$3g({},SUCCESS)}function mergePersonRequests({personRequests,personId,requests}){personRequests[personId]||(personRequests[personId]=[]);const filteredRequests=requests.filter((({requestType})=>requestType)).map((request=>{let{date,requestType,startTime,endTime}=request;return requestType===DO_NOT_SCHEDULE&&(date=extractDate(date),startTime=extractTime(startTime),endTime=extractTime(endTime),date&&startTime&&endTime)?{date,startTime,endTime,requestType}:request})).filter(Boolean);for(const request of filteredRequests)request.requestId=generateTimeCode(),personRequests[personId].push(request);return{mergeCount:filteredRequests.length}}var __defProp$3f=Object.defineProperty,__defProps$1N=Object.defineProperties,__getOwnPropDescs$1N=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3g=Object.getOwnPropertySymbols,__hasOwnProp$3g=Object.prototype.hasOwnProperty,__propIsEnum$3g=Object.prototype.propertyIsEnumerable,__defNormalProp$3f=(obj,key,value)=>key in obj?__defProp$3f(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3f=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3g.call(b,prop)&&__defNormalProp$3f(a,prop,b[prop]);if(__getOwnPropSymbols$3g)for(var prop of __getOwnPropSymbols$3g(b))__propIsEnum$3g.call(b,prop)&&__defNormalProp$3f(a,prop,b[prop]);return a},__spreadProps$1N=(a,b)=>__defProps$1N(a,__getOwnPropDescs$1N(b));function clearScheduledMatchUps$1({scheduleAttributes=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses=completedMatchUpStatuses,tournamentRecord,scheduledDates,venueIds=[]}){if("object"!=typeof tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(ignoreMatchUpStatuses)||!Array.isArray(venueIds))return{error:INVALID_VALUES};venueIds.length&&scheduleAttributes.push("venueId");const{matchUps:inContextMatchUps}=allTournamentMatchUps({matchUpFilters:{scheduledDates},tournamentRecord}),relevantMatchUpIds=inContextMatchUps.filter((matchUp=>!ignoreMatchUpStatuses.includes(matchUp.matchUpStatus)&&hasSchedule({schedule:matchUp.schedule,scheduleAttributes})&&(!(null==venueIds?void 0:venueIds.length)||venueIds.includes(matchUp.schedule.venueId)))).map(getMatchUpId),{matchUps}=allTournamentMatchUps({tournamentRecord,inContext:!1});let clearedScheduleCount=0;for(const matchUp of matchUps)relevantMatchUpIds.includes(matchUp.matchUpId)&&(matchUp.timeItems=(matchUp.timeItems||[]).filter((timeItem=>![ALLOCATE_COURTS,ASSIGN_COURT,ASSIGN_VENUE,SCHEDULED_DATE,SCHEDULED_TIME].includes(null==timeItem?void 0:timeItem.itemType))),clearedScheduleCount+=1);return __spreadProps$1N(__spreadValues$3f({},SUCCESS),{clearedScheduleCount})}var __defProp$3e=Object.defineProperty,__getOwnPropSymbols$3f=Object.getOwnPropertySymbols,__hasOwnProp$3f=Object.prototype.hasOwnProperty,__propIsEnum$3f=Object.prototype.propertyIsEnumerable,__defNormalProp$3e=(obj,key,value)=>key in obj?__defProp$3e(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3e=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3f.call(b,prop)&&__defNormalProp$3e(a,prop,b[prop]);if(__getOwnPropSymbols$3f)for(var prop of __getOwnPropSymbols$3f(b))__propIsEnum$3f.call(b,prop)&&__defNormalProp$3e(a,prop,b[prop]);return a};function clearScheduledMatchUps({scheduleAttributes=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses=completedMatchUpStatuses,tournamentRecords,scheduledDates,venueIds}){const tournamentIds=isObject(tournamentRecords)&&Object.values(tournamentRecords).map((({tournamentId})=>tournamentId)).filter(Boolean);if(!(null==tournamentIds?void 0:tournamentIds.length))return{error:MISSING_TOURNAMENT_RECORDS};for(const tournamentId of tournamentIds){const result=clearScheduledMatchUps$1({ignoreMatchUpStatuses,scheduleAttributes,tournamentRecord:tournamentRecords[tournamentId],scheduledDates,venueIds});if(result.error)return result}return __spreadValues$3e({},SUCCESS)}function getMatchUpDailyLimits$1({tournamentRecord}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{policy}=findPolicy({policyType:POLICY_TYPE_SCHEDULING,tournamentRecord}),{extension}=findTournamentExtension({tournamentRecord,name:SCHEDULE_LIMITS}),tournamentDailyLimits=null==(_a=null==extension?void 0:extension.value)?void 0:_a.dailyLimits,policyDailyLimits=null==policy?void 0:policy.defaultDailyLimits;return{matchUpDailyLimits:tournamentDailyLimits||policyDailyLimits}}function getMatchUpDailyLimits({tournamentRecords,tournamentId}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};let dailyLimits;return Object.keys(tournamentRecords).filter((currentTournamentId=>!tournamentId||currentTournamentId===tournamentId)).find((tournamentId2=>{const tournamentRecord=tournamentRecords[tournamentId2],{matchUpDailyLimits}=getMatchUpDailyLimits$1({tournamentRecord});return dailyLimits=matchUpDailyLimits,!0})),{matchUpDailyLimits:dailyLimits}}function scheduleProfileRounds({checkPotentialRequestConflicts=!0,scheduleCompletedMatchUps,clearScheduleDates,scheduleDates=[],tournamentRecords,periodLength,dryRun,pro}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!Array.isArray(scheduleDates))return{error:INVALID_VALUES};const result=getSchedulingProfile$1({tournamentRecords});if(result.error)return result;const{schedulingProfile=[],issues:schedulingProfileIssues=[],modifications:schedulingProfileModifications}=result,containedStructureIds=Object.assign({},...Object.values(tournamentRecords).map((tournamentRecord=>getContainedStructures({tournamentRecord}).containedStructures))),validScheduleDates=scheduleDates.map((scheduleDate=>{if(isValidDateString(scheduleDate))return extractDate(scheduleDate)})).filter(Boolean),profileDates=schedulingProfile.map((dateSchedulingProfile=>dateSchedulingProfile.scheduleDate)).map((scheduleDate=>isValidDateString(scheduleDate)&&extractDate(scheduleDate))).filter((scheduleDate=>scheduleDate&&(!scheduleDates.length||validScheduleDates.includes(scheduleDate))));if(!profileDates.length)return{error:NO_VALID_DATES};if(clearScheduleDates&&!dryRun){clearScheduledMatchUps({tournamentRecords,scheduledDates:Array.isArray(clearScheduleDates)?clearScheduleDates:void 0})}const{courts}=getVenuesAndCourts({dates:scheduleDates,ignoreDisabled:!0,tournamentRecords}),{matchUps}=allCompetitionMatchUps({matchUpFilters:{matchUpTypes:[SINGLES$1,DOUBLES$1]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords}),{matchUpDependencies}=getMatchUpDependencies({includeParticipantDependencies:!0,tournamentRecords,matchUps}),{matchUpDailyLimits}=getMatchUpDailyLimits({tournamentRecords}),{personRequests}=getPersonRequests({requestType:DO_NOT_SCHEDULE,tournamentRecords}),params={schedulingProfileModifications,checkPotentialRequestConflicts,scheduleCompletedMatchUps,schedulingProfileIssues,dateSchedulingProfiles:schedulingProfile.filter((dateschedulingProfile=>{const scheduleDate=extractDate(null==dateschedulingProfile?void 0:dateschedulingProfile.scheduleDate);return profileDates.includes(scheduleDate)})).sort(((a,b)=>{new Date(a.scheduleDate).getTime(),new Date(b.scheduleDate).getTime()})),containedStructureIds,matchUpDependencies,matchUpDailyLimits,clearScheduleDates,schedulingProfile,tournamentRecords,personRequests,periodLength,matchUps,dryRun,courts};return pro?function proScheduler({schedulingProfileModifications,checkPotentialRequestConflicts,scheduleCompletedMatchUps,schedulingProfileIssues,dateSchedulingProfiles,containedStructureIds,matchUpDependencies,matchUpDailyLimits,clearScheduleDates,schedulingProfile,tournamentRecords,periodLength=30,personRequests,matchUps,courts,dryRun}){var _a;const recoveryTimeDeferredMatchUpIds={},dependencyDeferredMatchUpIds={},scheduleDateRequestConflicts={},matchUpScheduleCourtIds={},matchUpScheduleTimes={},scheduledMatchUpIds={},overLimitMatchUpIds={},noTimeMatchUpIds={},requestConflicts={};for(const dateSchedulingProfile of dateSchedulingProfiles){const scheduleDate=extractDate(null==dateSchedulingProfile?void 0:dateSchedulingProfile.scheduleDate),venues=(null==dateSchedulingProfile?void 0:dateSchedulingProfile.venues)||[],matchUpPotentialParticipantIds={},individualParticipantProfiles={},bumpLimits=(relevantParticipantIds,matchUpType)=>{relevantParticipantIds.forEach((participantId=>{const counters=individualParticipantProfiles[participantId].counters;counters[matchUpType]?counters[matchUpType]+=1:counters[matchUpType]=1,counters[TOTAL]?counters[TOTAL]+=1:counters[TOTAL]=1}))};recoveryTimeDeferredMatchUpIds[scheduleDate]={},dependencyDeferredMatchUpIds[scheduleDate]={},scheduledMatchUpIds[scheduleDate]=[],overLimitMatchUpIds[scheduleDate]=[],noTimeMatchUpIds[scheduleDate]=[],requestConflicts[scheduleDate]=[];const matchUpNotBeforeTimes={};matchUps.forEach((matchUp=>{var _a2;(null==(_a2=matchUp.schedule)?void 0:_a2.scheduledDate)&&sameDay(scheduleDate,extractDate(matchUp.schedule.scheduledDate))&&processNextMatchUps({matchUpPotentialParticipantIds,matchUpNotBeforeTimes,matchUp})}));const{allDateScheduledMatchUpIds,venueScheduledRoundDetails,allDateMatchUpIds}=getVenueSchedulingDetails({matchUpPotentialParticipantIds,individualParticipantProfiles,scheduleCompletedMatchUps,containedStructureIds,matchUpNotBeforeTimes,matchUpScheduleTimes,matchUpDependencies,clearScheduleDates,tournamentRecords,periodLength,scheduleDate,matchUps,courts,venues}),dateScheduledMatchUps=matchUps.filter((({matchUpId})=>allDateScheduledMatchUpIds.includes(matchUpId))),{bookings}=generateBookings({dateScheduledMatchUps,tournamentRecords,scheduleDate,periodLength}),{virtualCourts:dateCourts}=generateVirtualCourts({scheduleDate,periodLength,bookings,courts}),venueTimeBoundaries=dateCourts.reduce(((timeBoundaries,court)=>{const{earliestCourtTime,courtEndTime}=getEarliestCourtTime({date:scheduleDate,averageMinutes:0,court});return(!timeBoundaries.startTime||timeToDate(earliestCourtTime)<timeToDate(timeBoundaries.startTime))&&(timeBoundaries.startTime=earliestCourtTime),(!timeBoundaries.endTime||timeToDate(courtEndTime)>timeToDate(timeBoundaries.endTime))&&(timeBoundaries.endTime=courtEndTime),timeBoundaries}),{});let venueEarliestCourtTime=venueTimeBoundaries.startTime;const addDateCourtBooking=({courtId,booking})=>{var _a2;return null==(_a2=dateCourts.find((court=>court.courtId===courtId)))?void 0:_a2.dateAvailability[0].bookings.push(booking)},failSafe=10;let schedulingComplete,schedulingIterations=0;for(;!schedulingComplete;){for(const{venueId}of venues){const details=venueScheduledRoundDetails[venueId],venuePassFailSafe=details.matchUpsToSchedule.length,matchUpIdsScheduled=[],courtIdsScheduled=[];let venuePassComplete,passIterations=0;for(;!venuePassComplete;){for(const matchUp of details.matchUpsToSchedule){if(courtIdsScheduled.length===details.courtsCount||matchUpIdsScheduled.length===details.courtsCount){venuePassComplete=!0;break}const{matchUpId,matchUpType}=matchUp,{participantIdsAtLimit,relevantParticipantIds}=checkDailyLimits({matchUpPotentialParticipantIds,individualParticipantProfiles,matchUpDailyLimits,matchUp});if(participantIdsAtLimit.length){overLimitMatchUpIds[scheduleDate].includes(matchUpId)||overLimitMatchUpIds[scheduleDate].push(matchUpId);continue}const{dependenciesScheduled,remainingDependencies}=checkDependenciesScheduled({matchUpScheduleTimes,matchUpDependencies,allDateMatchUpIds,matchUps,matchUp});if(!dependenciesScheduled){dependencyDeferredMatchUpIds[scheduleDate][matchUpId]||(dependencyDeferredMatchUpIds[scheduleDate][matchUpId]=[]),dependencyDeferredMatchUpIds[scheduleDate][matchUpId].push({remainingDependencies});continue}const schedulingConflicts=[],courtTime=dateCourts.reduce(((courtTime2,court)=>{var _a2,_b,_c,_d;if(courtIdsScheduled.includes(court.courtId))return courtTime2;const{earliestCourtTime:scheduleTime}=getEarliestCourtTime({averageMinutes:details.greatestAverageMinutes,startTime:venueEarliestCourtTime,date:scheduleDate,court});if(courtTime2.scheduleTime&&timeStringMinutes(scheduleTime)>=timeStringMinutes(courtTime2.scheduleTime))return courtTime2;const{scheduledDependent}=checkDependendantTiming({matchUpScheduleTimes,matchUpDependencies,scheduleTime,matchUpId,details});if(scheduledDependent)return courtTime2;const{enoughTime}=checkRecoveryTime({individualParticipantProfiles,matchUpNotBeforeTimes,matchUpDependencies,scheduleTime,details,matchUp});if(!enoughTime)return recoveryTimeDeferredMatchUpIds[scheduleDate][matchUpId]||(recoveryTimeDeferredMatchUpIds[scheduleDate][matchUpId]=[]),recoveryTimeDeferredMatchUpIds[scheduleDate][matchUpId].includes(scheduleTime)||recoveryTimeDeferredMatchUpIds[scheduleDate][matchUpId].push(scheduleTime),courtTime2;const averageMatchUpMinutes=(null==(_b=null==(_a2=details.minutesMap)?void 0:_a2[matchUpId])?void 0:_b.averageMinutes)||details.greatestAverageMinutes,{conflicts}=checkRequestConflicts({potentials:checkPotentialRequestConflicts,averageMatchUpMinutes,requestConflicts,personRequests,scheduleTime,scheduleDate,matchUp});if(null==conflicts?void 0:conflicts.length)return schedulingConflicts.push(...conflicts),!1;bumpLimits(relevantParticipantIds,matchUpType);const recoveryMinutes=null==(_d=null==(_c=details.minutesMap)?void 0:_c[matchUpId])?void 0:_d.recoveryMinutes;return updateTimeAfterRecovery({matchUpPotentialParticipantIds,individualParticipantProfiles,matchUpNotBeforeTimes,averageMatchUpMinutes,matchUpDependencies,recoveryMinutes,scheduleDate,scheduleTime,matchUp}),(!courtTime2.scheduleTime||timeStringMinutes(scheduleTime)<timeStringMinutes(courtTime2.scheduleTime))&&(courtTime2.averageMatchUpMinutes=averageMatchUpMinutes,courtTime2.recoveryMinutes=recoveryMinutes,courtTime2.scheduleTime=scheduleTime,courtTime2.courtName=court.courtName,courtTime2.courtId=court.courtId),courtTime2}),{});if(courtTime.scheduleTime){const{averageMatchUpMinutes,recoveryMinutes,scheduleTime,courtId}=courtTime;matchUpScheduleTimes[matchUpId]=scheduleTime,matchUpScheduleCourtIds[matchUpId]=courtId,matchUpIdsScheduled.push(matchUpId),courtIdsScheduled.push(courtId);const startTime=scheduleTime,endTime=addMinutesToTimeString(startTime,averageMatchUpMinutes);addDateCourtBooking({courtId,booking:{averageMatchUpMinutes,recoveryMinutes,periodLength,matchUpId,startTime,courtId,endTime,venueId}}),details.matchUpsToSchedule=details.matchUpsToSchedule.filter((matchUp2=>matchUp2.matchUpId!==matchUpId))}else(null==schedulingConflicts?void 0:schedulingConflicts.length)&&(scheduleDateRequestConflicts[scheduleDate]||(scheduleDateRequestConflicts[scheduleDate]=[]),scheduleDateRequestConflicts[scheduleDate].push(...schedulingConflicts))}courtIdsScheduled.length!==details.courtsCount&&matchUpIdsScheduled.length!==details.courtsCount&&details.matchUpsToSchedule.length||(venuePassComplete=!0),details.matchUpsToSchedule.length&&matchUpIdsScheduled<details.courtsCount&&(timeToDate(venueEarliestCourtTime)<timeToDate(venueTimeBoundaries.endTime)?venueEarliestCourtTime=addMinutesToTimeString(venueEarliestCourtTime,periodLength):(venuePassComplete=!0,details.complete=!0)),passIterations+=1,!venuePassComplete&&passIterations>=venuePassFailSafe&&(venuePassComplete=!0)}(null==(_a=details.matchUpsToSchedule)?void 0:_a.length)||(details.complete=!0)}schedulingIterations+=1,schedulingComplete=venues.every((({venueId})=>venueScheduledRoundDetails[venueId].complete))||schedulingIterations===failSafe}for(const{venueId}of venues){const matchUpMap=venueScheduledRoundDetails[venueId].matchUpMap;Object.keys(matchUpMap).forEach((tournamentId=>{const tournamentRecord=tournamentRecords[tournamentId];tournamentRecord&&Object.keys(matchUpMap[tournamentId]).forEach((drawId=>{const{drawDefinition}=getDrawDefinition$2({tournamentRecord,drawId});drawDefinition&&matchUpMap[tournamentId][drawId].forEach((({matchUpId})=>{const scheduleTime=matchUpScheduleTimes[matchUpId],courtId=matchUpScheduleCourtIds[matchUpId];if(scheduleTime){const formatTime=scheduleTime.split(":").map(zeroPad).join(":"),scheduledTime=`${extractDate(scheduleDate)}T${formatTime}`;dryRun||(addMatchUpScheduledTime$2({drawDefinition,scheduledTime,matchUpId}),assignMatchUpCourt$1({courtDayDate:scheduleDate,tournamentRecords,tournamentRecord,drawDefinition,matchUpId,courtId})),scheduledMatchUpIds[scheduleDate].push(matchUpId)}}))}))})),noTimeMatchUpIds[scheduleDate]=venueScheduledRoundDetails[venueId].matchUpsToSchedule.map(getMatchUpId)}for(const venue of dateSchedulingProfile.venues)for(const round of venue.rounds){const matchUpIds=round.matchUps.map((({matchUpId})=>matchUpId)),canScheduleMatchUpIds=matchUpIds.filter((matchUpId=>scheduledMatchUpIds[scheduleDate].includes(matchUpId)));round.canScheduledMatchUpIds=canScheduleMatchUpIds;let possibleToSchedulePct=Math.round(canScheduleMatchUpIds.length/round.matchUpsCount*1e4)/100;(possibleToSchedulePct===1/0||isNaN(possibleToSchedulePct))&&(possibleToSchedulePct=0),round.possibleToSchedulePct=possibleToSchedulePct,round.matchUpsCount===canScheduleMatchUpIds.length&&(round.possibleToSchedule=!0)}}const scheduledDates=dateSchedulingProfiles.map((({scheduleDate})=>scheduleDate)),autoSchedulingAudit={timeStamp:Date.now(),overLimitMatchUpIds,scheduledMatchUpIds,schedulingProfile,noTimeMatchUpIds,requestConflicts,scheduledDates};return auditAutoScheduling({tournamentRecords,autoSchedulingAudit}),__spreadProps$1O(__spreadValues$3h({},SUCCESS),{schedulingProfileModifications,schedulingProfileIssues,dateSchedulingProfiles,recoveryTimeDeferredMatchUpIds,dependencyDeferredMatchUpIds,matchUpScheduleTimes,overLimitMatchUpIds,scheduledMatchUpIds,noTimeMatchUpIds,requestConflicts,scheduledDates})}(params):function jinnScheduler({schedulingProfileModifications,checkPotentialRequestConflicts,scheduleCompletedMatchUps,schedulingProfileIssues,dateSchedulingProfiles,containedStructureIds,matchUpDependencies,matchUpDailyLimits,clearScheduleDates,schedulingProfile,tournamentRecords,personRequests,periodLength,matchUps,courts,dryRun}){var _a,_b,_c,_d,_e,_f,_g;const scheduleTimesRemaining={},skippedScheduleTimes={},recoveryTimeDeferredMatchUpIds={},dependencyDeferredMatchUpIds={},scheduleDateRequestConflicts={},matchUpScheduleTimes={},scheduledMatchUpIds={},overLimitMatchUpIds={},noTimeMatchUpIds={},requestConflicts={};for(const dateSchedulingProfile of dateSchedulingProfiles){const scheduleDate=extractDate(null==dateSchedulingProfile?void 0:dateSchedulingProfile.scheduleDate),venues=(null==dateSchedulingProfile?void 0:dateSchedulingProfile.venues)||[],matchUpPotentialParticipantIds={},individualParticipantProfiles={},bumpLimits=(relevantParticipantIds,matchUpType)=>{relevantParticipantIds.forEach((participantId=>{const counters=individualParticipantProfiles[participantId].counters;counters[matchUpType]?counters[matchUpType]+=1:counters[matchUpType]=1,counters[TOTAL]?counters[TOTAL]+=1:counters[TOTAL]=1}))};recoveryTimeDeferredMatchUpIds[scheduleDate]={},dependencyDeferredMatchUpIds[scheduleDate]={},scheduleTimesRemaining[scheduleDate]={},skippedScheduleTimes[scheduleDate]={},scheduledMatchUpIds[scheduleDate]=[],overLimitMatchUpIds[scheduleDate]=[],noTimeMatchUpIds[scheduleDate]=[],requestConflicts[scheduleDate]=[];const matchUpNotBeforeTimes={};matchUps.forEach((matchUp=>{var _a2;(null==(_a2=matchUp.schedule)?void 0:_a2.scheduledDate)&&sameDay(scheduleDate,extractDate(matchUp.schedule.scheduledDate))&&processNextMatchUps({matchUpPotentialParticipantIds,matchUpNotBeforeTimes,matchUp})}));const{venueScheduledRoundDetails,allDateMatchUpIds}=getVenueSchedulingDetails({matchUpPotentialParticipantIds,individualParticipantProfiles,scheduleCompletedMatchUps,containedStructureIds,matchUpNotBeforeTimes,matchUpScheduleTimes,matchUpDependencies,clearScheduleDates,tournamentRecords,useGarman:!0,periodLength,scheduleDate,matchUps,courts,venues}),failSafe=10;let schedulingComplete,schedulingIterations=0,maxScheduleTimeAttempts=10;for(;!schedulingComplete;){for(const{venueId}of venues){let scheduledThisPass=0;const details=venueScheduledRoundDetails[venueId];for(;details.courtsCount&&(null==(_a=details.scheduleTimes)?void 0:_a.length)&&(null==(_b=details.matchUpsToSchedule)?void 0:_b.length)&&scheduledThisPass<=details.courtsCount;){const{scheduleTime,attempts=0}=details.scheduleTimes.shift(),scheduledMatchUp=details.matchUpsToSchedule.find((matchUp=>{var _a2,_b2;const{matchUpId,matchUpType}=matchUp,{participantIdsAtLimit,relevantParticipantIds}=checkDailyLimits({matchUpPotentialParticipantIds,individualParticipantProfiles,matchUpDailyLimits,matchUp});if(participantIdsAtLimit.length)return overLimitMatchUpIds[scheduleDate].includes(matchUpId)||overLimitMatchUpIds[scheduleDate].push(matchUpId),!1;const{scheduledDependent}=checkDependendantTiming({matchUpScheduleTimes,matchUpDependencies,scheduleTime,matchUpId,details});if(scheduledDependent)return!1;const{dependenciesScheduled,remainingDependencies}=checkDependenciesScheduled({matchUpScheduleTimes,matchUpDependencies,allDateMatchUpIds,matchUps,matchUp});if(!dependenciesScheduled)return dependencyDeferredMatchUpIds[scheduleDate][matchUpId]||(dependencyDeferredMatchUpIds[scheduleDate][matchUpId]=[]),dependencyDeferredMatchUpIds[scheduleDate][matchUpId].push({scheduleTime,remainingDependencies}),!1;const{enoughTime}=checkRecoveryTime({individualParticipantProfiles,matchUpNotBeforeTimes,matchUpDependencies,scheduleTime,details,matchUp});if(!enoughTime)return recoveryTimeDeferredMatchUpIds[scheduleDate][matchUpId]||(recoveryTimeDeferredMatchUpIds[scheduleDate][matchUpId]=[]),recoveryTimeDeferredMatchUpIds[scheduleDate][matchUpId].push({scheduleTime}),!1;const averageMatchUpMinutes=details.greatestAverageMinutes,{conflicts}=checkRequestConflicts({potentials:checkPotentialRequestConflicts,averageMatchUpMinutes,requestConflicts,personRequests,scheduleTime,scheduleDate,matchUp});if(null==conflicts?void 0:conflicts.length)return scheduleDateRequestConflicts[scheduleDate]||(scheduleDateRequestConflicts[scheduleDate]=[]),scheduleDateRequestConflicts[scheduleDate].push(...conflicts),!1;bumpLimits(relevantParticipantIds,matchUpType);const recoveryMinutes=null==(_b2=null==(_a2=details.minutesMap)?void 0:_a2[matchUpId])?void 0:_b2.recoveryMinutes;return updateTimeAfterRecovery({matchUpPotentialParticipantIds,individualParticipantProfiles,matchUpNotBeforeTimes,averageMatchUpMinutes,matchUpDependencies,recoveryMinutes,scheduleDate,scheduleTime,matchUp}),matchUpScheduleTimes[matchUpId]=scheduleTime,!0}));details.matchUpsToSchedule=details.matchUpsToSchedule.filter((({matchUpId})=>matchUpId!==(null==scheduledMatchUp?void 0:scheduledMatchUp.matchUpId))),scheduledMatchUp?scheduledThisPass+=1:(skippedScheduleTimes[scheduleDate][venueId]||(skippedScheduleTimes[scheduleDate][venueId]=[]),skippedScheduleTimes[scheduleDate][venueId].push({scheduleTime,attempts:attempts+1}))}(null==(_c=details.matchUpsToSchedule)?void 0:_c.length)&&(skippedScheduleTimes[scheduleDate][venueId]=null==(_d=skippedScheduleTimes[scheduleDate][venueId])?void 0:_d.filter((unused=>{const tryAgain=unused.attempts<maxScheduleTimeAttempts;return tryAgain&&details.scheduleTimes.push(unused),!tryAgain}))),(null==(_e=details.scheduleTimes)?void 0:_e.length)&&(null==(_f=details.matchUpsToSchedule)?void 0:_f.length)||(details.complete=!0)}schedulingIterations+=1,schedulingComplete=venues.every((({venueId})=>venueScheduledRoundDetails[venueId].complete))||schedulingIterations===failSafe}for(const{venueId}of venues){const matchUpMap=venueScheduledRoundDetails[venueId].matchUpMap;Object.keys(matchUpMap).forEach((tournamentId=>{const tournamentRecord=tournamentRecords[tournamentId];tournamentRecord&&Object.keys(matchUpMap[tournamentId]).forEach((drawId=>{const{drawDefinition}=getDrawDefinition$2({tournamentRecord,drawId});drawDefinition&&matchUpMap[tournamentId][drawId].forEach((({matchUpId})=>{const scheduleTime=matchUpScheduleTimes[matchUpId];if(scheduleTime){const formatTime=scheduleTime.split(":").map(zeroPad).join(":"),scheduledTime=`${extractDate(scheduleDate)}T${formatTime}`;dryRun?scheduledMatchUpIds[scheduleDate].push(matchUpId):(addMatchUpScheduledTime$2({drawDefinition,scheduledTime,matchUpId}).success&&scheduledMatchUpIds[scheduleDate].push(matchUpId),venueId&&assignMatchUpVenue$1({tournamentRecord,drawDefinition,matchUpId,venueId}))}}))}))})),noTimeMatchUpIds[scheduleDate]=venueScheduledRoundDetails[venueId].matchUpsToSchedule.map(getMatchUpId),scheduleTimesRemaining[scheduleDate][venueId]=venueScheduledRoundDetails[venueId].scheduleTimes.sort(((a,b)=>timeStringMinutes(a.scheduleTime)-timeStringMinutes(b.scheduleTime)))}for(const venue of dateSchedulingProfile.venues)for(const round of venue.rounds){const matchUpIds=(null==(_g=round.matchUps)?void 0:_g.map((({matchUpId})=>matchUpId)))||[],canScheduleMatchUpIds=matchUpIds.filter((matchUpId=>scheduledMatchUpIds[scheduleDate].includes(matchUpId)));round.canScheduledMatchUpIds=canScheduleMatchUpIds;let possibleToSchedulePct=Math.round(canScheduleMatchUpIds.length/round.matchUpsCount*1e4)/100;(possibleToSchedulePct===1/0||isNaN(possibleToSchedulePct))&&(possibleToSchedulePct=0),round.possibleToSchedulePct=possibleToSchedulePct,round.matchUpsCount===canScheduleMatchUpIds.length&&(round.possibleToSchedule=!0)}}const scheduledDates=dateSchedulingProfiles.map((({scheduleDate})=>scheduleDate)),autoSchedulingAudit={timeStamp:Date.now(),overLimitMatchUpIds,scheduledMatchUpIds,schedulingProfile,noTimeMatchUpIds,requestConflicts,scheduledDates};return auditAutoScheduling({tournamentRecords,autoSchedulingAudit}),__spreadProps$1P(__spreadValues$3i({},SUCCESS),{schedulingProfileModifications,schedulingProfileIssues,scheduleTimesRemaining,dateSchedulingProfiles,skippedScheduleTimes,recoveryTimeDeferredMatchUpIds,dependencyDeferredMatchUpIds,matchUpScheduleTimes,overLimitMatchUpIds,scheduledMatchUpIds,noTimeMatchUpIds,requestConflicts,scheduledDates})}(params)}function removeEventMatchUpFormatTiming$1({event}){return event?removeEventExtension({event,name:SCHEDULE_TIMING}):{error:MISSING_EVENT}}function checkInParticipant$1({tournamentParticipants,tournamentRecord,drawDefinition,participantId,matchUpId,event}){if(!participantId)return{error:MISSING_PARTICIPANT_ID};if(!matchUpId)return{error:MISSING_MATCHUP};if((tournamentParticipants=tournamentParticipants||(null==tournamentRecord?void 0:tournamentRecord.participants))&&tournamentParticipants.length){const{matchUp}=findMatchUp$1({tournamentParticipants,inContext:!0,drawDefinition,matchUpId,event});if(!matchUp)return{error:MATCHUP_NOT_FOUND};const result=getCheckedInParticipantIds({matchUp});if(result.error)return result;const{checkedInParticipantIds,allRelevantParticipantIds}=result;if(!allRelevantParticipantIds.includes(participantId))return{error:INVALID_PARTICIPANT_ID};if(checkedInParticipantIds.includes(participantId))return{error:PARTICIPANT_ALREADY_CHECKED_IN}}return addMatchUpTimeItem({tournamentRecord,drawDefinition,matchUpId,timeItem:{itemType:CHECK_IN,itemValue:participantId}})}function checkOutParticipant$1({tournamentParticipants,tournamentRecord,drawDefinition,participantId,matchUpId,event}){if(!participantId)return{error:MISSING_PARTICIPANT_ID};if(!matchUpId)return{error:MISSING_MATCHUP_ID};tournamentParticipants=tournamentParticipants||(null==tournamentRecord?void 0:tournamentRecord.participants);const{matchUp}=findMatchUp$1({tournamentParticipants,inContext:!0,drawDefinition,matchUpId,event}),{matchUpStatus,score}=matchUp;if(activeMatchUpStatuses.includes(matchUpStatus)||completedMatchUpStatuses.includes(matchUpStatus)||scoreHasValue({score}))return{error:INVALID_ACTION};if(tournamentParticipants&&tournamentParticipants.length){const{checkedInParticipantIds,allRelevantParticipantIds}=getCheckedInParticipantIds({matchUp});if(!allRelevantParticipantIds.includes(participantId))return{error:INVALID_PARTICIPANT_ID};if(!checkedInParticipantIds.includes(participantId))return{error:PARTICIPANT_NOT_CHECKED_IN};const{sideParticipantIds,nestedIndividualParticipantIds}=getMatchUpParticipantIds({matchUp}),sideIndex=sideParticipantIds.indexOf(participantId);[0,1].includes(sideIndex)&&(nestedIndividualParticipantIds[sideIndex]||[]).forEach((participantId2=>{addMatchUpTimeItem({drawDefinition,matchUpId,timeItem:{itemType:CHECK_OUT,itemValue:participantId2}})}))}return addMatchUpTimeItem({tournamentRecord,drawDefinition,matchUpId,timeItem:{itemType:CHECK_OUT,itemValue:participantId}})}function toggleParticipantCheckInState$1(params){if(!(null==params?void 0:params.tournamentRecord))return{error:MISSING_TOURNAMENT_RECORD};const{tournamentRecord,participantId,matchUpId,drawDefinition}=params,tournamentParticipants=tournamentRecord.participants||[],{matchUp}=findMatchUp({tournamentRecord,drawDefinition,matchUpId,inContext:!0});if(!matchUp)return{error:MATCHUP_NOT_FOUND};const{checkedInParticipantIds=[]}=getCheckedInParticipantIds({matchUp});return checkedInParticipantIds.includes(participantId)?checkOutParticipant$1({tournamentParticipants,tournamentRecord,drawDefinition,participantId,matchUpId}):checkInParticipant$1({tournamentParticipants,tournamentRecord,drawDefinition,participantId,matchUpId})}function removeMatchUpCourtAssignment$1(params){const{tournamentRecords}=params;if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};const{removePriorValues,tournamentId,courtDayDate,matchUpId,courtId,drawId}=params,tournamentRecord=tournamentRecords[tournamentId];if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{drawDefinition,event}=getDrawDefinition$2({tournamentRecord,drawId}),result=findMatchUp$1({drawDefinition,event,matchUpId});if(result.error)return result;if(result.matchUp.matchUpType===TEAM_MATCHUP){const{itemValue:allocatedCourts}=latestVisibleTimeItemValue({timeItems:result.matchUp.timeItems||[],itemType:ALLOCATE_COURTS}),itemValue=courtId&&allocatedCourts.filter((court=>court.courtId!==courtId));return addMatchUpTimeItem({duplicateValues:!1,removePriorValues,tournamentRecord,drawDefinition,matchUpId,timeItem:{itemType:ALLOCATE_COURTS,itemValue}})}return assignMatchUpCourt$1({tournamentRecord,drawDefinition,courtDayDate,courtId:"",matchUpId})}var __defProp$3d=Object.defineProperty,__defProps$1M=Object.defineProperties,__getOwnPropDescs$1M=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3e=Object.getOwnPropertySymbols,__hasOwnProp$3e=Object.prototype.hasOwnProperty,__propIsEnum$3e=Object.prototype.propertyIsEnumerable,__defNormalProp$3d=(obj,key,value)=>key in obj?__defProp$3d(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3d=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3e.call(b,prop)&&__defNormalProp$3d(a,prop,b[prop]);if(__getOwnPropSymbols$3e)for(var prop of __getOwnPropSymbols$3e(b))__propIsEnum$3e.call(b,prop)&&__defNormalProp$3d(a,prop,b[prop]);return a},__spreadProps$1M=(a,b)=>__defProps$1M(a,__getOwnPropDescs$1M(b));const{stageOrder}=drawDefinitionConstants;function getProfileRounds({schedulingProfile,tournamentRecords,tournamentRecord,withRoundId}){if(tournamentRecord&&!tournamentRecords){if("object"!=typeof tournamentRecord)return{error:INVALID_TOURNAMENT_RECORD};tournamentRecords={[tournamentRecord.tournamentId]:tournamentRecord}}if(schedulingProfile){const profileValidity=validateSchedulingProfile({tournamentRecords,schedulingProfile});if(profileValidity.error)return profileValidity}if(!schedulingProfile){const result=getSchedulingProfile$1({tournamentRecords});if(result.error)return result;schedulingProfile=result.schedulingProfile}if(!schedulingProfile)return{error:NOT_FOUND};const segmentedRounds={};return{profileRounds:schedulingProfile.map((({venues,scheduleDate})=>venues.map((({rounds})=>rounds.map((round=>{var _a;const roundRef=getRoundId(round);return(null==(_a=roundRef.roundSegment)?void 0:_a.segmentsCount)&&(segmentedRounds[roundRef.id]=roundRef.roundSegment.segmentsCount),definedAttributes(__spreadValues$3d({id:withRoundId?roundRef.id:void 0,scheduleDate},roundRef))})))))).flat(1/0),segmentedRounds}}function getRoundId(obj){const{containerStructureId,roundSegment,isRoundRobin,tournamentId,roundNumber,structureId,eventId,drawId}=obj,relevantStructureId=isRoundRobin?containerStructureId:structureId;return definedAttributes({id:[tournamentId,eventId,drawId,relevantStructureId,roundNumber].join("|"),roundSegment,tournamentId,eventId,drawId,structureId:relevantStructureId,roundNumber})}function getRoundProfile(matchUps){const matchUpsCount=matchUps.length,byeCount=matchUps.filter((({sides})=>null==sides?void 0:sides.some((({bye})=>bye)))).length||0,completedCount=matchUps.filter((({winningSide,matchUpStatus})=>winningSide||completedMatchUpStatuses.includes(matchUpStatus))).length||0,scheduledCount=matchUps.filter((({schedule})=>(null==schedule?void 0:schedule.scheduledDate)&&(null==schedule?void 0:schedule.scheduledTime))).length||0,consideredCount=matchUpsCount-byeCount;return{unscheduledCount:consideredCount-scheduledCount,incompleteCount:consideredCount-scheduledCount,scheduledCount,completedCount,matchUpsCount,isScheduled:consideredCount===scheduledCount,isComplete:consideredCount===completedCount,byeCount}}function getRounds({excludeScheduleDateProfileRounds,excludeScheduledRounds,excludeCompletedRounds,inContextMatchUps,schedulingProfile,tournamentRecords,tournamentRecord,withSplitRounds,matchUpFilters,withRoundId,context}){var _a;if(inContextMatchUps&&!Array.isArray(inContextMatchUps||"object"!=typeof inContextMatchUps[0]))return{error:INVALID_VALUES,inContextMatchUps};if(tournamentRecord&&!tournamentRecords){if("object"!=typeof tournamentRecord)return{error:INVALID_TOURNAMENT_RECORD};tournamentRecords={[tournamentRecord.tournamentId]:tournamentRecord}}const noTournamentRecords="object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length;if((!inContextMatchUps||!schedulingProfile&&(excludeScheduleDateProfileRounds||excludeCompletedRounds||schedulingProfile||withSplitRounds))&&noTournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};const events=Object.values(tournamentRecords||{}).map((({events:events2})=>events2)).flat(),{segmentedRounds,profileRounds}=excludeScheduleDateProfileRounds||excludeCompletedRounds||schedulingProfile||withSplitRounds?getProfileRounds({tournamentRecords,schedulingProfile}):{},profileRoundsMap=excludeScheduleDateProfileRounds&&Object.assign({},...profileRounds.map((profile=>({[profile.id]:profile})))),consideredMatchUps=inContextMatchUps||(null==(_a=allCompetitionMatchUps({tournamentRecords,matchUpFilters}))?void 0:_a.matchUps)||[],excludedRounds=[];let rounds=consideredMatchUps&&Object.values(consideredMatchUps.reduce(((rounds2,matchUp)=>{var _a2,_b;const id=getRoundId(matchUp).id,segmentsCount=null==segmentedRounds?void 0:segmentedRounds[id],matchUps=[...null!=(_b=null==(_a2=rounds2[id])?void 0:_a2.matchUps)?_b:[],matchUp],{containerStructureId,stageSequence,structureName,tournamentId,isRoundRobin,matchUpType,roundNumber,roundOffset,structureId,eventName,roundName,drawName,eventId,drawId}=matchUp,relevantStructureId=isRoundRobin?containerStructureId:structureId;return __spreadProps$1M(__spreadValues$3d({},rounds2),{[id]:{id:withRoundId?id:void 0,structureId:relevantStructureId,stageSequence,segmentsCount,structureName,tournamentId,matchUpType,roundNumber,roundOffset,eventName,roundName,drawName,matchUps,eventId,drawId}})}),{})).map((round=>{const{minFinishingSum,winnerFinishingPositionRange}=function getFinishingPositionDetails(matchUps){return(matchUps||[]).reduce(((foo,matchUp)=>{var _a,_b;const sum=((null==(_a=matchUp.finishingPositionRange)?void 0:_a.winner)||[]).reduce(((a,b)=>a+b),0),winnerFinishingPositionRange=((null==(_b=matchUp.finishingPositionRange)?void 0:_b.winner)||[]).join("-")||"";return!foo.minFinishingSum||sum<foo.minFinishingSum?{minFinishingSum:sum,winnerFinishingPositionRange}:foo}),{minFinishingSum:0,winnerFinishingPositionRange:""})}(round.matchUps),segmentsCount=round.segmentsCount;if(segmentsCount){const chunkSize=round.matchUps.length/segmentsCount;return chunkArray(round.matchUps.sort(((a,b)=>a.roundPosition-b.roundPosition)),chunkSize).map(((matchUps,i)=>{const{unscheduledCount:unscheduledCount2,incompleteCount:incompleteCount2,matchUpsCount:matchUpsCount2,isScheduled:isScheduled2,isComplete:isComplete2,byeCount:byeCount2}=getRoundProfile(matchUps),roundTiming2=getRoundTiming({matchUps:round.matchUps,tournamentRecords,events,round});return definedAttributes(__spreadProps$1M(__spreadValues$3d(__spreadValues$3d({},round),context),{roundSegment:{segmentsCount,segmentNumber:i+1},winnerFinishingPositionRange,unscheduledCount:unscheduledCount2,incompleteCount:incompleteCount2,minFinishingSum,matchUpsCount:matchUpsCount2,isScheduled:isScheduled2,roundTiming:roundTiming2,isComplete:isComplete2,byeCount:byeCount2,matchUps}))}))}const{unscheduledCount,incompleteCount,matchUpsCount,isScheduled,isComplete,byeCount}=getRoundProfile(round.matchUps),roundTiming=getRoundTiming({matchUps:round.matchUps,tournamentRecords,events,round});return definedAttributes(__spreadProps$1M(__spreadValues$3d(__spreadValues$3d({},round),context),{winnerFinishingPositionRange,unscheduledCount,incompleteCount,minFinishingSum,matchUpsCount,isScheduled,roundTiming,isComplete,byeCount}))})).flat().filter((round=>{if(excludeScheduleDateProfileRounds){const scheduleDate=extractDate(excludeScheduleDateProfileRounds),roundId=withRoundId?round.id:getRoundId(round).id;if(scheduleDate&&profileRoundsMap[roundId]&&extractDate(profileRoundsMap[roundId].scheduleDate)===scheduleDate)return!1}const{isComplete,isScheduled}=round,keepRound=(!excludeCompletedRounds||!isComplete)&&(!excludeScheduledRounds||!isScheduled);return keepRound||excludedRounds.push(round),keepRound})).sort(roundSort)||[];return __spreadProps$1M(__spreadValues$3d({},SUCCESS),{rounds,excludedRounds})}function getRoundTiming({round,matchUps,events,tournamentRecords}){const event=events.find((event2=>event2.eventId===round.eventId)),{eventType,category,categoryType}=event||{},{categoryName,ageCategoryCode}=category||{},formatCounts=instanceCount(matchUps.map((({matchUpFormat})=>matchUpFormat)));let roundMinutes=0;return Object.keys(formatCounts).map((matchUpFormat=>{const formatCount=formatCounts[matchUpFormat],result=findMatchUpFormatTiming({categoryName:categoryName||ageCategoryCode,tournamentId:round.tournamentId,eventId:round.eventId,tournamentRecords,matchUpFormat,categoryType,eventType});if(result.error)return result;const formatMinutes=result.averageMinutes*formatCount;isNaN(roundMinutes)||(roundMinutes+=formatMinutes)})),{roundMinutes}}function roundSort(a,b){return a.eventName.localeCompare(b.eventName)||a.eventId.localeCompare(b.eventId)||(stageOrder[null==a?void 0:a.stage]||0)-(stageOrder[null==b?void 0:b.stage]||0)||b.matchUpsCount-a.matchUpsCount||`${a.stageSequence}-${a.roundNumber}-${a.minFinishingSum}`.localeCompare(`${b.stageSequence}-${b.roundNumber}-${b.minFinishingSum}`)}var __defProp$3c=Object.defineProperty,__defProps$1L=Object.defineProperties,__getOwnPropDescs$1L=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3d=Object.getOwnPropertySymbols,__hasOwnProp$3d=Object.prototype.hasOwnProperty,__propIsEnum$3d=Object.prototype.propertyIsEnumerable,__defNormalProp$3c=(obj,key,value)=>key in obj?__defProp$3c(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$3b=Object.defineProperty,__getOwnPropSymbols$3c=Object.getOwnPropertySymbols,__hasOwnProp$3c=Object.prototype.hasOwnProperty,__propIsEnum$3c=Object.prototype.propertyIsEnumerable,__defNormalProp$3b=(obj,key,value)=>key in obj?__defProp$3b(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$3a=Object.defineProperty,__defProps$1K=Object.defineProperties,__getOwnPropDescs$1K=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3b=Object.getOwnPropertySymbols,__hasOwnProp$3b=Object.prototype.hasOwnProperty,__propIsEnum$3b=Object.prototype.propertyIsEnumerable,__defNormalProp$3a=(obj,key,value)=>key in obj?__defProp$3a(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3a=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3b.call(b,prop)&&__defNormalProp$3a(a,prop,b[prop]);if(__getOwnPropSymbols$3b)for(var prop of __getOwnPropSymbols$3b(b))__propIsEnum$3b.call(b,prop)&&__defNormalProp$3a(a,prop,b[prop]);return a},__spreadProps$1K=(a,b)=>__defProps$1K(a,__getOwnPropDescs$1K(b));var __defProp$39=Object.defineProperty,__defProps$1J=Object.defineProperties,__getOwnPropDescs$1J=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3a=Object.getOwnPropertySymbols,__hasOwnProp$3a=Object.prototype.hasOwnProperty,__propIsEnum$3a=Object.prototype.propertyIsEnumerable,__defNormalProp$39=(obj,key,value)=>key in obj?__defProp$39(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$39=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3a.call(b,prop)&&__defNormalProp$39(a,prop,b[prop]);if(__getOwnPropSymbols$3a)for(var prop of __getOwnPropSymbols$3a(b))__propIsEnum$3a.call(b,prop)&&__defNormalProp$39(a,prop,b[prop]);return a},__spreadProps$1J=(a,b)=>__defProps$1J(a,__getOwnPropDescs$1J(b));var __defProp$38=Object.defineProperty,__defProps$1I=Object.defineProperties,__getOwnPropDescs$1I=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$39=Object.getOwnPropertySymbols,__hasOwnProp$39=Object.prototype.hasOwnProperty,__propIsEnum$39=Object.prototype.propertyIsEnumerable,__defNormalProp$38=(obj,key,value)=>key in obj?__defProp$38(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function getDrawDefinition$1({tournamentRecords,tournamentId,drawId}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!drawId)return{error:MISSING_DRAW_ID};if("string"!=typeof tournamentId&&!(tournamentId=findTournamentId({tournamentRecords,drawId})))return{error:MISSING_TOURNAMENT_ID};const tournamentRecord=tournamentRecords[tournamentId];if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const result=findEvent({tournamentRecord,drawId});return result.error?decorateResult({stack:"addScheduleItems.getDrawDefinition",result}):{drawDefinition:result.drawDefinition,tournamentRecord}}const scheduleGovernor$1={scheduleMatchUps:function scheduleMatchUps({tournamentRecords,competitionMatchUps,matchUpDependencies,allDateMatchUpIds=[],averageMatchUpMinutes=90,recoveryMinutes=0,recoveryMinutesMap,matchUpPotentialParticipantIds={},individualParticipantProfiles={},matchUpNotBeforeTimes={},matchUpDailyLimits={},checkPotentialRequestConflicts=!0,remainingScheduleTimes,clearScheduleDates,periodLength=30,scheduleDate,matchUpIds,venueIds,startTime,endTime,dryRun}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!matchUpIds)return{error:MISSING_MATCHUP_IDS};if(!isValidDateString(scheduleDate))return{error:INVALID_DATE};if(isNaN(periodLength)||isNaN(averageMatchUpMinutes)||isNaN(recoveryMinutes))return{error:INVALID_VALUES};competitionMatchUps||({matchUps:competitionMatchUps}=allCompetitionMatchUps({tournamentRecords,nextMatchUps:!0})),matchUpDependencies||({matchUpDependencies}=getMatchUpDependencies({includeParticipantDependencies:!0,matchUps:competitionMatchUps,tournamentRecords})),competitionMatchUps.forEach((matchUp=>{var _a;(null==(_a=matchUp.schedule)?void 0:_a.scheduledDate)&&sameDay(scheduleDate,extractDate(matchUp.schedule.scheduledDate))&&processNextMatchUps({matchUp,matchUpNotBeforeTimes,matchUpPotentialParticipantIds})}));const targetMatchUps=matchUpIds.map((matchUpId=>competitionMatchUps.find((matchUp=>matchUp.matchUpId===matchUpId)))).filter(Boolean),{venueId,scheduleTimes,dateScheduledMatchUpIds}=calculateScheduleTimes({tournamentRecords,remainingScheduleTimes,startTime:extractTime(startTime),endTime:extractTime(endTime),scheduleDate:extractDate(scheduleDate),averageMatchUpMinutes,clearScheduleDates,periodLength,venueIds}),requestConflicts={},skippedScheduleTimes=[],matchUpScheduleTimes={},recoveryTimeDeferred={},dependencyDeferred={},dateScheduledMatchUps=competitionMatchUps.filter((({matchUpId})=>dateScheduledMatchUpIds.includes(matchUpId)));dateScheduledMatchUps.forEach((matchUp=>{var _a;modifyParticipantMatchUpsCount({matchUpPotentialParticipantIds,individualParticipantProfiles,scheduleDate,matchUp,value:1});const scheduleTime=null==(_a=matchUp.schedule)?void 0:_a.scheduledTime;if(scheduleTime){matchUpScheduleTimes[matchUp.matchUpId]=scheduleTime;const mappedRecoveryMinutes=null==recoveryMinutesMap?void 0:recoveryMinutesMap[matchUp.matchUpId];updateTimeAfterRecovery({individualParticipantProfiles,matchUpPotentialParticipantIds,matchUpNotBeforeTimes,matchUpDependencies,recoveryMinutes:mappedRecoveryMinutes||recoveryMinutes,averageMatchUpMinutes,scheduleDate,scheduleTime,matchUp})}}));let matchUpsToSchedule=targetMatchUps.filter((matchUp=>{const alreadyScheduled=dateScheduledMatchUpIds.includes(matchUp.matchUpId),doNotSchedule=[BYE,DEFAULTED,COMPLETED$1,ABANDONED,RETIRED$1,WALKOVER$2].includes(null==matchUp?void 0:matchUp.matchUpStatus);return!alreadyScheduled&&!matchUp.winningSide&&!doNotSchedule}));const{matchUpMap,overLimitMatchUpIds,participantIdsAtLimit}=matchUpsToSchedule.reduce(((aggregator,matchUp)=>{const{drawId,tournamentId,matchUpType}=matchUp,{participantIdsAtLimit:participantIdsAtLimit2,relevantParticipantIds}=checkDailyLimits({individualParticipantProfiles,matchUpPotentialParticipantIds,matchUpDailyLimits,matchUp});return(null==participantIdsAtLimit2?void 0:participantIdsAtLimit2.length)?(aggregator.overLimitMatchUpIds.push(matchUp.matchUpId),aggregator.participantIdsAtLimit.push(...participantIdsAtLimit2),aggregator):(relevantParticipantIds.forEach((participantId=>{checkParticipantProfileInitialization({individualParticipantProfiles,participantId});const counters=individualParticipantProfiles[participantId].counters;counters[matchUpType]?counters[matchUpType]+=1:counters[matchUpType]=1,counters[TOTAL]?counters[TOTAL]+=1:counters[TOTAL]=1})),aggregator.matchUpMap[tournamentId]||(aggregator.matchUpMap[tournamentId]={}),aggregator.matchUpMap[tournamentId][drawId]?aggregator.matchUpMap[tournamentId][drawId].push(matchUp):aggregator.matchUpMap[tournamentId][drawId]=[matchUp],processNextMatchUps({matchUp,matchUpNotBeforeTimes,matchUpPotentialParticipantIds}),aggregator)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});matchUpsToSchedule=matchUpsToSchedule.filter((({matchUpId})=>!overLimitMatchUpIds.includes(matchUpId)));let iterations=0;const failSafe=(null==scheduleTimes?void 0:scheduleTimes.length)||0,{personRequests}=getPersonRequests({tournamentRecords,requestType:DO_NOT_SCHEDULE});for(;(null==scheduleTimes?void 0:scheduleTimes.length)&&matchUpsToSchedule.length&&iterations<=failSafe;){iterations++;const{scheduleTime}=scheduleTimes.shift(),scheduledMatchUp=matchUpsToSchedule.find((matchUp=>{const{matchUpId}=matchUp,{dependenciesScheduled,remainingDependencies}=checkDependenciesScheduled({matchUps:competitionMatchUps,matchUpScheduleTimes,matchUpDependencies,allDateMatchUpIds,matchUp});if(!dependenciesScheduled)return dependencyDeferred[matchUpId]||(dependencyDeferred[matchUpId]=[]),dependencyDeferred[matchUpId].push({scheduleTime,remainingDependencies}),!1;const{enoughTime}=checkRecoveryTime({individualParticipantProfiles,matchUpNotBeforeTimes,matchUpDependencies,scheduleTime,matchUp});if(!enoughTime)return recoveryTimeDeferred[matchUpId]||(recoveryTimeDeferred[matchUpId]=[]),recoveryTimeDeferred[matchUpId].push({scheduleTime}),!1;const{conflicts}=checkRequestConflicts({potentials:checkPotentialRequestConflicts,averageMatchUpMinutes,requestConflicts,personRequests,scheduleTime,scheduleDate,matchUp});if(null==conflicts?void 0:conflicts.length)return!1;return updateTimeAfterRecovery({recoveryMinutes:(null==recoveryMinutesMap?void 0:recoveryMinutesMap[matchUp.matchUpId])||recoveryMinutes,matchUpPotentialParticipantIds,individualParticipantProfiles,matchUpNotBeforeTimes,averageMatchUpMinutes,matchUpDependencies,scheduleDate,scheduleTime,matchUp}),matchUpScheduleTimes[matchUp.matchUpId]=scheduleTime,!0}));matchUpsToSchedule=matchUpsToSchedule.filter((({matchUpId})=>matchUpId!==(null==scheduledMatchUp?void 0:scheduledMatchUp.matchUpId))),scheduledMatchUp||skippedScheduleTimes.push(scheduleTime)}matchUpsToSchedule.forEach((matchUp=>{modifyParticipantMatchUpsCount({individualParticipantProfiles,matchUpPotentialParticipantIds,scheduleDate,value:-1,matchUp})}));let scheduledMatchUpIds=[];Object.keys(matchUpMap).forEach((tournamentId=>{const tournamentRecord=tournamentRecords[tournamentId];tournamentRecord?Object.keys(matchUpMap[tournamentId]).forEach((drawId=>{const{drawDefinition}=getDrawDefinition$2({tournamentRecord,drawId});if(drawDefinition){matchUpMap[tournamentId][drawId].forEach((({matchUpId})=>{const scheduleTime=matchUpScheduleTimes[matchUpId];if(scheduleTime){const formatTime=scheduleTime.split(":").map(zeroPad).join(":"),scheduledTime=`${extractDate(scheduleDate)}T${formatTime}`;if(dryRun)scheduledMatchUpIds.push(matchUpId);else{addMatchUpScheduledTime$2({drawDefinition,matchUpId,scheduledTime}).success&&scheduledMatchUpIds.push(matchUpId),venueId&&assignMatchUpVenue$1({tournamentRecord,drawDefinition,matchUpId,venueId})}}}))}})):getDevContext()&&console.log(MISSING_TOURNAMENT_ID)}));const noTimeMatchUpIds=getMatchUpIds(matchUpsToSchedule);return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3d.call(b,prop)&&__defNormalProp$3c(a,prop,b[prop]);if(__getOwnPropSymbols$3d)for(var prop of __getOwnPropSymbols$3d(b))__propIsEnum$3d.call(b,prop)&&__defNormalProp$3c(a,prop,b[prop]);return a})({},SUCCESS),b={requestConflicts:Object.values(requestConflicts),remainingScheduleTimes:scheduleTimes.map((({scheduleTime})=>scheduleTime)),individualParticipantProfiles,matchUpNotBeforeTimes,participantIdsAtLimit,skippedScheduleTimes,overLimitMatchUpIds,scheduledMatchUpIds,noTimeMatchUpIds,recoveryTimeDeferred,dependencyDeferred},__defProps$1L(a,__getOwnPropDescs$1L(b));var a,b},scheduleProfileRounds,clearScheduledMatchUps,bulkRescheduleMatchUps:function bulkRescheduleMatchUps({tournamentRecords,scheduleChange,matchUpIds,dryRun}){var _a,_b;if(!matchUpIds||!Array.isArray(matchUpIds))return{error:MISSING_MATCHUP_IDS};if("object"!=typeof scheduleChange)return{error:INVALID_VALUES};const rescheduled=[];let notRescheduled=[];for(const tournamentRecord of Object.values(tournamentRecords)){const result=bulkRescheduleMatchUps$1({tournamentRecord,scheduleChange,matchUpIds,dryRun});if(result.error)return result;Array.isArray(result.notRescheduled)&&notRescheduled.push(...result.notRescheduled);const notRescheduledIds=getMatchUpIds(result.notRescheduled),removeFromNotScheduledIds=[];null==(_a=result.rescheduled)||_a.forEach((matchUp=>{const{matchUpId}=matchUp;notRescheduledIds.includes(matchUpId)&&removeFromNotScheduledIds.push(matchUpId),rescheduled.push(matchUp)})),removeFromNotScheduledIds.length&&(notRescheduled=(null==(_b=null==result?void 0:result.notRescheduled)?void 0:_b.filter((({matchUpId})=>!removeFromNotScheduledIds.includes(matchUpId))))||[])}const allRescheduled=rescheduled.length&&!notRescheduled.length;return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3C.call(b,prop)&&__defNormalProp$3B(a,prop,b[prop]);if(__getOwnPropSymbols$3C)for(var prop of __getOwnPropSymbols$3C(b))__propIsEnum$3C.call(b,prop)&&__defNormalProp$3B(a,prop,b[prop]);return a})({},SUCCESS),__defProps$21(a,__getOwnPropDescs$21({rescheduled,notRescheduled,allRescheduled}));var a},getScheduledRoundsDetails,getMatchUpDependencies,generateVirtualCourts,generateBookings,proAutoSchedule:function proAutoSchedule({tournamentRecords,scheduledDate,matchUps}={}){if(!Array.isArray(matchUps))return{error:INVALID_VALUES};if(matchUps.some((({hasContext})=>!hasContext)))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:MISSING_CONTEXT};let result=competitionScheduleMatchUps({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,nextMatchUps:!0,tournamentRecords,matchUpFilters:{localPerspective:!0,scheduledDate}});if(result.error)return result;const{rows}=result,gridMatchUps=[],getMatchUpParticipantIds=matchUp=>[(matchUp.sides||[]).map((side=>{var _a;return[side.participantId,null==(_a=side.participant)?void 0:_a.individualParticipantIds]})),(matchUp.potentialParticipants||[]).flat().map((p=>[p.participantId,p.individualParticipantIds]))].flat(1/0).filter(Boolean),gridRows=rows.reduce(((gridRows2,row)=>{const matchUpIds=[],participantIds=[];Object.values(row).forEach((c=>{if(isObject(c)&&(c.matchUpId&&(matchUpIds.push(c.matchUpId),gridMatchUps.push(c)),c.sides)){const matchUpParticipantIds=getMatchUpParticipantIds(c);participantIds.push(...matchUpParticipantIds)}}));const availableCourts=Object.values(row).filter((c=>isObject(c)&&!c.matchUpId));return gridRows2.concat({matchUpIds,availableCourts,rowId:row.rowId,participantIds})}),[]);matchUps.sort(matchUpSort);const deps=getMatchUpDependencies({matchUps:matchUps.concat(gridMatchUps),includeParticipantDependencies:!0,tournamentRecords}).matchUpDependencies,previousRowMatchUpIds=[],scheduled=[];for(;matchUps.length&&gridRows.length;){const row=gridRows.shift(),unscheduledMatchUps=[];for(;matchUps.length&&row.availableCourts.length;){const unscheduledMatchUpIds=matchUps.concat(unscheduledMatchUps).map((m=>m.matchUpId)),matchUp=matchUps.shift(),{matchUpId}=matchUp,linkedMatchUpIds=deps[matchUpId].matchUpIds.concat(deps[matchUpId].dependentMatchUpIds),unscheduledContainSource=unscheduledMatchUpIds.some((id=>deps[matchUpId].matchUpIds.includes(id))),previousIncludesDependent=previousRowMatchUpIds.some((id=>deps[matchUpId].dependentMatchUpIds.includes(id))),rowIncludesLinked=row.matchUpIds.some((id=>linkedMatchUpIds.includes(id))),participantIds=getMatchUpParticipantIds(matchUp),rowContainsParticipants=row.participantIds.some((id=>participantIds.includes(id)));if(rowIncludesLinked||unscheduledContainSource||rowContainsParticipants||previousIncludesDependent)unscheduledMatchUps.push(matchUp);else{const court=row.availableCourts.shift();Object.assign(matchUp.schedule,court.schedule),Object.assign(court,matchUp),scheduled.push(matchUp),row.participantIds.push(...participantIds),row.matchUpIds.push(matchUpId)}}matchUps.push(...unscheduledMatchUps),previousRowMatchUpIds.push(...row.matchUpIds)}const matchUpDetails=scheduled.map((({matchUpId,tournamentId,schedule,drawId})=>({tournamentId,matchUpId,drawId,schedule:__spreadProps$1K(__spreadValues$3a({},schedule),{scheduledDate})})));result=bulkScheduleMatchUps({tournamentRecords,matchUpDetails});const notScheduled=matchUps;return __spreadProps$1K(__spreadValues$3a({},result),{scheduled,notScheduled})},proConflicts,matchUpScheduleChange:function matchUpScheduleChange(params){const stack="matchUpScheduleChange",{tournamentRecords}=params;if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const{sourceMatchUpContextIds,targetMatchUpContextIds,sourceCourtId,targetCourtId,courtDayDate}=params||{},{drawId:sourceDrawId,matchUpId:sourceMatchUpId,tournamentId:sourceTournamentId}=sourceMatchUpContextIds||{},{drawId:targetDrawId,matchUpId:targetMatchUpId,tournamentId:targetTournamentId}=targetMatchUpContextIds||{};if(!sourceMatchUpId&&!targetMatchUpId)return decorateResult({result:{error:MISSING_VALUE},stack});const{matchUps}=allCompetitionMatchUps({matchUpFilters:{matchUpIds:[sourceMatchUpId,targetMatchUpId].filter(Boolean),drawIds:[sourceDrawId,targetDrawId].filter(Boolean)},tournamentRecords:params.tournamentRecords}),sourceMatchUp=matchUps.find((({matchUpId})=>matchUpId===sourceMatchUpId)),targetMatchUp=matchUps.find((({matchUpId})=>matchUpId===targetMatchUpId));let matchUpsModified=0;if(targetCourtId&&sourceMatchUpId&&!targetMatchUpId){const result=assignMatchUp({tournamentId:sourceTournamentId,matchUpId:sourceMatchUpId,courtId:targetCourtId,matchUp:sourceMatchUp,drawId:sourceDrawId,tournamentRecords,sourceCourtId,courtDayDate});if((null==result?void 0:result.success)&&matchUpsModified++,result.error)return decorateResult({result,stack})}else{if(!(sourceCourtId&&targetCourtId&&sourceMatchUpId&&targetMatchUpId))return{error:MISSING_VALUE};{const sourceResult=assignMatchUp({tournamentId:sourceTournamentId,matchUpId:sourceMatchUpId,courtId:targetCourtId,matchUp:sourceMatchUp,drawId:sourceDrawId,tournamentRecords,sourceCourtId,courtDayDate});if(sourceResult.success&&matchUpsModified++,sourceResult.error)return decorateResult({result:sourceResult,stack,info:"source"});const targetResult=assignMatchUp({tournamentId:targetTournamentId,sourceCourtId:targetCourtId,matchUpId:targetMatchUpId,matchUp:targetMatchUp,courtId:sourceCourtId,drawId:targetDrawId,tournamentRecords,courtDayDate});if(targetResult.success&&matchUpsModified++,targetResult.error)return decorateResult({result:targetResult,stack,info:"target"})}}return matchUpsModified?SUCCESS:decorateResult({result:{error:NO_MODIFICATIONS_APPLIED},stack});function assignMatchUp(params2){const{tournamentRecords:tournamentRecords2,tournamentId,matchUp,drawId}=params2,tournamentRecord=tournamentRecords2[tournamentId],{drawDefinition}=getDrawDefinition$2({tournamentRecord,drawId});return matchUp.matchUpType===TEAM$2?function allocateCourts({removePriorValues,tournamentRecords:tournamentRecords2,tournamentRecord,drawDefinition,sourceCourtId:sourceCourtId2,courtDayDate:courtDayDate2,matchUpId,matchUp,courtId}){const courtIds=[courtId].concat(matchUp.schedule.allocatedCourts.map((({courtId:courtId2})=>courtId2)).filter((courtId2=>courtId2!==sourceCourtId2)));return allocateTeamMatchUpCourts$1({removePriorValues,tournamentRecords:tournamentRecords2,tournamentRecord,drawDefinition,courtDayDate:courtDayDate2,matchUpId,courtIds})}(__spreadProps$1J(__spreadValues$39({},params2),{tournamentRecord,drawDefinition})):function assignMatchUpCourt({tournamentRecords:tournamentRecords2,tournamentRecord,drawDefinition,courtDayDate:courtDayDate2,matchUpId,courtId}){return assignMatchUpCourt$1({tournamentRecords:tournamentRecords2,tournamentRecord,drawDefinition,courtDayDate:courtDayDate2,matchUpId,courtId})}(__spreadProps$1J(__spreadValues$39({},params2),{tournamentRecord,drawDefinition}))}},calculateScheduleTimes,reorderUpcomingMatchUps:function reorderUpcomingMatchUps(params){const stack="reorderUpcomingMatchUps",{tournamentRecords}=params;if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return decorateResult({result:{error:MISSING_TOURNAMENT_RECORDS},stack});const{matchUpsContextIds,firstToLast}=params;if(!matchUpsContextIds)return decorateResult({result:{error:MISSING_VALUE},stack});const matchUpsCount=null==matchUpsContextIds?void 0:matchUpsContextIds.length;if(!matchUpsCount)return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3c.call(b,prop)&&__defNormalProp$3b(a,prop,b[prop]);if(__getOwnPropSymbols$3c)for(var prop of __getOwnPropSymbols$3c(b))__propIsEnum$3c.call(b,prop)&&__defNormalProp$3b(a,prop,b[prop]);return a})({},SUCCESS);let matchUpsModified=0;return matchUpsContextIds.forEach(((context,index)=>{const{tournamentId,drawId,matchUpId}=context;let calculatedIndex=index+(firstToLast?-1:1);calculatedIndex<0&&(calculatedIndex=matchUpsCount-1),calculatedIndex===matchUpsCount&&(calculatedIndex=0);const result=function assignMatchUpScheduledTime({tournamentId,scheduledTime,matchUpId,drawId}){const tournamentRecord=tournamentRecords[tournamentId],{drawDefinition}=getDrawDefinition$2({tournamentRecord,drawId});return addMatchUpScheduledTime$2({drawDefinition,scheduledTime,matchUpId})}({tournamentId,scheduledTime:matchUpsContextIds[calculatedIndex].schedule.scheduledTime,matchUpId,drawId});if(!result.success)return result;matchUpsModified++})),matchUpsModified===matchUpsCount?SUCCESS:decorateResult({result:{error:MODIFICATIONS_FAILED},stack})},bulkUpdateCourtAssignments:function bulkUpdateCourtAssignments({tournamentRecords,courtAssignments,courtDayDate}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!Array.isArray(courtAssignments))return{error:MISSING_VALUE,info:mustBeAnArray("courtAssignments")};const tournamentMap=courtAssignments.reduce(((tournamentMap2,assignment)=>{const{tournamentId}=assignment;return tournamentMap2[tournamentId]||(tournamentMap2[tournamentId]=[]),tournamentMap2[tournamentId].push(assignment),tournamentMap2}),{});let error;return Object.keys(tournamentMap).every((tournamentId=>{const tournamentRecord=tournamentRecords[tournamentId];if(!tournamentRecord)return error={error:MISSING_TOURNAMENT_RECORD},!1;const drawMap=tournamentMap[tournamentId].reduce(((drawMap2,assignment)=>{const{drawId}=assignment;return drawMap2[drawId]||(drawMap2[drawId]=[]),drawMap2[drawId].push(assignment),drawMap2}),{});Object.keys(drawMap).every((drawId=>{const{drawDefinition}=findEvent({tournamentRecord,drawId});return drawDefinition?(drawMap[drawId].every((assignment=>{const{matchUpId,courtId}=assignment,result=assignMatchUpCourt$1({tournamentRecord,drawDefinition,courtDayDate,matchUpId,courtId});if(result.success)return null==result?void 0:result.success;error={error:UNABLE_TO_ASSIGN_COURT}})),!0):(error={error:MISSING_DRAW_DEFINITION},!1)}))})),error||SUCCESS},removeMatchUpCourtAssignment:removeMatchUpCourtAssignment$1,toggleParticipantCheckInState:function toggleParticipantCheckInState(params){const{tournamentRecords}=params,{participantId,tournamentId,matchUpId,drawId}=params;if(!(tournamentRecords&&tournamentId&&participantId&&matchUpId))return{error:MISSING_VALUE,stack:"toggleParticipantCheckInState"};const tournamentRecord=tournamentRecords[tournamentId],{drawDefinition}=getDrawDefinition$2({tournamentRecord,drawId});return Object.assign(params,{drawDefinition,tournamentRecord}),toggleParticipantCheckInState$1(params)},findMatchUpFormatTiming,modifyMatchUpFormatTiming:function modifyMatchUpFormatTiming({tournamentRecords,matchUpFormat,recoveryTimes,averageTimes,tournamentId,eventId}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const tournamentIds=Object.keys(tournamentRecords).filter((currentTournamentId=>!tournamentId||tournamentId===currentTournamentId));if(tournamentId&&!tournamentIds.includes(tournamentId))return{error:INVALID_VALUES};let eventModified;for(const currentTournamentId of tournamentIds){const tournamentRecord=tournamentRecords[currentTournamentId],{event}=findEvent({tournamentRecord,eventId});eventId&&event&&(eventModified=!0);const result=modifyMatchUpFormatTiming$1({tournamentRecord,event,matchUpFormat,averageTimes,recoveryTimes});if(result.error)return result}return!eventId||eventModified?((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3q.call(b,prop)&&__defNormalProp$3p(a,prop,b[prop]);if(__getOwnPropSymbols$3q)for(var prop of __getOwnPropSymbols$3q(b))__propIsEnum$3q.call(b,prop)&&__defNormalProp$3p(a,prop,b[prop]);return a})({},SUCCESS):{error:EVENT_NOT_FOUND}},modifyEventMatchUpFormatTiming:function modifyEventMatchUpFormatTiming({tournamentRecords,recoveryMinutes,averageMinutes,matchUpFormat,categoryType,tournamentId,eventId}){if(!eventId)return{error:MISSING_EVENT};const tournamentIds=Object.keys(tournamentRecords).filter((currentTournamentId=>!tournamentId||tournamentId===currentTournamentId));if(tournamentId&&!tournamentIds.includes(tournamentId))return{error:INVALID_VALUES};for(const currentTournamentId of tournamentIds){const tournamentRecord=tournamentRecords[currentTournamentId],{event}=findEvent({tournamentRecord,eventId});if(event)return modifyEventMatchUpFormatTiming$1({tournamentRecord,recoveryMinutes,averageMinutes,matchUpFormat,categoryType,event})}return{error:EVENT_NOT_FOUND}},getMatchUpFormatTimingUpdate:function getMatchUpFormatTimingUpdate$1({tournamentRecords}){return getExtensionUpdate({tournamentRecords,extensionName:SCHEDULE_TIMING})},getEventMatchUpFormatTiming:function getEventMatchUpFormatTiming({tournamentRecords,matchUpFormats,categoryType,tournamentId,eventId}){if(!eventId)return{error:MISSING_EVENT};const tournamentIds=Object.keys(tournamentRecords).filter((currentTournamentId=>!tournamentId||currentTournamentId===tournamentId));if(tournamentId&&!tournamentIds.length)return{error:INVALID_VALUES};let timing,timingError,eventFound;return tournamentIds.find((tournamentId2=>{const tournamentRecord=tournamentRecords[tournamentId2],{event}=findEvent({tournamentRecord,eventId});if(!event)return!1;eventFound=!0;const{eventMatchUpFormatTiming,error}=getEventMatchUpFormatTiming$1({tournamentRecord,matchUpFormats,categoryType,event});return error&&(timingError=error),timing=eventMatchUpFormatTiming,!0})),eventFound?timingError?{error:timingError}:{eventMatchUpFormatTiming:timing}:{error:EVENT_NOT_FOUND}},removeEventMatchUpFormatTiming:function removeEventMatchUpFormatTiming({tournamentRecords,eventId}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if("string"!=typeof eventId)return{error:MISSING_VALUE,info:"missing eventId"};for(const tournamentRecord of Object.values(tournamentRecords)){const{event}=findEvent({tournamentRecord,eventId});if(event)return removeEventMatchUpFormatTiming$1({event})}return{error:EVENT_NOT_FOUND}},getMatchUpDailyLimitsUpdate:function getMatchUpDailyLimitsUpdate$1({tournamentRecords}){return getExtensionUpdate({extensionName:SCHEDULE_LIMITS,tournamentRecords})},getMatchUpDailyLimits,setMatchUpDailyLimits:function setMatchUpDailyLimits({tournamentRecords,tournamentId,dailyLimits}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const tournamentIds=Object.keys(tournamentRecords).filter((currentTournamentId=>!tournamentId||tournamentId===currentTournamentId));if(tournamentId&&!tournamentIds.includes(tournamentId))return{error:INVALID_VALUES};for(const currentTournamentId of tournamentIds){const result=setMatchUpDailyLimits$1({tournamentRecord:tournamentRecords[currentTournamentId],dailyLimits});if(result.error)return result}return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3B.call(b,prop)&&__defNormalProp$3A(a,prop,b[prop]);if(__getOwnPropSymbols$3B)for(var prop of __getOwnPropSymbols$3B(b))__propIsEnum$3B.call(b,prop)&&__defNormalProp$3A(a,prop,b[prop]);return a})({},SUCCESS)},getProfileRounds,getRounds,assignMatchUpVenue:function assignMatchUpVenue(params){const result=getDrawDefinition$1(params);if(result.error)return result;const{tournamentRecord,drawDefinition}=result,{matchUpId,venueId,disableNotice,removePriorValues}=params;return assignMatchUpVenue$1({removePriorValues,tournamentRecord,drawDefinition,disableNotice,matchUpId,venueId})},assignMatchUpCourt:function assignMatchUpCourt(params){const result=getDrawDefinition$1(params);if(result.error)return result;const{tournamentRecord,drawDefinition}=result,{removePriorValues,tournamentRecords,disableNotice,courtDayDate,matchUpId,courtId}=params;return assignMatchUpCourt$1({removePriorValues,tournamentRecords,tournamentRecord,drawDefinition,disableNotice,courtDayDate,matchUpId,courtId})},allocateTeamMatchUpCourts:function allocateTeamMatchUpCourts(params){const result=getDrawDefinition$1(params);if(result.error)return result;const{tournamentRecord,drawDefinition}=result,{removePriorValues,tournamentRecords,disableNotice,courtDayDate,matchUpId,courtIds}=params;return allocateTeamMatchUpCourts$1({removePriorValues,tournamentRecords,tournamentRecord,drawDefinition,disableNotice,courtDayDate,matchUpId,courtIds})},addMatchUpScheduleItems:function addMatchUpScheduleItems(params){const result=getDrawDefinition$1(params);if(result.error)return result;const{tournamentRecord,drawDefinition}=result;return addMatchUpScheduleItems$1((a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$39.call(b,prop)&&__defNormalProp$38(a,prop,b[prop]);if(__getOwnPropSymbols$39)for(var prop of __getOwnPropSymbols$39(b))__propIsEnum$39.call(b,prop)&&__defNormalProp$38(a,prop,b[prop]);return a})({},params),__defProps$1I(a,__getOwnPropDescs$1I({tournamentRecord,drawDefinition}))));var a},addMatchUpScheduledDate:function addMatchUpScheduledDate(params){const result=getDrawDefinition$1(params);if(result.error)return result;const{tournamentRecord,drawDefinition}=result,{disableNotice,scheduledDate,matchUpId,removePriorValues}=params;return addMatchUpScheduledDate$1({removePriorValues,tournamentRecord,drawDefinition,disableNotice,scheduledDate,matchUpId})},addMatchUpScheduledTime:function addMatchUpScheduledTime(params){const result=getDrawDefinition$1(params);if(result.error)return result;const{tournamentRecord,drawDefinition}=result,{disableNotice,scheduledTime,matchUpId,removePriorValues}=params;return addMatchUpScheduledTime$1({removePriorValues,tournamentRecord,drawDefinition,disableNotice,scheduledTime,matchUpId})},addMatchUpCourtOrder:function addMatchUpCourtOrder(params){const result=getDrawDefinition$1(params);if(result.error)return result;const{tournamentRecord,drawDefinition}=result,{removePriorValues,tournamentRecords,disableNotice,courtOrder,matchUpId,courtId}=params;return function addMatchUpCourtOrder$1({tournamentRecord,drawDefinition,disableNotice,courtOrder,matchUpId}){return addMatchUpCourtOrder$2({tournamentRecord,drawDefinition,disableNotice,courtOrder,matchUpId})}({removePriorValues,tournamentRecords,tournamentRecord,drawDefinition,disableNotice,courtOrder,matchUpId,courtId})},addMatchUpStartTime:function addMatchUpStartTime(params){const result=getDrawDefinition$1(params);if(result.error)return result;const{tournamentRecord,drawDefinition}=result,{disableNotice,startTime,matchUpId}=params;return addMatchUpStartTime$1({tournamentRecord,drawDefinition,disableNotice,startTime,matchUpId})},addMatchUpStopTime:function addMatchUpStopTime(params){const result=getDrawDefinition$1(params);if(result.error)return result;const{tournamentRecord,drawDefinition}=result,{disableNotice,stopTime,matchUpId}=params;return addMatchUpStopTime$1({tournamentRecord,drawDefinition,disableNotice,stopTime,matchUpId})},addMatchUpResumeTime:function addMatchUpResumeTime(params){const result=getDrawDefinition$1(params);if(result.error)return result;const{tournamentRecord,drawDefinition}=result,{disableNotice,resumeTime,matchUpId}=params;return addMatchUpResumeTime$1({tournamentRecord,drawDefinition,disableNotice,resumeTime,matchUpId})},addMatchUpEndTime:function addMatchUpEndTime(params){const result=getDrawDefinition$1(params);if(result.error)return result;const{tournamentRecord,drawDefinition}=result,{disableNotice,endTime,matchUpId}=params;return addMatchUpEndTime$1({tournamentRecord,drawDefinition,disableNotice,endTime,matchUpId})},addMatchUpOfficial:function addMatchUpOfficial(params){const result=getDrawDefinition$1(params);if(result.error)return result;const{tournamentRecord,drawDefinition}=result,{disableNotice,participantId,officialType,matchUpId}=params;return addMatchUpOfficial$1({tournamentRecord,drawDefinition,disableNotice,participantId,officialType,matchUpId})},getSchedulingProfile:getSchedulingProfile$1,setSchedulingProfile:setSchedulingProfile$1,addSchedulingProfileRound,validateSchedulingProfile,addPersonRequests:function addPersonRequests({tournamentRecords,personId,requests}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if("string"!=typeof personId)return{error:INVALID_VALUES};if(!Array.isArray(requests))return{error:INVALID_VALUES};const{personRequests}=getPersonRequests({tournamentRecords}),{mergeCount}=mergePersonRequests({personRequests,personId,requests});return mergeCount?savePersonRequests({tournamentRecords,personRequests}):{error:INVALID_VALUES}},getPersonRequests,modifyPersonRequests:function modifyPersonRequests({tournamentRecords,requests,personId}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!Array.isArray(requests))return{error:INVALID_VALUES};const requestIds=requests.map((({requestId})=>requestId)).filter(Boolean),{personRequests}=getPersonRequests({tournamentRecords}),modifyRequests=personId2=>{personRequests[personId2]=personRequests[personId2].map((request=>{if(!requestIds.includes(request.requestId))return request;const modification=requests.find((updatedRequest=>updatedRequest.requestId===request.requestId));return modification.requestType?Object.assign(request,modification):void 0})).filter(Boolean)};if(personId&&personRequests[personId])modifyRequests(personId);else for(const personId2 of Object.keys(personRequests))modifyRequests(personId2);const newRequests=requests.filter((request=>!request.requestId));return newRequests.length&&mergePersonRequests({personRequests,personId,requests:newRequests}),savePersonRequests({tournamentRecords,personRequests})},removePersonRequests:function removePersonRequests({tournamentRecords,requestType,requestId,personId,date}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};const{personRequests}=getPersonRequests({tournamentRecords}),filterRequests=personId2=>{personRequests[personId2]=personRequests[personId2].filter((request=>!(requestType&&request.requestType===requestType||requestId&&request.requestId===requestId||date&&request.date===date))),personRequests[personId2].length||delete personRequests[personId2]},removeAll=!(requestType||requestId||personId||date);if(!removeAll)if(personId&&personRequests[personId])filterRequests(personId);else for(const personId2 of Object.keys(personRequests))filterRequests(personId2);return removeAll||!Object.keys(personRequests).length?removeExtension({tournamentRecords,name:PERSON_REQUESTS}):savePersonRequests({tournamentRecords,personRequests})}};var __defProp$37=Object.defineProperty,__defProps$1H=Object.defineProperties,__getOwnPropDescs$1H=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$38=Object.getOwnPropertySymbols,__hasOwnProp$38=Object.prototype.hasOwnProperty,__propIsEnum$38=Object.prototype.propertyIsEnumerable,__defNormalProp$37=(obj,key,value)=>key in obj?__defProp$37(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$37=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$38.call(b,prop)&&__defNormalProp$37(a,prop,b[prop]);if(__getOwnPropSymbols$38)for(var prop of __getOwnPropSymbols$38(b))__propIsEnum$38.call(b,prop)&&__defNormalProp$37(a,prop,b[prop]);return a},__spreadProps$1H=(a,b)=>__defProps$1H(a,__getOwnPropDescs$1H(b));function attachPolicies$2({tournamentRecord,policyDefinitions,allowReplacement}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!policyDefinitions||"object"!=typeof policyDefinitions)return{error:MISSING_POLICY_DEFINITION};tournamentRecord.extensions||(tournamentRecord.extensions=[]);const{appliedPolicies}=getAppliedPolicies({tournamentRecord}),applied=Object.keys(policyDefinitions).map((policyType=>{if(!appliedPolicies[policyType]||allowReplacement)return appliedPolicies[policyType]=policyDefinitions[policyType],policyType})).filter(Boolean);if(null==applied?void 0:applied.length){const result=addTournamentExtension({tournamentRecord,extension:{name:APPLIED_POLICIES,value:appliedPolicies}});if(result.error)return result}return(null==applied?void 0:applied.length)?__spreadProps$1H(__spreadValues$37({},SUCCESS),{applied}):{error:EXISTING_POLICY_TYPE}}function attachEventPolicies({policyDefinitions,allowReplacement,event}){if(!event)return{error:MISSING_EVENT};if(!policyDefinitions)return{error:MISSING_POLICY_DEFINITION};let policiesApplied=0;event.extensions||(event.extensions=[]);const{appliedPolicies}=getAppliedPolicies({event});if(Object.keys(policyDefinitions).forEach((policyType=>{appliedPolicies[policyType]&&!allowReplacement||(appliedPolicies[policyType]=policyDefinitions[policyType],policiesApplied++)})),policiesApplied){addEventExtension$1({event,extension:{name:APPLIED_POLICIES,value:appliedPolicies}})}return policiesApplied?SUCCESS:{error:POLICY_NOT_ATTACHED}}var __defProp$36=Object.defineProperty,__getOwnPropSymbols$37=Object.getOwnPropertySymbols,__hasOwnProp$37=Object.prototype.hasOwnProperty,__propIsEnum$37=Object.prototype.propertyIsEnumerable,__defNormalProp$36=(obj,key,value)=>key in obj?__defProp$36(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const policyGovernor$2={attachPolicies:function attachPolicies$1({tournamentRecords,policyDefinitions}){if("object"!=typeof tournamentRecords||!Object.keys(tournamentRecords).length)return{error:MISSING_TOURNAMENT_RECORDS};for(const tournamentRecord of Object.values(tournamentRecords)){const result=attachPolicies$2({tournamentRecord,policyDefinitions,allowReplacement:!0});if(result.error)return result}return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$37.call(b,prop)&&__defNormalProp$36(a,prop,b[prop]);if(__getOwnPropSymbols$37)for(var prop of __getOwnPropSymbols$37(b))__propIsEnum$37.call(b,prop)&&__defNormalProp$36(a,prop,b[prop]);return a})({},SUCCESS)}};var __defProp$35=Object.defineProperty,__defProps$1G=Object.defineProperties,__getOwnPropDescs$1G=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$36=Object.getOwnPropertySymbols,__hasOwnProp$36=Object.prototype.hasOwnProperty,__propIsEnum$36=Object.prototype.propertyIsEnumerable,__defNormalProp$35=(obj,key,value)=>key in obj?__defProp$35(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$35=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$36.call(b,prop)&&__defNormalProp$35(a,prop,b[prop]);if(__getOwnPropSymbols$36)for(var prop of __getOwnPropSymbols$36(b))__propIsEnum$36.call(b,prop)&&__defNormalProp$35(a,prop,b[prop]);return a},__spreadProps$1G=(a,b)=>__defProps$1G(a,__getOwnPropDescs$1G(b));var __defProp$34=Object.defineProperty,__getOwnPropSymbols$35=Object.getOwnPropertySymbols,__hasOwnProp$35=Object.prototype.hasOwnProperty,__propIsEnum$35=Object.prototype.propertyIsEnumerable,__defNormalProp$34=(obj,key,value)=>key in obj?__defProp$34(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$34=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$35.call(b,prop)&&__defNormalProp$34(a,prop,b[prop]);if(__getOwnPropSymbols$35)for(var prop of __getOwnPropSymbols$35(b))__propIsEnum$35.call(b,prop)&&__defNormalProp$34(a,prop,b[prop]);return a};function credits(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Pavel, Ivan, Mladen, Zdenko, Antoina, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and challenging me.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}function eligibleEntryStage({restrictQualifyingAlternates,structure,entry}){const{stage}=structure;if(!entry.entryStage||entry.entryStage===stage||stage===QUALIFYING&&!restrictQualifyingAlternates||entry.entryStage===MAIN&&stage===CONSOLATION)return!0}const POLICY_MATCHUP_ACTIONS_DEFAULT={[POLICY_TYPE_MATCHUP_ACTIONS]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],substitutionProcessCodes:["RANKING.IGNORE","RATING.IGNORE"]}},POSITION_ACTION="positionAction",MATCHUP_ACTION="matchUpAction";function getEnabledStructures({actionType=POSITION_ACTION,appliedPolicies,drawDefinition,structure}){var _a;const policyType=actionType===POSITION_ACTION&&POLICY_TYPE_POSITION_ACTIONS||actionType===MATCHUP_ACTION&&POLICY_TYPE_MATCHUP_ACTIONS,defaultPolicy=actionType===POSITION_ACTION&&POLICY_POSITION_ACTIONS_DEFAULT||actionType===MATCHUP_ACTION&&POLICY_MATCHUP_ACTIONS_DEFAULT,actionsPolicy=(null==appliedPolicies?void 0:appliedPolicies[policyType])||(null==defaultPolicy?void 0:defaultPolicy[policyType]),relevantLinks=null==(_a=drawDefinition.links)?void 0:_a.filter((link=>{var _a2;return(null==(_a2=null==link?void 0:link.target)?void 0:_a2.structureId)===(null==structure?void 0:structure.structureId)})),targetFeedProfiles=(null==relevantLinks?void 0:relevantLinks.map((({target})=>target.feedProfile)))||[],{enabledStructures,disabledStructures}=actionsPolicy||{};return{enabledStructures,actionsDisabled:null==disabledStructures?void 0:disabledStructures.find((structurePolicy=>{const{stages,stageSequences,structureTypes,feedProfiles}=structurePolicy;return(!(null==feedProfiles?void 0:feedProfiles.length)||Array.isArray(feedProfiles)&&feedProfiles.some((feedProfile=>targetFeedProfiles.includes(feedProfile))))&&(!(null==stages?void 0:stages.length)||Array.isArray(stages)&&(null==stages?void 0:stages.includes(structure.stage)))&&(!(null==structureTypes?void 0:structureTypes.length)||Array.isArray(structureTypes)&&(null==structureTypes?void 0:structureTypes.includes(structure.structureType)))&&(!(null==stageSequences?void 0:stageSequences.length)||Array.isArray(stageSequences)&&stageSequences.includes(structure.stageSequence))})),actionsPolicy}}function activePositionsCheck({activePositionOverrides,activeDrawPositions,action}){return!(!action||!activePositionOverrides.includes(action))||!activeDrawPositions.length}function getPolicyActions({enabledStructures,drawDefinition,structure}){var _a;if(!1===enabledStructures)return{};if(!(null==enabledStructures?void 0:enabledStructures.length))return{policyActions:{enabledActions:[],disabledActions:[]}};const{stage,stageSequence,structureType}=structure||{},relevantLinks=null==(_a=drawDefinition.links)?void 0:_a.filter((link=>{var _a2;return(null==(_a2=null==link?void 0:link.target)?void 0:_a2.structureId)===(null==structure?void 0:structure.structureId)})),targetFeedProfiles=(null==relevantLinks?void 0:relevantLinks.map((({target})=>target.feedProfile)))||[];return{policyActions:enabledStructures.find((structurePolicy=>{const{stages,stageSequences,structureTypes,feedProfiles}=structurePolicy||{},matchesStage=!(null==stages?void 0:stages.length)||Array.isArray(stages)&&stages.includes(stage),matchesStageSequence=!(null==stageSequences?void 0:stageSequences.length)||Array.isArray(stageSequences)&&stageSequences.includes(stageSequence),matchesStructureType=!(null==structureTypes?void 0:structureTypes.length)||Array.isArray(structureTypes)&&structureTypes.includes(structureType),matchesFeedProfile=!(null==feedProfiles?void 0:feedProfiles.length)||Array.isArray(feedProfiles)&&feedProfiles.some((feedProfile=>targetFeedProfiles.includes(feedProfile)));if(matchesStageSequence&&matchesStructureType&&matchesFeedProfile&&structurePolicy&&matchesStage)return!0}))}}function isAvailableAction({action,policyActions}){var _a;const disabled=!(null==policyActions?void 0:policyActions.enabledActions)||(null==(_a=null==policyActions?void 0:policyActions.disabledActions)?void 0:_a.length)&&policyActions.disabledActions.includes(action);if(disabled)return!1;return!(!(0===(null==policyActions?void 0:policyActions.enabledActions.length)||(null==policyActions?void 0:policyActions.enabledActions.includes(action)))||disabled)}const REPLACE_TEAM_POSITION_METHOD="replaceTieMatchUpParticipantId",ASSIGN_TEAM_POSITION_METHOD="assignTieMatchUpParticipantId",REMOVE_TEAM_POSITION_METHOD="removeTieMatchUpParticipantId",SUBSTITUTION_METHOD="substituteParticipant",REMOVE_SUBSTITUTION="REMOVE_SUBSTITUTION",REPLACE_PARTICIPANT="REPLACE_PARTICIPANT",REMOVE_PARTICIPANT="REMOVE_PARTICIPANT",SCHEDULE_METHOD="setMatchUpStatus",SUBSTITUTION="SUBSTITUTION",SCHEDULE="SCHEDULE",REFEREE="REFEREE",STATUS="STATUS",START="START",SCORE="SCORE",END="END";function matchUpActions$2({restrictAdHocRoundParticipants=!0,policyDefinitions:specifiedPolicyDefinitions,tournamentParticipants=[],inContextDrawMatchUps,tournamentRecord,drawDefinition,participantId,matchUpsMap,sideNumber,matchUpId,event}){var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!matchUpId)return{error:MISSING_MATCHUP_ID};if(sideNumber&&![1,2].includes(sideNumber))return{error:INVALID_VALUES,context:{sideNumber}};const otherFlightEntries=null==(_a=null==specifiedPolicyDefinitions?void 0:specifiedPolicyDefinitions[POLICY_TYPE_POSITION_ACTIONS])?void 0:_a.otherFlightEntries,{drawId}=drawDefinition,{matchUp,structure}=findMatchUp$1({drawDefinition,matchUpId,event});if(!matchUp)return{error:MATCHUP_NOT_FOUND};const{appliedPolicies}=getAppliedPolicies({tournamentRecord,drawDefinition,structure,event});Object.assign(appliedPolicies,specifiedPolicyDefinitions||{});const{enabledStructures}=getEnabledStructures({actionType:MATCHUP_ACTION,appliedPolicies,drawDefinition,structure}),{policyActions}=getPolicyActions({enabledStructures,drawDefinition,structure});matchUpsMap=matchUpsMap||getMatchUpsMap({drawDefinition}),inContextDrawMatchUps||({matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,tournamentParticipants,inContext:!0,drawDefinition,matchUpsMap}));const inContextMatchUp=inContextDrawMatchUps.find((drawMatchUp=>drawMatchUp.matchUpId===matchUpId)),side=sideNumber&&(null==(_b=inContextMatchUp.sides)?void 0:_b.find((side2=>side2.sideNumber===sideNumber))),matchUpParticipantIds=(null==(_c=inContextMatchUp.sides)?void 0:_c.map((side2=>{var _a2;return side2.participantId||(null==(_a2=side2.participant)?void 0:_a2.participantid)})).filter(Boolean))||[],{assignedPositions,allPositionsAssigned}=structureAssignedDrawPositions({structure}),{structureId}=structure||{},validActions=[];if(!structureId)return{validActions};if(isAdHoc({drawDefinition,structure})){const roundMatchUps=(structure.matchUps||[]).filter((({roundNumber})=>roundNumber===matchUp.roundNumber)),enteredParticipantIds=(null==drawDefinition?void 0:drawDefinition.entries.filter((({entryStatus})=>DIRECT_ENTRY_STATUSES.includes(entryStatus))).map(getParticipantId))||[],roundAssignedParticipantIds=roundMatchUps.map((matchUp2=>(matchUp2.sides||[]).flatMap(getParticipantId))).filter(Boolean),availableParticipantIds=enteredParticipantIds.filter((participantId2=>!(matchUpParticipantIds.includes(participantId2)||restrictAdHocRoundParticipants&&roundAssignedParticipantIds.includes(participantId2)))),participantsAvailable=null==tournamentParticipants?void 0:tournamentParticipants.filter((participant=>null==availableParticipantIds?void 0:availableParticipantIds.includes(participant.participantId)));null==participantsAvailable||participantsAvailable.forEach((participant=>{const entry=(drawDefinition.entries||[]).find((entry2=>entry2.participantId===participant.participantId));participant.entryPosition=null==entry?void 0:entry.entryPosition})),availableParticipantIds.length&&validActions.push({payload:{drawId,matchUpId,structureId,sideNumber},method:ASSIGN_SIDE_METHOD,type:ASSIGN_PARTICIPANT,availableParticipantIds,participantsAvailable});const availableEventAlternatesParticipantIds=function getEventAlternateParticipantIds({eventEntries,structure}){const eligibleAlternate=entry=>entry.entryStatus===ALTERNATE&&eligibleEntryStage({structure,entry}),entryPositionSort=(a,b)=>(a.entryPosition||1/0)-(b.entryPosition||1/0);return eventEntries.filter(eligibleAlternate).sort(entryPositionSort).map(getParticipantId)}({eventEntries:(null==event?void 0:event.entries)||[],structure});let availableAlternatesParticipantIds=unique(enteredParticipantIds.concat(availableEventAlternatesParticipantIds));if(otherFlightEntries){const{flightProfile}=getFlightProfile({event}),otherFlightEnteredParticipantIds=null==(_d=null==flightProfile?void 0:flightProfile.flights)?void 0:_d.filter((flight=>flight.drawId!==drawId)).flatMap((flight=>flight.drawEntries.filter((entry=>entry.participantId&&![WITHDRAWN,UNGROUPED,UNPAIRED].includes(entry.entryStatus))).map((({participantId:participantId2})=>participantId2)))).filter(Boolean);(null==otherFlightEnteredParticipantIds?void 0:otherFlightEnteredParticipantIds.length)&&availableAlternatesParticipantIds.push(...otherFlightEnteredParticipantIds)}availableAlternatesParticipantIds=availableAlternatesParticipantIds.filter((participantId2=>!(matchUpParticipantIds.includes(participantId2)||availableParticipantIds.includes(participantId2)||restrictAdHocRoundParticipants&&roundAssignedParticipantIds.includes(participantId2))));const availableAlternates=null==tournamentParticipants?void 0:tournamentParticipants.filter((participant=>availableAlternatesParticipantIds.includes(participant.participantId)));availableAlternates.forEach((alternate=>{const entry=(drawDefinition.entries||[]).find((entry2=>entry2.participantId===alternate.participantId));alternate.entryPosition=null==entry?void 0:entry.entryPosition})),availableAlternates.sort(((a,b)=>(a.entryPosition||1/0)-(b.entryPosition||1/0))),availableAlternatesParticipantIds.length&&validActions.push({payload:{drawId,matchUpId,structureId,sideNumber},availableParticipantIds:availableAlternatesParticipantIds,participantsAvailable:availableAlternates,method:ASSIGN_SIDE_METHOD,type:ALTERNATE})}const structureIsComplete=isCompletedStructure({drawDefinition,structure}),participantAssignedDrawPositions=assignedPositions.filter((assignment=>assignment.participantId)).map((assignment=>assignment.drawPosition)),byeAssignedDrawPositions=assignedPositions.filter((assignment=>assignment.bye)).map((assignment=>assignment.drawPosition)),isCollectionMatchUp=matchUp.collectionId,isByeMatchUp=matchUp.matchUpStatus===BYE||!isCollectionMatchUp&&(null==(_e=matchUp.drawPositions)?void 0:_e.reduce(((isByeMatchUp2,drawPosition)=>byeAssignedDrawPositions.includes(drawPosition)||isByeMatchUp2),!1));if(isByeMatchUp)return{validActions,isByeMatchUp};isAvailableAction({policyActions,action:REFEREE})&&validActions.push({type:REFEREE,payload:{matchUpId}});const isInComplete=!isDirectingMatchUpStatus({matchUpStatus:matchUp.matchUpStatus}),structureScoringPolicies=null==(_f=null==appliedPolicies?void 0:appliedPolicies.scoring)?void 0:_f.structures,stageSpecificPolicies=(null==structureScoringPolicies?void 0:structureScoringPolicies.stage)&&(null==structureScoringPolicies?void 0:structureScoringPolicies.stage[structure.stage]),sequenceSpecificPolicies=(null==stageSpecificPolicies?void 0:stageSpecificPolicies.stageSequence)&&stageSpecificPolicies.stageSequence[structure.stageSequence],scoringActive=!((null==(_g=null==appliedPolicies?void 0:appliedPolicies.scoring)?void 0:_g.requireAllPositionsAssigned)||(null==stageSpecificPolicies?void 0:stageSpecificPolicies.requireAllPositionsAssigned)||(null==sequenceSpecificPolicies?void 0:sequenceSpecificPolicies.requireAllPositionsAssigned))||allPositionsAssigned,hasParticipants=matchUp.sides&&2===matchUp.sides.filter((side2=>side2&&side2.participantId)).length;let activeDownstream;const isDoubleExit=[DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(matchUp.matchUpStatus),targetData=positionTargets({inContextDrawMatchUps,drawDefinition,matchUpId});activeDownstream=isActiveDownstream({inContextDrawMatchUps,drawDefinition,targetData});const readyToScore=(2===(null==(_h=null==inContextMatchUp?void 0:inContextMatchUp.drawPositions)?void 0:_h.length)&&inContextMatchUp.drawPositions.every((drawPosition=>participantAssignedDrawPositions.includes(drawPosition)))&&2===(null==(_i=null==inContextMatchUp?void 0:inContextMatchUp.sides)?void 0:_i.length)&&inContextMatchUp.sides.every((({participantId:participantId2})=>participantId2))||hasParticipants)&&!(isDoubleExit&&activeDownstream),addPenaltyAction={type:ADD_PENALTY,method:ADD_PENALTY_METHOD,payload:{drawId,matchUpId,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(isInComplete&&validActions.push({type:SCHEDULE,method:SCHEDULE_METHOD,payload:{drawId,matchUpId,schedule:{}}}),isAvailableAction({policyActions,action:ADD_PENALTY})&&((null==side?void 0:side.participant)||!sideNumber&&(null==matchUpParticipantIds?void 0:matchUpParticipantIds.length))&&validActions.push(addPenaltyAction),isInComplete&&readyToScore&&validActions.push({type:STATUS}),scoringActive&&readyToScore){const{matchUpId:matchUpId2,matchUpFormat}=matchUp,payload={drawId,matchUpId:matchUpId2,matchUpFormat,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};validActions.push({info:"set outcome and winningSide",method:SCHEDULE_METHOD,type:SCORE,payload}),isAvailableAction({policyActions,action:START})&&validActions.push({type:START}),isAvailableAction({policyActions,action:END})&&validActions.push({type:END})}if(isCollectionMatchUp){const matchUpType=inContextMatchUp.matchUpType,allParticipantIds=inContextMatchUp.sides.flatMap((side2=>{var _a2;return(null==(_a2=side2.participant)?void 0:_a2.individualParticipants)||side2.participant})).filter(Boolean).map(getParticipantId),existingParticipants=inContextMatchUp.sides.filter((side2=>!sideNumber||side2.sideNumber===sideNumber)).flatMap((side2=>{var _a2;return(null==(_a2=side2.participant)?void 0:_a2.individualParticipants)||side2.participant})).filter(Boolean),existingParticipantIds=existingParticipants.map(getParticipantId),availableIndividualParticipants=inContextDrawMatchUps.find((drawMatchUp=>drawMatchUp.matchUpId===inContextMatchUp.matchUpTieId)).sides.map((side2=>side2.participant.individualParticipants.filter((({participantId:participantId2})=>!existingParticipantIds.includes(participantId2))))),availableParticipants=sideNumber?availableIndividualParticipants[sideNumber-1]:availableIndividualParticipants.map(((available2,i)=>({participants:available2,sideNumber:i+1}))),availableParticipantIds=sideNumber?null==(_j=availableIndividualParticipants[sideNumber-1])?void 0:_j.map(getParticipantId):availableIndividualParticipants.map(((available2,i)=>({participants:null==available2?void 0:available2.map(getParticipantId),sideNumber:i+1}))),assignmentAvailable=sideNumber&&(matchUpType===SINGLES_MATCHUP&&!existingParticipantIds.length||matchUpType===DOUBLES_MATCHUP&&existingParticipantIds.length<2)||!sideNumber&&(matchUpType===SINGLES_MATCHUP&&existingParticipantIds.length<2||matchUpType===DOUBLES_MATCHUP&&existingParticipantIds.length<4),availableIds=availableParticipantIds.filter((id=>!allParticipantIds.includes(id))),available=availableParticipants.filter((({participantId:participantId2})=>availableIds.includes(participantId2)));if(assignmentAvailable&&availableIds.length&&validActions.push({availableParticipantIds:availableIds,method:ASSIGN_TEAM_POSITION_METHOD,availableParticipants:available,type:ASSIGN_PARTICIPANT,payload:{participantId:void 0,tieMatchUpId:matchUpId,drawId}}),!(null==existingParticipantIds?void 0:existingParticipantIds.length)||scoreHasValue(matchUp)&&!(null==(_k=null==side?void 0:side.substitutions)?void 0:_k.length)||validActions.push({method:REMOVE_TEAM_POSITION_METHOD,type:REMOVE_PARTICIPANT,existingParticipantIds,payload:{participantId:void 0,tieMatchUpId:matchUpId,drawId}}),(!sideNumber&&(null==existingParticipantIds?void 0:existingParticipantIds.length)||sideNumber&&(null==side?void 0:side.participant))&&validActions.push({availableParticipantIds:availableIds,method:REPLACE_TEAM_POSITION_METHOD,availableParticipants:available,type:REPLACE_PARTICIPANT,existingParticipantIds,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:matchUpId,drawId}}),isAvailableAction({policyActions,action:REMOVE_SUBSTITUTION})&&(null==(_l=null==side?void 0:side.substitutions)?void 0:_l.length)){const sideIndividualParticipantIds=(null==(_m=side.participant)?void 0:_m.participantType)===INDIVIDUAL&&[side.participantId]||(null==(_n=side.participant)?void 0:_n.participantType)===PAIR&&side.participant.individualParticipantIds||[],substitutedParticipantIds=side.substitutions.map((sub=>sub.participantId)).filter((id=>sideIndividualParticipantIds.includes(id)));participantId&&!substitutedParticipantIds.includes(participantId)||validActions.push({method:REMOVE_TEAM_POSITION_METHOD,type:REMOVE_SUBSTITUTION,substitutedParticipantIds,payload:{participantId:void 0,tieMatchUpId:matchUpId,drawId}})}const matchUpActionPolicy=null==specifiedPolicyDefinitions?void 0:specifiedPolicyDefinitions[POLICY_TYPE_MATCHUP_ACTIONS],substituteWithoutScore=null==matchUpActionPolicy?void 0:matchUpActionPolicy.substituteWithoutScore,substituteAfterCompleted=null==matchUpActionPolicy?void 0:matchUpActionPolicy.substituteAfterCompleted;if(isAvailableAction({policyActions,action:SUBSTITUTION})&&2===matchUpParticipantIds.length&&(!sideNumber&&(null==existingParticipantIds?void 0:existingParticipantIds.length)||sideNumber&&(null==side?void 0:side.participant))&&(substituteWithoutScore||scoreHasValue(matchUp))&&(substituteAfterCompleted||!completedMatchUpStatuses.includes(matchUp.matchUpStatus))&&existingParticipants.length&&availableParticipants.length){const existingParticipantIds2=existingParticipants.map(getParticipantId);validActions.push({info:"list of team players available for substitution",method:SUBSTITUTION_METHOD,availableParticipantIds,existingParticipantIds:existingParticipantIds2,availableParticipants,existingParticipants,type:SUBSTITUTION,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber,matchUpId,drawId}})}}return{structureIsComplete,validActions,isDoubleExit}}function matchUpActions$1({policyDefinitions,tournamentRecord,drawDefinition,participantId,sideNumber,matchUpId,drawId,event}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!drawId){const{matchUps}=allTournamentMatchUps({tournamentRecord});drawId=matchUps.reduce(((drawId2,candidate)=>candidate.matchUpId===matchUpId?candidate.drawId:drawId2),void 0);drawDefinition=(tournamentRecord.events||[]).map((event2=>event2.drawDefinitions||[])).flat().reduce(((drawDefinition2,candidate)=>candidate.drawId===drawId?candidate:drawDefinition2),void 0)}const{policyDefinitions:attachedPolicy}=getPolicyDefinitions({policyTypes:[POLICY_TYPE_POSITION_ACTIONS],tournamentRecord,drawDefinition,event});return policyDefinitions=policyDefinitions||attachedPolicy,drawId?matchUpActions$2({tournamentParticipants:tournamentRecord.participants,policyDefinitions,drawDefinition,participantId,sideNumber,matchUpId,drawId}):{error:DRAW_DEFINITION_NOT_FOUND}}var __defProp$33=Object.defineProperty,__defProps$1F=Object.defineProperties,__getOwnPropDescs$1F=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$34=Object.getOwnPropertySymbols,__hasOwnProp$34=Object.prototype.hasOwnProperty,__propIsEnum$34=Object.prototype.propertyIsEnumerable,__defNormalProp$33=(obj,key,value)=>key in obj?__defProp$33(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const queryGovernor$3={getParticipantScaleItem:function getParticipantScaleItem$1({policyDefinitions,tournamentRecords,scaleAttributes,participantId,inContext,personId}){let result=publicFindParticipant({policyDefinitions,tournamentRecords,participantId,inContext,personId});if(result.error)return result;const{participant,tournamentId}=result;return result=participantScaleItem({participant,scaleAttributes}),result.error?__spreadProps$1G(__spreadValues$35({},result),{tournamentId}):__spreadValues$35(__spreadProps$1G(__spreadValues$35({},SUCCESS),{tournamentId}),result)},getCompetitionDateRange,getTournamentIds:function getTournamentIds({tournamentRecords}){const tournamentIds=Object.keys(tournamentRecords);return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$34.call(b,prop)&&__defNormalProp$33(a,prop,b[prop]);if(__getOwnPropSymbols$34)for(var prop of __getOwnPropSymbols$34(b))__propIsEnum$34.call(b,prop)&&__defNormalProp$33(a,prop,b[prop]);return a})({},SUCCESS),__defProps$1F(a,__getOwnPropDescs$1F({tournamentIds}));var a},competitionScheduleMatchUps,getSchedulingProfileIssues:function getSchedulingProfileIssues({scheduleDates=[],tournamentRecords,periodLength=30}={}){if("object"!=typeof tournamentRecords)return{error:INVALID_TOURNAMENT_RECORD};if(!Array.isArray(scheduleDates))return{error:INVALID_VALUES};if(!scheduleDates.every(isValidDateString))return{error:INVALID_DATE};const issues=[];let issuesCount=0;const roundIndexShouldBeAfter={},{schedulingProfile}=getSchedulingProfile$1({tournamentRecords});if(!schedulingProfile)return __spreadValues$34({issues},SUCCESS);const{matchUps}=allCompetitionMatchUps({nextMatchUps:!0,tournamentRecords});for(const dateProfile of schedulingProfile){const{scheduleDate,venues=[]}=dateProfile;if(!(null==scheduleDates?void 0:scheduleDates.length)||scheduleDates.includes(scheduleDate))for(const venue of venues||[])if(venue){const{rounds}=venue,schedulingErrors=[];let{orderedMatchUpIds,scheduledRoundsDetails}=getScheduledRoundsDetails({tournamentRecords,periodLength,matchUps,rounds});const{matchUpDependencies}=getMatchUpDependencies({tournamentRecords,matchUps}),getRoundIndex=matchUpId=>{let roundIndex;return scheduledRoundsDetails.find(((round,index)=>{const includes=round.matchUpIds.includes(matchUpId);return includes&&(roundIndex=index),includes})),roundIndex};if(orderedMatchUpIds.forEach(((matchUpId,index)=>{var _a;const shouldBeAfter=intersection(orderedMatchUpIds.slice(index+1),(null==(_a=null==matchUpDependencies?void 0:matchUpDependencies[matchUpId])?void 0:_a.matchUpIds)||[]);shouldBeAfter.length&&schedulingErrors.push({matchUpId,shouldBeAfter})})),schedulingErrors.length){issuesCount+=schedulingErrors.length;const errorsDetail=schedulingErrors.map((({matchUpId,shouldBeAfter})=>{const matchUpRoundIndex=getRoundIndex(matchUpId),earlierRoundIndices=unique(shouldBeAfter.map(getRoundIndex));return roundIndexShouldBeAfter[scheduleDate]||(roundIndexShouldBeAfter[scheduleDate]={}),roundIndexShouldBeAfter[scheduleDate][matchUpRoundIndex]||(roundIndexShouldBeAfter[scheduleDate][matchUpRoundIndex]=[]),earlierRoundIndices.forEach((index=>{roundIndexShouldBeAfter[scheduleDate][matchUpRoundIndex].includes(index)||roundIndexShouldBeAfter[scheduleDate][matchUpRoundIndex].push(index)})),{matchUpId,matchUpRoundIndex,earlierRoundIndices,shouldBeAfter}}));issues.push(...errorsDetail)}}}const profileIssues={matchUpIdShouldBeAfter:Object.assign({},...issues.map((issue=>{const{matchUpId,shouldBeAfter,earlierRoundIndices}=issue;return{[matchUpId]:{earlierRoundIndices,shouldBeAfter}}})))};return __spreadValues$34({issuesCount,profileIssues,roundIndexShouldBeAfter},SUCCESS)},allCompetitionMatchUps,competitionMatchUps,matchUpActions:function matchUpActions({tournamentRecords,participantId,tournamentId,sideNumber,matchUpId,eventId,drawId}={}){if("object"!=typeof tournamentRecords||"string"!=typeof tournamentId||"string"!=typeof matchUpId||"string"!=typeof drawId)return{error:INVALID_VALUES};const tournamentRecord=tournamentRecords[tournamentId];if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const result=findEvent({tournamentRecord,eventId,drawId});return result.error?result:matchUpActions$1({drawDefinition:result.drawDefinition,tournamentRecord,participantId,sideNumber,matchUpId,drawId})},getCompetitionVenues,getVenuesAndCourts,getVenuesReport:function getVenuesReport({ignoreDisabled=!0,tournamentRecords,venueIds=[],dates=[]}){if(!Array.isArray(dates))return{error:INVALID_VALUES,dates};if(!Array.isArray(venueIds))return{error:INVALID_VALUES,venueIds};if(!dates.every(isValidDateString))return{error:INVALID_DATE};const result=getVenuesAndCourts({tournamentRecords,ignoreDisabled,dates});if(result.error)return result;const venues=result.venues.filter((({venueId})=>!(null==venueIds?void 0:venueIds.length)||venueIds.includes(venueId))),courtDates=result.courts.reduce(((dates2,court)=>(court.dateAvailability.forEach((({date})=>{dates2.includes(date)||dates2.push(date)})),dates2)),[]).filter((date=>!dates.length||dates.includes(date))),matchUpFilters={venueIds:venues.map((({venueId})=>venueId))},{matchUps}=allCompetitionMatchUps({afterRecoveryTimes:!0,tournamentRecords,matchUpFilters});return{venuesReport:venues.map((venue=>function getVenueReport(dates,venue,matchUps){const{venueId,courts,venueName}=venue,venueReport={};return dates.forEach((date=>{let availableMinutes=0,scheduledMinutes=0,availableCourts=0;for(const court of courts){const courtDate=court.dateAvailability.find((availability=>availability.date===date)),timeSlots=courtDate&&generateTimeSlots({courtDate}),courtAvailableMinutes=null==timeSlots?void 0:timeSlots.reduce(((minutes,timeSlot)=>{const{startTime,endTime}=timeSlot;return minutes+(timeStringMinutes(endTime)-timeStringMinutes(startTime))}),0);courtAvailableMinutes&&(availableCourts+=1),availableMinutes+=courtAvailableMinutes}const venueMatchUps=matchUps.filter((({schedule})=>schedule.venueId===venueId&&sameDay(date,schedule.scheduledDate)));venueMatchUps.forEach((({schedule})=>{const startTime=extractTime(schedule.scheduledTime),matchUpScheduledMinutes=timeStringMinutes(addMinutesToTimeString(startTime,schedule.averageMinutes))-timeStringMinutes(startTime);scheduledMinutes+=matchUpScheduledMinutes}));const percentUtilization=availableMinutes?(scheduledMinutes/availableMinutes*100).toFixed(2):"100";venueReport[date]={scheduledMatchUpsCount:venueMatchUps.length,availableCourts,availableMinutes,scheduledMinutes,percentUtilization}})),{venueId,venueName,venueReport}}(courtDates,venue,matchUps)))}},credits};var __defProp$32=Object.defineProperty,__getOwnPropSymbols$33=Object.getOwnPropertySymbols,__hasOwnProp$33=Object.prototype.hasOwnProperty,__propIsEnum$33=Object.prototype.propertyIsEnumerable,__defNormalProp$32=(obj,key,value)=>key in obj?__defProp$32(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$32=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$33.call(b,prop)&&__defNormalProp$32(a,prop,b[prop]);if(__getOwnPropSymbols$33)for(var prop of __getOwnPropSymbols$33(b))__propIsEnum$33.call(b,prop)&&__defNormalProp$32(a,prop,b[prop]);return a};function disableCourts$1({tournamentRecord,courtIds,dates}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(courtIds))return{info:mustBeAnArray("courtIds"),error:MISSING_VALUE};const disabledValue=!Array.isArray(dates)||!dates.length||{dates},disableCourt=court=>addExtension$1({creationTime:!1,element:court,extension:{value:disabledValue,name:DISABLED}});for(const venue of tournamentRecord.venues||[])for(const court of venue.courts||[])if(null==courtIds?void 0:courtIds.includes(court.courtId)){const result=disableCourt(court);if(result.error)return result}return __spreadValues$32({},SUCCESS)}var __defProp$31=Object.defineProperty,__getOwnPropSymbols$32=Object.getOwnPropertySymbols,__hasOwnProp$32=Object.prototype.hasOwnProperty,__propIsEnum$32=Object.prototype.propertyIsEnumerable,__defNormalProp$31=(obj,key,value)=>key in obj?__defProp$31(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$30=Object.defineProperty,__getOwnPropSymbols$31=Object.getOwnPropertySymbols,__hasOwnProp$31=Object.prototype.hasOwnProperty,__propIsEnum$31=Object.prototype.propertyIsEnumerable,__defNormalProp$30=(obj,key,value)=>key in obj?__defProp$30(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$30=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$31.call(b,prop)&&__defNormalProp$30(a,prop,b[prop]);if(__getOwnPropSymbols$31)for(var prop of __getOwnPropSymbols$31(b))__propIsEnum$31.call(b,prop)&&__defNormalProp$30(a,prop,b[prop]);return a};function disableVenues$1({tournamentRecord,venueIds}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(venueIds))return{error:MISSING_VALUE,info:mustBeAnArray("venueIds")};for(const venue of tournamentRecord.venues||[])if(null==venueIds?void 0:venueIds.includes(venue.venueId)){const result=addExtension$1({creationTime:!1,element:venue,extension:{name:DISABLED,value:!0}});if(result.error)return result}return __spreadValues$30({},SUCCESS)}var __defProp$2$=Object.defineProperty,__getOwnPropSymbols$30=Object.getOwnPropertySymbols,__hasOwnProp$30=Object.prototype.hasOwnProperty,__propIsEnum$30=Object.prototype.propertyIsEnumerable,__defNormalProp$2$=(obj,key,value)=>key in obj?__defProp$2$(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$2_=Object.defineProperty,__getOwnPropSymbols$2$=Object.getOwnPropertySymbols,__hasOwnProp$2$=Object.prototype.hasOwnProperty,__propIsEnum$2$=Object.prototype.propertyIsEnumerable,__defNormalProp$2_=(obj,key,value)=>key in obj?__defProp$2_(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2_=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2$.call(b,prop)&&__defNormalProp$2_(a,prop,b[prop]);if(__getOwnPropSymbols$2$)for(var prop of __getOwnPropSymbols$2$(b))__propIsEnum$2$.call(b,prop)&&__defNormalProp$2_(a,prop,b[prop]);return a};function enableCourts$1({tournamentRecord,courtIds,enableAll,dates}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(courtIds)&&!enableAll)return{error:MISSING_VALUE,info:mustBeAnArray("courtIds")};for(const venue of tournamentRecord.venues||[])for(const court of venue.courts||[])if(enableAll||(null==courtIds?void 0:courtIds.includes(court.courtId)))if(Array.isArray(dates)){const{extension}=findExtension$2({element:court,name:DISABLED});if(extension){let value=extension.value;Array.isArray(value.dates)&&(value.dates=value.dates.filter((date=>!dates.includes(date)))),addExtension$1({creationTime:!1,element:court,extension:{name:DISABLED,value}})}}else removeExtension$1({element:court,name:DISABLED});return __spreadValues$2_({},SUCCESS)}var __defProp$2Z=Object.defineProperty,__getOwnPropSymbols$2_=Object.getOwnPropertySymbols,__hasOwnProp$2_=Object.prototype.hasOwnProperty,__propIsEnum$2_=Object.prototype.propertyIsEnumerable,__defNormalProp$2Z=(obj,key,value)=>key in obj?__defProp$2Z(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$2Y=Object.defineProperty,__getOwnPropSymbols$2Z=Object.getOwnPropertySymbols,__hasOwnProp$2Z=Object.prototype.hasOwnProperty,__propIsEnum$2Z=Object.prototype.propertyIsEnumerable,__defNormalProp$2Y=(obj,key,value)=>key in obj?__defProp$2Y(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2Y=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2Z.call(b,prop)&&__defNormalProp$2Y(a,prop,b[prop]);if(__getOwnPropSymbols$2Z)for(var prop of __getOwnPropSymbols$2Z(b))__propIsEnum$2Z.call(b,prop)&&__defNormalProp$2Y(a,prop,b[prop]);return a};function enableVenues$1({tournamentRecord,venueIds,enableAll}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(venueIds)&&!enableAll)return{error:MISSING_VALUE,info:mustBeAnArray("venueIds")};for(const venue of tournamentRecord.venues||[])(enableAll||(null==venueIds?void 0:venueIds.includes(venue.venueId)))&&removeExtension$1({element:venue,name:DISABLED});return __spreadValues$2Y({},SUCCESS)}var __defProp$2X=Object.defineProperty,__getOwnPropSymbols$2Y=Object.getOwnPropertySymbols,__hasOwnProp$2Y=Object.prototype.hasOwnProperty,__propIsEnum$2Y=Object.prototype.propertyIsEnumerable,__defNormalProp$2X=(obj,key,value)=>key in obj?__defProp$2X(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$2W=Object.defineProperty,__getOwnPropSymbols$2X=Object.getOwnPropertySymbols,__hasOwnProp$2X=Object.prototype.hasOwnProperty,__propIsEnum$2X=Object.prototype.propertyIsEnumerable,__defNormalProp$2W=(obj,key,value)=>key in obj?__defProp$2W(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2W=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2X.call(b,prop)&&__defNormalProp$2W(a,prop,b[prop]);if(__getOwnPropSymbols$2X)for(var prop of __getOwnPropSymbols$2X(b))__propIsEnum$2X.call(b,prop)&&__defNormalProp$2W(a,prop,b[prop]);return a};function removeCourtAssignment({tournamentRecord,drawDefinition,matchUpId,drawId}){if(!matchUpId)return{error:MISSING_MATCHUP_ID};if(!drawDefinition&&!drawId)return{error:MISSING_DRAW_ID};let matchUp;if(!drawDefinition){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};({drawDefinition}=findEvent({tournamentRecord,drawId}))}if(drawDefinition)({matchUp}=findMatchUp$1({drawDefinition,matchUpId}));else{if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{matchUps}=tournamentMatchUps({tournamentRecord});({matchUp}=getMatchUp$1({matchUps,matchUpId}))}if(!matchUp)return{error:MATCHUP_NOT_FOUND};if(matchUp.timeItems){matchUp.timeItems.find((candidate=>[ASSIGN_COURT,ALLOCATE_COURTS].includes(candidate.itemType)))&&(matchUp.timeItems=matchUp.timeItems.filter((({itemType})=>![ASSIGN_COURT,ALLOCATE_COURTS].includes(itemType))),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,context:"removeCourtAssignment",drawDefinition,matchUp}))}return __spreadValues$2W({},SUCCESS)}function deletionMessage({matchUpsCount=0}){return{error:SCHEDULED_MATCHUPS,info:`Schedule would be deleted from ${matchUpsCount} ${1===matchUpsCount?"matchUp":"matchUps"}; use { force: true }`}}var __defProp$2V=Object.defineProperty,__getOwnPropSymbols$2W=Object.getOwnPropertySymbols,__hasOwnProp$2W=Object.prototype.hasOwnProperty,__propIsEnum$2W=Object.prototype.propertyIsEnumerable,__defNormalProp$2V=(obj,key,value)=>key in obj?__defProp$2V(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2V=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2W.call(b,prop)&&__defNormalProp$2V(a,prop,b[prop]);if(__getOwnPropSymbols$2W)for(var prop of __getOwnPropSymbols$2W(b))__propIsEnum$2W.call(b,prop)&&__defNormalProp$2V(a,prop,b[prop]);return a};function deleteVenue$1({tournamentRecord,venueId,force}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if("string"!=typeof venueId)return{error:MISSING_VENUE_ID};const contextFilters={venueIds:[venueId]},{matchUps:matchUpsToUnschedule}=allTournamentMatchUps({tournamentRecord,contextFilters});if(matchUpsToUnschedule.length&&!force)return deletionMessage({matchUpsCount:matchUpsToUnschedule.length});for(const matchUp of matchUpsToUnschedule){const result=removeCourtAssignment({matchUpId:matchUp.matchUpId,drawId:matchUp.drawId,tournamentRecord});if(result.error)return result}let deleted;return tournamentRecord.venues=(tournamentRecord.venues||[]).filter((venue=>{if(venue.venueId!==venueId)return!0;deleted=!0})),deleted?(addNotice({payload:{venueId,tournamentId:tournamentRecord.tournamentId},topic:DELETE_VENUE,key:venueId}),__spreadValues$2V({},SUCCESS)):{error:VENUE_NOT_FOUND}}function getSchedulingProfile({tournamentRecord}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const tournamentId=tournamentRecord.tournamentId,{extension}=findTournamentExtension({name:SCHEDULING_PROFILE,tournamentRecord});let schedulingProfile=(null==extension?void 0:extension.value)||[];if(schedulingProfile.length){const venueIds=null==(_a=tournamentRecord.venues)?void 0:_a.map((({venueId,courts})=>(null==courts?void 0:courts.length)&&venueId)),{eventIds,drawIds}=getEventIdsAndDrawIds({tournamentRecords:{[tournamentId]:tournamentRecord}}),{updatedSchedulingProfile,modifications,issues}=getUpdatedSchedulingProfile({schedulingProfile,venueIds,eventIds,drawIds});if(modifications){schedulingProfile=updatedSchedulingProfile;const result=function saveSchedulingProfile({tournamentRecord,schedulingProfile}){return addTournamentExtension({tournamentRecord,extension:{name:SCHEDULING_PROFILE,value:schedulingProfile}})}({tournamentRecord,schedulingProfile});return result.error?result:{schedulingProfile,modifications,issues}}}return{schedulingProfile,modifications:0}}function checkSchedulingProfile({tournamentRecord,schedulingProfile,requireCourts=!0}){if(!schedulingProfile){const{modifications:modifications2,issues:issues2}=getSchedulingProfile({tournamentRecord});return{success:!modifications2,modifications:modifications2,issues:issues2}}const{venueIds,eventIds,drawIds}=tournamentRelevantSchedulingIds({tournamentRecord,requireCourts}),{modifications,issues}=getUpdatedSchedulingProfile({schedulingProfile,venueIds,eventIds,drawIds});return{success:!modifications,modifications,issues}}function getScheduledCourtMatchUps({scheduleVisibilityFilters,tournamentRecord,matchUpFilters,venueMatchUps,courtId}){if(!tournamentRecord&&!Array.isArray(venueMatchUps))return{error:MISSING_TOURNAMENT_RECORD};if(!courtId)return{error:MISSING_COURT_ID};const{schedulingProfile}=getSchedulingProfile({tournamentRecord});if(Array.isArray(venueMatchUps))return{matchUps:getCourtMatchUps({matchUps:venueMatchUps,courtId})};const{matchUps:tournamentMatchUps}=allTournamentMatchUps({scheduleVisibilityFilters,tournamentRecord,matchUpFilters});return{matchUps:getCourtMatchUps({matchUps:tournamentMatchUps,courtId})};function getCourtMatchUps({matchUps:matchUps2,courtId:courtId2}){return scheduledSortedMatchUps({matchUps:matchUps2.filter((matchUp=>{var _a,_b,_c;const allocatedCourtIds=null==(_b=null==(_a=matchUp.schedule)?void 0:_a.allocatedCourts)?void 0:_b.map((({courtId:courtId3})=>courtId3));return(null==(_c=matchUp.schedule)?void 0:_c.courtId)===courtId2||(null==allocatedCourtIds?void 0:allocatedCourtIds.includes(courtId2))})),schedulingProfile})}}var __defProp$2U=Object.defineProperty,__getOwnPropSymbols$2V=Object.getOwnPropertySymbols,__hasOwnProp$2V=Object.prototype.hasOwnProperty,__propIsEnum$2V=Object.prototype.propertyIsEnumerable,__defNormalProp$2U=(obj,key,value)=>key in obj?__defProp$2U(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2U=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2V.call(b,prop)&&__defNormalProp$2U(a,prop,b[prop]);if(__getOwnPropSymbols$2V)for(var prop of __getOwnPropSymbols$2V(b))__propIsEnum$2V.call(b,prop)&&__defNormalProp$2U(a,prop,b[prop]);return a};function deleteCourt$1({tournamentRecord,drawDefinition,disableNotice,courtId,force}){const result=findCourt({tournamentRecord,courtId});if(result.error)return result;const venue=result.venue,{matchUps}=getScheduledCourtMatchUps({tournamentRecord,courtId});if(matchUps.length&&!force)return deletionMessage({matchUpsCount:matchUps.length});for(const matchUp of matchUps){const result2=removeCourtAssignment({matchUpId:matchUp.matchUpId,drawId:matchUp.drawId,tournamentRecord,drawDefinition});if(result2.error)return result2}return venue.courts=(venue.courts||[]).filter((courtRecord=>courtRecord.courtId!==courtId)),disableNotice||addNotice({topic:MODIFY_VENUE,payload:{venue,tournamentId:tournamentRecord.tournamentId},key:venue.venueId}),__spreadValues$2U({},SUCCESS)}var __defProp$2T=Object.defineProperty,__getOwnPropSymbols$2U=Object.getOwnPropertySymbols,__hasOwnProp$2U=Object.prototype.hasOwnProperty,__propIsEnum$2U=Object.prototype.propertyIsEnumerable,__defNormalProp$2T=(obj,key,value)=>key in obj?__defProp$2T(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function getInt(value){return parseInt(value)}function validTimePeriod({startTime,endTime}={}){if(!timeValidation.test(startTime)||!timeValidation.test(endTime))return!1;const[startHour,startMinute]=startTime.split(":").map(getInt),[endHour,endMinute]=endTime.split(":").map(getInt);return!(endHour<startHour)&&!(startHour===endHour&&endMinute<startMinute)}function startTimeSort(a,b){const[startHourA,startMinuteA]=a.startTime.split(":").map(getInt),[startHourB,startMinuteB]=b.startTime.split(":").map(getInt);return startHourA<startHourB?-1:startHourA>startHourB?1:startMinuteA<startMinuteB?-1:startMinuteA>startMinuteB?1:0}function validDateAvailability({dateAvailability}){if(!dateAvailability)return{error:MISSING_DATE_AVAILABILITY};if(!Array.isArray(dateAvailability))return{error:INVALID_DATE_AVAILABILITY};const timeNote="Times must be 24 hour => 00:00";for(const availability of dateAvailability){if("object"!=typeof availability)return{error:INVALID_DATE_AVAILABILITY};const{date,startTime,endTime,bookings=[]}=availability;if(!startTime||!endTime)return{error:INVALID_DATE_AVAILABILITY};if(date&&!dateValidation.test(date))return{error:INVALID_DATE,dateAvailability:{date},info:"Dates must be formated => YYYY-MM-DD"};if(!timeValidation.test(startTime))return{error:INVALID_TIME,dateAvailability:{startTime},info:timeNote};if(!timeValidation.test(endTime))return{error:INVALID_TIME,dateAvailability:{endTime},info:timeNote};if(startTime===endTime)return{error:INVALID_TIME,dateAvailability:{startTime,endTime},info:"startTime and endTime are equivalent"};if(!validTimePeriod({startTime,endTime}))return{error:INVALID_TIME,dateAvailability:{startTime,endTime},info:"endTime must be after startTime"};if(bookings){if(!Array.isArray(bookings))return{error:INVALID_BOOKINGS};for(const booking of bookings){if("object"!=typeof booking)return{error:INVALID_BOOKINGS};const{startTime:startTime2,endTime:endTime2}=booking;if(!timeValidation.test(startTime2))return{error:INVALID_TIME,booking:{startTime:startTime2},info:timeNote};if(!timeValidation.test(endTime2))return{error:INVALID_TIME,booking:{endTime:endTime2},info:timeNote};if(startTime2===endTime2)return{error:INVALID_TIME,dateAvailability:{startTime:startTime2,endTime:endTime2},info:"startTime and endTime are equivalent"};if(!validTimePeriod({startTime:startTime2,endTime:endTime2}))return{error:INVALID_TIME,dateAvailability:{startTime:startTime2,endTime:endTime2},info:"endTime must be after startTime"}}}}return{valid:!0}}var __defProp$2S=Object.defineProperty,__defProps$1E=Object.defineProperties,__getOwnPropDescs$1E=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2T=Object.getOwnPropertySymbols,__hasOwnProp$2T=Object.prototype.hasOwnProperty,__propIsEnum$2T=Object.prototype.propertyIsEnumerable,__defNormalProp$2S=(obj,key,value)=>key in obj?__defProp$2S(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2S=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2T.call(b,prop)&&__defNormalProp$2S(a,prop,b[prop]);if(__getOwnPropSymbols$2T)for(var prop of __getOwnPropSymbols$2T(b))__propIsEnum$2T.call(b,prop)&&__defNormalProp$2S(a,prop,b[prop]);return a},__spreadProps$1E=(a,b)=>__defProps$1E(a,__getOwnPropDescs$1E(b));function modifyCourtAvailability({tournamentRecord,dateAvailability,disableNotice,venueMatchUps,courtId,force}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!courtId)return{error:MISSING_COURT_ID};let result=validDateAvailability({dateAvailability});if(result.error)return result;const{updatedDateAvailability,totalMergeCount}=function sortAndMergeDateAvailability(dateAvailability){let totalMergeCount=0;const availabilityByDate=dateAvailability.reduce(((byDate,availability)=>{const{date,startTime,endTime,bookings}=availability;return byDate[date]||(byDate[date]=[]),byDate[date].push({startTime,endTime,bookings}),byDate}),{}),updatedDateAvailability=[];return Object.keys(availabilityByDate).forEach((date=>{availabilityByDate[date].sort(startTimeSort);const{mergedAvailability,mergeCount}=function getMergedAvailability(dateDetails){let lastStartTime,lastEndTime,lastBookings,safety=dateDetails.length,mergeCount=0;const mergedAvailability=[];for(;dateDetails.length&&safety;){const details=dateDetails.shift(),{startTime,endTime,bookings}=details;if(safety-=1,lastStartTime){if(minutesDifference(timeToDate(lastEndTime),timeToDate(startTime),!1)>0){const availability2={startTime:lastStartTime,endTime:lastEndTime};(null==lastBookings?void 0:lastBookings.length)&&(availability2.bookings=lastBookings),mergedAvailability.push(availability2),lastStartTime=startTime,lastBookings=bookings,lastEndTime=endTime}else bookings&&(lastBookings?lastBookings.push(bookings):lastBookings=bookings),lastEndTime=endTime,mergeCount+=1}else lastStartTime=startTime,lastBookings=bookings,lastEndTime=endTime}const availability={startTime:lastStartTime,endTime:lastEndTime};(null==lastBookings?void 0:lastBookings.length)&&(availability.bookings=lastBookings);return mergedAvailability.push(availability),{mergedAvailability,mergeCount}}(availabilityByDate[date]);updatedDateAvailability.push(...mergedAvailability.map((availability=>__spreadValues$2S({date},availability)))),totalMergeCount+=mergeCount})),{updatedDateAvailability,totalMergeCount}}(dateAvailability);if(dateAvailability=updatedDateAvailability,result=findCourt({tournamentRecord,courtId}),result.error)return result;const{court,venue}=result,{matchUps:courtMatchUps}=getScheduledCourtMatchUps({tournamentRecord,venueMatchUps,courtId});return(null==courtMatchUps?void 0:courtMatchUps.length)&&console.log("scheduled court matchUps",courtMatchUps.length),court.dateAvailability=dateAvailability,disableNotice||addNotice({payload:{venue,tournamentId:tournamentRecord.tournamentId},topic:MODIFY_VENUE,key:venue.venueId}),__spreadProps$1E(__spreadValues$2S({},SUCCESS),{totalMergeCount})}const courtTemplate=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0});var __defProp$2R=Object.defineProperty,__defProps$1D=Object.defineProperties,__getOwnPropDescs$1D=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2S=Object.getOwnPropertySymbols,__hasOwnProp$2S=Object.prototype.hasOwnProperty,__propIsEnum$2S=Object.prototype.propertyIsEnumerable,__defNormalProp$2R=(obj,key,value)=>key in obj?__defProp$2R(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2R=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2S.call(b,prop)&&__defNormalProp$2R(a,prop,b[prop]);if(__getOwnPropSymbols$2S)for(var prop of __getOwnPropSymbols$2S(b))__propIsEnum$2S.call(b,prop)&&__defNormalProp$2R(a,prop,b[prop]);return a},__spreadProps$1D=(a,b)=>__defProps$1D(a,__getOwnPropDescs$1D(b));function modifyCourt$1({tournamentRecord,modifications,disableNotice,venueMatchUps,courtId,force}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!courtId)return{error:MISSING_COURT_ID};if(!modifications||"object"!=typeof modifications)return{error:INVALID_OBJECT};const result=findCourt({tournamentRecord,courtId});if(result.error)return result;const{court,venue}=result,validAttributes=Object.keys(courtTemplate()).filter((attribute=>"courtId"!==attribute));if(!Object.keys(modifications).filter((attribute=>validAttributes.includes(attribute))).length)return{error:NO_VALID_ATTRIBUTES};const validReplacements=validAttributes.filter((attribute=>!["dateAvailability"].includes(attribute)));if(Object.keys(modifications).filter((attribute=>validReplacements.includes(attribute))).forEach((attribute=>Object.assign(court,{[attribute]:modifications[attribute]}))),modifications.dateAvailability){const result2=modifyCourtAvailability({dateAvailability:modifications.dateAvailability,tournamentRecord,venueMatchUps,disableNotice,courtId,force});if(result2.error)return result2}return disableNotice||addNotice({payload:{venue,tournamentId:tournamentRecord.tournamentId},topic:MODIFY_VENUE,key:venue.venueId}),__spreadProps$1D(__spreadValues$2R({},SUCCESS),{court:makeDeepCopy(court)})}var __defProp$2Q=Object.defineProperty,__getOwnPropSymbols$2R=Object.getOwnPropertySymbols,__hasOwnProp$2R=Object.prototype.hasOwnProperty,__propIsEnum$2R=Object.prototype.propertyIsEnumerable,__defNormalProp$2Q=(obj,key,value)=>key in obj?__defProp$2Q(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const venueTemplate=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]});var __defProp$2P=Object.defineProperty,__defProps$1C=Object.defineProperties,__getOwnPropDescs$1C=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2Q=Object.getOwnPropertySymbols,__hasOwnProp$2Q=Object.prototype.hasOwnProperty,__propIsEnum$2Q=Object.prototype.propertyIsEnumerable,__defNormalProp$2P=(obj,key,value)=>key in obj?__defProp$2P(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2P=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2Q.call(b,prop)&&__defNormalProp$2P(a,prop,b[prop]);if(__getOwnPropSymbols$2Q)for(var prop of __getOwnPropSymbols$2Q(b))__propIsEnum$2Q.call(b,prop)&&__defNormalProp$2P(a,prop,b[prop]);return a},__spreadProps$1C=(a,b)=>__defProps$1C(a,__getOwnPropDescs$1C(b));function addCourt({tournamentRecord,disableNotice,venueId,courtId,court}){const{venue}=findVenue({tournamentRecord,venueId});if(!venue)return{error:VENUE_NOT_FOUND};venue.courts||(venue.courts=[]);const courtRecord=__spreadProps$1C(__spreadValues$2P({},courtTemplate()),{venueId,courtId});courtRecord.courtId||(courtRecord.courtId=UUID());if(venue.courts.reduce(((exists,candidate)=>exists||candidate.courtId===courtRecord.courtId),void 0))return{error:COURT_EXISTS};{const dateAvailability=((null==court?void 0:court.dateAvailability)||[]).map((availabilty=>{var _a;return __spreadProps$1C(__spreadValues$2P({},availabilty),{date:extractDate(availabilty.date),startTime:extractTime(availabilty.startTime),endTime:extractTime(availabilty.endTime),bookings:null==(_a=availabilty.bookings)?void 0:_a.map((({startTime,endTime,bookingType})=>({startTime:extractTime(startTime),endTime:extractTime(endTime),bookingType})))})}));for(const attribute of Object.keys(courtRecord))if(court[attribute])if("dateAvailability"===attribute){const result=validDateAvailability({dateAvailability});if(!result.valid&&result.error)return result;courtRecord.dateAvailability=dateAvailability}else courtRecord[attribute]=court[attribute];return venue.courts.push(courtRecord),disableNotice||addNotice({payload:{venue,tournamentId:tournamentRecord.tournamentId},topic:MODIFY_VENUE,key:venue.venueId}),__spreadProps$1C(__spreadValues$2P({},SUCCESS),{court:makeDeepCopy(courtRecord),venueId})}}function addCourts$1({dateAvailability=[],tournamentRecord,courtNames=[],courtTimings,courtsCount,startTime,idPrefix,courtIds,endTime,venueId,dates}){if(!venueId)return{error:MISSING_VENUE_ID};let result=findVenue({tournamentRecord,venueId});if(result.error)return result;const{venue}=result;if(!isNumeric(courtsCount)||!courtNames)return{error:MISSING_COURTS_INFO};result=generateRange(0,courtsCount=courtsCount||courtNames.length).map((i=>{const courtTiming=null==courtTimings?void 0:courtTimings[i],courtAvailability=courtTiming?dates.map((date=>__spreadValues$2P({date:formatDate(date),startTime,endTime},courtTiming))):dateAvailability;return courtTiming&&startTime&&endTime&&courtAvailability.push({startTime,endTime}),{courtName:courtNames[i]||venue.venueAbbreviation&&`${venue.venueAbbreviation} ${i+1}`||`Court ${i+1}`,dateAvailability:courtAvailability}})).map(((court,i)=>{const courtId=(null==courtIds?void 0:courtIds.pop())||idPrefix&&`${idPrefix}-${i+1}`;return addCourt({disableNotice:!0,tournamentRecord,courtId,venueId,court})}));const courtRecords=result.map((outcome=>outcome.court)).filter(Boolean);return courtRecords.length!==parseInt(courtsCount)?{error:"Not all courts could be generated",result}:(addNotice({payload:{venue,tournamentId:tournamentRecord.tournamentId},topic:MODIFY_VENUE,key:venue.venueId}),__spreadProps$1C(__spreadValues$2P({},SUCCESS),{courts:makeDeepCopy(courtRecords)}))}var __defProp$2O=Object.defineProperty,__defProps$1B=Object.defineProperties,__getOwnPropDescs$1B=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2P=Object.getOwnPropertySymbols,__hasOwnProp$2P=Object.prototype.hasOwnProperty,__propIsEnum$2P=Object.prototype.propertyIsEnumerable,__defNormalProp$2O=(obj,key,value)=>key in obj?__defProp$2O(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2O=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2P.call(b,prop)&&__defNormalProp$2O(a,prop,b[prop]);if(__getOwnPropSymbols$2P)for(var prop of __getOwnPropSymbols$2P(b))__propIsEnum$2P.call(b,prop)&&__defNormalProp$2O(a,prop,b[prop]);return a},__spreadProps$1B=(a,b)=>__defProps$1B(a,__getOwnPropDescs$1B(b));function modifyVenue$1({tournamentRecord,modifications,venueId,force}){var _a,_b;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!modifications||"object"!=typeof modifications)return{error:INVALID_OBJECT};if(!venueId)return{error:MISSING_VENUE_ID};const{matchUps:venueMatchUps}=function getScheduledVenueMatchUps({scheduleVisibilityFilters,tournamentRecord,matchUpFilters,venueId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!venueId)return{error:MISSING_VENUE_ID};const{schedulingProfile}=getSchedulingProfile({tournamentRecord}),{matchUps:tournamentMatchUps}=allTournamentMatchUps({scheduleVisibilityFilters,tournamentRecord,matchUpFilters});return{matchUps:function getVenueMatchUps({matchUps:matchUps2,venueId:venueId2}){return scheduledSortedMatchUps({matchUps:matchUps2.filter((matchUp=>{var _a,_b,_c;const allocatedVenueIds=null==(_b=null==(_a=matchUp.schedule)?void 0:_a.allocatedCourts)?void 0:_b.map((({venueId:venueId3})=>venueId3));return(null==(_c=matchUp.schedule)?void 0:_c.venueId)===venueId2||(null==allocatedVenueIds?void 0:allocatedVenueIds.includes(venueId2))})),schedulingProfile})}({matchUps:tournamentMatchUps,venueId})}}({tournamentRecord,venueId}),result=findVenue({tournamentRecord,venueId});if(result.error)return result;const venue=result.venue,validAttributes=Object.keys(venueTemplate()).filter((attribute=>"venueId"!==attribute));if(!Object.keys(modifications).filter((attribute=>validAttributes.includes(attribute))).length)return{error:NO_VALID_ATTRIBUTES};const validReplacements=validAttributes.filter((attribute=>!["courts","onlineResources"].includes(attribute)));Object.keys(modifications).filter((attribute=>validReplacements.includes(attribute))).forEach((attribute=>Object.assign(venue,{[attribute]:modifications[attribute]})));const existingCourtIds=(null==(_a=null==venue?void 0:venue.courts)?void 0:_a.map((court=>court.courtId)))||[],courtIdsToModify=(null==(_b=modifications.courts)?void 0:_b.map((court=>court.courtId)))||[],courtIdsToDelete=existingCourtIds.filter((courtId=>!courtIdsToModify.includes(courtId)));if(courtIdsToDelete.length){const scheduleDeletionsCount=venue.courts.filter((court=>courtIdsToDelete.includes(court.courtId))).map((court=>{var _a2;return(null==(_a2=getScheduledCourtMatchUps({courtId:court.courtId,tournamentRecord,venueMatchUps}).matchUps)?void 0:_a2.length)||0})).reduce(((a,b)=>a+b));if(scheduleDeletionsCount&&!force){return{error:deletionMessage({matchUpsCount:scheduleDeletionsCount})}}venue.courts=venue.courts.filter((court=>courtIdsToModify.includes(court.courtId)))}if(modifications.courts)for(const court of modifications.courts){const{courtId}=court||{};let result2=modifyCourt$1({modifications:court,disableNotice:!0,tournamentRecord,venueMatchUps,courtId,force});if(result2.error===COURT_NOT_FOUND&&(result2=addCourt({disableNotice:!0,tournamentRecord,venueId,court})),result2.error)return result2}return checkSchedulingProfile({tournamentRecord}),addNotice({payload:{venue,tournamentId:tournamentRecord.tournamentId},topic:MODIFY_VENUE,key:venue.venueId}),__spreadProps$1B(__spreadValues$2O({},SUCCESS),{venue:makeDeepCopy(venue)})}var __defProp$2N=Object.defineProperty,__getOwnPropSymbols$2O=Object.getOwnPropertySymbols,__hasOwnProp$2O=Object.prototype.hasOwnProperty,__propIsEnum$2O=Object.prototype.propertyIsEnumerable,__defNormalProp$2N=(obj,key,value)=>key in obj?__defProp$2N(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$2M=Object.defineProperty,__getOwnPropSymbols$2N=Object.getOwnPropertySymbols,__hasOwnProp$2N=Object.prototype.hasOwnProperty,__propIsEnum$2N=Object.prototype.propertyIsEnumerable,__defNormalProp$2M=(obj,key,value)=>key in obj?__defProp$2M(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2M=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2N.call(b,prop)&&__defNormalProp$2M(a,prop,b[prop]);if(__getOwnPropSymbols$2N)for(var prop of __getOwnPropSymbols$2N(b))__propIsEnum$2N.call(b,prop)&&__defNormalProp$2M(a,prop,b[prop]);return a};var __defProp$2L=Object.defineProperty,__defProps$1A=Object.defineProperties,__getOwnPropDescs$1A=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2M=Object.getOwnPropertySymbols,__hasOwnProp$2M=Object.prototype.hasOwnProperty,__propIsEnum$2M=Object.prototype.propertyIsEnumerable,__defNormalProp$2L=(obj,key,value)=>key in obj?__defProp$2L(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const venueGovernor={disableCourts:function disableCourts({tournamentRecords,courtIds,dates}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!Array.isArray(courtIds))return{error:MISSING_VALUE,info:mustBeAnArray("courtIds")};for(const tournamentRecord of Object.values(tournamentRecords))disableCourts$1({tournamentRecord,courtIds,dates});return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$32.call(b,prop)&&__defNormalProp$31(a,prop,b[prop]);if(__getOwnPropSymbols$32)for(var prop of __getOwnPropSymbols$32(b))__propIsEnum$32.call(b,prop)&&__defNormalProp$31(a,prop,b[prop]);return a})({},SUCCESS)},disableVenues:function disableVenues({tournamentRecords,venueIds}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!Array.isArray(venueIds))return{error:MISSING_VALUE,info:mustBeAnArray("venueIds")};for(const tournamentRecord of Object.values(tournamentRecords))disableVenues$1({tournamentRecord,venueIds});return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$30.call(b,prop)&&__defNormalProp$2$(a,prop,b[prop]);if(__getOwnPropSymbols$30)for(var prop of __getOwnPropSymbols$30(b))__propIsEnum$30.call(b,prop)&&__defNormalProp$2$(a,prop,b[prop]);return a})({},SUCCESS)},enableCourts:function enableCourts({tournamentRecords,enableAll,courtIds,dates}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!enableAll&&!Array.isArray(courtIds))return{error:MISSING_VALUE,info:mustBeAnArray("courtIds")};for(const tournamentRecord of Object.values(tournamentRecords))enableCourts$1({tournamentRecord,courtIds,enableAll,dates});return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2_.call(b,prop)&&__defNormalProp$2Z(a,prop,b[prop]);if(__getOwnPropSymbols$2_)for(var prop of __getOwnPropSymbols$2_(b))__propIsEnum$2_.call(b,prop)&&__defNormalProp$2Z(a,prop,b[prop]);return a})({},SUCCESS)},enableVenues:function enableVenues({tournamentRecords,venueIds,enableAll}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!enableAll&&!Array.isArray(venueIds))return{error:MISSING_VALUE,info:mustBeAnArray("venueIds")};for(const tournamentRecord of Object.values(tournamentRecords))enableVenues$1({tournamentRecord,venueIds,enableAll});return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2Y.call(b,prop)&&__defNormalProp$2X(a,prop,b[prop]);if(__getOwnPropSymbols$2Y)for(var prop of __getOwnPropSymbols$2Y(b))__propIsEnum$2Y.call(b,prop)&&__defNormalProp$2X(a,prop,b[prop]);return a})({},SUCCESS)},deleteCourt:function deleteCourt({tournamentRecords,courtId,force}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if("string"!=typeof courtId)return{error:MISSING_COURT_ID};let courtDeleted,result;for(const tournamentRecord of Object.values(tournamentRecords)){if(result=deleteCourt$1({tournamentRecord,courtId,force}),result.error&&result.error!==COURT_NOT_FOUND)return result;result.success&&(courtDeleted=!0)}return courtDeleted?((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2U.call(b,prop)&&__defNormalProp$2T(a,prop,b[prop]);if(__getOwnPropSymbols$2U)for(var prop of __getOwnPropSymbols$2U(b))__propIsEnum$2U.call(b,prop)&&__defNormalProp$2T(a,prop,b[prop]);return a})({},SUCCESS):result},deleteVenue:function deleteVenue({tournamentRecords,venueId,force}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if("string"!=typeof venueId)return{error:MISSING_VENUE_ID};let deleted;for(const tournamentRecord of Object.values(tournamentRecords)){const result=deleteVenue$1({tournamentRecord,venueId,force});if(result.error&&result.error!==VENUE_NOT_FOUND)return result;result.success&&(deleted=!0)}return checkSchedulingProfile$1({tournamentRecords}),deleted?SUCCESS:{error:VENUE_NOT_FOUND}},modifyCourt:function modifyCourt({tournamentRecords,modifications,disableNotice,courtId,force}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if(!courtId)return{error:MISSING_VALUE,info:"missing courtId"};let courtModified,error;for(const tournamentRecord of Object.values(tournamentRecords)){const result=modifyCourt$1({tournamentRecord,modifications,disableNotice,courtId,force});(null==result?void 0:result.error)&&(error=result),courtModified=!0}return courtModified?((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2R.call(b,prop)&&__defNormalProp$2Q(a,prop,b[prop]);if(__getOwnPropSymbols$2R)for(var prop of __getOwnPropSymbols$2R(b))__propIsEnum$2R.call(b,prop)&&__defNormalProp$2Q(a,prop,b[prop]);return a})({},SUCCESS):error},modifyVenue:function modifyVenue({tournamentRecords,modifications,venueId,force}){if(!tournamentRecords)return{error:MISSING_TOURNAMENT_RECORDS};if("string"!=typeof venueId)return{error:MISSING_VENUE_ID};let error,success;for(const tournamentRecord of Object.values(tournamentRecords)){const result=modifyVenue$1({tournamentRecord,modifications,venueId,force});if(result.success&&(success=!0),result.error&&(error=result.error),result.error&&result.error!==VENUE_NOT_FOUND)return result}return checkSchedulingProfile$1({tournamentRecords}),success?((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2O.call(b,prop)&&__defNormalProp$2N(a,prop,b[prop]);if(__getOwnPropSymbols$2O)for(var prop of __getOwnPropSymbols$2O(b))__propIsEnum$2O.call(b,prop)&&__defNormalProp$2N(a,prop,b[prop]);return a})({},SUCCESS):{error}},addCourts:function addCourts(params){const{tournamentRecords,venueId}=params;if("string"!=typeof venueId||!venueId)return{error:MISSING_VENUE_ID};let success;for(const tournamentRecord of Object.values(tournamentRecords)){const{venue}=findVenue({tournamentRecord,venueId});if(venue){const result=addCourts$1(__spreadValues$2M({tournamentRecord},params));if(result.error)return result;success=!0}}return success?SUCCESS:{error:VENUE_NOT_FOUND}},addVenue:function addVenue({tournamentRecords,disableNotice,venue,context}){if("object"!=typeof venue)return{error:INVALID_VALUES};let addedVenue;venue.venueId||(venue.venueId=UUID());for(const tournamentRecord of Object.values(tournamentRecords)){const result=addVenue$1({disableNotice:!0,tournamentRecord,context,venue});if(null==result?void 0:result.error)return result;addedVenue=result.venue}return disableNotice||addNotice({topic:ADD_VENUE,payload:{venue}}),definedAttributes((a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2M.call(b,prop)&&__defNormalProp$2L(a,prop,b[prop]);if(__getOwnPropSymbols$2M)for(var prop of __getOwnPropSymbols$2M(b))__propIsEnum$2M.call(b,prop)&&__defNormalProp$2L(a,prop,b[prop]);return a})({},SUCCESS),__defProps$1A(a,__getOwnPropDescs$1A({venue:addedVenue}))));var a}};function getState$3({convertExtensions,removeExtensions}){const tournamentRecords=getTournamentRecords();return{tournamentId:getTournamentId(),tournamentRecords:makeDeepCopy(tournamentRecords,convertExtensions,!1,removeExtensions)}}function removeUnlinkedTournamentRecords(){var _a;const tournamentRecords=getTournamentRecords(),{extension}=findExtension({name:LINKED_TOURNAMENTS,tournamentRecords}),tournamentIds=(null==(_a=null==extension?void 0:extension.value)?void 0:_a.tournamentIds)||[];return Object.keys(tournamentRecords).forEach((tournamentId=>{tournamentIds.includes(tournamentId)||delete tournamentRecords[tournamentId]})),setTournamentRecords(tournamentRecords)}function setTournamentRecord(record,deepCopyOption=!0){return"object"!=typeof record||Array.isArray(record)?{error:INVALID_OBJECT}:(null==record?void 0:record.tournamentId)?setTournamentRecord$1(deepCopyOption?makeDeepCopy(record):record):{error:INVALID_VALUES}}function setState$4(records,deepCopyOption=!0){if("object"!=typeof records)return{error:INVALID_OBJECT};if(Array.isArray(records)){if(!(records.filter((record=>null==record?void 0:record.tournamentId)).length===records.length))return{error:INVALID_RECORDS};records=Object.assign({},...records.map((record=>({[record.tournamentId]:record}))))}else if(null==records?void 0:records.tournamentId)records={[records.tournamentId]:records};else{if(!Object.keys(records).every((tournamentId=>records[tournamentId].tournamentId===tournamentId)))return{error:INVALID_RECORDS}}return setTournamentRecords(deepCopyOption?makeDeepCopy(records):records)}var __defProp$2K=Object.defineProperty,__defProps$1z=Object.defineProperties,__getOwnPropDescs$1z=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2L=Object.getOwnPropertySymbols,__hasOwnProp$2L=Object.prototype.hasOwnProperty,__propIsEnum$2L=Object.prototype.propertyIsEnumerable,__defNormalProp$2K=(obj,key,value)=>key in obj?__defProp$2K(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2K=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2L.call(b,prop)&&__defNormalProp$2K(a,prop,b[prop]);if(__getOwnPropSymbols$2L)for(var prop of __getOwnPropSymbols$2L(b))__propIsEnum$2L.call(b,prop)&&__defNormalProp$2K(a,prop,b[prop]);return a},__spreadProps$1z=(a,b)=>__defProps$1z(a,__getOwnPropDescs$1z(b));!function(){const engine={getState:({convertExtensions,removeExtensions}={})=>getState$3({convertExtensions,removeExtensions}),version:()=>"1.0.3",reset:()=>(setTournamentRecords({}),processResult())};return function importGovernors(governors){governors.forEach((governor=>{Object.keys(governor).forEach((methodName=>{engine[methodName]=params=>{if(getDevContext())return engineInvoke(governor[methodName],params,methodName);try{return engineInvoke(governor[methodName],params,methodName)}catch(err){const activeTournamentId=getTournamentId(),error=err.toString();console.log("ERROR",{params:JSON.stringify(params),activeTournamentId,methodName,error})}}}))}))}([competitionGovernor,policyGovernor$2,queryGovernor$3,publishingGovernor$1,scheduleGovernor$1,venueGovernor]),engine.devContext=contextCriteria=>(setDevContext(contextCriteria),processResult()),engine.getDevContext=contextCriteria=>getDevContext(contextCriteria),engine.setState=(records,deepCopyOption,deepCopyAttributes)=>{setDeepCopy(deepCopyOption,deepCopyAttributes);return processResult(setState$4(records,deepCopyOption))},engine.setTournamentRecord=(tournamentRecord,deepCopyOption,deepCopyAttributes)=>{setDeepCopy(deepCopyOption,deepCopyAttributes);return processResult(setTournamentRecord(tournamentRecord,deepCopyOption))},engine.removeTournamentRecord=tournamentId=>processResult(removeTournamentRecord(tournamentId)),engine.removeUnlinkedTournamentRecords=()=>processResult(removeUnlinkedTournamentRecords()),engine.executionQueue=(directives,rollbackOnError)=>function executionQueue(directives,rollbackOnError){var _a;if(!Array.isArray(directives))return{error:INVALID_VALUES};const tournamentRecords=getTournamentRecords(),activeTournamentId=getTournamentId(),snapshot=rollbackOnError&&makeDeepCopy(tournamentRecords,!1,!0);let timeStamp;const results=[];for(const directive of directives){if("object"!=typeof directive)return{error:INVALID_VALUES};const{method:methodName,params}=directive;if(!engine[methodName]){const result3={error:METHOD_NOT_FOUND,methodName},devContext=getDevContext();return(devContext.result&&!Array.isArray(devContext.result)||Array.isArray(devContext.result)&&(null==(_a=devContext.result)?void 0:_a.includes(methodName)))&&console.log("ce:",result3),result3}const result2=executeFunction(tournamentRecords,engine[methodName],__spreadValues$2K({activeTournamentId},params),methodName);if(null==result2?void 0:result2.error)return snapshot&&setState$4(snapshot),__spreadProps$1z(__spreadValues$2K({},result2),{rolledBack:!!snapshot});results.push(result2),timeStamp=Date.now()}const mutationStatus=cycleMutationStatus();mutationStatus&&Object.values(tournamentRecords).forEach((tournamentRecord=>{updateFactoryExtension({tournamentRecord,value:{version:"1.0.3",timeStamp}})}));notifySubscribers({directives,mutationStatus,timeStamp}),deleteNotices();return{success:results.every((r=>r.success)),results}}(directives,rollbackOnError),engine;function processResult(result){return(null==result?void 0:result.error)?(engine.error=result.error,engine.success=!1):(engine.error=void 0,engine.success=!0),engine}function executeFunction(tournamentRecords,method,params,methodName){var _a,_b;delete engine.success,delete engine.error;const start=Date.now(),result=method(__spreadValues$2K({tournamentRecords},params)),elapsed=Date.now()-start,devContext=getDevContext(),log={method:methodName},logErrors="object"==typeof devContext.result&&devContext.result.error;return![void 0,!1].includes(devContext.perf)&&(isNaN(devContext.perf)||elapsed>devContext.perf)&&(log.elapsed=elapsed),(logErrors||devContext.params&&!Array.isArray(devContext.params)||Array.isArray(devContext.params)&&(null==(_a=devContext.params)?void 0:_a.includes(methodName)))&&(log.params=params),(logErrors||!logErrors&&devContext.result&&!Array.isArray(devContext.result)||Array.isArray(devContext.result)&&(null==(_b=devContext.result)?void 0:_b.includes(methodName)))&&(log.result=result),Object.keys(log).length>1&&console.log("ce:",log),result}function engineInvoke(method,params,methodName){const tournamentRecords=getTournamentRecords(),activeTournamentId=getTournamentId(),snapshot=(null==params?void 0:params.rollbackOnError)&&makeDeepCopy(tournamentRecords,!1,!0),result=executeFunction(tournamentRecords,method,__spreadValues$2K({activeTournamentId},params),methodName);(null==result?void 0:result.error)&&snapshot&&setState$4(snapshot);const notify=(null==result?void 0:result.success)&&!0!==(null==params?void 0:params.delayNotify)&&!0!==(null==params?void 0:params.doNotNotify),mutationStatus=cycleMutationStatus(),timeStamp=Date.now();return mutationStatus&&(Object.values(tournamentRecords).forEach((tournamentRecord=>{updateFactoryExtension({tournamentRecord,value:{version:"1.0.3",timeStamp}})})),result.modificationsApplied=!0),notify&&notifySubscribers({directives:[{method,params}],mutationStatus,timeStamp}),(notify||!(null==result?void 0:result.success)||(null==params?void 0:params.doNotNotify))&&deleteNotices(),result}}();Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;var __defProp$2I=Object.defineProperty,__getOwnPropSymbols$2J=Object.getOwnPropertySymbols,__hasOwnProp$2J=Object.prototype.hasOwnProperty,__propIsEnum$2J=Object.prototype.propertyIsEnumerable,__defNormalProp$2I=(obj,key,value)=>key in obj?__defProp$2I(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2I=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2J.call(b,prop)&&__defNormalProp$2I(a,prop,b[prop]);if(__getOwnPropSymbols$2J)for(var prop of __getOwnPropSymbols$2J(b))__propIsEnum$2J.call(b,prop)&&__defNormalProp$2I(a,prop,b[prop]);return a};function addVoluntaryConsolationStructure$1({structureName=VOLUNTARY_CONSOLATION,structureAbbreviation,drawDefinition,matchUpType,structureId}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const structure=structureTemplate({stage:VOLUNTARY_CONSOLATION,structureAbbreviation,structureName,matchUps:[],structureId,matchUpType});return drawDefinition.structures.push(structure),modifyDrawNotice({drawDefinition,structureIds:[structureId]}),__spreadValues$2I({},SUCCESS)}function generateQualifyingLink({targetEntryRound=1,finishingPositions,sourceRoundNumber,sourceStructureId,targetStructureId,linkType=WINNER}){if(!sourceStructureId||!targetStructureId)return{error:MISSING_STRUCTURE_ID};return{link:definedAttributes({linkType,source:{roundNumber:sourceRoundNumber,structureId:sourceStructureId,finishingPositions},target:{feedProfile:DRAW,roundNumber:targetEntryRound,structureId:targetStructureId}})}}var __defProp$2H=Object.defineProperty,__defProps$1x=Object.defineProperties,__getOwnPropDescs$1x=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2I=Object.getOwnPropertySymbols,__hasOwnProp$2I=Object.prototype.hasOwnProperty,__propIsEnum$2I=Object.prototype.propertyIsEnumerable,__defNormalProp$2H=(obj,key,value)=>key in obj?__defProp$2H(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2H=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2I.call(b,prop)&&__defNormalProp$2H(a,prop,b[prop]);if(__getOwnPropSymbols$2I)for(var prop of __getOwnPropSymbols$2I(b))__propIsEnum$2I.call(b,prop)&&__defNormalProp$2H(a,prop,b[prop]);return a},__spreadProps$1x=(a,b)=>__defProps$1x(a,__getOwnPropDescs$1x(b));function generateQualifyingStructures({qualifyingProfiles,appliedPolicies,idPrefix,isMock,uuids}){var _a;const qualifyingDetails=[],structures=[],links=[],sequenceSort=(a,b)=>a.stageSequence-b.stageSequence,roundTargetSort=(a,b)=>a.roundTarget-b.roundTarget;let finishingPositions,qualifyingDrawPositionsCount=0,totalQualifiersCount=0,roundTarget=1;for(const roundTargetProfile of qualifyingProfiles.sort(roundTargetSort)){const structureProfiles=roundTargetProfile.structureProfiles||[];roundTarget=roundTargetProfile.roundTarget||roundTarget;let finalQualifyingRoundNumber,finalQualifyingStructureId,linkType,stageSequence=1,targetRoundQualifiersCount=0;for(const structureProfile of(structureProfiles||[]).sort(sequenceSort)){let drawSize=structureProfile.drawSize||coerceEven(structureProfile.participantsCount);const{qualifyingRoundNumber,qualifyingPositions,structureOptions,matchUpFormat,structureName,matchUpType,structureId,drawType}=structureProfile;let roundLimit,structure,matchUps;if(!isConvertableInteger(drawSize))return decorateResult({result:{error:MISSING_DRAW_SIZE},stack:"generateQualifyingSTructures"});const roundTargetName=qualifyingProfiles.length>1?`${roundTarget}-`:"",stageSequenceName=structureProfiles.length>1||roundTargetName?stageSequence:"",qualifyingStructureName=structureName||(roundTargetName||stageSequenceName?`${QUALIFYING} ${roundTargetName}${stageSequenceName}`:QUALIFYING);if(drawType===ROUND_ROBIN){const{structures:structures2,groupCount,maxRoundNumber}=generateRoundRobin({structureName:structureProfile.structureName||qualifyingStructureName,structureId:structureId||(null==uuids?void 0:uuids.pop()),qualifyingPositions,stage:QUALIFYING,structureOptions,appliedPolicies,stageSequence,matchUpType,roundTarget,idPrefix,drawSize,isMock,uuids});targetRoundQualifiersCount=groupCount,roundLimit=maxRoundNumber,structure=structures2[0],finishingPositions=[1]}else({drawSize,matchUps,roundLimit}=treeMatchUps({qualifyingRoundNumber,qualifyingPositions,matchUpType,idPrefix,drawSize,isMock,uuids})),structure=structureTemplate({structureName:structureProfile.structureName||qualifyingStructureName,structureId:structureId||(null==uuids?void 0:uuids.pop()),qualifyingRoundNumber:roundLimit,stage:QUALIFYING,matchUpFormat,stageSequence,matchUpType,roundLimit,matchUps}),roundTarget&&addExtension$1({element:structure,extension:{name:ROUND_TARGET,value:roundTarget}}),targetRoundQualifiersCount=null==(_a=null==matchUps?void 0:matchUps.filter((matchUp=>matchUp.roundNumber===roundLimit)))?void 0:_a.length;if(stageSequence>1){const{link}=generateQualifyingLink({sourceStructureId:finalQualifyingStructureId,sourceRoundNumber:finalQualifyingRoundNumber,targetStructureId:structure.structureId,finishingPositions:linkType===POSITION?[1]:void 0,linkType});links.push(link),qualifyingDrawPositionsCount+=drawSize-targetRoundQualifiersCount}else qualifyingDrawPositionsCount+=drawSize;linkType=drawType===ROUND_ROBIN?POSITION:WINNER,finalQualifyingStructureId=structure.structureId,finalQualifyingRoundNumber=roundLimit,structures.push(structure),stageSequence+=1}totalQualifiersCount+=targetRoundQualifiersCount,qualifyingDetails.push({qualifiersCount:targetRoundQualifiersCount,finalQualifyingRoundNumber,finalQualifyingStructureId,finishingPositions,roundTarget,linkType}),targetRoundQualifiersCount=0,roundTarget+=1}return __spreadProps$1x(__spreadValues$2H({qualifiersCount:totalQualifiersCount,qualifyingDrawPositionsCount,qualifyingDetails,structures},SUCCESS),{links})}var __defProp$2G=Object.defineProperty,__defProps$1w=Object.defineProperties,__getOwnPropDescs$1w=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2H=Object.getOwnPropertySymbols,__hasOwnProp$2H=Object.prototype.hasOwnProperty,__propIsEnum$2H=Object.prototype.propertyIsEnumerable,__defNormalProp$2G=(obj,key,value)=>key in obj?__defProp$2G(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2G=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2H.call(b,prop)&&__defNormalProp$2G(a,prop,b[prop]);if(__getOwnPropSymbols$2H)for(var prop of __getOwnPropSymbols$2H(b))__propIsEnum$2H.call(b,prop)&&__defNormalProp$2G(a,prop,b[prop]);return a},__spreadProps$1w=(a,b)=>__defProps$1w(a,__getOwnPropDescs$1w(b));var __defProp$2F=Object.defineProperty,__getOwnPropSymbols$2G=Object.getOwnPropertySymbols,__hasOwnProp$2G=Object.prototype.hasOwnProperty,__propIsEnum$2G=Object.prototype.propertyIsEnumerable,__defNormalProp$2F=(obj,key,value)=>key in obj?__defProp$2F(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2F=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2G.call(b,prop)&&__defNormalProp$2F(a,prop,b[prop]);if(__getOwnPropSymbols$2G)for(var prop of __getOwnPropSymbols$2G(b))__propIsEnum$2G.call(b,prop)&&__defNormalProp$2F(a,prop,b[prop]);return a};function generateDoubleElimination({structureName,matchUpType,idPrefix,drawSize,isMock,uuids}){const structures=[],{matchUps}=feedInMatchUps({linkFedFinishingRoundNumbers:[1],drawSize:drawSize+1,matchUpType,idPrefix,isMock}),mainStructure=structureTemplate({structureName:structureName||MAIN,structureId:null==uuids?void 0:uuids.pop(),stageSequence:1,stage:MAIN,matchUpType,matchUps});structures.push(mainStructure);const consolationDrawPositions=drawSize/2,{matchUps:consolationMatchUps}=feedInMatchUps({finishingPositionOffset:consolationDrawPositions,idPrefix:idPrefix&&`${idPrefix}-c`,drawSize:drawSize-1,isConsolation:!0,matchUpType,isMock,uuids}),consolationStructure=structureTemplate({matchUps:consolationMatchUps,structureId:null==uuids?void 0:uuids.pop(),structureName:BACKDRAW,stage:CONSOLATION,stageSequence:2,matchUpType});structures.push(consolationStructure);const{matchUps:deciderMatchUps}=treeMatchUps({idPrefix:idPrefix&&`${idPrefix}-p1t2`,drawSize:2,matchUpType,isMock}),deciderStructure=structureTemplate({matchUps:deciderMatchUps,structureId:null==uuids?void 0:uuids.pop(),structureName:DECIDER,stageSequence:3,stage:PLAY_OFF,matchUpType});structures.push(deciderStructure);const links=function doubleEliminationLinks({mainStructure,consolationStructure,deciderStructure}){const roundsFed=consolationStructure.matchUps.reduce(((rf,matchUp)=>(matchUp.drawPositions||[]).filter(Boolean).length&&!rf.includes(matchUp.roundNumber)?rf.concat(matchUp.roundNumber):rf),[]),mainFinalRound=mainStructure.matchUps.reduce(((finalRound,matchUp)=>!finalRound||matchUp.roundNumber>finalRound?matchUp.roundNumber:finalRound),void 0),consolationFinalRound=consolationStructure.matchUps.reduce(((finalRound,matchUp)=>!finalRound||matchUp.roundNumber>finalRound?matchUp.roundNumber:finalRound),void 0);return[...roundsFed.map(((roundNumber,i)=>{const feedProfile=roundsFed.indexOf(roundNumber)%2?TOP_DOWN:BOTTOM_UP;return{linkType:LOSER,source:{roundNumber:1+i,structureId:mainStructure.structureId},target:{feedProfile,roundNumber,structureId:consolationStructure.structureId}}})),{linkType:WINNER,source:{roundNumber:consolationFinalRound,structureId:consolationStructure.structureId},target:{feedProfile:TOP_DOWN,roundNumber:mainFinalRound,structureId:mainStructure.structureId}},{linkType:WINNER,source:{roundNumber:mainFinalRound,structureId:mainStructure.structureId},target:{feedProfile:TOP_DOWN,roundNumber:1,structureId:deciderStructure.structureId}},{linkType:LOSER,source:{roundNumber:mainFinalRound,structureId:mainStructure.structureId},target:{feedProfile:TOP_DOWN,roundNumber:1,structureId:deciderStructure.structureId}}]}({mainStructure,consolationStructure,deciderStructure});return __spreadValues$2F({structures,links},SUCCESS)}var __defProp$2E=Object.defineProperty,__getOwnPropSymbols$2F=Object.getOwnPropertySymbols,__hasOwnProp$2F=Object.prototype.hasOwnProperty,__propIsEnum$2F=Object.prototype.propertyIsEnumerable,__defNormalProp$2E=(obj,key,value)=>key in obj?__defProp$2E(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2E=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2F.call(b,prop)&&__defNormalProp$2E(a,prop,b[prop]);if(__getOwnPropSymbols$2F)for(var prop of __getOwnPropSymbols$2F(b))__propIsEnum$2F.call(b,prop)&&__defNormalProp$2E(a,prop,b[prop]);return a};function generateCurtisConsolation({finishingPositionOffset,structureName=MAIN,stageSequence=1,staggeredEntry,matchUpType,structureId,idPrefix,drawSize,isMock,uuids}){const mainParams={finishingPositionOffset,matchUpType,drawSize,idPrefix,isMock,uuids},{matchUps,roundsCount:mainDrawRoundsCount}=staggeredEntry?feedInMatchUps(mainParams):treeMatchUps(mainParams),mainStructure=structureTemplate({structureId:structureId||(null==uuids?void 0:uuids.pop()),matchUps,matchUpType,stage:MAIN,structureName,stageSequence}),structures=[mainStructure],links=[];if(drawSize>2){const consolationItems=[0,2].slice(0,drawSize/16).map(((roundOffset,index)=>{const stageSequence2=index+1,{consolationStructure}=function consolationFeedStructure({stageSequence=1,roundOffset=0,matchUpType,structureId,idPrefix,drawSize,isMock,index,uuids}){const consolationDrawPositions=drawSize/(2*Math.pow(2,roundOffset)),{matchUps:consolationMatchUps,roundsCount:consolationRoundsCount}=feedInMatchUps({finishingPositionOffset:consolationDrawPositions,baseDrawSize:consolationDrawPositions,isConsolation:!0,feedRounds:1,matchUpType,idPrefix,isMock,uuids}),structureName=`${CONSOLATION} ${index+1}`,consolationStructure=structureTemplate({matchUps:consolationMatchUps,stage:CONSOLATION,structureName,stageSequence,matchUpType,structureId});return{consolationStructure,consolationRoundsCount}}({structureId:null==uuids?void 0:uuids.pop(),idPrefix:idPrefix&&`${idPrefix}-c${index}`,stageSequence:stageSequence2,roundOffset,matchUpType,drawSize,isMock,index,uuids});structures.push(consolationStructure);return{consolationStructure,links:feedInLinks({mainStructure,consolationStructure,roundsCount:2,roundOffset})}})),consolationLinks=consolationItems.map((item=>item.links)).flat();if(links.push(...consolationLinks),drawSize>=4&&drawSize<=16||drawSize>32){const{matchUps:playoffMatchUps}=treeMatchUps({finishingPositionOffset:2,idPrefix:idPrefix&&`${idPrefix}-p3t4`,drawSize:2,matchUpType,isMock}),playoffStructure=structureTemplate({structureId:null==uuids?void 0:uuids.pop(),matchUps:playoffMatchUps,structureName:PLAY_OFF,stageSequence:2,stage:PLAY_OFF,matchUpType}),playoffLink={linkType:LOSER,source:{roundNumber:mainDrawRoundsCount-1,structureId:mainStructure.structureId},target:{roundNumber:1,feedProfile:TOP_DOWN,structureId:playoffStructure.structureId}};structures.push(playoffStructure),links.push(playoffLink)}}return __spreadValues$2E({structures,links},SUCCESS)}function luckyDraw(params){const{qualifyingRoundNumber,finishingPositionOffset,qualifyingPositions,matchUpType,idPrefix,drawSize,isMock,uuids}=params;if(!isConvertableInteger(drawSize)||drawSize<2)return{matchUps:[],roundsCount:0};if(isPowerOf2(drawSize))return treeMatchUps(params);const roundProfiles=function luckyRoundProfiles(drawSize){const intDrawSize=parseInt(drawSize);let participantsCount=intDrawSize%2?intDrawSize+1:intDrawSize;const preFeedRound=!!(Math.ceil(participantsCount/2)%2),rounds=[{participantsCount,preFeedRound}];for(;participantsCount>2;){const nextRound=Math.ceil(participantsCount/2),nextIsFinal=1===nextRound,feedRound=!(nextIsFinal||!(nextRound%2));participantsCount=!nextIsFinal&&feedRound?nextRound+1:nextRound;const preFeedRound2=!!(2!==participantsCount&&Math.ceil(participantsCount/2)%2);rounds.push({participantsCount,preFeedRound:preFeedRound2,feedRound})}return rounds}(drawSize),nodes=generateRange(1,roundProfiles.shift().participantsCount+1).map((drawPosition=>({drawPosition})));let matchUps=[],roundNumber=1;({matchUps}=buildRound({roundNumber,matchUpType,idPrefix,matchUps,isMock,nodes,uuids})),roundNumber++;let roundLimit=params.roundLimit||qualifyingRoundNumber;for(const roundProfile of roundProfiles){const roundMatchUpsCount=roundProfile.participantsCount/2,roundPositionRange=generateRange(1,roundMatchUpsCount+1);qualifyingPositions&&roundMatchUpsCount===qualifyingPositions&&(roundLimit=roundNumber-1);const roundMatchUps=roundPositionRange.map((roundPosition=>{const matchUpId=generateMatchUpId({roundPosition,roundNumber,idPrefix,uuids});return{roundPosition,roundNumber,matchUpId}}));matchUps.push(...roundMatchUps),roundNumber++}const roundsCount=roundNumber-1;return matchUps=addFinishingRounds({finishingPositionOffset,lucky:!0,roundsCount,roundLimit,matchUps}),roundLimit&&(matchUps=matchUps.filter((matchUp=>matchUp.roundNumber<=roundLimit))),{matchUps,roundsCount,roundLimit}}var __defProp$2D=Object.defineProperty,__defProps$1v=Object.defineProperties,__getOwnPropDescs$1v=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2E=Object.getOwnPropertySymbols,__hasOwnProp$2E=Object.prototype.hasOwnProperty,__propIsEnum$2E=Object.prototype.propertyIsEnumerable,__defNormalProp$2D=(obj,key,value)=>key in obj?__defProp$2D(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2D=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2E.call(b,prop)&&__defNormalProp$2D(a,prop,b[prop]);if(__getOwnPropSymbols$2E)for(var prop of __getOwnPropSymbols$2E(b))__propIsEnum$2E.call(b,prop)&&__defNormalProp$2D(a,prop,b[prop]);return a},__spreadProps$1v=(a,b)=>__defProps$1v(a,__getOwnPropDescs$1v(b));function getGenerators(params){var _a;const{compassAttributes=COMPASS_ATTRIBUTES,olympicAttributes=OLYMPIC_ATTRIBUTES,stageSequence=1,structureName,structureId,stage=MAIN,matchUpType,drawSize,uuids}=params,{appliedPolicies}=getAppliedPolicies(params),feedPolicy=(null==(_a=params.policyDefinitions)?void 0:_a[POLICY_TYPE_FEED_IN])||appliedPolicies[POLICY_TYPE_FEED_IN];params.skipRounds=params.skipRounds||drawSize<=4&&((null==feedPolicy?void 0:feedPolicy.feedMainFinal)?0:1)||0;const generators={[AD_HOC]:()=>{const structure=structureTemplate({structureName:structureName||MAIN,structureId:structureId||(null==uuids?void 0:uuids.pop()),finishingPosition:WIN_RATIO,stageSequence,matchUps:[],matchUpType,stage});return __spreadValues$2D({structures:[structure],links:[]},SUCCESS)},[LUCKY_DRAW]:()=>{const{matchUps}=luckyDraw(params),structure=structureTemplate({structureName:structureName||MAIN,structureId:structureId||(null==uuids?void 0:uuids.pop()),stageSequence,matchUpType,matchUps,stage});return __spreadValues$2D({structures:[structure],links:[]},SUCCESS)},[SINGLE_ELIMINATION]:()=>(()=>{const{matchUps}=treeMatchUps(params),structure=structureTemplate({structureName:structureName||MAIN,structureId:structureId||(null==uuids?void 0:uuids.pop()),stageSequence,matchUpType,matchUps,stage});return __spreadValues$2D({structures:[structure],links:[]},SUCCESS)})(),[DOUBLE_ELIMINATION]:()=>generateDoubleElimination(params),[COMPASS]:()=>generatePlayoffStructures(__spreadProps$1v(__spreadValues$2D({},params),{roundOffsetLimit:3,playoffAttributes:compassAttributes})),[OLYMPIC]:()=>generatePlayoffStructures(__spreadProps$1v(__spreadValues$2D({},params),{roundOffsetLimit:2,playoffAttributes:olympicAttributes})),[PLAY_OFF]:()=>generatePlayoffStructures(params),[FEED_IN$1]:()=>{const{matchUps}=feedInMatchUps({drawSize,uuids,matchUpType}),structure=structureTemplate({structureName:structureName||MAIN,structureId:structureId||(null==uuids?void 0:uuids.pop()),stageSequence,matchUpType,stage:MAIN,matchUps});return __spreadValues$2D({structures:[structure],links:[]},SUCCESS)},[FIRST_ROUND_LOSER_CONSOLATION]:()=>function firstRoundLoserConsolation(params){const{finishingPositionOffset=0,stageSequence=1,staggeredEntry,structureName,stage=MAIN,matchUpType,structureId,idPrefix,drawSize,isMock,uuids}=params,mainParams={finishingPositionOffset,matchUpType,drawSize,idPrefix,isMock,uuids},{matchUps}=staggeredEntry?feedInMatchUps(mainParams):treeMatchUps(mainParams),mainStructure=structureTemplate({structureId:structureId||(null==uuids?void 0:uuids.pop()),structureName:structureName||MAIN,stageSequence,matchUpType,matchUps,stage}),structures=[mainStructure],links=[];if(drawSize>2){const consolationDrawPositions=drawSize/2,{matchUps:consolationMatchUps}=treeMatchUps({finishingPositionOffset:finishingPositionOffset+consolationDrawPositions,idPrefix:idPrefix&&`${idPrefix}-c`,drawSize:consolationDrawPositions,matchUpType,isMock}),consolationStructureName=params.consolationStructureName||(structureName?`${structureName} ${CONSOLATION}`:CONSOLATION),consolationStructure=structureTemplate({structureName:consolationStructureName,matchUps:consolationMatchUps,structureId:null==uuids?void 0:uuids.pop(),stage:CONSOLATION,stageSequence:1,matchUpType});structures.push(consolationStructure);const link={linkType:LOSER,source:{roundNumber:1,structureId:mainStructure.structureId},target:{roundNumber:1,feedProfile:TOP_DOWN,structureId:consolationStructure.structureId}};links.push(link)}return __spreadProps$1w(__spreadValues$2G({},SUCCESS),{structures,links})}(params),[FIRST_MATCH_LOSER_CONSOLATION]:()=>feedInChampionship(__spreadProps$1v(__spreadValues$2D({},params),{feedRounds:1,fmlc:!0})),[MFIC]:()=>feedInChampionship(__spreadProps$1v(__spreadValues$2D({},params),{feedRounds:1})),[FICSF]:()=>feedInChampionship(__spreadProps$1v(__spreadValues$2D({},params),{feedsFromFinal:1})),[FICQF]:()=>feedInChampionship(__spreadProps$1v(__spreadValues$2D({},params),{feedsFromFinal:2})),[FICR16]:()=>feedInChampionship(__spreadProps$1v(__spreadValues$2D({},params),{feedsFromFinal:3})),[FEED_IN_CHAMPIONSHIP]:()=>feedInChampionship(params),[CURTIS]:()=>generateCurtisConsolation(params),[ROUND_ROBIN]:()=>generateRoundRobin(params),[ROUND_ROBIN_WITH_PLAYOFF]:()=>function generateRoundRobinWithPlayOff(params){const{structureOptions}=params,mainDrawProperties=Object.assign({structureName:MAIN},params,{stage:MAIN}),{structures,groupCount,groupSize}=generateRoundRobin(mainDrawProperties);groupCount<1&&console.log(INVALID_CONFIGURATION);const playoffGroups=structureOptions&&structureOptions.playoffGroups||[{finishingPositions:[1],structureName:PLAY_OFF}],[mainStructure]=structures,{structures:playoffStructures,links}=processPlayoffGroups(__spreadValues$40({sourceStructureId:mainStructure.structureId,playoffGroups,groupCount,groupSize},params));return structures.push(...playoffStructures),__spreadProps$2k(__spreadValues$40({},SUCCESS),{structures,links})}(params)};return{generators}}var __defProp$2C=Object.defineProperty,__defProps$1u=Object.defineProperties,__getOwnPropDescs$1u=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2D=Object.getOwnPropertySymbols,__hasOwnProp$2D=Object.prototype.hasOwnProperty,__propIsEnum$2D=Object.prototype.propertyIsEnumerable,__defNormalProp$2C=(obj,key,value)=>key in obj?__defProp$2C(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2C=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2D.call(b,prop)&&__defNormalProp$2C(a,prop,b[prop]);if(__getOwnPropSymbols$2D)for(var prop of __getOwnPropSymbols$2D(b))__propIsEnum$2D.call(b,prop)&&__defNormalProp$2C(a,prop,b[prop]);return a},__spreadProps$1u=(a,b)=>__defProps$1u(a,__getOwnPropDescs$1u(b));function generateDrawStructuresAndLinks$1(params={}){var _a,_b,_c,_d,_e;const{enforceMinimumDrawSize=!0,overwriteExisting,drawTypeCoercion,appliedPolicies,staggeredEntry,drawDefinition,drawSize,isMock,uuids}=params,stack="generateDrawStructuresAndLinks";let drawType=params.drawType||SINGLE_ELIMINATION;const structures=[],links=[];let{tieFormat,matchUpType}=params;matchUpType=matchUpType||SINGLES$1;const existingQualifyingStructures=null==(_a=null==drawDefinition?void 0:drawDefinition.structures)?void 0:_a.filter((({stage})=>stage===QUALIFYING));existingQualifyingStructures&&structures.push(...existingQualifyingStructures);const existingQualifyingStructureIds=null==existingQualifyingStructures?void 0:existingQualifyingStructures.map((({structureId})=>structureId)),existingMainStructure=null==(_b=null==drawDefinition?void 0:drawDefinition.structures)?void 0:_b.find((({stage,stageSequence})=>stage===MAIN&&1===stageSequence)),existingQualifyingLinks=null==(_c=null==drawDefinition?void 0:drawDefinition.links)?void 0:_c.filter((link=>link.target.structureId===(null==existingMainStructure?void 0:existingMainStructure.structureId)&&(null==existingQualifyingStructureIds?void 0:existingQualifyingStructureIds.includes(link.source.structureId)))),getQualifiersCount=(link,structure)=>{var _a2;if(link.linkType===POSITION&&(null==structure?void 0:structure.structures)){const finishingPositions=link.source.finishingPositions||[];return structure.structures.length*finishingPositions.length}if(link.linkType===WINNER&&(null==(_a2=null==structure?void 0:structure.matchUps)?void 0:_a2.length)){const qualifyingRoundNumber=link.source.roundNumber;return structure.matchUps.filter((({roundNumber})=>roundNumber===qualifyingRoundNumber)).length}},existingQualifyingDrawPositionsCount=null==existingQualifyingStructures?void 0:existingQualifyingStructures.map((structure=>{var _a2,_b2,_c2;const relevantLink=null==existingQualifyingLinks?void 0:existingQualifyingLinks.find((link=>link.target.structureId===structure.structureId)),drawPositionsCount=(null==(_b2=null==(_a2=getPositionAssignments$1({structure}))?void 0:_a2.positionAssignments)?void 0:_b2.length)||0;if(!relevantLink)return drawPositionsCount;const sourceStructureId=null==relevantLink?void 0:relevantLink.source.structureId,sourceStructure=null==(_c2=drawDefinition.structures)?void 0:_c2.find((structure2=>structure2.structureId===sourceStructureId));return drawPositionsCount-(getQualifiersCount(relevantLink,sourceStructure)||0)})).filter(Boolean).reduce(((a,b)=>a+b),0),existingQualifiersCount=null==existingQualifyingLinks?void 0:existingQualifyingLinks.map((link=>{const qualifyingStructureId=link.source.structureId,structure=null==existingQualifyingStructures?void 0:existingQualifyingStructures.find((structure2=>structure2.structureId===qualifyingStructureId));return getQualifiersCount(link,structure)})).filter(Boolean).reduce(((a,b)=>a+b),0),mainStructureIsPlaceholder=!(!existingMainStructure||(null==(_d=null==existingMainStructure?void 0:existingMainStructure.matchUps)?void 0:_d.length));if((null==existingQualifyingStructures?void 0:existingQualifyingStructures.length)&&!mainStructureIsPlaceholder)return{error:EXISTING_STAGE};const qualifyingProfiles=!(null==existingQualifyingStructures?void 0:existingQualifyingStructures.length)&&params.qualifyingProfiles,qualifyingResult=(null==qualifyingProfiles?void 0:qualifyingProfiles.length)&&generateQualifyingStructures({idPrefix:params.idPrefix,qualifyingProfiles,appliedPolicies,matchUpType,isMock,uuids});if(null==qualifyingResult?void 0:qualifyingResult.error)return qualifyingResult;const{qualifyingDrawPositionsCount,qualifyingDetails,qualifiersCount}=qualifyingResult||{qualifyingDrawPositionsCount:existingQualifyingDrawPositionsCount,qualifiersCount:existingQualifiersCount};qualifyingDrawPositionsCount&&((null==qualifyingResult?void 0:qualifyingResult.structures)&&structures.push(...qualifyingResult.structures),(null==qualifyingResult?void 0:qualifyingResult.links)&&links.push(...qualifyingResult.links)),Object.assign(params,definedAttributes({drawSize,matchUpType,tieFormat}));const invalidDrawSize=drawType!==AD_HOC&&(isNaN(drawSize)||drawSize<2||!staggeredEntry&&![FEED_IN$1,LUCKY_DRAW].includes(drawType)&&([ROUND_ROBIN_WITH_PLAYOFF,ROUND_ROBIN].includes(drawType)&&drawSize<3||![ROUND_ROBIN,ROUND_ROBIN_WITH_PLAYOFF].includes(drawType)&&!isPowerOf2(drawSize)));if(invalidDrawSize&&!qualifyingDrawPositionsCount)return decorateResult({context:{drawSize,invalidDrawSize},result:{error:INVALID_DRAW_SIZE},stack});const multiStructure=MULTI_STRUCTURE_DRAWS.includes(drawType);if(parseInt(drawSize)<4&&multiStructure)if(drawTypeCoercion)drawType=SINGLE_ELIMINATION;else if(enforceMinimumDrawSize)return decorateResult({context:{enforceMinimumDrawSize,invalidDrawSize,drawSize,drawType},result:{error:INVALID_DRAW_SIZE},stack});const{generators,error}=getGenerators(params);if(error)return{error};const generator=generators[drawType];if(!generator)return{error:UNRECOGNIZED_DRAW_TYPE};const generatorResult=null==generator?void 0:generator();if(generatorResult.error)return generatorResult;const{structures:generatedStructures,links:generatedLinks}=generatorResult;if(null==generatedStructures?void 0:generatedStructures.length){const generatedMainStructure=generatedStructures.find((({stage,stageSequence})=>stage===MAIN&&1===stageSequence));if(existingMainStructure&&generatedMainStructure)if(mainStructureIsPlaceholder){const generatedMainStructureId=generatedMainStructure.structureId;if(generatedMainStructure.structureId=existingMainStructure.structureId,null==generatedLinks?void 0:generatedLinks.length)for(const link of generatedLinks)link.source.structureId===generatedMainStructureId&&(link.source.structureId=existingMainStructure.structureId),link.target.structureId===generatedMainStructureId&&(link.target.structureId=existingMainStructure.structureId)}else if(!overwriteExisting)return{error:EXISTING_STAGE};structures.push(...generatedStructures)}structures.sort(structureSort),(null==generatedLinks?void 0:generatedLinks.length)&&links.push(...generatedLinks);const mainStructure=generatorResult.structures.find((({stage,stageSequence})=>stage===MAIN&&1===stageSequence));for(const qualifyingDetail of qualifyingDetails||[]){const{finalQualifyingRoundNumber:qualifyingRoundNumber,finalQualifyingStructureId:qualifyingStructureId,roundTarget:targetEntryRound,finishingPositions,linkType}=qualifyingDetail,link=mainStructure&&(null==(_e=generateQualifyingLink({targetStructureId:mainStructure.structureId,sourceStructureId:qualifyingStructureId,sourceRoundNumber:qualifyingRoundNumber,finishingPositions,targetEntryRound,linkType}))?void 0:_e.link);if(null==link?void 0:link.error)return link;link&&links.push(link)}return existingQualifyingLinks&&links.push(...existingQualifyingLinks),__spreadProps$1u(__spreadValues$2C({},SUCCESS),{qualifyingResult:{qualifyingDrawPositionsCount,qualifiersCount},structures,links})}function getQualifiersCount({provisionalPositioning,drawDefinition,stageSequence,structureId,stage}){var _a,_b,_c,_d,_e,_f,_g,_h;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const{entryProfile}=getEntryProfile({drawDefinition}),profileQualifiersCount=(null==(_c=null==(_b=null==(_a=null==entryProfile?void 0:entryProfile[stage])?void 0:_a.stageSequence)?void 0:_b[stageSequence])?void 0:_c.qualifiersCount)||(null==(_d=null==entryProfile?void 0:entryProfile[stage])?void 0:_d.qualifiersCount)||0,roundQualifiersCounts={};if(!structureId)return{qualifiersCount:profileQualifiersCount,roundQualifiersCounts};const{structure}=findStructure({drawDefinition,structureId}),relevantLinks=null==(_e=drawDefinition.links)?void 0:_e.filter((link=>{var _a2;return(null==(_a2=null==link?void 0:link.target)?void 0:_a2.structureId)===(null==structure?void 0:structure.structureId)}));let qualifiersCount=0;if(null==relevantLinks?void 0:relevantLinks.length)for(const relevantLink of relevantLinks){const sourceStructure=null==(_f=findStructure({structureId:relevantLink.source.structureId,drawDefinition}))?void 0:_f.structure;if(sourceStructure.stage===QUALIFYING){const sourceRoundNumber=relevantLink.source.roundNumber,roundTarget=relevantLink.target.roundNumber;let count=0;if(sourceStructure.structureType===CONTAINER){count=((null==(_g=sourceStructure.structures)?void 0:_g.length)||0)*((null==(_h=relevantLink.source.finishingPositions)?void 0:_h.length)||0)}else{const matchUps=getAllStructureMatchUps({matchUpFilters:{roundNumbers:[sourceRoundNumber]},provisionalPositioning,structure:sourceStructure,afterRecoveryTimes:!1,inContext:!1}).matchUps;count=(null==matchUps?void 0:matchUps.length)||0}roundQualifiersCounts[roundTarget]||(roundQualifiersCounts[roundTarget]=0),roundQualifiersCounts[roundTarget]+=count,qualifiersCount+=count}}const qualifyingRounds=Object.keys(roundQualifiersCounts);if(qualifyingRounds.length<=1){const qualifyingRound=qualifyingRounds[0]||1;roundQualifiersCounts[qualifyingRound]=Math.max(roundQualifiersCounts[qualifyingRound]||0,profileQualifiersCount)}return qualifiersCount=Math.max(qualifiersCount,profileQualifiersCount),{qualifiersCount,roundQualifiersCounts}}function getStageDrawPositionsCount({stage,drawDefinition}){var _a;const{entryProfile}=getEntryProfile({drawDefinition});return entryProfile&&(null==(_a=entryProfile[stage])?void 0:_a.drawSize)||0}function generateTieMatchUps({tieFormat,uuids,isMock}){const{collectionDefinitions}=tieFormat||{};return{tieMatchUps:(collectionDefinitions||[]).map((collectionDefinition=>generateCollectionMatchUps({collectionDefinition,uuids,isMock}))).filter(Boolean).flat()}}function generateCollectionMatchUps({collectionDefinition,matchUpsLimit,isMock,uuids}){const{matchUpCount,matchUpType,collectionId}=collectionDefinition||{};return generateRange(0,matchUpsLimit||matchUpCount||0).map((index=>{const collectionPosition=index+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:(null==uuids?void 0:uuids.pop())||UUID(),collectionPosition,collectionId,matchUpType,isMock}}))}var __defProp$2B=Object.defineProperty,__defProps$1t=Object.defineProperties,__getOwnPropDescs$1t=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2C=Object.getOwnPropertySymbols,__hasOwnProp$2C=Object.prototype.hasOwnProperty,__propIsEnum$2C=Object.prototype.propertyIsEnumerable,__defNormalProp$2B=(obj,key,value)=>key in obj?__defProp$2B(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2B=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2C.call(b,prop)&&__defNormalProp$2B(a,prop,b[prop]);if(__getOwnPropSymbols$2C)for(var prop of __getOwnPropSymbols$2C(b))__propIsEnum$2C.call(b,prop)&&__defNormalProp$2B(a,prop,b[prop]);return a},__spreadProps$1t=(a,b)=>__defProps$1t(a,__getOwnPropDescs$1t(b));function setStageDrawSize({stageSequence=1,drawDefinition,drawSize,stage}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!stageExists({drawDefinition,stage}))return{error:INVALID_STAGE};const directAcceptanceEntries=getStageDirectEntriesCount({drawDefinition,stage}),{qualifiersCount}=getQualifiersCount({drawDefinition,stageSequence,stage});if(drawSize<directAcceptanceEntries+qualifiersCount)return{error:DRAW_SIZE_MISMATCH};const{entryProfile}=modifyEntryProfile({attributes:[{[stage]:{drawSize}}],drawDefinition});return modifyDrawNotice({drawDefinition}),__spreadProps$1t(__spreadValues$2B({},SUCCESS),{entryProfile})}function setStageQualifiersCount({qualifiersCount=0,drawDefinition,stage}){return drawDefinition?stageExists({drawDefinition,stage})?stage!==MAIN?{error:DRAW_SIZE_MISMATCH,info:"qualifiersCount can only be set for main stage"}:(modifyEntryProfile({attributes:[{[stage]:{qualifiersCount}}],drawDefinition}),modifyDrawNotice({drawDefinition}),__spreadValues$2B({},SUCCESS)):{error:INVALID_STAGE}:{error:MISSING_DRAW_DEFINITION}}var __defProp$2A=Object.defineProperty,__defProps$1s=Object.defineProperties,__getOwnPropDescs$1s=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2B=Object.getOwnPropertySymbols,__hasOwnProp$2B=Object.prototype.hasOwnProperty,__propIsEnum$2B=Object.prototype.propertyIsEnumerable,__defNormalProp$2A=(obj,key,value)=>key in obj?__defProp$2A(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2A=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2B.call(b,prop)&&__defNormalProp$2A(a,prop,b[prop]);if(__getOwnPropSymbols$2B)for(var prop of __getOwnPropSymbols$2B(b))__propIsEnum$2B.call(b,prop)&&__defNormalProp$2A(a,prop,b[prop]);return a},__spreadProps$1s=(a,b)=>__defProps$1s(a,__getOwnPropDescs$1s(b));function generateDrawTypeAndModifyDrawDefinition$1(params={}){const{modifyOriginal=!0,stageSequence=1,isMock}=params,stack="generateDrawTypeAndModifyDrawDefinition";if(!params.drawDefinition)return decorateResult({result:{error:MISSING_DRAW_DEFINITION},stack});const drawDefinition=modifyOriginal?params.drawDefinition:makeDeepCopy(params.drawDefinition,!1,!0);let{tieFormat,matchUpType}=params;if(tieFormat){const result2=validateTieFormat({tieFormat});if(result2.error)return result2}tieFormat=copyTieFormat(tieFormat||drawDefinition.tieFormat||void 0),matchUpType=matchUpType||drawDefinition.matchUpType||SINGLES$1,params.tieFormat=tieFormat,params.matchUpType=matchUpType;const mainStageDrawPositionsCount=getStageDrawPositionsCount({drawDefinition,stage:MAIN});params.drawSize=params.drawSize||mainStageDrawPositionsCount,!mainStageDrawPositionsCount&&params.drawSize&&setStageDrawSize({drawSize:params.drawSize,drawDefinition,stageSequence,stage:MAIN});const existingMatchUpIds=getMatchUpsMap({drawDefinition}).drawMatchUps.map(getMatchUpId),result=generateDrawStructuresAndLinks$1(params);if(result.error)return decorateResult({result,stack});const{structures,links,qualifyingResult}=result;drawDefinition.structures=structures,drawDefinition.links=links;const qualifiersCount=Math.max(params.qualifiersCount||0,(null==qualifyingResult?void 0:qualifyingResult.qualifiersCount)||0);if(null==qualifyingResult?void 0:qualifyingResult.qualifyingDrawPositionsCount){if(!getStageDrawPositionsCount({stage:QUALIFYING,drawDefinition})){const result2=setStageDrawSize({drawSize:qualifyingResult.qualifyingDrawPositionsCount,stage:QUALIFYING,drawDefinition});if(result2.error)return result2}}if(qualifiersCount){const result2=setStageQualifiersCount({qualifiersCount,drawDefinition,stage:MAIN});if(result2.error)return result2}const drawSize=params.drawSize||mainStageDrawPositionsCount;Object.assign(params,definedAttributes({drawSize,matchUpType,tieFormat}));const{matchUps,matchUpsMap}=getAllDrawMatchUps({drawDefinition});tieFormat&&matchUps.forEach((matchUp=>{if(!existingMatchUpIds.includes(matchUp.matchUpId)){const{tieMatchUps}=generateTieMatchUps({tieFormat,isMock});Object.assign(matchUp,{tieMatchUps,matchUpType})}}));const{inContextDrawMatchUps}=addGoesTo({drawDefinition,matchUpsMap});return modifyDrawNotice({drawDefinition}),__spreadProps$1s(__spreadValues$2A({inContextDrawMatchUps,drawDefinition,matchUpsMap},SUCCESS),{structures,matchUps,links})}function extractAttributeValues({policyAttributes,idCollections,participants,participant}){if(!Array.isArray(policyAttributes))return{error:MISSING_POLICY_ATTRIBUTES};if(!participant)return{error:MISSING_PARTICIPANT};const extractedValues=[];policyAttributes.forEach((policyAttribute=>{const{directive,groupings,key,significantCharacters}=policyAttribute||{};if(key){const keys=key.split(".");processKeys({value:participant,keys,significantCharacters})}else if(directive){const includeIds=null==policyAttribute?void 0:policyAttribute.includeIds,collectionIds=(idCollections&&idCollections[directive]||[]).filter((participantId=>!includeIds||includeIds.includes(participantId)));(null==collectionIds?void 0:collectionIds.length)&&(null==participants?void 0:participants.length)&&collectionIds.forEach((collectionParticipantId=>{var _a;const collectionParticipant=participants.find((participant2=>participant2.participantId===collectionParticipantId));if(null==(_a=null==collectionParticipant?void 0:collectionParticipant.individualParticipantIds)?void 0:_a.includes(participant.participantId)){const participantId=null==collectionParticipant?void 0:collectionParticipant.participantId;extractedValues.push(participantId)}}))}else groupings&&Object.keys(groupings).forEach((key2=>{groupings[key2].includes(participant.participantId)&&extractedValues.push(key2)}))}));return{values:unique(extractedValues)};function processKeys({value,keys=[],significantCharacters}){for(const[index,key]of keys.entries())if(value&&value[key])if(Array.isArray(value[key])){const values2=value[key],remainingKeys=keys.slice(index);values2.forEach((nestedValue=>processKeys({value:nestedValue,keys:remainingKeys,significantCharacters})))}else checkValue({value:value=value[key],index});function checkValue({value:value2,index}){if(value2&&index===keys.length-1&&["string","number"].includes(typeof value2)){const extractedValue=significantCharacters?value2.slice(0,significantCharacters):value2;extractedValues.push(extractedValue)}}}}var __defProp$2z=Object.defineProperty,__defProps$1r=Object.defineProperties,__getOwnPropDescs$1r=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2A=Object.getOwnPropertySymbols,__hasOwnProp$2A=Object.prototype.hasOwnProperty,__propIsEnum$2A=Object.prototype.propertyIsEnumerable,__defNormalProp$2z=(obj,key,value)=>key in obj?__defProp$2z(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2z=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2A.call(b,prop)&&__defNormalProp$2z(a,prop,b[prop]);if(__getOwnPropSymbols$2A)for(var prop of __getOwnPropSymbols$2A(b))__propIsEnum$2A.call(b,prop)&&__defNormalProp$2z(a,prop,b[prop]);return a},__spreadProps$1r=(a,b)=>__defProps$1r(a,__getOwnPropDescs$1r(b));function getPositionedParticipants({candidatePositionAssignments,participantsWithGroupings,policyAttributes,idCollections}){const participantsMap=Object.assign({},...participantsWithGroupings.map((participant=>({[participant.participantId]:participant}))));return candidatePositionAssignments.map((assignment=>{const participant=participantsMap[assignment.participantId],{values}=extractAttributeValues({participants:participantsWithGroupings,policyAttributes,idCollections,participant});return __spreadProps$1r(__spreadValues$2z({},assignment),{values})}))}function getPositionProfiles({participantIdGroups,positionAssignments,groupsToAvoid}){return Object.assign({},...positionAssignments.filter((assignment=>null==assignment?void 0:assignment.participantId)).map((assginment=>{const{drawPosition,participantId}=assginment,participantGroups=participantIdGroups&&participantIdGroups[participantId]||[],includesGroupsToAvoid=!!groupsToAvoid.some((group=>participantGroups.includes(group)));return{[drawPosition]:{participantGroups,includesGroupsToAvoid}}})))}function analyzeEliminationDrawPositions(params){const{unfilledPositions,chunkedDrawPositions}=params,profiledPositions=getPositionProfiles(params);return chunkedDrawPositions.map((chunkedGrouping=>{const unassigned=unfilledPositions.filter((unfilledPosition=>chunkedGrouping.includes(unfilledPosition))),unpaired=function unpairedPositions(unassigned){return unassigned.filter((u=>!pairAssigned(u)));function pairAssigned(drawPosition){const pairedPosition=getPairedPosition(drawPosition);return!unassigned.includes(pairedPosition)}}(unassigned),pairedNoConflict=unassigned.filter((drawPosition=>!unpaired.includes(drawPosition))).filter((drawPosition=>{var _a;const pairedPosition=getPairedPosition(drawPosition);return!(null==(_a=profiledPositions[pairedPosition])?void 0:_a.includesGroupsToAvoid)}));return{unassigned,unpaired,pairedNoConflict}}))}function getPairedPosition(drawPosition){return drawPosition%2?drawPosition+1:drawPosition-1}function organizeDrawPositionOptions({selectedParticipantGroups,participantIdGroups,positionAssignments,drawPositionChunks,unfilledPositions,isRoundRobin}){const vettedChunks=drawPositionChunks.map((chunkedDrawPositions=>isRoundRobin?function analyzeRoundRobinDrawPositions(params){const{unfilledPositions,chunkedDrawPositions}=params,profiledPositions=getPositionProfiles(params);return chunkedDrawPositions.map((chunkedGrouping=>{const unassigned=unfilledPositions.filter((unfilledPosition=>chunkedGrouping.includes(unfilledPosition))),unpaired=unassigned.length===chunkedGrouping.length?unassigned:[],conflictsCount=chunkedGrouping.filter((drawPosition=>{var _a;return null==(_a=profiledPositions[drawPosition])?void 0:_a.includesGroupsToAvoid})).length;return{unassigned,unpaired,pairedNoConflict:conflictsCount?[]:unassigned,conflictsCount}}))}({groupsToAvoid:selectedParticipantGroups,chunkedDrawPositions,participantIdGroups,positionAssignments,unfilledPositions}):analyzeEliminationDrawPositions({groupsToAvoid:selectedParticipantGroups,chunkedDrawPositions,participantIdGroups,positionAssignments,unfilledPositions})));if(isRoundRobin){return{unassigned:vettedChunks.map((chunk=>chunk.map((grouping=>grouping.unassigned)).filter((unassigned2=>null==unassigned2?void 0:unassigned2.length)))).filter((f=>null==f?void 0:f.length)).sort(((a,b)=>(b.length||0)-(a.length||0))),unpaired:vettedChunks.map((chunk=>chunk.map((grouping=>grouping.unpaired)).filter((unpaired2=>null==unpaired2?void 0:unpaired2.length)))).filter((f=>null==f?void 0:f.length)),pairedNoConflict:vettedChunks.map((chunk=>chunk.map((grouping=>grouping.pairedNoConflict)).filter((pairedNoConflict2=>null==pairedNoConflict2?void 0:pairedNoConflict2.length)))).filter((f=>null==f?void 0:f.length)).sort(((a,b)=>(b.length||0)-(a.length||0)))}}return{unassigned:vettedChunks.map((chunk=>chunk.map((grouping=>grouping.unassigned)).filter((unassigned2=>null==unassigned2?void 0:unassigned2.length)))).filter((f=>null==f?void 0:f.length)),unpaired:vettedChunks.map((chunk=>chunk.map((grouping=>grouping.unpaired)).filter((unpaired2=>null==unpaired2?void 0:unpaired2.length)))).filter((f=>null==f?void 0:f.length)),pairedNoConflict:vettedChunks.map((chunk=>chunk.map((grouping=>grouping.pairedNoConflict)).filter((pairedNoConflict2=>null==pairedNoConflict2?void 0:pairedNoConflict2.length)))).filter((f=>null==f?void 0:f.length))}}function getUnplacedParticipantIds({participantIds,positionAssignments}){const assignedParticipantIds=positionAssignments.map((assignment=>assignment.participantId));return participantIds.filter((participantId=>!assignedParticipantIds.includes(participantId)))}function getParticipantPlacement({candidatePositionAssignments,unseededParticipantIds,participantIdGroups,drawPositionChunks,drawPositionGroups,pairedPriority,allGroups,groupKey}){const largestGroupSize=drawPositionGroups.reduce(((largest,group)=>group.length>largest?group.length:largest),0),useSpecifiedGroupKey=largestGroupSize<=2,targetParticipantIds=getUnplacedParticipantIds({positionAssignments:candidatePositionAssignments,participantIds:unseededParticipantIds}),unfilledPositions=function getUnfilledPositions({drawPositionGroups,positionAssignments}){const assignmentMap=Object.assign({},...positionAssignments.map((assignment=>({[assignment.drawPosition]:assignment}))));return drawPositionGroups.map((drawPositions=>drawPositions.filter(Boolean).map((drawPosition=>assignmentMap[drawPosition])).filter(Boolean).filter((assignment=>!assignment.participantId&&!assignment.bye)).map((assignment=>assignment.drawPosition)))).flat().filter(Boolean)}({positionAssignments:candidatePositionAssignments,drawPositionGroups}),{participantId:selectedParticipantId,groupKey:newGroupKey}=function getNextParticipantId({groupKey,allGroups,largestFirst=!0,targetParticipantIds,useSpecifiedGroupKey=!1}){var _a;const groupings=Object.assign({},...Object.keys(allGroups).map((group=>[group,allGroups[group].filter((id=>targetParticipantIds.includes(id)))])).filter((item=>item[1].length)).map((([group,ids])=>({[group]:ids})))),largestGroupSize=Object.keys(groupings).reduce(((size,key)=>groupings[key].length>size?groupings[key].length:size),0),largestSizedGroupings=Object.keys(groupings).filter((key=>groupings[key].length===largestGroupSize)),randomGroupKey=randomMember(largestFirst?largestSizedGroupings:Object.keys(groupings));return{participantId:(groupKey=useSpecifiedGroupKey&&(null==(_a=groupings[groupKey])?void 0:_a.length)?groupKey:randomGroupKey)&&groupings[groupKey]?randomMember(groupings[groupKey]):randomMember(targetParticipantIds),groupKey}}({targetParticipantIds,useSpecifiedGroupKey,allGroups,groupKey}),selectedParticipantGroups=function getParticipantGroups({allGroups,participantId}){return Object.keys(allGroups).filter((key=>allGroups[key].includes(participantId)))}({participantId:selectedParticipantId,allGroups}),drawPositionOptions=organizeDrawPositionOptions({positionAssignments:candidatePositionAssignments,isRoundRobin:useSpecifiedGroupKey,selectedParticipantGroups,participantIdGroups,drawPositionChunks,unfilledPositions,largestGroupSize,allGroups}),{unassigned,unpaired,pairedNoConflict}=drawPositionOptions,pnc=(null==pairedNoConflict?void 0:pairedNoConflict.length)&&pairedNoConflict[0],up=(null==unpaired?void 0:unpaired.length)&&unpaired[0],desiredOptions=pairedPriority&&pnc?pnc:up,fallbackOptions=pairedPriority?up:pnc,prioritizedOptions=(null==desiredOptions?void 0:desiredOptions.length)&&desiredOptions||(null==fallbackOptions?void 0:fallbackOptions.length)&&fallbackOptions;let targetDrawPosition;if(null==prioritizedOptions?void 0:prioritizedOptions.length){const section=randomPop(prioritizedOptions);targetDrawPosition=randomPop(section)}else{const section=randomPop(unassigned[0]);targetDrawPosition=randomPop(section)}return{newGroupKey,selectedParticipantId,targetDrawPosition}}function getAvoidanceConflicts({isRoundRobin,groupedParticipants}){const avoidanceConflicts=[];return isRoundRobin?groupedParticipants.forEach((participantGroup=>{const drawPositions=participantGroup.map((participant=>participant.drawPosition)),{uniqueMatchUpGroupings}=getRoundRobinGroupMatchUps({drawPositions}),drawPositionValuesMap=Object.assign({},...participantGroup.map((participant=>({[participant.drawPosition]:participant}))));uniqueMatchUpGroupings.forEach((grouping=>{overlap(drawPositionValuesMap[grouping[0]].values||[],drawPositionValuesMap[grouping[1]].values||[])&&(avoidanceConflicts.push(grouping),participantGroup.conflict=!0)}))})):groupedParticipants.forEach((matchUpPair=>{var _a,_b;overlap((null==(_a=matchUpPair[0])?void 0:_a.values)||[],(null==(_b=matchUpPair[1])?void 0:_b.values)||[])&&(avoidanceConflicts.push(matchUpPair),matchUpPair.conflict=!0)})),avoidanceConflicts}function getSwapOptions({positionedParticipants,potentialDrawPositions,avoidanceConflicts,drawPositionGroups,isRoundRobin}){return avoidanceConflicts.map((conflict=>{const drawPositions=conflict.map((c=>c.drawPosition));return conflict.filter((placedParticipant=>potentialDrawPositions.includes(placedParticipant.drawPosition))).map((moveableParticipant=>{const possibleDrawPositionsNoConflict=potentialDrawPositions.filter((position=>!(null==drawPositions?void 0:drawPositions.includes(position)))).filter((possibleDrawPosition=>{const potentialOpponentDrawPosition=drawPositionGroups.find((pair=>pair.includes(possibleDrawPosition))).find((drawPosition=>drawPosition!==possibleDrawPosition)),potentialOpponent=positionedParticipants.find((placement=>placement.drawPosition===potentialOpponentDrawPosition)),conflictPotential=getAvoidanceConflicts({isRoundRobin,groupedParticipants:[[moveableParticipant,potentialOpponent]]}),swappedParticipant=positionedParticipants.find((placement=>placement.drawPosition===possibleDrawPosition)),existingOpponentConflictPotential=getAvoidanceConflicts({isRoundRobin,groupedParticipants:[[swappedParticipant,potentialOpponent]]});return!conflictPotential.length&&!existingOpponentConflictPotential.length}));if(possibleDrawPositionsNoConflict.length)return{drawPosition:moveableParticipant.drawPosition,possibleDrawPositions:possibleDrawPositionsNoConflict}})).filter(Boolean)})).flat(1)}var __defProp$2y=Object.defineProperty,__defProps$1q=Object.defineProperties,__getOwnPropDescs$1q=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2z=Object.getOwnPropertySymbols,__hasOwnProp$2z=Object.prototype.hasOwnProperty,__propIsEnum$2z=Object.prototype.propertyIsEnumerable,__defNormalProp$2y=(obj,key,value)=>key in obj?__defProp$2y(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2y=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2z.call(b,prop)&&__defNormalProp$2y(a,prop,b[prop]);if(__getOwnPropSymbols$2z)for(var prop of __getOwnPropSymbols$2z(b))__propIsEnum$2z.call(b,prop)&&__defNormalProp$2y(a,prop,b[prop]);return a},__spreadProps$1q=(a,b)=>__defProps$1q(a,__getOwnPropDescs$1q(b));function generatePositioningCandidate(params){const{initialPositionAssignments,participantsWithGroupings,opponentsToPlaceCount,unseededByePositions,drawPositionGroups,policyAttributes,idCollections,allGroups}=params,errors=[];let groupKey;const groupSize=Math.min(...(drawPositionGroups||[]).map((dpg=>null==dpg?void 0:dpg.length)).filter(Boolean)),isRoundRobin=groupSize>2,candidatePositionAssignments=makeDeepCopy(initialPositionAssignments,!1,!0).filter((assignment=>!assignment.qualifier)),potentialDrawPositions=initialPositionAssignments.filter((assignment=>!assignment.participantId&&(!assignment.bye||(null==unseededByePositions?void 0:unseededByePositions.includes(assignment.drawPosition))))).map((assignment=>assignment.drawPosition));generateRange(0,opponentsToPlaceCount).forEach((()=>{const{newGroupKey,selectedParticipantId,targetDrawPosition}=getParticipantPlacement(__spreadProps$1q(__spreadValues$2y({},params),{candidatePositionAssignments,allGroups,groupKey}));groupKey=newGroupKey,candidatePositionAssignments.forEach((assignment=>{assignment.drawPosition===targetDrawPosition&&(assignment.participantId=selectedParticipantId)}))}));let positionedParticipants=getPositionedParticipants({candidatePositionAssignments,participantsWithGroupings,policyAttributes,idCollections}),groupedParticipants=chunkArray(positionedParticipants,groupSize),avoidanceConflicts=getAvoidanceConflicts({groupedParticipants,isRoundRobin}),attempts=0;for(;attempts<20&&avoidanceConflicts.length;){const swapOptions=getSwapOptions({positionedParticipants,potentialDrawPositions,avoidanceConflicts,drawPositionGroups,isRoundRobin});if(swapOptions.length){const result=swapAssignedPositions({candidatePositionAssignments,swapOptions});result.error&&console.log({result}),positionedParticipants=getPositionedParticipants({candidatePositionAssignments,participantsWithGroupings,policyAttributes,idCollections}),groupedParticipants=chunkArray(positionedParticipants,groupSize),avoidanceConflicts=getAvoidanceConflicts({groupedParticipants,isRoundRobin}),attempts++}else attempts=20}return candidatePositionAssignments.forEach((assignment=>{if(assignment.bye&&assignment.participantId){const error=INVALID_ASSIGNMENT;errors.push(error)}if(assignment.qualifier&&assignment.participantId){const error=INVALID_ASSIGNMENT;errors.push(error)}})),{positionAssignments:candidatePositionAssignments,conflicts:avoidanceConflicts.length,groupedParticipants,errors}}function swapAssignedPositions({candidatePositionAssignments,swapOptions}){const swapOption=randomPop(swapOptions);if(!swapOption)return{error:{message:"No swap options"}};const firstPosition=swapOption.drawPosition,secondPosition=randomPop(swapOption.possibleDrawPositions),firstAssignment=candidatePositionAssignments.find((assignment=>assignment.drawPosition===firstPosition)),secondAssignment=candidatePositionAssignments.find((assignment=>assignment.drawPosition===secondPosition)),updatedFirstAssignmentAttributes={participantId:secondAssignment.participantId,qualifier:secondAssignment.qualifier,bye:secondAssignment.bye},updatedSecondAssignmentAttributes={participantId:firstAssignment.participantId,qualifier:firstAssignment.qualifier,bye:firstAssignment.bye};return Object.assign(firstAssignment,updatedFirstAssignmentAttributes),Object.assign(secondAssignment,updatedSecondAssignmentAttributes),__spreadValues$2y({},SUCCESS)}var __defProp$2x=Object.defineProperty,__getOwnPropSymbols$2y=Object.getOwnPropertySymbols,__hasOwnProp$2y=Object.prototype.hasOwnProperty,__propIsEnum$2y=Object.prototype.propertyIsEnumerable,__defNormalProp$2x=(obj,key,value)=>key in obj?__defProp$2x(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2x=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2y.call(b,prop)&&__defNormalProp$2x(a,prop,b[prop]);if(__getOwnPropSymbols$2y)for(var prop of __getOwnPropSymbols$2y(b))__propIsEnum$2y.call(b,prop)&&__defNormalProp$2x(a,prop,b[prop]);return a};function randomUnseededSeparation({provisionalPositioning,unseededParticipantIds,inContextDrawMatchUps,unseededByePositions,tournamentRecord,drawDefinition,seedBlockInfo,participants,matchUpsMap,structureId,avoidance,entries,event}){var _a;if(!avoidance)return{error:MISSING_AVOIDANCE_POLICY};const{candidatesCount=1,policyAttributes,targetDivisions}=avoidance;let{roundsToSeparate}=avoidance;const stack="randomUnseededSeparation";let{structure}=findStructure({drawDefinition,structureId});const{matchUps}=getAllStructureMatchUps({provisionalPositioning,matchUpsMap,structure,event});if(targetDivisions&&isPowerOf2(targetDivisions)&&!roundsToSeparate){const exponent=function deriveExponent(n){if(!isPowerOf2(n))return!1;let m=n,i=1;for(;2!==m;)i+=1,m/=2;return i}(targetDivisions),roundsCount=matchUps.reduce(((count,matchUp)=>matchUp.roundNumber>count?matchUp.roundNumber:count),0);roundsToSeparate=roundsCount<exponent?1:roundsCount-exponent+1}let{positionAssignments}=structureAssignedDrawPositions({structure});const participantsWithGroupings=addParticipantGroupings({participantsProfile:{convertExtensions:!0},participants}),unassignedPositions=positionAssignments.filter((assignment=>!assignment.participantId)),allDrawPositions=positionAssignments.map((assignment=>assignment.drawPosition)),isRoundRobin=structure.structureType===CONTAINER,params=isRoundRobin?{structure,matchUps,allDrawPositions,roundsToSeparate}:{matchUps,allDrawPositions,roundsToSeparate},{drawPositionGroups,drawPositionChunks}=isRoundRobin?function roundRobinParticipantGroups(params){const{structure:{structures}}=params,drawPositionGroups=structures.map((structure=>structure.positionAssignments.map((assignment=>assignment.drawPosition))));return{drawPositionGroups,drawPositionChunks:[drawPositionGroups]}}(params):function eliminationParticipantGroups({allDrawPositions,roundsToSeparate,matchUps}){const drawPositionPairs=matchUps.filter((matchUp=>1===matchUp.roundNumber)).map((matchUp=>matchUp.drawPositions)),firstRoundMatchUpDrawPositions=drawPositionPairs.flat().sort(numericSort),greatestFirstRoundDrawPosition=Math.max(...firstRoundMatchUpDrawPositions),fedDrawPositions=allDrawPositions.filter((drawPositon=>drawPositon>greatestFirstRoundDrawPosition)),structureSize=firstRoundMatchUpDrawPositions.length,roundSizes=generateRange(2===structureSize?1:2,structureSize).filter((f=>f===nearestPowerOf2(f))),chunkSizes=roundSizes.slice(0,roundsToSeparate||roundSizes.length).reverse(),drawPositionChunks=chunkSizes.map((size=>chunkArray(firstRoundMatchUpDrawPositions,size)));fedDrawPositions.length&&console.log({fedDrawPositions});return{drawPositionGroups:drawPositionPairs,drawPositionChunks}}(params),idCollections={};idCollections.groupParticipants=participants.filter((participant=>participant.participantType===GROUP)).map((participant=>participant.participantId)),idCollections.teamParticipants=participants.filter((participant=>participant.participantType===TEAM)).map((participant=>participant.participantId)),idCollections.pairParticipants=participants.filter((participant=>participant.participantType===PAIR)).map((participant=>participant.participantId));const allGroups=function getAttributeGroupings({targetParticipantIds,policyAttributes,idCollections,participants}){if(!Array.isArray(policyAttributes))return{error:MISSING_POLICY_ATTRIBUTES};if(!Array.isArray(participants))return{error:MISSING_PARTICIPANTS};const groupings={};return targetParticipantIds.forEach((participantId=>{const participant=participants.find((candidate=>candidate.participantId===participantId)),{values}=extractAttributeValues({policyAttributes,idCollections,participants,participant});values&&values.forEach((value=>{groupings[value]||(groupings[value]=[]),groupings[value].includes(participantId)||groupings[value].push(participantId)}))})),groupings}({targetParticipantIds:unseededParticipantIds,policyAttributes,idCollections,participants}),participantIdGroups=Object.assign({},...unseededParticipantIds.map((participantId=>{const groups=Object.keys(allGroups).filter((key=>allGroups[key].includes(participantId)));return{[participantId]:groups}})));let candidate,unplacedParticipantIds=getUnplacedParticipantIds({participantIds:unseededParticipantIds,positionAssignments});if(unplacedParticipantIds.length>unassignedPositions.length)return{error:INSUFFICIENT_DRAW_POSITIONS};const opponentsToPlaceCount=unplacedParticipantIds.length,noPairPriorityCandidates=generateRange(0,candidatesCount).map((()=>generatePositioningCandidate({initialPositionAssignments:positionAssignments,participantsWithGroupings,unseededParticipantIds,opponentsToPlaceCount,pairedPriority:!1,unseededByePositions,participantIdGroups,drawPositionChunks,drawPositionGroups,policyAttributes,idCollections,allGroups})));if(candidate=noPairPriorityCandidates.reduce(((p,c)=>!p||(c.conflicts||0)<(p.conflicts||0)?c:p),void 0),!candidate||candidate.conflicts){const pairedPriorityCandidates=generateRange(0,candidatesCount).map((()=>generatePositioningCandidate({initialPositionAssignments:positionAssignments,participantsWithGroupings,unseededParticipantIds,opponentsToPlaceCount,pairedPriority:!0,unseededByePositions,participantIdGroups,drawPositionChunks,drawPositionGroups,policyAttributes,idCollections,allGroups,entries})));candidate=noPairPriorityCandidates.concat(...pairedPriorityCandidates).filter((candidate2=>{var _a2;return!(null==(_a2=candidate2.errors)?void 0:_a2.length)})).reduce(((p,c)=>!p||(c.conflicts||0)<(p.conflicts||0)?c:p),void 0)}if(!candidate)return{error:NO_CANDIDATES};const alreadyAssignedParticipantIds=((null==(_a=getPositionAssignments$1({structure}))?void 0:_a.positionAssignments)||[]).filter((assignment=>assignment.participantId)).map((assignment=>assignment.participantId)),filteredAssignments=candidate.positionAssignments.filter((assignment=>!alreadyAssignedParticipantIds.includes(assignment.participantId)));for(const assignment of filteredAssignments)if(assignment.bye){const result=assignDrawPositionBye$1(__spreadValues$2x({tournamentRecord,drawDefinition,seedBlockInfo,structureId,matchUpsMap,event},assignment));if(result.error)return decorateResult({result,stack})}else{const result=assignDrawPosition$1(__spreadValues$2x({automaticPlacement:!0,inContextDrawMatchUps,tournamentRecord,drawDefinition,seedBlockInfo,structureId,matchUpsMap,event},assignment));if(result.error)return decorateResult({result,stack,context:{assignment}})}return __spreadValues$2x({},SUCCESS)}var __defProp$2w=Object.defineProperty,__getOwnPropSymbols$2x=Object.getOwnPropertySymbols,__hasOwnProp$2x=Object.prototype.hasOwnProperty,__propIsEnum$2x=Object.prototype.propertyIsEnumerable,__defNormalProp$2w=(obj,key,value)=>key in obj?__defProp$2w(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2w=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2x.call(b,prop)&&__defNormalProp$2w(a,prop,b[prop]);if(__getOwnPropSymbols$2x)for(var prop of __getOwnPropSymbols$2x(b))__propIsEnum$2x.call(b,prop)&&__defNormalProp$2w(a,prop,b[prop]);return a};function positionUnseededParticipants({provisionalPositioning,inContextDrawMatchUps,unseededByePositions,multipleStructures,tournamentRecord,candidatesCount,drawDefinition,seedBlockInfo,participants,matchUpsMap,structureId,structure,event}){var _a,_b;structure||({structure}=findStructure({drawDefinition,structureId})),structureId||({structureId}=structure);const{positionAssignments}=structureAssignedDrawPositions({structure}),{seedAssignments}=getStructureSeedAssignments({provisionalPositioning,drawDefinition,structure}),assignedSeedParticipantIds=seedAssignments.map((assignment=>assignment.participantId)).filter(Boolean),{stage,stageSequence}=structure,roundTarget=stage===QUALIFYING?null==(_b=null==(_a=findExtension$1({element:structure,name:ROUND_TARGET}))?void 0:_a.extension)?void 0:_b.value:void 0,entries=getStageEntries$1({provisionalPositioning,drawDefinition,stageSequence,entryStatuses:DIRECT_ENTRY_STATUSES,structureId,roundTarget,stage}),unseededParticipantIds=entries.filter((entry=>!assignedSeedParticipantIds.includes(entry.participantId))).map((entry=>entry.participantId)),unfilledDrawPositions=positionAssignments.filter((assignment=>!assignment.participantId&&!assignment.bye&&!assignment.qualifier)).map((assignment=>assignment.drawPosition));if(!multipleStructures&&unseededParticipantIds.length>unfilledDrawPositions.length)return decorateResult({result:{error:INSUFFICIENT_DRAW_POSITIONS},context:{unseededParticipantsCount:unseededParticipantIds.length,unfilledDrawPositionsCount:unfilledDrawPositions.length},stack:"positionUnseededParticipants"});const{appliedPolicies}=getAppliedPolicies({tournamentRecord,drawDefinition,event});let{avoidance}=appliedPolicies||{};if(structure.stage===PLAY_OFF){const groupings=entries.reduce(((groupings2,entry)=>(groupings2[entry.groupingValue]||(groupings2[entry.groupingValue]=[]),groupings2[entry.groupingValue].push(entry.participantId),groupings2)),{});Object.keys(groupings).length&&(avoidance||(avoidance={policyName:"Playoff Avoidance"}),avoidance.policyAttributes||(avoidance.policyAttributes=[]),avoidance.policyAttributes.push({groupings}))}return avoidance&&participants?randomUnseededSeparation({provisionalPositioning,unseededParticipantIds,inContextDrawMatchUps,unseededByePositions,tournamentRecord,candidatesCount,drawDefinition,seedBlockInfo,participants,matchUpsMap,structureId,avoidance,entries}):function randomUnseededDistribution({provisionalPositioning,unseededParticipantIds,inContextDrawMatchUps,unfilledDrawPositions,multipleStructures,tournamentRecord,drawDefinition,seedBlockInfo,matchUpsMap,structureId,event}){const shuffledDrawPositions=shuffleArray(unfilledDrawPositions);for(const participantId of unseededParticipantIds){const drawPosition=shuffledDrawPositions.pop();if(!multipleStructures||drawPosition){const result=assignDrawPosition$1({automaticPlacement:!0,provisionalPositioning,inContextDrawMatchUps,tournamentRecord,drawDefinition,seedBlockInfo,participantId,drawPosition,matchUpsMap,structureId,event});if((null==result?void 0:result.error)&&console.log("!!!!!",{result}),null==result?void 0:result.error)return decorateResult({result,stack:"randomUnseededDistribution"})}}return __spreadValues$2w({},SUCCESS)}({provisionalPositioning,unseededParticipantIds,inContextDrawMatchUps,unfilledDrawPositions,multipleStructures,tournamentRecord,drawDefinition,seedBlockInfo,structureId,matchUpsMap,event})}var __defProp$2v=Object.defineProperty,__defProps$1p=Object.defineProperties,__getOwnPropDescs$1p=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2w=Object.getOwnPropertySymbols,__hasOwnProp$2w=Object.prototype.hasOwnProperty,__propIsEnum$2w=Object.prototype.propertyIsEnumerable,__defNormalProp$2v=(obj,key,value)=>key in obj?__defProp$2v(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2v=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2w.call(b,prop)&&__defNormalProp$2v(a,prop,b[prop]);if(__getOwnPropSymbols$2w)for(var prop of __getOwnPropSymbols$2w(b))__propIsEnum$2w.call(b,prop)&&__defNormalProp$2v(a,prop,b[prop]);return a},__spreadProps$1p=(a,b)=>__defProps$1p(a,__getOwnPropDescs$1p(b));function getBlockSortedRandomDrawPositions({validSeedBlocks,byesToPlace}){const drawPositions=[];return validSeedBlocks.forEach((seedBlock=>{if(byesToPlace-drawPositions.length>seedBlock.drawPositions.length)drawPositions.push(...seedBlock.drawPositions);else{const nestedDrawPositions=nestArray(chunkArray(seedBlock.drawPositions,2));let drawPosition;for(;drawPosition=popFromLargerSide(nestedDrawPositions);)drawPositions.push(drawPosition)}})),drawPositions.flat(1/0)}function popFromLargerSide(arr){if(Array.isArray(arr)&&2!==arr.length)return arr.pop();if(!Array.isArray(arr[0]))return Math.round(Math.random())?arr.pop():arr.shift();const side1=arr[0].flat(1/0).length,side2=arr[1].flat(1/0).length;return popFromLargerSide(side1===side2?arr[Math.round(Math.random())]:side1<side2?arr[1]:arr[0])}function nestArray(arr){const midPoint=Math.floor(arr.length/2);return arr.length>2?[nestArray(arr.slice(0,midPoint)),nestArray(arr.slice(midPoint))]:arr}function getSeedOrderByePositions({provisionalPositioning,relevantMatchUps,appliedPolicies,drawDefinition,seedBlockInfo,byesToPlace,structure}){var _a;seedBlockInfo||(seedBlockInfo=getValidSeedBlocks({provisionalPositioning,appliedPolicies,drawDefinition,structure}));let{validSeedBlocks,isFeedIn,isLucky,isContainer}=seedBlockInfo;(null==(_a=null==appliedPolicies?void 0:appliedPolicies.seeding)?void 0:_a.containerByesIgnoreSeeding)&&(validSeedBlocks=[]);const positionedSeeds=function getStructurePositionedSeeds({provisionalPositioning,drawDefinition,structure}){const{positionAssignments}=structureAssignedDrawPositions({structure}),{seedAssignments}=getStructureSeedAssignments({provisionalPositioning,drawDefinition,structure}),seedMap=Object.assign({},...seedAssignments.filter((assignment=>assignment.participantId)).map((assignment=>({[assignment.participantId]:assignment}))));return positionAssignments.map((assignment=>seedMap[assignment.participantId]?__spreadProps$1p(__spreadValues$2v({},assignment),{seedNumber:seedMap[assignment.participantId].seedNumber,seedValue:seedMap[assignment.participantId].seedValue}):"")).filter(Boolean)}({provisionalPositioning,drawDefinition,structure}),relevantDrawPositions=unique([].concat(...relevantMatchUps.map((matchUp=>matchUp.drawPositions)))),relevantPositionedSeeds=positionedSeeds.filter((positionedSeed=>relevantDrawPositions.includes(positionedSeed.drawPosition))),blockSortedRandomDrawPositions=getBlockSortedRandomDrawPositions({validSeedBlocks,byesToPlace}),seedValueSort=(a,b)=>getNumericSeedValue(a.seedValue)-getNumericSeedValue(b.seedValue),strictSeedOrderByePositions=getOrderedByePositions({orderedSeedDrawPositions:validSeedBlocks.reduce(((result,seedBlock)=>{const positionedSeedsInBlock=relevantPositionedSeeds.filter((positionedSeed=>{var _a2;return null==(_a2=seedBlock.drawPositions)?void 0:_a2.includes(positionedSeed.drawPosition)})).sort(seedValueSort);return result.concat(...positionedSeedsInBlock)}),[]).map((positionedSeed=>positionedSeed.drawPosition)),relevantMatchUps}).slice(0,positionedSeeds.length);return{blockSeedOrderByePositions:getOrderedByePositions({orderedSeedDrawPositions:blockSortedRandomDrawPositions,relevantMatchUps}).slice(0,positionedSeeds.length),strictSeedOrderByePositions,isContainer,isFeedIn,isLucky}}function getOrderedByePositions({orderedSeedDrawPositions,relevantMatchUps}){const consideredDrawPositionPairs=relevantMatchUps.map((matchUp=>matchUp.drawPositions)).map((pair=>null==pair?void 0:pair.sort(((a,b)=>a-b)))).filter((pair=>(null==pair?void 0:pair[0])+1===(null==pair?void 0:pair[1])));return orderedSeedDrawPositions.map((drawPosition=>consideredDrawPositionPairs.find((drawPositions=>null==drawPositions?void 0:drawPositions.includes(drawPosition))))).filter(Boolean).map((drawPositions=>null==drawPositions?void 0:drawPositions.reduce(((byePosition,drawPosition)=>orderedSeedDrawPositions.includes(drawPosition)?byePosition:drawPosition),void 0))).filter(Boolean)}var __defProp$2u=Object.defineProperty,__defProps$1o=Object.defineProperties,__getOwnPropDescs$1o=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2v=Object.getOwnPropertySymbols,__hasOwnProp$2v=Object.prototype.hasOwnProperty,__propIsEnum$2v=Object.prototype.propertyIsEnumerable,__defNormalProp$2u=(obj,key,value)=>key in obj?__defProp$2u(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2u=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2v.call(b,prop)&&__defNormalProp$2u(a,prop,b[prop]);if(__getOwnPropSymbols$2v)for(var prop of __getOwnPropSymbols$2v(b))__propIsEnum$2v.call(b,prop)&&__defNormalProp$2u(a,prop,b[prop]);return a},__spreadProps$1o=(a,b)=>__defProps$1o(a,__getOwnPropDescs$1o(b));function positionByes({provisionalPositioning,tournamentRecord,appliedPolicies,drawDefinition,seedBlockInfo,matchUpsMap,structureId,structure,seedLimit,seedsOnly,event}){var _a;structure||({structure}=findStructure({drawDefinition,structureId})),structureId||({structureId}=structure);const blockOrdered=!(structure.structures||structure.stage===QUALIFYING),{byesCount,placedByes,relevantMatchUps}=function getByesData({provisionalPositioning,drawDefinition,matchUpsMap,structure,event}){var _a;const{matchUps,roundMatchUps}=getAllStructureMatchUps({afterRecoveryTimes:!1,provisionalPositioning,drawDefinition,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap,structure,event}),firstRoundMatchUps=(null==roundMatchUps?void 0:roundMatchUps[1])||[],isRoundRobin=(null==structure?void 0:structure.structureType)===CONTAINER,relevantMatchUps=isRoundRobin?matchUps:firstRoundMatchUps,maxByes=isRoundRobin?(null==(_a=null==structure?void 0:structure.structures)?void 0:_a.length)||0:matchUps.length,{structureId,stage,stageSequence}=structure,entries=getStageEntries$1({entryStatuses:STRUCTURE_SELECTED_STATUSES,provisionalPositioning,drawDefinition,stageSequence,structureId,stage}),{qualifiersCount}=getQualifiersCount({provisionalPositioning,drawDefinition,stageSequence,structureId,stage}),entriesCount=entries.length+qualifiersCount,{positionAssignments,unassignedPositions}=structureAssignedDrawPositions({structure}),unassignedDrawPositions=unassignedPositions.map((position=>position.drawPosition)),placedByes=positionAssignments.filter((assignment=>assignment.bye)).length,placedByePositions=positionAssignments.filter((assignment=>assignment.bye)).map((assignment=>assignment.drawPosition)),positionsToAvoidDoubleBye=relevantMatchUps.map((matchUp=>matchUp.drawPositions)).filter((drawPositions=>null==drawPositions?void 0:drawPositions.reduce(((noBye,drawPosition)=>!placedByePositions.includes(drawPosition)&&noBye),!0))).flat(1/0).filter((drawPosition=>unassignedDrawPositions.includes(drawPosition)));let byesCount=positionAssignments.length-entriesCount;return byesCount>maxByes&&1===structure.stageSequence&&structure.stage!==CONSOLATION&&(byesCount=maxByes),{placedByes,byesCount,relevantMatchUps,placedByePositions,roundMatchUps,positionsToAvoidDoubleBye}}({provisionalPositioning,drawDefinition,matchUpsMap,structure,event}),byesToPlace=byesCount-placedByes;if(byesToPlace<=0)return __spreadValues$2u({},SUCCESS);const{strictSeedOrderByePositions,blockSeedOrderByePositions,isFeedIn,isLucky}=getSeedOrderByePositions({provisionalPositioning,relevantMatchUps,appliedPolicies,drawDefinition,seedBlockInfo,byesToPlace,structure}),ignoreSeededByes=[CONTAINER,ITEM].includes(structure.structureType)&&(null==(_a=null==appliedPolicies?void 0:appliedPolicies.seeding)?void 0:_a.containerByesIgnoreSeeding),seedOrderByePositions=blockOrdered&&(null==blockSeedOrderByePositions?void 0:blockSeedOrderByePositions.length)?blockSeedOrderByePositions:strictSeedOrderByePositions;let{unseededByePositions}=function getUnseededByePositions({provisionalPositioning,seedOrderByePositions,appliedPolicies,drawDefinition,seedLimit,structure,isFeedIn,isLucky}){var _a,_b;const seedingProfile=null==(_a=null==appliedPolicies?void 0:appliedPolicies.seeding)?void 0:_a.seedingProfile,isQualifying=structure.stage===QUALIFYING,{positionAssignments}=structureAssignedDrawPositions({structure}),filledDrawPositions=positionAssignments.filter((assignment=>assignment.participantId)).map((assignment=>assignment.drawPosition)),{matchUps,roundMatchUps}=getAllStructureMatchUps({provisionalPositioning,matchUpFilters:{isCollectionMatchUp:!1},structure}),firstRoundMatchUps=(null==roundMatchUps?void 0:roundMatchUps[1])||[],relevantMatchUps=structure.structureType===CONTAINER?matchUps:firstRoundMatchUps,relevantDrawPositions=unique([].concat(...relevantMatchUps.map((matchUp=>matchUp.drawPositions)))),drawPositionOffset=Math.min(...relevantDrawPositions)-1,filledRelevantDrawPositions=filledDrawPositions.filter((drawPosition=>relevantDrawPositions.includes(drawPosition))),getHalves=chunk=>{const halfLength=Math.ceil(chunk.length/2),halves=[chunk.slice(0,halfLength),chunk.slice(halfLength)],halfLengths=halves.map((half=>[].concat(...half.flat(1/0)).length)),shortLength=Math.min(...halfLengths.flat(1/0)),longLength=Math.max(...halfLengths.flat(1/0)),longIndex=halfLengths.indexOf(longLength),unequalHalves=shortLength!==longLength,shuffledHalves=shuffleArray(halves),[greaterHalf,lesserHalf]=!shortLength||unequalHalves?[halves[longIndex],halves[1-longIndex]]:[shuffledHalves[0],shuffledHalves[1]];return{greaterHalf,lesserHalf}},getNextDrawPosition=chunks=>{const{greaterHalf,lesserHalf}=getHalves(chunks),{greaterHalf:greaterQuarter,lesserHalf:lesserQuarter}=getHalves(greaterHalf),drawPosition=shuffleArray(greaterQuarter.flat(1/0)).pop();return{newlyFilteredChunks:[...lesserHalf,...lesserQuarter,greaterQuarter.flat().filter((position=>position!==drawPosition))],drawPosition}},unfilledDrawPosition=drawPosition=>!filledRelevantDrawPositions.includes(drawPosition),quarterSeparateBlock=block=>{let filteredChunks=chunkArray(block.sort(numericSort),Math.ceil(block.length/4)).map((chunk=>chunk.filter(unfilledDrawPosition)));const drawPositionCount=[].concat(...filteredChunks.flat(1/0)).length,orderedDrawPositions=[];for(let i=0;i<drawPositionCount;i++){const{newlyFilteredChunks,drawPosition}=getNextDrawPosition(filteredChunks);orderedDrawPositions.push(drawPosition),filteredChunks=newlyFilteredChunks}return orderedDrawPositions},{validSeedBlocks}=getValidSeedBlocks({provisionalPositioning,allPositions:!0,appliedPolicies,drawDefinition,structure}),validBlockDrawPositions=validSeedBlocks.map((block=>{var _a2;return null==(_a2=block.drawPositions)?void 0:_a2.map((drawPosition=>drawPosition+drawPositionOffset))}));let unfilledSeedBlocks;if(isFeedIn){const baseDrawSize=relevantDrawPositions.length,{seedBlocks}=getSeedBlocks({cluster:getSeedPattern(seedingProfile)===CLUSTER,participantsCount:baseDrawSize});unfilledSeedBlocks=seedBlocks.map((seedBlock=>seedBlock.map((drawPosition=>drawPosition+drawPositionOffset)))).map(quarterSeparateBlock).filter((block=>block.length))}else unfilledSeedBlocks=isQualifying?validBlockDrawPositions.map((block=>block.filter(unfilledDrawPosition))):validBlockDrawPositions.map(quarterSeparateBlock).filter((block=>block.length));const matchUpPairedDrawPositions=relevantMatchUps.map((matchUp=>matchUp.drawPositions)).map((pair=>null==pair?void 0:pair.sort(((a,b)=>a-b)))).filter((pair=>(null==pair?void 0:pair[0])+1===(null==pair?void 0:pair[1]))),findDrawPositionPair=drawPosition=>matchUpPairedDrawPositions.reduce(((pair,candidate)=>candidate.includes(drawPosition)?candidate.reduce(((p,c)=>c!==drawPosition?c:p),void 0):pair),void 0);let unseededByePositions=unfilledSeedBlocks.map((block=>block.map(findDrawPositionPair))).flat(1/0).filter(unfilledDrawPosition).filter((drawPosition=>!seedOrderByePositions.includes(drawPosition))).filter(Boolean);if(isQualifying){const seedingOverhang=seedLimit%4,overhangDrawPositions=unseededByePositions.slice(0,seedingOverhang),qualifierBlocksCount=null==(_b=roundMatchUps[structure.roundLimit])?void 0:_b.length,shuffledRemainder=chunkArray(unseededByePositions.slice(seedingOverhang),qualifierBlocksCount).map(shuffleArray).flat();unseededByePositions=overhangDrawPositions.concat(shuffledRemainder)}return{unseededByePositions}}({provisionalPositioning,seedOrderByePositions,ignoreSeededByes,appliedPolicies,drawDefinition,seedLimit,structure,isFeedIn,isLucky});let byePositions=[].concat(...seedOrderByePositions);if(!seedsOnly)for(;unseededByePositions.length;){const unPairedPosition=unseededByePositions.find((position=>{return c=position,(byePositions||[]).every((a=>a%2?c!==a+1:c!==a-1));var c}));unPairedPosition?(byePositions.push(unPairedPosition),unseededByePositions=unseededByePositions.filter((position=>position!==unPairedPosition))):(byePositions.push(...unseededByePositions),unseededByePositions=[])}ignoreSeededByes&&(byePositions=shuffleArray(byePositions),getDevContext({ignoreSeededByes})&&console.log({byePositions}));const byeDrawPositions=byePositions.slice(0,byesToPlace);for(const drawPosition of byeDrawPositions){const result=assignDrawPositionBye$1({provisionalPositioning,tournamentRecord,drawDefinition,seedBlockInfo,drawPosition,matchUpsMap,structureId,structure,event});if(null==result?void 0:result.error)return result}return __spreadProps$1o(__spreadValues$2u({},SUCCESS),{unseededByePositions,byeDrawPositions})}var __defProp$2t=Object.defineProperty,__defProps$1n=Object.defineProperties,__getOwnPropDescs$1n=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2u=Object.getOwnPropertySymbols,__hasOwnProp$2u=Object.prototype.hasOwnProperty,__propIsEnum$2u=Object.prototype.propertyIsEnumerable,__defNormalProp$2t=(obj,key,value)=>key in obj?__defProp$2t(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2t=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2u.call(b,prop)&&__defNormalProp$2t(a,prop,b[prop]);if(__getOwnPropSymbols$2u)for(var prop of __getOwnPropSymbols$2u(b))__propIsEnum$2u.call(b,prop)&&__defNormalProp$2t(a,prop,b[prop]);return a},__spreadProps$1n=(a,b)=>__defProps$1n(a,__getOwnPropDescs$1n(b));function positionQualifiers(params){let{structure,structureId}=params;structure||({structure}=findStructure(params)),structureId||({structureId}=structure);let stack="positionQualifiers";const qualifierDrawPositions=[];if(structure.stage===CONSOLATION)return decorateResult({result:{error:INVALID_STAGE},stack});const{unplacedRoundQualifierCounts,positionAssignments,roundDrawPositions}=function getQualifiersData({drawDefinition,structure,structureId}){structure||({structure}=findStructure({drawDefinition,structureId}));structureId||({structureId}=structure);const{positionAssignments}=structureAssignedDrawPositions({structure}),{stage,stageSequence}=structure,{qualifiersCount,roundQualifiersCounts}=getQualifiersCount({drawDefinition,stageSequence,structureId,stage}),targetRoundNumbers=Object.keys(roundQualifiersCounts),{matchUps}=getAllStructureMatchUps({structure}),{roundProfile}=getRoundMatchUps$1({matchUps}),roundDrawPositions=Object.assign({},...targetRoundNumbers.filter((roundNumber=>roundProfile[roundNumber])).map((roundNumber=>{var _a;return{[roundNumber]:null==(_a=roundProfile[roundNumber])?void 0:_a.drawPositions.filter(Boolean)}}))),assignedQualifierPositions=positionAssignments.filter((assignment=>assignment.qualifier)).map((assignment=>assignment.drawPosition)),unplacedQualifiersCount=qualifiersCount-assignedQualifierPositions.length,placedQualifiersCount=assignedQualifierPositions.length,unplacedRoundQualifierCounts=Object.assign({},...targetRoundNumbers.map((roundNumber=>{const assignedQualifierPositions2=positionAssignments.filter((assignment=>{var _a,_b;return assignment.qualifier&&(null==(_b=null==(_a=roundDrawPositions[roundNumber])?void 0:_a.drawPositions)?void 0:_b.includes(assignment.drawPosition))})).map((assignment=>assignment.drawPosition));return{[roundNumber]:roundQualifiersCounts[roundNumber]-assignedQualifierPositions2.length}})));return{unplacedRoundQualifierCounts,unplacedQualifiersCount,placedQualifiersCount,roundQualifiersCounts,positionAssignments,roundDrawPositions,qualifiersCount}}(params);for(const roundNumber of Object.keys(unplacedRoundQualifierCounts)){const unfilledDrawPositions=positionAssignments.filter((assignment=>roundDrawPositions[roundNumber].includes(assignment.drawPosition)&&!assignment.participantId&&!assignment.qualifier&&!assignment.bye)).map((assignment=>assignment.drawPosition));if(unplacedRoundQualifierCounts[roundNumber]>unfilledDrawPositions)return decorateResult({result:{error:NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS},context:{unfilledDrawPositions},stack});generateRange(0,unplacedRoundQualifierCounts[roundNumber]).forEach((()=>{const drawPosition=randomPop(unfilledDrawPositions);qualifierDrawPositions.push(drawPosition),positionAssignments.forEach((assignment=>{assignment.drawPosition===drawPosition&&(assignment.qualifier=!0,delete assignment.participantId,delete assignment.bye)}))}))}return __spreadProps$1n(__spreadValues$2t({},SUCCESS),{qualifierDrawPositions})}var __defProp$2s=Object.defineProperty,__defProps$1m=Object.defineProperties,__getOwnPropDescs$1m=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2t=Object.getOwnPropertySymbols,__hasOwnProp$2t=Object.prototype.hasOwnProperty,__propIsEnum$2t=Object.prototype.propertyIsEnumerable,__defNormalProp$2s=(obj,key,value)=>key in obj?__defProp$2s(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2s=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2t.call(b,prop)&&__defNormalProp$2s(a,prop,b[prop]);if(__getOwnPropSymbols$2t)for(var prop of __getOwnPropSymbols$2t(b))__propIsEnum$2t.call(b,prop)&&__defNormalProp$2s(a,prop,b[prop]);return a},__spreadProps$1m=(a,b)=>__defProps$1m(a,__getOwnPropDescs$1m(b));function positionSeedBlocks({provisionalPositioning,inContextDrawMatchUps,tournamentRecord,appliedPolicies,validSeedBlocks,drawDefinition,seedingProfile,seedBlockInfo,participants,groupsCount,structureId,matchUpsMap,structure,event}){let placedSeedBlocks=0;const seedPositions=[],errors=[];if(structure||({structure}=findStructure({drawDefinition,structureId})),structureId||({structureId}=structure),appliedPolicies||(appliedPolicies=getAppliedPolicies({drawDefinition}).appliedPolicies),!validSeedBlocks){const result=getValidSeedBlocks({provisionalPositioning,appliedPolicies,drawDefinition,structure});result.error&&errors.push(result.error),validSeedBlocks=result.validSeedBlocks}return generateRange(0,groupsCount=groupsCount||validSeedBlocks.length).forEach((()=>{if(placedSeedBlocks<groupsCount){const result=function positionSeedBlock({provisionalPositioning,inContextDrawMatchUps,tournamentRecord,drawDefinition,seedingProfile,seedBlockInfo,participants,structureId,matchUpsMap,event}){const{unplacedSeedParticipantIds,unfilledPositions}=getNextSeedBlock({provisionalPositioning,randomize:!0,drawDefinition,seedBlockInfo,structureId}),{appliedPolicies}=getAppliedPolicies({drawDefinition}),{avoidance}=appliedPolicies||{};avoidance&&participants&&(null==unplacedSeedParticipantIds||unplacedSeedParticipantIds.length);const seedPositions=[];for(const participantId of unplacedSeedParticipantIds){const drawPosition=unfilledPositions.pop();if(!drawPosition)return{error:MISSING_DRAW_POSITION};seedPositions.push(drawPosition);const result=assignDrawPosition$1({automaticPlacement:!0,provisionalPositioning,inContextDrawMatchUps,tournamentRecord,drawDefinition,seedingProfile,participantId,seedBlockInfo,drawPosition,matchUpsMap,structureId,event});if(!result.success)return result}return __spreadProps$1m(__spreadValues$2s({},SUCCESS),{seedPositions})}({provisionalPositioning,inContextDrawMatchUps,tournamentRecord,validSeedBlocks,drawDefinition,seedingProfile,seedBlockInfo,participants,structureId,matchUpsMap,event});(null==result?void 0:result.success)&&(placedSeedBlocks++,seedPositions.push(...result.seedPositions)),result.error&&errors.push({seedPositionError:result.error})}})),errors.length?{error:errors}:__spreadProps$1m(__spreadValues$2s({},SUCCESS),{seedPositions})}var __defProp$2r=Object.defineProperty,__defProps$1l=Object.defineProperties,__getOwnPropDescs$1l=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2s=Object.getOwnPropertySymbols,__hasOwnProp$2s=Object.prototype.hasOwnProperty,__propIsEnum$2s=Object.prototype.propertyIsEnumerable,__defNormalProp$2r=(obj,key,value)=>key in obj?__defProp$2r(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2r=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2s.call(b,prop)&&__defNormalProp$2r(a,prop,b[prop]);if(__getOwnPropSymbols$2s)for(var prop of __getOwnPropSymbols$2s(b))__propIsEnum$2s.call(b,prop)&&__defNormalProp$2r(a,prop,b[prop]);return a},__spreadProps$1l=(a,b)=>__defProps$1l(a,__getOwnPropDescs$1l(b));function automatedPositioning$1({applyPositioning=!0,provisionalPositioning,inContextDrawMatchUps,multipleStructures,placeByes=!0,tournamentRecord,appliedPolicies,candidatesCount,drawDefinition,seedingProfile,participants,structureId,matchUpsMap,seedLimit,seedsOnly,drawType,event}){var _a;const positioningReport=[];applyPositioning||(!function disableNotifications(){_globalStateProvider.disableNotifications()}(),drawDefinition=makeDeepCopy(drawDefinition,!1,!0));const handleErrorCondition=result2=>(applyPositioning||enableNotifications(),decorateResult({result:result2,stack:"automatedPositioning"}));let result=findStructure({drawDefinition,structureId});if(result.error)return handleErrorCondition(result);const{structure}=result;appliedPolicies||(appliedPolicies=null==(_a=getAppliedPolicies({drawDefinition,structure,event}))?void 0:_a.appliedPolicies);const{qualifiersCount}=getQualifiersCount({stageSequence:structure.stageSequence,provisionalPositioning,stage:structure.stage,drawDefinition,structureId}),entryStatuses=DIRECT_ENTRY_STATUSES,entries=getStageEntries$1({stageSequence:structure.stageSequence,provisionalPositioning,stage:structure.stage,drawDefinition,entryStatuses,structureId});if(!(null==entries?void 0:entries.length)&&!qualifiersCount)return result2=__spreadValues$2r({},SUCCESS),applyPositioning||enableNotifications(),result2;var result2;matchUpsMap=matchUpsMap||getMatchUpsMap({drawDefinition}),inContextDrawMatchUps||({matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap}));let unseededByePositions=[];const seedBlockInfo=getValidSeedBlocks({provisionalPositioning,appliedPolicies,drawDefinition,structure});if(seedBlockInfo.error)return seedBlockInfo;const{validSeedBlocks}=seedBlockInfo;if(positioningReport.push({validSeedBlocks}),getSeedPattern(structure.seedingProfile||seedingProfile)===WATERFALL){let result2=placeByes&&positionByes({provisionalPositioning,tournamentRecord,appliedPolicies,drawDefinition,seedBlockInfo,matchUpsMap,structure,seedLimit,seedsOnly,event});if(null==result2?void 0:result2.error)return handleErrorCondition(result2);if(unseededByePositions=result2.unseededByePositions,positioningReport.push({action:"positionByes",unseededByePositions}),result2=positionSeedBlocks({seedingProfile:structure.seedingProfile||seedingProfile,provisionalPositioning,inContextDrawMatchUps,tournamentRecord,appliedPolicies,validSeedBlocks,drawDefinition,seedBlockInfo,participants,matchUpsMap,structure,event}),result2.error)return handleErrorCondition(result2);positioningReport.push({action:"positionSeedBlocks",seedPositions:result2.seedPositions})}else{if(drawType!==LUCKY_DRAW){let result3=positionSeedBlocks({seedingProfile:structure.seedingProfile||seedingProfile,provisionalPositioning,inContextDrawMatchUps,tournamentRecord,appliedPolicies,validSeedBlocks,drawDefinition,seedBlockInfo,participants,matchUpsMap,structure,event});if(result3.error)return handleErrorCondition(result3);positioningReport.push({action:"positionSeedBlocks",seedPositions:result3.seedPositions})}const result2=placeByes&&positionByes({provisionalPositioning,inContextDrawMatchUps,tournamentRecord,appliedPolicies,drawDefinition,seedBlockInfo,matchUpsMap,structure,seedLimit,seedsOnly,event});if(null==result2?void 0:result2.error)return console.log("positionByes",{result:result2}),handleErrorCondition(result2);unseededByePositions=result2.unseededByePositions,positioningReport.push({action:"positionByes",byeDrawPositions:result2.byeDrawPositions,unseededByePositions})}const conflicts={};if(!seedsOnly){let result2=positionQualifiers({inContextDrawMatchUps,tournamentRecord,appliedPolicies,validSeedBlocks,drawDefinition,seedBlockInfo,participants,matchUpsMap,structure});if(result2.error)return handleErrorCondition(result2);if(result2.conflicts&&(conflicts.qualifierConflicts=result2.conflicts),positioningReport.push({action:"positionQualifiers",qualifierDrawPositions:result2.qualifierDrawPositions}),result2=positionUnseededParticipants({provisionalPositioning,inContextDrawMatchUps,unseededByePositions,multipleStructures,tournamentRecord,appliedPolicies,validSeedBlocks,candidatesCount,drawDefinition,seedBlockInfo,participants,matchUpsMap,structure,event}),result2.error)return handleErrorCondition(result2);result2.conflicts&&(conflicts.unseededConflicts=result2.conflicts),positioningReport.push({action:"positionUnseededParticipants"})}const{positionAssignments}=getPositionAssignments$1({drawDefinition,structure});return modifyDrawNotice({drawDefinition,structureIds:[structureId]}),applyPositioning||enableNotifications(),__spreadProps$1l(__spreadValues$2r({positionAssignments,conflicts},SUCCESS),{positioningReport})}var __defProp$2q=Object.defineProperty,__defProps$1k=Object.defineProperties,__getOwnPropDescs$1k=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2r=Object.getOwnPropertySymbols,__hasOwnProp$2r=Object.prototype.hasOwnProperty,__propIsEnum$2r=Object.prototype.propertyIsEnumerable,__defNormalProp$2q=(obj,key,value)=>key in obj?__defProp$2q(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2q=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2r.call(b,prop)&&__defNormalProp$2q(a,prop,b[prop]);if(__getOwnPropSymbols$2r)for(var prop of __getOwnPropSymbols$2r(b))__propIsEnum$2r.call(b,prop)&&__defNormalProp$2q(a,prop,b[prop]);return a},__spreadProps$1k=(a,b)=>__defProps$1k(a,__getOwnPropDescs$1k(b));function automatedPlayoffPositioning({applyPositioning=!0,provisionalPositioning,candidatesCount=1,tournamentRecord,drawDefinition,seedingProfile,structureId,placeByes,seedsOnly,event}){if(!event)return{error:EVENT_NOT_FOUND};if(!drawDefinition)return{error:DRAW_DEFINITION_NOT_FOUND};if(!isCompletedStructure({drawDefinition,structureId})&&!provisionalPositioning)return{error:INCOMPLETE_SOURCE_STRUCTURE};const{playoffStructures}=getPlayoffStructures({drawDefinition,structureId}),structurePositionAssignments=[],participants=null==tournamentRecord?void 0:tournamentRecord.participants;if(playoffStructures)for(const structure of playoffStructures){const{structureId:playoffStructureId}=structure,result=automatedPositioning$1({structureId:playoffStructureId,provisionalPositioning,applyPositioning,candidatesCount,drawDefinition,seedingProfile,participants,placeByes,seedsOnly});if(result.error)return result;result.positionAssignments&&structurePositionAssignments.push({positionAssignments:result.positionAssignments,structureId:playoffStructureId})}return __spreadProps$1k(__spreadValues$2q({},SUCCESS),{structurePositionAssignments})}var __defProp$2p=Object.defineProperty,__getOwnPropSymbols$2q=Object.getOwnPropertySymbols,__hasOwnProp$2q=Object.prototype.hasOwnProperty,__propIsEnum$2q=Object.prototype.propertyIsEnumerable,__defNormalProp$2p=(obj,key,value)=>key in obj?__defProp$2p(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2p=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2q.call(b,prop)&&__defNormalProp$2p(a,prop,b[prop]);if(__getOwnPropSymbols$2q)for(var prop of __getOwnPropSymbols$2q(b))__propIsEnum$2q.call(b,prop)&&__defNormalProp$2p(a,prop,b[prop]);return a};function getStructureRoundProfile({drawDefinition,structureId}){const result=findStructure({drawDefinition,structureId});if(result.error)return result;const{matchUps}=getAllStructureMatchUps({structure:result.structure});return getRoundMatchUps$1({matchUps})}function getFinishingPositionSourceRoundsMap({finishingPositions,drawDefinition,structureId}){const{roundProfile}=getStructureRoundProfile({drawDefinition,structureId});return Object.keys(roundProfile).reduce(((sourceRounds,roundNumber)=>(roundValues(roundProfile[roundNumber]).forEach((rangeDefinition=>{finishingPositions.forEach((position=>{(function positionIsInRange({position,rangeDefinition}){if(!Array.isArray(rangeDefinition))return!1;if(rangeDefinition.reduce(((includesNonInteger,i)=>includesNonInteger||isNaN(i)),!1))return!1;const[min,max]=rangeDefinition;return generateRange(min,(max||min)+1).includes(position)})({position,rangeDefinition})&&(sourceRounds[position]={roundNumber})}))})),sourceRounds)),{})}function roundValues(values){var _a,_b;return[unique((null==(_a=null==values?void 0:values.finishingPositionRange)?void 0:_a.loser)||[]),unique((null==(_b=null==values?void 0:values.finishingPositionRange)?void 0:_b.winner)||[])]}function getPositionsPlayedOff({drawDefinition,structureIds}){if(structureIds&&!Array.isArray(structureIds))return{error:INVALID_VALUES,context:{structureIds}};if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const allFinishingPositionRanges=(structureIds=structureIds||(drawDefinition.structures||[]).filter((structure=>structure.structureType!==QUALIFYING)).map((({structureId})=>structureId))).map((structureId=>{const{roundProfile}=getStructureRoundProfile({drawDefinition,structureId});return Object.values(roundProfile).map(roundValues).flat()})).flat(),positionsPlayedOff=allFinishingPositionRanges.filter((positionRange=>1===positionRange.length)).sort(numericSort).flat(),allRangeValues=allFinishingPositionRanges.flat();return{positionsNotPlayedOff:generateRange(Math.min(...allRangeValues),Math.max(...allRangeValues)+1).filter((position=>!positionsPlayedOff.includes(position))),positionsPlayedOff}}var __defProp$2o=Object.defineProperty,__defProps$1j=Object.defineProperties,__getOwnPropDescs$1j=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2p=Object.getOwnPropertySymbols,__hasOwnProp$2p=Object.prototype.hasOwnProperty,__propIsEnum$2p=Object.prototype.propertyIsEnumerable,__defNormalProp$2o=(obj,key,value)=>key in obj?__defProp$2o(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2o=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2p.call(b,prop)&&__defNormalProp$2o(a,prop,b[prop]);if(__getOwnPropSymbols$2p)for(var prop of __getOwnPropSymbols$2p(b))__propIsEnum$2p.call(b,prop)&&__defNormalProp$2o(a,prop,b[prop]);return a},__spreadProps$1j=(a,b)=>__defProps$1j(a,__getOwnPropDescs$1j(b));function getEligibleVoluntaryConsolationParticipants$1({excludedMatchUpStatuses=[],includeEventParticipants,includeQualifyingStage,finishingRoundLimit,policyDefinitions,roundNumberLimit,tournamentRecord,drawDefinition,matchUpsLimit,allEntries,requirePlay,requireLoss,winsLimit,event}){var _a,_b,_c,_d;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const stages=[MAIN,PLAY_OFF];includeQualifyingStage&&stages.push(QUALIFYING);const matchUps=includeEventParticipants?(null==(_a=allEventMatchUps({contextFilters:{stages},matchUpFilters:{matchUpTypes:[event.eventType]},tournamentRecord,inContext:!0,event}))?void 0:_a.matchUps)||[]:(null==(_b=allDrawMatchUps$1({contextFilters:{stages},matchUpFilters:{matchUpTypes:[event.eventType]},tournamentRecord,inContext:!0,drawDefinition}))?void 0:_b.matchUps)||[],voluntaryConsolationEntryIds=getStageEntries$1({stage:VOLUNTARY_CONSOLATION,drawDefinition}).map((({participantId})=>participantId)),participantMatchUps={},losingParticipants={},matchUpParticipants={},participantWins={},policy=(policyDefinitions=policyDefinitions||getPolicyDefinitions({policyTypes:[POLICY_TYPE_VOLUNTARY_CONSOLATION],tournamentRecord,drawDefinition,event}))[POLICY_TYPE_VOLUNTARY_CONSOLATION];excludedMatchUpStatuses=excludedMatchUpStatuses.length&&excludedMatchUpStatuses||(null==policy?void 0:policy.excludedMatchUpStatuses)||[],includeEventParticipants=void 0!==includeEventParticipants?includeEventParticipants:null==policy?void 0:policy.includeEventParticipants,allEntries=void 0!==allEntries?allEntries:null==policy?void 0:policy.allEntries,finishingRoundLimit=finishingRoundLimit||(null==policy?void 0:policy.finishingRoundLimit),roundNumberLimit=roundNumberLimit||(null==policy?void 0:policy.roundNumberLimit),matchUpsLimit=matchUpsLimit||(null==policy?void 0:policy.matchUpsLimit),requirePlay=!1!==requirePlay&&(void 0===(null==policy?void 0:policy.requirePlay)||policy.requirePlay),requireLoss=!1!==requireLoss&&(void 0===(null==policy?void 0:policy.requireLoss)||policy.requireLoss),winsLimit=winsLimit||(null==policy?void 0:policy.winsLimit);for(const matchUp of matchUps){if(requirePlay&&![1,2].includes(matchUp.winningSide)&&!matchUp.matchUpStatus===DOUBLE_WALKOVER)continue;if(!isNaN(finishingRoundLimit)&&matchUp.finishingRound>=finishingRoundLimit)continue;if(!isNaN(roundNumberLimit)&&matchUp.finishingRound<=roundNumberLimit)continue;const losingSide=null==(_c=matchUp.sides)?void 0:_c.find((({sideNumber})=>sideNumber===3-matchUp.winningSide)),winningSide=null==(_d=matchUp.sides)?void 0:_d.find((({sideNumber})=>sideNumber===matchUp.winningSide));if(matchUp.sides.forEach((side=>{var _a2;const participantId=null==(_a2=null==side?void 0:side.participant)?void 0:_a2.participantId;participantId&&(matchUpParticipants[participantId]=side.participant,matchUp.matchUpStatus!==DOUBLE_WALKOVER||requirePlay||(losingParticipants[participantId]=side.participant,participantMatchUps[participantId]||(participantMatchUps[participantId]=0),excludedMatchUpStatuses.includes(matchUp.matchUpStatus)||(participantMatchUps[participantId]+=1)))})),null==losingSide?void 0:losingSide.participant){const participantId=losingSide.participant.participantId;losingParticipants[participantId]=losingSide.participant,participantMatchUps[participantId]||(participantMatchUps[participantId]=0),excludedMatchUpStatuses.includes(matchUp.matchUpStatus)||(participantMatchUps[participantId]+=1)}if(null==winningSide?void 0:winningSide.participant){const participantId=winningSide.participant.participantId;participantWins[participantId]||(participantWins[participantId]=0),participantWins[participantId]+=1,participantMatchUps[participantId]||(participantMatchUps[participantId]=0),excludedMatchUpStatuses.includes(matchUp.matchUpStatus)||(participantMatchUps[participantId]+=1)}}const considerEntered=(null==tournamentRecord?void 0:tournamentRecord.participants)&&!requirePlay&&!requireLoss&&allEntries,enteredParticipantIds=considerEntered&&(includeEventParticipants&&event?event.entries:drawDefinition.entries).filter((entry=>![WITHDRAWN,UNGROUPED].includes(entry.entryStatus))).map((({participantId})=>participantId)),losingParticipantIds=Object.keys(losingParticipants),consideredParticipants=considerEntered?null==tournamentRecord?void 0:tournamentRecord.participants.filter((({participantId})=>enteredParticipantIds.includes(participantId))):Object.values(requireLoss?losingParticipants:matchUpParticipants),eligibleParticipants=consideredParticipants.filter((({participantId})=>(participantId=>!requireLoss||losingParticipantIds.includes(participantId))(participantId)&&(participantId=>!requirePlay||(participantMatchUps[participantId]||0)>=0)(participantId)&&(participantId=>isNaN(winsLimit)||(participantWins[participantId]||0)<=winsLimit)(participantId)&&(participantId=>!matchUpsLimit||participantMatchUps[participantId]<=matchUpsLimit)(participantId)&&(participantId=>!voluntaryConsolationEntryIds.includes(participantId))(participantId))).map((participant=>{var _a2;return __spreadProps$1j(__spreadValues$2o({},participant),{individualParticipants:null==(_a2=participant.individualParticipantIds)?void 0:_a2.map((participantId=>{var _a3;return null==(_a3=tournamentRecord.participants)?void 0:_a3.find((individual=>individual.participantId===participantId))}))})}));return __spreadValues$2o({eligibleParticipants,losingParticipantIds},SUCCESS)}function generateSeedingScaleItems({scaleAttributes,scaledEntries,stageEntries,seedsCount,scaleName}){if(!scaleAttributes)return{error:MISSING_VALUE,info:"missing scaleAttributes"};const seededEntries=Object.assign({},...(scaledEntries||[]).slice(0,seedsCount).map((({participantId},index)=>({[participantId]:index+1}))));scaleName=scaleName||scaleAttributes.scaleName;const scaleDate=(new Date).toISOString();return{scaleItemsWithParticipantIds:stageEntries.map((({participantId})=>({participantId,scaleItems:[{scaleValue:seededEntries[participantId],eventType:scaleAttributes.eventType,scaleType:SEEDING$1,scaleName,scaleDate}]})))}}function getEliminationDrawSize({participantCount}){if(!participantCount)return{error:INVALID_VALUES};const drawSize=nextPowerOf2(participantCount);return drawSize?{drawSize}:decorateResult({result:{error:INVALID_VALUES},stack:"getEliminationDrawSize",context:{participantCount}})}function getStageEntries({selected=!0,drawDefinition,entryStatuses,drawId,event,stage}){var _a;let entries=event.entries||[];if(drawId){const{flightProfile}=getFlightProfile({event}),flight=null==(_a=null==flightProfile?void 0:flightProfile.flights)?void 0:_a.find((flight2=>flight2.drawId===drawId));entries=flight?flight.drawEntries:null==drawDefinition?void 0:drawDefinition.entries}const stageEntries=entries.filter((entry=>(!(null==entryStatuses?void 0:entryStatuses.length)||!entry.entryStatus||entryStatuses.includes(entry.entryStatus))&&(!stage||!entry.entryStage||entry.entryStage===stage)&&(!selected||STRUCTURE_SELECTED_STATUSES.includes(entry.entryStatus))));return{entries,stageEntries}}function getSeedsCount({requireParticipantCount=!0,drawSizeProgression=!1,policyDefinitions,participantCount,tournamentRecord,drawDefinition,drawSize,event}={}){const stack="getSeedsCount";if(!policyDefinitions){const result=getPolicyDefinitions({tournamentRecord,drawDefinition,event});if(result.error)return decorateResult({result,stack});policyDefinitions=result.policyDefinitions}const validParticpantCount=isConvertableInteger(participantCount);if(participantCount&&!validParticpantCount)return decorateResult({result:{error:INVALID_VALUES},context:{participantCount},stack});if(requireParticipantCount&&!validParticpantCount)return decorateResult({result:{error:MISSING_PARTICIPANT_COUNT},stack});if(isNaN(drawSize)){if(!participantCount)return decorateResult({result:{error:MISSING_DRAW_SIZE},stack});({drawSize}=getEliminationDrawSize({participantCount}))}if((requireParticipantCount&&participantCount||drawSize)>drawSize)return{error:PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE};const policy=policyDefinitions[POLICY_TYPE_SEEDING];if(!policy)return{error:INVALID_POLICY_DEFINITION};const seedsCountThresholds=policy.seedsCountThresholds;if(!seedsCountThresholds)return{error:MISSING_SEEDCOUNT_THRESHOLDS};void 0!==policy.drawSizeProgression&&(drawSizeProgression=policy.drawSizeProgression);return{seedsCount:seedsCountThresholds.filter((threshold=>drawSizeProgression?threshold.drawSize<=drawSize:drawSize===threshold.drawSize)).reduce(((seedsCount2,threshold)=>participantCount>=threshold.minimumParticipantCount?threshold.seedsCount:seedsCount2),0)}}function getEntriesAndSeedsCount({policyDefinitions,drawDefinition,drawSize,drawId,event,stage}){if(!event)return{error:MISSING_EVENT};const{entries,stageEntries}=getStageEntries({drawDefinition,drawId,stage,event}),participantCount=stageEntries.length,{drawSize:eliminationDrawSize}=getEliminationDrawSize({participantCount}),result=getSeedsCount({drawSize:drawSize||eliminationDrawSize,policyDefinitions,participantCount});if(result.error)return decorateResult({result,stack:"getEntriesAndSeedsCount"});const{seedsCount}=result;return{entries,seedsCount,stageEntries}}function getSourceStructureIdsAndRelevantLinks({finishingPosition,targetRoundNumber,drawDefinition,structureId,linkType}){const{links}=getStructureLinks({drawDefinition,structureId})||{},relevantLinks=((null==links?void 0:links.target)||[]).filter((({linkType:structureLinkType})=>structureLinkType===linkType)).filter((({target})=>!targetRoundNumber||targetRoundNumber===target.roundNumber)).map((link=>{const sourceStructureId=link.source.structureId,{structure:sourceStructure}=findStructure({structureId:sourceStructureId,drawDefinition});if(!finishingPosition||sourceStructure.finishingPosition===finishingPosition)return link})).filter(Boolean);return{sourceStructureIds:relevantLinks.map((({source})=>source.structureId)),relevantLinks}}function getAssignedParticipantIds({drawDefinition,stages}){return((null==drawDefinition?void 0:drawDefinition.structures)||[]).filter((structure=>!(null==stages?void 0:stages.length)||stages.includes(structure.stage))).map((structure=>{const{positionAssignments}=getPositionAssignments$1({structure});return getParticipantIds(positionAssignments)})).flat()}function validAssignmentsSort(a,b){return a.bye||getNumericSeedValue(a.seedValue)<getNumericSeedValue(b.seedValue)||a.seedValue&&!b.seedValue?-1:(a.seedNumber||0)-(b.seedNumber||0)}var __defProp$2n=Object.defineProperty,__defProps$1i=Object.defineProperties,__getOwnPropDescs$1i=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2o=Object.getOwnPropertySymbols,__hasOwnProp$2o=Object.prototype.hasOwnProperty,__propIsEnum$2o=Object.prototype.propertyIsEnumerable,__defNormalProp$2n=(obj,key,value)=>key in obj?__defProp$2n(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2n=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2o.call(b,prop)&&__defNormalProp$2n(a,prop,b[prop]);if(__getOwnPropSymbols$2o)for(var prop of __getOwnPropSymbols$2o(b))__propIsEnum$2o.call(b,prop)&&__defNormalProp$2n(a,prop,b[prop]);return a},__spreadProps$1i=(a,b)=>__defProps$1i(a,__getOwnPropDescs$1i(b));function getValidSwapAction({onlyAssignedPositions=!0,possiblyDisablingAction,tournamentParticipants,inactiveDrawPositions,activeDrawPositions,positionAssignments,returnParticipants,byeDrawPositions,drawDefinition,isByePosition,drawPosition,structureId,structure,drawId,event}){if(activeDrawPositions.includes(drawPosition))return{};const availableDrawPositions=null==inactiveDrawPositions?void 0:inactiveDrawPositions.filter((position=>position!==drawPosition&&!(isByePosition&&byeDrawPositions.includes(position)))),filteredAssignments=(null==positionAssignments?void 0:positionAssignments.filter((assignment=>(assignment=>!onlyAssignedPositions||assignment.participantId||assignment.qualifier||assignment.bye)(assignment)&&(null==availableDrawPositions?void 0:availableDrawPositions.includes(assignment.drawPosition)))))||[],filteredDrawPositions=filteredAssignments.map((({drawPosition:drawPosition2})=>drawPosition2)),{matchUps}=getAllStructureMatchUps({afterRecoveryTimes:!1,inContext:!0,drawDefinition,structure,event}),relevantMatchUps=matchUps.filter((({drawPositions})=>overlap(drawPositions,filteredDrawPositions))),sourceDrawPositionRangeMap=Object.assign({},...relevantMatchUps.map((matchUp=>{var _a;return null==(_a=matchUp.sides)?void 0:_a.filter((({sourceDrawPositionRange})=>sourceDrawPositionRange)).map((({drawPosition:drawPosition2,sourceDrawPositionRange})=>({[drawPosition2]:sourceDrawPositionRange})))})).flat()),availableParticipantIds=filteredAssignments.map((assignment=>assignment.participantId)).filter(Boolean),participantsAvailable=(tournamentParticipants||[]).filter((participant=>availableParticipantIds.includes(participant.participantId))),availableParticipantsMap=Object.assign({},...participantsAvailable.map((participant=>({[participant.participantId]:participant})))),availableAssignments=filteredAssignments.map((assignment=>{const participant=availableParticipantsMap&&availableParticipantsMap[assignment.participantId],sourceDrawPositionRange=sourceDrawPositionRangeMap[assignment.drawPosition];return definedAttributes(__spreadProps$1i(__spreadValues$2n({},assignment),{participant:returnParticipants?makeDeepCopy(participant,!1,!0):void 0,sourceDrawPositionRange}))}));if(availableAssignments.length){return{validSwapAction:{payload:{drawId,structureId,drawPositions:[drawPosition]},willDisableLinks:possiblyDisablingAction,method:SWAP_PARTICIPANT_METHOD,type:SWAP_PARTICIPANTS,availableAssignments}}}return{}}function positionActions$1(params){const{policyDefinitions:specifiedPolicyDefinitions,tournamentParticipants=[],returnParticipants=!0,provisionalPositioning,tournamentRecord,drawDefinition,drawPosition,event}=params;if(!event)return{error:MISSING_EVENT};if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!params.structureId)return{error:MISSING_STRUCTURE_ID};let result=findStructure({structureId:params.structureId,drawDefinition});if(result.error)return result;const structure=result.containingStructure||result.structure,structureId=structure.structureId;if(result=getStructureDrawPositionProfiles({tournamentRecord,drawDefinition,structureId}),void 0===drawPosition&&!result.isAdHoc)return{error:MISSING_DRAW_POSITION};if(result.isAdHoc)return matchUpActions$2(params);if(result.error)return result;const{drawPositionInitialRounds,qualifyingDrawPositions,inactiveDrawPositions,activeDrawPositions,byeDrawPositions}=result,{appliedPolicies}=getAppliedPolicies({tournamentRecord,drawDefinition,structure,event});Object.assign(appliedPolicies,specifiedPolicyDefinitions||{});const{actionsPolicy:positionActionsPolicy,enabledStructures,actionsDisabled}=getEnabledStructures({actionType:POSITION_ACTION,appliedPolicies,drawDefinition,structure}),activePositionOverrides=(null==positionActionsPolicy?void 0:positionActionsPolicy.activePositionOverrides)||[],{sourceStructureIds:positionSourceStructureIds}=getSourceStructureIdsAndRelevantLinks({finishingPosition:WIN_RATIO,targetRoundNumber:1,linkType:POSITION,drawDefinition,structureId})||{};let sourceStructuresCompleted;(null==positionSourceStructureIds?void 0:positionSourceStructureIds.length)&&(sourceStructuresCompleted=positionSourceStructureIds.reduce(((ready,sourceStructureId)=>isCompletedStructure({structureId:sourceStructureId,drawDefinition})&&ready),!0));const isWinRatioFedStructure=positionSourceStructureIds.length,disablePlacementActions=positionSourceStructureIds.length&&!sourceStructuresCompleted,{policyActions}=getPolicyActions({enabledStructures,drawDefinition,structure}),possiblyDisablingAction=![QUALIFYING,MAIN].includes(structure.stage)||1!==structure.stageSequence,{drawId}=drawDefinition,validActions=[],{assignedPositions,positionAssignments}=structureAssignedDrawPositions({structure}),positionAssignment=assignedPositions.find((assignment=>assignment.drawPosition===drawPosition)),drawPositions=positionAssignments.map((assignment=>assignment.drawPosition));if(!(null==drawPositions?void 0:drawPositions.includes(drawPosition)))return{error:INVALID_DRAW_POSITION};const{stage,stageSequence}=structure,stages=[stage];stage===CONSOLATION&&stages.push(MAIN),stage===MAIN&&stages.push(CONSOLATION);const stageEntries=getStageEntries$1({entryStatuses:DIRECT_ENTRY_STATUSES,provisionalPositioning,drawDefinition,stageSequence,structureId,stages}),stageAssignedParticipantIds=getAssignedParticipantIds({drawDefinition,stages}),unassignedParticipantIds=stageEntries.filter((entry=>!stageAssignedParticipantIds.includes(entry.participantId))).map((entry=>entry.participantId)),isByePosition=byeDrawPositions.includes(drawPosition),isQualifierPosition=qualifyingDrawPositions.includes(drawPosition),isActiveDrawPosition=activeDrawPositions.includes(drawPosition);if(actionsDisabled)return{info:"Actions Disabled for structure",isByePosition,isActiveDrawPosition,isDrawPosition:!0,hasPositionAssigned:!!positionAssignment,validActions:[]};if(isAvailableAction({policyActions,action:ASSIGN_PARTICIPANT})&&!isActiveDrawPosition&&!disablePlacementActions&&(!positionAssignment||isByePosition)){const{validAssignmentActions}=function getValidAssignmentActions({positionSourceStructureIds,unassignedParticipantIds,possiblyDisablingAction,provisionalPositioning,tournamentParticipants,isWinRatioFedStructure,positionAssignments,returnParticipants,appliedPolicies,drawDefinition,isByePosition,drawPosition,structureId,event}){var _a,_b,_c;const{drawId}=drawDefinition,validAssignmentActions=[];let unplacedSeedParticipantIds,unplacedSeedAssignments,unfilledPositions=[];const ignoreSeedPositions=null==(_b=null==(_a=null==appliedPolicies?void 0:appliedPolicies[POLICY_TYPE_SEEDING])?void 0:_a.validSeedPositions)?void 0:_b.ignore;if(!ignoreSeedPositions){const result=getNextSeedBlock({provisionalPositioning,randomize:!0,drawDefinition,structureId});({unplacedSeedParticipantIds,unplacedSeedAssignments,unfilledPositions}=result)}if((null==unfilledPositions?void 0:unfilledPositions.length)||(unfilledPositions=positionAssignments.filter((assignment=>!assignment.participantId&&!assignment.bye&&!assignment.qualifier)).map((assignment=>assignment.drawPosition))),isByePosition||validAssignmentActions.push({payload:{drawId,structureId,drawPosition,isPositionAction:!0},willDisableLinks:possiblyDisablingAction,method:ASSIGN_BYE_METHOD,type:ASSIGN_BYE}),isWinRatioFedStructure&&ignoreSeedPositions){const assignedParticipantIds=positionAssignments.map((assignment=>assignment.participantId)).filter(Boolean),matchUpFilters={structureIds:positionSourceStructureIds},{completedMatchUps}=getDrawMatchUps({inContext:!0,matchUpFilters,drawDefinition}),availableParticipantIds=unique(null==(_c=(completedMatchUps||[]).filter((({matchUpType})=>(null==event?void 0:event.eventType)!==TEAM$1||matchUpType===TEAM$1)))?void 0:_c.map((({sides})=>sides.map(getParticipantId))).flat().filter((participantId=>participantId&&!assignedParticipantIds.includes(participantId)))),participantsAvailable=returnParticipants?null==tournamentParticipants?void 0:tournamentParticipants.filter((participant=>null==availableParticipantIds?void 0:availableParticipantIds.includes(participant.participantId))):void 0;return null==participantsAvailable||participantsAvailable.forEach((participant=>{const entry=(drawDefinition.entries||[]).find((entry2=>entry2.participantId===participant.participantId));participant.entryPosition=null==entry?void 0:entry.entryPosition})),(null==participantsAvailable?void 0:participantsAvailable.length)&&validAssignmentActions.push(definedAttributes({payload:{drawId,structureId,drawPosition},willDisableLinks:possiblyDisablingAction,method:ASSIGN_PARTICIPANT_METHOD,type:ASSIGN_PARTICIPANT,availableParticipantIds,participantsAvailable})),{validAssignmentActions}}if(unfilledPositions.includes(drawPosition)||isByePosition){let availableParticipantIds;if(null==unplacedSeedAssignments?void 0:unplacedSeedAssignments.length){const validToAssign=unplacedSeedAssignments.filter((seedAssignment=>null==unplacedSeedParticipantIds?void 0:unplacedSeedParticipantIds.includes(seedAssignment.participantId)));validToAssign.sort(validAssignmentsSort),availableParticipantIds=validToAssign.map((assignment=>assignment.participantId))}else availableParticipantIds=unassignedParticipantIds;const participantsAvailable=returnParticipants?null==tournamentParticipants?void 0:tournamentParticipants.filter((participant=>availableParticipantIds.includes(participant.participantId))):void 0;(null==participantsAvailable?void 0:participantsAvailable.length)&&validAssignmentActions.push(definedAttributes({payload:{drawId,structureId,drawPosition},willDisableLinks:possiblyDisablingAction,method:ASSIGN_PARTICIPANT_METHOD,type:ASSIGN_PARTICIPANT,availableParticipantIds,participantsAvailable}))}return{validAssignmentActions}}({positionSourceStructureIds,unassignedParticipantIds,possiblyDisablingAction,isWinRatioFedStructure,tournamentParticipants,positionAssignments,activeDrawPositions,returnParticipants,appliedPolicies,drawDefinition,isByePosition,drawPosition,structureId,structure,event});null==validAssignmentActions||validAssignmentActions.forEach((action=>validActions.push(action)))}if(isAvailableAction({policyActions,action:QUALIFYING_PARTICIPANT})){const{validAssignmentActions}=function getValidQualifiersAction({drawPositionInitialRounds,tournamentParticipants,positionAssignments,returnParticipants,appliedPolicies,drawDefinition,drawPosition,structureId,drawId}){var _a,_b,_c;const qualifyingParticipantIds=[],qualifyingParticipants=[],validAssignmentActions=[],sourceStructureIds=[],assignedParticipantIds=positionAssignments.map((assignment=>assignment.participantId)).filter(Boolean),policy=null==appliedPolicies?void 0:appliedPolicies[POLICY_TYPE_POSITION_ACTIONS],targetRoundNumber=!(null==policy?void 0:policy.disableRoundRestrictions)&&drawPositionInitialRounds[drawPosition],requireCompletedStructures=null==policy?void 0:policy.requireCompletedStructures,{sourceStructureIds:eliminationSoureStructureIds,relevantLinks:eliminationSourceLinks}=getSourceStructureIdsAndRelevantLinks({targetRoundNumber,linkType:WINNER,drawDefinition,structureId})||{};(null==eliminationSoureStructureIds?void 0:eliminationSoureStructureIds.length)&&sourceStructureIds.push(...eliminationSoureStructureIds);const{sourceStructureIds:roundRobinSourceStructureIds,relevantLinks:roundRobinSourceLinks}=getSourceStructureIdsAndRelevantLinks({targetRoundNumber,linkType:POSITION,drawDefinition,structureId})||{};(null==roundRobinSourceStructureIds?void 0:roundRobinSourceStructureIds.length)&&sourceStructureIds.push(...roundRobinSourceStructureIds);for(const sourceLink of eliminationSourceLinks){const structure=null==(_a=drawDefinition.structures)?void 0:_a.find((structure2=>structure2.structureId===sourceLink.source.structureId));if((null==structure?void 0:structure.stage)!==QUALIFYING)continue;const structureCompleted=isCompletedStructure({structureId:sourceLink.source.structureId,drawDefinition});if(!requireCompletedStructures||structureCompleted){const qualifyingRoundNumber=structure.qualifyingRoundNumber,{matchUps}=getAllStructureMatchUps({matchUpFilters:{roundNumbers:[qualifyingRoundNumber]},afterRecoveryTimes:!1,tournamentParticipants,hasWinningSide:!0,inContext:!0,structure});for(const matchUp of matchUps){const winningSide=matchUp.sides.find((side=>(null==side?void 0:side.sideNumber)===matchUp.winningSide)),relevantSide=matchUp.matchUpStatus===BYE&&(null==(_b=matchUp.sides)?void 0:_b.find((({participantId})=>participantId)));if(winningSide||relevantSide){const{participantId,participant}=winningSide||relevantSide||{};participantId&&!assignedParticipantIds.includes(participantId)&&(participant&&returnParticipants&&qualifyingParticipants.push(participant),qualifyingParticipantIds.push(participantId))}}}}for(const sourceLink of roundRobinSourceLinks){const structure=null==(_c=drawDefinition.structures)?void 0:_c.find((structure2=>structure2.structureId===sourceLink.source.structureId));if((null==structure?void 0:structure.stage)!==QUALIFYING)continue;const structureCompleted=isCompletedStructure({structureId:sourceLink.source.structureId,drawDefinition});if(!requireCompletedStructures||structureCompleted){const{positionAssignments:positionAssignments2}=getPositionAssignments$1({structure}),relevantParticipantIds=positionAssignments2.map((assignment=>{var _a2;const participantId=assignment.participantId,results=null==(_a2=findExtension$1({element:assignment,name:TALLY}).extension)?void 0:_a2.value;return results?{participantId,groupOrder:null==results?void 0:results.groupOrder}:{}})).filter((({groupOrder,participantId})=>1===groupOrder&&!assignedParticipantIds.includes(participantId))).map((({participantId})=>participantId));if(qualifyingParticipantIds.push(...relevantParticipantIds),returnParticipants){const relevantParticipants=tournamentParticipants.filter((({participantId})=>relevantParticipantIds.includes(participantId)));qualifyingParticipants.push(...relevantParticipants)}}}return qualifyingParticipantIds.length&&validAssignmentActions.push(definedAttributes({payload:{qualifyingParticipantId:void 0,drawPosition,structureId,drawId},method:QUALIFYING_PARTICIPANT_METHOD,type:QUALIFYING_PARTICIPANT,qualifyingParticipantIds,qualifyingParticipants:returnParticipants?qualifyingParticipants:void 0})),{validAssignmentActions}}({drawPositionInitialRounds,isWinRatioFedStructure,tournamentParticipants,isQualifierPosition,positionAssignments,activeDrawPositions,returnParticipants,appliedPolicies,drawDefinition,drawPosition,structureId,structure,drawId});null==validAssignmentActions||validAssignmentActions.forEach((action=>validActions.push(action)))}const{participantId}=positionAssignment||{},participant=participantId&&tournamentParticipants.find((participant2=>participant2.participantId===participantId));if(positionAssignment){isAvailableAction({policyActions,action:REMOVE_ASSIGNMENT})&&!isActiveDrawPosition&&(validActions.push({type:REMOVE_ASSIGNMENT,method:REMOVE_ASSIGNMENT_METHOD,payload:{drawId,structureId,drawPosition},willDisableLinks:possiblyDisablingAction}),isByePosition||validActions.push({type:WITHDRAW_PARTICIPANT,method:WITHDRAW_PARTICIPANT_METHOD,payload:{drawId,structureId,drawPosition},willDisableLinks:possiblyDisablingAction}),isAvailableAction({policyActions,action:ASSIGN_BYE})&&!isByePosition&&validActions.push({type:ASSIGN_BYE,method:REMOVE_ASSIGNMENT_METHOD,payload:{drawId,structureId,drawPosition,replaceWithBye:!0},willDisableLinks:possiblyDisablingAction}));const validToAssignSeed=structure.stage===QUALIFYING||structure.stage===MAIN&&1===structure.stageSequence;if(!isByePosition&&activePositionsCheck({activePositionOverrides,activeDrawPositions,action:SEED_VALUE})&&isAvailableAction({policyActions,action:SEED_VALUE})&&isValidSeedPosition({drawDefinition,structureId,drawPosition})&&validToAssignSeed){const{seedAssignments}=getStructureSeedAssignments({drawDefinition,structure}),{seedNumber,seedValue}=seedAssignments.find((assignment=>assignment.participantId===participantId))||{};validActions.push({type:SEED_VALUE,method:SEED_VALUE_METHOD,participant,seedNumber,payload:{drawId,structureId,participantId,seedValue}})}if(!isByePosition&&activePositionsCheck({activePositionOverrides,activeDrawPositions,action:REMOVE_SEED})&&isAvailableAction({policyActions,action:REMOVE_SEED})&&isValidSeedPosition({drawDefinition,structureId,drawPosition})&&validToAssignSeed){const{seedAssignments}=getStructureSeedAssignments({drawDefinition,structure}),{seedNumber}=seedAssignments.find((assignment=>assignment.participantId===participantId))||{};validActions.push({type:REMOVE_SEED,method:REMOVE_SEED_METHOD,participant,seedNumber,payload:{drawId,structureId,participantId}})}if(!isByePosition&&participantId){if(isAvailableAction({policyActions,action:ADD_PENALTY})){const addPenaltyAction={type:ADD_PENALTY,method:ADD_PENALTY_METHOD,participant,payload:{drawId,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};validActions.push(addPenaltyAction)}if(isAvailableAction({policyActions,action:ADD_NICKNAME})){const addNicknameAction={type:ADD_NICKNAME,method:ADD_NICKNAME_METHOD,participant,payload:{participantId,otherName:void 0}};validActions.push(addNicknameAction)}}if(isAvailableAction({policyActions,action:SWAP_PARTICIPANTS})){const{validSwapAction}=getValidSwapAction({possiblyDisablingAction,tournamentParticipants,inactiveDrawPositions,activeDrawPositions,positionAssignments,returnParticipants,byeDrawPositions,drawDefinition,isByePosition,drawPosition,structureId,structure,drawId});validSwapAction&&validActions.push(validSwapAction)}}if(isAvailableAction({policyActions,action:ALTERNATE_PARTICIPANT})&&!disablePlacementActions){const{validAlternatesAction}=function getValidAlternatesAction({tournamentParticipants=[],possiblyDisablingAction,activeDrawPositions,positionAssignments,returnParticipants,appliedPolicies,drawDefinition,drawPosition,validActions,structureId,structure,drawId,event}){var _a,_b,_c,_d;if(activeDrawPositions.includes(drawPosition))return{};const validAssignmentParticipantIds=null==(_a=validActions.find((action=>action.type===ASSIGN_PARTICIPANT)))?void 0:_a.availableParticipantIds,otherFlightEntries=null==(_b=null==appliedPolicies?void 0:appliedPolicies[POLICY_TYPE_POSITION_ACTIONS])?void 0:_b.otherFlightEntries,restrictQualifyingAlternates=null==(_c=null==appliedPolicies?void 0:appliedPolicies[POLICY_TYPE_POSITION_ACTIONS])?void 0:_c.restrictQualifyingAlternates,drawEnteredParticipantIds=(drawDefinition.entries||[]).filter((({entryStage})=>!restrictQualifyingAlternates||(structure.stage===QUALIFYING?entryStage===QUALIFYING:entryStage!==QUALIFYING))).sort(((a,b)=>(a.entryPosition||1/0)-(b.entryPosition||1/0))).map((({participantId})=>participantId)).filter(Boolean),{allPositionedParticipantIds}=getAllPositionedParticipantIds({drawDefinition}),assignedParticipantIds=positionAssignments.map((assignment=>assignment.participantId)).filter(Boolean),availableDrawEnteredParticipantIds=drawEnteredParticipantIds.filter((participantId=>[QUALIFYING,MAIN,PLAY_OFF].includes(structure.stage)?!allPositionedParticipantIds.includes(participantId):!assignedParticipantIds.includes(participantId))),availableEventAlternatesParticipantIds=(event.entries||[]).filter((entry=>entry.entryStatus===ALTERNATE&&eligibleEntryStage({restrictQualifyingAlternates,structure,entry})&&([QUALIFYING,MAIN,PLAY_OFF].includes(structure.stage)?!allPositionedParticipantIds.includes(entry.participantId):!assignedParticipantIds.includes(entry.participantId)))).sort(((a,b)=>(a.entryPosition||1/0)-(b.entryPosition||1/0))).map((entry=>entry.participantId));let availableAlternatesParticipantIds=unique(availableDrawEnteredParticipantIds.concat(availableEventAlternatesParticipantIds));if(otherFlightEntries){const{flightProfile}=getFlightProfile({event}),otherFlightEnteredParticipantIds=null==(_d=null==flightProfile?void 0:flightProfile.flights)?void 0:_d.filter((flight=>flight.drawId!==drawId)).map((flight=>flight.drawEntries.filter((entry=>entry.participantId&&![WITHDRAWN,UNGROUPED,UNPAIRED].includes(entry.entryStatus)&&!drawEnteredParticipantIds.includes(entry.participantId))).map((({participantId})=>participantId)))).flat().filter(Boolean);(null==otherFlightEnteredParticipantIds?void 0:otherFlightEnteredParticipantIds.length)&&availableAlternatesParticipantIds.push(...otherFlightEnteredParticipantIds)}(null==validAssignmentParticipantIds?void 0:validAssignmentParticipantIds.length)&&(availableAlternatesParticipantIds=availableAlternatesParticipantIds.filter((id=>!validAssignmentParticipantIds.includes(id))));const availableAlternates=returnParticipants?null==tournamentParticipants?void 0:tournamentParticipants.filter((participant=>availableAlternatesParticipantIds.includes(participant.participantId))):void 0;if(null==availableAlternates||availableAlternates.forEach((alternate=>{const entry=(drawDefinition.entries||[]).find((entry2=>entry2.participantId===alternate.participantId));alternate.entryPosition=null==entry?void 0:entry.entryPosition})),null==availableAlternates||availableAlternates.sort(((a,b)=>(a.entryPosition||1/0)-(b.entryPosition||1/0))),availableAlternatesParticipantIds.length)return{validAlternatesAction:definedAttributes({payload:{drawId,structureId,drawPosition},willDisableLinks:possiblyDisablingAction,method:ALTERNATE_PARTICIPANT_METHOD,availableAlternatesParticipantIds,type:ALTERNATE_PARTICIPANT,availableAlternates})};return{}}({possiblyDisablingAction,tournamentParticipants,positionAssignments,activeDrawPositions,returnParticipants,appliedPolicies,drawDefinition,drawPosition,validActions,structureId,structure,drawId,event});validAlternatesAction&&validActions.push(validAlternatesAction)}if(isAvailableAction({policyActions,action:LUCKY_PARTICIPANT})&&!disablePlacementActions){const{validLuckyLosersAction}=function getValidLuckyLosersAction({tournamentParticipants=[],sourceStructuresCompleted,possiblyDisablingAction,isWinRatioFedStructure,activeDrawPositions,positionAssignments,drawDefinition,drawPosition,structureId,structure,drawId,event}){var _a,_b,_c,_d,_e;if(activeDrawPositions.includes(drawPosition)||isWinRatioFedStructure&&!sourceStructuresCompleted)return{};const{sourceStructureIds,targetStructureIds}=(null==(_a=drawDefinition.links)?void 0:_a.reduce(((ids,link)=>{var _a2,_b2;const sourceStructureId=null==(_a2=link.source)?void 0:_a2.structureId,targetStructureId=null==(_b2=link.target)?void 0:_b2.structureId;return ids.sourceStructureIds.includes(sourceStructureId)||ids.sourceStructureIds.push(sourceStructureId),ids.targetStructureIds.includes(targetStructureId)||ids.targetStructureIds.push(targetStructureId),ids}),{sourceStructureIds:[],targetStructureIds:[]}))||{},availableLuckyLoserParticipantIds=[];let relevantLinks=(null==(_b=drawDefinition.links)?void 0:_b.filter((link=>{var _a2;return(null==(_a2=link.target)?void 0:_a2.structureId)===structure.structureId})))||[];for(const relevantLink of relevantLinks){const sourceStructureId=null==(_c=null==relevantLink?void 0:relevantLink.source)?void 0:_c.structureId,{structure:sourceStructure}=findStructure({structureId:sourceStructureId,drawDefinition}),matchUpFilters={};if((null==sourceStructure?void 0:sourceStructure.finishingPosition)===ROUND_OUTCOME&&(1!==(null==sourceStructureIds?void 0:sourceStructureIds.length)||1!==(null==targetStructureIds?void 0:targetStructureIds.length))){const{matchUps}=getAllStructureMatchUps({drawDefinition,structure,event}),{initialRoundNumber}=getInitialRoundNumber({drawPosition,matchUps}),relevantLink2=null==(_d=drawDefinition.links)?void 0:_d.find((link=>{var _a2;return(null==(_a2=link.target)?void 0:_a2.structureId)===(null==structure?void 0:structure.structureId)&&link.target.roundNumber===initialRoundNumber})),sourceRoundNumber=null==(_e=null==relevantLink2?void 0:relevantLink2.source)?void 0:_e.roundNumber;matchUpFilters.roundNumbers=[sourceRoundNumber]}const{completedMatchUps}=getStructureMatchUps({structureId:sourceStructureId,inContext:!0,matchUpFilters,drawDefinition}),assignedParticipantIds=positionAssignments.map((assignment=>assignment.participantId)).filter(Boolean);(null==completedMatchUps?void 0:completedMatchUps.filter((({matchUpType})=>(null==event?void 0:event.eventType)!==TEAM$1||matchUpType===TEAM$1)).map((({winningSide,sides})=>sides[1-(winningSide-1)])).map(getParticipantId).filter((participantId=>participantId&&!assignedParticipantIds.includes(participantId)))).forEach((participantId=>{availableLuckyLoserParticipantIds.includes(participantId)||availableLuckyLoserParticipantIds.push(participantId)}))}const availableLuckyLosers=null==tournamentParticipants?void 0:tournamentParticipants.filter((participant=>null==availableLuckyLoserParticipantIds?void 0:availableLuckyLoserParticipantIds.includes(participant.participantId)));if(null==availableLuckyLosers||availableLuckyLosers.forEach((luckyLoser=>{const entry=(drawDefinition.entries||[]).find((entry2=>entry2.participantId===luckyLoser.participantId));luckyLoser.entryPosition=null==entry?void 0:entry.entryPosition})),null==availableLuckyLoserParticipantIds?void 0:availableLuckyLoserParticipantIds.length)return{validLuckyLosersAction:{type:LUCKY_PARTICIPANT,method:LUCKY_PARTICIPANT_METHOD,availableLuckyLosers,availableLuckyLoserParticipantIds,willDisableLinks:possiblyDisablingAction,payload:{drawId,structureId,drawPosition}}};return{}}({sourceStructuresCompleted,possiblyDisablingAction,isWinRatioFedStructure,tournamentParticipants,activeDrawPositions,positionAssignments,returnParticipants,appliedPolicies,drawDefinition,drawPosition,structureId,structure,drawId});validLuckyLosersAction&&validActions.push(validLuckyLosersAction)}if((null==participant?void 0:participant.participantType)===PAIR&&isAvailableAction({policyActions,action:MODIFY_PAIR_ASSIGNMENT})){const{validModifyAssignedPairAction}=function getValidModifyAssignedPairAction({tournamentParticipants,returnParticipants,drawPosition,participant,drawId,event}){var _a;const availableIndividualParticipantIds=(null==(_a=null==event?void 0:event.entries)?void 0:_a.filter((({entryStatus})=>[UNGROUPED,UNPAIRED].includes(entryStatus))).map((({participantId})=>participantId)))||[];if(availableIndividualParticipantIds.length){const existingIndividualParticipantIds=participant.individualParticipantIds,availableIndividualParticipants=returnParticipants?tournamentParticipants.filter((({participantId})=>availableIndividualParticipantIds.includes(participantId))):void 0,existingIndividualParticipants=returnParticipants?tournamentParticipants.filter((({participantId})=>existingIndividualParticipantIds.includes(participantId))):void 0;return{validModifyAssignedPairAction:definedAttributes({payload:{participantId:participant.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition,drawId},method:MODIFY_PAIR_ASSIGNMENT_METHOD,availableIndividualParticipantIds,availableIndividualParticipants,existingIndividualParticipantIds,existingIndividualParticipants,type:MODIFY_PAIR_ASSIGNMENT},!1,!1,!0)}}return{}}({tournamentParticipants,positionAssignment,returnParticipants,drawDefinition,drawPosition,participant,structureId,structure,drawId,event});validModifyAssignedPairAction&&validActions.push(validModifyAssignedPairAction)}return{hasPositionAssigned:!!positionAssignment,isActiveDrawPosition,isDrawPosition:!0,isByePosition,validActions}}var __defProp$2m=Object.defineProperty,__getOwnPropSymbols$2n=Object.getOwnPropertySymbols,__hasOwnProp$2n=Object.prototype.hasOwnProperty,__propIsEnum$2n=Object.prototype.propertyIsEnumerable,__defNormalProp$2m=(obj,key,value)=>key in obj?__defProp$2m(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$2l=Object.defineProperty,__defProps$1h=Object.defineProperties,__getOwnPropDescs$1h=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2m=Object.getOwnPropertySymbols,__hasOwnProp$2m=Object.prototype.hasOwnProperty,__propIsEnum$2m=Object.prototype.propertyIsEnumerable,__defNormalProp$2l=(obj,key,value)=>key in obj?__defProp$2l(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2l=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2m.call(b,prop)&&__defNormalProp$2l(a,prop,b[prop]);if(__getOwnPropSymbols$2m)for(var prop of __getOwnPropSymbols$2m(b))__propIsEnum$2m.call(b,prop)&&__defNormalProp$2l(a,prop,b[prop]);return a},__spreadProps$1h=(a,b)=>__defProps$1h(a,__getOwnPropDescs$1h(b));function getDrawData({tournamentParticipants=[],includePositionAssignments,policyDefinitions,tournamentRecord,inContext=!0,drawDefinition,noDeepCopy,sortConfig,context,event}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const drawInfo=(({drawId,drawName,matchUpFormat,updatedAt})=>({matchUpFormat,updatedAt,drawName,drawId}))(drawDefinition);let mainStageSeedAssignments,qualificationStageSeedAssignments;const{structureGroups,allStructuresLinked}=getStructureGroups({drawDefinition});if(!allStructuresLinked){return{error:{error:UNLINKED_STRUCTURES}}}let drawActive=!1,participantPlacements=!1;const structures=structureGroups.map((structureIds=>{const structures2=structureIds.map((structureId=>{const{structure}=findStructure({drawDefinition,structureId}),{seedAssignments}=getStructureSeedAssignments({drawDefinition,structure});return structure.stage===MAIN&&1===structure.stageSequence&&(mainStageSeedAssignments=seedAssignments),structure.stage===QUALIFYING&&1===structure.stageSequence&&(qualificationStageSeedAssignments=seedAssignments),structure})).sort(((a,b)=>structureSort(a,b,sortConfig))).map((structure=>{var _a;const{structureId}=structure;let seedAssignments=[];[MAIN,CONSOLATION,PLAY_OFF].includes(structure.stage)&&(seedAssignments=mainStageSeedAssignments),structure.stage===QUALIFYING&&(seedAssignments=qualificationStageSeedAssignments);const{matchUps,roundMatchUps,roundProfile}=getAllStructureMatchUps({seedAssignments:(null==(_a=null==structure?void 0:structure.seedAssignments)?void 0:_a.length)?void 0:seedAssignments,context:__spreadValues$2l({drawId:drawInfo.drawId},context),tournamentParticipants,policyDefinitions,tournamentRecord,drawDefinition,structure,inContext,event}),{positionAssignments}=getPositionAssignments$1({structure}),participantResults=positionAssignments.filter(hasParticipantId).map((assignment=>{participantPlacements=!0;const{drawPosition,participantId}=assignment,{extension}=findExtension$1({element:assignment,name:TALLY});return extension&&{drawPosition,participantId,participantResult:extension.value}})).filter((f=>null==f?void 0:f.participantResult)),structureInfo=(({stage,stageSequence,structureName,structureType,matchUpFormat,positionAssignments:positionAssignments2})=>({stage,stageSequence,structureName,structureType,matchUpFormat,positionAssignments:positionAssignments2}))(structure);return structureInfo.structureActive=matchUps.reduce(((active,matchUp)=>{var _a2;const activeMatchUpStatus=[COMPLETED$1,CANCELLED$1,DEFAULTED,RETIRED$1,WALKOVER$2,IN_PROGRESS$1,DOUBLE_DEFAULT,DOUBLE_WALKOVER].includes(matchUp.matchUpStatus);return active||activeMatchUpStatus||!!matchUp.winningSide||!!(null==(_a2=matchUp.score)?void 0:_a2.scoreStringSide1)}),!1),structureInfo.structureCompleted=matchUps.reduce(((completed,matchUp)=>completed&&[BYE,COMPLETED$1,RETIRED$1,WALKOVER$2,DEFAULTED,ABANDONED].includes(matchUp.matchUpStatus)),!0),structureInfo.structureActive&&(drawActive=!0),__spreadProps$1h(__spreadValues$2l({},structureInfo),{participantResults,seedAssignments,roundMatchUps,roundProfile,structureId})}));return includePositionAssignments||structures2.forEach((structure=>delete structure.positionAssignments)),structures2})).flat();return drawInfo.drawActive=drawActive,drawInfo.participantPlacements=participantPlacements,drawInfo.drawGenerated=null==structures?void 0:structures.reduce(((generated,structure)=>generated||!!(null==structure?void 0:structure.roundMatchUps)),!1),drawInfo.drawCompleted=null==structures?void 0:structures.reduce(((completed,structure)=>completed&&structure.structureCompleted),!0),__spreadValues$2l({structures:noDeepCopy?structures:makeDeepCopy(structures,!1,!0),drawInfo:noDeepCopy?drawInfo:makeDeepCopy(drawInfo,!1,!0)},SUCCESS)}function getStructureGroups({drawDefinition}){let linkedStructureIds=(drawDefinition.links||[]).map((link=>[link.source.structureId,link.target.structureId]));const iterations=linkedStructureIds.length;generateRange(0,Math.ceil(iterations/2)).forEach((()=>{linkedStructureIds=generateRange(0,iterations).map((index=>{const structureIds=linkedStructureIds[index],mergedWithOverlappingIds=linkedStructureIds.reduce(((biggest,ids)=>overlap(structureIds,ids)?biggest.concat(...ids):biggest),[])||[];return unique(structureIds.concat(...mergedWithOverlappingIds))}))}));const groupedStructureIds=linkedStructureIds[0],allLinkStructuresLinked=linkedStructureIds.slice(1).reduce(((allLinkStructuresLinked2,ids)=>{return allLinkStructuresLinked2&&intersection(a=ids,groupedStructureIds).length===a.length;var a}),!0),structureGroups=[groupedStructureIds].filter(Boolean),linkCheck=[groupedStructureIds].filter(Boolean);(drawDefinition.structures||[]).forEach((structure=>{const{structureId,stage}=structure;structureGroups.find((group=>group.includes(structureId)))||(structureGroups.push([structureId]),stage!==VOLUNTARY_CONSOLATION&&linkCheck.push(structureId))}));const allStructuresLinked=allLinkStructuresLinked&&1===linkCheck.length;return{structureGroups,allStructuresLinked}}var __defProp$2k=Object.defineProperty,__defProps$1g=Object.defineProperties,__getOwnPropDescs$1g=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2l=Object.getOwnPropertySymbols,__hasOwnProp$2l=Object.prototype.hasOwnProperty,__propIsEnum$2l=Object.prototype.propertyIsEnumerable,__defNormalProp$2k=(obj,key,value)=>key in obj?__defProp$2k(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2k=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2l.call(b,prop)&&__defNormalProp$2k(a,prop,b[prop]);if(__getOwnPropSymbols$2l)for(var prop of __getOwnPropSymbols$2l(b))__propIsEnum$2l.call(b,prop)&&__defNormalProp$2k(a,prop,b[prop]);return a},__spreadProps$1g=(a,b)=>__defProps$1g(a,__getOwnPropDescs$1g(b)),__objRest$7=(source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$2l.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols$2l)for(var prop of __getOwnPropSymbols$2l(source))exclude.indexOf(prop)<0&&__propIsEnum$2l.call(source,prop)&&(target[prop]=source[prop]);return target};function getEventData({includePositionAssignments,tournamentRecord:t,participantsProfile,policyDefinitions,usePublishState,status=PUBLIC,sortConfig,event:e}){var _a;const tournamentRecord=makeDeepCopy(t,!1,!0),event=makeDeepCopy(e,!1,!0);if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};const{eventId}=event,{tournamentId,endDate}=tournamentRecord,{timeItem}=getEventTimeItem({itemType:`${PUBLISH}.${STATUS$1}`,event}),publishStatus=null==(_a=null==timeItem?void 0:timeItem.itemValue)?void 0:_a[status],{tournamentParticipants}=getTournamentParticipants(__spreadProps$1g(__spreadValues$2k({withGroupings:!0,withEvents:!1,withDraws:!1},participantsProfile),{tournamentRecord})),structureFilter=({structureId})=>{var _a2;return!usePublishState||!(null==(_a2=null==publishStatus?void 0:publishStatus.structureIds)?void 0:_a2.length)||publishStatus.structureIds.includes(structureId)},drawsData=(event.drawDefinitions||[]).filter((({drawId})=>{var _a2;return!usePublishState||!(null==(_a2=null==publishStatus?void 0:publishStatus.drawIds)?void 0:_a2.length)||publishStatus.drawIds.includes(drawId)})).map((drawDefinition=>(({drawInfo,structures})=>__spreadProps$1g(__spreadValues$2k({},drawInfo),{structures}))(getDrawData({context:{eventId,tournamentId,endDate},includePositionAssignments,tournamentParticipants,noDeepCopy:!0,policyDefinitions,tournamentRecord,drawDefinition,sortConfig,event})))).map((_b=>{var _c=_b,{structures}=_c,drawData=__objRest$7(_c,["structures"]);return __spreadProps$1g(__spreadValues$2k({},drawData),{structures:null==structures?void 0:structures.filter(structureFilter)})})).filter((drawData=>{var _a2;return null==(_a2=drawData.structures)?void 0:_a2.length})),{tournamentInfo}=getTournamentInfo({tournamentRecord}),eventData={tournamentInfo,venuesData:(tournamentRecord.venues||[]).map((venue=>(({venueData})=>__spreadValues$2k({},venueData))(getVenueData({tournamentRecord,venueId:venue.venueId})))),eventInfo:(({eventId:eventId2,eventName,eventType,eventLevel,surfaceCategory,matchUpFormat,category,gender,startDate,endDate:endDate2,ballType,discipline})=>({eventId:eventId2,eventName,eventType,eventLevel,surfaceCategory,matchUpFormat,category,gender,startDate,endDate:endDate2,ballType,discipline}))(event),drawsData};return eventData.eventInfo.publish={createdAt:null==timeItem?void 0:timeItem.createdAt,state:null==timeItem?void 0:timeItem.itemValue},__spreadProps$1g(__spreadValues$2k({},SUCCESS),{eventData})}var __defProp$2j=Object.defineProperty,__defProps$1f=Object.defineProperties,__getOwnPropDescs$1f=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2k=Object.getOwnPropertySymbols,__hasOwnProp$2k=Object.prototype.hasOwnProperty,__propIsEnum$2k=Object.prototype.propertyIsEnumerable,__defNormalProp$2j=(obj,key,value)=>key in obj?__defProp$2j(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2j=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2k.call(b,prop)&&__defNormalProp$2j(a,prop,b[prop]);if(__getOwnPropSymbols$2k)for(var prop of __getOwnPropSymbols$2k(b))__propIsEnum$2k.call(b,prop)&&__defNormalProp$2j(a,prop,b[prop]);return a},__spreadProps$1f=(a,b)=>__defProps$1f(a,__getOwnPropDescs$1f(b));function getTieFormat$1({tournamentRecord,drawDefinition,structureId,matchUpId,structure,eventId,drawId,event}){var _a,_b;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!(drawId||event||structureId||matchUpId))return decorateResult({result:{error:MISSING_VALUE},stack:"getTieFormat"});eventId&&!event&&(event=null==(_a=tournamentRecord.events)?void 0:_a.find((event2=>event2.eventId===eventId)));const matchUpResult=findMatchUp({tournamentRecord,drawDefinition,matchUpId,drawId,event});if(matchUpId&&(null==matchUpResult?void 0:matchUpResult.error))return matchUpResult;if(!drawDefinition&&(null==matchUpResult?void 0:matchUpResult.drawDefinition)&&(drawDefinition=null==matchUpResult?void 0:matchUpResult.drawDefinition),!(structure=structure||(null==matchUpResult?void 0:matchUpResult.structure))&&structureId&&!matchUpId){if(!drawDefinition)return{error:MISSING_DRAW_ID};const structureResult=findStructure({drawDefinition,structureId});if(structureResult.error)return structureResult;structure=structureResult.structure}const structureDefaultTieFormat=null==structure?void 0:structure.tieFormat,drawDefaultTieFormat=null==drawDefinition?void 0:drawDefinition.tieFormat,eventDefaultTieFormat=null==event?void 0:event.tieFormat,tieFormat=(null==(_b=null==matchUpResult?void 0:matchUpResult.matchUp)?void 0:_b.tieFormat)||structureDefaultTieFormat||drawDefaultTieFormat||eventDefaultTieFormat||void 0;return __spreadProps$1f(__spreadValues$2j({},SUCCESS),{structureDefaultTieFormat,eventDefaultTieFormat,drawDefaultTieFormat,tieFormat})}function getSourceRounds({excludeRoundNumbers=[],playoffPositions=[],drawDefinition,structureId}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structureId)return{error:MISSING_STRUCTURE_ID};if(!playoffPositions)return{error:MISSING_VALUE,info:"missing playoffPositions"};const result=getPositionsPlayedOff({drawDefinition});if(result.error)return result;const positionsPlayedOff=result.positionsPlayedOff,playoffPositionSourceRoundsMap=getFinishingPositionSourceRoundsMap({finishingPositions:playoffPositions.filter((position=>!positionsPlayedOff.includes(position))),drawDefinition,structureId}),relevantPlayoffSourceRounds=Object.values(playoffPositionSourceRoundsMap).reduce(((rounds,round)=>rounds.includes(round.roundNumber)?rounds:rounds.concat(round.roundNumber)),[]).map((roundNumber=>parseInt(roundNumber))).filter((roundNumber=>!excludeRoundNumbers.includes(parseInt(roundNumber)))),playedOffRoundsMap=getFinishingPositionSourceRoundsMap({finishingPositions:positionsPlayedOff,drawDefinition,structureId}),playedOffSourceRounds=Object.values(playedOffRoundsMap).reduce(((rounds,round)=>rounds.includes(round.roundNumber)?rounds:rounds.concat(round.roundNumber)),[]).map((round=>parseInt(round))),playoffSourceRounds=relevantPlayoffSourceRounds.filter((roundNumber=>!playedOffSourceRounds.includes(roundNumber))).sort(numericSort),{roundProfile}=getStructureRoundProfile({drawDefinition,structureId}),playoffPositionsReturned=playoffSourceRounds.map((round=>{const rangeDefinition=roundProfile[round].finishingPositionRange.loser,[min,max]=rangeDefinition;return generateRange(min,(max||min)+1)})).flat().sort(numericSort),{playoffRoundsRanges}=function getPlayoffRoundsRanges({playoffSourceRounds,roundProfile}){const playoffRoundsRanges=playoffSourceRounds.map((roundNumber=>{const rangeDefinition=roundProfile[roundNumber].finishingPositionRange.loser,[min,max]=rangeDefinition,finishingPositions=generateRange(min,(max||min)+1);return{finishingPositionRange:rangeDefinition.join("-"),finishingPositions,roundNumber}}));return{playoffRoundsRanges}}({playoffSourceRounds,roundProfile}),sourceRounds=[...playoffSourceRounds,...playedOffSourceRounds];return{playoffPositionsReturned,playedOffSourceRounds,playoffRoundsRanges,playoffSourceRounds,roundProfile,sourceRounds}}var __defProp$2i=Object.defineProperty,__getOwnPropSymbols$2j=Object.getOwnPropertySymbols,__hasOwnProp$2j=Object.prototype.hasOwnProperty,__propIsEnum$2j=Object.prototype.propertyIsEnumerable,__defNormalProp$2i=(obj,key,value)=>key in obj?__defProp$2i(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2i=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2j.call(b,prop)&&__defNormalProp$2i(a,prop,b[prop]);if(__getOwnPropSymbols$2j)for(var prop of __getOwnPropSymbols$2j(b))__propIsEnum$2j.call(b,prop)&&__defNormalProp$2i(a,prop,b[prop]);return a},__objRest$6=(source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$2j.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols$2j)for(var prop of __getOwnPropSymbols$2j(source))exclude.indexOf(prop)<0&&__propIsEnum$2j.call(source,prop)&&(target[prop]=source[prop]);return target};function getAvailablePlayoffProfiles$1({drawDefinition,structureId}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};let{structures}=getDrawStructures({stageSeqence:1,drawDefinition,stage:MAIN});const{positionsNotPlayedOff,positionsPlayedOff}=getPositionsPlayedOff({drawDefinition});({structures}=getDrawStructures({drawDefinition}));const filteredStructures=structures.filter((structure=>!structureId&&structure.stage!==VOLUNTARY_CONSOLATION||structure.structureId===structureId)),available={},matchUps=allDrawMatchUps$1({inContext:!0,drawDefinition}).matchUps;for(const structure of filteredStructures){const structureId2=null==structure?void 0:structure.structureId,result=availablePlayoffProfiles({playoffPositions:positionsNotPlayedOff,drawDefinition,structure,matchUps}),_a=result,{error}=_a,values=__objRest$6(_a,["error"]);if(error)return result;available[structureId2]=__spreadValues$2i({structureId:structureId2},values)}return structureId?__spreadValues$2i({positionsPlayedOff},available[structureId]):{availablePlayoffProfiles:Object.values(available),availablePlayoffRounds:Object.values(available),positionsPlayedOff}}function availablePlayoffProfiles({playoffPositions,drawDefinition,structure,matchUps}){var _a,_b,_c,_d,_e,_f;const structureId=null==structure?void 0:structure.structureId,{links}=getStructureLinks({drawDefinition,structureId});if(structure.structureType===CONTAINER||structure.structures){const positionsCount=getPositionAssignments$1({structure}).positionAssignments.length,groupCount=structure.structures.length,groupSize=positionsCount/groupCount,finishingPositionsPlayedOff=(null==(_a=links.source)?void 0:_a.flatMap((({source})=>(null==source?void 0:source.finishingPositions)||[])))||[],finishingPositionsAvailable=generateRange(1,groupSize+1).filter((n=>!finishingPositionsPlayedOff.includes(n))),positionRange=(null==(_c=null==(_b=matchUps.find((m=>m.containerStructureId===structureId&&m.finishingPositionRange)))?void 0:_b.finishingPositionRange)?void 0:_c.winner)||[0,1],targetStructureIds=null==links?void 0:links.source.map((({target})=>target.structureId)),{positionsNotPlayedOff,positionsPlayedOff}=getPositionsPlayedOff({structureIds:targetStructureIds,drawDefinition}),excludePlayoffPositions=[...positionsNotPlayedOff,...positionsPlayedOff],availablePlayoffPositions=generateRange(positionRange[0],positionRange[1]+1).filter((position=>!excludePlayoffPositions.includes(position))),positionChunks=chunkArray(availablePlayoffPositions,availablePlayoffPositions.length/finishingPositionsAvailable.length);return{positionsNotPlayedOff:availablePlayoffPositions,playoffFinishingPositionRanges:finishingPositionsAvailable.map(((finishingPosition,i)=>{const finishingPositions=positionChunks[i];return{finishingPosition,finishingPositions,finishingPositionRange:[Math.min(...finishingPositions||[]),Math.max(...finishingPositions||[])].join("-")}})),finishingPositionsAvailable,finishingPositionsPlayedOff,positionsPlayedOff,groupCount,groupSize}}const linkSourceRoundNumbers=(null==(_d=null==links?void 0:links.source)?void 0:_d.filter((link=>link.linkCondition!==FIRST_MATCHUP)).map((link=>{var _a2;return null==(_a2=link.source)?void 0:_a2.roundNumber})))||[],potentialFirstMatchUpRounds=(null==(_e=null==links?void 0:links.source)?void 0:_e.filter((link=>link.linkCondition===FIRST_MATCHUP)).map((link=>{var _a2;return null==(_a2=link.source)?void 0:_a2.roundNumber})))||[],{playoffSourceRounds:playoffRounds,playoffRoundsRanges,roundProfile,error}=getSourceRounds({excludeRoundNumbers:linkSourceRoundNumbers,playoffPositions,drawDefinition,structureId});for(const roundNumber of potentialFirstMatchUpRounds){const link=null==links?void 0:links.source.find((link2=>link2.source.roundNumber===roundNumber)),targetRoundNumber=null==link?void 0:link.target.roundNumber,targetStructureId=null==link?void 0:link.target.structureId,targetRoundMatchUps=matchUps.filter((({roundNumber:roundNumber2,structureId:structureId2})=>structureId2===targetStructureId&&roundNumber2===targetRoundNumber)),availableToProgress=targetRoundMatchUps.filter((({sides})=>sides.find((side=>side.participantFed&&!side.participantId)))).length;if(availableToProgress===targetRoundMatchUps.length){playoffRounds.push(roundNumber);const loser=null==(_f=roundProfile[roundNumber].finishingPositionRange)?void 0:_f.loser;if(loser){const minFinishingPosition=Math.min(...loser),maxFinishingPosition=minFinishingPosition+availableToProgress,finishingPositions=generateRange(minFinishingPosition,maxFinishingPosition),roundsRange={finishingPositionRange:[minFinishingPosition,maxFinishingPosition-1].join("-"),finishingPositions,roundNumber};playoffRoundsRanges.push(roundsRange)}}}return playoffRounds.sort(numericSort),playoffRoundsRanges.sort(((a,b)=>a.roundNumber-b.roundNumber)),{playoffRounds,playoffRoundsRanges,error}}var __defProp$2h=Object.defineProperty,__defProps$1e=Object.defineProperties,__getOwnPropDescs$1e=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2i=Object.getOwnPropertySymbols,__hasOwnProp$2i=Object.prototype.hasOwnProperty,__propIsEnum$2i=Object.prototype.propertyIsEnumerable,__defNormalProp$2h=(obj,key,value)=>key in obj?__defProp$2h(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2h=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2i.call(b,prop)&&__defNormalProp$2h(a,prop,b[prop]);if(__getOwnPropSymbols$2i)for(var prop of __getOwnPropSymbols$2i(b))__propIsEnum$2i.call(b,prop)&&__defNormalProp$2h(a,prop,b[prop]);return a},__spreadProps$1e=(a,b)=>__defProps$1e(a,__getOwnPropDescs$1e(b));function generateAndPopulatePlayoffStructures(params){var _a;const stack="genPlayoffStructure";if(!params.drawDefinition)return decorateResult({result:{error:MISSING_DRAW_DEFINITION},stack});const availabilityResult=getAvailablePlayoffProfiles$1(params);if(availabilityResult.error)return decorateResult({result:availabilityResult,stack});const{structureId:sourceStructureId,addNameBaseToAttributeName,playoffStructureNameBase,tournamentRecord,playoffAttributes,playoffPositions,exitProfileLimit,roundProfiles,roundNumbers,idPrefix,isMock,event,uuids}=params,drawDefinition=makeDeepCopy(params.drawDefinition,!1,!0),{structure}=findStructure({structureId:sourceStructureId,drawDefinition});if(!structure)return decorateResult({result:{error:STRUCTURE_NOT_FOUND}});if(structure.structureType===CONTAINER||structure.structures)return function generateAndPopulateRRplayoffStructures(params){var _a;const stack="generateAndPopulateRRplayoffStructures";if(!params.playoffGroups)return decorateResult({result:{error:MISSING_VALUE},info:"playoffGroups required",stack});const{playoffFinishingPositionRanges,sourceStructureId,playoffGroups,groupCount,groupSize,event}=params,positionRangeMap=playoffFinishingPositionRanges.reduce(((positionMap,positionDetail)=>(positionMap[positionDetail.finishingPosition]=positionDetail,positionMap)),{});if(!(null==playoffGroups?void 0:playoffGroups.every((profile=>{const{finishingPositions}=profile;return finishingPositions.every((position=>positionRangeMap[position]))}))))return decorateResult({context:{validFinishingPositions:Object.values(positionRangeMap)},result:{error:INVALID_VALUES},stack});const{structures:playoffStructures,links:playoffLinks}=processPlayoffGroups(__spreadValues$2p({sourceStructureId,playoffGroups,groupCount,groupSize},params)),drawDefinition=params.drawDefinition;drawDefinition.structures.push(...playoffStructures),drawDefinition.links.push(...playoffLinks);const{matchUps:inContextDrawMatchUps,matchUpsMap}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition}),newStructureIds=playoffStructures.map((({structureId})=>structureId)),addedMatchUpIds=inContextDrawMatchUps.filter((({structureId})=>newStructureIds.includes(structureId))).map(getMatchUpId),addedMatchUps=null==(_a=null==matchUpsMap?void 0:matchUpsMap.drawMatchUps)?void 0:_a.filter((({matchUpId})=>addedMatchUpIds.includes(matchUpId)));if(addedMatchUps.length){const tieFormat=drawDefinition.tieFormat||(null==event?void 0:event.tieFormat)||void 0;tieFormat&&addedMatchUps.forEach((matchUp=>{const{tieMatchUps}=generateTieMatchUps({isMock:params.isMock,tieFormat});Object.assign(matchUp,{tieMatchUps,matchUpType:TEAM_MATCHUP})}))}const{positionAssignments}=getPositionAssignments$1({structureId:sourceStructureId,drawDefinition}),finishingPositionParticipantIds={};positionAssignments.forEach((assignment=>{const{extension:{value:participantResult}}=findExtension$2({element:assignment,name:TALLY}),groupOrder=null==participantResult?void 0:participantResult.groupOrder;groupOrder&&(finishingPositionParticipantIds[groupOrder]||(finishingPositionParticipantIds[groupOrder]=[]),finishingPositionParticipantIds[groupOrder].push(assignment.participantId))}));const result=automatedPlayoffPositioning({provisionalPositioning:params.provisionalPositioning,structureId:sourceStructureId,applyPositioning:!0,event:params.event,drawDefinition});return result.error?decorateResult({result,stack}):__spreadValues$2p({structures:playoffStructures,links:playoffLinks,drawDefinition},SUCCESS)}(__spreadProps$1e(__spreadValues$2h(__spreadValues$2h({sourceStructureId:structure.structureId},params),availabilityResult),{drawDefinition}));const{playoffRoundsRanges:availablePlayoffRoundsRanges,playoffRounds:availablePlayoffRounds}=availabilityResult,{playoffPositionsReturned,error:sourceRoundsError,playoffSourceRounds,playoffRoundsRanges}=getSourceRounds(params);if(sourceRoundsError)return decorateResult({result:{error:sourceRoundsError},stack});const roundProfile=(null==roundProfiles?void 0:roundProfiles.length)&&Object.assign({},...roundProfiles),targetRoundNumbers=roundNumbers||"object"==typeof roundProfiles&&roundProfiles.map((p=>Object.keys(p))).flat(),validRoundNumbers=targetRoundNumbers&&targetRoundNumbers.map((p=>!isNaN(p)&&parseInt(p))).filter(Boolean);if(validRoundNumbers){if(!Array.isArray(validRoundNumbers))return decorateResult({result:{error:INVALID_VALUES},context:{validRoundNumbers},stack});validRoundNumbers.forEach((roundNumber=>{if(!(null==availablePlayoffRounds?void 0:availablePlayoffRounds.includes(roundNumber)))return decorateResult({result:{error:INVALID_VALUES},context:{roundNumber},stack})}))}playoffPositions&&playoffPositions.forEach((playoffPosition=>{if(!playoffPositionsReturned.includes(playoffPosition))return decorateResult({result:{error:INVALID_VALUES},context:{playoffPosition},stack})}));const sourceRounds=validRoundNumbers||playoffSourceRounds,roundsRanges=validRoundNumbers?availablePlayoffRoundsRanges:playoffRoundsRanges,newStructures=[],newLinks=[];for(const roundNumber of sourceRounds){const roundInfo=null==roundsRanges?void 0:roundsRanges.find((roundInfo2=>roundInfo2.roundNumber===roundNumber));if(!roundInfo)return decorateResult({result:{error:INVALID_VALUES},context:{roundNumber},stack});const drawSize=roundInfo.finishingPositions.length,finishingPositionOffset=Math.min(...roundInfo.finishingPositions)-1,stageSequence=2,sequenceLimit=roundProfile&&roundProfile[roundNumber]&&stageSequence+roundProfile[roundNumber]-1,result=generatePlayoffStructures({exitProfile:`0-${roundNumber}`,addNameBaseToAttributeName,playoffStructureNameBase,finishingPositionOffset,playoffAttributes,exitProfileLimit,stage:PLAY_OFF,drawDefinition,roundOffset:0,sequenceLimit,stageSequence,drawSize,idPrefix,isMock,uuids});if(result.error)return decorateResult({result,stack});const{structures,links}=result;if((null==structures?void 0:structures.length)&&newStructures.push(...structures),(null==links?void 0:links.length)&&newLinks.push(...links),result.structureId){const link={linkType:LOSER,source:{structureId:sourceStructureId,roundNumber},target:{structureId:result.structureId,feedProfile:TOP_DOWN,roundNumber:1}};newLinks.push(link)}}if(!newStructures.length)return decorateResult({result:{error:INVALID_VALUES},info:"No structures generated",stack});drawDefinition.structures.push(...newStructures),drawDefinition.links.push(...newLinks);const{matchUps:inContextDrawMatchUps,matchUpsMap}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition}),newStructureIds=newStructures.map((({structureId})=>structureId)),addedMatchUpIds=inContextDrawMatchUps.filter((({structureId})=>newStructureIds.includes(structureId))).map(getMatchUpId),addedMatchUps=null==(_a=null==matchUpsMap?void 0:matchUpsMap.drawMatchUps)?void 0:_a.filter((({matchUpId})=>addedMatchUpIds.includes(matchUpId)));if(addedMatchUps.length){const tieFormat=drawDefinition.tieFormat||(null==event?void 0:event.tieFormat)||void 0;tieFormat&&addedMatchUps.forEach((matchUp=>{const{tieMatchUps}=generateTieMatchUps({tieFormat,isMock});Object.assign(matchUp,{tieMatchUps,matchUpType:TEAM$2})}))}inContextDrawMatchUps.filter((matchUp=>matchUpIsComplete({matchUp})&&matchUp.structureId===sourceStructureId)).forEach((matchUp=>{const{matchUpId,score,winningSide}=matchUp,targetData=positionTargets({inContextDrawMatchUps,drawDefinition,matchUpId,structure}),result=directParticipants({inContextDrawMatchUps,tournamentRecord,drawDefinition,matchUpsMap,winningSide,targetData,matchUpId,structure,matchUp,score,event});result.error&&console.log(result.error)}));const matchUpModifications=[],goesToMap=addGoesTo({inContextDrawMatchUps,drawDefinition,matchUpsMap}).goesToMap,{structure:sourceStructure}=findStructure({drawDefinition:params.drawDefinition,structureId:sourceStructureId}),{matchUps:sourceStructureMatchUps}=getAllStructureMatchUps({structure:sourceStructure});return sourceStructureMatchUps.forEach((matchUp=>{var _a2,_b;const loserMatchUpId=goesToMap.loserMatchUpIds[matchUp.matchUpId];if(loserMatchUpId&&matchUp.loserMatchUpId!==loserMatchUpId){matchUp.loserMatchUpId=loserMatchUpId;const modification={tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==(_a2=params.event)?void 0:_a2.eventId,context:stack,matchUp};matchUpModifications.push(modification)}const winnerMatchUpId=goesToMap.winnerMatchUpIds[matchUp.matchUpId];if(winnerMatchUpId&&matchUp.winnerMatchUpId!==winnerMatchUpId){matchUp.winnerMatchUpId=winnerMatchUpId;const modification={tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==(_b=params.event)?void 0:_b.eventId,context:stack,matchUp};matchUpModifications.push(modification)}})),__spreadValues$2h({structures:newStructures,matchUpModifications,links:newLinks,drawDefinition},SUCCESS)}var __defProp$2g=Object.defineProperty,__getOwnPropSymbols$2h=Object.getOwnPropertySymbols,__hasOwnProp$2h=Object.prototype.hasOwnProperty,__propIsEnum$2h=Object.prototype.propertyIsEnumerable,__defNormalProp$2g=(obj,key,value)=>key in obj?__defProp$2g(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2g=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2h.call(b,prop)&&__defNormalProp$2g(a,prop,b[prop]);if(__getOwnPropSymbols$2h)for(var prop of __getOwnPropSymbols$2h(b))__propIsEnum$2h.call(b,prop)&&__defNormalProp$2g(a,prop,b[prop]);return a};function addVoluntaryConsolationStage$1({drawDefinition,drawSize}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const result=setStageDrawSize({stage:VOLUNTARY_CONSOLATION,stageSequence:1,drawDefinition,drawSize});return result.error?result:(modifyDrawNotice({drawDefinition}),__spreadValues$2g({},SUCCESS))}var __defProp$2f=Object.defineProperty,__getOwnPropSymbols$2g=Object.getOwnPropertySymbols,__hasOwnProp$2g=Object.prototype.hasOwnProperty,__propIsEnum$2g=Object.prototype.propertyIsEnumerable,__defNormalProp$2f=(obj,key,value)=>key in obj?__defProp$2f(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2f=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2g.call(b,prop)&&__defNormalProp$2f(a,prop,b[prop]);if(__getOwnPropSymbols$2g)for(var prop of __getOwnPropSymbols$2g(b))__propIsEnum$2g.call(b,prop)&&__defNormalProp$2f(a,prop,b[prop]);return a};function generateVoluntaryConsolation$1(params={}){var _a,_b,_c,_d;const{drawType=SINGLE_ELIMINATION,attachConsolation=!0,applyPositioning=!0,tournamentRecord,staggeredEntry,automated,placeByes,isMock,event}=params;let{drawDefinition}=params;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const tournamentParticipants=null==(_a=getTournamentParticipants({tournamentRecord,inContext:!0}))?void 0:_a.tournamentParticipants,stage=VOLUNTARY_CONSOLATION,entries=getStageEntries$1({stageSequence:1,drawDefinition,stage}),drawSize=[ROUND_ROBIN,DOUBLE_ELIMINATION,ROUND_ROBIN_WITH_PLAYOFF].includes(drawType)?entries.length:nextPowerOf2(entries.length);if(!staggeredEntry&&drawType===FEED_IN$1&&entries.length<2||drawType===ROUND_ROBIN&&entries.length<3)return{error:INVALID_DRAW_SIZE};let{tieFormat,matchUpType}=params;if(tieFormat){const result2=validateTieFormat({tieFormat});if(result2.error)return result2}tieFormat=copyTieFormat(tieFormat||drawDefinition.tieFormat||void 0),matchUpType=matchUpType||drawDefinition.matchUpType||SINGLES$1;const{structures:stageStructures}=getDrawStructures({stageSequence:1,drawDefinition,stage});if(stageStructures.length>1)return{error:INVALID_STRUCTURE};if(null==(_c=null==(_b=null==stageStructures?void 0:stageStructures[0])?void 0:_b.matchUps)?void 0:_c.length)return{error:INVALID_STRUCTURE};const structureId=null==(_d=null==stageStructures?void 0:stageStructures[0])?void 0:_d.structureId;Object.assign(params,definedAttributes({structureName:params.structureName||VOLUNTARY_CONSOLATION,structureId,matchUpType,tieFormat,drawSize,stage}));const result=getGenerators(params);if(result.error)return result;const generator=result.generators[drawType];if(!generator)return{error:UNRECOGNIZED_DRAW_TYPE};const generatorResult=generator&&generator();if(generatorResult.error)return generatorResult;let{structures,links}=generatorResult;const matchUps=structures.map((structure=>getAllStructureMatchUps({structure}).matchUps)).flat();tieFormat&&matchUps.forEach((matchUp=>{const{tieMatchUps}=generateTieMatchUps({tieFormat,isMock});Object.assign(matchUp,{tieMatchUps,matchUpType})})),applyPositioning&&attachConsolation||(drawDefinition=makeDeepCopy(drawDefinition,!1,!0)),links.length&&drawDefinition.links.push(...links);const generatedStructureIds=structures.map((({structureId:structureId2})=>structureId2)),existingStructureIds=drawDefinition.structures.map((({structureId:structureId2})=>structureId2));drawDefinition.structures=drawDefinition.structures.map((structure=>generatedStructureIds.includes(structure.structureId)?structures.find((({structureId:structureId2})=>structureId2===structure.structureId)):structure));const newStructures=structures.filter((({structureId:structureId2})=>!existingStructureIds.includes(structureId2)));return newStructures.length&&drawDefinition.structures.push(...newStructures),automated&&automatedPositioning$1({seedingProfile:params.seedingProfile,participants:tournamentParticipants,applyPositioning,tournamentRecord,drawDefinition,structureId,placeByes,event}),attachConsolation&&modifyDrawNotice({drawDefinition}),__spreadValues$2f({links,structures},SUCCESS)}var __defProp$2e=Object.defineProperty,__defProps$1d=Object.defineProperties,__getOwnPropDescs$1d=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2f=Object.getOwnPropertySymbols,__hasOwnProp$2f=Object.prototype.hasOwnProperty,__propIsEnum$2f=Object.prototype.propertyIsEnumerable,__defNormalProp$2e=(obj,key,value)=>key in obj?__defProp$2e(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2e=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2f.call(b,prop)&&__defNormalProp$2e(a,prop,b[prop]);if(__getOwnPropSymbols$2f)for(var prop of __getOwnPropSymbols$2f(b))__propIsEnum$2f.call(b,prop)&&__defNormalProp$2e(a,prop,b[prop]);return a},__spreadProps$1d=(a,b)=>__defProps$1d(a,__getOwnPropDescs$1d(b));function generateQualifyingStructure$1(params){var _a,_b,_c;if(!params.drawDefinition)return{error:MISSING_DRAW_DEFINITION};const stack="generateQualifyingStructure";let drawSize=params.drawSize||coerceEven(params.participantsCount);const{qualifyingRoundNumber,qualifyingPositions,targetStructureId,structureOptions,appliedPolicies,drawDefinition,structureName,structureId,roundTarget,drawType,idPrefix,isMock,uuids}=params;let roundLimit,roundsCount,structure,link,matchUps,finishingPositions,qualifiersCount=0,stageSequence=1;if(!isConvertableInteger(drawSize))return decorateResult({result:{error:MISSING_DRAW_SIZE},stack});const result=findStructure({structureId:targetStructureId,drawDefinition});if(result.error)return decorateResult({context:{targetStructureId},result,stack});const targetStructure=result.structure,matchUpType=targetStructure.matchUpType;if(targetStructure.stage===QUALIFYING)if(targetStructure.stageSequence>1)stageSequence=targetStructure.stageSequence-1;else{let chainModified,nextStructureId=targetStructureId,nextStageSequence=2;for(;!chainModified&&nextStructureId;){targetStructure.stageSequence=nextStageSequence;const targetTargetStructureId=null==(_b=null==(_a=drawDefinition.links.find((link2=>link2.source.structureId===nextStructureId)))?void 0:_a.target)?void 0:_b.structureId;if(nextStructureId=targetTargetStructureId,nextStageSequence+=1,targetTargetStructureId){const result2=findStructure({structureId:targetTargetStructureId,drawDefinition});if(result2.error)return decorateResult({context:{targetTargetStructureId},result:result2,stack});result2.structure.stage!==QUALIFYING&&(chainModified=!0)}else chainModified=!0}}const roundTargetName=roundTarget?`${roundTarget}-`:"",stageSequenceName=`${stageSequence}`,qualifyingStructureName=structureName||(roundTargetName||stageSequenceName?`${QUALIFYING} ${roundTargetName}${stageSequenceName}`:QUALIFYING);if(drawType===ROUND_ROBIN){const{maxRoundNumber,structures,groupCount}=generateRoundRobin({structureName:structureName||qualifyingStructureName,structureId:structureId||(null==uuids?void 0:uuids.pop()),stage:QUALIFYING,structureOptions,appliedPolicies,stageSequence,matchUpType,roundTarget,idPrefix,drawSize,isMock,uuids});qualifiersCount=groupCount,roundLimit=maxRoundNumber,structure=structures[0],finishingPositions=[1]}else({drawSize,matchUps,roundLimit,roundsCount}=treeMatchUps({qualifyingRoundNumber,qualifyingPositions,matchUpType,idPrefix,drawSize,isMock,uuids})),roundLimit||(roundLimit=roundsCount),structure=structureTemplate({structureName:structureName||qualifyingStructureName,structureId:structureId||(null==uuids?void 0:uuids.pop()),qualifyingRoundNumber:roundLimit,stage:QUALIFYING,stageSequence,matchUpType,roundLimit,matchUps}),roundTarget&&addExtension$1({element:structure,extension:{name:ROUND_TARGET,value:roundTarget}}),qualifiersCount=null==(_c=null==matchUps?void 0:matchUps.filter((matchUp=>matchUp.roundNumber===roundLimit)))?void 0:_c.length;const linkType=drawType===ROUND_ROBIN?POSITION:WINNER;return({link}=generateQualifyingLink({sourceStructureId:structure.structureId,sourceRoundNumber:roundLimit,targetStructureId,finishingPositions,linkType})),__spreadProps$1d(__spreadValues$2e({qualifyingDrawPositionsCount:drawSize,qualifiersCount},SUCCESS),{structure,link})}var __defProp$2d=Object.defineProperty,__getOwnPropSymbols$2e=Object.getOwnPropertySymbols,__hasOwnProp$2e=Object.prototype.hasOwnProperty,__propIsEnum$2e=Object.prototype.propertyIsEnumerable,__defNormalProp$2d=(obj,key,value)=>key in obj?__defProp$2d(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2d=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2e.call(b,prop)&&__defNormalProp$2d(a,prop,b[prop]);if(__getOwnPropSymbols$2e)for(var prop of __getOwnPropSymbols$2e(b))__propIsEnum$2e.call(b,prop)&&__defNormalProp$2d(a,prop,b[prop]);return a};function attachQualifyingStructure$1({tournamentRecord,drawDefinition,structure,eventId,link}){var _a;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structure)return{error:MISSING_STRUCTURE};if(!link)return{error:MISSING_TARGET_LINK};const targetStructureId=link.target.structureId,result=findStructure({drawDefinition,structureId:targetStructureId});if(result.error)return decorateResult({stack:"attachQualifyingStructure",context:{targetStructureId},result});drawDefinition.structures.push(structure),drawDefinition.links.push(link);const matchUps=(null==(_a=getAllStructureMatchUps({structure}))?void 0:_a.matchUps)||[];return addMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,matchUps,eventId}),modifyDrawNotice({drawDefinition,structureIds:[structure.structureId]}),__spreadValues$2d({},SUCCESS)}var __defProp$2c=Object.defineProperty,__defProps$1c=Object.defineProperties,__getOwnPropDescs$1c=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2d=Object.getOwnPropertySymbols,__hasOwnProp$2d=Object.prototype.hasOwnProperty,__propIsEnum$2d=Object.prototype.propertyIsEnumerable,__defNormalProp$2c=(obj,key,value)=>key in obj?__defProp$2c(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2c=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2d.call(b,prop)&&__defNormalProp$2c(a,prop,b[prop]);if(__getOwnPropSymbols$2d)for(var prop of __getOwnPropSymbols$2d(b))__propIsEnum$2d.call(b,prop)&&__defNormalProp$2c(a,prop,b[prop]);return a},__spreadProps$1c=(a,b)=>__defProps$1c(a,__getOwnPropDescs$1c(b));function getAdvancingParticipantId(matchUp){return matchUp.matchUpStatus===BYE?matchUp.sides.reduce(((p,c)=>c.participantId||p),void 0):matchUp.winningSide?matchUp.sides.reduce(((p,c)=>c.sideNumber===matchUp.winningSide?c.participantId:p),void 0):void 0}function addQualifyingStructure$1(params){var _a,_b;const{structure,link}=generateQualifyingStructure$1(params),drawDefinition=params.drawDefinition;return attachQualifyingStructure$1({tournamentId:null==(_a=params.tournamentRecord)?void 0:_a.tournamentId,eventId:(null==(_b=params.event)?void 0:_b.eventId)||params.eventId,drawDefinition,structure,link})}var __defProp$2b=Object.defineProperty,__getOwnPropSymbols$2c=Object.getOwnPropertySymbols,__hasOwnProp$2c=Object.prototype.hasOwnProperty,__propIsEnum$2c=Object.prototype.propertyIsEnumerable,__defNormalProp$2b=(obj,key,value)=>key in obj?__defProp$2b(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2b=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2c.call(b,prop)&&__defNormalProp$2b(a,prop,b[prop]);if(__getOwnPropSymbols$2c)for(var prop of __getOwnPropSymbols$2c(b))__propIsEnum$2c.call(b,prop)&&__defNormalProp$2b(a,prop,b[prop]);return a},__objRest$5=(source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$2c.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols$2c)for(var prop of __getOwnPropSymbols$2c(source))exclude.indexOf(prop)<0&&__propIsEnum$2c.call(source,prop)&&(target[prop]=source[prop]);return target};function attachPlayoffStructures$1(params){return attachStructures$1(params)}function attachStructures$1({matchUpModifications,tournamentRecord,drawDefinition,structures,links=[],event}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!Array.isArray(structures)||!Array.isArray(links))return{error:INVALID_VALUES};const linkHash=link=>[link.source.structureId,link.source.roundNumber,link.target.roundNumber].join("|"),existingLinkHashes=drawDefinition.links.map(linkHash);if(links.some((link=>{const hash=linkHash(link);return existingLinkHashes.includes(hash)})))return decorateResult({result:{error:EXISTING_STRUCTURE},info:"playoff structure exists",stack:"attachStructures"});links.length&&drawDefinition.links.push(...links);const generatedStructureIds=structures.map((({structureId})=>structureId)),existingStructureIds=drawDefinition.structures.map((({structureId})=>structureId));drawDefinition.structures=drawDefinition.structures.map((structure=>generatedStructureIds.includes(structure.structureId)?structures.find((({structureId})=>structureId===structure.structureId)):structure));const newStructures=structures.filter((({structureId})=>!existingStructureIds.includes(structureId)));newStructures.length&&drawDefinition.structures.push(...newStructures);const matchUps=structures.map((structure=>{var _a;return(null==(_a=getAllStructureMatchUps({structure}))?void 0:_a.matchUps)||[]})).flat();addMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,drawDefinition,matchUps});if(modifyDrawNotice({drawDefinition,structureIds:structures.map((({structureId})=>structureId))}),null==matchUpModifications?void 0:matchUpModifications.length){const modifiedMatchUpMap={};matchUpModifications.forEach((modification=>{var _a;const matchUpId=null==(_a=modification.matchUp)?void 0:_a.matchUpId;matchUpId&&(modifiedMatchUpMap[matchUpId]=modification)}));const modifyStructureMatchUps=structure=>{structure.matchUps.forEach((matchUp=>{if(modifiedMatchUpMap[matchUp.matchUpId]){const _a=modifiedMatchUpMap[matchUp.matchUpId].matchUp,{tieMatchUps}=_a,attribs=__objRest$5(_a,["tieMatchUps"]);if(Object.assign(matchUp,attribs),null==tieMatchUps?void 0:tieMatchUps.length){const modifiedTieMatchUpsMap={};tieMatchUps.forEach((modifiedTieMatchUp=>modifiedMatchUpMap[modifiedTieMatchUp.matchUpId]=modifiedTieMatchUp)),matchUp.tieMatchUps.forEach((tm=>Object.assign(tm,modifiedTieMatchUpsMap[tm.matchUpId])))}modifiedMatchUpMap[matchUp.matchUpId].matchUp=matchUp,modifyMatchUpNotice(modifiedMatchUpMap[matchUp.matchUpId])}}))};drawDefinition.structures.forEach((structure=>{if(existingStructureIds.includes(structure.structureId))if(structure.structures)for(const subStructure of structure.structures)modifyStructureMatchUps(subStructure);else modifyStructureMatchUps(structure)}))}return __spreadValues$2b({},SUCCESS)}function addPlayoffStructures$1(params){var _a,_b;const{structures,links,matchUpModifications}=generateAndPopulatePlayoffStructures(params),drawDefinition=params.drawDefinition;return attachPlayoffStructures$1({tournamentId:null==(_a=params.tournamentRecord)?void 0:_a.tournamentId,eventId:(null==(_b=params.event)?void 0:_b.eventId)||params.eventId,matchUpModifications,drawDefinition,structures,links})}var __defProp$2a=Object.defineProperty,__defProps$1b=Object.defineProperties,__getOwnPropDescs$1b=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2b=Object.getOwnPropertySymbols,__hasOwnProp$2b=Object.prototype.hasOwnProperty,__propIsEnum$2b=Object.prototype.propertyIsEnumerable,__defNormalProp$2a=(obj,key,value)=>key in obj?__defProp$2a(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2a=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2b.call(b,prop)&&__defNormalProp$2a(a,prop,b[prop]);if(__getOwnPropSymbols$2b)for(var prop of __getOwnPropSymbols$2b(b))__propIsEnum$2b.call(b,prop)&&__defNormalProp$2a(a,prop,b[prop]);return a},__spreadProps$1b=(a,b)=>__defProps$1b(a,__getOwnPropDescs$1b(b));function deleteAdHocMatchUps$1({tournamentRecord,matchUpIds=[],drawDefinition,structureId,event}){var _a;if("object"!=typeof drawDefinition)return{error:MISSING_DRAW_DEFINITION};if("string"!=typeof structureId)return{error:MISSING_STRUCTURE_ID};if(!Array.isArray(matchUpIds))return{error:INVALID_VALUES};const structure=null==(_a=drawDefinition.structures)?void 0:_a.find((structure2=>structure2.structureId===structureId));if(!structure)return{error:STRUCTURE_NOT_FOUND};const existingMatchUps=null==structure?void 0:structure.matchUps,structureHasRoundPositions=existingMatchUps.find((matchUp=>!!matchUp.roundPosition));if(structure.structures||structureHasRoundPositions||structure.finishingPosition===ROUND_OUTCOME)return{error:INVALID_STRUCTURE};const matchUpsToDelete=existingMatchUps.filter((({matchUpId})=>matchUpIds.includes(matchUpId))),matchUpIdsToDelete=getMatchUpIds(matchUpsToDelete),drawPositionsToDelete=matchUpsToDelete.map((({drawPositions})=>drawPositions)).flat();if(drawPositionsToDelete.length){structure.positionAssignments=structure.positionAssignments.filter((({drawPosition})=>!drawPositionsToDelete.includes(drawPosition))).sort(((a,b)=>a.drawPosition-b.drawPosition)),structure.matchUps=structure.matchUps.filter((({matchUpId})=>!matchUpIdsToDelete.includes(matchUpId)));const newDrawPositionsMap=Object.assign({},...structure.positionAssignments.map((({drawPosition},index)=>({[drawPosition]:index+1}))));structure.positionAssignments=structure.positionAssignments.map((assignment=>__spreadProps$1b(__spreadValues$2a({},assignment),{drawPosition:newDrawPositionsMap[assignment.drawPosition]})));const remapDrawPositions=matchUp=>{var _a2;return matchUp.drawPositions=(null==(_a2=matchUp.drawPositions)?void 0:_a2.map((drawPosition=>newDrawPositionsMap[drawPosition])))||[]};structure.matchUps.forEach(remapDrawPositions),deleteMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUpIds:matchUpIdsToDelete,action:"deleteAdHocMatchUps",eventId:null==event?void 0:event.eventId,drawDefinition}),modifyDrawNotice({structureIds:[structureId],eventId:null==event?void 0:event.eventId,drawDefinition})}return __spreadValues$2a({},SUCCESS)}var __defProp$29=Object.defineProperty,__defProps$1a=Object.defineProperties,__getOwnPropDescs$1a=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$2a=Object.getOwnPropertySymbols,__hasOwnProp$2a=Object.prototype.hasOwnProperty,__propIsEnum$2a=Object.prototype.propertyIsEnumerable,__defNormalProp$29=(obj,key,value)=>key in obj?__defProp$29(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function removeStructure({tournamentRecord,drawDefinition,structureId,event}){var _a,_b;if("string"!=typeof structureId)return{error:INVALID_VALUES};if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structureId)return{error:MISSING_STRUCTURE_ID};const{hasQualifying,mainStageSequence1}=drawDefinition.structures.reduce(((result,structure)=>{const{stage,stageSequence}=structure;return stage===QUALIFYING&&(result.hasQualifying=!0),structure.structureId===structureId&&stage===MAIN&&1===stageSequence&&(result.mainStageSequence1=structure),result}),{});if(mainStageSequence1&&!hasQualifying)return{error:CANNOT_REMOVE_MAIN_STRUCTURE};const removedMatchUpIds=[],idsToRemove=[structureId],getTargetedStructureIds=structureId2=>{var _a2;return null==(_a2=drawDefinition.links)?void 0:_a2.map((link=>link.source.structureId===structureId2&&link.target.structureId)).filter(Boolean)},structureIds=(null==(_a=drawDefinition.structures)?void 0:_a.map((({structureId:structureId2})=>structureId2)))||[],targetedStructureIdsMap=Object.assign({},...structureIds.map((structureId2=>({[structureId2]:getTargetedStructureIds(structureId2)}))));for(;idsToRemove.length;){const idBeingRemoved=idsToRemove.pop(),{structure}=findStructure({structureId:idBeingRemoved,drawDefinition}),{matchUps:matchUps2}=getAllStructureMatchUps({structure}),matchUpIds=getMatchUpIds(matchUps2);removedMatchUpIds.push(...matchUpIds),mainStageSequence1&&idBeingRemoved===structureId||(drawDefinition.links=(null==(_b=drawDefinition.links)?void 0:_b.filter((link=>link.source.structureId!==idBeingRemoved&&link.target.structureId!==idBeingRemoved)))||[],drawDefinition.structures=(drawDefinition.structures||[]).filter((structure2=>structure2.structureId!==idBeingRemoved)));const targetedStructureIds=targetedStructureIdsMap[idBeingRemoved];(null==targetedStructureIds?void 0:targetedStructureIds.length)&&idsToRemove.push(...targetedStructureIds)}const{matchUps}=getAllDrawMatchUps({drawDefinition});return matchUps.forEach((matchUp=>{removedMatchUpIds.includes(matchUp.winnerMatchUpId)&&delete matchUp.winnerMatchUpId,removedMatchUpIds.includes(matchUp.loserMatchUpId)&&delete matchUp.loserMatchUpId})),mainStageSequence1&&(mainStageSequence1.positionAssignments=[],mainStageSequence1.seedAssignments=[],mainStageSequence1.matchUps=[],mainStageSequence1.extensions&&(mainStageSequence1.extensions=[])),deleteMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUpIds:removedMatchUpIds,action:"removeStructure",eventId:null==event?void 0:event.eventId,drawDefinition}),modifyDrawNotice({drawDefinition,eventId:null==event?void 0:event.eventId}),a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2a.call(b,prop)&&__defNormalProp$29(a,prop,b[prop]);if(__getOwnPropSymbols$2a)for(var prop of __getOwnPropSymbols$2a(b))__propIsEnum$2a.call(b,prop)&&__defNormalProp$29(a,prop,b[prop]);return a})({},SUCCESS),__defProps$1a(a,__getOwnPropDescs$1a({removedMatchUpIds}));var a}var __defProp$28=Object.defineProperty,__getOwnPropSymbols$29=Object.getOwnPropertySymbols,__hasOwnProp$29=Object.prototype.hasOwnProperty,__propIsEnum$29=Object.prototype.propertyIsEnumerable,__defNormalProp$28=(obj,key,value)=>key in obj?__defProp$28(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$28=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$29.call(b,prop)&&__defNormalProp$28(a,prop,b[prop]);if(__getOwnPropSymbols$29)for(var prop of __getOwnPropSymbols$29(b))__propIsEnum$29.call(b,prop)&&__defNormalProp$28(a,prop,b[prop]);return a};function generateAdHocMatchUps$1({participantIdPairings,addToStructure=!0,tournamentRecord,matchUpIds=[],drawDefinition,matchUpsCount,roundNumber,structureId,newRound}){var _a,_b,_c,_d;if("object"!=typeof drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(structureId||1!==(null==(_a=drawDefinition.structures)?void 0:_a.length)||(structureId=null==(_c=null==(_b=drawDefinition.structures)?void 0:_b[0])?void 0:_c.structureId),"string"!=typeof structureId)return{error:MISSING_STRUCTURE_ID};if(participantIdPairings&&!Array.isArray(participantIdPairings)||matchUpsCount&&!isConvertableInteger(matchUpsCount)||matchUpIds&&!Array.isArray(matchUpIds)||!participantIdPairings&&!matchUpsCount)return{error:INVALID_VALUES,info:"matchUpsCount or pairings error"};const structure=null==(_d=null==drawDefinition?void 0:drawDefinition.structures)?void 0:_d.find((structure2=>structure2.structureId===structureId));let structureHasRoundPositions;const lastRoundNumber=(null==structure?void 0:structure.matchUps).reduce(((roundNumber2,matchUp)=>(matchUp.roundPosition&&(structureHasRoundPositions=!0),matchUp.roundNumber>roundNumber2?matchUp.roundNumber:roundNumber2)),0);if(structure.structures||structureHasRoundPositions||structure.finishingPosition===ROUND_OUTCOME)return{error:INVALID_STRUCTURE};if(roundNumber&&roundNumber-1>lastRoundNumber)return{error:INVALID_VALUES,info:"roundNumber error"};const nextRoundNumber=roundNumber||(newRound?lastRoundNumber+1:lastRoundNumber||1),matchUps=(participantIdPairings=participantIdPairings||generateRange(0,matchUpsCount).map((()=>({participantIds:[]})))).map((pairing=>{const sides=((null==pairing?void 0:pairing.participantIds)||[]).concat([void 0,void 0]).slice(0,2).map(((participantId,i)=>definedAttributes({sideNumber:i+1,participantId})));return{matchUpId:matchUpIds.pop()||UUID(),roundNumber:nextRoundNumber,matchUpStatus:TO_BE_PLAYED,sides}}));if(addToStructure){const result=addAdHocMatchUps$1({tournamentRecord,drawDefinition,structureId,matchUps});if(result.error)return result}return __spreadValues$28({matchUpsCount:matchUps.length,matchUps},SUCCESS)}function addAdHocMatchUps$1({tournamentRecord,drawDefinition,structureId,matchUps}){var _a,_b,_c,_d,_e,_f;if("object"!=typeof drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(structureId||1!==(null==(_a=drawDefinition.structures)?void 0:_a.length)||(structureId=null==(_c=null==(_b=drawDefinition.structures)?void 0:_b[0])?void 0:_c.structureId),"string"!=typeof structureId)return{error:MISSING_STRUCTURE_ID};if(!Array.isArray(matchUps))return{error:INVALID_VALUES,info:mustBeAnArray("matchUps")};const structure=null==(_d=drawDefinition.structures)?void 0:_d.find((structure2=>structure2.structureId===structureId));if(!structure)return{error:STRUCTURE_NOT_FOUND};const structureHasRoundPositions=(null==structure?void 0:structure.matchUps).find((matchUp=>!!matchUp.roundPosition));if(structure.structures||structureHasRoundPositions||structure.finishingPosition===ROUND_OUTCOME)return{error:INVALID_STRUCTURE};if(structure.structures||structureHasRoundPositions||structure.finishingPosition===ROUND_OUTCOME)return{error:INVALID_STRUCTURE};return overlap((null==(_f=null==(_e=allTournamentMatchUps({tournamentRecord,inContext:!1}))?void 0:_e.matchUps)?void 0:_f.map(getMatchUpId))||[],matchUps.map(getMatchUpId))?{error:EXISTING_MATCHUP_ID,info:"One or more matchUpIds already present in tournamentRecord"}:(structure.matchUps.push(...matchUps),addMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,matchUps}),modifyDrawNotice({drawDefinition,structureIds:[structureId]}),__spreadValues$28({},SUCCESS))}const structureGovernor={generateAndPopulatePlayoffStructures,attachPlayoffStructures:attachPlayoffStructures$1,addPlayoffStructures:addPlayoffStructures$1,generateQualifyingStructure:generateQualifyingStructure$1,attachQualifyingStructure:attachQualifyingStructure$1,addQualifyingStructure:addQualifyingStructure$1,getAvailablePlayoffRounds:getAvailablePlayoffProfiles$1,getAvailablePlayoffProfiles:getAvailablePlayoffProfiles$1,getSourceRounds,getDrawStructures,getPositionsPlayedOff,getQualifiersCount,removeStructure,generateAdHocMatchUps:generateAdHocMatchUps$1,deleteAdHocMatchUps:deleteAdHocMatchUps$1,addAdHocMatchUps:addAdHocMatchUps$1,addVoluntaryConsolationStage:addVoluntaryConsolationStage$1,addVoluntaryConsolationStructure:addVoluntaryConsolationStructure$1,generateVoluntaryConsolation:generateVoluntaryConsolation$1,buildDrawHierarchy:function buildDrawHierarchy({matchUps,matchUpType}){var _a;if(!matchUps)return{error:MISSING_MATCHUPS};let feedRoundNumber=0,previousRound=[],missingMatchUps=[];matchUpType&&(matchUps=matchUps.filter((matchUp=>matchUp.matchUpType===matchUpType)));const matchUpTypes=unique(matchUps.map((({matchUpType:matchUpType2})=>matchUpType2)));if(matchUpTypes.length>1)if(matchUpTypes.includes(TEAM$2))matchUps=matchUps.filter((matchUp=>matchUp.matchUpType===TEAM$2));else if(matchUpTypes.includes(SINGLES$1))matchUps=matchUps.filter((matchUp=>matchUp.matchUpType===SINGLES$1));else{if(!matchUpTypes.includes(DOUBLES$1))return{};matchUps=matchUps.filter((matchUp=>matchUp.matchUpType===DOUBLES$1))}if(!Array.isArray(matchUps)||!matchUps.length)return{};const drawPositionSort=(a,b)=>parseInt(a)-parseInt(b),allDrawPositions=unique(matchUps.map((matchUp=>matchUp.drawPositions)).flat().filter(Boolean)).sort(drawPositionSort),missingDrawPositions=generateRange(1,Math.max(...allDrawPositions)+1).filter((drawPosition=>!allDrawPositions.includes(drawPosition))).sort(drawPositionSort),{roundMatchUps}=getRoundMatchUps$1({matchUps}),firstRoundMatchUps=roundMatchUps[1],secondRoundMatchUps=roundMatchUps[2]||[],[firstRoundMatchUp]=firstRoundMatchUps||[{}],drawId=firstRoundMatchUp.drawId,structureId=firstRoundMatchUp.structureId,maxRound=Math.max(...Object.keys(roundMatchUps)),maxRoundMatchUpsCount=(null==(_a=roundMatchUps[maxRound])?void 0:_a.length)||0,additionalRounds=Math.ceil(Math.log(maxRoundMatchUpsCount)/Math.log(2)),additionalRoundMatchUps=generateRange(1,additionalRounds+1).map((finishingRound=>{const matchUpsToGenerate=Math.pow(2,finishingRound-1),roundNumber=maxRound+additionalRounds-finishingRound+1;return generateRange(1,matchUpsToGenerate+1).map((roundPosition=>({drawId,structureId,matchUpId:UUID(),drawPositions:[],sides:[],roundNumber,roundPosition,finishingRound})))}));additionalRounds&&(matchUps=matchUps.concat(...additionalRoundMatchUps.flat()));const firstRoundDrawPositions=firstRoundMatchUps.map((matchUp=>matchUp.drawPositions)).flat(1/0),secondRoundEntries=secondRoundMatchUps.map((matchUp=>matchUp.drawPositions)).flat(1/0).filter((drawPosition=>!firstRoundDrawPositions.includes(drawPosition))).sort(drawPositionSort),secondRoundEntriySides=secondRoundMatchUps.filter((matchUp=>{var _a2;return null==(_a2=matchUp.drawPositions)?void 0:_a2.reduce(((p,c)=>secondRoundEntries.includes(c)||p),void 0)})).map((matchUp=>{var _a2,_b;const targetDrawPosition=null==(_a2=matchUp.drawPositions)?void 0:_a2.reduce(((p,c)=>secondRoundEntries.includes(c)?c:p),void 0),targetIndex=null==(_b=matchUp.drawPositions)?void 0:_b.indexOf(targetDrawPosition);return{[targetDrawPosition]:matchUp.sides[targetIndex]}}));if((null==missingDrawPositions?void 0:missingDrawPositions.length)&&(null==secondRoundEntries?void 0:secondRoundEntries.length)===(null==missingDrawPositions?void 0:missingDrawPositions.length)){const missingPairs=secondRoundEntries.map(((drawPosition,index)=>[drawPosition,missingDrawPositions[index]].sort(drawPositionSort))),entrySides=Object.assign({},...secondRoundEntriySides),finishingRound=makeDeepCopy(firstRoundMatchUps[0].finishingRound,!1,!0),finishingPositionRange=makeDeepCopy(firstRoundMatchUps[0].finishingPositionRange,!1,!0);missingMatchUps=missingPairs.map(((drawPositions,index)=>{const roundPosition=Math.max(...drawPositions||[])/2;return{sides:null==drawPositions?void 0:drawPositions.map((drawPosition=>entrySides[drawPosition]||{bye:!0,drawPosition})),drawId,structureId,roundPosition,drawPositions,roundNumber:1,finishingRound,matchUpId:UUID(),matchUpStatus:"BYE",sideNumber:index+1,finishingPositionRange}})),matchUps=matchUps.concat(...missingMatchUps)}const finalRound=maxRound+additionalRounds;return generateRange(1,finalRound+1).forEach((roundNumber=>{const newRound=[],roundMatchUps2=filterRoundMatchUps({matchUps,roundNumber}),previousRoundWinnerIds=filterRoundMatchUps({matchUps,roundNumber:roundNumber-1}).map(getAdvancingParticipantId).filter(Boolean),feedRound=(null==roundMatchUps2?void 0:roundMatchUps2.length)===(null==previousRound?void 0:previousRound.length),matchRound=(null==roundMatchUps2?void 0:roundMatchUps2.length)===(null==previousRound?void 0:previousRound.length)/2;1===roundNumber&&roundMatchUps2.forEach((matchUp=>{const drawPositions=matchUp.drawPositions||[],{matchUpId,structureId:structureId2}=matchUp,children=[__spreadProps$1c(__spreadValues$2c({},matchUp.sides[0]),{drawPosition:drawPositions[0],matchUpId,structureId:structureId2}),__spreadProps$1c(__spreadValues$2c({},matchUp.sides[1]),{drawPosition:drawPositions[1],matchUpId,structureId:structureId2})],node=__spreadProps$1c(__spreadValues$2c({},matchUp),{children});newRound.push(node)})),feedRound?(feedRoundNumber++,roundMatchUps2.forEach(((matchUp,i)=>{const drawPositions=matchUp.drawPositions||[],{matchUpId,structureId:structureId2}=matchUp,fedDrawPosition=drawPositions.filter(Boolean).reduce(((fed,position)=>firstRoundDrawPositions.includes(position)?fed:position),void 0),fedSide=matchUp.sides.filter(Boolean).reduce(((fedSide2,side)=>side.participantId&&!previousRoundWinnerIds.includes(side.participantId)?side:fedSide2),void 0),children=[__spreadProps$1c(__spreadValues$2c({},fedSide),{drawPosition:fedDrawPosition,feedRoundNumber,sides:matchUp.sides,matchUpId,structureId:structureId2}),previousRound[i]],node=__spreadProps$1c(__spreadValues$2c({},matchUp),{children});newRound.push(node)}))):matchRound&&roundMatchUps2.forEach(((matchUp,i)=>{const children=[previousRound[2*i],previousRound[2*i+1]],node=__spreadProps$1c(__spreadValues$2c({},matchUp),{children});newRound.push(node)})),previousRound=newRound})),{hierarchy:previousRound[0],missingMatchUps,maxRound,finalRound,matchUps};function filterRoundMatchUps({matchUps:matchUps2,roundNumber}){return matchUps2.filter((m=>m.roundNumber===roundNumber)).sort(((a,b)=>a.roundPosition-b.roundPosition))}},generateDrawTypeAndModifyDrawDefinition:generateDrawTypeAndModifyDrawDefinition$1,generateDrawStructuresAndLinks:generateDrawStructuresAndLinks$1};var __defProp$27=Object.defineProperty,__defProps$19=Object.defineProperties,__getOwnPropDescs$19=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$28=Object.getOwnPropertySymbols,__hasOwnProp$28=Object.prototype.hasOwnProperty,__propIsEnum$28=Object.prototype.propertyIsEnumerable,__defNormalProp$27=(obj,key,value)=>key in obj?__defProp$27(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$27=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$28.call(b,prop)&&__defNormalProp$27(a,prop,b[prop]);if(__getOwnPropSymbols$28)for(var prop of __getOwnPropSymbols$28(b))__propIsEnum$28.call(b,prop)&&__defNormalProp$27(a,prop,b[prop]);return a},__spreadProps$19=(a,b)=>__defProps$19(a,__getOwnPropDescs$19(b));function initializeStructureSeedAssignments({requireParticipantCount=!0,enforcePolicyLimits=!0,drawSizeProgression,participantCount,appliedPolicies,drawDefinition,seedingProfile,structureId,seedsCount}){var _a,_b,_c,_d,_e;const result=findStructure({drawDefinition,structureId});if(result.error)return result;const structure=result.structure,{positionAssignments}=structureAssignedDrawPositions({structure}),drawSize=positionAssignments.length;if(seedsCount>drawSize)return{error:SEEDSCOUNT_GREATER_THAN_DRAW_SIZE};const roundRobinGroupsCount=null==(_a=structure.structures)?void 0:_a.length,roundsCount=null==(_d=null==(_c=null==(_b=structure.structures)?void 0:_b[0])?void 0:_c.matchUps)?void 0:_d.reduce(((maxRoundNumber,{roundNumber})=>Math.max(roundNumber,maxRoundNumber)),0),groupSeedingThreshold=isConvertableInteger(null==seedingProfile?void 0:seedingProfile.groupSeedingThreshold)&&seedingProfile.groupSeedingThreshold,seedGroups=null==(_e=getSeedGroups({roundRobinGroupsCount,roundsCount,drawSize}))?void 0:_e.seedGroups,{seedsCount:maxSeedsCount}=getSeedsCount({policyDefinitions:appliedPolicies,requireParticipantCount,drawSizeProgression,participantCount,drawSize});return(null==appliedPolicies?void 0:appliedPolicies[POLICY_TYPE_SEEDING])&&seedsCount>maxSeedsCount&&enforcePolicyLimits&&maxSeedsCount&&(seedsCount=maxSeedsCount),structure.seedLimit=seedsCount,structure.seedAssignments=generateRange(1,seedsCount+1).map((seedNumber=>{const seedGroup=seedGroups&&seedGroups.find((seedGroup2=>seedGroup2.includes(seedNumber))),groupSeedValue=seedGroup&&Math.min(...seedGroup);return{participantId:void 0,seedNumber,seedValue:groupSeedingThreshold&&seedNumber>=groupSeedingThreshold?groupSeedValue:seedNumber}})),modifyDrawNotice({drawDefinition,structureIds:[structureId]}),__spreadProps$19(__spreadValues$27({},SUCCESS),{seedLimit:seedsCount})}function resolvePreferences({participantPreferences,drawPositionResolutions={}}){const drawPositionsMap=Object.keys(participantPreferences).reduce(((dpm,participantId)=>{const firstPreference=participantPreferences[participantId].preferences[0];return firstPreference&&(dpm[firstPreference]||(dpm[firstPreference]=[]),dpm[firstPreference].push(participantId)),dpm}),{}),minimumContentionCount=Math.min(...Object.values(drawPositionsMap).filter((f=>f.length)).map((v=>v.length))),minimumContentionPositions=Object.keys(drawPositionsMap).filter((drawPosition=>drawPositionsMap[drawPosition].length&&minimumContentionCount&&drawPositionsMap[drawPosition].length===minimumContentionCount));let remainingPreferences;return minimumContentionPositions.forEach((position=>{const selectedParticipantId=randomPop(drawPositionsMap[position]);drawPositionResolutions[position]=selectedParticipantId,delete participantPreferences[selectedParticipantId]})),Object.values(participantPreferences).forEach((pd=>{pd.preferences=pd.preferences.filter((dp=>{const notResolved=!minimumContentionPositions.includes(dp.toString());return notResolved&&(remainingPreferences=!0),notResolved}))})),{drawPositionResolutions,remainingPreferences,participantPreferences}}var __defProp$26=Object.defineProperty,__defProps$18=Object.defineProperties,__getOwnPropDescs$18=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$27=Object.getOwnPropertySymbols,__hasOwnProp$27=Object.prototype.hasOwnProperty,__propIsEnum$27=Object.prototype.propertyIsEnumerable,__defNormalProp$26=(obj,key,value)=>key in obj?__defProp$26(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$26=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$27.call(b,prop)&&__defNormalProp$26(a,prop,b[prop]);if(__getOwnPropSymbols$27)for(var prop of __getOwnPropSymbols$27(b))__propIsEnum$27.call(b,prop)&&__defNormalProp$26(a,prop,b[prop]);return a},__spreadProps$18=(a,b)=>__defProps$18(a,__getOwnPropDescs$18(b));function positionParticipantAction(params){const{participantIdAttributeName="participantId",isQualifierPosition,positionActionName,tournamentRecord,drawDefinition,participantId,drawPosition,structureId,event}=params,stack="positionParticipantAction";if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};let{inContextDrawMatchUps,matchUpsMap}=params;matchUpsMap||(matchUpsMap=getMatchUpsMap({drawDefinition}),Object.assign(params,{matchUpsMap})),inContextDrawMatchUps||(({matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap})),Object.assign(params,{inContextDrawMatchUps}));const{positionAssignments}=getPositionAssignments$1({drawDefinition,structureId}),positionAssignment=positionAssignments.find((assignment=>assignment.drawPosition===drawPosition));if(null==positionAssignment?void 0:positionAssignment.participantId){const removedParticipantId2=positionAssignment.participantId;let result2=assignDrawPosition$1({inContextDrawMatchUps,tournamentRecord,drawDefinition,participantId,drawPosition,structureId,matchUpsMap,event});return result2.success?successNotice({removedParticipantId:removedParticipantId2}):decorateResult({result:result2,stack})}let result=clearDrawPosition({inContextDrawMatchUps,tournamentRecord,drawDefinition,drawPosition,structureId,matchUpsMap,event});if(result.error)return decorateResult({result,stack});const removedParticipantId=result.participantId;return result=assignDrawPosition$1({inContextDrawMatchUps,isQualifierPosition,tournamentRecord,drawDefinition,participantId,drawPosition,structureId,matchUpsMap,event}),result.success?successNotice({removedParticipantId}):decorateResult({result,stack});function successNotice({removedParticipantId:removedParticipantId2}){const{structure}=findStructure({drawDefinition,structureId});conditionallyDisableLinkPositioning({drawPositions:[drawPosition],structure});return addPositionActionTelemetry({drawDefinition,positionAction:{[participantIdAttributeName]:participantId,name:positionActionName,drawPosition,structureId}}),decorateResult({result:__spreadProps$18(__spreadValues$26({},SUCCESS),{context:{removedParticipantId:removedParticipantId2},stack})})}}function alternateDrawPositionAssignment$1({alternateParticipantId,tournamentRecord,drawDefinition,drawPosition,structureId}){return positionParticipantAction({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:alternateParticipantId,tournamentRecord,drawDefinition,drawPosition,structureId})}var __defProp$25=Object.defineProperty,__getOwnPropSymbols$26=Object.getOwnPropertySymbols,__hasOwnProp$26=Object.prototype.hasOwnProperty,__propIsEnum$26=Object.prototype.propertyIsEnumerable,__defNormalProp$25=(obj,key,value)=>key in obj?__defProp$25(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$25=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$26.call(b,prop)&&__defNormalProp$25(a,prop,b[prop]);if(__getOwnPropSymbols$26)for(var prop of __getOwnPropSymbols$26(b))__propIsEnum$26.call(b,prop)&&__defNormalProp$25(a,prop,b[prop]);return a};function setPositionAssignments$1({structurePositionAssignments,provisionalPositioning,tournamentRecord,drawDefinition,event}){var _a;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!Array.isArray(structurePositionAssignments))return{error:INVALID_VALUES};const stack="setPositionAssignments";for(const structureAssignments of structurePositionAssignments){const{structureId,positionAssignments}=structureAssignments;if(!positionAssignments)continue;const result=findStructure({drawDefinition,structureId});if(result.error)return result;const structure=result.structure;if(!structure)return{error:STRUCTURE_NOT_FOUND};if(structure.structures)return{error:INVALID_STRUCTURE,info:"cannot be Round Robin group container"};const structureDrawPositions=null==(_a=structure.positionAssignments)?void 0:_a.map((({drawPosition})=>drawPosition));if(intersection(structureDrawPositions,null==positionAssignments?void 0:positionAssignments.map((({drawPosition})=>drawPosition))).length!==structureDrawPositions.length)return decorateResult({result:{error:INVALID_VALUES},info:"drawPositions do not match",stack});const matchUpsMap=getMatchUpsMap({drawDefinition}),{matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap});for(const assignment of positionAssignments||[]){const{drawPosition,participantId,bye,qualifier}=assignment;if(bye){const result2=assignDrawPositionBye$1({tournamentRecord,drawDefinition,drawPosition,matchUpsMap,structureId,structure,event});if(null==result2?void 0:result2.error)return result2}else if(qualifier)positionAssignments.forEach((assignment2=>{assignment2.drawPosition===drawPosition&&(assignment2.qualifier=!0,delete assignment2.participantId,delete assignment2.bye)}));else if(participantId){const result2=assignDrawPosition$1({provisionalPositioning,automaticPlacement:!0,inContextDrawMatchUps,tournamentRecord,drawDefinition,participantId,drawPosition,matchUpsMap,structureId,event});if(null==result2?void 0:result2.error)return result2}}modifyPositionAssignmentsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,source:stack,structure,event})}const structureIds=structurePositionAssignments.map((({structureId})=>structureId));return modifyDrawNotice({eventId:null==event?void 0:event.eventId,tournamentRecord,drawDefinition,structureIds}),__spreadValues$25({},SUCCESS)}function refreshEntryPositions({entries=[]}={}){const stagedEntries=entries.filter(Boolean).reduce(((stages,entry)=>{const{entryStage,entryStatus}=entry,entryHash=`_${entryStage||MAIN}${entryStatus||""}`;return stages[entryHash]||(stages[entryHash]=[]),stages[entryHash].push(entry),stages}),{}),validEntryPosition=entryPosition=>isNaN(entryPosition)?1/0:entryPosition;return Object.keys(stagedEntries).map((entryHash=>stagedEntries[entryHash].sort(((a,b)=>validEntryPosition(a.entryPosition)-validEntryPosition(b.entryPosition))).map(((entry,index)=>{const entryPosition=index+1;return Object.assign(entry,{entryPosition})})))).flat()}function isUngrouped(entryStatus){return[UNPAIRED,UNGROUPED].includes(entryStatus)}var __defProp$24=Object.defineProperty,__getOwnPropSymbols$25=Object.getOwnPropertySymbols,__hasOwnProp$25=Object.prototype.hasOwnProperty,__propIsEnum$25=Object.prototype.propertyIsEnumerable,__defNormalProp$24=(obj,key,value)=>key in obj?__defProp$24(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$24=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$25.call(b,prop)&&__defNormalProp$24(a,prop,b[prop]);if(__getOwnPropSymbols$25)for(var prop of __getOwnPropSymbols$25(b))__propIsEnum$25.call(b,prop)&&__defNormalProp$24(a,prop,b[prop]);return a};function modifyEntriesStatus({autoEntryPositions=!0,ignoreAssignment,tournamentRecord,drawDefinition,participantIds,entryStatus,entryStage,extension,eventSync,drawId,stage,event}){var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l;if(!participantIds||!Array.isArray(participantIds))return{error:INVALID_PARTICIPANT_ID,method:"modifyEntriesStatus",participantIds};if(!drawDefinition&&!event)return{error:MISSING_EVENT};if(entryStatus&&!VALID_ENTRY_STATUSES.includes(entryStatus))return{error:INVALID_ENTRY_STATUS};if(entryStage&&!validStages.includes(entryStage))return{error:INVALID_STAGE};const stack="modifyEntriesStatus",modifiedDrawIds=[];if(!entryStatus&&!extension)return decorateResult({result:{error:MISSING_VALUE},info:"Missing entryStatus",stack});if(extension&&!isValidExtension({extension,rquiredAttributes:["name"]}))return decorateResult({result:{error:INVALID_VALUES},info:"Invalid extension",context:{extension},stack});const assignedParticipantIds=[];null==(_a=event.drawDefinitions)||_a.forEach((drawDefinition2=>{const participantIds2=getAssignedParticipantIds({stages:stage&&[stage],drawDefinition:drawDefinition2});assignedParticipantIds.push(...participantIds2)}));const tournamentParticipants=(null==tournamentRecord?void 0:tournamentRecord.participants)||[];if(!participantIds.every((participantId=>{const{participantType}=findParticipant({tournamentParticipants,participantId});return!([PAIR,TEAM].includes(participantType)&&isUngrouped(entryStatus)||participantType===INDIVIDUAL&&[DOUBLES,TEAM_EVENT].includes(event.eventType)&&[ALTERNATE,...EQUIVALENT_ACCEPTANCE_STATUSES].includes(entryStatus))})))return{error:INVALID_ENTRY_STATUS};const{flightProfile}=getFlightProfile({event}),flight=null==(_b=null==flightProfile?void 0:flightProfile.flights)?void 0:_b.find((flight2=>flight2.drawId===drawId)),updateEntryStatus=(entries=[])=>{const filteredEntries=entries.filter((entry=>!stage||!entry.entryStage||stage===entry.entryStage)).filter((({participantId})=>participantIds.includes(participantId)));return filteredEntries.every((entry=>!((entry=>assignedParticipantIds.includes(entry.participantId)&&!(EQUIVALENT_ACCEPTANCE_STATUSES.includes(entry.entryStatus)&&EQUIVALENT_ACCEPTANCE_STATUSES.includes(entryStatus)))(entry)&&!ignoreAssignment)&&(entryStatus&&(entry.entryStatus=entryStatus,delete entry.entryPosition),entryStage&&(entry.entryStage=entryStage,delete entry.entryPosition),extension&&(extension.value?addExtension$1({element:entry,extension}):removeExtension$1({element:entry,name:extension.name})),!0)))?__spreadValues$24({},SUCCESS):{error:EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT}},autoPosition=({flight:flight2,drawDefinition:drawDefinition2})=>{event.entries=refreshEntryPositions({entries:event.entries||[]}),flight2&&(flight2.drawEntries=refreshEntryPositions({entries:flight2.drawEntries})),drawDefinition2&&(drawDefinition2.entries=refreshEntryPositions({entries:drawDefinition2.entries}))},updateDrawEntries=({flight:flight2,drawDefinition:drawDefinition2})=>{if(flight2){const result=updateEntryStatus(flight2.drawEntries);if(result.error)return decorateResult({result,stack:"updateDrawEntries"})}if(drawDefinition2){const result=updateEntryStatus(drawDefinition2.entries);if(result.error)return decorateResult({result,stack:"updateDrawEntries"});modifiedDrawIds.includes(drawDefinition2.drawId)||modifiedDrawIds.push(drawDefinition2.drawId)}return __spreadValues$24({},SUCCESS)},entryPositionsExist=(null==(_c=event.entries)?void 0:_c.find((({entryPosition})=>!isNaN(entryPosition))))||(null==(_d=null==flight?void 0:flight.drawEntries)?void 0:_d.find((({entryPosition})=>!isNaN(entryPosition))))||(null==(_e=null==drawDefinition?void 0:drawDefinition.entries)?void 0:_e.find((({entryPosition})=>!isNaN(entryPosition))));if(autoEntryPositions&&!entryPositionsExist&&autoPosition({flight,drawDefinition}),flight||drawDefinition){const result=updateDrawEntries({flight,drawDefinition});if(result.error)return decorateResult({result,stack})}const generatedDrawIds=(null==(_f=event.drawDefinitions)?void 0:_f.map((({drawId:drawId2})=>drawId2)))||[],flightsNoDraw=(null==(_g=null==flightProfile?void 0:flightProfile.flights)?void 0:_g.filter((flight2=>!generatedDrawIds.includes(flight2.drawId))))||[];for(const flight2 of flightsNoDraw){const result=updateDrawEntries({flight:flight2});if(result.error)return decorateResult({result,stack})}const singleDraw=1===(null==(_h=null==flightProfile?void 0:flightProfile.flights)?void 0:_h.length)&&(null==(_i=event.drawDefinitions)?void 0:_i.length)<=(null==(_j=null==flightProfile?void 0:flightProfile.flights)?void 0:_j.length);if(!flight&&!drawDefinition&&DRAW_SPECIFIC_STATUSES.includes(entryStatus))return{error:ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT};if(!flight&&!drawDefinition||entryStatus===WITHDRAWN||eventSync&&singleDraw){const result=updateEntryStatus(event.entries);if(result.error)return decorateResult({result,stack});let error;if(entryStatus===WITHDRAWN&&(null==(_k=null==flightProfile?void 0:flightProfile.flights)||_k.every((flight2=>{const result2=updateEntryStatus(flight2.drawEntries);return result2.error?(error=result2.error,!1):(flight2.drawEntries=flight2.drawEntries.filter((({participantId})=>!participantIds.includes(participantId))),!0)})),null==(_l=event.drawDefinitions)||_l.every((drawDefinition2=>{var _a2;const result2=updateEntryStatus(drawDefinition2.entries);return result2.error?(error=result2.error,!1):(drawDefinition2.entries=null==(_a2=drawDefinition2.entries)?void 0:_a2.filter((({participantId})=>!participantIds.includes(participantId))),!0)}))),error)return decorateResult({result:{error},stack})}autoEntryPositions&&autoPosition({flight,drawDefinition});for(const drawDefinition2 of event.drawDefinitions||[])modifiedDrawIds.length&&!modifiedDrawIds.includes(drawDefinition2.drawId)||modifyDrawNotice({tournamentId:tournamentRecord.tournamentId,eventId:event.eventId,drawDefinition:drawDefinition2});return __spreadValues$24({},SUCCESS)}function getValidStage({stage,drawDefinition}){return Boolean(stage===VOLUNTARY_CONSOLATION||stageExists({stage,drawDefinition})&&getStageDrawPositionsCount({stage,drawDefinition}))}var __defProp$23=Object.defineProperty,__getOwnPropSymbols$24=Object.getOwnPropertySymbols,__hasOwnProp$24=Object.prototype.hasOwnProperty,__propIsEnum$24=Object.prototype.propertyIsEnumerable,__defNormalProp$23=(obj,key,value)=>key in obj?__defProp$23(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$23=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$24.call(b,prop)&&__defNormalProp$23(a,prop,b[prop]);if(__getOwnPropSymbols$24)for(var prop of __getOwnPropSymbols$24(b))__propIsEnum$24.call(b,prop)&&__defNormalProp$23(a,prop,b[prop]);return a};function getStageSpace({entryStatus=DIRECT_ACCEPTANCE,drawDefinition,stageSequence,stage}){if(entryStatus===ALTERNATE)return function stageAlternatesCount({stage,drawDefinition}){var _a;const{entryProfile}=getEntryProfile({drawDefinition});return(null==(_a=entryProfile[stage])?void 0:_a.alternates)||0}({stage,drawDefinition})?Object.assign({positionsAvailable:1/0},SUCCESS):{error:ENTRY_STATUS_NOT_ALLOWED_IN_STAGE};const stageDrawPositionsAvailable=function getStageDrawPositionsAvailable({provisionalPositioning,drawDefinition,stageSequence,stage}){const drawSize=getStageDrawPositionsCount({stage,drawDefinition}),{qualifiersCount}=getQualifiersCount({provisionalPositioning,drawDefinition,stageSequence,stage});return drawSize&&drawSize-qualifiersCount}({drawDefinition,stageSequence,stage}),wildcardPositions=function getStageWildcardsCount({stage,drawDefinition}){var _a;const{entryProfile}=getEntryProfile({drawDefinition});return(null==(_a=entryProfile[stage])?void 0:_a.wildcardsCount)||0}({drawDefinition,stageSequence,stage}),wildcardEntriesCount=getStageEntryTypeCount({entryStatus:WILDCARD,drawDefinition,stageSequence,stage}),totalEntriesCount=wildcardEntriesCount+getStageEntryTypeCount({entryStatus:DIRECT_ACCEPTANCE,drawDefinition,stageSequence,stage}),positionsAvailable=stageDrawPositionsAvailable-totalEntriesCount;return stage!==VOLUNTARY_CONSOLATION&&totalEntriesCount>=stageDrawPositionsAvailable?{error:NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS}:entryStatus===WILDCARD?wildcardEntriesCount<wildcardPositions?__spreadValues$23({},SUCCESS):{error:NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS}:Object.assign({positionsAvailable},SUCCESS)}var __defProp$22=Object.defineProperty,__defProps$17=Object.defineProperties,__getOwnPropDescs$17=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$23=Object.getOwnPropertySymbols,__hasOwnProp$23=Object.prototype.hasOwnProperty,__propIsEnum$23=Object.prototype.propertyIsEnumerable,__defNormalProp$22=(obj,key,value)=>key in obj?__defProp$22(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$22=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$23.call(b,prop)&&__defNormalProp$22(a,prop,b[prop]);if(__getOwnPropSymbols$23)for(var prop of __getOwnPropSymbols$23(b))__propIsEnum$23.call(b,prop)&&__defNormalProp$22(a,prop,b[prop]);return a},__spreadProps$17=(a,b)=>__defProps$17(a,__getOwnPropDescs$17(b));function addDrawEntry({entryStatus=DIRECT_ACCEPTANCE,entryStageSequence,entryStage=MAIN,ignoreStageSpace,drawDefinition,entryPosition,participantId,participant,roundTarget,extensions,extension}){const stack="addDrawEntry";if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!entryStage)return{error:MISSING_STAGE};if(!getValidStage({stage:entryStage,drawDefinition}))return decorateResult({result:{error:INVALID_STAGE},stack});const spaceAvailable=getStageSpace({stageSequence:entryStageSequence,stage:entryStage,drawDefinition,entryStatus});if(!ignoreStageSpace&&!spaceAvailable.success)return{error:spaceAvailable.error};if(extension&&!isValidExtension({extension}))return decorateResult({result:{error:INVALID_VALUES},info:"Invalid extension",context:{extension},stack});if(!(participantId=participantId||(null==participant?void 0:participant.participantId)))return decorateResult({result:{error:MISSING_PARTICIPANT_ID},stack});const invalidLuckyLoser=entryStatus===LUCKY_LOSER&&participantInEntries({participantId,drawDefinition,entryStatus}),invalidVoluntaryConsolation=entryStage===VOLUNTARY_CONSOLATION&&participantInEntries({participantId,drawDefinition,entryStage}),invalidEntry=entryStatus!==LUCKY_LOSER&&entryStage!==VOLUNTARY_CONSOLATION&&participantInEntries({drawDefinition,participantId});if(invalidEntry||invalidLuckyLoser||invalidVoluntaryConsolation)return decorateResult({context:{invalidEntry,invalidLuckyLoser,invalidVoluntaryConsolation},result:{error:EXISTING_PARTICIPANT},stack});const entry=definedAttributes(__spreadProps$17(__spreadValues$22({},participant),{entryStageSequence,participantId,entryPosition,entryStatus,entryStage,extensions}));return extension&&addExtension$1({element:entry,extension}),roundTarget&&addExtension$1({extension:{name:"roundEntry",value:roundTarget},element:entry}),drawDefinition.entries.push(entry),modifyDrawNotice({drawDefinition}),__spreadValues$22({},SUCCESS)}function addDrawEntries$1({entryStatus=DIRECT_ACCEPTANCE,autoEntryPositions=!0,ignoreStageSpace,drawDefinition,participantIds,stageSequence,stage=MAIN,roundTarget}){if(!stage)return{error:MISSING_STAGE};if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!Array.isArray(participantIds))return{error:INVALID_PARTICIPANT_IDS};if(!getValidStage({stage,drawDefinition}))return{error:INVALID_STAGE};const spaceAvailable=getStageSpace({drawDefinition,stageSequence,entryStatus,stage});if(!ignoreStageSpace&&!spaceAvailable.success)return{error:spaceAvailable.error};const positionsAvailable=spaceAvailable.positionsAvailable||0;if(!ignoreStageSpace&&stage!==VOLUNTARY_CONSOLATION&&positionsAvailable<participantIds.length)return{error:PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE};const participantIdsNotAdded=participantIds.reduce(((notAdded,participantId)=>{const invalidLuckyLoser=entryStatus===LUCKY_LOSER&&participantInEntries({participantId,drawDefinition,entryStatus}),invalidVoluntaryConsolation=stage===VOLUNTARY_CONSOLATION&&participantInEntries({entryStage:stage,drawDefinition,participantId});return entryStatus!==LUCKY_LOSER&&stage!==VOLUNTARY_CONSOLATION&&participantInEntries({drawDefinition,participantId})||invalidLuckyLoser||invalidVoluntaryConsolation?notAdded.concat(participantId):notAdded}),[]);return participantIds.filter((participantId=>participantId&&!participantIdsNotAdded.includes(participantId))).forEach((participantId=>{const entry=Object.assign({participantId},{entryStage:stage,entryStatus,entryStageSequence:stageSequence});roundTarget&&addExtension$1({element:entry,extension:{name:ROUND_TARGET,value:roundTarget}}),drawDefinition.entries.push(entry)})),autoEntryPositions&&(drawDefinition.entries=refreshEntryPositions({entries:drawDefinition.entries})),modifyDrawNotice({drawDefinition}),(null==participantIdsNotAdded?void 0:participantIdsNotAdded.length)?__spreadValues$22({info:"some participantIds could not be added",participantIdsNotAdded},SUCCESS):__spreadValues$22({},SUCCESS)}var __defProp$21=Object.defineProperty,__getOwnPropSymbols$22=Object.getOwnPropertySymbols,__hasOwnProp$22=Object.prototype.hasOwnProperty,__propIsEnum$22=Object.prototype.propertyIsEnumerable,__defNormalProp$21=(obj,key,value)=>key in obj?__defProp$21(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$21=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$22.call(b,prop)&&__defNormalProp$21(a,prop,b[prop]);if(__getOwnPropSymbols$22)for(var prop of __getOwnPropSymbols$22(b))__propIsEnum$22.call(b,prop)&&__defNormalProp$21(a,prop,b[prop]);return a};function addDrawEntries({autoEntryPositions=!0,entryStageSequence,ignoreStageSpace,drawDefinition,participantIds,entryStatus,roundTarget,entryStage,extension,drawId,event}){if(!(null==participantIds?void 0:participantIds.length))return{error:MISSING_PARTICIPANT_IDS};if(!event)return{error:EVENT_NOT_FOUND};if(!drawId)return{error:MISSING_DRAW_ID};const eventEnteredParticipantIds=(event.entries||[]).map(getParticipantId);if(participantIds.filter((participantId=>!eventEnteredParticipantIds.includes(participantId))).length)return{error:MISSING_ENTRIES};if(drawDefinition){const result=addDrawEntries$1({stageSequence:entryStageSequence,autoEntryPositions,stage:entryStage,ignoreStageSpace,drawDefinition,participantIds,entryStatus,roundTarget,extension});if(result.error)return result}const{flightProfile}=getFlightProfile({event}),flight=null==flightProfile?void 0:flightProfile.flights.find((flight2=>flight2.drawId===drawId));return(null==flight?void 0:flight.drawEntries)&&(participantIds.forEach((participantId=>{const invalidLuckyLoser=entryStatus===LUCKY_LOSER&&participantInFlightEntries({participantId,entryStatus,flight}),invalidVoluntaryConsolation=entryStage===VOLUNTARY_CONSOLATION&&participantInFlightEntries({participantId,entryStage,flight});entryStatus!==LUCKY_LOSER&&entryStage!==VOLUNTARY_CONSOLATION&&participantInFlightEntries({flight,participantId})||invalidLuckyLoser||invalidVoluntaryConsolation||flight.drawEntries.push({participantId,entryStatus,entryStage})})),autoEntryPositions&&(flight.drawEntries=refreshEntryPositions({entries:flight.drawEntries}))),__spreadValues$21({},SUCCESS)}function participantInFlightEntries({participantId,entryStatus,entryStage,flight}){var _a;const inEntries=null==(_a=flight.drawEntries)?void 0:_a.find((entry=>!(entry.participantId!==participantId||entryStatus&&entryStatus!==entry.entryStatus||entryStage&&entryStage!==entry.entryStage)));return participantId&&inEntries}var __defProp$20=Object.defineProperty,__defProps$16=Object.defineProperties,__getOwnPropDescs$16=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$21=Object.getOwnPropertySymbols,__hasOwnProp$21=Object.prototype.hasOwnProperty,__propIsEnum$21=Object.prototype.propertyIsEnumerable,__defNormalProp$20=(obj,key,value)=>key in obj?__defProp$20(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$20=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$21.call(b,prop)&&__defNormalProp$20(a,prop,b[prop]);if(__getOwnPropSymbols$21)for(var prop of __getOwnPropSymbols$21(b))__propIsEnum$21.call(b,prop)&&__defNormalProp$20(a,prop,b[prop]);return a},__spreadProps$16=(a,b)=>__defProps$16(a,__getOwnPropDescs$16(b));function removeEventEntries({autoEntryPositions=!0,tournamentParticipants,tournamentRecord,participantIds,event}){var _a,_b;const stack="removeEventEntries";if(!(null==event?void 0:event.eventId))return{error:MISSING_EVENT};if(!Array.isArray(participantIds))return decorateResult({result:{error:MISSING_PARTICIPANT_IDS},stack});if(!(null==(participantIds=null==participantIds?void 0:participantIds.filter(Boolean))?void 0:participantIds.length))return decorateResult({result:{error:MISSING_PARTICIPANT_IDS},stack});const{eventId}=event;tournamentParticipants||(tournamentParticipants=getTournamentParticipants({participantFilters:{participantIds},tournamentRecord,withEvents:!0,withDraws:!0}).tournamentParticipants);if(null==tournamentParticipants?void 0:tournamentParticipants.every((participant=>{const eventObject=participant.events.find((event2=>event2.eventId===eventId)),drawIds=(null==eventObject?void 0:eventObject.drawIds)||[];return participant.draws.filter((drawInfo=>drawIds.includes(drawInfo.drawId)&&drawInfo.positionAssignments)).length})))return decorateResult({result:{error:EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT},stack});const participantIdsRemoved=[];event.entries=(event.entries||[]).filter((entry=>{const keepEntry=!participantIds.includes(null==entry?void 0:entry.participantId);return keepEntry||participantIdsRemoved.push(entry.participantId),keepEntry})),autoEntryPositions&&(event.entries=refreshEntryPositions({entries:event.entries}));const{flightProfile}=getFlightProfile({event});return null==(_a=null==flightProfile?void 0:flightProfile.flights)||_a.forEach((flight=>{flight.drawEntries=(flight.drawEntries||[]).filter((entry=>!participantIds.includes(entry.participantId)))})),null==(_b=event.drawDefinitions)||_b.forEach((drawDefinition=>{drawDefinition.entries=(drawDefinition.entries||[]).filter((entry=>!participantIds.includes(entry.participantId)))})),__spreadProps$16(__spreadValues$20({},SUCCESS),{participantIdsRemoved})}var __defProp$1$=Object.defineProperty,__defProps$15=Object.defineProperties,__getOwnPropDescs$15=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$20=Object.getOwnPropertySymbols,__hasOwnProp$20=Object.prototype.hasOwnProperty,__propIsEnum$20=Object.prototype.propertyIsEnumerable,__defNormalProp$1$=(obj,key,value)=>key in obj?__defProp$1$(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1$=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$20.call(b,prop)&&__defNormalProp$1$(a,prop,b[prop]);if(__getOwnPropSymbols$20)for(var prop of __getOwnPropSymbols$20(b))__propIsEnum$20.call(b,prop)&&__defNormalProp$1$(a,prop,b[prop]);return a},__spreadProps$15=(a,b)=>__defProps$15(a,__getOwnPropDescs$15(b));function addEventEntries(params){var _a;const{entryStatus=DIRECT_ACCEPTANCE,autoEntryPositions=!0,participantIds=[],entryStageSequence,ignoreEventGender,entryStage=MAIN,tournamentRecord,ignoreStageSpace,drawDefinition,roundTarget,extensions,extension,drawId,event}=params,stack="addEventEntries";if(!event)return{error:MISSING_EVENT};if(!(null==participantIds?void 0:participantIds.length))return decorateResult({result:{error:MISSING_PARTICIPANT_IDS},stack});if(!(null==event?void 0:event.eventId))return{error:EVENT_NOT_FOUND};const removedEntries=[],addedEntries=[];if(extensions&&(!Array.isArray(extensions)||!extensions.every(isValidExtension))||extension&&!isValidExtension({extension}))return decorateResult({result:{error:INVALID_VALUES},context:definedAttributes({extension,extensions}),info:"Invalid extension(s)",stack});const checkTypedParticipants=!!tournamentRecord,misMatchedGender=[];let info;const typedParticipantIds=(null==(_a=null==tournamentRecord?void 0:tournamentRecord.participants)?void 0:_a.filter((participant=>{var _a2,_b,_c;if(!participantIds.includes(participant.participantId))return!1;const validSingles=event.eventType===SINGLES$1&&participant.participantType===INDIVIDUAL&&!isUngrouped(entryStatus),validDoubles=event.eventType===DOUBLES$1&&participant.participantType===PAIR;return!(!validSingles||event.gender&&!ignoreEventGender&&![MIXED,ANY].includes(event.gender)&&event.gender!==(null==(_a2=participant.person)?void 0:_a2.sex))||(!(!validDoubles||isUngrouped(entryStatus))||(!(event.eventType!==DOUBLES$1||participant.participantType!==INDIVIDUAL||!isUngrouped(entryStatus))||(validSingles&&event.gender&&!ignoreEventGender&&![MIXED,ANY].includes(event.gender)&&event.gender!==(null==(_b=participant.person)?void 0:_b.sex)?(misMatchedGender.push({participantId:participant.participantId,sex:null==(_c=participant.person)?void 0:_c.sex}),!1):event.eventType===TEAM&&(participant.participantType===TEAM||isUngrouped(entryStatus)&&participant.participantType===INDIVIDUAL))))})).map((participant=>participant.participantId)))||[],validParticipantIds=participantIds.filter((participantId=>!checkTypedParticipants||typedParticipantIds.includes(participantId)));event.entries||(event.entries=[]);const existingIds=event.entries.map((e=>{var _a2;return e.participantId||(null==(_a2=e.participant)?void 0:_a2.participantId)}));if(validParticipantIds.forEach((participantId=>{if(!existingIds.includes(participantId)){const entry=definedAttributes({participantId,entryStatus,entryStage,extensions});extension&&addExtension$1({element:entry,extension}),roundTarget&&addExtension$1({extension:{name:ROUND_TARGET,value:roundTarget},element:entry}),entryStageSequence&&(entry.entryStageSequence=entryStageSequence),addedEntries.push(entry.participantId),event.entries.push(entry)}})),drawId&&!isUngrouped(entryStage)){const result=addDrawEntries({participantIds:validParticipantIds,autoEntryPositions,entryStageSequence,ignoreStageSpace,drawDefinition,entryStatus,roundTarget,entryStage,extension,drawId,event});result.error&&(info=result.error)}if([DOUBLES$1,TEAM].includes(event.eventType)){const enteredParticipantIds=(event.entries||[]).map((entry=>entry.participantId)),ungroupedIndividualParticipantIds=(event.entries||[]).filter((entry=>isUngrouped(entry.entryStatus))).map((entry=>entry.participantId)),groupedIndividualParticipantIds=((null==tournamentRecord?void 0:tournamentRecord.participants)||[]).filter((participant=>enteredParticipantIds.includes(participant.participantId)&&[PAIR,TEAM].includes(participant.participantType))).map((participant=>participant.individualParticipantIds)).flat(1/0),ungroupedParticipantIdsToRemove=ungroupedIndividualParticipantIds.filter((participantId=>groupedIndividualParticipantIds.includes(participantId)));ungroupedParticipantIdsToRemove.length&&(removedEntries.push(...ungroupedParticipantIdsToRemove),removeEventEntries({participantIds:ungroupedParticipantIdsToRemove,autoEntryPositions:!1,tournamentRecord,event}))}if(validParticipantIds.length!==participantIds.length)return decorateResult({result:{error:INVALID_PARTICIPANT_IDS},context:{misMatchedGender,gender:event.gender},stack});autoEntryPositions&&(event.entries=refreshEntryPositions({entries:event.entries||[]}));const addedEntriesCount=addedEntries.length-removedEntries.length;return decorateResult({result:__spreadProps$15(__spreadValues$1$({},SUCCESS),{addedEntriesCount}),stack,info})}var __defProp$1_=Object.defineProperty,__defProps$14=Object.defineProperties,__getOwnPropDescs$14=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1$=Object.getOwnPropertySymbols,__hasOwnProp$1$=Object.prototype.hasOwnProperty,__propIsEnum$1$=Object.prototype.propertyIsEnumerable,__defNormalProp$1_=(obj,key,value)=>key in obj?__defProp$1_(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1_=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1$.call(b,prop)&&__defNormalProp$1_(a,prop,b[prop]);if(__getOwnPropSymbols$1$)for(var prop of __getOwnPropSymbols$1$(b))__propIsEnum$1$.call(b,prop)&&__defNormalProp$1_(a,prop,b[prop]);return a},__spreadProps$14=(a,b)=>__defProps$14(a,__getOwnPropDescs$14(b));function removeIndividualParticipantIds({addIndividualParticipantsToEvents,individualParticipantIds,groupingParticipantId,tournamentRecord,suppressErrors}){const stack="removeIndividualParticipantIds";if(!tournamentRecord)return decorateResult({result:{error:MISSING_TOURNAMENT_RECORD},stack});if(!groupingParticipantId||!individualParticipantIds)return decorateResult({result:{error:MISSING_VALUE},stack});const groupingParticipant=(tournamentRecord.participants||[]).find((participant=>participant.participantId===groupingParticipantId));if(!groupingParticipant)return decorateResult({result:{error:PARTICIPANT_NOT_FOUND},stack});if(![TEAM,GROUP].includes(groupingParticipant.participantType))return decorateResult({result:{participantType:groupingParticipant.participantType,error:INVALID_PARTICIPANT_TYPE},stack});const result=removeParticipantIdsFromGroupingParticipant({individualParticipantIds,groupingParticipant,tournamentRecord,suppressErrors}),{removed,error}=result;if(error)return decorateResult({result,stack});if(addIndividualParticipantsToEvents)for(const event of tournamentRecord.events||[]){const enteredIds=(event.entries||[]).map((({participantId})=>participantId)).filter(Boolean);if(enteredIds.includes(groupingParticipantId)){addEventEntries({participantIds:removed.filter((participantId=>!enteredIds.includes(participantId))),entryStatus:UNGROUPED,tournamentRecord,event})}}return removed&&addNotice({topic:MODIFY_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:[groupingParticipant]}}),__spreadValues$1_(__spreadValues$1_({},SUCCESS),result)}function removeParticipantIdsFromGroupingParticipant({individualParticipantIds=[],groupingParticipant,tournamentRecord,suppressErrors,mappedMatchUps,participants}){let removed=[];if(!groupingParticipant)return{removed};let notRemoved=[],cannotRemove=[];participants||({participants,mappedMatchUps}=getParticipants$1({withMatchUps:!0,tournamentRecord,withEvents:!0}));const groupingParticipantEventIds=participants.find((({participantId})=>participantId===groupingParticipant.participantId)).events.map((({eventId})=>eventId)),updatedIndividualParticipantIds=(groupingParticipant.individualParticipantIds||[]).filter((participantId=>{var _a;const targetParticipant=null==individualParticipantIds?void 0:individualParticipantIds.includes(participantId),scoredParticipantGroupingMatchUps=targetParticipant&&(null==(_a=participants.find((participant=>participant.participantId===participantId)))?void 0:_a.matchUps.filter((({eventId})=>groupingParticipantEventIds.includes(eventId))).map((({matchUpId})=>mappedMatchUps[matchUpId])).filter((({winningSide,score})=>winningSide||scoreHasValue({score})))),removeParticipant=targetParticipant&&!(null==scoredParticipantGroupingMatchUps?void 0:scoredParticipantGroupingMatchUps.length);if(targetParticipant&&!removeParticipant&&cannotRemove.push(participantId),removeParticipant){removed.push(participantId);for(const event of tournamentRecord.events||[])for(const drawDefinition of event.drawDefinitions||[]){const{extension}=findExtension$1({element:drawDefinition,name:LINEUPS});let lineUp=null==extension?void 0:extension.value[groupingParticipant.participantId];lineUp&&(lineUp=lineUp.filter((assignment=>assignment.participantId!==participantId)),addExtension$1({element:drawDefinition,extension}),addDrawNotice({drawDefinition}));const matchUps=allDrawMatchUps$1({drawDefinition,inContext:!1}).matchUps||[];for(const matchUp of matchUps){const sides=matchUp.sides||[];for(const side of sides){(side.lineUp||[]).find((assignment=>assignment.participantId===participantId))&&(side.lineUp=side.lineUp.filter((assignment=>assignment.participantId!==participantId)),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,matchUp}))}}}}else notRemoved.push(participantId);return!removeParticipant}));groupingParticipant.individualParticipantIds=updatedIndividualParticipantIds;const result={groupingParticipantId:groupingParticipant.participantId,cannotRemove,notRemoved,removed};return cannotRemove.length&&!suppressErrors&&__spreadProps$14(__spreadValues$1_({},result),{cannotRemove,error:CANNOT_REMOVE_PARTICIPANTS})||result}function removeParticipantIdsFromAllTeams({individualParticipantIds=[],groupingTypes=[TEAM,GROUP],participantRole=COMPETITOR,tournamentRecord}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const tournamentParticipants=tournamentRecord.participants||[],{participants,mappedMatchUps}=getParticipants$1({withMatchUps:!0,tournamentRecord,withEvents:!0});let modifications=0;return tournamentParticipants.filter((participant=>(participant.participantRole===participantRole||!participant.participantRole)&&groupingTypes.includes(participant.participantType))).forEach((grouping=>{const{removed}=removeParticipantIdsFromGroupingParticipant({groupingParticipant:grouping,individualParticipantIds,tournamentRecord,mappedMatchUps,participants});removed&&modifications++})),modifications?SUCCESS:{error:NO_PARTICIPANT_REMOVED}}var __defProp$1Z=Object.defineProperty,__defProps$13=Object.defineProperties,__getOwnPropDescs$13=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1_=Object.getOwnPropertySymbols,__hasOwnProp$1_=Object.prototype.hasOwnProperty,__propIsEnum$1_=Object.prototype.propertyIsEnumerable,__defNormalProp$1Z=(obj,key,value)=>key in obj?__defProp$1Z(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1Z=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1_.call(b,prop)&&__defNormalProp$1Z(a,prop,b[prop]);if(__getOwnPropSymbols$1_)for(var prop of __getOwnPropSymbols$1_(b))__propIsEnum$1_.call(b,prop)&&__defNormalProp$1Z(a,prop,b[prop]);return a},__spreadProps$13=(a,b)=>__defProps$13(a,__getOwnPropDescs$13(b));function deleteParticipants({addIndividualParticipantsToEvents,tournamentRecord,participantIds}){var _a,_b;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!(null==participantIds?void 0:participantIds.length))return{error:MISSING_PARTICIPANT_IDS};const participantsCount=(null==(_a=tournamentRecord.participants)?void 0:_a.length)||0;if(!participantsCount)return __spreadValues$1Z({},SUCCESS);const teamDrawIds=null==(_b=tournamentRecord.events||[])?void 0:_b.filter((({eventType})=>eventType===TEAM$1)).map((event=>{var _a2;return null==(_a2=null==event?void 0:event.drawDefinitions)?void 0:_a2.map((({drawId})=>drawId))})).flat(1/0),{tournamentParticipants}=getTournamentParticipants({participantFilters:{participantIds},tournamentRecord,withDraws:!0}),placedPairParticipantIds=(null==teamDrawIds?void 0:teamDrawIds.length)&&(()=>{const{matchUps}=allTournamentMatchUps({matchUpFilters:{drawIds:teamDrawIds,matchUpTypes:[DOUBLES$1]},tournamentRecord});return intersection(matchUps.map((({sides})=>sides.map((({participantId})=>participantId)))).flat().filter(Boolean),participantIds)})(),participantsInDraws=tournamentParticipants.filter((participant=>{var _a2;return null==(_a2=participant.draws)?void 0:_a2.filter((drawInfo=>(!(null==teamDrawIds?void 0:teamDrawIds.length)||!(null==teamDrawIds?void 0:teamDrawIds.includes(drawInfo.drawId)))&&drawInfo.positionAssignments)).length}));if((null==placedPairParticipantIds?void 0:placedPairParticipantIds.length)||participantsInDraws.length)return{error:EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT};const eventParticipantIdsRemoved={},mappedIndividualParticipantIdsToAdd={};for(const event of tournamentRecord.events||[]){const result=removeEventEntries({tournamentParticipants,tournamentRecord,participantIds,event});if(result.error)return result;eventParticipantIdsRemoved[event.eventId]=result.participantIdsRemoved}tournamentRecord.participants=tournamentRecord.participants.filter((participant=>{const participantToRemove=participantIds.includes(participant.participantId)||participant.participantType===PAIR&&participant.individualParticipantIds.some((id=>participantIds.includes(id)));if(!participantToRemove&&participant.participantType===TEAM$1&&participant.individualParticipantIds.some((id=>participantIds.includes(id)))&&(participant.individualParticipantIds=participant.individualParticipantIds.filter((id=>!participantIds.includes(id)))),participantToRemove&&addIndividualParticipantsToEvents&&[PAIR,TEAM].includes(participant.participantType))for(const individualParticipantId of participant.individualParticipantIds||[])participantIds.includes(individualParticipantId)||(mappedIndividualParticipantIdsToAdd[participant.participantId]||(mappedIndividualParticipantIdsToAdd[participant.participantId]=[]),mappedIndividualParticipantIdsToAdd[participant.participantId].push(individualParticipantId));return!participantToRemove}));const participantsRemovedCount=participantsCount-tournamentRecord.participants.length;if(removeParticipantIdsFromAllTeams({individualParticipantIds:participantIds,tournamentRecord}),addIndividualParticipantsToEvents)for(const event of tournamentRecord.events||[]){addEventEntries({participantIds:eventParticipantIdsRemoved[event.eventId].map((participantId=>mappedIndividualParticipantIdsToAdd[participantId]||[])).flat(),entryStatus:UNGROUPED,tournamentRecord,event})}return participantsRemovedCount&&addNotice({payload:{participantIds,tournamentId:tournamentRecord.tournamentId},topic:DELETE_PARTICIPANTS}),participantsRemovedCount?__spreadProps$13(__spreadValues$1Z({},SUCCESS),{participantsRemovedCount}):{error:CANNOT_REMOVE_PARTICIPANTS}}var __defProp$1Y=Object.defineProperty,__defProps$12=Object.defineProperties,__getOwnPropDescs$12=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1Z=Object.getOwnPropertySymbols,__hasOwnProp$1Z=Object.prototype.hasOwnProperty,__propIsEnum$1Z=Object.prototype.propertyIsEnumerable,__defNormalProp$1Y=(obj,key,value)=>key in obj?__defProp$1Y(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1Y=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1Z.call(b,prop)&&__defNormalProp$1Y(a,prop,b[prop]);if(__getOwnPropSymbols$1Z)for(var prop of __getOwnPropSymbols$1Z(b))__propIsEnum$1Z.call(b,prop)&&__defNormalProp$1Y(a,prop,b[prop]);return a},__spreadProps$12=(a,b)=>__defProps$12(a,__getOwnPropDescs$12(b));function destroyPairEntry({removeGroupParticipant,tournamentRecord,drawDefinition,participantId,entryStatus,drawId,event}){return function destroyGroupEntry({removeGroupParticipant,tournamentRecord,drawDefinition,participantId,entryStatus,drawId,stage,event}){const stack="destroyGroupEntry";if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participantId)return decorateResult({result:{error:MISSING_PARTICIPANT_ID},stack});if(!event)return{error:MISSING_EVENT};if(![DOUBLES,TEAM$1].includes(event.eventType))return decorateResult({result:{error:INVALID_EVENT_TYPE},stack});const tournamentParticipants=tournamentRecord.participants||[],participant=tournamentParticipants.find((participant2=>participant2.participantId===participantId));if(!participant)return decorateResult({result:{error:PARTICIPANT_NOT_FOUND},stack});if(![PAIR,TEAM$1].includes(participant.participantType)||participant.participantType===TEAM$1&&event.eventType!==TEAM$1||participant.participantType===PAIR&&event.eventType!==DOUBLES)return{error:INVALID_PARTICIPANT_TYPE};const defaultEntryStatus=UNGROUPED,entry=(event.entries||[]).find((entry2=>entry2.participantId===participantId));if(!entry)return{error:PARTICIPANT_ENTRY_NOT_FOUND};const{stageEntries}=getStageEntries({entryStatusees:STRUCTURE_SELECTED_STATUSES,selected:!1,drawDefinition,drawId,event,stage}),groupedParticipantIds=stageEntries.map(getParticipantId),individualParticipantIdsInGroups=tournamentParticipants.filter((({participantId:participantId2})=>groupedParticipantIds.includes(participantId2))).map((({individualParticipantIds:individualParticipantIds2})=>individualParticipantIds2)).flat().filter(Boolean),individualParticipantIds=participant.individualParticipantIds.filter((participantId2=>1===arrayIndices(participantId2,individualParticipantIdsInGroups).length));let participantRemoved,result=removeEventEntries({participantIds:[participantId],tournamentRecord,drawDefinition,drawId,event});if(result.error)return result;if(individualParticipantIds.length&&(result=addEventEntries({participantIds:individualParticipantIds,entryStatus:entryStatus||defaultEntryStatus,entryStage:entry.entryStage,tournamentRecord,drawDefinition,drawId,event}),result.error))return result;removeGroupParticipant&&deleteParticipants({tournamentRecord,participantIds:[participantId]}).success&&(participantRemoved=!0);return __spreadProps$12(__spreadValues$1Y({},SUCCESS),{participantRemoved})}({removeGroupParticipant,individualEntryStatus:UNGROUPED,tournamentRecord,drawDefinition,participantId,entryStatus,drawId,event})}function removeDrawPositionAssignment(params){const{tournamentRecord,replaceWithBye,drawDefinition,destroyPair,entryStatus,matchUpsMap,drawId}=params,stack="removeDrawPositionAssignment",result=clearDrawPosition(params);if(result.error)return decorateResult({result,stack});const{participantId}=result,{drawPosition,event,structureId}=params;if([ALTERNATE,WITHDRAWN].includes(entryStatus)&&participantId){const{tournamentRecord:tournamentRecord2}=params,{participant}=findTournamentParticipant({tournamentRecord:tournamentRecord2,participantId}),{participantType,individualParticipantIds}=participant||{};if(destroyPair&&participantType===PAIR){const result2=destroyPairEntry({tournamentRecord:tournamentRecord2,drawDefinition,participantId,event});if(result2.error)return decorateResult({result:result2,stack});modifyEntriesStatus({participantIds:individualParticipantIds,tournamentRecord:tournamentRecord2,drawDefinition,entryStatus,drawId,event})}else modifyEntriesStatus({participantIds:[participantId],tournamentRecord:tournamentRecord2,drawDefinition,entryStatus,drawId,event})}if(replaceWithBye){const result2=assignDrawPositionBye$1({tournamentRecord,drawDefinition,drawPosition,structureId,matchUpsMap,event});if(result2.error)return decorateResult({result:result2,stack})}const{structure}=findStructure({drawDefinition,structureId});conditionallyDisableLinkPositioning({structure,drawPositions:[drawPosition]});return addPositionActionTelemetry({drawDefinition,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye,drawPosition,entryStatus,structureId}}),result}var __defProp$1X=Object.defineProperty,__defProps$11=Object.defineProperties,__getOwnPropDescs$11=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1Y=Object.getOwnPropertySymbols,__hasOwnProp$1Y=Object.prototype.hasOwnProperty,__propIsEnum$1Y=Object.prototype.propertyIsEnumerable,__defNormalProp$1X=(obj,key,value)=>key in obj?__defProp$1X(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1X=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1Y.call(b,prop)&&__defNormalProp$1X(a,prop,b[prop]);if(__getOwnPropSymbols$1Y)for(var prop of __getOwnPropSymbols$1Y(b))__propIsEnum$1Y.call(b,prop)&&__defNormalProp$1X(a,prop,b[prop]);return a},__spreadProps$11=(a,b)=>__defProps$11(a,__getOwnPropDescs$11(b));function swapDrawPositionAssignments$1({tournamentRecord,drawDefinition,drawPositions,structureId,event}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structureId)return{error:MISSING_STRUCTURE_ID};if(2!==(null==drawPositions?void 0:drawPositions.length))return{error:INVALID_VALUES,drawPositions};let matchUpsMap=getMatchUpsMap({drawDefinition});const{matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap}),{structure}=findStructure({drawDefinition,structureId});if(!structure)return{error:STRUCTURE_NOT_FOUND};let result;if(result=structure.structureType===CONTAINER?function roundRobinSwap({inContextDrawMatchUps,tournamentRecord,drawDefinition,drawPositions,matchUpsMap,structure,event}){var _a;const assignments=null==(_a=structure.structures)?void 0:_a.reduce(((assignments2,structure2)=>{const structureAssignments=null==structure2?void 0:structure2.positionAssignments.filter((assignment=>null==drawPositions?void 0:drawPositions.includes(assignment.drawPosition)));return structureAssignments&&assignments2.push(...structureAssignments),assignments2}),[]);if(2===assignments.filter((({bye})=>bye)).length)return __spreadValues$1X({},SUCCESS);if(2===assignments.filter((({qualifier})=>qualifier)).length)return __spreadValues$1X({},SUCCESS);cleanupLineUps({inContextDrawMatchUps,tournamentRecord,drawDefinition,matchUpsMap,assignments,structure,event});if(assignments.some((({bye})=>bye)))swapParticipantIdWithBYE({inContextDrawMatchUps,tournamentRecord,drawDefinition,assignments,matchUpsMap,structure,event});else{const originalAssignments=makeDeepCopy(assignments,!1,!0);assignments.forEach(((assignment,index)=>{const newParticipantId=originalAssignments[1-index].participantId;assignment.qualifier=originalAssignments[1-index].qualifier,assignment.participantId=newParticipantId}))}return __spreadValues$1X({},SUCCESS)}({inContextDrawMatchUps,tournamentRecord,drawDefinition,drawPositions,matchUpsMap,structure,event}):function eliminationSwap({inContextDrawMatchUps,tournamentRecord,drawDefinition,drawPositions,matchUpsMap,structure,event}){const assignments=null==structure?void 0:structure.positionAssignments.filter((assignment=>null==drawPositions?void 0:drawPositions.includes(assignment.drawPosition)));if(!assignments)return{error:INVALID_VALUES,structure,info:"Missing positionAssignments"};if(2===assignments.filter((({bye})=>bye)).length)return __spreadValues$1X({},SUCCESS);if(2===assignments.filter((({qualifier})=>qualifier)).length)return __spreadValues$1X({},SUCCESS);return assignments.some((({bye})=>bye))?swapParticipantIdWithBYE({inContextDrawMatchUps,tournamentRecord,drawDefinition,assignments,matchUpsMap,structure,event}):function eliminationParticipantSwap({inContextDrawMatchUps,tournamentRecord,drawDefinition,assignments,matchUpsMap,structure,event}){const newAssignments=Object.assign({},...assignments.map(((assignment,index)=>{const{drawPosition}=assignment;return{[drawPosition]:__spreadProps$11(__spreadValues$1X({},assignments[1-index]),{drawPosition})}})));return structure.positionAssignments=structure.positionAssignments.map((assignment=>newAssignments[assignment.drawPosition]||assignment)),cleanupLineUps({inContextDrawMatchUps,tournamentRecord,drawDefinition,matchUpsMap,assignments,structure,event}),__spreadValues$1X({},SUCCESS)}({inContextDrawMatchUps,tournamentRecord,drawDefinition,assignments,matchUpsMap,structure,event})}({inContextDrawMatchUps,tournamentRecord,drawDefinition,drawPositions,matchUpsMap,structure,event}),result.error)return result;conditionallyDisableLinkPositioning({structure,drawPositions});if(addPositionActionTelemetry({drawDefinition,positionAction:{name:"swapDrawPositionAssignments",drawPositions,structureId}}),modifyPositionAssignmentsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,source:"swapDrawPositionAssignments",structure,event}),event.eventType===TEAM_EVENT){const inContextTargetMatchUps=getAllStructureMatchUps({matchUpFilters:{matchUpTypes:[TEAM_MATCHUP]},inContext:!0,structure}).matchUps.filter((matchUp=>{var _a;return null==(_a=matchUp.drawPositions)?void 0:_a.some((drawPosition=>drawPositions.includes(drawPosition)))})),structureMatchUps=getAllStructureMatchUps({structure,matchUpFilters:{matchUpTypes:[TEAM_MATCHUP]}}).matchUps;inContextTargetMatchUps.forEach((inContextTargetMatchUp=>{(inContextTargetMatchUp.sides||[]).forEach((inContextSide=>{var _a;const drawPosition=null==inContextSide?void 0:inContextSide.drawPosition;if(drawPositions.includes(drawPosition)){const teamParticipantId=inContextSide.participantId,matchUp=structureMatchUps.find((({matchUpId})=>matchUpId===inContextTargetMatchUp.matchUpId)),drawPositionSideIndex=null==(_a=null==inContextTargetMatchUp?void 0:inContextTargetMatchUp.sides)?void 0:_a.reduce(((index,side,i)=>side.drawPosition===drawPosition?i:index),void 0);updateSideLineUp({inContextTargetMatchUp,drawPositionSideIndex,teamParticipantId,tournamentRecord,drawDefinition,matchUp,event})}}))}))}return modifyDrawNotice({drawDefinition,structureIds:[structureId]}),__spreadValues$1X({},SUCCESS)}function swapParticipantIdWithBYE({inContextDrawMatchUps,tournamentRecord,drawDefinition,assignments,matchUpsMap,structure,event}){const originalByeAssignment=assignments.find((({bye})=>bye)),originalParticipantIdAssignment=assignments.find((({participantId:participantId2})=>participantId2)),originalByeDrawPosition=originalByeAssignment.drawPosition,{participantId,drawPosition:originalParticipantIdDrawPosition}=originalParticipantIdAssignment,{structureId}=structure;let result=removeDrawPositionAssignment({drawPosition:originalByeDrawPosition,inContextDrawMatchUps,tournamentRecord,drawDefinition,structureId,matchUpsMap});return result.error?result:(result=removeDrawPositionAssignment({drawPosition:originalParticipantIdDrawPosition,inContextDrawMatchUps,tournamentRecord,drawDefinition,structureId,matchUpsMap}),result.error?result:(result=assignDrawPositionBye$1({drawPosition:originalParticipantIdDrawPosition,inContextDrawMatchUps,tournamentRecord,drawDefinition,structureId,matchUpsMap,event}),result=assignDrawPosition$1({drawPosition:originalByeDrawPosition,inContextDrawMatchUps,tournamentRecord,drawDefinition,structureId,participantId,matchUpsMap,event}),result.error?result:__spreadValues$1X({},SUCCESS)))}var __defProp$1W=Object.defineProperty,__getOwnPropSymbols$1X=Object.getOwnPropertySymbols,__hasOwnProp$1X=Object.prototype.hasOwnProperty,__propIsEnum$1X=Object.prototype.propertyIsEnumerable,__defNormalProp$1W=(obj,key,value)=>key in obj?__defProp$1W(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function setSubOrder({tournamentRecord,drawDefinition,drawPosition,structureId,subOrder,event}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structureId)return{error:MISSING_STRUCTURE_ID};if(!drawPosition)return{error:MISSING_DRAW_POSITION};const{structure}=findStructure({drawDefinition,structureId});let targetStructure=structure;structure.structureType===CONTAINER&&(targetStructure=structure.structures.find((currentStructure=>currentStructure.positionAssignments.find((assignment2=>assignment2.drawPosition===drawPosition)))));const positionAssignments=targetStructure.positionAssignments,assignment=positionAssignments.find((assignment2=>assignment2.drawPosition===drawPosition));assignment&&addExtension$1({element:assignment,extension:{name:SUB_ORDER,value:subOrder}});const matchUpFilters=((null==event?void 0:event.eventType)===TEAM$2||drawDefinition.matchUpType===TEAM$2||(null==event?void 0:event.tieFormat)||(null==drawDefinition?void 0:drawDefinition.tieFormat)||(null==structure?void 0:structure.tieFormat))&&{matchUpTypes:[TEAM$2]},{matchUps}=getAllStructureMatchUps({structure:targetStructure,afterRecoveryTimes:!1,inContext:!0,matchUpFilters,event});return updateAssignmentParticipantResults({positionAssignments,tournamentRecord,drawDefinition,matchUpFormat:(null==structure?void 0:structure.matchUpFormat)||drawDefinition.matchUpFormat,matchUps,event}),modifyDrawNotice({drawDefinition,structureIds:[structureId]}),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1X.call(b,prop)&&__defNormalProp$1W(a,prop,b[prop]);if(__getOwnPropSymbols$1X)for(var prop of __getOwnPropSymbols$1X(b))__propIsEnum$1X.call(b,prop)&&__defNormalProp$1W(a,prop,b[prop]);return a})({},SUCCESS)}const positionGovernor={setSubOrder,clearDrawPosition,assignDrawPosition:assignDrawPosition$1,setPositionAssignments:setPositionAssignments$1,automatedPositioning:automatedPositioning$1,assignDrawPositionBye:assignDrawPositionBye$1,swapDrawPositionAssignments:swapDrawPositionAssignments$1,alternateDrawPositionAssignment:alternateDrawPositionAssignment$1,resolveDrawPositions:function resolveDrawPositions({positionAssignments,participantFactors}){if(!participantFactors||!positionAssignments)return{error:MISSING_VALUE};let participantPreferences=makeDeepCopy(participantFactors,!1,!0);const drawPositions=positionAssignments.map((({drawPosition})=>drawPosition)),unassignedDrawPositions=positionAssignments.filter((assignment=>!assignment.participantId&&!assignment.bye&&!assignment.qualifier)).map(getDrawPosition);let drawPositionResolutions,remainingPreferences=!0;for(;remainingPreferences;)({drawPositionResolutions,remainingPreferences,participantPreferences}=resolvePreferences({participantPreferences,drawPositionResolutions}));const resolvedDrawPositions=Object.keys(drawPositionResolutions).map((dp=>parseInt(dp)));let remainingDrawPositions=unassignedDrawPositions.filter((drawPosition=>!resolvedDrawPositions.includes(drawPosition))),unresolvedParticipantIds=Object.keys(participantPreferences);const chunkSizes=generateRange(1,(x=2,y=(null==drawPositions?void 0:drawPositions.length)||0,Math.log(y)/Math.log(x)+1)).map((i=>Math.pow(2,i)));var x,y;const chunkResolution={};for(const chunkSize of chunkSizes){const targetChunks=chunkArray(drawPositions,chunkSize).filter((chunk=>overlap(chunk,remainingDrawPositions))),chunkMap={};unresolvedParticipantIds.forEach((participantId=>{targetChunks.forEach((chunk=>{const chunkSignature=chunk.join("|");overlap(chunk,participantFactors[participantId].preferences)&&(chunkMap[chunkSignature]||(chunkMap[chunkSignature]=[]),chunkMap[chunkSignature].push(participantId))}))}));if(shuffleArray(Object.keys(chunkMap)).forEach((chunkSignature=>{const candidates=chunkMap[chunkSignature].filter((participantId=>unresolvedParticipantIds.includes(participantId)));for(;candidates.length;){const participantId=randomPop(candidates),drawPositions2=chunkSignature.split("|").map((dp=>parseInt(dp))).filter((drawPosition=>remainingDrawPositions.includes(parseInt(drawPosition))));if(drawPositions2.length){const drawPosition=randomPop(drawPositions2);remainingDrawPositions=remainingDrawPositions.filter((dp=>dp!==drawPosition)),unresolvedParticipantIds=unresolvedParticipantIds.filter((id=>id!==participantId)),drawPositionResolutions[drawPosition]=participantId;const chunkSize2=chunkSignature.split("|").length;chunkResolution[chunkSize2]||(chunkResolution[chunkSize2]=0),chunkResolution[chunkSize2]+=1}}})),!remainingDrawPositions.length)break}const report={chunkResolution};return unresolvedParticipantIds.length&&(unresolvedParticipantIds.forEach((participantId=>{const drawPosition=randomPop(remainingDrawPositions);drawPosition&&(drawPositionResolutions[drawPosition]=participantId)})),report.randomAssignment=unresolvedParticipantIds.length),{drawPositionResolutions,report}},initializeStructureSeedAssignments,getNextSeedBlock};function removeDelegatedOutcome$1({drawDefinition,event,matchUpId}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!matchUpId)return{error:MISSING_MATCHUP_ID};const{matchUp}=findMatchUp$1({drawDefinition,event,matchUpId});return matchUp?removeExtension$1({element:matchUp,name:DELEGATED_OUTCOME}):{error:MATCHUP_NOT_FOUND}}function roundCandidate({rankedMatchUpValues,valueSortedPairings,stipulated=[],deltaObjects}){const roundPlayers=[].concat(...stipulated),participantIdPairings=[];let candidateValue=0;stipulated.filter(Boolean).forEach((participantIds=>{const pairing=pairingHash(...participantIds),value=rankedMatchUpValues[pairing];participantIdPairings.push({participantIds,value}),candidateValue+=rankedMatchUpValues[pairing]})),valueSortedPairings.forEach((rankedPairing=>{const participantIds=rankedPairing.pairing.split("|");if(!participantIds.reduce(((p,c)=>roundPlayers.includes(c)||p),!1)){roundPlayers.push(...participantIds);let value=rankedPairing.value;candidateValue+=value,participantIdPairings.push({participantIds,value})}})),participantIdPairings.sort(((a,b)=>a.value-b.value));const maxDelta=participantIdPairings.reduce(((p,c)=>{const hash=pairingHash(...c.participantIds),delta=deltaObjects[hash];return delta>p?delta:p}),0);return{value:candidateValue,participantIdPairings,maxDelta}}function pairingHash(id1,id2){return[id1,id2].sort().join("|")}var __defProp$1V=Object.defineProperty,__defProps$10=Object.defineProperties,__getOwnPropDescs$10=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1W=Object.getOwnPropertySymbols,__hasOwnProp$1W=Object.prototype.hasOwnProperty,__propIsEnum$1W=Object.prototype.propertyIsEnumerable,__defNormalProp$1V=(obj,key,value)=>key in obj?__defProp$1V(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1V=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1W.call(b,prop)&&__defNormalProp$1V(a,prop,b[prop]);if(__getOwnPropSymbols$1W)for(var prop of __getOwnPropSymbols$1W(b))__propIsEnum$1W.call(b,prop)&&__defNormalProp$1V(a,prop,b[prop]);return a},__spreadProps$10=(a,b)=>__defProps$10(a,__getOwnPropDescs$10(b));const ENCOUNTER_VALUE=50,SAME_TEAM_VALUE=60,DEFAULT_RATING=0,MAX_ITERATIONS=5e3;function generateDrawMaticRound({maxIterations=MAX_ITERATIONS,generateMatchUps=!0,tournamentParticipants,tournamentRecord,addToStructure,drawDefinition,participantIds,adHocRatings,structureId,matchUpIds,eventType,structure}){if(!(null==participantIds?void 0:participantIds.length))return{error:MISSING_PARTICIPANT_IDS};const{encounters}=function getEncounters({matchUps}){let encounters=[];for(const matchUp of matchUps){const participantIds=matchUp.sides.map(getParticipantId);if(2===participantIds.length){const pairing=pairingHash(...participantIds);encounters.includes(pairing)||encounters.push(pairing)}}return{encounters}}({matchUps:structure.matchUps}),valueObjects={};for(const pairing of encounters)valueObjects[pairing]||(valueObjects[pairing]=0),valueObjects[pairing]+=ENCOUNTER_VALUE;const teamParticipants=null==tournamentParticipants?void 0:tournamentParticipants.filter((({participantType})=>participantType===TEAM));if(teamParticipants)for(const teamParticipant of teamParticipants){const participantIds2=teamParticipant.individualParticipantIds||[],{uniquePairings:uniquePairings2}=getPairingsData({participantIds:participantIds2});for(const pairing of uniquePairings2)valueObjects[pairing]||(valueObjects[pairing]=0),valueObjects[pairing]+=SAME_TEAM_VALUE}const{uniquePairings,possiblePairings,deltaObjects}=getPairingsData({participantIds}),params={tournamentParticipants,possiblePairings,drawDefinition,participantIds,uniquePairings,maxIterations,adHocRatings,deltaObjects,valueObjects,eventType,structure},{candidatesCount,participantIdPairings,iterations}=function getPairings({tournamentParticipants,adHocRatings={},possiblePairings,uniquePairings,maxIterations,deltaObjects,valueObjects,eventType}){uniquePairings.forEach((pairing=>{const ratings=function getSideRatings({tournamentParticipants,adHocRatings,eventType,pairing}){return pairing.split("|").map((participantId=>{var _a;if(eventType===DOUBLES){const individualParticipantIds=null==(_a=null==tournamentParticipants?void 0:tournamentParticipants.find((participant=>participant.participantId===participantId)))?void 0:_a.individualParticipantIds;return individualParticipantIds?null==individualParticipantIds?void 0:individualParticipantIds.map((participantId2=>adHocRatings[participantId2||DEFAULT_RATING])):2*DEFAULT_RATING}return adHocRatings[participantId]||DEFAULT_RATING}))}({tournamentParticipants,adHocRatings,eventType,pairing}),ratingsDifference=Math.abs(ratings[0]-ratings[1])+1;deltaObjects[pairing]=Math.abs(ratings[0]-ratings[1]),valueObjects[pairing]||(valueObjects[pairing]=0),valueObjects[pairing]+=Math.pow(ratingsDifference,2)}));const valueSortedPairings=uniquePairings.map((pairing=>({pairing,value:valueObjects[pairing]}))).sort(((a,b)=>a.value-b.value)),{pairingValues}=function getParticipantPairingValues({possiblePairings,valueObjects}){let pairingValues={};for(const participantId of Object.keys(possiblePairings)){let participantValues=possiblePairings[participantId].map((opponent=>pairingValue(participantId,opponent)));pairingValues[participantId]=participantValues.sort(((a,b)=>a.value-b.value))}function pairingValue(participantId,opponent){let key=pairingHash(participantId,opponent);return{opponent,value:valueObjects[key]}}return{pairingValues}}({possiblePairings,valueObjects}),{candidate,candidatesCount,iterations}=function generateCandidate({maxIterations=5e3,valueSortedPairings,pairingValues,deltaObjects}){const rankedMatchUpValues=Object.assign({},...valueSortedPairings.map((rm=>({[rm.pairing]:rm.value}))));let candidate=roundCandidate({rankedMatchUpValues,valueSortedPairings,deltaObjects}),deltaCandidate=candidate;const actors=Object.keys(pairingValues);let iterations,candidatesCount=0,opponentCount=actors.length;do{opponentCount-=1,iterations=actors.length*opponentCount*valueSortedPairings.length/2}while(iterations>maxIterations&&opponentCount>2);let stipulatedPairs=[];return actors.forEach((actor=>{pairingValues[actor].slice(0,opponentCount).forEach((pairing=>{const stipulatedPair=pairingHash(actor,pairing.opponent);if(!stipulatedPairs.includes(stipulatedPair)){const proposed=roundCandidate({stipulated:[[actor,pairing.opponent]],rankedMatchUpValues,valueSortedPairings,deltaObjects});proposed.maxDelta<deltaCandidate.maxDelta&&(deltaCandidate=proposed),proposed.value<candidate.value&&(candidate=proposed),stipulatedPairs.push(stipulatedPair),candidatesCount+=1}}))})),{candidate,deltaCandidate,candidatesCount,iterations}}({valueSortedPairings,maxIterations,pairingValues,deltaObjects}),{participantIdPairings}=candidate;return{candidatesCount,participantIdPairings,iterations}}(params);if(!candidatesCount)return{error:NO_CANDIDATES};let matchUps;if(generateMatchUps){const result=generateAdHocMatchUps$1({participantIdPairings,tournamentRecord,addToStructure,drawDefinition,newRound:!0,structureId,matchUpIds});if(result.error)return result;matchUps=result.matchUps}return __spreadProps$10(__spreadValues$1V({},SUCCESS),{participantIdPairings,candidatesCount,iterations,matchUps})}function getPairingsData({participantIds}){const possiblePairings={},uniquePairings=[];participantIds.forEach((participantId=>{possiblePairings[participantId]=participantIds.filter((id=>id!==participantId)),possiblePairings[participantId].forEach((id=>{const pairing=pairingHash(id,participantId);uniquePairings.includes(pairing)||uniquePairings.push(pairing)}))}));const deltaObjects=Object.assign({},...uniquePairings.map((pairing=>({[pairing]:0}))));return{uniquePairings,possiblePairings,deltaObjects}}function drawMatic$1({tournamentParticipants,restrictEntryStatus,tournamentRecord,generateMatchUps,addToStructure,drawDefinition,participantIds,maxIterations,structureId,matchUpIds,scaleName,event}){var _a,_b,_c;if("object"!=typeof drawDefinition||drawDefinition.drawType&&drawDefinition.drawType!==AD_HOC)return{error:INVALID_DRAW_DEFINITION};if(!Array.isArray(drawDefinition.entries)||participantIds&&!Array.isArray(participantIds))return{error:INVALID_VALUES,info:"Missing Entries"};const{eventType}=event||{},enteredParticipantIds=drawDefinition.entries.filter((({entryStatus})=>!restrictEntryStatus||STRUCTURE_SELECTED_STATUSES.includes(entryStatus))).map(getParticipantId);if(participantIds){const invalidParticipantIds=participantIds.filter((participantId=>!enteredParticipantIds.includes(participantId)));if(null==invalidParticipantIds?void 0:invalidParticipantIds.length)return{error:INVALID_PARTICIPANT_ID,invalidParticipantIds}}else participantIds=enteredParticipantIds;if(!structureId){const targetStructure=null==(_b=null==(_a=drawDefinition.structures)?void 0:_a.filter((structure2=>1===structure2.stageSequence)))?void 0:_b.reduce(((targetStructure2,structure2)=>{const orderNumber=stageOrder$1[structure2.stage];return isAdHoc({drawDefinition,structure:structure2})&&orderNumber>(stageOrder$1[null==targetStructure2?void 0:targetStructure2.stage]||1)?structure2:targetStructure2}),void 0);structureId=null==targetStructure?void 0:targetStructure.structureId}const structure=null==(_c=drawDefinition.structures)?void 0:_c.find((structure2=>structure2.structureId===structureId));if(!structure)return{error:STRUCTURE_NOT_FOUND};if(!isAdHoc({drawDefinition,structure}))return{error:INVALID_DRAW_DEFINITION};const adHocRatings={};for(const participantId of participantIds){const participant=null==tournamentParticipants?void 0:tournamentParticipants.find((participant2=>participant2.participantId===participantId));let scaleValue=getScaleValue({eventType,participant});!scaleValue&&scaleName&&(scaleValue=getScaleValue({scaleValue,eventType,participant})),scaleValue&&(adHocRatings[participantId]=scaleValue)}return generateDrawMaticRound({tournamentParticipants,tournamentRecord,generateMatchUps,addToStructure,drawDefinition,participantIds,maxIterations,adHocRatings,matchUpIds,structureId,structure,eventType})}function getScaleValue({scaleName="dynamic",eventType,participant}){var _a;const result=participant&&participantScaleItem({scaleAttributes:{eventType:eventType||SINGLES,scaleType:RATING$2,scaleName},participant});return null==(_a=null==result?void 0:result.scaleItem)?void 0:_a.scaleValue}function setDelegatedOutcome$1({drawDefinition,matchUpId,outcome,matchUp}){var _a,_b;if(!matchUp&&!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!outcome)return{error:MISSING_VALUE,info:"missing outcome"};if(!matchUp&&!matchUpId)return{error:MISSING_MATCHUP};if(!matchUp){const result=findMatchUp$1({drawDefinition,matchUpId});if(result.error)return result;matchUp=result.matchUp}if("object"!=typeof outcome||!(null==(_a=outcome.score)?void 0:_a.scoreStringSide1)||!(null==(_b=outcome.score)?void 0:_b.scoreStringSide2))return{error:INVALID_VALUES};return addExtension$1({element:matchUp,extension:{name:DELEGATED_OUTCOME,value:outcome}})}function validDrawPosition(drawPosition){return null!==drawPosition&&(void 0===drawPosition||!isNaN(drawPosition))}function disableTieAutoCalc$1({drawDefinition,matchUpId,event}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const{matchUp}=findMatchUp$1({drawDefinition,matchUpId,event});return addExtension$1({extension:{name:DISABLE_AUTO_CALC,value:!0},element:matchUp})}function enableTieAutoCalc$1({tournamentRecord,drawDefinition,matchUpId,event}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const{matchUp}=findMatchUp$1({drawDefinition,matchUpId,event});return(null==matchUp?void 0:matchUp.matchUpType)!==TEAM_MATCHUP?{error:INVALID_MATCHUP}:setMatchUpStatus$2({enableAutoCalc:!0,tournamentRecord,drawDefinition,matchUpId,event})}var __defProp$1U=Object.defineProperty,__getOwnPropSymbols$1V=Object.getOwnPropertySymbols,__hasOwnProp$1V=Object.prototype.hasOwnProperty,__propIsEnum$1V=Object.prototype.propertyIsEnumerable,__defNormalProp$1U=(obj,key,value)=>key in obj?__defProp$1U(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1U=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1V.call(b,prop)&&__defNormalProp$1U(a,prop,b[prop]);if(__getOwnPropSymbols$1V)for(var prop of __getOwnPropSymbols$1V(b))__propIsEnum$1V.call(b,prop)&&__defNormalProp$1U(a,prop,b[prop]);return a};function setOrderOfFinish$1({drawDefinition,finishingOrder}){var _a;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const stack="setOrderOfFinish";if(!Array.isArray(finishingOrder))return decorateResult({result:{error:INVALID_VALUES},info:mustBeAnArray("finishingOrder"),stack});const{completedMatchUps,matchUpsMap}=getDrawMatchUps({inContext:!0,drawDefinition}),matchUpIds=completedMatchUps.map(getMatchUpId),targetMatchUpIds=finishingOrder.map(getMatchUpId),{matchUpTypes,roundNumbers,structureIds,matchUpTieIds}=completedMatchUps.filter((({matchUpId})=>targetMatchUpIds.includes(matchUpId))).reduce(((aggregator,matchUp)=>{const{matchUpTieId,matchUpType,roundNumber,structureId}=matchUp;return aggregator.matchUpTypes.includes(matchUpType)||aggregator.matchUpTypes.push(matchUpType),aggregator.roundNumbers.includes(roundNumber)||aggregator.roundNumbers.push(roundNumber),aggregator.structureIds.includes(structureId)||aggregator.structureIds.push(structureId),aggregator.matchUpTieIds.includes(matchUpTieId)||aggregator.matchUpTieIds.push(matchUpTieId),aggregator}),{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(matchUpTypes.length>1||matchUpTieIds.length>1||roundNumbers.length>1||structureIds.length>1)return decorateResult({result:{error:INVALID_VALUES},info:"matchUpType, structureId and roundNumber must be equivalent",stack});let validMatchUpId,validOrderOfFinish;const valuesMap={},targetedMatchUpIds=[],orderOfFinishValues=[],validValues=finishingOrder.every((({orderOfFinish,matchUpId})=>(targetedMatchUpIds.push(matchUpId),orderOfFinish&&orderOfFinishValues.push(orderOfFinish),valuesMap[matchUpId]=orderOfFinish,validMatchUpId=matchUpIds.includes(matchUpId),validOrderOfFinish=void 0===orderOfFinish||isConvertableInteger(orderOfFinish)&&Math.floor(orderOfFinish)>0,validMatchUpId&&validOrderOfFinish)));if(!validValues)return decorateResult({result:{error:validMatchUpId?INVALID_VALUES:INVALID_MATCHUP_STATUS},info:validMatchUpId?validOrderOfFinish?void 0:"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed",stack});const otherCohortMatchUps=completedMatchUps.filter((matchUp=>matchUp.structureId===structureIds[0]&&matchUp.roundNumber===roundNumbers[0]&&matchUp.matchUpType===matchUpTypes[0]&&matchUp.matchUpTieId===matchUpTieIds[0]&&!targetedMatchUpIds.includes(matchUp.matchUpId)));for(const matchUp of otherCohortMatchUps){const{orderOfFinish}=matchUp||{};if(orderOfFinish){if(!isConvertableInteger(orderOfFinish))return decorateResult({result:{error:INVALID_VALUES},context:{orderOfFinish},matchUp,stack});orderOfFinishValues.push(orderOfFinish)}}if(uniqueValues(orderOfFinishValues).length!==orderOfFinishValues.length||Math.max(...orderOfFinishValues)>orderOfFinishValues.length)return decorateResult({result:{error:INVALID_VALUES},info:"Values not unique or greater than expected number of values",stack});if(structureIds.length){const result=getStructureMatchUps({matchUpFilters:{matchUpIds:targetMatchUpIds},structureId:structureIds[0],drawDefinition,matchUpsMap});if(result.error)return decorateResult({result,stack});null==(_a=result.completedMatchUps)||_a.forEach((matchUp=>matchUp.orderOfFinish=valuesMap[matchUp.matchUpId]))}return __spreadValues$1U({},SUCCESS)}var __defProp$1T=Object.defineProperty,__defProps$$=Object.defineProperties,__getOwnPropDescs$$=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1U=Object.getOwnPropertySymbols,__hasOwnProp$1U=Object.prototype.hasOwnProperty,__propIsEnum$1U=Object.prototype.propertyIsEnumerable,__defNormalProp$1T=(obj,key,value)=>key in obj?__defProp$1T(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1T=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1U.call(b,prop)&&__defNormalProp$1T(a,prop,b[prop]);if(__getOwnPropSymbols$1U)for(var prop of __getOwnPropSymbols$1U(b))__propIsEnum$1U.call(b,prop)&&__defNormalProp$1T(a,prop,b[prop]);return a},__spreadProps$$=(a,b)=>__defProps$$(a,__getOwnPropDescs$$(b));function getCollectionsValue(definitions,aggregator){let totalMatchUps=0;return{totalValue:aggregator.collectionIds.reduce(((total,collectionId)=>{const collectionDefinition=definitions[collectionId],{collectionValueProfile,collectionValue,matchUpCount,matchUpValue}=collectionDefinition;return totalMatchUps+=matchUpCount,collectionValueProfile?collectionValueProfile.reduce(((total2,profile)=>total2+profile.value),0):matchUpValue&&matchUpCount?matchUpValue*matchUpCount:collectionValue}),0),totalMatchUps}}var __defProp$1S=Object.defineProperty,__defProps$_=Object.defineProperties,__getOwnPropDescs$_=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1T=Object.getOwnPropertySymbols,__hasOwnProp$1T=Object.prototype.hasOwnProperty,__propIsEnum$1T=Object.prototype.propertyIsEnumerable,__defNormalProp$1S=(obj,key,value)=>key in obj?__defProp$1S(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1S=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1T.call(b,prop)&&__defNormalProp$1S(a,prop,b[prop]);if(__getOwnPropSymbols$1T)for(var prop of __getOwnPropSymbols$1T(b))__propIsEnum$1T.call(b,prop)&&__defNormalProp$1S(a,prop,b[prop]);return a},__spreadProps$_=(a,b)=>__defProps$_(a,__getOwnPropDescs$_(b));function resetTieFormat({tournamentRecord,drawDefinition,matchUpId,event,uuids}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if("string"!=typeof matchUpId)return{error:MISSING_MATCHUP_ID};let result=findMatchUp({tournamentRecord,matchUpId});if(result.error)return result;const{matchUp,structure}=result;if(!matchUp.tieMatchUps)return{error:INVALID_MATCHUP,info:"Must be a TEAM matchUp"};if(!matchUp.tieFormat)return __spreadValues$1S({},SUCCESS);const tieFormat=structure.tieFormat||(null==drawDefinition?void 0:drawDefinition.tieFormat)||(null==event?void 0:event.tieFormat);if(!tieFormat)return{error:NOT_FOUND,info:"No inherited tieFormat"};const deletedMatchUpIds=[],collectionIds=[],newMatchUps=[],tieMatchUps=[];for(const collectionDefinition of tieFormat.collectionDefinitions){const{matchUpCount,collectionId}=collectionDefinition;collectionIds.push(collectionId);const existingCollectionMatchUps=(matchUp.tieMatchUps||[]).filter((matchUp2=>matchUp2.collectionId===collectionId));if(existingCollectionMatchUps.length>matchUpCount)existingCollectionMatchUps.sort(((a,b)=>(a.matchUpStatus===TO_BE_PLAYED?1:0)-(b.matchUpStatus===TO_BE_PLAYED?1:0))),tieMatchUps.push(...existingCollectionMatchUps.slice(0,matchUpCount)),deletedMatchUpIds.push(...existingCollectionMatchUps.slice(3).map(getMatchUpId));else if(tieMatchUps.push(...existingCollectionMatchUps),existingCollectionMatchUps.length<matchUpCount){const matchUps=generateCollectionMatchUps({collectionDefinition,matchUpsLimit:matchUpCount-existingCollectionMatchUps.length,uuids});newMatchUps.push(...matchUps)}}for(const tieMatchUp of matchUp.tieMatchUps||[])collectionIds.includes(tieMatchUp.collectionId)||deletedMatchUpIds.push(tieMatchUp.matchUpId);return newMatchUps.length&&(tieMatchUps.push(...newMatchUps),addMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:event.eventId,matchUps:newMatchUps,drawDefinition})),deletedMatchUpIds.length&&deleteMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUpIds:deletedMatchUpIds,eventId:null==event?void 0:event.eventId,drawDefinition}),matchUp.tieMatchUps=tieMatchUps,matchUp.tieFormat=void 0,modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,structureId:structure.structureId,eventId:event.eventId,context:"resetTieFormat",drawDefinition,matchUp}),__spreadProps$_(__spreadValues$1S({},SUCCESS),{newMatchUps,deletedMatchUpIds})}var __defProp$1R=Object.defineProperty,__getOwnPropSymbols$1S=Object.getOwnPropertySymbols,__hasOwnProp$1S=Object.prototype.hasOwnProperty,__propIsEnum$1S=Object.prototype.propertyIsEnumerable,__defNormalProp$1R=(obj,key,value)=>key in obj?__defProp$1R(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1R=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1S.call(b,prop)&&__defNormalProp$1R(a,prop,b[prop]);if(__getOwnPropSymbols$1S)for(var prop of __getOwnPropSymbols$1S(b))__propIsEnum$1S.call(b,prop)&&__defNormalProp$1R(a,prop,b[prop]);return a};function resetScorecard$1(params){const{tournamentRecord,drawDefinition,matchUpId,event}=params,stack="resetScorecard";if(!drawDefinition)return decorateResult({result:{error:MISSING_DRAW_DEFINITION},stack});if(!matchUpId)return decorateResult({result:{error:MISSING_MATCHUP_ID},stack});if("string"!=typeof matchUpId)return decorateResult({result:{error:INVALID_VALUES,matchUpId},stack});const matchUpsMap=getMatchUpsMap({drawDefinition});let{matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,nextMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap});const matchUp=matchUpsMap.drawMatchUps.find((matchUp2=>matchUp2.matchUpId===matchUpId)),inContextMatchUp=inContextDrawMatchUps.find((matchUp2=>matchUp2.matchUpId===matchUpId));if(!matchUp||!inContextDrawMatchUps)return{error:MATCHUP_NOT_FOUND};if(!matchUp.matchUpType===TEAM$2)return{error:INVALID_MATCHUP};const targetData=positionTargets({inContextDrawMatchUps,drawDefinition,matchUpId}),structureId=inContextMatchUp.structureId,{structure}=findStructure({drawDefinition,structureId});Object.assign(params,{inContextDrawMatchUps,inContextMatchUp,matchUpsMap,targetData,structure,matchUp});if(isActiveDownstream(params))return{error:CANNOT_CHANGE_WINNING_SIDE};for(const tieMatchUp of matchUp.tieMatchUps){const result2=setMatchUpStatus$2({matchUpId:tieMatchUp.matchUpId,matchUpTieId:matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord,drawDefinition,event});if(result2.error)return decorateResult({result:result2,stack})}let result=updateTieMatchUpScore$1({event:params.event,removeScore:!0,tournamentRecord,drawDefinition,matchUpId});if(result.error)return decorateResult({result,stack});if(params.tiebreakReset&&!result.tieFormatRemoved){const inheritedTieFormat=(null==structure?void 0:structure.tieFormat)||drawDefinition.tieFormat||(null==event?void 0:event.tieFormat);if(inheritedTieFormat){const{ancestorDifferences,descendantDifferences}=function compareTieFormats({ancestor,descendant}){var _a,_b;const descendantDifferences={},ancestorDifferences={},descendantCollectionDefinitions=Object.assign({},...descendant.collectionDefinitions.map((collectionDefinition=>({[collectionDefinition.collectionId]:collectionDefinition})))),ancestorCollectionDefinitions=Object.assign({},...ancestor.collectionDefinitions.map((collectionDefinition=>({[collectionDefinition.collectionId]:collectionDefinition}))));return descendantDifferences.collectionIds=difference(Object.keys(descendantCollectionDefinitions),Object.keys(ancestorCollectionDefinitions)),ancestorDifferences.collectionIds=difference(Object.keys(ancestorCollectionDefinitions),Object.keys(descendantCollectionDefinitions)),descendantDifferences.collectionsValue=getCollectionsValue(descendantCollectionDefinitions,descendantDifferences),ancestorDifferences.collectionsValue=getCollectionsValue(ancestorCollectionDefinitions,ancestorDifferences),descendantDifferences.groupsCount=(null==(_a=ancestor.collectionGroups)?void 0:_a.length)||0-(null==(_b=descendant.collectionGroups)?void 0:_b.length)||0,ancestorDifferences.groupsCount=-1*descendantDifferences.groupsCount,__spreadProps$$(__spreadValues$1T({},SUCCESS),{ancestorDifferences,descendantDifferences})}({descendant:matchUp.tieFormat,ancestor:inheritedTieFormat}),valueDifference=descendantDifferences.collectionsValue.totalValue-ancestorDifferences.collectionsValue.totalValue,matchUpCountDifference=descendantDifferences.collectionsValue.totalMatchUps-ancestorDifferences.collectionsValue.totalMatchUps;if(1===descendantDifferences.collectionIds.length&&!ancestorDifferences.collectionIds.length&&!ancestorDifferences.groupsCount&&1===matchUpCountDifference&&1===valueDifference){const result2=resetTieFormat({tournamentRecord,drawDefinition,matchUpId,event});if(result2.error)return result2}}}return __spreadValues$1R({},SUCCESS)}const matchUpGovernor={resetScorecard:resetScorecard$1,setMatchUpStatus:setMatchUpStatus$2,setMatchUpFormat:setMatchUpFormat$1,updateTieMatchUpScore:updateTieMatchUpScore$1,isValidMatchUpFormat:isValid,disableTieAutoCalc:disableTieAutoCalc$1,enableTieAutoCalc:enableTieAutoCalc$1,addFinishingRounds,addMatchUpTimeItem,resetMatchUpTimeItems:function resetMatchUpTimeItems({tournamentRecord,drawDefinition,matchUpId,event}){const{matchUp}=findMatchUp$1({drawDefinition,event,matchUpId});return matchUp?(matchUp.timeItems=[],modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,context:"resetTimeItems",eventId:null==event?void 0:event.eventId,drawDefinition,matchUp}),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4i.call(b,prop)&&__defNormalProp$4h(a,prop,b[prop]);if(__getOwnPropSymbols$4i)for(var prop of __getOwnPropSymbols$4i(b))__propIsEnum$4i.call(b,prop)&&__defNormalProp$4h(a,prop,b[prop]);return a})({},SUCCESS)):{error:MATCHUP_NOT_FOUND}},checkInParticipant:checkInParticipant$1,checkOutParticipant:checkOutParticipant$1,getCheckedInParticipantIds,addMatchUpScheduleItems:addMatchUpScheduleItems$2,addMatchUpScheduledDate:addMatchUpScheduledDate$2,addMatchUpScheduledTime:addMatchUpScheduledTime$2,addMatchUpStartTime:addMatchUpStartTime$2,addMatchUpEndTime:addMatchUpEndTime$2,addMatchUpStopTime:addMatchUpStopTime$2,addMatchUpResumeTime:addMatchUpResumeTime$2,addGoesTo,setOrderOfFinish:setOrderOfFinish$1,setDelegatedOutcome:setDelegatedOutcome$1,removeDelegatedOutcome:removeDelegatedOutcome$1,drawMatic:drawMatic$1,addMatchUpOfficial:addMatchUpOfficial$2,findMatchUp:function publicFindMatchUp$1(params){return Object.assign(params,{inContext:!0}),{matchUp:makeDeepCopy(findMatchUp$1(params).matchUp,!1,!0)}},getRoundMatchUps:getRoundMatchUps$1,validDrawPositions:function validDrawPositions({matchUps}){if(!matchUps)return{error:MISSING_MATCHUPS};const drawPositions=matchUps.map((matchUp=>matchUp.drawPositions)).flat();getDevContext()&&matchUps.forEach((matchUp=>{var _a;Array.isArray(matchUp.drawPositions)?null==(_a=matchUp.drawPositions)||_a.forEach((drawPosition=>{validDrawPosition(drawPosition)||console.log("invalid drawPosition",matchUp)})):console.log("drawPositions not an array",matchUp)}));const allPositionsValid=null==drawPositions?void 0:drawPositions.every(validDrawPosition),matchUpDrawPositionsNotArray=matchUps.find((matchUp=>!Array.isArray(matchUp.drawPositions)));return allPositionsValid&&!matchUpDrawPositionsNotArray},validateScore};var __defProp$1Q=Object.defineProperty,__getOwnPropSymbols$1R=Object.getOwnPropertySymbols,__hasOwnProp$1R=Object.prototype.hasOwnProperty,__propIsEnum$1R=Object.prototype.propertyIsEnumerable,__defNormalProp$1Q=(obj,key,value)=>key in obj?__defProp$1Q(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1Q=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1R.call(b,prop)&&__defNormalProp$1Q(a,prop,b[prop]);if(__getOwnPropSymbols$1R)for(var prop of __getOwnPropSymbols$1R(b))__propIsEnum$1R.call(b,prop)&&__defNormalProp$1Q(a,prop,b[prop]);return a};function attachPolicies({drawDefinition,policyDefinitions}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!policyDefinitions||"object"!=typeof policyDefinitions)return{error:MISSING_POLICY_DEFINITION};drawDefinition.extensions||(drawDefinition.extensions=[]);const{appliedPolicies}=getAppliedPolicies({drawDefinition}),applied=Object.keys(policyDefinitions).every((policyType=>!appliedPolicies[policyType]&&(appliedPolicies[policyType]=policyDefinitions[policyType],!0)));if(applied){const result=addExtension$1({element:drawDefinition,extension:{name:APPLIED_POLICIES,value:appliedPolicies}});if(result.error)return result}return modifyDrawNotice({drawDefinition}),applied?__spreadValues$1Q({},SUCCESS):{error:EXISTING_POLICY_TYPE}}const policyGovernor$1={attachPolicies};function getParticipantIdMatchUps({tournamentParticipants,drawDefinition,event}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const allMatchUps=makeDeepCopy(getAllDrawMatchUps({tournamentParticipants,inContext:!0,drawDefinition,event}).matchUps,!1,!0),participantIds=unique(allMatchUps.reduce(((participantIds2,matchUp)=>participantIds2.concat(...matchUp.sides.map((side=>side.participantId)).filter(Boolean))),[])),participantIdMatchUps=Object.assign({},...participantIds.map((participantId=>{const matchUps=allMatchUps.filter((matchUp=>matchUp.sides.map((side=>side.participantId)).filter(Boolean).includes(participantId)));return{[participantId]:matchUps}})));return{participantIds,participantIdMatchUps}}function getParticipantIdFinishingPositions$1({byeAdvancements=!1,tournamentParticipants,drawDefinition}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const{participantIds,participantIdMatchUps}=getParticipantIdMatchUps({tournamentParticipants,drawDefinition}),participantIdFinishingPositions=participantIds.map((participantId=>{const relevantMatchUps=participantIdMatchUps[participantId].filter((matchUp=>[COMPLETED$1,BYE].includes(matchUp.matchUpStatus)||matchUp.winningSide)),finishingPositionRanges=relevantMatchUps.map((matchUp=>{const isByeMatchUp=matchUp.sides.find((side=>side.bye)),participantSide=matchUp.sides.find((side=>side.participantId===participantId)).sideNumber;return(matchUp.winningSide||byeAdvancements&&isByeMatchUp&&participantSide)===participantSide?matchUp.finishingPositionRange.winner:matchUp.finishingPositionRange.loser})),diff=range=>Math.abs(range[0]-range[1]),finishingPositionRange=finishingPositionRanges.reduce(((finishingPositionRange2,range)=>finishingPositionRange2&&diff(finishingPositionRange2)<diff(range)?finishingPositionRange2:range),void 0);return{[participantId]:{relevantMatchUps,finishingPositionRanges,finishingPositionRange}}}));return Object.assign({},...participantIdFinishingPositions)}const queryGovernor$2={allPlayoffPositionsFilled,isCompletedStructure,getAllStructureMatchUps,getStructureMatchUps,allStructureMatchUps:function allStructureMatchUps(params){const{structure}=findStructure(params);return Object.assign(params,{structure,inContext:!0}),getAllStructureMatchUps(params)},allDrawMatchUps:function allDrawMatchUps(params){return Object.assign(params,{inContext:!0}),getAllDrawMatchUps(params)},drawMatchUps:function drawMatchUps(params){return Object.assign(params,{inContext:!0}),getDrawMatchUps(params)},getEliminationDrawSize,getParticipantIdMatchUps,getParticipantIdFinishingPositions:getParticipantIdFinishingPositions$1,getEligibleVoluntaryConsolationParticipants:getEligibleVoluntaryConsolationParticipants$1,structureActions:function structureActions(params){return(null==params?void 0:params.drawDefinition)?{actions:[],state:{isComplete:isCompletedStructure(params),hasPlayoffPositionsFilled:allPlayoffPositionsFilled(params)}}:{error:MISSING_DRAW_DEFINITION}},matchUpActions:matchUpActions$2,positionActions:positionActions$1,getStructureSeedAssignments,getNextUnfilledDrawPositions:function getNextUnfilledDrawPositions({provisionalPositioning,drawDefinition,seedBlockInfo,structureId}){if(!drawDefinition){return{error:MISSING_DRAW_DEFINITION,nextUnfilledDrawPositions:[]}}if(!structureId){return{error:MISSING_STRUCTURE_ID,nextUnfilledDrawPositions:[]}}const result=findStructure({drawDefinition,structureId});if(result.error)return result;const{positionAssignments=[]}=structureAssignedDrawPositions({structure:result.structure}),{unfilledPositions}=getNextSeedBlock({provisionalPositioning,randomize:!0,drawDefinition,seedBlockInfo,structureId}),unfilledDrawPositions=positionAssignments.filter((assignment=>!assignment.participantId&&!assignment.bye&&!assignment.qualifier)).map((assignment=>assignment.drawPosition));return(null==unfilledPositions?void 0:unfilledPositions.length)?{nextUnfilledDrawPositions:unfilledPositions}:{nextUnfilledDrawPositions:unfilledDrawPositions}},getExitProfiles,getValidGroupSizes,getSeedingThresholds:function getSeedingThresholds({roundRobinGroupsCount,participantsCount}){if(roundRobinGroupsCount){const{validGroupSizes}=getValidGroupSizes({drawSize:participantsCount});if(!validGroupSizes.map((groupSize=>Math.ceil(participantsCount/groupSize))).includes(roundRobinGroupsCount))return decorateResult({result:{error:INVALID_VALUES},context:{roundRobinGroupsCount}})}const{seedGroups}=getSeedGroups({drawSize:participantsCount,roundRobinGroupsCount}),seedingThresholds=(null==seedGroups?void 0:seedGroups.map((seedNumberBlock=>Math.min(...seedNumberBlock))))||[];return __spreadProps$2j(__spreadValues$3$({},SUCCESS),{seedingThresholds})},getSeedBlocks,getSeedGroups,getMatchUpContextIds:function getMatchUpContextIds({matchUps,matchUpId}){if(!Array.isArray(matchUps))return{error:INVALID_VALUES};const matchUp=matchUps.find((matchUp2=>matchUp2.matchUpId===matchUpId)),{drawId,eventId,structureId,tournamentId}=matchUp||{};return{matchUpId,drawId,eventId,structureId,tournamentId}},getMatchUpParticipantIds,getMatchUpScheduleDetails,generateTieMatchUpScore,matchUpDuration,credits};var __defProp$1P=Object.defineProperty,__getOwnPropSymbols$1Q=Object.getOwnPropertySymbols,__hasOwnProp$1Q=Object.prototype.hasOwnProperty,__propIsEnum$1Q=Object.prototype.propertyIsEnumerable,__defNormalProp$1P=(obj,key,value)=>key in obj?__defProp$1P(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1P=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1Q.call(b,prop)&&__defNormalProp$1P(a,prop,b[prop]);if(__getOwnPropSymbols$1Q)for(var prop of __getOwnPropSymbols$1Q(b))__propIsEnum$1Q.call(b,prop)&&__defNormalProp$1P(a,prop,b[prop]);return a};function modifySeedAssignment$1({validation=!0,tournamentRecord,drawDefinition,participantId,structureId,seedValue,event}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!structureId)return{error:MISSING_STRUCTURE_ID};const{structure}=findStructure({drawDefinition,structureId});if(!structure)return{error:STRUCTURE_NOT_FOUND};if(!(!validation||isNumeric(seedValue)||[void 0,""].includes(seedValue)||"string"==typeof seedValue&&seedValue.split("-").every((v=>isNumeric(v)&&v>0))))return{error:INVALID_VALUES};const{seedAssignments}=getStructureSeedAssignments({drawDefinition,structure}),seedNumbers=seedAssignments.map((assignment=>assignment.seedNumber)),existingAssginment=seedAssignments.find((assignment=>assignment.participantId===participantId));if(existingAssginment){const newValue="string"==typeof seedValue&&seedValue.includes("-")?seedValue.split("-").map((v=>parseInt(v))).join("-"):seedValue>0?parseInt(seedValue):"";existingAssginment.seedValue=newValue}else{const seedNumber=Math.max(0,...seedNumbers)+1;structure.seedAssignments.push({seedNumber,seedValue,participantId})}return modifySeedAssignmentsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,structureIds:[structureId],eventId:null==event?void 0:event.eventId,drawDefinition,structure}),__spreadValues$1P({},SUCCESS)}var __defProp$1O=Object.defineProperty,__getOwnPropSymbols$1P=Object.getOwnPropertySymbols,__hasOwnProp$1P=Object.prototype.hasOwnProperty,__propIsEnum$1P=Object.prototype.propertyIsEnumerable,__defNormalProp$1O=(obj,key,value)=>key in obj?__defProp$1O(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const entryGovernor={setStageAlternatesCount:function setStageAlternatesCount({alternatesCount,drawDefinition,stage}){var _a;return drawDefinition?stageExists({drawDefinition,stage})?(modifyEntryProfile({attributes:[{[stage]:{alternates:alternatesCount}}],drawDefinition}),alternatesCount||(drawDefinition.entries=(null==(_a=drawDefinition.entries)?void 0:_a.filter((entry=>entry.entryStatus!==ALTERNATE)))||[]),modifyDrawNotice({drawDefinition}),__spreadValues$2B({},SUCCESS)):{error:INVALID_STAGE}:{error:MISSING_DRAW_DEFINITION}},setStageWildcardsCount:function setStageWildcardsCount({wildcardsCount=0,drawDefinition,stageSequence,stage}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!stageExists({drawDefinition,stage}))return{error:INVALID_STAGE};const stageDrawPositions=getStageDrawPositionsCount({drawDefinition,stage}),{qualifiersCount}=getQualifiersCount({drawDefinition,stageSequence,stage}),wildcardEntriesCount=function getStageWildcardEntriesCount({stage,drawDefinition}){return getStageEntryTypeCount({entryStatus:WILDCARD,drawDefinition,stage})}({drawDefinition,stage}),directAcceptanceEntriesCount=getStageDirectEntriesCount({drawDefinition,stage});if(wildcardsCount<wildcardEntriesCount){return{error:Object.assign(DRAW_SIZE_MISMATCH,{message:"Number of Wildcards cannot be less than number of Wildcards already entered"})}}return directAcceptanceEntriesCount+wildcardsCount+qualifiersCount>stageDrawPositions?{error:DRAW_SIZE_MISMATCH,info:"Total stage Entries cannot be greater than drawPositions"}:(modifyEntryProfile({attributes:[{[stage]:{wildcardsCount}}],drawDefinition}),modifyDrawNotice({drawDefinition}),__spreadValues$2B({},SUCCESS))},setStageQualifiersCount,modifySeedAssignment:modifySeedAssignment$1,setStageDrawSize,addDrawEntries:addDrawEntries$1,addDrawEntry,removeEntry:function removeEntry({autoEntryPositions=!0,drawDefinition,participantId,stages}){return drawDefinition?participantId?getAssignedParticipantIds({drawDefinition,stages}).includes(participantId)?{error:EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT}:((null==drawDefinition?void 0:drawDefinition.entries)&&(drawDefinition.entries=drawDefinition.entries.filter((entry=>entry.participantId!==participantId))),autoEntryPositions&&(drawDefinition.entries=refreshEntryPositions({entries:drawDefinition.entries})),modifyDrawNotice({drawDefinition}),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1P.call(b,prop)&&__defNormalProp$1O(a,prop,b[prop]);if(__getOwnPropSymbols$1P)for(var prop of __getOwnPropSymbols$1P(b))__propIsEnum$1P.call(b,prop)&&__defNormalProp$1O(a,prop,b[prop]);return a})({},SUCCESS)):{error:MISSING_PARTICIPANT_ID}:{error:MISSING_DRAW_DEFINITION}},assignSeed},linkGovernor={generateQualifyingLink},definitionTemplate=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),keyValidation=["drawId","structures"];function setState$3(definition,deepCopyOption=!0){return definition?"object"!=typeof definition?{error:INVALID_OBJECT}:definition.drawId?function validDefinitionKeys(definition){const definitionKeys=Object.keys(definition);return keyValidation.reduce(((p,key)=>!!definitionKeys.includes(key)&&p),!0)}(definition)?deepCopyOption?makeDeepCopy(definition):definition:{error:INVALID_DRAW_DEFINITION}:{error:MISSING_DRAW_ID,method:"setState"}:{error:MISSING_DRAW_DEFINITION}}function newDrawDefinition({drawId=UUID(),matchUpType,drawType}={}){const drawDefinition=definitionTemplate();return Object.assign(drawDefinition,{drawId,drawType,matchUpType})}var __defProp$1N=Object.defineProperty,__defProps$Z=Object.defineProperties,__getOwnPropDescs$Z=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1O=Object.getOwnPropertySymbols,__hasOwnProp$1O=Object.prototype.hasOwnProperty,__propIsEnum$1O=Object.prototype.propertyIsEnumerable,__defNormalProp$1N=(obj,key,value)=>key in obj?__defProp$1N(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1N=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1O.call(b,prop)&&__defNormalProp$1N(a,prop,b[prop]);if(__getOwnPropSymbols$1O)for(var prop of __getOwnPropSymbols$1O(b))__propIsEnum$1O.call(b,prop)&&__defNormalProp$1N(a,prop,b[prop]);return a},__spreadProps$Z=(a,b)=>__defProps$Z(a,__getOwnPropDescs$Z(b));let drawDefinition$1,tournamentParticipants$1=[];const drawEngine=function(){const engine={getState:({convertExtensions,removeExtensions}={})=>({drawDefinition:makeDeepCopy(drawDefinition$1,convertExtensions,!1,removeExtensions)}),version:()=>"1.0.3",reset:()=>(drawDefinition$1=void 0,__spreadValues$1N({},SUCCESS)),newDrawDefinition:({drawId,drawType}={})=>(drawDefinition$1=newDrawDefinition({drawId,drawType}),Object.assign({drawId:drawDefinition$1.drawId,drawDefinition:makeDeepCopy(drawDefinition$1)},SUCCESS)),setDrawDescription:({description}={})=>drawDefinition$1?(drawDefinition$1.description=description,modifyDrawNotice({drawDefinition:drawDefinition$1}),Object.assign({drawId:drawDefinition$1.drawId},SUCCESS)):{error:MISSING_DRAW_DEFINITION}};return function importGovernors(governors){governors.forEach((governor=>{Object.keys(governor).forEach((governorMethod=>{engine[governorMethod]=params=>{if(getDevContext())return invoke({params,governor,governorMethod});try{return invoke({params,governor,governorMethod})}catch(err){const error=err.toString();console.log("ERROR",{params:JSON.stringify(params),drawId:null==drawDefinition$1?void 0:drawDefinition$1.drawId,method:governorMethod,error})}}}))}))}([linkGovernor,queryGovernor$2,scoreGovernor,entryGovernor,policyGovernor$1,matchUpGovernor,positionGovernor,structureGovernor]),engine.devContext=isDev=>(setDevContext(isDev),engine),engine.setParticipants=(participants=[])=>(tournamentParticipants$1=participants,engine),engine.setState=(definition,deepCopyOption,deepCopyAttributes)=>{setDeepCopy(deepCopyOption,deepCopyAttributes);return function processResult(result){return(null==result?void 0:result.error)?(engine.error=result.error,engine.success=!1):(engine.error=void 0,engine.success=!0,drawDefinition$1=result,engine.drawId=result.drawId),engine}(setState$3(definition))},engine;function invoke({params,governor,governorMethod}){delete engine.success,delete engine.error;const snapshot=(null==params?void 0:params.rollbackOnError)&&makeDeepCopy(drawDefinition$1,!1,!0);params=__spreadProps$Z(__spreadValues$1N(__spreadValues$1N({},params),{}),{tournamentParticipants:tournamentParticipants$1,drawDefinition:drawDefinition$1});const result=governor[governorMethod](params);if(null==result?void 0:result.error)return snapshot&&setState$3(snapshot),__spreadProps$Z(__spreadValues$1N({},result),{rolledBack:!!snapshot});const notify=(null==result?void 0:result.success)&&!0!==(null==params?void 0:params.delayNotify)&&!0!==(null==params?void 0:params.doNotNotify);return notify&&notifySubscribers(),(notify||!(null==result?void 0:result.success)||(null==params?void 0:params.doNotNotify))&&deleteNotices(),result}}();Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;var __defProp$1L=Object.defineProperty,__getOwnPropSymbols$1M=Object.getOwnPropertySymbols,__hasOwnProp$1M=Object.prototype.hasOwnProperty,__propIsEnum$1M=Object.prototype.propertyIsEnumerable,__defNormalProp$1L=(obj,key,value)=>key in obj?__defProp$1L(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function getOrderedTieFormat({tieFormat,orderMap}){const orderedTieFormat=copyTieFormat(tieFormat);return orderedTieFormat.collectionDefinitions.forEach((collectionDefinition=>{const collectionOrder=orderMap[collectionDefinition.collectionId];collectionOrder&&(collectionDefinition.collectionOrder=collectionOrder)})),orderedTieFormat.collectionDefinitions.sort(((a,b)=>a.collectionOrder-b.collectionOrder)),orderedTieFormat}function orderCollectionDefinitions({tournamentRecord,drawDefinition,structureId,matchUpId,orderMap,eventId,matchUp,event}){if("object"!=typeof orderMap)return{error:INVALID_VALUES,orderMap};if(eventId&&(null==event?void 0:event.tieFormat))updateEventTieFormat({tournamentRecord,event,orderMap});else if(matchUpId){const result=drawDefinition&&findMatchUp$1({drawDefinition,matchUpId});if(null==result?void 0:result.error)return result;if(!(matchUp=result.matchUp))return{error:MISSING_MATCHUP};(null==matchUp?void 0:matchUp.tieFormat)&&(matchUp.tieFormat=getOrderedTieFormat({tieFormat:matchUp.tieFormat,orderMap}),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,drawDefinition,matchUp}))}else if(structureId){const result=findStructure({drawDefinition,structureId});if(result.error)return result;const structure=result.structure;if(null==structure?void 0:structure.tieFormat)structure.tieFormat=getOrderedTieFormat({tieFormat:structure.tieFormat,orderMap}),updateStructureMatchUps$1({eventId:null==event?void 0:event.eventId,tournamentRecord,drawDefinition,structure,orderMap}),modifyDrawNotice({drawDefinition,structureIds:[structure.structureId]});else if(drawDefinition.tieFormat)updateDrawTieFormat({structureIds:[structureId],tournamentRecord,drawDefinition,orderMap,event});else{if(!(null==event?void 0:event.tieFormat))return{error:NOT_FOUND};updateEventTieFormat({structureIds:[structureId],tournamentRecord,orderMap,event})}}else{if(!(null==drawDefinition?void 0:drawDefinition.tieFormat))return{error:NOT_FOUND};updateDrawTieFormat({tournamentRecord,drawDefinition,orderMap,event})}return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1M.call(b,prop)&&__defNormalProp$1L(a,prop,b[prop]);if(__getOwnPropSymbols$1M)for(var prop of __getOwnPropSymbols$1M(b))__propIsEnum$1M.call(b,prop)&&__defNormalProp$1L(a,prop,b[prop]);return a})({},SUCCESS)}function updateEventTieFormat({tournamentRecord,structureIds,orderMap,event}){const updatedFormat=getOrderedTieFormat({tieFormat:event.tieFormat,orderMap});(null==structureIds?void 0:structureIds.length)||(event.tieFormat=updatedFormat);for(const drawDefinition of event.drawDefinitions||[])updateDrawTieFormat({tournamentRecord,drawDefinition,structureIds,orderMap,event})}function updateDrawTieFormat({tournamentRecord,drawDefinition,structureIds,orderMap,event}){const updatedFormat=getOrderedTieFormat({tieFormat:drawDefinition.tieFormat||event.tieFormat,orderMap});(null==structureIds?void 0:structureIds.length)||(drawDefinition.tieFormat=updatedFormat);const modifiedStructureIds=[];for(const structure of drawDefinition.structures||[])(null==structureIds?void 0:structureIds.length)&&!structureIds.includes(structure.structureId)||((structure.tieFormat||(null==structureIds?void 0:structureIds.includes(structure.structureId)))&&(structure.tieFormat=getOrderedTieFormat({tieFormat:structure.tieFormat||drawDefinition.tieFormat||event.tieFormat,orderMap})),updateStructureMatchUps$1({eventId:null==event?void 0:event.eventId,tournamentRecord,drawDefinition,structure,orderMap}),modifiedStructureIds.push(structure.structureId));modifyDrawNotice({drawDefinition,structureIds:modifiedStructureIds})}function updateStructureMatchUps$1({tournamentRecord,drawDefinition,structure,orderMap,eventId}){var _a;const matchUps=null==(_a=getAllStructureMatchUps({matchUpFilters:{matchUpTypes:[TEAM$2]},structure}))?void 0:_a.matchUps;for(const matchUp of matchUps)matchUp.tieFormat&&(matchUp.tieFormat=getOrderedTieFormat({tieFormat:matchUp.tieFormat,orderMap}),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,eventId,matchUp}))}function tieFormatTelemetry({drawDefinition,auditData}){const{extension}=findExtension$2({name:TIE_FORMAT_MODIFICATIONS,element:drawDefinition});addExtension$1({element:drawDefinition,extension:{name:TIE_FORMAT_MODIFICATIONS,value:Array.isArray(null==extension?void 0:extension.value)?extension.value.concat(auditData):[auditData]}})}var __defProp$1K=Object.defineProperty,__defProps$X=Object.defineProperties,__getOwnPropDescs$X=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1L=Object.getOwnPropertySymbols,__hasOwnProp$1L=Object.prototype.hasOwnProperty,__propIsEnum$1L=Object.prototype.propertyIsEnumerable,__defNormalProp$1K=(obj,key,value)=>key in obj?__defProp$1K(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1K=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1L.call(b,prop)&&__defNormalProp$1K(a,prop,b[prop]);if(__getOwnPropSymbols$1L)for(var prop of __getOwnPropSymbols$1L(b))__propIsEnum$1L.call(b,prop)&&__defNormalProp$1K(a,prop,b[prop]);return a},__spreadProps$X=(a,b)=>__defProps$X(a,__getOwnPropDescs$X(b));function getTieFormat({drawDefinition,structureId,matchUpId,eventId,event}){if((matchUpId||structureId)&&!drawDefinition)return{error:MISSING_DRAW_DEFINITION};let matchUp,structure,tieFormat;if(eventId&&(null==event?void 0:event.tieFormat))tieFormat=event.tieFormat;else if(matchUpId){const result=findMatchUp$1({drawDefinition,matchUpId});if(result.error)return result;({matchUp,structure}=result),tieFormat=matchUp.tieFormat||(null==structure?void 0:structure.tieFormat)||(null==drawDefinition?void 0:drawDefinition.tieFormat)||(null==event?void 0:event.tieFormat)}else if(drawDefinition&&structureId){const result=findStructure({drawDefinition,structureId});if(result.error)return result;structure=null==result?void 0:result.structure,tieFormat=(null==structure?void 0:structure.tieFormat)||drawDefinition.tieFormat||(null==event?void 0:event.tieFormat)}else tieFormat=(null==drawDefinition?void 0:drawDefinition.tieFormat)||(null==event?void 0:event.tieFormat);return tieFormat?__spreadProps$X(__spreadValues$1K({},SUCCESS),{tieFormat,matchUp,structure}):{error:MISSING_TIE_FORMAT}}var __defProp$1J=Object.defineProperty,__defProps$W=Object.defineProperties,__getOwnPropDescs$W=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1K=Object.getOwnPropertySymbols,__hasOwnProp$1K=Object.prototype.hasOwnProperty,__propIsEnum$1K=Object.prototype.propertyIsEnumerable,__defNormalProp$1J=(obj,key,value)=>key in obj?__defProp$1J(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function removeCollectionDefinition({updateInProgressMatchUps=!0,tournamentRecord,drawDefinition,tieFormatName,collectionId,structureId,matchUpId,eventId,matchUp,event}){var _a,_b,_c,_d,_e;let result=!matchUp&&getTieFormat({drawDefinition,structureId,matchUpId,eventId,event});if(result.error)return result;const{structure}=result;matchUp=matchUp||result.matchUp;const existingTieFormat=result.tieFormat||(null==matchUp?void 0:matchUp.tieFormat),tieFormat=copyTieFormat(existingTieFormat);if(result=validateTieFormat({tieFormat}),result.error)return result;const targetCollection=null==(_a=null==tieFormat?void 0:tieFormat.collectionDefinitions)?void 0:_a.find((collectionDefinition=>collectionDefinition.collectionId===collectionId));if(!targetCollection)return{error:NOT_FOUND,collectionId};const stack="removeCollectionDefinition";tieFormat.collectionDefinitions=tieFormat.collectionDefinitions.filter((collectionDefinition=>collectionDefinition.collectionId!==collectionId)),targetCollection.collectionGroupNumber&&(tieFormat.collectionDefinitions=tieFormat.collectionDefinitions.map((collectionDefinition=>((source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$1K.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols$1K)for(var prop of __getOwnPropSymbols$1K(source))exclude.indexOf(prop)<0&&__propIsEnum$1K.call(source,prop)&&(target[prop]=source[prop]);return target})(collectionDefinition,["collectionGroupNumber"]))),tieFormat.collectionGroups=tieFormat.collectionGroups.filter((({groupNumber})=>groupNumber!==targetCollection.collectionGroupNumber)));const{aggregateValue,valueGoal}=calculateWinCriteria(tieFormat);tieFormat.winCriteria=definedAttributes({aggregateValue,valueGoal});const originalValueGoal=existingTieFormat.winCriteria.valueGoal,wasAggregateValue=existingTieFormat.winCriteria.aggregateValue;(originalValueGoal&&originalValueGoal!==valueGoal||aggregateValue&&!wasAggregateValue)&&(tieFormatName?tieFormat.tieFormatName=tieFormatName:delete tieFormat.tieFormatName);let matchUps=[];matchUpId&&matchUp?matchUps=[matchUp]:structureId&&structure?matchUps=null==(_b=getAllStructureMatchUps({matchUpFilters:{matchUpTypes:[TEAM$2]},structure}))?void 0:_b.matchUps:drawDefinition?matchUps=null==(_c=allDrawMatchUps$1({matchUpFilters:{matchUpTypes:[TEAM$2]},drawDefinition}))?void 0:_c.matchUps:event&&(matchUps=null==(_d=allEventMatchUps({matchUpFilters:{matchUpTypes:[TEAM$2]},drawDefinition}))?void 0:_d.matchUps);const targetMatchUps=(matchUps||[]).filter((matchUp2=>{const collectionScore=matchUp2.tieMatchUps.filter((tieMatchUp=>tieMatchUp.collectionId===collectionId)).some(scoreHasValue);return updateInProgressMatchUps&&!collectionScore||!matchUp2.winningSide&&matchUp2.matchUpStatus!==COMPLETED$1&&(updateInProgressMatchUps||matchUp2.matchUpStatus!==IN_PROGRESS$1&&!scoreHasValue(matchUp2))}));if(!targetMatchUps.length)return{error:NO_MODIFICATIONS_APPLIED};if(matchUpId&&matchUp&&updateInProgressMatchUps){const collectionMatchUps=matchUp.tieMatchUps.filter((tieMatchUp=>tieMatchUp.collectionId===collectionId));for(const collectionMatchUp of collectionMatchUps){let result2=setMatchUpStatus$2({matchUpId:collectionMatchUp.matchUpId,tieMatchUpId:matchUp.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord,drawDefinition,event});if(result2.error)return result2;if(result2=findMatchUp$1({drawDefinition,matchUpId}),result2.error)return result2;matchUp=result2.matchUp}}const deletedMatchUpIds=[];for(const matchUp2 of targetMatchUps){for(const side of(null==matchUp2?void 0:matchUp2.sides)||[])side.lineUp=(side.lineUp||[]).map((assignment=>({participantId:assignment.participantId,collectionAssignments:((null==assignment?void 0:assignment.collectionAssignments)||[]).filter((collectionAssignment=>collectionAssignment.collectionId!==collectionId))})));if(matchUp2.tieMatchUps=(matchUp2.tieMatchUps||[]).filter((matchUp3=>{const deleteTarget=matchUp3.collectionId===collectionId;return deleteTarget&&deletedMatchUpIds.push(matchUp3.matchUpId),!deleteTarget})),matchUp2.tieFormat&&(matchUp2.tieFormat=copyTieFormat(tieFormat)),updateInProgressMatchUps){const result2=updateTieMatchUpScore$1({matchUpId:matchUp2.matchUpId,exitWhenNoValues:!0,tournamentRecord,drawDefinition,event});if(result2.error)return result2}modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,drawDefinition,context:stack,matchUp:matchUp2})}deletedMatchUpIds.length&&deleteMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUpIds:deletedMatchUpIds,eventId:null==event?void 0:event.eventId,drawDefinition});const prunedTieFormat=definedAttributes(tieFormat);if(result=validateTieFormat({tieFormat:prunedTieFormat}),result.error)return result;if(eventId)event.tieFormat=prunedTieFormat;else if(matchUpId)matchUp.tieFormat=prunedTieFormat;else if(structure)structure.tieFormat=prunedTieFormat;else if(drawDefinition)drawDefinition.tieFormat=prunedTieFormat;else if(!matchUp||!drawDefinition)return{error:MISSING_DRAW_DEFINITION};modifyDrawNotice({drawDefinition,eventId:null==event?void 0:event.eventId});const{appliedPolicies}=getAppliedPolicies({tournamentRecord});if(null==(_e=null==appliedPolicies?void 0:appliedPolicies.audit)?void 0:_e[TIE_FORMAT_MODIFICATIONS]){tieFormatTelemetry({drawDefinition,auditData:definedAttributes({drawId:null==drawDefinition?void 0:drawDefinition.drawId,action:stack,collectionId,structureId,matchUpId,eventId})})}return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1K.call(b,prop)&&__defNormalProp$1J(a,prop,b[prop]);if(__getOwnPropSymbols$1K)for(var prop of __getOwnPropSymbols$1K(b))__propIsEnum$1K.call(b,prop)&&__defNormalProp$1J(a,prop,b[prop]);return a})({},SUCCESS),__defProps$W(a,__getOwnPropDescs$W({tieFormat:prunedTieFormat,targetMatchUps,deletedMatchUpIds}));var a}function validUpdate({matchUp,updateInProgressMatchUps}){return!matchUp.winningSide&&![completedMatchUpStatuses].includes(matchUp.matchUpStatus)&&(updateInProgressMatchUps||matchUp.matchUpStatus!==IN_PROGRESS$1&&!scoreHasValue(matchUp))}var __defProp$1I=Object.defineProperty,__defProps$V=Object.defineProperties,__getOwnPropDescs$V=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1J=Object.getOwnPropertySymbols,__hasOwnProp$1J=Object.prototype.hasOwnProperty,__propIsEnum$1J=Object.prototype.propertyIsEnumerable,__defNormalProp$1I=(obj,key,value)=>key in obj?__defProp$1I(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1I=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1J.call(b,prop)&&__defNormalProp$1I(a,prop,b[prop]);if(__getOwnPropSymbols$1J)for(var prop of __getOwnPropSymbols$1J(b))__propIsEnum$1J.call(b,prop)&&__defNormalProp$1I(a,prop,b[prop]);return a},__spreadProps$V=(a,b)=>__defProps$V(a,__getOwnPropDescs$V(b));function mapsCheck(map1,map2){const referenceKeys=Object.keys(map1);return intersection(referenceKeys,Object.keys(map2)).length===referenceKeys.length}var __getOwnPropSymbols$1I=Object.getOwnPropertySymbols,__hasOwnProp$1I=Object.prototype.hasOwnProperty,__propIsEnum$1I=Object.prototype.propertyIsEnumerable;function modifyCollectionDefinition({updateInProgressMatchUps=!1,tournamentRecord,collectionOrder,collectionName,drawDefinition,matchUpFormat,tieFormatName,collectionId,structureId,matchUpId,category,eventId,gender,event,collectionValueProfile,collectionValue,matchUpValue,scoreValue,setValue}){var _a;if(matchUpFormat&&!isValid(matchUpFormat))return{error:INVALID_VALUES};if(collectionName&&"string"!=typeof collectionName)return{error:INVALID_VALUES};if(gender&&!Object.values(genderConstants).includes(gender))return{error:INVALID_VALUES};if(category&&"object"!=typeof category)return{error:INVALID_VALUES};const stack="modifyCollectionDefinition",valueAssignments={collectionValueProfile,collectionValue,matchUpValue,scoreValue,setValue};if(!(Object.values(valueAssignments).filter(Boolean).length||collectionOrder||collectionName||matchUpFormat))return decorateResult({result:{error:MISSING_VALUE},stack});if(Object.values(valueAssignments).filter(Boolean).length>1)return decorateResult({result:{error:INVALID_VALUES,info:"Only one value assignment allowed per collectionDefinition"},stack});let result=getTieFormat({drawDefinition,structureId,matchUpId,eventId,event});if(result.error)return decorateResult({result,stack});const{matchUp,structure,tieFormat:existingTieFormat}=result,tieFormat=copyTieFormat(existingTieFormat),collectionDefinition=tieFormat.collectionDefinitions.find((collectionDefinition2=>collectionDefinition2.collectionId===collectionId));if(!collectionDefinition)return decorateResult({result:{error:NOT_FOUND},stack});const value=collectionValue||matchUpValue||scoreValue||setValue;if(value||collectionValueProfile){if(value){if(!isConvertableInteger(value))return{error:INVALID_VALUES,value}}else if(collectionValueProfile){const result2=validateCollectionValueProfile({matchUpCount:collectionDefinition.matchUpCount,collectionValueProfile});if(result2.errors)return decorateResult({result:{error:INVALID_VALUES,info:result2.errors},stack})}collectionDefinition.collectionValue=void 0,collectionDefinition.matchUpValue=void 0,collectionDefinition.scoreValue=void 0,collectionDefinition.setValue=void 0,Object.assign(collectionDefinition,valueAssignments)}if((scoreValue||setValue)&&collectionDefinition.collectionGroupNumber){const targetCollectionGroupNumber=collectionDefinition.collectionGroupNumber;tieFormat.collectionDefinitions=tieFormat.collectionDefinitions.map((collectionDefinition2=>{const _a2=collectionDefinition2,{collectionGroupNumber}=_a2,rest=((source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$1I.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols$1I)for(var prop of __getOwnPropSymbols$1I(source))exclude.indexOf(prop)<0&&__propIsEnum$1I.call(source,prop)&&(target[prop]=source[prop]);return target})(_a2,["collectionGroupNumber"]);return collectionGroupNumber===targetCollectionGroupNumber?rest:collectionDefinition2})),tieFormat.collectionGroups=tieFormat.collectionGroups.filter((({groupNumber})=>groupNumber!==targetCollectionGroupNumber))}const{aggregateValue,valueGoal}=calculateWinCriteria(tieFormat);tieFormat.winCriteria=definedAttributes({aggregateValue,valueGoal});const originalValueGoal=existingTieFormat.winCriteria.valueGoal,wasAggregateValue=existingTieFormat.winCriteria.aggregateValue;(originalValueGoal&&originalValueGoal!==valueGoal||aggregateValue&&!wasAggregateValue)&&(tieFormatName?tieFormat.tieFormatName=tieFormatName:delete tieFormat.tieFormatName),collectionOrder&&(collectionDefinition.collectionOrder=collectionOrder),collectionName&&(collectionDefinition.collectionName=collectionName),matchUpFormat&&(collectionDefinition.matchUpFormat=matchUpFormat),category&&(collectionDefinition.category=category),gender&&(collectionDefinition.gender=gender);const prunedTieFormat=definedAttributes(tieFormat);if(result=validateTieFormat({tieFormat:prunedTieFormat}),result.error)return decorateResult({result,stack});if(result=function updateTieFormat({updateInProgressMatchUps,tournamentRecord,drawDefinition,structure,tieFormat,eventId,matchUp,event}){var _a;const stack="updateTieFormat";let modifiedCount=0,modifiedStructuresCount=0;const collectionMap=null==tieFormat?void 0:tieFormat.collectionDefinitions.reduce(((instanceMap,def)=>(instanceMap[def.collectionId]=(instanceMap[def.collectionId]||0)+def.matchUpCount,instanceMap)),{}),matchingCollections=({tieFormat:tieFormat2})=>{const cMap=null==tieFormat2?void 0:tieFormat2.collectionDefinitions.reduce(((instanceMap,def)=>(instanceMap[def.collectionId]=(instanceMap[def.collectionId]||0)+def.matchUpCount,instanceMap)),{});return mapsCheck(collectionMap,cMap)},{drawDefaultTieFormat,eventDefaultTieFormat}=getTieFormat({drawDefinition,event});if(event&&eventId){for(const drawDefinition2 of event.drawDefinitions||[])processDrawDefinition({drawDefinition:drawDefinition2});event.tieFormat=tieFormat,modifiedCount+=1}else if(matchUp){if(!matchUp.tieMatchUps)return decorateResult({result:{error:INVALID_MATCHUP},stack});const matchUpMap=instanceCount(null==(_a=matchUp.tieMatchUps)?void 0:_a.map((({collectionId})=>collectionId)));if(!mapsCheck(collectionMap,matchUpMap))return decorateResult({context:{collectionMap,matchUpMap},result:{error:INVALID_TIE_FORMAT},info:"on matchUp",stack});if(!validUpdate({matchUp,updateInProgressMatchUps}))return decorateResult({result:{error:CANNOT_MODIFY_TIEFORMAT},info:"matchUp is IN_PROGRESS or COMPLETE"});matchUp.tieFormat=tieFormat,modifiedCount+=1,modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,context:stack,drawDefinition,matchUp})}else if(structure){const modified=processStructure({inheritedTieFormat:drawDefaultTieFormat||eventDefaultTieFormat,structure});modifiedStructuresCount+=modified,structure.tieFormat=tieFormat,modifiedCount+=1,modifyDrawNotice({structureIds:[structure.structureId],eventId:null==event?void 0:event.eventId,drawDefinition})}else{if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};processDrawDefinition({drawDefinition}),drawDefinition.tieFormat=tieFormat,modifiedCount+=1}return __spreadProps$V(__spreadValues$1I({},SUCCESS),{modifiedCount,modifiedStructuresCount,tieFormat});function processDrawDefinition({drawDefinition:drawDefinition2}){const modifiedStructureIds=[];for(const structure2 of drawDefinition2.structures||[]){if(structure2.tieFormat)continue;const modifiedCount2=processStructure({inheritedTieFormat:eventDefaultTieFormat,structure:structure2});modifiedCount2&&(modifiedStructuresCount+=modifiedCount2,modifiedStructureIds.push(structure2.structureId))}return modifyDrawNotice({structureIds:modifiedStructureIds,eventId:null==event?void 0:event.eventId,drawDefinition:drawDefinition2}),modifiedStructureIds.length}function processStructure({inheritedTieFormat,structure:structure2}){var _a2,_b;let modifiedCount2=0;const structureMatchUps=(null==(_a2=getAllStructureMatchUps({matchUpFilters:{matchUpTypes:[TEAM$2]},structure:structure2}))?void 0:_a2.matchUps)||[];for(const matchUp2 of structureMatchUps){let modified=!1;const tieMatchUpsMap=instanceCount(null==(_b=matchUp2.tieMatchUps)?void 0:_b.map((({collectionId})=>collectionId)));if(mapsCheck(collectionMap,tieMatchUpsMap))matchUp2.tieFormat&&matchingCollections(matchUp2)&&validUpdate({matchUp:matchUp2,updateInProgressMatchUps})&&(matchUp2.tieFormat=copyTieFormat(tieFormat),modified=!0);else{if(!inheritedTieFormat)return decorateResult({result:{error:MISSING_TIE_FORMAT},stack});matchUp2.tieFormat=inheritedTieFormat,modified=!0}modified&&(modifiedCount2+=1,modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,context:stack,eventId,matchUp:matchUp2}))}return modifiedCount2}}({tieFormat:prunedTieFormat,updateInProgressMatchUps,tournamentRecord,drawDefinition,structureId,structure,eventId,matchUp,event}),!result.error){const{appliedPolicies}=getAppliedPolicies({tournamentRecord});if(null==(_a=null==appliedPolicies?void 0:appliedPolicies.audit)?void 0:_a[TIE_FORMAT_MODIFICATIONS]){tieFormatTelemetry({drawDefinition,auditData:definedAttributes({drawId:null==drawDefinition?void 0:drawDefinition.drawId,collectionDefinition,action:stack,structureId,matchUpId,eventId})})}}return decorateResult({result,stack})}var __defProp$1H=Object.defineProperty,__defProps$U=Object.defineProperties,__getOwnPropDescs$U=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1H=Object.getOwnPropertySymbols,__hasOwnProp$1H=Object.prototype.hasOwnProperty,__propIsEnum$1H=Object.prototype.propertyIsEnumerable,__defNormalProp$1H=(obj,key,value)=>key in obj?__defProp$1H(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function addCollectionDefinition({updateInProgressMatchUps=!0,collectionDefinition,tournamentRecord,drawDefinition,tieFormatName,structureId,matchUpId,matchUp,eventId,uuids,event}){var _a;const{valid,errors}=validateCollectionDefinition({collectionDefinition});if(!valid)return{error:INVALID_VALUES,errors};const stack="addCollectionDefinition";let result=!matchUp&&getTieFormat({drawDefinition,structureId,matchUpId,eventId,event});if(result.error)return result;const{structure}=result;matchUp=matchUp||result.matchUp;const existingTieFormat=result.tieFormat||matchUp.tieFormat,tieFormat=copyTieFormat(existingTieFormat);if(result=validateTieFormat({tieFormat}),result.error)return result;if(collectionDefinition.collectionId){if(tieFormat.collectionDefinitions.map((({collectionId})=>collectionId)).includes(collectionDefinition.collectionId))return{error:DUPLICATE_VALUE,collectionId:collectionDefinition.collectionId}}else collectionDefinition.collectionId=UUID();tieFormat.collectionDefinitions.push(collectionDefinition),tieFormat.collectionDefinitions.sort(((a,b)=>(a.collectionOrder||0)-(b.collectionOrder||0))).forEach(((collectionDefinition2,i)=>collectionDefinition2.collectionOrder=i+1));const{aggregateValue,valueGoal}=calculateWinCriteria(tieFormat);tieFormat.winCriteria=definedAttributes({aggregateValue,valueGoal});const originalValueGoal=existingTieFormat.winCriteria.valueGoal,wasAggregateValue=existingTieFormat.winCriteria.aggregateValue;(originalValueGoal&&originalValueGoal!==valueGoal||aggregateValue&&!wasAggregateValue)&&(tieFormatName?tieFormat.tieFormatName=tieFormatName:delete tieFormat.tieFormatName);const modifiedStructureIds=[],addedMatchUps=[];let targetMatchUps=[];const prunedTieFormat=definedAttributes(tieFormat);if(result=validateTieFormat({tieFormat:prunedTieFormat}),result.error)return result;if(eventId){event.tieFormat=prunedTieFormat;for(const drawDefinition2 of event.drawDefinitions||[])if(!drawDefinition2.tieFormat)for(const structure2 of drawDefinition2.structures||[]){if(structure2.tieFormat)continue;const result2=updateStructureMatchUps({updateInProgressMatchUps,collectionDefinition,structure:structure2,uuids});addedMatchUps.push(...result2.newMatchUps),targetMatchUps.push(...result2.targetMatchUps),modifiedStructureIds.push(structure2.structureId)}queueNoficiations({structureIds:modifiedStructureIds,modifiedMatchUps:targetMatchUps,eventId:null==event?void 0:event.eventId,tournamentRecord,drawDefinition,addedMatchUps,stack})}else if(structureId&&structure){structure.tieFormat=prunedTieFormat;const result2=updateStructureMatchUps({updateInProgressMatchUps,collectionDefinition,structure,uuids});addedMatchUps.push(...result2.newMatchUps),targetMatchUps=result2.targetMatchUps,queueNoficiations({modifiedMatchUps:targetMatchUps,structureIds:[structureId],eventId:null==event?void 0:event.eventId,tournamentRecord,drawDefinition,addedMatchUps,stack})}else if(matchUpId&&matchUp){if(!validUpdate({matchUp,updateInProgressMatchUps}))return{error:CANNOT_MODIFY_TIEFORMAT};matchUp.tieFormat=prunedTieFormat;const newMatchUps=generateCollectionMatchUps({collectionDefinition,uuids});Array.isArray(matchUp.tieMatchUps)||(matchUp.tieMatchUps=[]),matchUp.tieMatchUps.push(...newMatchUps),addedMatchUps.push(...newMatchUps),queueNoficiations({modifiedMatchUps:[matchUp],eventId:null==event?void 0:event.eventId,tournamentRecord,drawDefinition,addedMatchUps,stack})}else{if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};drawDefinition.tieFormat=prunedTieFormat;for(const structure2 of drawDefinition.structures||[]){const result2=updateStructureMatchUps({updateInProgressMatchUps,collectionDefinition,structure:structure2,uuids});modifiedStructureIds.push(structureId),addedMatchUps.push(...result2.newMatchUps),targetMatchUps.push(...result2.targetMatchUps)}queueNoficiations({structureIds:modifiedStructureIds,modifiedMatchUps:targetMatchUps,eventId:null==event?void 0:event.eventId,tournamentRecord,drawDefinition,addedMatchUps,stack})}const{appliedPolicies}=getAppliedPolicies({tournamentRecord});if(null==(_a=null==appliedPolicies?void 0:appliedPolicies.audit)?void 0:_a[TIE_FORMAT_MODIFICATIONS]){tieFormatTelemetry({drawDefinition,auditData:definedAttributes({drawId:null==drawDefinition?void 0:drawDefinition.drawId,collectionDefinition,action:stack,structureId,matchUpId,eventId})})}return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1H.call(b,prop)&&__defNormalProp$1H(a,prop,b[prop]);if(__getOwnPropSymbols$1H)for(var prop of __getOwnPropSymbols$1H(b))__propIsEnum$1H.call(b,prop)&&__defNormalProp$1H(a,prop,b[prop]);return a})({},SUCCESS),__defProps$U(a,__getOwnPropDescs$U({tieFormat:prunedTieFormat,targetMatchUps,addedMatchUps}));var a}function updateStructureMatchUps({updateInProgressMatchUps,collectionDefinition,structure,uuids}){var _a;const newMatchUps=[],targetMatchUps=(null==(_a=getAllStructureMatchUps({matchUpFilters:{matchUpTypes:[TEAM$2]},structure}))?void 0:_a.matchUps).filter((matchUp=>validUpdate({matchUp,updateInProgressMatchUps})&&!matchUp.tieFormat));for(const matchUp of targetMatchUps){const tieMatchUps=generateCollectionMatchUps({collectionDefinition,uuids});Array.isArray(matchUp.tieMatchUps)||(matchUp.tieMatchUps=[]),matchUp.tieMatchUps.push(...tieMatchUps),newMatchUps.push(...tieMatchUps)}return{newMatchUps,targetMatchUps}}function queueNoficiations({modifiedStructureIds,tournamentRecord,modifiedMatchUps,drawDefinition,addedMatchUps,eventId,stack}){addMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUps:addedMatchUps,drawDefinition,eventId}),null==modifiedMatchUps||modifiedMatchUps.forEach((matchUp=>{modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,drawDefinition,context:stack,matchUp,eventId})})),modifyDrawNotice({structureIds:modifiedStructureIds,drawDefinition,eventId})}var __defProp$1G=Object.defineProperty,__getOwnPropSymbols$1G=Object.getOwnPropertySymbols,__hasOwnProp$1G=Object.prototype.hasOwnProperty,__propIsEnum$1G=Object.prototype.propertyIsEnumerable,__defNormalProp$1G=(obj,key,value)=>key in obj?__defProp$1G(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1G=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1G.call(b,prop)&&__defNormalProp$1G(a,prop,b[prop]);if(__getOwnPropSymbols$1G)for(var prop of __getOwnPropSymbols$1G(b))__propIsEnum$1G.call(b,prop)&&__defNormalProp$1G(a,prop,b[prop]);return a};function collectionGroupUpdate({updateInProgressMatchUps,originalValueGoal,tournamentRecord,wasAggregateValue,tieFormatName,drawDefinition,structureId,structure,tieFormat,matchUpId,matchUp,eventId,event}){const{aggregateValue,valueGoal}=calculateWinCriteria(tieFormat);tieFormat.winCriteria=definedAttributes({aggregateValue,valueGoal}),(originalValueGoal&&originalValueGoal!==valueGoal||aggregateValue&&!wasAggregateValue)&&(tieFormatName?tieFormat.tieFormatName=tieFormatName:delete tieFormat.tieFormatName);const{targetMatchUps}=function getTargetTeamMatchUps({updateInProgressMatchUps,drawDefinition,structureId,structure,matchUpId,matchUp}){var _a,_b;let matchUps=[];return matchUpId&&matchUp?matchUps=[matchUp]:structureId&&structure?matchUps=null==(_a=getAllStructureMatchUps({matchUpFilters:{matchUpTypes:[TEAM$2]},structure}))?void 0:_a.matchUps:drawDefinition&&(matchUps=null==(_b=allDrawMatchUps$1({matchUpFilters:{matchUpTypes:[TEAM$2]},drawDefinition}))?void 0:_b.matchUps),{targetMatchUps:matchUps.filter((matchUp2=>!matchUp2.winningSide&&matchUp2.matchUpStatus!==COMPLETED$1&&(updateInProgressMatchUps||matchUp2.matchUpStatus!==IN_PROGRESS$1&&!scoreHasValue(matchUp2))))}}({updateInProgressMatchUps,drawDefinition,structureId,structure,matchUpId,matchUp});!function updateTargetTeamMatchUps({updateInProgressMatchUps,tournamentRecord,drawDefinition,targetMatchUps,tieFormat,event}){for(const targetMatchUp of targetMatchUps){const hasTieFormat=!!targetMatchUp.tieFormat;let scoreUpdated;if(hasTieFormat&&(targetMatchUp.tieFormat=copyTieFormat(tieFormat)),updateInProgressMatchUps){const result=updateTieMatchUpScore$1({matchUpId:targetMatchUp.matchUpId,exitWhenNoValues:!0,tournamentRecord,drawDefinition,event});if(result.error)return result;scoreUpdated=result.score}hasTieFormat&&!scoreUpdated&&modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,context:"updateTargetTeamMatchUps",eventId:null==event?void 0:event.eventId,matchUp:targetMatchUp,drawDefinition})}}({updateInProgressMatchUps,tournamentRecord,drawDefinition,targetMatchUps,tieFormat,event});const prunedTieFormat=definedAttributes(tieFormat),result=validateTieFormat({tieFormat:prunedTieFormat});if(result.error)return result;if(eventId)event.tieFormat=prunedTieFormat;else if(matchUpId)matchUp.tieFormat=tieFormat;else if(structure)structure.tieFormat=prunedTieFormat;else if(drawDefinition)drawDefinition.tieFormat=prunedTieFormat;else if(!matchUp||!drawDefinition)return{error:MISSING_DRAW_DEFINITION};return modifyDrawNotice({drawDefinition,eventId:null==event?void 0:event.eventId}),__spreadValues$1G({},SUCCESS)}var __defProp$1F=Object.defineProperty,__defProps$T=Object.defineProperties,__getOwnPropDescs$T=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1F=Object.getOwnPropertySymbols,__hasOwnProp$1F=Object.prototype.hasOwnProperty,__propIsEnum$1F=Object.prototype.propertyIsEnumerable,__defNormalProp$1F=(obj,key,value)=>key in obj?__defProp$1F(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1F=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1F.call(b,prop)&&__defNormalProp$1F(a,prop,b[prop]);if(__getOwnPropSymbols$1F)for(var prop of __getOwnPropSymbols$1F(b))__propIsEnum$1F.call(b,prop)&&__defNormalProp$1F(a,prop,b[prop]);return a};function removeCollectionGroup({updateInProgressMatchUps=!0,collectionGroupNumber,tournamentRecord,drawDefinition,tieFormatName,structureId,matchUpId,matchUp,eventId,event}){var _a;if(!collectionGroupNumber)return{error:MISSING_VALUE};if(isNaN(collectionGroupNumber))return{error:INVALID_VALUES};const stack="removeCollectionGroup";let result=!matchUp&&getTieFormat$1({tournamentRecord,drawDefinition,structureId,matchUpId,eventId,event});if(result.error)return decorateResult({result,stack});const{structure}=result;matchUp=matchUp||result.matchUp;const existingTieFormat=result.tieFormat||(null==matchUp?void 0:matchUp.tieFormat),originalValueGoal=existingTieFormat.winCriteria.valueGoal,wasAggregateValue=existingTieFormat.winCriteria.aggregateValue,tieFormat=copyTieFormat(existingTieFormat);if(result=validateTieFormat({tieFormat}),result.error)return decorateResult({result,stack});const modifiedCollectionIds=[];if(tieFormat.collectionDefinitions=tieFormat.collectionDefinitions.map((collectionDefinition=>{const _a2=collectionDefinition,{collectionGroupNumber:groupNumber}=_a2,rest=((source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$1F.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols$1F)for(var prop of __getOwnPropSymbols$1F(source))exclude.indexOf(prop)<0&&__propIsEnum$1F.call(source,prop)&&(target[prop]=source[prop]);return target})(_a2,["collectionGroupNumber"]);return groupNumber!==collectionGroupNumber?collectionDefinition:(modifiedCollectionIds.push(collectionDefinition.collectionId),rest)})),tieFormat.collectionGroups=tieFormat.collectionGroups.filter((({groupNumber})=>groupNumber!==collectionGroupNumber)),result=collectionGroupUpdate({updateInProgressMatchUps,originalValueGoal,wasAggregateValue,tournamentRecord,drawDefinition,tieFormatName,structureId,structure,tieFormat,matchUpId,matchUp,eventId,event}),!result.error){const{appliedPolicies}=getAppliedPolicies({tournamentRecord});if(null==(_a=null==appliedPolicies?void 0:appliedPolicies.audit)?void 0:_a[TIE_FORMAT_MODIFICATIONS]){tieFormatTelemetry({drawDefinition,auditData:definedAttributes({drawId:null==drawDefinition?void 0:drawDefinition.drawId,collectionGroupNumber,action:stack,structureId,matchUpId,eventId})})}}return decorateResult({result:(a=__spreadValues$1F({},result),b={modifiedCollectionIds},__defProps$T(a,__getOwnPropDescs$T(b))),stack});var a,b}var __defProp$1E=Object.defineProperty,__defProps$S=Object.defineProperties,__getOwnPropDescs$S=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1E=Object.getOwnPropertySymbols,__hasOwnProp$1E=Object.prototype.hasOwnProperty,__propIsEnum$1E=Object.prototype.propertyIsEnumerable,__defNormalProp$1E=(obj,key,value)=>key in obj?__defProp$1E(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function addCollectionGroup({updateInProgressMatchUps=!0,tournamentRecord,groupDefinition,drawDefinition,collectionIds,tieFormatName,structureId,matchUpId,matchUp,eventId,event}){const stack="addCollectionGroup";if(!Array.isArray(collectionIds))return decorateResult({result:{error:MISSING_VALUE},stack});let result=!matchUp&&getTieFormat({tournamentRecord,drawDefinition,structureId,matchUpId,eventId,event});if(result.error)return decorateResult({result,stack});const{structure}=result;matchUp=matchUp||result.matchUp;const existingTieFormat=result.tieFormat||(null==matchUp?void 0:matchUp.tieFormat),originalValueGoal=existingTieFormat.winCriteria.valueGoal,tieFormat=copyTieFormat(existingTieFormat);if(result=validateTieFormat({tieFormat}),result.error)return decorateResult({result,stack});for(const collectionDefinition of tieFormat.collectionDefinitions){const{collectionId,collectionGroupNumber:collectionGroupNumber2}=collectionDefinition;if(collectionGroupNumber2&&collectionIds.includes(collectionId))return decorateResult({result:{error:INVALID_VALUES,info:"collectionIds cannot be part of other collectionGroups"},stack})}const collectionGroupNumber=(tieFormat.collectionGroups||[]).reduce(((max,group)=>group.groupNumber>max?group.groupNumber:max),0)+1;return groupDefinition.groupNumber=collectionGroupNumber,tieFormat.collectionDefinitions=tieFormat.collectionDefinitions.map((collectionDefinition=>{return collectionIds.includes(collectionDefinition.collectionId)?(a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1E.call(b,prop)&&__defNormalProp$1E(a,prop,b[prop]);if(__getOwnPropSymbols$1E)for(var prop of __getOwnPropSymbols$1E(b))__propIsEnum$1E.call(b,prop)&&__defNormalProp$1E(a,prop,b[prop]);return a})({},collectionDefinition),__defProps$S(a,__getOwnPropDescs$S({collectionGroupNumber}))):collectionDefinition;var a})),tieFormat.collectionGroups=[...tieFormat.collecitonGroups||[],groupDefinition],collectionGroupUpdate({updateInProgressMatchUps,originalValueGoal,tournamentRecord,drawDefinition,tieFormatName,structureId,structure,tieFormat,matchUpId,matchUp,eventId,event})}const tieFormatGovernor={modifyCollectionDefinition,orderCollectionDefinitions,removeCollectionDefinition,addCollectionDefinition,removeCollectionGroup,calculateWinCriteria,addCollectionGroup};var __defProp$1D=Object.defineProperty,__getOwnPropSymbols$1D=Object.getOwnPropertySymbols,__hasOwnProp$1D=Object.prototype.hasOwnProperty,__propIsEnum$1D=Object.prototype.propertyIsEnumerable,__defNormalProp$1D=(obj,key,value)=>key in obj?__defProp$1D(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1D=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1D.call(b,prop)&&__defNormalProp$1D(a,prop,b[prop]);if(__getOwnPropSymbols$1D)for(var prop of __getOwnPropSymbols$1D(b))__propIsEnum$1D.call(b,prop)&&__defNormalProp$1D(a,prop,b[prop]);return a};function getHistory({matchUp}){const{extension}=findExtension$2({name:MATCHUP_HISTORY,element:matchUp});if(!extension)return{error:NOT_FOUND};const{history=[],undoHistory=[]}=extension.value;return __spreadValues$1D({history,undoHistory},SUCCESS)}var __defProp$1C=Object.defineProperty,__defProps$R=Object.defineProperties,__getOwnPropDescs$R=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1C=Object.getOwnPropertySymbols,__hasOwnProp$1C=Object.prototype.hasOwnProperty,__propIsEnum$1C=Object.prototype.propertyIsEnumerable,__defNormalProp$1C=(obj,key,value)=>key in obj?__defProp$1C(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1C=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1C.call(b,prop)&&__defNormalProp$1C(a,prop,b[prop]);if(__getOwnPropSymbols$1C)for(var prop of __getOwnPropSymbols$1C(b))__propIsEnum$1C.call(b,prop)&&__defNormalProp$1C(a,prop,b[prop]);return a},__spreadProps$R=(a,b)=>__defProps$R(a,__getOwnPropDescs$R(b)),__objRest$1=(source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$1C.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols$1C)for(var prop of __getOwnPropSymbols$1C(source))exclude.indexOf(prop)<0&&__propIsEnum$1C.call(source,prop)&&(target[prop]=source[prop]);return target};function saveHistory({matchUp,history,undoHistory}){return addExtension$1({element:matchUp,extension:{value:{history,undoHistory},name:MATCHUP_HISTORY}})}const historyGovernor={calculateHistoryScore:function calculateHistoryScore({matchUp,updateScore}){var _a;const history=(null==(_a=getHistory({matchUp}))?void 0:_a.history)||[];if(!Array.isArray(history))return{error:INVALID_VALUES,info:"history is not an array"};const{matchUpFormat}=matchUp;if(!matchUpFormat)return{error:MISSING_MATCHUP_FORMAT};if(!isValid(matchUpFormat))return{error:INVALID_MATCHUP_FORMAT};const parsedFormat=parse(matchUpFormat),{bestOf,finalSetFormat,setFormat}=parsedFormat,pointProgression=["0","15","30","40","A","G"],score={sets:[]};let tiebreakServingSide,isFinalSet,sidePoints=[0,0],servingSide=1,unknowns=[],setNumber=0,faults=0;const isValidSide=value=>[1,2].includes(value),newSet=()=>(setNumber+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber,games:[]});let point={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},game={winningSide:void 0,points:[]},set=newSet(),processedCount=0;for(const item of history){processedCount+=1,isFinalSet=score.sets.length+1===bestOf;const format=isFinalSet&&finalSetFormat?finalSetFormat:setFormat,{tiebreakAt,setTo,NoAD,tiebbreakFormat}=format,isTiebreak=set.side1Score===tiebreakAt&&set.side1Score===set.side2Score,isTiebreakSet=!!format.tiebreakSet,tiebreakDetails=isTiebreakSet?format.tiebreakSet:tiebbreakFormat,{tiebreakTo,NoAD:tiebreakNoAD}=tiebreakDetails||{},cleanup=()=>{tiebreakServingSide=void 0,sidePoints=[0,0],servingSide=3-servingSide,set.side1TiebreakScore=0,set.side2TiebreakScore=0,set.side1PointScore="",set.side2PointScore="",faults=0},completeSet=winningSide=>{set.winningSide=winningSide;const rest=__objRest$1(set,["s"]);score.sets.push(rest),point={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},game={winningSide:void 0,points:[]},set=newSet(),cleanup()},completeGame=winningSide=>{game.winningSide=winningSide;const rest=__objRest$1(game,["g"]);set.games.push(rest),point={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},game={winningSide:void 0,points:[]},cleanup();set[`side${winningSide}Score`]+=1},completePoint=winningSide=>{point.winningSide=winningSide;const rest=__objRest$1(point,["p"]);game.points.push(rest),point={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},faults=0;const winningIndex=winningSide-1;if(isTiebreak||isTiebreakSet){sidePoints[winningIndex]+=1,tiebreakServingSide=sidePoints.reduce(((a,b)=>a+b))%4/4>.5?servingSide:3-servingSide,set[`side${winningSide}TiebreakScore`]=sidePoints[winningIndex],set[`side${3-winningSide}TiebreakScore`]=sidePoints[1-winningIndex];const winBy=tiebreakNoAD?1:2;if(sidePoints[winningIndex]>=tiebreakTo&&sidePoints[winningIndex]>=sidePoints[1-winningIndex]+winBy)return completeGame(winningSide),{gameCompleted:!0}}else if(4===sidePoints[1-winningIndex]&&3===sidePoints[winningIndex]?sidePoints[1-winningIndex]-=1:sidePoints[winningIndex]+=1,set.side1PointScore=pointProgression[sidePoints[0]],set.side2PointScore=pointProgression[sidePoints[1]],5===sidePoints[winningIndex]||4===sidePoints[winningIndex]&&sidePoints[1-winningIndex]<3||NoAD&&4===sidePoints[winningIndex])return completeGame(winningSide),{gameCompleted:!0}};if(isValidSide(item.srv)&&(servingSide=item.srv),["p","s","g","o"].includes(item.u)&&unknowns.push(item.u),item.shotOutcome){point.shots.push(item);if("SERVE"===item.shotType&&["OUT","NET"].includes(item.shotOutcome)&&(faults+=1),2===faults){completePoint(3-servingSide)}}if(isValidSide(item.p)||isConvertableInteger(item.pointNumber)){const result=completePoint(item.winningSide||item.p);if(null==result?void 0:result.gameCompleted)continue}if(isValidSide(item.g)||isConvertableInteger(item.gameNumber)){const winningSide=item.winningSide||item.g;game.winningSide=winningSide;const winningScoreSide=`side${winningSide}Score`,losingScoreSide=`side${3-winningSide}Score`;unknowns.length&&(unknowns.includes("p"),unknowns=[]),completeGame(winningSide);if(set[winningScoreSide]===setTo&&set[winningScoreSide]-set[losingScoreSide]>=(NoAD?1:2)&&(completeSet(winningSide),isFinalSet))break}if(isValidSide(item.s)||isConvertableInteger(item.setNumber)){if(completeSet(item.winningSide||item.s),unknowns.length&&(unknowns.includes("p"),unknowns.includes("g"),unknowns=[]),isFinalSet)break}}return processedCount!==history.length&&console.log({error:"Match completed with excess history"}),(set.side1Score||set.side2Score||set.games.length||set.side1TiebreakScore||set.side2TiebreakScore)&&score.sets.push(set),score.scoreStringSide1=generateScoreString(__spreadProps$R(__spreadValues$1C({},score),{matchUpFormat})),score.scoreStringSide2=generateScoreString(__spreadProps$R(__spreadValues$1C({},score),{matchUpFormat,reversed:!0})),servingSide=tiebreakServingSide||servingSide,updateScore&&(matchUp.score=score),__spreadProps$R(__spreadValues$1C({},SUCCESS),{servingSide,score})},setServingSide:function setServingSide({matchUp,sideNumber}){if(![1,2].includes(sideNumber))return{error:INVALID_SIDE_NUMBER};const{history=[]}=getHistory({matchUp});return history.push({srv:sideNumber}),saveHistory({matchUp,history})},clearHistory:function clearHistory({matchUp}){return saveHistory({matchUp})},addPoint:function addPoint({matchUp,point}){if(!point)return{error:MISSING_VALUE};if("object"!=typeof point)return{error:INVALID_VALUES,context:{point}};const{history=[]}=getHistory({matchUp});return history.push(point),saveHistory({matchUp,history})},addGame:function addGame({matchUp,game}){if("object"!=typeof game)return{error:INVALID_VALUES,context:{game}};const{history=[]}=getHistory({matchUp});return history.push(game),saveHistory({matchUp,history})},addShot:function addShot({matchUp,shot}){if("object"!=typeof shot)return{error:MISSING_VALUE};const{history=[]}=getHistory({matchUp});return history.push(shot),saveHistory({matchUp,history})},addSet:function addSet({matchUp,set}){if("object"!=typeof set)return{error:MISSING_VALUE};const{history=[]}=getHistory({matchUp});return history.push(set),saveHistory({matchUp,history})},redo:function redo({matchUp}){const{history=[],undoHistory=[]}=getHistory({matchUp});return undoHistory.length&&history.push(undoHistory.pop()),saveHistory({matchUp,history,undoHistory})},undo:function undo({matchUp}){const{history=[],undoHistory=[]}=getHistory({matchUp});return undoHistory.push(history.pop()),saveHistory({matchUp,history,undoHistory})},umo:{addPoint:()=>{},addPoints:()=>{},scoreboard:()=>{}}};var __defProp$1B=Object.defineProperty,__getOwnPropSymbols$1B=Object.getOwnPropertySymbols,__hasOwnProp$1B=Object.prototype.hasOwnProperty,__propIsEnum$1B=Object.prototype.propertyIsEnumerable,__defNormalProp$1B=(obj,key,value)=>key in obj?__defProp$1B(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1B=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1B.call(b,prop)&&__defNormalProp$1B(a,prop,b[prop]);if(__getOwnPropSymbols$1B)for(var prop of __getOwnPropSymbols$1B(b))__propIsEnum$1B.call(b,prop)&&__defNormalProp$1B(a,prop,b[prop]);return a};function analyzeMatchUp(params){var _a;const{matchUp,sideNumber,setNumber,isTiebreakValue,isPointValue}=params||{};let{matchUpFormat}=params||{};if(!matchUp)return{error:MISSING_MATCHUP};matchUpFormat=matchUpFormat||(null==matchUp?void 0:matchUp.matchUpFormat);const matchUpScoringFormat=parse(matchUpFormat),isCompletedMatchUp=!!(null==matchUp?void 0:matchUp.winningSide),sets=null==(_a=matchUp.score)?void 0:_a.sets,setsCount=null==sets?void 0:sets.length,setIndex=setNumber&&setNumber-1,isExistingSet=!!(null==sets?void 0:sets.find(((set,index)=>set.setNumber===setNumber&&index===setIndex))),completedSets=(null==sets?void 0:sets.filter((set=>null==set?void 0:set.winningSide)))||[],completedSetsCount=(null==completedSets?void 0:completedSets.length)||0,setsFollowingCurrent=setNumber&&(null==sets?void 0:sets.slice(setNumber))||[],isLastSetWithValues=!!(setsCount&&setNumber&&(null==setsFollowingCurrent?void 0:setsFollowingCurrent.reduce(((noValues,set)=>(!set||!set.side1Score&&!set.side2Score&&!set.side1TiebreakScore&&!set.side2TiebreakScore&&!set.side1PointScore&&!set.side2PointScore)&&noValues),!0))),setObject=setNumber<=setsCount&&sets.find((set=>set.setNumber===setNumber)),specifiedSetAnalysis=setObject&&analyzeSet({setObject,matchUpScoringFormat}),{isCompletedSet,sideGameScores,sideTiebreakScores}=specifiedSetAnalysis||{},isActiveSet=!!(setObject&&!isCompletedSet&&isLastSetWithValues||setNumber&&setNumber===setsCount+1&&!isCompletedMatchUp),isValidSideNumber=[1,2].includes(sideNumber),sideIndex=isValidSideNumber?sideNumber-1:0,existingValue=setObject&&isValidSideNumber&&(!isTiebreakValue&&!isPointValue&&void 0!==sideGameScores[sideIndex]&&sideGameScores[sideIndex]||isTiebreakValue&&void 0!==sideTiebreakScores[sideIndex]&&sideTiebreakScores[sideIndex]),hasExistingValue=!!existingValue,completedSetsHaveValidOutcomes=completedSets&&completedSets.map((setObject2=>analyzeSet({setObject:setObject2,matchUpScoringFormat}).isValidSetOutcome)).reduce(((valid,validOutcome)=>valid&&validOutcome),!0),setsWinCounts=completedSets.reduce(((counts,set)=>{const{winningSide}=set;return counts[winningSide-1]++,counts}),[0,0]),matchUpWinningSide=null==matchUp?void 0:matchUp.winningSide,matchUpWinningSideIndex=matchUpWinningSide&&matchUpWinningSide-1,matchUpLosingSideIndex=1-matchUpWinningSideIndex,winningSideSetsCount=setsWinCounts[matchUpWinningSideIndex],losingSideSetsCount=setsWinCounts[matchUpLosingSideIndex],maxSetsCount=Math.max(...setsWinCounts),maxSetsInstances=instanceCount(setsWinCounts)[maxSetsCount],{bestOf}=matchUpScoringFormat||{},calculatedWinningSide=maxSetsCount===(bestOf&&Math.ceil(bestOf/2)||1)&&1===maxSetsInstances&&setsWinCounts.indexOf(maxSetsCount)+1||void 0,validMatchUpWinningSide=winningSideSetsCount>losingSideSetsCount&&matchUpWinningSide===calculatedWinningSide;return __spreadValues$1B({isActiveSet,isExistingSet,existingValue,hasExistingValue,isValidSideNumber,completedSetsCount,isCompletedMatchUp,isLastSetWithValues,validMatchUpOutcome:calculatedWinningSide&&completedSetsHaveValidOutcomes&&validMatchUpWinningSide,matchUpScoringFormat,calculatedWinningSide,validMatchUpWinningSide,completedSetsHaveValidOutcomes},specifiedSetAnalysis)}const queryGovernor$1={tallyParticipantResults,matchUpIsComplete,analyzeMatchUp,getMatchUpType,scoreHasValue};let matchUpId,keyedMatchUps={};function setState$2(value,deepCopyOption=!0){if(!value)return{error:MISSING_VALUE};if("object"!=typeof value)return{error:INVALID_OBJECT};if(value.matchUpId)matchUpId=value.matchUpId,keyedMatchUps[matchUpId]=deepCopyOption?makeDeepCopy(value):value;else if(Array.isArray(value))for(const m of value.reverse())m.matchUpId&&(keyedMatchUps[m.matchUpId]=deepCopyOption?makeDeepCopy(m):m,matchUpId||(matchUpId=m.matchUpId));else for(const m of Object.values(value))m.matchUpId&&(keyedMatchUps[m.matchUpId]=deepCopyOption?makeDeepCopy(m):m,matchUpId||(matchUpId=m.matchUpId));return deepCopyOption?makeDeepCopy(value):value}function getMatchUp(){return keyedMatchUps[matchUpId]}function getMatchUps(){return Object.values(keyedMatchUps)}function reset(){matchUpId=void 0,keyedMatchUps={}}function getState$2({convertExtensions,removeExtensions}={}){return makeDeepCopy(keyedMatchUps[matchUpId],convertExtensions,!1,removeExtensions)}var __defProp$1A=Object.defineProperty,__defProps$Q=Object.defineProperties,__getOwnPropDescs$Q=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1A=Object.getOwnPropertySymbols,__hasOwnProp$1A=Object.prototype.hasOwnProperty,__propIsEnum$1A=Object.prototype.propertyIsEnumerable,__defNormalProp$1A=(obj,key,value)=>key in obj?__defProp$1A(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1A=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1A.call(b,prop)&&__defNormalProp$1A(a,prop,b[prop]);if(__getOwnPropSymbols$1A)for(var prop of __getOwnPropSymbols$1A(b))__propIsEnum$1A.call(b,prop)&&__defNormalProp$1A(a,prop,b[prop]);return a},__spreadProps$Q=(a,b)=>__defProps$Q(a,__getOwnPropDescs$Q(b));!function(){const engine={getState:()=>getState$2(),version:()=>"1.0.3",reset:()=>(reset(),__spreadValues$1A({},SUCCESS))};return function importGovernors(governors){governors.forEach((governor=>{Object.keys(governor).forEach((governorMethod=>{engine[governorMethod]=params=>{if(getDevContext())return invoke({params,governor,governorMethod});try{return invoke({params,governor,governorMethod})}catch(err){const error=err.toString();console.log("ERROR",{error,method:governorMethod,params:JSON.stringify(params)})}}}))}))}([tieFormatGovernor,historyGovernor,queryGovernor$1,scoreGovernor]),engine.devContext=contextCriteria=>(setDevContext(contextCriteria),engine),engine.setState=(definition,deepCopyOption,deepCopyAttributes)=>{setDeepCopy(deepCopyOption,deepCopyAttributes);return function processResult(result){return(null==result?void 0:result.error)?(engine.error=result.error,engine.success=!1):(engine.error=void 0,engine.success=!0,engine.drawId=result.drawId),engine}(setState$2(definition))},engine;function invoke({params,governor,governorMethod}){delete engine.success,delete engine.error;const matchUp=(null==params?void 0:params.matchUp)||getMatchUp(),matchUps=(null==params?void 0:params.matchUps)||getMatchUps(),snapshot=(null==params?void 0:params.rollbackOnError)&&makeDeepCopy(matchUp,!1,!0);params=__spreadProps$Q(__spreadValues$1A({},params),{matchUpId:null==matchUp?void 0:matchUp.matchUpId,matchUps,matchUp});const result=governor[governorMethod](params);if(null==result?void 0:result.error)return snapshot&&setState$2(snapshot),__spreadProps$Q(__spreadValues$1A({},result),{rolledBack:!!snapshot});const notify=(null==result?void 0:result.success)&&!0!==(null==params?void 0:params.delayNotify)&&!0!==(null==params?void 0:params.doNotNotify);return notify&&notifySubscribers(),(notify||!(null==result?void 0:result.success)||(null==params?void 0:params.doNotNotify))&&deleteNotices(),result}}();Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;var __defProp$1y=Object.defineProperty,__getOwnPropSymbols$1y=Object.getOwnPropertySymbols,__hasOwnProp$1y=Object.prototype.hasOwnProperty,__propIsEnum$1y=Object.prototype.propertyIsEnumerable,__defNormalProp$1y=(obj,key,value)=>key in obj?__defProp$1y(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1y=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1y.call(b,prop)&&__defNormalProp$1y(a,prop,b[prop]);if(__getOwnPropSymbols$1y)for(var prop of __getOwnPropSymbols$1y(b))__propIsEnum$1y.call(b,prop)&&__defNormalProp$1y(a,prop,b[prop]);return a};function newTournamentRecord(params={}){return params.tournamentId||Object.assign(params,{tournamentId:UUID()}),(!params.startDate||isISODateString(params.startDate)||validDateString.test(params.startDate))&&(!params.endDate||isISODateString(params.endDate)||validDateString.test(params.endDate))?(params.extensions&&(params.extensions=params.extensions.filter(isValidExtension)),__spreadValues$1y({},params)):{error:INVALID_DATE}}var __defProp$1x=Object.defineProperty,__defProps$O=Object.defineProperties,__getOwnPropDescs$O=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1x=Object.getOwnPropertySymbols,__hasOwnProp$1x=Object.prototype.hasOwnProperty,__propIsEnum$1x=Object.prototype.propertyIsEnumerable,__defNormalProp$1x=(obj,key,value)=>key in obj?__defProp$1x(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1x=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1x.call(b,prop)&&__defNormalProp$1x(a,prop,b[prop]);if(__getOwnPropSymbols$1x)for(var prop of __getOwnPropSymbols$1x(b))__propIsEnum$1x.call(b,prop)&&__defNormalProp$1x(a,prop,b[prop]);return a},__spreadProps$O=(a,b)=>__defProps$O(a,__getOwnPropDescs$O(b));function setState$1(tournament,deepCopyOption){var _a;if("object"!=typeof tournament)return{error:INVALID_OBJECT};const tournamentId=(null==(_a=tournament.unifiedTournamentId)?void 0:_a.tournamentId)||tournament.tournamentId;if(!tournamentId)return{error:MISSING_TOURNAMENT_ID};const tournamentRecord=!1!==deepCopyOption?makeDeepCopy(tournament):tournament;return setTournamentRecords({[tournamentId]:tournamentRecord}),setTournamentId(tournamentId),tournamentRecord}function getState$1({convertExtensions,removeExtensions,tournamentId}={}){if("string"!=typeof tournamentId)return{};return{tournamentRecord:makeDeepCopy(getTournamentRecord(tournamentId),convertExtensions,!1,removeExtensions)}}function paramsMiddleware$1(tournamentRecord,params,prefetch){if(params){const{drawId}=params||params.matchUp&&params.matchUp.drawId;if(drawId){const{event,drawDefinition}=findEvent({tournamentRecord,drawId});if(params=__spreadProps$O(__spreadValues$1x({},params),{event,drawDefinition}),prefetch){const matchUpsMap=getMatchUpsMap({drawDefinition}),{matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({includeByeMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap});params.matchUpsMap=matchUpsMap,params.inContextDrawMatchUps=inContextDrawMatchUps}}if(params.eventId&&!params.event){const{event}=findEvent({eventId:params.eventId,tournamentRecord});event&&(params=__spreadProps$O(__spreadValues$1x({},params),{event}))}}return params}var __defProp$1w=Object.defineProperty,__getOwnPropSymbols$1w=Object.getOwnPropertySymbols,__hasOwnProp$1w=Object.prototype.hasOwnProperty,__propIsEnum$1w=Object.prototype.propertyIsEnumerable,__defNormalProp$1w=(obj,key,value)=>key in obj?__defProp$1w(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$1v=Object.defineProperty,__defProps$N=Object.defineProperties,__getOwnPropDescs$N=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1v=Object.getOwnPropertySymbols,__hasOwnProp$1v=Object.prototype.hasOwnProperty,__propIsEnum$1v=Object.prototype.propertyIsEnumerable,__defNormalProp$1v=(obj,key,value)=>key in obj?__defProp$1v(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$1u=Object.defineProperty,__getOwnPropSymbols$1u=Object.getOwnPropertySymbols,__hasOwnProp$1u=Object.prototype.hasOwnProperty,__propIsEnum$1u=Object.prototype.propertyIsEnumerable,__defNormalProp$1u=(obj,key,value)=>key in obj?__defProp$1u(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1u=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1u.call(b,prop)&&__defNormalProp$1u(a,prop,b[prop]);if(__getOwnPropSymbols$1u)for(var prop of __getOwnPropSymbols$1u(b))__propIsEnum$1u.call(b,prop)&&__defNormalProp$1u(a,prop,b[prop]);return a};var __defProp$1t=Object.defineProperty,__getOwnPropSymbols$1t=Object.getOwnPropertySymbols,__hasOwnProp$1t=Object.prototype.hasOwnProperty,__propIsEnum$1t=Object.prototype.propertyIsEnumerable,__defNormalProp$1t=(obj,key,value)=>key in obj?__defProp$1t(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1t=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1t.call(b,prop)&&__defNormalProp$1t(a,prop,b[prop]);if(__getOwnPropSymbols$1t)for(var prop of __getOwnPropSymbols$1t(b))__propIsEnum$1t.call(b,prop)&&__defNormalProp$1t(a,prop,b[prop]);return a};function addIndividualParticipantIds({individualParticipantIds,groupingParticipantId,removeFromOtherTeams,tournamentRecord}){const stack="addIndividualParticipantIds";if(!tournamentRecord)return decorateResult({result:{error:MISSING_TOURNAMENT_RECORD},stack});if(!groupingParticipantId||!individualParticipantIds)return decorateResult({result:{error:MISSING_VALUE},stack});const tournamentParticipants=tournamentRecord.participants||[],groupingParticipant=tournamentParticipants.find((participant=>participant.participantId===groupingParticipantId));if(!groupingParticipant)return decorateResult({result:{error:PARTICIPANT_NOT_FOUND},stack});if(![TEAM,GROUP].includes(groupingParticipant.participantType))return decorateResult({result:{error:INVALID_PARTICIPANT_TYPE},context:{participantType:groupingParticipant.participantType},stack});const invalidParticipantIds=individualParticipantIds.filter((participantId=>{const participant=tournamentParticipants.find((tournamentParticipant=>tournamentParticipant.participantId===participantId));return(null==participant?void 0:participant.participantType)!==INDIVIDUAL}));if(invalidParticipantIds.length)return decorateResult({result:{error:INVALID_PARTICIPANT_IDS,invalidParticipantIds},stack});groupingParticipant.individualParticipantIds||(groupingParticipant.individualParticipantIds=[]);const existingIndividualParticipantIds=groupingParticipant.individualParticipantIds,participantIdsToAdd=individualParticipantIds.filter((participantId=>!existingIndividualParticipantIds.includes(participantId)));participantIdsToAdd.length&&(removeFromOtherTeams&&removeParticipantIdsFromAllTeams({individualParticipantIds:participantIdsToAdd,tournamentRecord}),groupingParticipant.individualParticipantIds=groupingParticipant.individualParticipantIds.concat(...participantIdsToAdd));const{topics}=getTopics();if(topics.includes(MODIFY_PARTICIPANTS)){const updatedParticipant=tournamentParticipants.find((({participantId})=>participantId===groupingParticipantId));addNotice({topic:MODIFY_PARTICIPANTS,payload:{participants:[updatedParticipant]}})}return function updateTeamEventEntries({individualParticipantIds,groupingParticipantId,tournamentRecord}){var _a,_b;const relevantEvents=(tournamentRecord.events||[]).filter((event=>{var _a2;return(null==event?void 0:event.eventType)===TEAM$1&&(null==(_a2=null==event?void 0:event.entries)?void 0:_a2.some((entry=>entry.participantId===groupingParticipantId)))})),filterEntry=entry=>!individualParticipantIds.includes(entry.participantId);for(const event of relevantEvents){event.entries=(event.entries||[]).filter(filterEntry);const{flightProfile}=getFlightProfile({event});null==(_a=null==flightProfile?void 0:flightProfile.flights)||_a.forEach((flight=>{flight.drawEntries=(flight.drawEntries||[]).filter(filterEntry)})),null==(_b=null==event?void 0:event.drawDefinitions)||_b.forEach((drawDefinition=>{drawDefinition.entries=(drawDefinition.entries||[]).filter(filterEntry)}))}return __spreadValues$1u({},SUCCESS)}({individualParticipantIds,groupingParticipantId,tournamentRecord}),__spreadValues$1t({groupingParticipant:makeDeepCopy(groupingParticipant,!1,!0),added:participantIdsToAdd.length},SUCCESS)}var __defProp$1s=Object.defineProperty,__getOwnPropSymbols$1s=Object.getOwnPropertySymbols,__hasOwnProp$1s=Object.prototype.hasOwnProperty,__propIsEnum$1s=Object.prototype.propertyIsEnumerable,__defNormalProp$1s=(obj,key,value)=>key in obj?__defProp$1s(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1s=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1s.call(b,prop)&&__defNormalProp$1s(a,prop,b[prop]);if(__getOwnPropSymbols$1s)for(var prop of __getOwnPropSymbols$1s(b))__propIsEnum$1s.call(b,prop)&&__defNormalProp$1s(a,prop,b[prop]);return a};var __defProp$1r=Object.defineProperty,__defProps$M=Object.defineProperties,__getOwnPropDescs$M=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1r=Object.getOwnPropertySymbols,__hasOwnProp$1r=Object.prototype.hasOwnProperty,__propIsEnum$1r=Object.prototype.propertyIsEnumerable,__defNormalProp$1r=(obj,key,value)=>key in obj?__defProp$1r(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1r=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1r.call(b,prop)&&__defNormalProp$1r(a,prop,b[prop]);if(__getOwnPropSymbols$1r)for(var prop of __getOwnPropSymbols$1r(b))__propIsEnum$1r.call(b,prop)&&__defNormalProp$1r(a,prop,b[prop]);return a},__spreadProps$M=(a,b)=>__defProps$M(a,__getOwnPropDescs$M(b));function generateTeamsFromParticipantAttribute({addParticipants=!0,participantAttribute,tournamentRecord,personAttribute,teamNames,accessor,uuids}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const teams={},individualParticipants=(tournamentRecord.participants||[]).filter((({participantType,participantRole})=>participantType===INDIVIDUAL&&participantRole===COMPETITOR));let teamIndex=0;for(const individualParticipant of individualParticipants){const attributeValue=accessor&&(null==(_a=getAccessorValue({element:individualParticipant,accessor}))?void 0:_a.value)||(personAttribute?individualParticipant.person[personAttribute]:individualParticipant[participantAttribute]);if(attributeValue){if(!Object.keys(teams).includes(attributeValue)){teams[attributeValue]={participantName:(null==teamNames?void 0:teamNames[teamIndex])||attributeValue,participantId:(null==uuids?void 0:uuids.pop())||UUID(),individualParticipantIds:[],participantRole:COMPETITOR,participantType:TEAM};const extension={name:GROUPING_ATTRIBUTE,value:personAttribute||participantAttribute};addExtension$1({element:teams[attributeValue],extension}),teamIndex+=1}teams[attributeValue].individualParticipantIds.push(individualParticipant.participantId)}}const groupingAttributes=Object.keys(teams),overlappingTeamParticipantIds=(tournamentRecord.participants||[]).map((participant=>{if(participant.participantType!==TEAM)return;if(participant.participantRole!==COMPETITOR)return;const{extension}=findExtension$2({name:GROUPING_ATTRIBUTE,element:participant}),groupingAttribute=null==extension?void 0:extension.value;return groupingAttributes.includes(groupingAttribute)?participant.participantId:void 0})).filter(Boolean);let participantsAdded=0;const newParticipants=[];return Object.keys(teams).forEach((attributeValue=>{const participant=teams[attributeValue],{participantId}=participant;overlappingTeamParticipantIds.includes(participantId)||(addParticipants&&tournamentRecord.participants.push(participant),newParticipants.push(participant),participantsAdded++)})),addParticipants&&participantsAdded?(addNotice({payload:{tournamentId:tournamentRecord.tournamentId,participants:newParticipants},topic:ADD_PARTICIPANTS}),__spreadProps$M(__spreadValues$1r({},SUCCESS),{participantsAdded})):newParticipants.length?__spreadProps$M(__spreadValues$1r({},SUCCESS),{newParticipants}):{error:NO_PARTICIPANTS_GENERATED}}var __defProp$1q=Object.defineProperty,__getOwnPropSymbols$1q=Object.getOwnPropertySymbols,__hasOwnProp$1q=Object.prototype.hasOwnProperty,__propIsEnum$1q=Object.prototype.propertyIsEnumerable,__defNormalProp$1q=(obj,key,value)=>key in obj?__defProp$1q(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$1p=Object.defineProperty,__defProps$L=Object.defineProperties,__getOwnPropDescs$L=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1p=Object.getOwnPropertySymbols,__hasOwnProp$1p=Object.prototype.hasOwnProperty,__propIsEnum$1p=Object.prototype.propertyIsEnumerable,__defNormalProp$1p=(obj,key,value)=>key in obj?__defProp$1p(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$1o=Object.defineProperty,__defProps$K=Object.defineProperties,__getOwnPropDescs$K=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1o=Object.getOwnPropertySymbols,__hasOwnProp$1o=Object.prototype.hasOwnProperty,__propIsEnum$1o=Object.prototype.propertyIsEnumerable,__defNormalProp$1o=(obj,key,value)=>key in obj?__defProp$1o(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$1n=Object.defineProperty,__getOwnPropSymbols$1n=Object.getOwnPropertySymbols,__hasOwnProp$1n=Object.prototype.hasOwnProperty,__propIsEnum$1n=Object.prototype.propertyIsEnumerable,__defNormalProp$1n=(obj,key,value)=>key in obj?__defProp$1n(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$1m=Object.defineProperty,__defProps$J=Object.defineProperties,__getOwnPropDescs$J=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1m=Object.getOwnPropertySymbols,__hasOwnProp$1m=Object.prototype.hasOwnProperty,__propIsEnum$1m=Object.prototype.propertyIsEnumerable,__defNormalProp$1m=(obj,key,value)=>key in obj?__defProp$1m(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$1l=Object.defineProperty,__getOwnPropSymbols$1l=Object.getOwnPropertySymbols,__hasOwnProp$1l=Object.prototype.hasOwnProperty,__propIsEnum$1l=Object.prototype.propertyIsEnumerable,__defNormalProp$1l=(obj,key,value)=>key in obj?__defProp$1l(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$1k=Object.defineProperty,__getOwnPropSymbols$1k=Object.getOwnPropertySymbols,__hasOwnProp$1k=Object.prototype.hasOwnProperty,__propIsEnum$1k=Object.prototype.propertyIsEnumerable,__defNormalProp$1k=(obj,key,value)=>key in obj?__defProp$1k(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$1j=Object.defineProperty,__defProps$I=Object.defineProperties,__getOwnPropDescs$I=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1j=Object.getOwnPropertySymbols,__hasOwnProp$1j=Object.prototype.hasOwnProperty,__propIsEnum$1j=Object.prototype.propertyIsEnumerable,__defNormalProp$1j=(obj,key,value)=>key in obj?__defProp$1j(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1j=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1j.call(b,prop)&&__defNormalProp$1j(a,prop,b[prop]);if(__getOwnPropSymbols$1j)for(var prop of __getOwnPropSymbols$1j(b))__propIsEnum$1j.call(b,prop)&&__defNormalProp$1j(a,prop,b[prop]);return a},__spreadProps$I=(a,b)=>__defProps$I(a,__getOwnPropDescs$I(b));function modifyParticipant({updateParticipantName=!0,groupingParticipantId,removeFromOtherTeams,tournamentRecord,pairOverride,participant}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participant)return{error:MISSING_PARTICIPANT};if(!participant.participantId)return addParticipant$1({tournamentRecord,participant});const{participant:existingParticipant}=findTournamentParticipant({tournamentRecord,participantId:participant.participantId});if(!existingParticipant)return addParticipant$1({tournamentRecord,participant});const{participantRoleResponsibilties,individualParticipantIds,participantOtherName,participantName,participantRole,participantType,onlineResources,contacts,person}=participant,newValues={};if(contacts&&(newValues.contacts=contacts),onlineResources&&(newValues.onlineResources=onlineResources),participantName&&"string"==typeof participantName&&(newValues.participantName=participantName),participantOtherName&&"string"==typeof participantOtherName&&(newValues.participantOtherName=participantOtherName),Array.isArray(individualParticipantIds)){const{tournamentParticipants:individualParticipants}=getTournamentParticipants({tournamentRecord,participantFilters:{participantTypes:[participantTypes.INDIVIDUAL]}}),allIndividualParticipantIds=null==individualParticipants?void 0:individualParticipants.map(getParticipantId);if(allIndividualParticipantIds){const updatedIndividualParticipantIds=individualParticipantIds.filter((participantId=>"string"==typeof participantId&&allIndividualParticipantIds.includes(participantId)));([GROUP,TEAM$2].includes(participantType)||participantType===PAIR&&(2===updatedIndividualParticipantIds.length||pairOverride))&&(newValues.individualParticipantIds=updatedIndividualParticipantIds),existingParticipant.participantType===participantTypes.PAIR&&updateParticipantName&&(newValues.participantName=function generatePairParticipantName$1({individualParticipants,newValues}){const individualParticipantIds=newValues.individualParticipantIds;let participantName=individualParticipants.filter((({participantId})=>individualParticipantIds.includes(participantId))).map((({person})=>null==person?void 0:person.standardFamilyName)).filter(Boolean).sort().join("/");1===individualParticipantIds.length&&(participantName+="/Unknown");return participantName}({individualParticipants,newValues}))}}return Object.keys(participantRoles).includes(participantRole)&&(newValues.participantRole=participantRole),Object.keys(participantTypes).includes(participantType)&&(newValues.participantType=participantType),Array.isArray(participantRoleResponsibilties)&&(newValues.participantRoleResponsibilties=participantRoleResponsibilties),existingParticipant.participantType===participantTypes.INDIVIDUAL&&person&&function updatePerson({updateParticipantName,existingParticipant,newValues,person}){const newPersonValues={},{sex,personId,nationalityCode,standardFamilyName,standardGivenName}=person;sex&&Object.keys(genderConstants).includes(sex)&&(newPersonValues.sex=sex);let personNameModified;personId&&"string"==typeof personId&&(newPersonValues.personId=personId);nationalityCode&&"string"==typeof nationalityCode&&(function validNationalityCode(code){return countries.flatMap((({iso,ioc})=>[iso,ioc])).filter(Boolean).includes(code)}(nationalityCode)||""===nationalityCode)&&(newPersonValues.nationalityCode=nationalityCode);standardFamilyName&&"string"==typeof standardFamilyName&&standardFamilyName.length>1&&(newPersonValues.standardFamilyName=standardFamilyName,personNameModified=!0);standardGivenName&&"string"==typeof standardGivenName&&standardGivenName.length>1&&(newPersonValues.standardGivenName=standardGivenName,personNameModified=!0);if(personNameModified&&updateParticipantName){const participantName=`${newPersonValues.standardGivenName} ${newPersonValues.standardFamilyName}`;newValues.participantName=participantName}Object.assign(existingParticipant.person,newPersonValues)}({updateParticipantName,existingParticipant,newValues,person}),Object.assign(existingParticipant,definedAttributes(newValues)),groupingParticipantId&&addIndividualParticipantIds({tournamentRecord,groupingParticipantId,individualParticipantIds:[existingParticipant.participantId],removeFromOtherTeams}),addNotice({topic:MODIFY_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:[existingParticipant]}}),__spreadProps$I(__spreadValues$1j({},SUCCESS),{participant:makeDeepCopy(existingParticipant)})}var __defProp$1i=Object.defineProperty,__getOwnPropSymbols$1i=Object.getOwnPropertySymbols,__hasOwnProp$1i=Object.prototype.hasOwnProperty,__propIsEnum$1i=Object.prototype.propertyIsEnumerable,__defNormalProp$1i=(obj,key,value)=>key in obj?__defProp$1i(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1i=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1i.call(b,prop)&&__defNormalProp$1i(a,prop,b[prop]);if(__getOwnPropSymbols$1i)for(var prop of __getOwnPropSymbols$1i(b))__propIsEnum$1i.call(b,prop)&&__defNormalProp$1i(a,prop,b[prop]);return a};function addDrawDefinitionTimeItem({drawDefinition,timeItem}){if(!drawDefinition)return{error:DRAW_DEFINITION_NOT_FOUND};if(!timeItem)return{error:MISSING_TIME_ITEM};const timeItemAttributes=timeItem&&Object.keys(timeItem),requiredAttributes=["itemType","itemValue"];if(!(requiredAttributes.filter((attribute=>timeItemAttributes.includes(attribute))).length===requiredAttributes.length))return{error:INVALID_TIME_ITEM};drawDefinition.timeItems||(drawDefinition.timeItems=[]);const createdAt=(new Date).toISOString();return Object.assign(timeItem,{createdAt}),drawDefinition.timeItems.push(timeItem),addDrawNotice({drawDefinition}),__spreadValues$1i({},SUCCESS)}var __defProp$1h=Object.defineProperty,__defProps$H=Object.defineProperties,__getOwnPropDescs$H=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1h=Object.getOwnPropertySymbols,__hasOwnProp$1h=Object.prototype.hasOwnProperty,__propIsEnum$1h=Object.prototype.propertyIsEnumerable,__defNormalProp$1h=(obj,key,value)=>key in obj?__defProp$1h(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1h=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1h.call(b,prop)&&__defNormalProp$1h(a,prop,b[prop]);if(__getOwnPropSymbols$1h)for(var prop of __getOwnPropSymbols$1h(b))__propIsEnum$1h.call(b,prop)&&__defNormalProp$1h(a,prop,b[prop]);return a},__spreadProps$H=(a,b)=>__defProps$H(a,__getOwnPropDescs$H(b));function setParticipantScaleItem({removePriorValues,tournamentRecord,participantId,scaleItem}){let equivalentValue,participant;if(!isValidScaleItem({scaleItem}))return{error:INVALID_SCALE_ITEM};if(participantId&&Array.isArray(tournamentRecord.participants)&&(participant=tournamentRecord.participants.find((participant2=>participant2.participantId===participantId)),participant)){const result=addParticipantScaleItem({removePriorValues,participant,scaleItem});if(result.error)return result;equivalentValue=!result.valueChanged;const{topics}=getTopics();topics.includes(MODIFY_PARTICIPANTS)&&addNotice({topic:MODIFY_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:[participant]}})}return equivalentValue&&__spreadProps$H(__spreadValues$1h({},SUCCESS),{info:VALUE_UNCHANGED,existingValue:scaleItem.scaleValue})||participant&&__spreadProps$H(__spreadValues$1h({},SUCCESS),{newValue:scaleItem.scaleValue})||{error:PARTICIPANT_NOT_FOUND}}function isValidScaleItem({scaleItem}){const scaleItemAttributes=scaleItem&&Object.keys(scaleItem),requiredAttributes=["scaleType","eventType","scaleName"];return!!(requiredAttributes.filter((attribute=>null==scaleItemAttributes?void 0:scaleItemAttributes.includes(attribute))).length===requiredAttributes.length)}function addParticipantScaleItem({removePriorValues,participant,scaleItem}){if(!participant)return{error:MISSING_PARTICIPANT};const scaleItemAttributes=scaleItem&&Object.keys(scaleItem),requiredAttributes=["scaleType","eventType","scaleName"];if(!(requiredAttributes.filter((attribute=>scaleItemAttributes.includes(attribute)&&scaleItem[attribute])).length===requiredAttributes.length))return{error:INVALID_SCALE_ITEM};const createdAt=(new Date).toISOString();participant.timeItems||(participant.timeItems=[]);const{scaleItem:existingScaleItem}=participantScaleItem({scaleAttributes:scaleItem,participant}),isUndefined=value=>[void 0,null,""].includes(value),valueChanged=!(isUndefined(null==existingScaleItem?void 0:existingScaleItem.scaleValue)&&isUndefined(scaleItem.scaleValue))&&JSON.stringify(null==existingScaleItem?void 0:existingScaleItem.scaleValue)!==JSON.stringify(scaleItem.scaleValue);if(valueChanged){const{scaleType,eventType,scaleName}=scaleItem,itemType=[SCALE$1,scaleType,eventType,scaleName].join("."),timeItem=definedAttributes({itemValue:scaleItem.scaleValue,itemDate:scaleItem.scaleDate,createdAt,itemType});scaleItem.scaleId&&(timeItem.itemSubTypes=[scaleItem.scaleId]),removePriorValues&&(participant.timeItems=participant.timeItems.filter((timeItem2=>timeItem2.itemType!==itemType))),participant.timeItems.push(timeItem)}return __spreadProps$H(__spreadValues$1h({},SUCCESS),{valueChanged,newValue:scaleItem.scaleValue})}const participantGovernor={getTournamentPenalties,modifyPenalty:modifyPenalty$1,removePenalty:removePenalty$1,addPenalty:addPenalty$1,createGroupParticipant:function createGroupParticipant({individualParticipantIds=[],participantRoleResponsibilities,participantRole="OTHER",tournamentRecord,participantId,groupName}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!groupName)return{error:MISSING_VALUE,info:"Missing groupName"};if(!Array.isArray(individualParticipantIds))return{info:"Invalid individualParticipantIds",error:INVALID_VALUES};const{tournamentParticipants}=getTournamentParticipants({participantFilters:{participantTypes:[INDIVIDUAL]},tournamentRecord}),tournamentIndividualParticipantIds=tournamentParticipants.map((participant=>participant.participantId));for(const participantId2 of individualParticipantIds)if(!tournamentIndividualParticipantIds.includes(participantId2))return{error:INVALID_PARTICIPANT_TYPE,participantId:participantId2};const groupParticipant=definedAttributes({participantId:participantId||UUID(),participantType:GROUP,participantRole,participantName:groupName,individualParticipantIds,participantRoleResponsibilities}),result=addParticipant$1({tournamentRecord,participant:groupParticipant});if(result.error)return result;const{topics}=getTopics();return topics.includes(ADD_PARTICIPANTS)&&addNotice({topic:ADD_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:[groupParticipant]}}),a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1o.call(b,prop)&&__defNormalProp$1o(a,prop,b[prop]);if(__getOwnPropSymbols$1o)for(var prop of __getOwnPropSymbols$1o(b))__propIsEnum$1o.call(b,prop)&&__defNormalProp$1o(a,prop,b[prop]);return a})({},SUCCESS),b={participant:makeDeepCopy(groupParticipant)},__defProps$K(a,__getOwnPropDescs$K(b));var a,b},scaledTeamAssignment:function scaledTeamAssignment({clearExistingAssignments=!0,individualParticipantIds,reverseAssignmentOrder,initialTeamIndex=0,scaledParticipants=[],teamParticipantIds,tournamentRecord,scaleAttributes,teamNameBase,teamsCount,eventId,event}){var _a,_b;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(teamParticipantIds)&&!isConvertableInteger(teamsCount)&&!eventId||!isConvertableInteger(initialTeamIndex)||scaledParticipants&&!Array.isArray(scaledParticipants)||scaleAttributes&&("object"!=typeof scaleAttributes||!Object.keys(scaleAttributes).length))return{error:INVALID_VALUES};if(!scaleAttributes&&!scaledParticipants.length||!scaledParticipants&&(!individualParticipantIds||!scaleAttributes))return{error:MISSING_VALUE,info:"Missing scaling details"};if(eventId&&!teamParticipantIds){if((null==event?void 0:event.eventType)!==TEAM_EVENT)return{error:INVALID_EVENT_TYPE};teamParticipantIds=event.entries.filter((({entryStatus})=>entryStatus===DIRECT_ACCEPTANCE)).map(getParticipantId)}if(!(null==teamParticipantIds?void 0:teamParticipantIds.length)&&!teamsCount)return{info:"Missing teamParticipantIds or teamsCount",error:MISSING_VALUE};let participantIdsToAssign=individualParticipantIds||scaledParticipants.map((({participantId})=>participantId));reverseAssignmentOrder&&(teamParticipantIds.reverse(),initialTeamIndex+=1),initialTeamIndex>(null==teamParticipantIds?void 0:teamParticipantIds.length)-1&&(initialTeamIndex=0);const orderedTeamParticipantIds=(null==teamParticipantIds?void 0:teamParticipantIds.slice(initialTeamIndex).concat(...teamParticipantIds.slice(0,initialTeamIndex)))||[],relevantTeams=[];for(const participant of tournamentRecord.participants||[]){const{participantId,participantType}=participant;if(orderedTeamParticipantIds.includes(participantId)){if(participantType!==TEAM_PARTICIPANT)return{error:INVALID_PARTICIPANT_TYPE,participant};relevantTeams.push(participant)}}if(teamsCount&&relevantTeams.length<teamsCount){const addCount=teamsCount-((null==relevantTeams?void 0:relevantTeams.length)||0),nameBase=teamNameBase||"Team";let teamParticipants=generateRange(0,addCount).map((i=>({participantName:`${nameBase} ${i+1}`,participantType:TEAM_PARTICIPANT,participantRole:COMPETITOR})));const{participants=[]}=addParticipants({participants:teamParticipants,returnParticipants:!0,tournamentRecord}),addedParticipantIds=participants.map(getParticipantId),addedParticipants=tournamentRecord.participants.filter((({participantId})=>addedParticipantIds.includes(participantId)));relevantTeams.push(...addedParticipants)}if(!relevantTeams.length)return{error:TEAM_NOT_FOUND};if(clearExistingAssignments)for(const relevantTeam of relevantTeams)relevantTeam.individualParticipantIds=[];else{const preAssignedParticipantIds=relevantTeams.map((individualParticipantIds2=>individualParticipantIds2)).flat();(null==individualParticipantIds?void 0:individualParticipantIds.length)?participantIdsToAssign=participantIdsToAssign.filter((participantId=>!preAssignedParticipantIds.includes(participantId))):scaledParticipants=null==scaledParticipants?void 0:scaledParticipants.filter((({participantId})=>!preAssignedParticipantIds.includes(participantId)))}if(!(null==individualParticipantIds?void 0:individualParticipantIds.length)&&!(null==scaledParticipants?void 0:scaledParticipants.length))return{error:NO_CANDIDATES,info:"Nothing to be done"};if(!scaledParticipants.length){for(const participant of tournamentRecord.participants||[]){const{participantId,participantType}=participant;if(!participantIdsToAssign.includes(participantId))continue;if(participantType!==INDIVIDUAL)return{error:INVALID_PARTICIPANT_TYPE,participant};const scaleItem=null==(_a=participantScaleItem({scaleAttributes,participant}))?void 0:_a.scaleItem,scaledParticipant={participantId,scaleValue:(null==scaleAttributes?void 0:scaleAttributes.accessor)?null==(_b=null==scaleItem?void 0:scaleItem.scaleValue)?void 0:_b[null==scaleAttributes?void 0:scaleAttributes.accessor]:null==scaleItem?void 0:scaleItem.scaleValue};scaledParticipants.push(scaledParticipant)}if(!scaledParticipants.length)return{error:PARTICIPANT_NOT_FOUND}}scaledParticipants.sort(((a,b)=>(null==scaleAttributes?void 0:scaleAttributes.sortOrder)?((null==b?void 0:b.scaleValue)||0)-((null==a?void 0:a.scaleValue)||0):((null==a?void 0:a.scaleValue)||1/0)-((null==b?void 0:b.scaleValue)||1/0)));for(const scaledParticipant of scaledParticipants)if(!scaledParticipant.participantId)return{error:INVALID_VALUES,scaledParticipant};let index=0;for(;index<scaledParticipants.length;){for(const relevantTeam of relevantTeams){if(index+1>scaledParticipants.length)break;const scaledParticipant=scaledParticipants[index];relevantTeam.individualParticipantIds.push(scaledParticipant.participantId),index++}relevantTeams.reverse()}const relevantTeamParticipantIds=relevantTeams.map(getParticipantId);for(const event2 of tournamentRecord.events||[]){if(event2.eventType!==TEAM_EVENT)continue;const relevantTeamEntries=(event2.entries||[]).filter((entry=>relevantTeamParticipantIds.includes(entry.participantId)));for(const relevantEntry of relevantTeamEntries){const relevantTeamParticipantId=relevantEntry.participantId,relevantTeam=relevantTeams.find((teamParticipant=>teamParticipant.participantId===relevantTeamParticipantId)),individualParticipantIds2=null==relevantTeam?void 0:relevantTeam.individualParticipantIds;event2.entries=(event2.entries||[]).filter((entry=>!individualParticipantIds2.includes(entry.participantId))),(event2.drawDefinitions||[]).forEach((drawDefinition=>{drawDefinition.entries=(drawDefinition.entries||[]).filter((entry=>!individualParticipantIds2.includes(entry.participantId)))}));const{flightProfile}=getFlightProfile({event:event2});((null==flightProfile?void 0:flightProfile.flights)||[]).forEach((flight=>{flight.drawEntries=(flight.drawEntries||[]).filter((entry=>!individualParticipantIds2.includes(entry.participantId)))}))}}return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1p.call(b,prop)&&__defNormalProp$1p(a,prop,b[prop]);if(__getOwnPropSymbols$1p)for(var prop of __getOwnPropSymbols$1p(b))__propIsEnum$1p.call(b,prop)&&__defNormalProp$1p(a,prop,b[prop]);return a})({},SUCCESS),__defProps$L(a,__getOwnPropDescs$L({scaledParticipants}));var a},deleteParticipants,addParticipants,addParticipant:addParticipant$1,addPersons:function addPersons({participantRole=COMPETITOR,tournamentRecord,persons}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(persons))return{error:INVALID_VALUES};if(!Object.keys(participantRoles).includes(participantRole))return{error:INVALID_PARTICIPANT_ROLE};const existingPersonIds=(tournamentRecord.participants||[]).map((({person})=>null==person?void 0:person.personId)).filter(Boolean),newPersonIds=[],personsToAdd=persons.filter((person=>person&&(!person.personId||!existingPersonIds.includes(person.personId)))).map((person=>(person.personId||(person.personId=UUID()),newPersonIds.push(person.personId),person)));let addedPairParticipantsCount=0,addedIndividualParticipantsCount=0,result=addParticipants({participants:personsToAdd.map((person=>{return definedAttributes({extensions:person.participantExtensions,timeItems:person.participantTimeItems,participantType:INDIVIDUAL,participantRole,person:(element=person,attributes=["participantExtensions","participantTimeItems","pairedPersons"],Object.assign({},...Object.keys(element).filter((key=>!attributes.includes(key))).map((key=>({[key]:element[key]})))))});var element,attributes})),tournamentRecord});if(result.error)return result;addedIndividualParticipantsCount=result.addedCount||0;const pairParticipants=[],tournamentParticipants=(null==(_a=getTournamentParticipants({participantFilters:{participantTypes:[INDIVIDUAL]},tournamentRecord}))?void 0:_a.tournamentParticipants)||[];if(participantRole===COMPETITOR&&persons.filter((({pairedPersons})=>pairedPersons)).forEach((({personId,pairedPersons})=>{Array.isArray(pairedPersons)&&pairedPersons.forEach((pairing=>{const individualParticipants2=[personId,pairing.personId].map((id=>findParticipant({tournamentParticipants,personId:id}))).filter(Boolean);if(2===individualParticipants2.length){const individualParticipantIds=individualParticipants2.map(getParticipantId);pairParticipants.push(definedAttributes({extensions:pairing.participantExtensions,timeItems:pairing.timeItems,participantRole:COMPETITOR,individualParticipantIds,participantType:PAIR}))}}))})),pairParticipants.length){if(result=addParticipants({participants:pairParticipants,tournamentRecord}),result.error)return result;addedPairParticipantsCount=result.addedCount||0}const addedCount=addedIndividualParticipantsCount+addedPairParticipantsCount;return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1v.call(b,prop)&&__defNormalProp$1v(a,prop,b[prop]);if(__getOwnPropSymbols$1v)for(var prop of __getOwnPropSymbols$1v(b))__propIsEnum$1v.call(b,prop)&&__defNormalProp$1v(a,prop,b[prop]);return a})({},SUCCESS),__defProps$N(a,__getOwnPropDescs$N({addedCount,newPersonIds}));var a},addIndividualParticipantIds,removeIndividualParticipantIds,modifyIndividualParticipantIds:function modifyIndividualParticipantIds({individualParticipantIds,groupingParticipantId,tournamentRecord}){const stack="modifyIndividualParticipantIds";if(!tournamentRecord)return decorateResult({result:{error:MISSING_TOURNAMENT_RECORD},stack});if(!groupingParticipantId||!individualParticipantIds)return decorateResult({result:{error:MISSING_VALUE},stack});const tournamentParticipants=tournamentRecord.participants||[],groupingParticipant=tournamentParticipants.find((participant=>participant.participantId===groupingParticipantId));if(!groupingParticipant)return decorateResult({result:{error:PARTICIPANT_NOT_FOUND},stack});if(![TEAM,GROUP].includes(groupingParticipant.participantType))return decorateResult({result:{error:INVALID_PARTICIPANT_TYPE},context:{participantType:groupingParticipant.participantType},stack});const invalidParticipantIds=individualParticipantIds.filter((participantId=>{const participant=tournamentParticipants.find((tournamentParticipant=>tournamentParticipant.participantId===participantId));return(null==participant?void 0:participant.participantType)!==INDIVIDUAL}));if(invalidParticipantIds.length)return decorateResult({result:{error:INVALID_PARTICIPANT_IDS,invalidParticipantIds},stack});const existingIndividualParticipantIds=groupingParticipant.individualParticipantIds||[],individualParticipantIdsToAdd=individualParticipantIds.filter((participantId=>!existingIndividualParticipantIds.includes(participantId))),individualParticipantIdsToRemove=existingIndividualParticipantIds.filter((participantId=>!individualParticipantIds.includes(participantId))),addResult=addIndividualParticipantIds({individualParticipantIds:individualParticipantIdsToAdd,groupingParticipantId,tournamentRecord});if(addResult.error)return decorateResult({result:addResult,stack});const removeResult=removeIndividualParticipantIds({individualParticipantIds:individualParticipantIdsToRemove,groupingParticipantId,tournamentRecord});if(removeResult.error)return decorateResult({result:removeResult,stack});const{topics}=getTopics();if(topics.includes(MODIFY_PARTICIPANTS)){const updatedParticipant=tournamentParticipants.find((({participantId})=>participantId===groupingParticipantId));addNotice({topic:MODIFY_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:[updatedParticipant]}})}return __spreadValues$1s(__spreadValues$1s({},addResult),removeResult)},removeParticipantIdsFromAllTeams,getParticipantMembership:function getParticipantMembership({tournamentRecord,participantId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participantId)return{error:MISSING_PARTICIPANT_ID};const{tournamentParticipants}=getTournamentParticipants({participantFilters:{participantTypes:[TEAM,PAIR,GROUP]},tournamentRecord});return(tournamentParticipants||[]).filter((participant=>{var _a;return null==(_a=participant.individualParticipantIds)?void 0:_a.includes(participantId)})).reduce(((groupingTypesMap,participant)=>{const{participantType}=participant;return groupingTypesMap[participantType]||(groupingTypesMap[participantType]=[]),groupingTypesMap[participantType].push(participant),groupingTypesMap}),{})},generateTeamsFromParticipantAttribute,getParticipantIdFinishingPositions:function getParticipantIdFinishingPositions({tournamentRecord,drawDefinition,byeAdvancements=!1}){return tournamentRecord?getParticipantIdFinishingPositions$1({tournamentParticipants:tournamentRecord.participants,byeAdvancements,drawDefinition}):{error:MISSING_TOURNAMENT_RECORD}},modifyParticipant,modifyParticipantName:function modifyParticipantName({tournamentRecord,participantName,participantId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participantId)return{error:MISSING_PARTICIPANT_ID};if(!participantName)return{error:MISSING_VALUE,info:"Missing participantName"};const{participant}=findTournamentParticipant({tournamentRecord,participantId});if(!participant)return{error:PARTICIPANT_NOT_FOUND};participant.participantName=participantName;const{topics}=getTopics();return topics.includes(MODIFY_PARTICIPANTS)&&addNotice({topic:MODIFY_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:[participant]}}),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1l.call(b,prop)&&__defNormalProp$1l(a,prop,b[prop]);if(__getOwnPropSymbols$1l)for(var prop of __getOwnPropSymbols$1l(b))__propIsEnum$1l.call(b,prop)&&__defNormalProp$1l(a,prop,b[prop]);return a})({},SUCCESS)},modifyParticipantOtherName:function modifyParticipantOtherName({tournamentRecord,participantId,participantOtherName}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participantId)return{error:MISSING_PARTICIPANT_ID};const{participant}=findTournamentParticipant({tournamentRecord,participantId});if(!participant)return{error:PARTICIPANT_NOT_FOUND};participant.participantOtherName=participantOtherName;const{topics}=getTopics();return topics.includes(MODIFY_PARTICIPANTS)&&addNotice({topic:MODIFY_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:[participant]}}),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1n.call(b,prop)&&__defNormalProp$1n(a,prop,b[prop]);if(__getOwnPropSymbols$1n)for(var prop of __getOwnPropSymbols$1n(b))__propIsEnum$1n.call(b,prop)&&__defNormalProp$1n(a,prop,b[prop]);return a})({},SUCCESS)},mergeParticipants:function mergeParticipants({tournamentRecord,participants:incomingParticipants=[],arraysToMerge}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};tournamentRecord.participants||(tournamentRecord.participants=[]);const incomingIdMap=Object.assign(...incomingParticipants.filter(hasParticipantId).map((p=>({[p.participantId]:p})))),modifiedParticipants=[];tournamentRecord.participants=tournamentRecord.participants.map((participant=>{if(incomingIdMap[participant.participantId]){const mergedParticipant=deepMerge(participant,incomingIdMap[participant.participantId],arraysToMerge);return modifiedParticipants.push(mergedParticipant),mergedParticipant}return participant}));const existingParticipantIds=tournamentRecord.participants.map(getParticipantId),newParticipants=incomingParticipants.filter((({participantId})=>!existingParticipantIds.includes(participantId))),{topics}=getTopics();return newParticipants.length&&(tournamentRecord.participants=tournamentRecord.participants.concat(...newParticipants),topics.includes(ADD_PARTICIPANTS)&&addNotice({topic:ADD_PARTICIPANTS,payload:{participants:newParticipants}})),modifiedParticipants.length&&topics.includes(MODIFY_PARTICIPANTS)&&addNotice({topic:MODIFY_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:modifiedParticipants}}),newParticipants.length||modifiedParticipants.length?((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1k.call(b,prop)&&__defNormalProp$1k(a,prop,b[prop]);if(__getOwnPropSymbols$1k)for(var prop of __getOwnPropSymbols$1k(b))__propIsEnum$1k.call(b,prop)&&__defNormalProp$1k(a,prop,b[prop]);return a})({},SUCCESS):void 0},getPairedParticipant,filterParticipants,setParticipantScaleItem,setParticipantScaleItems:function setParticipantScaleItems({scaleItemsWithParticipantIds=[],removePriorValues,tournamentRecord,auditData,context}){var _b;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!tournamentRecord.participants)return{error:MISSING_PARTICIPANTS};let modificationsApplied=0;const participantScaleItemsMap={},modifiedParticipants=[];for(const item of scaleItemsWithParticipantIds){const participantId=null==item?void 0:item.participantId;Array.isArray(null==item?void 0:item.scaleItems)&&item.scaleItems.forEach((scaleItem=>{if(!isValidScaleItem({scaleItem}))return{error:INVALID_SCALE_ITEM};Array.isArray(participantScaleItemsMap[participantId])||(participantScaleItemsMap[participantId]=[]),participantScaleItemsMap[participantId].push(scaleItem)}))}tournamentRecord.participants.forEach((participant=>{const{participantId}=participant||{};Array.isArray(participantScaleItemsMap[participantId])&&participantScaleItemsMap[participantId].forEach((scaleItem=>{addParticipantScaleItem({participant,scaleItem,removePriorValues}),modifiedParticipants.push(participant),modificationsApplied++}))}));const info=modificationsApplied?void 0:NO_MODIFICATIONS_APPLIED,{topics}=getTopics();if(topics.includes(MODIFY_PARTICIPANTS)&&modificationsApplied&&addNotice({topic:MODIFY_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:modifiedParticipants}}),context){const _a=context,{eventId,drawId}=_a,itemValue=((source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$1h.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols$1h)for(var prop of __getOwnPropSymbols$1h(source))exclude.indexOf(prop)<0&&__propIsEnum$1h.call(source,prop)&&(target[prop]=source[prop]);return target})(_a,["eventId","drawId"]),itemSubTypes=(null==(_b=itemValue.scaleAttributes)?void 0:_b.scaleType)&&[itemValue.scaleAttributes.scaleType];if(Object.keys(itemValue).length){const timeItem={itemType:"addScaleItems",itemValue};if(itemSubTypes&&(timeItem.itemSubTypes=itemSubTypes),drawId||eventId){const{drawDefinition,event}=findEvent({tournamentRecord,eventId,drawId});drawId&&addDrawDefinitionTimeItem({drawDefinition,timeItem}),eventId&&addEventTimeItem({event,timeItem})}else addTournamentTimeItem({tournamentRecord,timeItem})}}return auditData&&topics.includes(AUDIT)&&addNotice({topic:AUDIT,payload:auditData}),definedAttributes(__spreadProps$H(__spreadValues$1h({},SUCCESS),{modificationsApplied,info}))},modifyParticipantsSignInStatus:function modifyParticipantsSignInStatus({tournamentRecord,participantIds,signInState}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(participantIds))return{error:MISSING_VALUE};if(![SIGNED_IN,SIGNED_OUT].includes(signInState))return{error:INVALID_VALUES,signInState};const participants=tournamentRecord.participants||[];if(!participants.length)return{error:MISSING_PARTICIPANTS};const modifiedParticipants=[],createdAt=(new Date).toISOString();for(const participant of participants){const{participantId}=participant;if(participantIds.includes(participantId)){const result=addParticipantTimeItem({tournamentRecord,duplicateValues:!1,participantId,timeItem:{itemType:SIGN_IN_STATUS,itemValue:signInState,createdAt}});if(result.error)return result;modifiedParticipants.push(participant)}}const{topics}=getTopics();return modifiedParticipants.length&&topics.includes(MODIFY_PARTICIPANTS)&&addNotice({topic:MODIFY_PARTICIPANTS,payload:{tournamentId:tournamentRecord.tournamentId,participants:modifiedParticipants}}),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1q.call(b,prop)&&__defNormalProp$1q(a,prop,b[prop]);if(__getOwnPropSymbols$1q)for(var prop of __getOwnPropSymbols$1q(b))__propIsEnum$1q.call(b,prop)&&__defNormalProp$1q(a,prop,b[prop]);return a})({},SUCCESS)},getParticipantEventDetails:function getParticipantEventDetails({tournamentRecord,participantId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participantId)return{error:MISSING_PARTICIPANT_ID};const relevantParticipantIds=[participantId].concat((tournamentRecord.participants||[]).filter((participant=>{var _a;return[TEAM,PAIR].includes(participant.participantType)&&(null==(_a=participant.individualParticipantIds)?void 0:_a.includes(participantId))})).map((participant=>participant.participantId)));return{eventDetails:(tournamentRecord.events||[]).filter((event=>overlap(((null==event?void 0:event.entries)||[]).map((entry=>entry.participantId)),relevantParticipantIds))).map((event=>({eventName:event.eventName,eventId:event.eventId})))}},getEligibleVoluntaryConsolationParticipants:function getEligibleVoluntaryConsolationParticipants(params){return params.tournamentRecord?getEligibleVoluntaryConsolationParticipants$1(params):{error:MISSING_TOURNAMENT_RECORD}},findParticipant:function publicFindParticipant$1({tournamentRecord,policyDefinitions,convertExtensions,participantId,inContext,personId}){return tournamentRecord?"string"!=typeof participantId&&"string"!=typeof personId?{error:MISSING_VALUE}:{participant:makeDeepCopy(findParticipant({tournamentParticipants:tournamentRecord.participants||[],policyDefinitions,participantId,personId,inContext}),convertExtensions,!0)}:{error:MISSING_TOURNAMENT_RECORD}},getTournamentParticipants,getParticipantSchedules:function getParticipantSchedules({participantFilters={},tournamentRecord}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if("object"!=typeof participantFilters)return{error:INVALID_OBJECT,context:{participantFilters}};const matchUps=allTournamentMatchUps({tournamentRecord,contextFilters:{eventIds:participantFilters.eventIds}}).matchUps,matchUpsMap=Object.assign({},...matchUps.map((matchUp=>({[matchUp.matchUpId]:matchUp})))),scheduledMatchUps=matchUps.filter((({schedule})=>schedule&&Object.keys(schedule).length)),{sourceMatchUpIds}=getMatchUpDependencies({tournamentRecord,matchUps}),participantAggregator={};for(const matchUp of scheduledMatchUps){const{sides}=matchUp;let relevantSourceMatchUps;const participants=(null==sides?void 0:sides.map((({participant})=>{if(participant)return[participant].concat(...participant.individualParticipants||[]);sourceMatchUpIds[matchUp.matchUpId]&&!relevantSourceMatchUps&&(relevantSourceMatchUps=(sourceMatchUpIds[matchUp.matchUpId]||[]).map((matchUpId=>matchUpsMap[matchUpId])).filter((({winningSide,bye})=>!winningSide&&!bye)))})).filter(Boolean).flat())||[];for(const participant of participants){const{participantId}=participant;participantAggregator[participantId]||(participantAggregator[participantId]={potentialMatchUps:[],participant,matchUps:[]}),participantAggregator[participantId].matchUps.push(matchUp)}const potentialParticipants=(null==relevantSourceMatchUps?void 0:relevantSourceMatchUps.map((({sides:sides2})=>sides2)).flat().map((({participant})=>participant&&[participant].concat(...participant.individualParticipants||[]))).filter(Boolean).flat())||[];for(const participant of potentialParticipants){const{participantId}=participant;participantAggregator[participantId]||(participantAggregator[participantId]={potentialMatchUps:[],participant,matchUps:[]}),participantAggregator[participantId].potentialMatchUps.push(matchUp)}}return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1w.call(b,prop)&&__defNormalProp$1w(a,prop,b[prop]);if(__getOwnPropSymbols$1w)for(var prop of __getOwnPropSymbols$1w(b))__propIsEnum$1w.call(b,prop)&&__defNormalProp$1w(a,prop,b[prop]);return a})({participantSchedules:Object.values(participantAggregator).filter((({participant})=>!(participantFilters.participantIds&&!participantFilters.participantIds.includes(participant.participantId)||participantFilters.participantTypes&&!participantFilters.participantTypes.includes(participant.participantType))))},SUCCESS)},getTournamentPersons:function getTournamentPersons({tournamentRecord,participantFilters}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};let tournamentParticipants=tournamentRecord.participants||[];participantFilters&&(tournamentParticipants=filterParticipants({participants:tournamentParticipants,participantFilters,tournamentRecord}));const tournamentPersons={},extractPerson=participant=>{if(participant.person){const{personId}=participant.person;tournamentPersons[personId]?tournamentPersons[personId].participantIds.push(participant.participantId):tournamentPersons[personId]=(a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1m.call(b,prop)&&__defNormalProp$1m(a,prop,b[prop]);if(__getOwnPropSymbols$1m)for(var prop of __getOwnPropSymbols$1m(b))__propIsEnum$1m.call(b,prop)&&__defNormalProp$1m(a,prop,b[prop]);return a})({},participant.person),b={participantIds:[participant.participantId]},__defProps$J(a,__getOwnPropDescs$J(b)))}var a,b};return tournamentParticipants.forEach((participant=>{participant.person&&extractPerson(participant),participant.individualParticipants&&participant.individualParticipants.forEach(extractPerson)})),{tournamentPersons:Object.values(tournamentPersons)}},getParticipants:getParticipants$1};var __defProp$1g=Object.defineProperty,__getOwnPropSymbols$1g=Object.getOwnPropertySymbols,__hasOwnProp$1g=Object.prototype.hasOwnProperty,__propIsEnum$1g=Object.prototype.propertyIsEnumerable,__defNormalProp$1g=(obj,key,value)=>key in obj?__defProp$1g(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1g=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1g.call(b,prop)&&__defNormalProp$1g(a,prop,b[prop]);if(__getOwnPropSymbols$1g)for(var prop of __getOwnPropSymbols$1g(b))__propIsEnum$1g.call(b,prop)&&__defNormalProp$1g(a,prop,b[prop]);return a};var __defProp$1f=Object.defineProperty,__defProps$G=Object.defineProperties,__getOwnPropDescs$G=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1f=Object.getOwnPropertySymbols,__hasOwnProp$1f=Object.prototype.hasOwnProperty,__propIsEnum$1f=Object.prototype.propertyIsEnumerable,__defNormalProp$1f=(obj,key,value)=>key in obj?__defProp$1f(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1f=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1f.call(b,prop)&&__defNormalProp$1f(a,prop,b[prop]);if(__getOwnPropSymbols$1f)for(var prop of __getOwnPropSymbols$1f(b))__propIsEnum$1f.call(b,prop)&&__defNormalProp$1f(a,prop,b[prop]);return a},__spreadProps$G=(a,b)=>__defProps$G(a,__getOwnPropDescs$G(b));function publishEvent({policyDefinitions,removePriorValues,tournamentRecord,status=PUBLIC,event,drawIdsToRemove,drawIdsToAdd,drawIds,includePositionAssignments,structureIdsToRemove,structureIdsToAdd,structureIds}){var _a,_b,_c,_d,_e,_f,_g;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};if(!policyDefinitions){const{appliedPolicies}=getAppliedPolicies({tournamentRecord,event});policyDefinitions=appliedPolicies}const itemType=`${PUBLISH}.${STATUS$1}`,eventDrawIds=(null==(_a=event.drawDefinitions)?void 0:_a.map((({drawId})=>drawId)))||[],{timeItem}=getEventTimeItem({itemType,event});drawIds||drawIdsToAdd||drawIdsToRemove?drawIds||!(null==drawIdsToAdd?void 0:drawIdsToAdd.length)&&!(null==drawIdsToRemove?void 0:drawIdsToRemove.length)||(drawIds=(null==(_c=null==(_b=null==timeItem?void 0:timeItem.itemValue)?void 0:_b.PUBLIC)?void 0:_c.drawIds)||[]):drawIds=eventDrawIds,drawIds=(drawIds||[]).filter((drawId=>!(null==drawIdsToRemove?void 0:drawIdsToRemove.length)||!drawIdsToRemove.includes(drawId))),(null==drawIdsToAdd?void 0:drawIdsToAdd.length)&&(drawIds=unique(drawIds.concat(...drawIdsToAdd.filter((drawId=>eventDrawIds.includes(drawId)))))),structureIds||!(null==structureIdsToAdd?void 0:structureIdsToAdd.length)&&!(null==structureIdsToRemove?void 0:structureIdsToRemove.length)||(structureIds=(null==(_e=null==(_d=null==timeItem?void 0:timeItem.itemValue)?void 0:_d.PUBLIC)?void 0:_e.drawIds)||[]),structureIds=(structureIds||[]).filter((structureId=>!(null==structureIdsToRemove?void 0:structureIdsToRemove.length)||!structureIdsToRemove.includes(structureId))),(null==structureIdsToAdd?void 0:structureIdsToAdd.length)&&(structureIds=unique(structureIds.push(...structureIdsToAdd)));addEventTimeItem({event,timeItem:{itemValue:{[status]:{drawIds,structureIds}},itemType},removePriorValues});const{eventData}=getEventData({includePositionAssignments,usePublishState:!0,policyDefinitions,tournamentRecord,event}),publishState=null==(_g=null==(_f=null==eventData?void 0:eventData.eventInfo)?void 0:_f.publish)?void 0:_g.state;return eventData.drawsData=eventData.drawsData.filter((({drawId})=>{var _a2;return null==(_a2=null==publishState?void 0:publishState.PUBLIC)?void 0:_a2.drawIds.includes(drawId)})),addNotice({payload:{eventData,tournamentId:tournamentRecord.tournamentId},topic:PUBLISH_EVENT}),__spreadProps$G(__spreadValues$1f({},SUCCESS),{eventData})}const publishingGovernor={getTournamentInfo,getVenueData,getCourtInfo,getAllEventData:function getAllEventData({tournamentRecord,policyDefinitions}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const events=tournamentRecord.events||[],tournamentParticipants=(null==tournamentRecord?void 0:tournamentRecord.participants)||[],{tournamentInfo}=getTournamentInfo({tournamentRecord}),{venues:venuesData}=getVenuesAndCourts$1({tournamentRecord}),eventsData=events.map((event=>{const{eventId}=event,eventInfo=(({eventId:eventId2,eventName,eventType,eventLevel,surfaceCategory,matchUpFormat,category,gender,startDate,endDate,ballType,discipline})=>({eventId:eventId2,eventName,eventType,eventLevel,surfaceCategory,matchUpFormat,category,gender,startDate,endDate,ballType,discipline}))(event),scheduleTiming=getScheduleTiming({tournamentRecord,event}).scheduleTiming,drawsData=(event.drawDefinitions||[]).map((drawDefinition=>{const drawInfo=(({drawId,drawName,matchUpFormat,updatedAt})=>({drawId,drawName,matchUpFormat,updatedAt}))(drawDefinition),{pendingMatchUps,completedMatchUps,upcomingMatchUps,abandonedMatchUps}=getDrawMatchUps({includeByeMatchUps:!1,requireParticipants:!0,tournamentParticipants,context:{eventId},policyDefinitions,tournamentRecord,inContext:!0,drawDefinition,scheduleTiming,event});return{drawInfo,matchUps:{abandonedMatchUps,completedMatchUps,upcomingMatchUps,pendingMatchUps}}})),{timeItem}=getEventTimeItem({itemType:`${PUBLISH}.${STATUS$1}`,event});return Object.assign(eventInfo,{publish:null==timeItem?void 0:timeItem.itemValue,drawsData}),eventInfo}));return{allEventData:{tournamentInfo,venuesData,eventsData}}},getEventData,getDrawData,unPublishEventSeeding:function unPublishEventSeeding({removePriorValues=!0,seedingScaleNames,tournamentRecord,status=PUBLIC,stages,event}){var _a,_b;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};const itemType=`${PUBLISH}.${STATUS$1}`,{timeItem}=getEventTimeItem({itemType,event}),itemValue=(null==timeItem?void 0:timeItem.itemValue)||{[status]:{}};if(itemValue[status]){if(Array.isArray(stages)&&(null==(_a=itemValue[status].seeding)?void 0:_a.stageSeedingScaleNames))for(const stage of stages)itemValue[status].seeding.stageSeedingScaleNames[stage]&&delete itemValue[status].seeding.stageSeedingScaleNames[stage];Array.isArray(seedingScaleNames)&&(null==(_b=itemValue[status].seeding)?void 0:_b.seedingScaleNames)&&(itemValue[status].seeding.seedingScaleNames=itemValue[status].seeding.seedingScaleNames.filter((scaleName=>!seedingScaleNames.includes(scaleName)))),stages||seedingScaleNames||delete itemValue[status].seeding}return addEventTimeItem({event,timeItem:{itemValue,itemType},removePriorValues}),addNotice({topic:"unPublishEventSeeding",payload:{tournamentId:tournamentRecord.tournamentId,eventId:event.eventId}}),__spreadValues$1g({},SUCCESS)},publishEventSeeding:function publishEventSeeding({removePriorValues=!0,stageSeedingScaleNames,seedingScaleNames,tournamentRecord,status=PUBLIC,drawIds=[],event}){var _a,_b,_c,_d;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};const itemType=`${PUBLISH}.${STATUS$1}`,{timeItem}=getEventTimeItem({itemType,event}),itemValue=(null==timeItem?void 0:timeItem.itemValue)||{[status]:{}},updatedSeedingScaleNames=((null==(_a=itemValue[status].seeding)?void 0:_a.seedingScaleNames)||seedingScaleNames)&&__spreadValues$1g(__spreadValues$1g({},null==(_b=itemValue[status].seeding)?void 0:_b.seedingScaleNames),seedingScaleNames),updatedStageSeedingScaleNames=((null==(_c=itemValue[status].seeding)?void 0:_c.stageSeedingScaleNames)||stageSeedingScaleNames)&&__spreadValues$1g(__spreadValues$1g({},null==(_d=itemValue[status].seeding)?void 0:_d.stageSeedingScaleNames),stageSeedingScaleNames);return itemValue[status].seeding=definedAttributes({stageSeedingScaleNames:updatedStageSeedingScaleNames,seedingScaleNames:updatedSeedingScaleNames,published:!0,drawIds}),addEventTimeItem({event,timeItem:{itemValue,itemType},removePriorValues}),addNotice({topic:"publishEventSeeding",payload:{tournamentId:tournamentRecord.tournamentId,eventId:event.eventId,drawIds}}),__spreadValues$1g({},SUCCESS)},unPublishEvent:function unPublishEvent({removePriorValues=!0,tournamentRecord,status=PUBLIC,event}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};const itemType=`${PUBLISH}.${STATUS$1}`,{timeItem}=getEventTimeItem({itemType,event}),itemValue=(null==timeItem?void 0:timeItem.itemValue)||{[status]:{}};return delete itemValue[status].drawIds,delete itemValue[status].structureIds,addEventTimeItem({event,timeItem:{itemValue,itemType},removePriorValues}),addNotice({topic:"unPublishEvent",payload:{tournamentId:tournamentRecord.tournamentId,eventId:event.eventId}}),Object.assign({eventId:event.eventId},SUCCESS)},publishEvent,unPublishOrderOfPlay:unPublishOrderOfPlay$1,publishOrderOfPlay:publishOrderOfPlay$1};var __defProp$1e=Object.defineProperty,__defProps$F=Object.defineProperties,__getOwnPropDescs$F=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1e=Object.getOwnPropertySymbols,__hasOwnProp$1e=Object.prototype.hasOwnProperty,__propIsEnum$1e=Object.prototype.propertyIsEnumerable,__defNormalProp$1e=(obj,key,value)=>key in obj?__defProp$1e(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function deriveDraws(stages){const drawDefinitions=[];for(const legacyStage of stages||[]){const{stageType}=legacyStage,stage=["M",MAIN].includes(stageType)&&MAIN||["Q",QUALIFYING].includes(stageType)&&QUALIFYING||["C",CONSOLATION].includes(stageType)&&CONSOLATION||["P",PLAY_OFF].includes(stageType)&&PLAY_OFF||void 0;for(const draw of legacyStage.draws||[]){const{drawId,drawSize,matchUps}=draw,drawDefinition={stage,drawId,drawSize};drawDefinitions.push(drawDefinition),console.log(matchUps.map((({roundNumber,roundPosition})=>({roundNumber,roundPosition}))),{draw,drawDefinition})}}return drawDefinitions}const tournamentConstants={ABANDONDED:"ABANDONDED",ACTIVE:"ACTIVE",CANCELLED:"CANCELLED",COMPLETED:"COMPLETED",IN_PROGRESS:"IN_PROGRESS"};var __defProp$1d=Object.defineProperty,__getOwnPropSymbols$1d=Object.getOwnPropertySymbols,__hasOwnProp$1d=Object.prototype.hasOwnProperty,__propIsEnum$1d=Object.prototype.propertyIsEnumerable,__defNormalProp$1d=(obj,key,value)=>key in obj?__defProp$1d(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$1c=Object.defineProperty,__defProps$E=Object.defineProperties,__getOwnPropDescs$E=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1c=Object.getOwnPropertySymbols,__hasOwnProp$1c=Object.prototype.hasOwnProperty,__propIsEnum$1c=Object.prototype.propertyIsEnumerable,__defNormalProp$1c=(obj,key,value)=>key in obj?__defProp$1c(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1c=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1c.call(b,prop)&&__defNormalProp$1c(a,prop,b[prop]);if(__getOwnPropSymbols$1c)for(var prop of __getOwnPropSymbols$1c(b))__propIsEnum$1c.call(b,prop)&&__defNormalProp$1c(a,prop,b[prop]);return a},__spreadProps$E=(a,b)=>__defProps$E(a,__getOwnPropDescs$E(b));function analyzeDraws({tournamentRecord}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const drawsAnalysis={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}};return(null==(_a=tournamentRecord.events)?void 0:_a.map((event=>null==event?void 0:event.drawDefinitions)).flat().filter(Boolean)).forEach((drawDefinition=>{let positionsAssignedCount=0,matchUpsWithWinningSideCount=0,matchUpsNoOutcomeCount=0;const{allStructuresLinked}=getStructureGroups({drawDefinition}),structuresData=((null==drawDefinition?void 0:drawDefinition.structures)||[]).map((structure=>{const{stage,stageSequence,structureId}=structure,orderNumber=stageOrder$1[stage],{inContextStructureMatchUps}=getStructureDrawPositionProfiles({drawDefinition,structure}),matchUpsWithWinningSide=null==inContextStructureMatchUps?void 0:inContextStructureMatchUps.filter((({winningSide})=>winningSide)),winningSideCount=matchUpsWithWinningSide.filter(Boolean).length||0;matchUpsWithWinningSideCount+=winningSideCount,matchUpsNoOutcomeCount+=inContextStructureMatchUps.length-matchUpsWithWinningSideCount;const maxWinningSideFirstRoundPosition=Math.max(matchUpsWithWinningSide.filter((({roundNumber})=>1===roundNumber)).map((({roundPosition})=>roundPosition))),{positionAssignments}=getPositionAssignments$1({structure}),positionsAssigned=null==positionAssignments?void 0:positionAssignments.filter((({participantId})=>participantId));positionsAssignedCount+=positionsAssigned.length;const unassignedPositionsCount=((null==positionAssignments?void 0:positionAssignments.length)||0)-((null==positionsAssigned?void 0:positionsAssigned.length)||0),{roundMatchUps,roundProfile,roundNumbers,maxMatchUpsCount}=getRoundMatchUps$1({matchUps:inContextStructureMatchUps}),activeRounds=Object.keys(roundProfile).filter((roundNumber=>!roundProfile[roundNumber].inactiveRound)).map((roundNumber=>parseInt(roundNumber))),inactiveRounds=Object.keys(roundProfile).filter((roundNumber=>roundProfile[roundNumber].inactiveRound)).map((roundNumber=>parseInt(roundNumber))),inactiveStructure=Object.values(roundProfile).every((profile=>profile.inactiveRound));return{positionsAssignedCount:(null==positionsAssigned?void 0:positionsAssigned.length)||0,maxWinningSideFirstRoundPosition,unassignedPositionsCount,inactiveStructure,maxMatchUpsCount,inactiveRounds,roundMatchUps,activeRounds,roundNumbers,roundProfile,structureId,stageSequence,orderNumber,stage}})),mainStructure=structuresData.find((data=>2===data.orderNumber&&1===data.stageSequence)),activeStructuresCount=structuresData.filter((({inactiveStructure})=>!inactiveStructure)).length,{links}=getStructureLinks({drawDefinition,structureId:mainStructure.structureId}),isMatchPlay=1===parseInt(mainStructure.activeRounds[0])&&1===mainStructure.activeRounds.length&&1===activeStructuresCount,inactiveDraw=null==structuresData?void 0:structuresData.every((({inactiveStructure})=>inactiveStructure)),canBePruned=!links.length&&mainStructure.activeRounds.length&&(mainStructure.roundProfile[1].inactiveCount||mainStructure.inactiveRounds.length),drawId=drawDefinition.drawId;positionsAssignedCount&&!matchUpsWithWinningSideCount&&drawsAnalysis.positionsNoOutcomes.push(drawId),inactiveDraw&&drawsAnalysis.inactive.push(drawId),isMatchPlay&&drawsAnalysis.matchPlay.push(drawId),canBePruned&&drawsAnalysis.canBePruned.push(drawId);const drawAnalysis={matchUpsWithWinningSideCount,matchUpsNoOutcomeCount,positionsAssignedCount,allStructuresLinked,structuresData,inactiveDraw,isMatchPlay,drawId};drawsAnalysis.drawAnalysis[drawId]=drawAnalysis})),__spreadProps$E(__spreadValues$1c({},SUCCESS),{drawsAnalysis})}function checkIsDual(tournamentRecord){var _a,_b,_c,_d,_e;const teamParticipants=null==(_a=tournamentRecord.participants)?void 0:_a.filter((({participantType})=>participantType===TEAM)),twoTeams=2===(null==teamParticipants?void 0:teamParticipants.length),event=1===(null==(_b=tournamentRecord.events)?void 0:_b.length)&&tournamentRecord.events[0],drawDefinition=1===(null==(_c=null==event?void 0:event.drawDefinitions)?void 0:_c.length)&&event.drawDefinitions[0],structure=1===(null==(_d=null==drawDefinition?void 0:drawDefinition.structures)?void 0:_d.length)&&drawDefinition.structures[0],twoDrawPositions=2===(null==(_e=null==structure?void 0:structure.positionAssignments)?void 0:_e.length);return!!(event.tieFormat&&twoTeams&&twoDrawPositions)}var __defProp$1b=Object.defineProperty,__defProps$D=Object.defineProperties,__getOwnPropDescs$D=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1b=Object.getOwnPropertySymbols,__hasOwnProp$1b=Object.prototype.hasOwnProperty,__propIsEnum$1b=Object.prototype.propertyIsEnumerable,__defNormalProp$1b=(obj,key,value)=>key in obj?__defProp$1b(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$1a=Object.defineProperty,__getOwnPropSymbols$1a=Object.getOwnPropertySymbols,__hasOwnProp$1a=Object.prototype.hasOwnProperty,__propIsEnum$1a=Object.prototype.propertyIsEnumerable,__defNormalProp$1a=(obj,key,value)=>key in obj?__defProp$1a(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1a=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1a.call(b,prop)&&__defNormalProp$1a(a,prop,b[prop]);if(__getOwnPropSymbols$1a)for(var prop of __getOwnPropSymbols$1a(b))__propIsEnum$1a.call(b,prop)&&__defNormalProp$1a(a,prop,b[prop]);return a};var __defProp$19=Object.defineProperty,__getOwnPropSymbols$19=Object.getOwnPropertySymbols,__hasOwnProp$19=Object.prototype.hasOwnProperty,__propIsEnum$19=Object.prototype.propertyIsEnumerable,__defNormalProp$19=(obj,key,value)=>key in obj?__defProp$19(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$19=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$19.call(b,prop)&&__defNormalProp$19(a,prop,b[prop]);if(__getOwnPropSymbols$19)for(var prop of __getOwnPropSymbols$19(b))__propIsEnum$19.call(b,prop)&&__defNormalProp$19(a,prop,b[prop]);return a};var __defProp$18=Object.defineProperty,__defProps$C=Object.defineProperties,__getOwnPropDescs$C=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$18=Object.getOwnPropertySymbols,__hasOwnProp$18=Object.prototype.hasOwnProperty,__propIsEnum$18=Object.prototype.propertyIsEnumerable,__defNormalProp$18=(obj,key,value)=>key in obj?__defProp$18(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$18=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$18.call(b,prop)&&__defNormalProp$18(a,prop,b[prop]);if(__getOwnPropSymbols$18)for(var prop of __getOwnPropSymbols$18(b))__propIsEnum$18.call(b,prop)&&__defNormalProp$18(a,prop,b[prop]);return a},__spreadProps$C=(a,b)=>__defProps$C(a,__getOwnPropDescs$C(b));function setTournamentDates({tournamentRecord,startDate,endDate}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(startDate&&!dateValidation.test(startDate)||endDate&&!dateValidation.test(endDate))return{error:INVALID_DATE};if(!startDate&&!endDate)return{error:MISSING_DATE};if(endDate&&startDate&&new Date(endDate)<new Date(startDate))return{error:INVALID_VALUES};let checkScheduling;(startDate&&tournamentRecord.startDate&&new Date(startDate)>new Date(tournamentRecord.startDate)||endDate&&tournamentRecord.endDate&&new Date(endDate)<new Date(tournamentRecord.endDate))&&(checkScheduling=!0),startDate&&(tournamentRecord.startDate=startDate),endDate&&(tournamentRecord.endDate=endDate),startDate&&tournamentRecord.endDate&&new Date(startDate)>new Date(tournamentRecord.endDate)&&(tournamentRecord.endDate=startDate),endDate&&tournamentRecord.startDate&&new Date(endDate)<new Date(tournamentRecord.startDate)&&(tournamentRecord.startDate=endDate);const unscheduledMatchUpIds=checkScheduling&&(null==(_a=function removeInvalidScheduling({tournamentRecord}){const{matchUps}=allTournamentMatchUps({tournamentRecord}),startDate=tournamentRecord.startDate&&new Date(tournamentRecord.startDate),endDate=tournamentRecord.endDate&&new Date(tournamentRecord.endDate),invalidScheduledDates=[],invalidSchedulingMatchUpIds=[];for(const matchUp of matchUps){const{schedule,matchUpId}=matchUp;if(schedule&&schedule.scheduledDate){const scheduledDate=new Date(schedule.scheduledDate);(startDate&&scheduledDate<startDate||endDate&&scheduledDate>endDate)&&(invalidSchedulingMatchUpIds.push(matchUpId),invalidScheduledDates.includes(schedule.scheduledDate)||invalidScheduledDates.push(schedule.scheduledDate))}}if(invalidScheduledDates.length){if(!clearScheduledMatchUps$1({scheduledDates:invalidScheduledDates,tournamentRecord}).clearedScheduleCount)return{error:SCHEDULE_NOT_CLEARED}}return{unscheduledMatchUpIds:invalidSchedulingMatchUpIds}}({tournamentRecord}))?void 0:_a.unscheduledMatchUpIds);return function updateCourtAvailability({tournamentRecord}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{startDate,endDate}=tournamentRecord,tournamentDates=dateRange(startDate,endDate),courts=[];for(const venue of tournamentRecord.venues||[])(null==(_a=null==venue?void 0:venue.courts)?void 0:_a.length)&&courts.push(...venue.courts);for(const court of courts){const{startTime,endTime}=(court.dateAvailability||[]).reduce(((extents,availability)=>{const startMinutes=timeStringMinutes(extents.startTime),endMinutes=timeStringMinutes(extents.endTime);return availability.startTime&&timeStringMinutes(availability.startTime)<startMinutes&&(extents.startTime=availability.startTime),availability.endTime&&timeStringMinutes(availability.endTime)>endMinutes&&(extents.endTime=availability.endTime),extents}),{startTime:"08:00",endTime:"18:00"}),updatedDateAvailability=tournamentDates.map((date=>court.dateAvailability.find((availability=>availability.date===date))||{date,startTime,endTime}));court.dateAvailability=updatedDateAvailability}return __spreadValues$19({},SUCCESS)}({tournamentRecord}),addNotice({topic:MODIFY_TOURNAMENT_DETAIL,payload:{startDate,endDate}}),__spreadProps$C(__spreadValues$18({},SUCCESS),{unscheduledMatchUpIds})}const tournamentGovernor={addNotes,removeNotes:function removeNotes({element}={}){return"object"!=typeof element?{error:INVALID_VALUES}:(element.notes&&delete element.notes,__spreadValues$4v({},SUCCESS))},analyzeDraws,analyzeTournament:function analyzeTournament({tournamentRecord}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{drawsAnalysis}=analyzeDraws({tournamentRecord}),analysis={isDual:checkIsDual(tournamentRecord),drawsAnalysis};return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1b.call(b,prop)&&__defNormalProp$1b(a,prop,b[prop]);if(__getOwnPropSymbols$1b)for(var prop of __getOwnPropSymbols$1b(b))__propIsEnum$1b.call(b,prop)&&__defNormalProp$1b(a,prop,b[prop]);return a})({},SUCCESS),__defProps$D(a,__getOwnPropDescs$D({analysis}));var a},getRounds,getProfileRounds,setTournamentName:function setTournamentName({tournamentRecord,promotionalName,tournamentName,formalName}){return tournamentRecord?(tournamentName&&(tournamentRecord.tournamentName=tournamentName),promotionalName&&(tournamentRecord.promotionalName=promotionalName),formalName&&(tournamentRecord.formalName=formalName),tournamentRecord.promotionalName===tournamentRecord.tournamentName&&delete tournamentRecord.promotionalName,tournamentRecord.formalName===tournamentRecord.tournamentName&&delete tournamentRecord.formalName,__spreadValues$1a({},SUCCESS)):{error:MISSING_TOURNAMENT_RECORD}},setTournamentNotes:function setTournamentNotes({tournamentRecord,notes}){return tournamentRecord?addNotes({element:tournamentRecord,notes}):{error:MISSING_TOURNAMENT_RECORD}},setTournamentDates,setTournamentEndDate:function setTournamentEndDate({tournamentRecord,endDate}){return setTournamentDates({tournamentRecord,endDate})},setTournamentStartDate:function setTournamentStartDate({tournamentRecord,startDate}){return setTournamentDates({tournamentRecord,startDate})},setTournamentCategories:function setTournamentCategories({tournamentRecord,categories}){return tournamentRecord?(categories=(categories||[]).filter((category=>category.categoryName&&category.type)),tournamentRecord.tournamentCategories=categories,__spreadValues$1a({},SUCCESS)):{error:MISSING_TOURNAMENT_RECORD}},addTimeItem,addEventTimeItem,addTournamentTimeItem,addParticipantTimeItem,addExtension:addExtension$1,addEventExtension:addEventExtension$1,removeEventExtension,addTournamentExtension,removeTournamentExtension,addParticipantExtension:function addParticipantExtension({creationTime=!0,tournamentRecord,participantId,extension}={}){if(!participantId)return{error:MISSING_PARTICIPANT_ID};const participant=findParticipant({tournamentParticipants:(null==tournamentRecord?void 0:tournamentRecord.participants)||[],participantId});return participant?addExtension$1({element:participant,extension,creationTime}):{error:PARTICIPANT_NOT_FOUND}},removeParticipantExtension:function removeParticipantExtension({tournamentRecord,participantId,name}={}){if(!participantId)return{error:MISSING_PARTICIPANT_ID};const participant=findParticipant({tournamentParticipants:(null==tournamentRecord?void 0:tournamentRecord.participants)||[],participantId});return participant?removeExtension$1({element:participant,name}):{error:PARTICIPANT_NOT_FOUND}},addDrawDefinitionExtension,removeDrawDefinitionExtension:function removeDrawDefinitionExtension({drawDefinition,name}={}){return drawDefinition?removeExtension$1({element:drawDefinition,name}):{error:DRAW_DEFINITION_NOT_FOUND}},setTournamentStatus:function setTournamentStatus({tournamentRecord,status}){return tournamentRecord?status&&!Object.keys(tournamentConstants).includes(status)?{error:INVALID_VALUES,info:"Unknown status"}:(tournamentRecord.tournamentStatus=status,((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1d.call(b,prop)&&__defNormalProp$1d(a,prop,b[prop]);if(__getOwnPropSymbols$1d)for(var prop of __getOwnPropSymbols$1d(b))__propIsEnum$1d.call(b,prop)&&__defNormalProp$1d(a,prop,b[prop]);return a})({},SUCCESS)):{error:MISSING_TOURNAMENT_RECORD}},convertPointEight:function convertPointEight({tournament}){if(!tournament)return{error:MISSING_TOURNAMENT_RECORD};const{providerTournamentID:tournamentId,hostCountryCode,tournamentLevel,totalPrizeMoney,tournamentName,extensions,startDate,endDate}=tournament,tournamentRecord=newTournamentRecord({hostCountryCode,tournamentLevel,totalPrizeMoney,tournamentName,tournamentId,extensions,startDate,endDate});tournamentRecord.events=[];for(const legacyEvent of tournament.events||[]){const{extensions:extensions2,ageCategory,discipline,eventType,eventId,gender,stages}=legacyEvent,event={drawDefinitions:deriveDraws(stages),category:{ageCategory},gender:["M",MALE].includes(gender)&&MALE||["F",FEMALE].includes(gender)&&FEMALE||void 0,eventType:["D",DOUBLES].includes(eventType)&&DOUBLES||["T",TEAM$1].includes(eventType)?TEAM$1:SINGLES,extensions:extensions2,discipline,eventId};tournamentRecord.events.push(event)}return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1e.call(b,prop)&&__defNormalProp$1e(a,prop,b[prop]);if(__getOwnPropSymbols$1e)for(var prop of __getOwnPropSymbols$1e(b))__propIsEnum$1e.call(b,prop)&&__defNormalProp$1e(a,prop,b[prop]);return a})({},SUCCESS),__defProps$F(a,__getOwnPropDescs$F({tournamentRecord}));var a}};var __defProp$17=Object.defineProperty,__getOwnPropSymbols$17=Object.getOwnPropertySymbols,__hasOwnProp$17=Object.prototype.hasOwnProperty,__propIsEnum$17=Object.prototype.propertyIsEnumerable,__defNormalProp$17=(obj,key,value)=>key in obj?__defProp$17(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const scheduleGovernor={allocateTeamMatchUpCourts:allocateTeamMatchUpCourts$1,addMatchUpCourtOrder:addMatchUpCourtOrder$2,assignMatchUpCourt:assignMatchUpCourt$1,assignMatchUpVenue:assignMatchUpVenue$1,clearMatchUpSchedule:function clearMatchUpSchedule({scheduleAttributes=[ALLOCATE_COURTS,ASSIGN_COURT,ASSIGN_VENUE,SCHEDULED_DATE,SCHEDULED_TIME,START_TIME,END_TIME,RESUME_TIME,STOP_TIME],tournamentRecord,drawDefinition,matchUpId}){var _a,_b;const matchUp=drawDefinition?null==(_a=allDrawMatchUps$1({matchUpFilters:{matchUpIds:[matchUpId]},inContext:!1,drawDefinition}).matchUps)?void 0:_a[0]:null==(_b=allTournamentMatchUps({matchUpFilters:{matchUpIds:[matchUpId]},tournamentRecord,inContext:!1}).matchUps)?void 0:_b[0];if(!matchUp)return{error:MATCHUP_NOT_FOUND};const newTimeItems=(matchUp.timeItems||[]).filter((timeItem=>!scheduleAttributes.includes(null==timeItem?void 0:timeItem.itemType)));return matchUp.timeItems=newTimeItems,modifyMatchUpNotice({tournamentId:tournamentRecord.tournamentId,context:"clearMatchUpSchedule",drawDefinition,matchUp}),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$17.call(b,prop)&&__defNormalProp$17(a,prop,b[prop]);if(__getOwnPropSymbols$17)for(var prop of __getOwnPropSymbols$17(b))__propIsEnum$17.call(b,prop)&&__defNormalProp$17(a,prop,b[prop]);return a})({},SUCCESS)},addMatchUpScheduleItems:addMatchUpScheduleItems$1,addMatchUpScheduledDate:addMatchUpScheduledDate$1,addMatchUpScheduledTime:addMatchUpScheduledTime$1,addMatchUpStartTime:addMatchUpStartTime$1,addMatchUpEndTime:addMatchUpEndTime$1,addMatchUpStopTime:addMatchUpStopTime$1,addMatchUpResumeTime:addMatchUpResumeTime$1,addMatchUpOfficial:addMatchUpOfficial$1,getMatchUpFormatTiming,modifyMatchUpFormatTiming:modifyMatchUpFormatTiming$1,getModifiedMatchUpFormatTiming,getEventMatchUpFormatTiming:getEventMatchUpFormatTiming$1,modifyEventMatchUpFormatTiming:modifyEventMatchUpFormatTiming$1,removeEventMatchUpFormatTiming:removeEventMatchUpFormatTiming$1,getMatchUpFormatTimingUpdate:function getMatchUpFormatTimingUpdate({tournamentRecord}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const methods=[],{extension}=findTournamentExtension({tournamentRecord,name:SCHEDULE_TIMING});extension&&methods.push({method:"addTournamentExtension",params:{extension}});const tournamentEvents=tournamentRecord.events||[];for(const event of tournamentEvents){const{eventId}=event,{extension:extension2}=findEventExtension({event,name:SCHEDULE_TIMING});extension2&&methods.push({method:"addEventExtension",params:{eventId,extension:extension2}})}return{methods}},getMatchUpDependencies,getMatchUpDailyLimits:getMatchUpDailyLimits$1,setMatchUpDailyLimits:setMatchUpDailyLimits$1,getMatchUpDailyLimitsUpdate:function getMatchUpDailyLimitsUpdate({tournamentRecord}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const methods=[],{extension}=findTournamentExtension({name:SCHEDULE_LIMITS,tournamentRecord});extension&&methods.push({method:"addTournamentExtension",params:{extension}});const tournamentEvents=tournamentRecord.events||[];for(const event of tournamentEvents){const{eventId}=event,{extension:extension2}=findEventExtension({name:SCHEDULE_LIMITS,event});extension2&&methods.push({params:{eventId,extension:extension2},method:"addEventExtension"})}return{methods}},validateSchedulingProfile,setSchedulingProfile:function setSchedulingProfile({tournamentRecord,schedulingProfile}){return tournamentRecord?Array.isArray(schedulingProfile)?checkSchedulingProfile({tournamentRecord,schedulingProfile}):{error:INVALID_VALUES}:{error:MISSING_TOURNAMENT_RECORD}},getSchedulingProfile,removeMatchUpCourtAssignment:function removeMatchUpCourtAssignment({drawDefinition,courtDayDate,matchUpId}){return removeMatchUpCourtAssignment$1({drawDefinition,courtDayDate,matchUpId})},clearScheduledMatchUps:clearScheduledMatchUps$1,bulkScheduleMatchUps:bulkScheduleMatchUps$1,bulkRescheduleMatchUps:bulkRescheduleMatchUps$1};function getAllowedDrawTypes({tournamentRecord,categoryName,categoryType}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{appliedPolicies}=getAppliedPolicies({tournamentRecord}),drawTypesPolicy=null==appliedPolicies?void 0:appliedPolicies[POLICY_TYPE_DRAWS];return((null==drawTypesPolicy?void 0:drawTypesPolicy.allowedDrawTypes)||[]).filter((({categoryNames,categoryTypes})=>!categoryName&&!categoryTypes||categoryName&&(null==categoryNames?void 0:categoryNames.includes(categoryName))||categoryType&&(null==categoryTypes?void 0:categoryTypes.includes(categoryType))))}const policyGovernor={attachPolicies:attachPolicies$2,attachEventPolicies,removeEventPolicy:function removeEventPolicy({event,policyType}){if(!policyType)return{error:MISSING_VALUE};if(!event)return{error:MISSING_EVENT};let policyRemoved;if(event.extensions){const{appliedPolicies}=getAppliedPolicies({event});if(appliedPolicies&&appliedPolicies[policyType])if(delete appliedPolicies[policyType],policyRemoved=!0,Object.keys(appliedPolicies).length){addEventExtension$1({event,extension:{name:APPLIED_POLICIES,value:appliedPolicies}})}else removeEventExtension({event,name:APPLIED_POLICIES})}return policyRemoved?SUCCESS:{error:POLICY_NOT_FOUND}},findPolicy,getSeedsCount,getEntriesAndSeedsCount,getAllowedDrawTypes,getAllowedMatchUpFormats:function getAllowedMatchUpFormats({tournamentRecord,categoryName,categoryType}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{appliedPolicies}=getAppliedPolicies({tournamentRecord}),scoringPolicy=null==appliedPolicies?void 0:appliedPolicies[POLICY_TYPE_SCORING];return((null==scoringPolicy?void 0:scoringPolicy.matchUpFormats)||[]).filter((({categoryNames,categoryTypes})=>!categoryName&&!categoryTypes||categoryName&&(null==categoryNames?void 0:categoryNames.includes(categoryName))||categoryType&&(null==categoryTypes?void 0:categoryTypes.includes(categoryType))))},getAppliedPolicies},ELO="ELO",WTN="WTN";function getDetailsWTN({participant,eventType}){var _a,_b,_c,_d,_e,_f;const personId=null==(_a=null==participant?void 0:participant.person)?void 0:_a.personId,personOtherId=null==(_c=null==(_b=null==participant?void 0:participant.person)?void 0:_b.personOtherIds)?void 0:_c[0],tennisId=null==(_d=null==participant?void 0:participant.person)?void 0:_d.tennisId,scaleItem=null==(_f=null==(_e=null==participant?void 0:participant.ratings)?void 0:_e[eventType])?void 0:_f.find((({scaleName})=>scaleName===WTN)),personWTN=null==scaleItem?void 0:scaleItem.scaleValue,{wtnRating,confidence}=personWTN||{};return{timeStamp:null==scaleItem?void 0:scaleItem.scaleDate,personOtherId,confidence,wtnRating,personId,tennisId}}var __defProp$16=Object.defineProperty,__defProps$B=Object.defineProperties,__getOwnPropDescs$B=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$16=Object.getOwnPropertySymbols,__hasOwnProp$16=Object.prototype.hasOwnProperty,__propIsEnum$16=Object.prototype.propertyIsEnumerable,__defNormalProp$16=(obj,key,value)=>key in obj?__defProp$16(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$16=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$16.call(b,prop)&&__defNormalProp$16(a,prop,b[prop]);if(__getOwnPropSymbols$16)for(var prop of __getOwnPropSymbols$16(b))__propIsEnum$16.call(b,prop)&&__defNormalProp$16(a,prop,b[prop]);return a};function getTieFormatDesc(tieFormat){var _a;if(!tieFormat)return{};const tieFormatName=tieFormat.tieFormatName;return{tieFormatName:tieFormat&&tieFormatName||"UNNAMED",tieFormatDesc:null==(_a=tieFormat.collectionDefinitions)?void 0:_a.map((def=>{const{matchUpType,matchUpFormat,matchUpCount,category,gender}=def,ageCategoryCode=null==category?void 0:category.ageCategoryCode;return[matchUpCount,matchUpType===DOUBLES_MATCHUP?"D":"S",ageCategoryCode,matchUpFormat,gender].join(";")})).join("|")}}function getAvgWTN({matchUps,drawId,eventId,eventType}){const matchUpFormats={},participantsMap=matchUps.filter((matchUp=>eventId?matchUp.eventId===eventId:matchUp.drawId===drawId)).reduce(((participants,matchUp)=>((({matchUpFormat})=>{matchUpFormat&&(matchUpFormats[matchUpFormat]||(matchUpFormats[matchUpFormat]=0),matchUpFormats[matchUpFormat]+=1)})(matchUp),(matchUp.sides||[]).flatMap((side=>{var _a;return((null==(_a=null==side?void 0:side.participant)?void 0:_a.individualParticipants)||[null==side?void 0:side.participant]).filter(Boolean)})).forEach((participant=>participants[participant.participantId]=participant)),participants)),{}),eventParticipants=Object.values(participantsMap),wtnRatings=eventParticipants.map((participant=>getDetailsWTN({participant,eventType}))).filter((({wtnRating})=>wtnRating)),pctNoRating=(eventParticipants.length-wtnRatings.length)/eventParticipants.length*100,wtnTotals=wtnRatings.reduce(((totals,wtnDetails)=>{const{wtnRating,confidence}=wtnDetails;return totals.totalWTN+=wtnRating,totals.totalConfidence+=confidence,totals}),{totalWTN:0,totalConfidence:0}),avgWTN=(null==wtnRatings?void 0:wtnRatings.length)?wtnTotals.totalWTN/wtnRatings.length:0,avgConfidence=(null==wtnRatings?void 0:wtnRatings.length)?wtnTotals.totalConfidence/wtnRatings.length:0,matchUpsCount=Object.values(matchUpFormats).reduce(((p,c)=>p+(c||0)),0);return{avgWTN,avgConfidence,matchUpFormats,matchUpsCount,pctNoRating}}var __defProp$15=Object.defineProperty,__defProps$A=Object.defineProperties,__getOwnPropDescs$A=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$15=Object.getOwnPropertySymbols,__hasOwnProp$15=Object.prototype.hasOwnProperty,__propIsEnum$15=Object.prototype.propertyIsEnumerable,__defNormalProp$15=(obj,key,value)=>key in obj?__defProp$15(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const reportGovernor={getStructureReports:function getStructureReports({firstFlightOnly=!0,extensionProfiles,tournamentRecord}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_ID};const eventStructureReports={},extensionValues=Object.assign({},...(extensionProfiles||[]).map((({name,label,accessor})=>{var _a2,_b,_c;const element=null==(_b=null==(_a2=findTournamentExtension({tournamentRecord,name}))?void 0:_a2.extension)?void 0:_b.value;return{[label||name]:accessor?null==(_c=getAccessorValue({element,accessor}))?void 0:_c.value:element}}))),tournamentId=null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUps=allTournamentMatchUps({participantsProfile:{withScaleValues:!0},tournamentRecord}).matchUps||[],getSeedingBasis=timeItems=>{var _a2,_b;const timeItem=null==(_a2=getTimeItem({itemType:"addScaleItems",itemSubTypes:[SEEDING$1],element:{timeItems}}))?void 0:_a2.timeItem;return null==(_b=null==timeItem?void 0:timeItem.itemValue)?void 0:_b.scaleBasis},tournamentStructureData=null==(_a=null==tournamentRecord?void 0:tournamentRecord.events)?void 0:_a.flatMap((({timeItems:eventTimeItems,drawDefinitions=[],extensions,eventType,eventId,category})=>{var _a2,_b,_c,_d;const flightProfile=null==extensions?void 0:extensions.find((x=>x.name===FLIGHT_PROFILE)),flightNumbers=null==(_b=null==(_a2=null==flightProfile?void 0:flightProfile.value)?void 0:_a2.flights)?void 0:_b.map((flight=>({[flight.drawId]:flight.flightNumber}))),flightMap=flightNumbers&&Object.assign({},...flightNumbers),drawDeletionsCount=(null==(_d=null==(_c=null==extensions?void 0:extensions.find((x=>x.name===DRAW_DELETIONS)))?void 0:_c.value)?void 0:_d.length)||0,minFlightNumber=flightMap&&Math.min(...Object.values(flightMap)),eventSeedingBasis=getSeedingBasis(eventTimeItems);return eventStructureReports[eventId]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount,seedingBasis:eventSeedingBasis?JSON.stringify(eventSeedingBasis):void 0,tournamentId,eventId},drawDefinitions.filter((d=>!firstFlightOnly||!flightNumbers||flightMap[d.drawId]===minFlightNumber)).flatMap((({matchUpFormat:drawMatchUpFormat,tieFormat:drawTieFormat,timeItems:drawTimeItems,extensions:extensions2,structures,drawType,drawId})=>{const{avgConfidence,matchUpFormats,matchUpsCount,pctNoRating,avgWTN}=getAvgWTN({eventType,matchUps,drawId}),seedingBasis=getSeedingBasis(drawTimeItems)||eventSeedingBasis,positionManipulations=function getPositionManipulations({extensions}){var _a,_b;return null==(_b=null==(_a=null==extensions?void 0:extensions.find((({name})=>name===AUDIT_POSITION_ACTIONS)))?void 0:_a.value)?void 0:_b.slice(1)}({extensions:extensions2}),manipulationsCount=(null==positionManipulations?void 0:positionManipulations.length)||0;return eventStructureReports[eventId].totalPositionManipulations+=manipulationsCount,eventStructureReports[eventId].generatedDrawsCount+=1,manipulationsCount>eventStructureReports[eventId].maxPositionManipulations&&(eventStructureReports[eventId].maxPositionManipulations=manipulationsCount),null==structures?void 0:structures.filter((s=>1===s.stageSequence&&[QUALIFYING,MAIN,CONSOLATION,PLAY_OFF].includes(s.stage))).map((s=>{var _a3,_b2,_c2;const finalMatchUp=[MAIN,PLAY_OFF].includes(s.stage)&&matchUps.find((matchUp=>matchUp.structureId===s.structureId&&1===matchUp.finishingRound&&matchUp.winningSide)),winningParticipant=null==(_b2=null==(_a3=null==finalMatchUp?void 0:finalMatchUp.sides)?void 0:_a3.find((side=>side.sideNumber===finalMatchUp.winningSide)))?void 0:_b2.participant,winningTeamId=(null==winningParticipant?void 0:winningParticipant.participantType)===TEAM_PARTICIPANT&&winningParticipant.participantId,{individualParticipants}=(null==winningParticipant?void 0:winningParticipant.participantType)===PAIR&&winningParticipant||{},winningPersonWTN=getDetailsWTN({participant:(null==individualParticipants?void 0:individualParticipants[0])||winningParticipant,eventType}),{personId:winningPersonId,personOtherId:winningPersonOtherId,tennisId:winningPersonTennisId,confidence:confidence1,wtnRating:wtnRating1}=winningPersonWTN||{},winningPerson2WTN=getDetailsWTN({participant:null==individualParticipants?void 0:individualParticipants[1],eventType}),{personId:winningPerson2Id,personOtherId:winningPerson2OtherId,tennisId:winningPerson2TennisId,confidence:confidence2,wtnRating:wtnRating2}=winningPerson2WTN||{},{ageCategoryCode,categoryName,subType}=category||{},matchUpFormat=s.matchUpFormat||drawMatchUpFormat,pctInitialMatchUpFormat=(matchUpFormats[matchUpFormat]||0)/matchUpsCount*100,{tieFormatName:drawTieFormatName,tieFormatDesc:drawTieFormatDesc}=getTieFormatDesc(drawTieFormat),{tieFormatName:structureTieFormatName,tieFormatDesc:structureTieFormatDesc}=getTieFormatDesc(s.tieFormat),equivalentTieFormatDesc=drawTieFormatDesc===structureTieFormatDesc,tieFormatName=!equivalentTieFormatDesc&&structureTieFormatName,tieFormatDesc=s.tieFormat&&!equivalentTieFormatDesc&&structureTieFormatDesc,manipulations=(null==(_c2=null==positionManipulations?void 0:positionManipulations.filter((action=>action.structureId===s.structureId)))?void 0:_c2.length)||0;return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$15.call(b,prop)&&__defNormalProp$15(a,prop,b[prop]);if(__getOwnPropSymbols$15)for(var prop of __getOwnPropSymbols$15(b))__propIsEnum$15.call(b,prop)&&__defNormalProp$15(a,prop,b[prop]);return a})({},extensionValues),b={tournamentId,eventId,structureId:s.structureId,drawId,eventType,category:subType,categoryName,ageCategoryCode,flightNumber:flightMap[drawId],drawType,stage:s.stage,seedingBasis:seedingBasis?JSON.stringify(seedingBasis):void 0,winningPersonId,winningPersonOtherId,winningPersonTennisId,winningPersonWTNrating:wtnRating1,winningPersonWTNconfidence:confidence1,winningPerson2Id,winningPerson2OtherId,winningPerson2TennisId,winningPerson2WTNrating:wtnRating2,winningPerson2WTNconfidence:confidence2,winningTeamId,positionManipulations:manipulations,pctNoRating,matchUpFormat,pctInitialMatchUpFormat,matchUpsCount,drawTieFormatName,drawTieFormatDesc,tieFormatName,tieFormatDesc,avgConfidence,avgWTN},__defProps$A(a,__getOwnPropDescs$A(b));var a,b}))}))}));return{eventStructureReports:Object.values(eventStructureReports),structureReports:tournamentStructureData}},getEntryStatusReports:function getEntryStatusReports({tournamentRecord}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const tournamentId=tournamentRecord.tournamentId,{participantMap}=getParticipants$1({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord,withDraws:!0}),nonTeamEnteredParticipantIds=allTournamentMatchUps({matchUpFilters:{matchUpTypes:[SINGLES_MATCHUP,DOUBLES_MATCHUP]},tournamentRecord}).matchUps.flatMap((({sides,matchUpType})=>sides.flatMap((({participant,participantId})=>matchUpType===DOUBLES_MATCHUP?null==participant?void 0:participant.individualParticipantIds:(null==participant?void 0:participant.participantId)||participantId)).filter(Boolean))).filter(Boolean),withDrawnParticipantIds=[],participantEntryReports={},entryStatusReports={},eventReports={};let drawDefinitionsCount=0;const pushEntryReport=({id,entry,eventId,eventType})=>{var _a;const{qualifyingSeeding,mainSeeding,entryStatus,entryStage,drawId}=entry;participantEntryReports[id]||(participantEntryReports[id]=[]);const{participant,events}=participantMap[id],entryDetailsWTN=getDetailsWTN({participant,eventType}),ranking=null==(_a=null==events?void 0:events[eventId])?void 0:_a.ranking;var a;entryStatus===WITHDRAW_PARTICIPANT&&withDrawnParticipantIds.push(id),participantEntryReports[id].push((a=__spreadValues$16({participantType:null==participant?void 0:participant.participantType,participantId:id,tournamentId,eventType,eventId,drawId,entryStatus,entryStage},entryDetailsWTN),__defProps$B(a,__getOwnPropDescs$B({ranking,mainSeeding,qualifyingSeeding}))))};for(const event of tournamentRecord.events||[]){const entryStatuses={},countEntryStatus=entryStatus=>{entryStatuses[entryStatus]||(entryStatuses[entryStatus]={count:0}),entryStatuses[entryStatus].count+=1},{drawDefinitions=[],eventType,eventId}=event,entries=drawDefinitions.flatMap((({drawId,entries:entries2,structures=[]})=>{drawDefinitionsCount+=1;const assignedParticipantIds=structures.filter((({stage,stageSequence})=>stage===MAIN&&1===stageSequence||stage===QUALIFYING)).flatMap((({positionAssignments})=>positionAssignments)).map((({participantId})=>participantId)).filter(Boolean);return entries2.filter((({participantId})=>assignedParticipantIds.includes(participantId))).map((({participantId,entryStatus,entryStage})=>{var _a,_b,_c,_d,_e,_f,_g,_h;countEntryStatus(entryStatus);const mainSeeding=null==(_d=null==(_c=null==(_b=null==(_a=participantMap[participantId])?void 0:_a.draws)?void 0:_b[drawId])?void 0:_c.seedAssignments)?void 0:_d[MAIN];return{qualifyingSeeding:null==(_h=null==(_g=null==(_f=null==(_e=participantMap[participantId])?void 0:_e.draws)?void 0:_f[drawId])?void 0:_g.seedAssignments)?void 0:_h[QUALIFYING],participantId,mainSeeding,entryStatus,entryStage,drawId}}))})),createEntryMap=entry=>{const participantId=entry.participantId,individualParticipantIds=participantMap[participantId].participant.individualParticipantIds.filter((id=>nonTeamEnteredParticipantIds.includes(id)));return participantId&&{[participantId]:{individualParticipantIds}}};eventType===DOUBLES_EVENT?(()=>{const participantEntriesMap=Object.assign({},...entries.map(createEntryMap).filter(Boolean));entries.forEach((entry=>{participantEntriesMap[entry.participantId].individualParticipantIds.forEach((individualParticipantId=>{pushEntryReport({id:individualParticipantId,eventType,eventId,entry})}))}))})():entries.forEach((entry=>{pushEntryReport({id:entry.participantId,entry,eventId,eventType})}));const totalEntries=Object.values(entryStatuses).reduce(((p,c)=>p+c.count),0);Object.keys(entryStatuses).forEach((key=>{entryStatuses[key].pct=entryStatuses[key].count/totalEntries*100})),eventReports[eventId]={tournamentId,eventId,entries,entryStatuses};const selectedStatuses=Object.assign({},...STRUCTURE_SELECTED_STATUSES.flatMap((entryStatus=>{var _a,_b;return[{[entryStatus+"_count"]:null==(_a=entryStatuses[entryStatus])?void 0:_a.count},{[entryStatus+"_pct"]:null==(_b=entryStatuses[entryStatus])?void 0:_b.pct}]})));entryStatusReports[eventId]=__spreadValues$16({tournamentId,eventId},selectedStatuses)}const individualParticipants=Object.values(participantMap).filter((({participant:{participantType,participantRole}})=>participantType===INDIVIDUAL&&participantRole===COMPETITOR)),tournamentEntryReport={nonParticipatingEntriesCount:individualParticipants.filter((({participant})=>!nonTeamEnteredParticipantIds.includes(participant.participantId))).map((({participant})=>participant.participantId)).length,individualParticipantsCount:individualParticipants.length,eventsCount:Object.values(eventReports).length,drawDefinitionsCount,tournamentId};return{entryStatusReports:Object.values(entryStatusReports).flat(),participantEntryReports:Object.values(participantEntryReports).flat(),eventReports:Object.values(eventReports).flat(),withDrawnParticipantIds,tournamentEntryReport}}};var __defProp$14=Object.defineProperty,__defProps$z=Object.defineProperties,__getOwnPropDescs$z=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$14=Object.getOwnPropertySymbols,__hasOwnProp$14=Object.prototype.hasOwnProperty,__propIsEnum$14=Object.prototype.propertyIsEnumerable,__defNormalProp$14=(obj,key,value)=>key in obj?__defProp$14(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$14=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$14.call(b,prop)&&__defNormalProp$14(a,prop,b[prop]);if(__getOwnPropSymbols$14)for(var prop of __getOwnPropSymbols$14(b))__propIsEnum$14.call(b,prop)&&__defNormalProp$14(a,prop,b[prop]);return a},__spreadProps$z=(a,b)=>__defProps$z(a,__getOwnPropDescs$z(b));function validateLineUp({lineUp,tieFormat}){let errors=[];if(!Array.isArray(lineUp))return errors.push(mustBeAnArray("lineUp")),{valid:!1,errors,error:INVALID_VALUES};const validItems=lineUp.every((item=>{if("object"!=typeof item)return errors.push("lineUp entries must be objects"),!1;const{participantId,collectionAssignments}=item;return participantId?"string"!=typeof participantId?(errors.push("participantIds must be strings"),!1):Array.isArray(collectionAssignments)?collectionAssignments.every((collectionAssignment=>{if("object"!=typeof collectionAssignment)return errors.push("collectionAssignments must be objects"),!1;const{collectionPosition}=collectionAssignment;return"number"==typeof collectionPosition||(errors.push("collectionPosition must be a number"),!1)})):(errors.push(mustBeAnArray("collectionAssignments")),!1):(errors.push("Missing participantId"),!1)})),noDuplicates=unique(lineUp.map(getParticipantId)).length===lineUp.length;noDuplicates||errors.push("Duplicated participantId(s)");return{valid:validItems&&noDuplicates,errors,error:errors.length?INVALID_VALUES:void 0}}var __defProp$13=Object.defineProperty,__getOwnPropSymbols$13=Object.getOwnPropertySymbols,__hasOwnProp$13=Object.prototype.hasOwnProperty,__propIsEnum$13=Object.prototype.propertyIsEnumerable,__defNormalProp$13=(obj,key,value)=>key in obj?__defProp$13(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$13=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$13.call(b,prop)&&__defNormalProp$13(a,prop,b[prop]);if(__getOwnPropSymbols$13)for(var prop of __getOwnPropSymbols$13(b))__propIsEnum$13.call(b,prop)&&__defNormalProp$13(a,prop,b[prop]);return a};function updateTeamLineUp({drawDefinition,participantId,tieFormat,lineUp}){if("object"!=typeof drawDefinition)return{error:MISSING_DRAW_DEFINITION};if("string"!=typeof participantId)return{error:MISSING_PARTICIPANT_ID};const validation=validateLineUp({lineUp,tieFormat});if(!validation.valid)return validation;const{extension:existingExtension}=findExtension$2({element:drawDefinition,name:LINEUPS}),value=(null==existingExtension?void 0:existingExtension.value)||{};value[participantId]=removeLineUpSubstitutions({lineUp});return addExtension$1({element:drawDefinition,extension:{name:LINEUPS,value}}),addDrawNotice({drawDefinition}),__spreadValues$13({},SUCCESS)}var __defProp$12=Object.defineProperty,__getOwnPropSymbols$12=Object.getOwnPropertySymbols,__hasOwnProp$12=Object.prototype.hasOwnProperty,__propIsEnum$12=Object.prototype.propertyIsEnumerable,__defNormalProp$12=(obj,key,value)=>key in obj?__defProp$12(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$12=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$12.call(b,prop)&&__defNormalProp$12(a,prop,b[prop]);if(__getOwnPropSymbols$12)for(var prop of __getOwnPropSymbols$12(b))__propIsEnum$12.call(b,prop)&&__defNormalProp$12(a,prop,b[prop]);return a};function getTieMatchUpContext({tournamentRecord,drawDefinition,tieMatchUpId,event}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!drawDefinition)return{error:MISSING_DRAW_ID};if(!event)return{error:EVENT_NOT_FOUND};const matchUpsMap=getMatchUpsMap({drawDefinition}),{matchUp:tieMatchUp}=findMatchUp$1({matchUpId:tieMatchUpId,drawDefinition,matchUpsMap});if(!tieMatchUp)return{error:MATCHUP_NOT_FOUND};const{matchUp:inContextTieMatchUp,structure}=findMatchUp$1({tournamentParticipants:tournamentRecord.participants,matchUpId:tieMatchUpId,inContext:!0,drawDefinition,matchUpsMap,event}),{collectionPosition,drawPositions,collectionId,matchUpTieId,matchUpType}=inContextTieMatchUp;if(![SINGLES$1,DOUBLES$1].includes(matchUpType))return{error:INVALID_MATCHUP};const{positionAssignments}=getPositionAssignments$1({structure}),relevantAssignments=null==positionAssignments?void 0:positionAssignments.filter((assignment=>null==drawPositions?void 0:drawPositions.includes(assignment.drawPosition))),participantIds=getParticipantIds(relevantAssignments),{tournamentParticipants:teamParticipants}=getTournamentParticipants({tournamentRecord,participantFilters:{participantTypes:[TEAM],participantIds}}),{matchUp:dualMatchUp}=findMatchUp$1({matchUpId:matchUpTieId,drawDefinition,matchUpsMap}),{matchUp:inContextDualMatchUp}=findMatchUp$1({matchUpId:matchUpTieId,inContext:!0,drawDefinition,matchUpsMap}),tieFormat=dualMatchUp.tieFormat||structure.tieFormat||drawDefinition.tieFormat||event.tieFormat||void 0;return __spreadValues$12({inContextDualMatchUp,inContextTieMatchUp,relevantAssignments,collectionPosition,teamParticipants,collectionId,matchUpType,dualMatchUp,tieMatchUp,tieFormat,structure},SUCCESS)}var __defProp$11=Object.defineProperty,__defProps$y=Object.defineProperties,__getOwnPropDescs$y=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$11=Object.getOwnPropertySymbols,__hasOwnProp$11=Object.prototype.hasOwnProperty,__propIsEnum$11=Object.prototype.propertyIsEnumerable,__defNormalProp$11=(obj,key,value)=>key in obj?__defProp$11(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$11=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$11.call(b,prop)&&__defNormalProp$11(a,prop,b[prop]);if(__getOwnPropSymbols$11)for(var prop of __getOwnPropSymbols$11(b))__propIsEnum$11.call(b,prop)&&__defNormalProp$11(a,prop,b[prop]);return a},__spreadProps$y=(a,b)=>__defProps$y(a,__getOwnPropDescs$y(b));function replaceTieMatchUpParticipantId(params){var _a,_b,_c,_d,_e,_f,_g,_h;const matchUpContext=getTieMatchUpContext(params);if(matchUpContext.error)return matchUpContext;const stack="replaceTieMatchUpParticipantid",{existingParticipantId,tournamentRecord,newParticipantId,drawDefinition,substitution,event}=params;if(!existingParticipantId||!newParticipantId)return decorateResult({result:{error:MISSING_PARTICIPANT_ID},stack});if(existingParticipantId===newParticipantId)return __spreadValues$11({},SUCCESS);const{inContextDualMatchUp,inContextTieMatchUp,collectionPosition,collectionId,dualMatchUp,tieMatchUp,tieFormat}=matchUpContext,{matchUpType}=inContextTieMatchUp,side=null==(_a=inContextTieMatchUp.sides)?void 0:_a.find((side2=>{var _a2,_b2,_c2;return(null==(_a2=side2.participant)?void 0:_a2.participantId)===existingParticipantId||(null==(_c2=null==(_b2=side2.participant)?void 0:_b2.individualParticipantIds)?void 0:_c2.includes(existingParticipantId))}));if(!side)return{error:PARTICIPANT_NOT_FOUND};const{tournamentParticipants:targetParticipants}=getTournamentParticipants({tournamentRecord,participantFilters:{participantIds:[existingParticipantId,newParticipantId]}});if(2!==targetParticipants.length)return decorateResult({result:{error:MISSING_PARTICIPANT_ID},stack});if(targetParticipants[0].participantType!==targetParticipants[1].participantType)return decorateResult({result:{error:INVALID_PARTICIPANT_TYPE},stack});const{appliedPolicies}=getAppliedPolicies({tournamentRecord,drawDefinition,event}),matchUpActionsPolicy=(null==appliedPolicies?void 0:appliedPolicies[POLICY_TYPE_MATCHUP_ACTIONS])||POLICY_MATCHUP_ACTIONS_DEFAULT[POLICY_TYPE_MATCHUP_ACTIONS],substitutionProcessCodes=null==matchUpActionsPolicy?void 0:matchUpActionsPolicy.substitutionProcessCodes,{extension}=findExtension$1({element:drawDefinition,name:LINEUPS}),lineUps=(null==extension?void 0:extension.value)||{};if(!(null==(_b=dualMatchUp.sides)?void 0:_b.length)){const extractSideDetail=({displaySideNumber,drawPosition,sideNumber})=>({drawPosition,sideNumber,displaySideNumber});dualMatchUp.sides=inContextDualMatchUp.sides.map((side2=>{const participantId=side2.participantId;return __spreadProps$y(__spreadValues$11({},extractSideDetail(side2)),{lineUp:participantId&&lineUps[participantId]||[]})}))}const dualMatchUpSide=dualMatchUp.sides.find((({sideNumber})=>sideNumber===side.sideNumber));if(!dualMatchUpSide)return decorateResult({result:{sideNumber:side.sideNumber,existingParticipantId,error:NOT_FOUND},stack});if((null==(_c=inContextTieMatchUp.sides)?void 0:_c.flatMap((({participant})=>(null==participant?void 0:participant.individualParticipantIds)||(null==participant?void 0:participant.participantId)||[]))).includes(newParticipantId))return decorateResult({result:{error:EXISTING_PARTICIPANT},stack});const teamParticipantId=null==(_e=null==(_d=inContextDualMatchUp.sides)?void 0:_d.find((({sideNumber})=>sideNumber===side.sideNumber)))?void 0:_e.participantId,teamLineUp=dualMatchUpSide.lineUp,newParticipantIdInLineUp=null==teamLineUp?void 0:teamLineUp.find((({participantId})=>newParticipantId===participantId)),substitutionOrder=null==teamLineUp?void 0:teamLineUp.reduce(((order,teamCompetitor)=>teamCompetitor.substitutionOrder>order?teamCompetitor.substitutionOrder:order),0),modifiedLineUp=(null==teamLineUp?void 0:teamLineUp.map((teamCompetitor=>{var _a2;const modifiedCompetitor=makeDeepCopy(teamCompetitor,!1,!0);if(![existingParticipantId,newParticipantId].includes(modifiedCompetitor.participantId))return modifiedCompetitor;if(!substitution&&[existingParticipantId,newParticipantId].includes(modifiedCompetitor.participantId)&&(modifiedCompetitor.collectionAssignments=null==(_a2=modifiedCompetitor.collectionAssignments)?void 0:_a2.filter((assignment=>!(assignment.collectionPosition===collectionPosition&&assignment.collectionId===collectionId)))),substitution&&existingParticipantId===modifiedCompetitor.participantId&&(modifiedCompetitor.collectionAssignments=modifiedCompetitor.collectionAssignments.map((assignment=>assignment.collectionPosition===collectionPosition&&assignment.collectionId===collectionId&&void 0===assignment.substitutionOrder?__spreadProps$y(__spreadValues$11({},assignment),{substitutionOrder}):assignment))),modifiedCompetitor.participantId===newParticipantId){modifiedCompetitor.collectionAssignments||(modifiedCompetitor.collectionAssignments=[]);const assignment={collectionId,collectionPosition};substitution&&(assignment.previousParticipantId=existingParticipantId,assignment.substitutionOrder=substitutionOrder+1),modifiedCompetitor.collectionAssignments.push(assignment)}return modifiedCompetitor})))||[];if(!newParticipantIdInLineUp){const collectionAssignment={collectionId,collectionPosition};substitution&&(collectionAssignment.substitutionOrder=substitutionOrder+1,collectionAssignment.previousParticipantId=existingParticipantId);const assignment={collectionAssignments:[collectionAssignment],participantId:newParticipantId};modifiedLineUp.push(assignment)}const isDoubles=matchUpType===DOUBLES$1,{assignedParticipantIds:existingIndividualParticipantIds}=getCollectionPositionAssignments({lineUp:teamLineUp,collectionPosition,collectionId}),{assignedParticipantIds:individualParticipantIds}=getCollectionPositionAssignments({lineUp:modifiedLineUp,collectionPosition,collectionId});if(dualMatchUpSide.lineUp=modifiedLineUp,teamParticipantId){const result=updateTeamLineUp({participantId:teamParticipantId,lineUp:modifiedLineUp,drawDefinition,tieFormat});if(result.error)return decorateResult({result,stack})}else console.log("team participantId not found");let participantAdded,participantRemoved;if(isDoubles){const{tournamentRecord:tournamentRecord2}=params;let result=getPairedParticipant({participantIds:individualParticipantIds,tournamentRecord:tournamentRecord2});if(!result.participant){const result2=addParticipant$1({returnParticipant:!0,pairOverride:!0,tournamentRecord:tournamentRecord2,participant:{participantRole:COMPETITOR,individualParticipantIds,participantType:PAIR}});if(result2.error)return decorateResult({result:result2,stack});participantAdded=null==(_f=result2.participant)?void 0:_f.participantId}result=getPairedParticipant({participantIds:existingIndividualParticipantIds,tournamentRecord:tournamentRecord2});const existingPairParticipantId=null==(_g=result.participant)?void 0:_g.participantId;if(existingPairParticipantId){deleteParticipants({participantIds:[existingPairParticipantId],tournamentRecord:tournamentRecord2}).success&&(participantRemoved=existingPairParticipantId)}}if(substitution||1===(null==(_h=side.substitutions)?void 0:_h.length)){if(substitution){const processCodes=tieMatchUp.processCodes||[];substitutionProcessCodes&&processCodes.push(...substitutionProcessCodes),tieMatchUp.processCodes=processCodes}else for(const substitutionProcessCode of substitutionProcessCodes||[]){const codeIndex=tieMatchUp.processCodes.lastIndexOf(substitutionProcessCode);tieMatchUp.processCodes.splice(codeIndex,1)}modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUp:tieMatchUp,context:stack,drawDefinition})}return modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUp:dualMatchUp,context:stack,drawDefinition}),__spreadProps$y(__spreadValues$11({},SUCCESS),{modifiedLineUp,participantRemoved,participantAdded})}function getPositionAssignments({tournamentRecord,drawDefinition,structureId,structure}){return tournamentRecord?structure||drawDefinition?structure||structureId?getPositionAssignments$1({drawDefinition,structureId,structure}):{error:MISSING_STRUCTURE_ID}:{error:MISSING_DRAW_DEFINITION}:{error:MISSING_TOURNAMENT_RECORD}}var __defProp$10=Object.defineProperty,__defProps$x=Object.defineProperties,__getOwnPropDescs$x=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$10=Object.getOwnPropertySymbols,__hasOwnProp$10=Object.prototype.hasOwnProperty,__propIsEnum$10=Object.prototype.propertyIsEnumerable,__defNormalProp$10=(obj,key,value)=>key in obj?__defProp$10(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$10=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$10.call(b,prop)&&__defNormalProp$10(a,prop,b[prop]);if(__getOwnPropSymbols$10)for(var prop of __getOwnPropSymbols$10(b))__propIsEnum$10.call(b,prop)&&__defNormalProp$10(a,prop,b[prop]);return a},__spreadProps$x=(a,b)=>__defProps$x(a,__getOwnPropDescs$x(b));function deleteDrawDefinitions({autoPublish=!0,policyDefinitions,tournamentRecord,drawIds=[],auditData,eventId,event}){var _a,_b,_c;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const stack="deleteDrawDefinitions";if(!policyDefinitions){const{appliedPolicies}=getAppliedPolicies({tournamentRecord,event});policyDefinitions=appliedPolicies}const drawId=Array.isArray(drawIds)&&drawIds[0];if(!event){const result=findEvent({tournamentRecord,eventId,drawId});if(result.error)return result;event=result.event}const auditTrail=[],matchUpIds=[],deletedDrawsDetail=[];if(!event.drawDefinitions)return decorateResult({result:__spreadValues$10({},SUCCESS),info:"event has no drawDefinition",stack});const eventDrawIds=event.drawDefinitions.map((({drawId:drawId2})=>drawId2));if(drawIds.length||(drawIds=eventDrawIds),!(drawIds=drawIds.filter((drawId2=>eventDrawIds.includes(drawId2)))).length)return decorateResult({result:__spreadValues$10({},SUCCESS),info:"nothing to do; no matching drawIds in event.",stack});const flightProfile=makeDeepCopy(getFlightProfile({event}).flightProfile,!1,!0),positionAssignmentMap=({participantId,drawPosition,qualifier,bye})=>({bye,qualifier,drawPosition,participantId}),filteredDrawDefinitions=event.drawDefinitions.filter((drawDefinition=>{var _a2,_b2,_c2,_d,_e,_f;if(drawIds.includes(drawDefinition.drawId)){const{drawId:drawId2,drawType,drawName}=drawDefinition,flight=null==(_a2=null==flightProfile?void 0:flightProfile.flights)?void 0:_a2.find((flight2=>flight2.drawId===drawDefinition.drawId));flight&&(flight.drawEntries=null==(_b2=flight.drawEntries)?void 0:_b2.filter((entry=>STRUCTURE_ENTERED_TYPES.includes(entry.entryStatus))));const mainStructure=null==(_d=null==(_c2=getDrawStructures({stageSequence:1,drawDefinition,stage:MAIN}))?void 0:_c2.structures)?void 0:_d[0],positionAssignments=mainStructure&&(null==(_e=getPositionAssignments({structureId:mainStructure.structureId,tournamentRecord,drawDefinition}))?void 0:_e.positionAssignments.map(positionAssignmentMap)),qualifyingStructures=null==(_f=getDrawStructures({stage:QUALIFYING,drawDefinition}))?void 0:_f.structures,qualifyingPositionAssignments=(null==qualifyingStructures?void 0:qualifyingStructures.length)?qualifyingStructures.map((qualifyingStructure=>{var _a3;const stageSequence=qualifyingStructure.stageSequence;return{positionAssignments:null==(_a3=getPositionAssignments({structureId:qualifyingStructure.structureId,tournamentRecord,drawDefinition}))?void 0:_a3.positionAssignments.map(positionAssignmentMap),stageSequence}})):void 0,audit={action:DELETE_DRAW_DEFINITIONS,payload:{drawDefinitions:[drawDefinition],eventId:event.eventId,auditData}};auditTrail.push(audit),deletedDrawsDetail.push(definedAttributes({tournamentId:tournamentRecord.tournamentId,qualifyingPositionAssignments,eventId:event.eventId,positionAssignments,auditData,drawType,drawName,drawId:drawId2}));const{matchUps}=allDrawMatchUps$1({event,drawDefinition});matchUps.forEach((({matchUpId})=>matchUpIds.push(matchUpId)))}return!drawIds.includes(drawDefinition.drawId)}));if(event.drawDefinitions=filteredDrawDefinitions,flightProfile){addEventExtension$1({event,extension:{name:FLIGHT_PROFILE,value:flightProfile}})}checkSchedulingProfile({tournamentRecord});const itemType=`${PUBLISH}.${STATUS$1}`,{timeItem}=getTimeItem({element:event,itemType}),publishStatus=null==(_a=null==timeItem?void 0:timeItem.itemValue)?void 0:_a[PUBLIC];let publishedDrawsDeleted;for(const drawId2 of drawIds){if(null==(_b=null==publishStatus?void 0:publishStatus.drawIds)?void 0:_b.includes(drawId2)){publishedDrawsDeleted=!0;const updatedDrawIds=(null==(_c=publishStatus.drawIds)?void 0:_c.filter((publishedDrawId=>publishedDrawId!==drawId2)))||[],result=addEventTimeItem({event,timeItem:{itemType:`${PUBLISH}.${STATUS$1}`,itemValue:{[PUBLIC]:{drawIds:updatedDrawIds}}}});if(result.error)return{error:result.error}}}if(auditTrail.length&&addNotice({topic:AUDIT,payload:auditTrail}),matchUpIds.length&&deleteMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUpIds}),drawIds.forEach((drawId2=>{!function deleteDrawNotice({tournamentId,eventId,drawId}){addNotice({payload:{drawId,tournamentId,eventId},topic:DELETED_DRAW_IDS,key:drawId}),deleteNotice({key:drawId})}({drawId:drawId2})})),function addDrawDeletionTelemetry({event,deletedDrawsDetail,auditData}){const{extension}=findExtension$2({name:DRAW_DELETIONS,element:event}),deletionData=__spreadProps$x(__spreadValues$10({},auditData),{deletedDrawsDetail}),updatedExtension={name:DRAW_DELETIONS,value:Array.isArray(null==extension?void 0:extension.value)?extension.value.concat(deletionData):[deletionData]};addExtension$1({element:event,extension:updatedExtension})}({event,deletedDrawsDetail,auditData}),autoPublish&&publishedDrawsDeleted){const result=publishEvent({tournamentRecord,event,policyDefinitions});result.error&&console.log("publish error",result)}return __spreadValues$10({},SUCCESS)}var __defProp$$=Object.defineProperty,__getOwnPropSymbols$$=Object.getOwnPropertySymbols,__hasOwnProp$$=Object.prototype.hasOwnProperty,__propIsEnum$$=Object.prototype.propertyIsEnumerable,__defNormalProp$$=(obj,key,value)=>key in obj?__defProp$$(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$$=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$$.call(b,prop)&&__defNormalProp$$(a,prop,b[prop]);if(__getOwnPropSymbols$$)for(var prop of __getOwnPropSymbols$$(b))__propIsEnum$$.call(b,prop)&&__defNormalProp$$(a,prop,b[prop]);return a};function removeCollectionAssignments({collectionPosition,teamParticipantId,dualMatchUpSide,drawDefinition,participantIds,collectionId}){var _a;if(!collectionId||!collectionPosition||!Array.isArray(participantIds))return{modifiedLineUp:(null==dualMatchUpSide?void 0:dualMatchUpSide.lineUp)||[],error:INVALID_VALUES};const lineUp=(null==dualMatchUpSide?void 0:dualMatchUpSide.lineUp)||(null==(_a=getTeamLineUp({participantId:teamParticipantId,drawDefinition}))?void 0:_a.lineUp),previousParticipantIds=[],assignmentsRemoved=[];return{modifiedLineUp:(null==lineUp?void 0:lineUp.map((teamCompetitor=>{var _a2;if(!participantIds.includes(teamCompetitor.participantId))return teamCompetitor;const collectionAssignments=null==(_a2=teamCompetitor.collectionAssignments)?void 0:_a2.filter((assignment=>{const target=assignment.collectionId===collectionId&&assignment.collectionPosition===collectionPosition;return target&&(assignment.previousParticipantId&&previousParticipantIds.push(assignment.previousParticipantId),assignmentsRemoved.push(__spreadValues$$({participantId:teamCompetitor.participantId},assignment))),!target}));return{participantId:teamCompetitor.participantId,collectionAssignments}})).filter(Boolean))||[],assignmentsRemoved,previousParticipantIds}}var __defProp$_=Object.defineProperty,__defProps$w=Object.defineProperties,__getOwnPropDescs$w=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$_=Object.getOwnPropertySymbols,__hasOwnProp$_=Object.prototype.hasOwnProperty,__propIsEnum$_=Object.prototype.propertyIsEnumerable,__defNormalProp$_=(obj,key,value)=>key in obj?__defProp$_(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$_=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$_.call(b,prop)&&__defNormalProp$_(a,prop,b[prop]);if(__getOwnPropSymbols$_)for(var prop of __getOwnPropSymbols$_(b))__propIsEnum$_.call(b,prop)&&__defNormalProp$_(a,prop,b[prop]);return a},__spreadProps$w=(a,b)=>__defProps$w(a,__getOwnPropDescs$w(b));function assignTieMatchUpParticipantId(params){var _a,_b,_c,_d,_e,_f;const matchUpContext=getTieMatchUpContext(params);if(matchUpContext.error)return matchUpContext;const stack="assignTieMatchUpParticipantId";let teamParticipantId=params.teamParticipantId;const{tournamentRecord,drawDefinition,participantId}=params;if(!participantId)return decorateResult({result:{error:MISSING_PARTICIPANT_ID},stack});if(params.sideNumber&&![1,2].includes(params.sideNumber))return decorateResult({result:{error:INVALID_SIDE_NUMBER},stack});const{inContextDualMatchUp,inContextTieMatchUp,relevantAssignments,collectionPosition,teamParticipants,collectionId,matchUpType,dualMatchUp,tieFormat}=matchUpContext;if((null==(_a=inContextTieMatchUp.sides)?void 0:_a.flatMap((({participant})=>(null==participant?void 0:participant.individualParticipantIds)||(null==participant?void 0:participant.participantId)||[]))).includes(participantId))return decorateResult({result:{error:EXISTING_PARTICIPANT},stack});teamParticipantId=teamParticipantId||params.sideNumber&&(null==(_b=inContextDualMatchUp.sides.find((side=>side.sideNumber===params.sideNumber)))?void 0:_b.participantId);const{tournamentParticipants:[participantToAssign]}=getTournamentParticipants({tournamentRecord,participantFilters:{participantIds:[participantId]}});if(!participantToAssign)return decorateResult({result:{error:PARTICIPANT_NOT_FOUND},stack});const{individualParticipantIds,participantType}=participantToAssign;if(matchUpType===SINGLES$1&&participantType!==INDIVIDUAL)return{error:INVALID_PARTICIPANT_TYPE};const relevantParticipantIds=participantType===INDIVIDUAL?[participantId]:individualParticipantIds,participantTeam=teamParticipantId&&teamParticipants.find((({participantId:participantId2})=>participantId2===teamParticipantId))||teamParticipants.find((({individualParticipantIds:individualParticipantIds2})=>overlap(relevantParticipantIds,individualParticipantIds2)));if(!participantTeam)return{error:TEAM_NOT_FOUND};if(teamParticipantId||(teamParticipantId=participantTeam.participantId),!teamParticipantId)return{error:PARTICIPANT_NOT_FOUND};const teamAssignment=null==relevantAssignments?void 0:relevantAssignments.find((assignment=>assignment.participantId===(null==participantTeam?void 0:participantTeam.participantId))),teamDrawPosition=null==teamAssignment?void 0:teamAssignment.drawPosition,teamSide=null==(_c=inContextTieMatchUp.sides)?void 0:_c.find((({drawPosition})=>drawPosition===teamDrawPosition)),sideNumber=params.sideNumber||(null==teamSide?void 0:teamSide.sideNumber);if(!tieFormat)return{error:MISSING_TIE_FORMAT};if(!(null==(_d=tieFormat.collectionDefinitions)?void 0:_d.find((collectionDefinition2=>collectionDefinition2.collectionId===collectionId))))return{error:MISSING_COLLECTION_DEFINITION};if(!(null==(_e=dualMatchUp.sides)?void 0:_e.length)){const{extension}=findExtension$1({element:drawDefinition,name:LINEUPS}),lineUps=makeDeepCopy((null==extension?void 0:extension.value)||{},!1,!0),extractSideDetail=({displaySideNumber,drawPosition,sideNumber:sideNumber2})=>({drawPosition,sideNumber:sideNumber2,displaySideNumber});dualMatchUp.sides=inContextDualMatchUp.sides.map((side=>{const participantId2=side.participantId;return __spreadProps$w(__spreadValues$_({},extractSideDetail(side)),{lineUp:participantId2&&lineUps[participantId2]||[]})}))}const dualMatchUpSide=dualMatchUp.sides.find((side=>side.sideNumber===sideNumber)),tieMatchUpSide=inContextTieMatchUp.sides.find((side=>side.sideNumber===sideNumber)),lineUp=(null==dualMatchUpSide?void 0:dualMatchUpSide.lineUp)||(null==(_f=getTeamLineUp({participantId:teamParticipantId,drawDefinition}))?void 0:_f.lineUp),targetAssignments=null==lineUp?void 0:lineUp.filter((participantAssignment=>{var _a2;return null==(_a2=participantAssignment.collectionAssignments)?void 0:_a2.find((assignment=>assignment.collectionPosition===collectionPosition&&assignment.collectionId===collectionId&&!assignment.previousParticipantId))})),assignedParticipantIds=null==targetAssignments?void 0:targetAssignments.map((assignment=>null==assignment?void 0:assignment.participantId)),participantIds=(null==assignedParticipantIds?void 0:assignedParticipantIds.length)>1&&assignedParticipantIds||(participantType===PAIR?participantToAssign.individualParticipantIds:[participantId]),removeResult=removeCollectionAssignments({collectionPosition,teamParticipantId,dualMatchUpSide,participantType,drawDefinition,participantIds,collectionId,matchUpType});if(removeResult.error)return decorateResult({result:removeResult,stack});const{modifiedLineUp}=removeResult;let deleteParticipantId;if(matchUpType===DOUBLES$1){if(participantType!==PAIR){let result=updateLineUp({collectionPosition,teamParticipantId,drawDefinition,modifiedLineUp,participantId,collectionId,tieFormat});if(null==result?void 0:result.error)return decorateResult({result,stack});if(result=function addParticipantId2Pair({side}){let deleteParticipantId2;if(side.participant){const individualParticipantIds2=side.participant.individualParticipantIds||[];if(1===individualParticipantIds2.filter(Boolean).length){const{participant}=getPairedParticipant({participantIds:individualParticipantIds2,tournamentRecord});individualParticipantIds2.push(participantId);const{participant:existingParticipant}=getPairedParticipant({participantIds:individualParticipantIds2,tournamentRecord});if(existingParticipant)deleteParticipantId2=participant.participantId;else{participant.individualParticipantIds=individualParticipantIds2;const result=modifyParticipant({individualParticipantIds:individualParticipantIds2,pairOverride:!0,tournamentRecord,participant});if(result.error)return result}}}else{const result=addParticipant$1({participant:{individualParticipantIds:[participantId],participantRole:COMPETITOR,participantType:PAIR},pairOverride:!0,tournamentRecord});if(result.error)return result}return __spreadProps$w(__spreadValues$_({},SUCCESS),{deleteParticipantId:deleteParticipantId2})}({side:tieMatchUpSide}),result.error)return result;deleteParticipantId=result.deleteParticipantId,dualMatchUpSide.lineUp=modifiedLineUp,modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUp:dualMatchUp,context:stack,drawDefinition})}else if(participantType===PAIR)for(const participantId2 of participantIds)updateLineUp({collectionPosition,teamParticipantId,drawDefinition,modifiedLineUp,participantId:participantId2,collectionId,tieFormat})}else{const result=updateLineUp({collectionPosition,teamParticipantId,drawDefinition,modifiedLineUp,participantId,collectionId,tieFormat});if(null==result?void 0:result.error)return result}if(dualMatchUpSide.lineUp=modifiedLineUp,modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUp:dualMatchUp,context:stack,drawDefinition}),deleteParticipantId){const{error}=deleteParticipants({participantIds:[deleteParticipantId],tournamentRecord});error&&console.log("cleanup")}return __spreadProps$w(__spreadValues$_({},SUCCESS),{modifiedLineUp})}function updateLineUp({collectionPosition,teamParticipantId,drawDefinition,modifiedLineUp,participantId,collectionId,tieFormat}){var _a,_b;const templateTeamLineUp=null==(_a=getTeamLineUp({participantId:teamParticipantId,drawDefinition}))?void 0:_a.lineUp,participantCompetitiorProfile=null==(_b=modifiedLineUp||templateTeamLineUp)?void 0:_b.find((teamCompetitor=>(null==teamCompetitor?void 0:teamCompetitor.participantId)===participantId)),newAssignment={collectionId,collectionPosition};if(participantCompetitiorProfile)participantCompetitiorProfile.collectionAssignments.push(newAssignment);else{const teamCompetitor={collectionAssignments:[newAssignment],participantId};modifiedLineUp.push(teamCompetitor)}return updateTeamLineUp({participantId:teamParticipantId,lineUp:modifiedLineUp,drawDefinition,tieFormat})}var __defProp$Z=Object.defineProperty,__defProps$v=Object.defineProperties,__getOwnPropDescs$v=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$Z=Object.getOwnPropertySymbols,__hasOwnProp$Z=Object.prototype.hasOwnProperty,__propIsEnum$Z=Object.prototype.propertyIsEnumerable,__defNormalProp$Z=(obj,key,value)=>key in obj?__defProp$Z(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$Z=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$Z.call(b,prop)&&__defNormalProp$Z(a,prop,b[prop]);if(__getOwnPropSymbols$Z)for(var prop of __getOwnPropSymbols$Z(b))__propIsEnum$Z.call(b,prop)&&__defNormalProp$Z(a,prop,b[prop]);return a},__spreadProps$v=(a,b)=>__defProps$v(a,__getOwnPropDescs$v(b));var __defProp$Y=Object.defineProperty,__getOwnPropSymbols$Y=Object.getOwnPropertySymbols,__hasOwnProp$Y=Object.prototype.hasOwnProperty,__propIsEnum$Y=Object.prototype.propertyIsEnumerable,__defNormalProp$Y=(obj,key,value)=>key in obj?__defProp$Y(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$X=Object.defineProperty,__defProps$u=Object.defineProperties,__getOwnPropDescs$u=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$X=Object.getOwnPropertySymbols,__hasOwnProp$X=Object.prototype.hasOwnProperty,__propIsEnum$X=Object.prototype.propertyIsEnumerable,__defNormalProp$X=(obj,key,value)=>key in obj?__defProp$X(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$W=Object.defineProperty,__getOwnPropSymbols$W=Object.getOwnPropertySymbols,__hasOwnProp$W=Object.prototype.hasOwnProperty,__propIsEnum$W=Object.prototype.propertyIsEnumerable,__defNormalProp$W=(obj,key,value)=>key in obj?__defProp$W(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$W=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$W.call(b,prop)&&__defNormalProp$W(a,prop,b[prop]);if(__getOwnPropSymbols$W)for(var prop of __getOwnPropSymbols$W(b))__propIsEnum$W.call(b,prop)&&__defNormalProp$W(a,prop,b[prop]);return a};function checkValidEntries({event,participants,ignoreGender}){if(!participants)return{error:MISSING_PARTICIPANTS};if(!Array.isArray(participants))return{error:INVALID_VALUES};if(!event)return{error:MISSING_EVENT};const{eventType,gender:eventGender}=event,participantType=eventType===SINGLES$1?INDIVIDUAL:eventType===DOUBLES$1?PAIR:TEAM$2,entryStatusMap=Object.assign({},...(event.entries||[]).map((entry=>({[entry.participantId]:entry.entryStatus})))),enteredParticipantIds=Object.keys(entryStatusMap),invalidEntries=participants.filter((participant=>enteredParticipantIds.includes(participant.participantId))).filter((participant=>{const entryStatus=entryStatusMap[participant.participantId],ungroupedParticipant=[DOUBLES$1,TEAM$2].includes(eventType)&&participant.participantType===INDIVIDUAL&&(isUngrouped(entryStatus)||entryStatus===WITHDRAWN),mismatch=participant.participantType!==participantType&&!ungroupedParticipant,wrongGender=!ignoreGender&&eventType===INDIVIDUAL&&[MALE,FEMALE].includes(eventGender)&&participant.sex!==eventGender;return mismatch||wrongGender}));if(invalidEntries.length){const invalidParticipantIds=invalidEntries.map((participant=>participant.participantId));return{error:INVALID_ENTRIES,invalidParticipantIds}}return __spreadValues$W({},SUCCESS)}var __defProp$V=Object.defineProperty,__defProps$t=Object.defineProperties,__getOwnPropDescs$t=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$V=Object.getOwnPropertySymbols,__hasOwnProp$V=Object.prototype.hasOwnProperty,__propIsEnum$V=Object.prototype.propertyIsEnumerable,__defNormalProp$V=(obj,key,value)=>key in obj?__defProp$V(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$V=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$V.call(b,prop)&&__defNormalProp$V(a,prop,b[prop]);if(__getOwnPropSymbols$V)for(var prop of __getOwnPropSymbols$V(b))__propIsEnum$V.call(b,prop)&&__defNormalProp$V(a,prop,b[prop]);return a},__spreadProps$t=(a,b)=>__defProps$t(a,__getOwnPropDescs$t(b));var __defProp$U=Object.defineProperty,__getOwnPropSymbols$U=Object.getOwnPropertySymbols,__hasOwnProp$U=Object.prototype.hasOwnProperty,__propIsEnum$U=Object.prototype.propertyIsEnumerable,__defNormalProp$U=(obj,key,value)=>key in obj?__defProp$U(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$T=Object.defineProperty,__getOwnPropSymbols$T=Object.getOwnPropertySymbols,__hasOwnProp$T=Object.prototype.hasOwnProperty,__propIsEnum$T=Object.prototype.propertyIsEnumerable,__defNormalProp$T=(obj,key,value)=>key in obj?__defProp$T(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$T=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$T.call(b,prop)&&__defNormalProp$T(a,prop,b[prop]);if(__getOwnPropSymbols$T)for(var prop of __getOwnPropSymbols$T(b))__propIsEnum$T.call(b,prop)&&__defNormalProp$T(a,prop,b[prop]);return a};const namedFormats={STANDARD:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},COLLEGE_D3:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_D3",valueGoal:5},COLLEGE_DEFAULT:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:"SET1-S:6/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_DEFAULT",valueGoal:4},COLLEGE_JUCO:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_JUCO",valueGoal:5},LAVER_CUP:LAVER_CUP_TIE_FORMAT,DOMINANT_DUO:DOMINANT_DUO_TIE_FORMAT,DOMINANT_DUO_MIXED:DOMINANT_DUO_MIXED_TIE_FORMAT,TEAM_DOUBLES_3_AGGREGATION:TEAM_AGGREGATION_TIE_FORMAT,USTA_BREWER_CUP:USTA_BREWER_CUP_TIE_FORMAT,USTA_OZAKI_CUP:USTA_OZAKI_CUP_TIE_FORMAT,USTA_COLLEGE:USTA_COLLEGE_TIE_FORMAT,USTA_GOLD_TEAM_CHALLENGE:USTA_GOLD_TEAM_CHALLENGE_FORMAT,USTA_INTERSECTIONAL:USTA_INTERSECTIONAL_TIE_FORMAT,USTA_LEVEL_1:USTA_LEVEL_1_TIE_FORMAT,USTA_SECTION_BATTLE:USTA_SECTION_BATTLE_TIE_FORMAT,USTA_SOUTHERN_LEVEL_5:USTA_SOUTHERN_LEVEL_5_TIE_FORMAT,USTA_WTT_ITT:USTA_WTT_ITT_TIE_FORMAT,USTA_TOC:USTA_TOC_TIE_FORMAT,USTA_ZONAL:USTA_ZONAL_TIE_FORMAT},tieFormatDefaults=({hydrateCollections,namedFormat,event={},uuids=[]}={})=>{let tieFormat;Object.keys(namedFormats).includes(namedFormat)||(namedFormat="STANDARD"),Array.isArray(uuids)||(uuids=[]);const{category,gender}=event,template=makeDeepCopy(namedFormats[namedFormat],!1,!0);return template.hydrate?(tieFormat={winCriteria:{valueGoal:template.valueGoal},collectionDefinitions:[__spreadValues$T({collectionId:(null==uuids?void 0:uuids.pop())||UUID(),collectionName:"Doubles",matchUpType:DOUBLES$1,matchUpFormat:"SET3-S:6/TB7-F:TB10"},template.doubles),__spreadValues$T({collectionId:(null==uuids?void 0:uuids.pop())||UUID(),collectionName:"Singles",matchUpType:SINGLES$1,matchUpFormat:"SET3-S:6/TB7"},template.singles)]},template.tieFormatName&&(tieFormat.tieFormatName=template.tieFormatName)):(template.collectionDefinitions.forEach((collectionDefinition=>collectionDefinition.collectionId=UUID())),tieFormat=template),hydrateCollections&&tieFormat.collectionDefinitions.forEach((collectionDefinition=>{category&&!collectionDefinition.category&&(collectionDefinition.category=category),gender&&!collectionDefinition.gender&&(collectionDefinition.gender=gender)})),tieFormat};var __defProp$S=Object.defineProperty,__defProps$s=Object.defineProperties,__getOwnPropDescs$s=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$S=Object.getOwnPropertySymbols,__hasOwnProp$S=Object.prototype.hasOwnProperty,__propIsEnum$S=Object.prototype.propertyIsEnumerable,__defNormalProp$S=(obj,key,value)=>key in obj?__defProp$S(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$S=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$S.call(b,prop)&&__defNormalProp$S(a,prop,b[prop]);if(__getOwnPropSymbols$S)for(var prop of __getOwnPropSymbols$S(b))__propIsEnum$S.call(b,prop)&&__defNormalProp$S(a,prop,b[prop]);return a},__spreadProps$s=(a,b)=>__defProps$s(a,__getOwnPropDescs$s(b));function addEvent({tournamentRecord,event,suppressNotifications}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(tournamentRecord.events||(tournamentRecord.events=[]),!event)return{error:MISSING_EVENT};const{startDate,endDate}=tournamentRecord,eventRecord=Object.assign({},{startDate,endDate,eventType:SINGLES,entries:[]},event);event.eventType===TEAM$1&&event.tieFormatName&&tieFormats[event.tieFormatName]&&(eventRecord.tieFormat=tieFormatDefaults({namedFormat:event.tieFormatName})),eventRecord.eventId||(eventRecord.eventId=UUID());if(tournamentRecord.events.reduce(((exists,event2)=>exists||event2.eventId===eventRecord.eventId),void 0))return{error:EVENT_EXISTS};if(tournamentRecord.events.push(eventRecord),!suppressNotifications){const{topics}=getTopics();if(topics.includes(ADD_MATCHUPS)){const{matchUps}=allEventMatchUps({event});addMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:event.eventId,matchUps})}for(const drawDefinition of event.drawDefinitions||[])addDrawNotice({drawDefinition})}return __spreadProps$s(__spreadValues$S({},SUCCESS),{event:eventRecord})}var __defProp$R=Object.defineProperty,__getOwnPropSymbols$R=Object.getOwnPropertySymbols,__hasOwnProp$R=Object.prototype.hasOwnProperty,__propIsEnum$R=Object.prototype.propertyIsEnumerable,__defNormalProp$R=(obj,key,value)=>key in obj?__defProp$R(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$R=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$R.call(b,prop)&&__defNormalProp$R(a,prop,b[prop]);if(__getOwnPropSymbols$R)for(var prop of __getOwnPropSymbols$R(b))__propIsEnum$R.call(b,prop)&&__defNormalProp$R(a,prop,b[prop]);return a};var __defProp$Q=Object.defineProperty,__defProps$r=Object.defineProperties,__getOwnPropDescs$r=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$Q=Object.getOwnPropertySymbols,__hasOwnProp$Q=Object.prototype.hasOwnProperty,__propIsEnum$Q=Object.prototype.propertyIsEnumerable,__defNormalProp$Q=(obj,key,value)=>key in obj?__defProp$Q(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$Q=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$Q.call(b,prop)&&__defNormalProp$Q(a,prop,b[prop]);if(__getOwnPropSymbols$Q)for(var prop of __getOwnPropSymbols$Q(b))__propIsEnum$Q.call(b,prop)&&__defNormalProp$Q(a,prop,b[prop]);return a};function promoteAlternates({tournamentRecord,drawDefinition,participantIds,stageSequence,stage=MAIN,eventId,event}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(participantIds))return{error:INVALID_VALUES,participantIds};if(!event)return{error:MISSING_EVENT};if(event){const result=promoteWithinElement({element:event,participantIds,stageSequence,stage});if(result.error)return result}if(drawDefinition){const result=promoteWithinElement({element:drawDefinition,participantIds,stageSequence,stage});if(result.error)return eventId?decorateResult({context:{drawPromotionError:result.error,drawId:drawDefinition.drawId},result:__spreadValues$Q({},SUCCESS),stack:"promoteAlternates"}):result}return __spreadValues$Q({},SUCCESS)}function promoteWithinElement({participantIds,stageSequence,element,stage}){const alternates=(element.entries||[]).filter((entry=>entry.entryStatus===ALTERNATE)),targetedEntries=(element.entries||[]).filter((entry=>participantIds.includes(entry.participantId))),alternateEntry=alternates.reduce(((participantEntry,entry)=>{const{entryPosition}=entry;return isNaN(entryPosition)?participantEntry:!participantEntry||entryPosition<participantEntry.entryPosition?entry:participantEntry}),void 0),participantEntries=targetedEntries.length?targetedEntries:[alternateEntry].filter(Boolean);if(!(null==participantEntries?void 0:participantEntries.length))return{error:PARTICIPANT_ENTRY_NOT_FOUND};const invalidEntryStatus=participantEntries.filter((({entryStatus})=>entryStatus!==ALTERNATE));if(invalidEntryStatus.length)return{error:INVALID_ENTRY_STATUS,invalidEntryStatus};const invalidStage=participantEntries.filter((({entryStage})=>entryStage&&entryStage!==stage));if(invalidStage.length)return{error:PARTICIPANT_NOT_ENTERED_IN_STAGE,invalidStage};const invalidStageSequence=stageSequence&&participantEntries.filter((entry=>entry.stageSequence!==stageSequence));if(null==invalidStageSequence?void 0:invalidStageSequence.length)return{error:PARTICIPANT_NOT_FOUND_IN_STAGE,invalidStageSequence};for(const participantEntry of participantEntries){participantEntry.entryStatus=DIRECT_ACCEPTANCE;const entryPosition=null==participantEntry?void 0:participantEntry.entryPosition;isNaN(entryPosition)||element.entries.forEach((entry=>{entry.entryStatus===ALTERNATE&&entry.entryPosition>entryPosition&&(entry.entryPosition=entry.entryPosition-1)}));let maxEntryPosition=Math.max(...element.entries.filter((entry=>entry.entryStatus===DIRECT_ACCEPTANCE&&!isNaN(entry.entryPosition))).map((({entryPosition:entryPosition2})=>parseInt(entryPosition2||0))),0);participantEntry.entryPosition=maxEntryPosition||0}return __spreadValues$Q({},SUCCESS)}function getAvailablePlayoffProfiles({drawDefinition,structureId}){return getAvailablePlayoffProfiles$1({drawDefinition,structureId})}var __defProp$P=Object.defineProperty,__defProps$q=Object.defineProperties,__getOwnPropDescs$q=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$P=Object.getOwnPropertySymbols,__hasOwnProp$P=Object.prototype.hasOwnProperty,__propIsEnum$P=Object.prototype.propertyIsEnumerable,__defNormalProp$P=(obj,key,value)=>key in obj?__defProp$P(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$P=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$P.call(b,prop)&&__defNormalProp$P(a,prop,b[prop]);if(__getOwnPropSymbols$P)for(var prop of __getOwnPropSymbols$P(b))__propIsEnum$P.call(b,prop)&&__defNormalProp$P(a,prop,b[prop]);return a},__spreadProps$q=(a,b)=>__defProps$q(a,__getOwnPropDescs$q(b));var __defProp$O=Object.defineProperty,__getOwnPropSymbols$O=Object.getOwnPropertySymbols,__hasOwnProp$O=Object.prototype.hasOwnProperty,__propIsEnum$O=Object.prototype.propertyIsEnumerable,__defNormalProp$O=(obj,key,value)=>key in obj?__defProp$O(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$N=Object.defineProperty,__defProps$p=Object.defineProperties,__getOwnPropDescs$p=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$N=Object.getOwnPropertySymbols,__hasOwnProp$N=Object.prototype.hasOwnProperty,__propIsEnum$N=Object.prototype.propertyIsEnumerable,__defNormalProp$N=(obj,key,value)=>key in obj?__defProp$N(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$N=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$N.call(b,prop)&&__defNormalProp$N(a,prop,b[prop]);if(__getOwnPropSymbols$N)for(var prop of __getOwnPropSymbols$N(b))__propIsEnum$N.call(b,prop)&&__defNormalProp$N(a,prop,b[prop]);return a},__spreadProps$p=(a,b)=>__defProps$p(a,__getOwnPropDescs$p(b));var __defProp$M=Object.defineProperty,__getOwnPropSymbols$M=Object.getOwnPropertySymbols,__hasOwnProp$M=Object.prototype.hasOwnProperty,__propIsEnum$M=Object.prototype.propertyIsEnumerable,__defNormalProp$M=(obj,key,value)=>key in obj?__defProp$M(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$M=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$M.call(b,prop)&&__defNormalProp$M(a,prop,b[prop]);if(__getOwnPropSymbols$M)for(var prop of __getOwnPropSymbols$M(b))__propIsEnum$M.call(b,prop)&&__defNormalProp$M(a,prop,b[prop]);return a};function setEntryPosition({tournamentRecord,drawDefinition,participantId,entryPosition,skipRefresh,event}){return tournamentRecord?participantId?void 0===entryPosition||Number.isSafeInteger(entryPosition)?(((null==event?void 0:event.entries)||[]).forEach((entry=>{entry.participantId===participantId&&(entry.entryPosition=entryPosition)})),((null==drawDefinition?void 0:drawDefinition.entries)||[]).forEach((entry=>{entry.participantId===participantId&&(entry.entryPosition=entryPosition)})),skipRefresh||((null==event?void 0:event.entries)&&(event.entries=refreshEntryPositions({entries:event.entries})),(null==drawDefinition?void 0:drawDefinition.entries)&&(drawDefinition.entries=refreshEntryPositions({entries:drawDefinition.entries}))),__spreadValues$M({},SUCCESS)):{error:INVALID_VALUES,entryPosition}:decorateResult({result:{error:MISSING_PARTICIPANT_ID},stack:"setEntryPositions"}):{error:MISSING_TOURNAMENT_RECORD}}var __defProp$L=Object.defineProperty,__getOwnPropSymbols$L=Object.getOwnPropertySymbols,__hasOwnProp$L=Object.prototype.hasOwnProperty,__propIsEnum$L=Object.prototype.propertyIsEnumerable,__defNormalProp$L=(obj,key,value)=>key in obj?__defProp$L(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$L=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$L.call(b,prop)&&__defNormalProp$L(a,prop,b[prop]);if(__getOwnPropSymbols$L)for(var prop of __getOwnPropSymbols$L(b))__propIsEnum$L.call(b,prop)&&__defNormalProp$L(a,prop,b[prop]);return a};function removeScaleValues({tournamentRecord,scaleAttributes,drawDefinition,entryStatuses,drawId,event,stage}){var _a;if(!event)return{error:MISSING_EVENT};if(entryStatuses&&!Array.isArray(entryStatuses))return decorateResult({result:{error:INVALID_VALUES},info:mustBeAnArray("entryStatus"),stack:"removeScaleValues"});let entries=event.entries;if(drawId){const{flightProfile}=getFlightProfile({event}),flight=null==(_a=null==flightProfile?void 0:flightProfile.flights)?void 0:_a.find((flight2=>flight2.drawId===drawId));entries=flight?flight.drawEntries:null==drawDefinition?void 0:drawDefinition.entries}return function removeParticipantsScaleItems({tournamentRecord,scaleAttributes,participantIds}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participantIds)return{error:MISSING_PARTICIPANT_IDS};if(!scaleAttributes)return{error:MISSING_VALUE,info:"scaleAttributes required"};const{scaleType,eventType,scaleName}=scaleAttributes,itemType=[SCALE,scaleType,eventType,scaleName].join(".");return null==(_a=tournamentRecord.participants)||_a.forEach((participant=>{participantIds.includes(participant.participantId)&&participant.timeItems&&(participant.timeItems=participant.timeItems.filter((timeItem=>timeItem&&(null==timeItem?void 0:timeItem.itemType)!==itemType)))})),__spreadValues$L({},SUCCESS)}({tournamentRecord,scaleAttributes,participantIds:(entries||[]).filter((entry=>(!stage||!entry.entryStage||entry.entryStage===stage)&&(!entryStatuses||entryStatuses.includes(entry.entryStatus)))).map(getParticipantId)})}function getParticipantScaleItem({tournamentRecord,scaleAttributes,participantId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participantId)return{error:MISSING_PARTICIPANT_ID};const{participant}=findTournamentParticipant({tournamentRecord,participantId});return participant?participantScaleItem({participant,scaleAttributes}):{error:PARTICIPANT_NOT_FOUND}}var __defProp$K=Object.defineProperty,__getOwnPropSymbols$K=Object.getOwnPropertySymbols,__hasOwnProp$K=Object.prototype.hasOwnProperty,__propIsEnum$K=Object.prototype.propertyIsEnumerable,__defNormalProp$K=(obj,key,value)=>key in obj?__defProp$K(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$K=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$K.call(b,prop)&&__defNormalProp$K(a,prop,b[prop]);if(__getOwnPropSymbols$K)for(var prop of __getOwnPropSymbols$K(b))__propIsEnum$K.call(b,prop)&&__defNormalProp$K(a,prop,b[prop]);return a};function getScaledEntries({sortDescending=!1,tournamentRecord,scaleAttributes,scaleSortMethod,stageSequence,entries,event,stage}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};return{scaledEntries:(entries=entries||(null==event?void 0:event.entries)||[]).filter((entry=>(!stage||!entry.entryStage||entry.entryStage===stage)&&(!stageSequence||!entry.entryStageSequence||entry.entryStageSequence===stageSequence)&&STRUCTURE_SELECTED_STATUSES.includes(entry.entryStatus))).map((entry=>{const{participantId}=entry,{scaleItem}=getParticipantScaleItem({tournamentRecord,scaleAttributes,participantId});return __spreadValues$K(__spreadValues$K({},entry),scaleItem)})).filter((scaledEntry=>{const scaleValue=scaledEntry.scaleValue;return!!(scaleSortMethod||!isNaN(scaleValue)&&parseFloat(scaleValue))&&scaleValue})).sort(scaleSortMethod||function defaultScaleValueSort(a,b){return sortDescending?scaleItemValue(b)-scaleItemValue(a):scaleItemValue(a)-scaleItemValue(b)})};function scaleItemValue(scaleItem){return parseFloat(scaleItem.scaleValue||(sortDescending?-1:1e5))}}var __defProp$J=Object.defineProperty,__getOwnPropSymbols$J=Object.getOwnPropertySymbols,__hasOwnProp$J=Object.prototype.hasOwnProperty,__propIsEnum$J=Object.prototype.propertyIsEnumerable,__defNormalProp$J=(obj,key,value)=>key in obj?__defProp$J(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$I=Object.defineProperty,__getOwnPropSymbols$I=Object.getOwnPropertySymbols,__hasOwnProp$I=Object.prototype.hasOwnProperty,__propIsEnum$I=Object.prototype.propertyIsEnumerable,__defNormalProp$I=(obj,key,value)=>key in obj?__defProp$I(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$H=Object.defineProperty,__getOwnPropSymbols$H=Object.getOwnPropertySymbols,__hasOwnProp$H=Object.prototype.hasOwnProperty,__propIsEnum$H=Object.prototype.propertyIsEnumerable,__defNormalProp$H=(obj,key,value)=>key in obj?__defProp$H(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$H=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$H.call(b,prop)&&__defNormalProp$H(a,prop,b[prop]);if(__getOwnPropSymbols$H)for(var prop of __getOwnPropSymbols$H(b))__propIsEnum$H.call(b,prop)&&__defNormalProp$H(a,prop,b[prop]);return a};function updateDrawIdsOrder({event,orderedDrawIdsMap}){var _a,_b;if("object"!=typeof event)return{error:MISSING_EVENT};if(!orderedDrawIdsMap)return{error:MISSING_VALUE,info:"Missing drawIdsOrderMap"};if("object"!=typeof orderedDrawIdsMap)return{error:INVALID_VALUES,info:"orderedDrawIdsMap must be an object"};const drawOrders=Object.values(orderedDrawIdsMap);if(!drawOrders.every((drawOrder=>!isNaN(drawOrder))))return{error:INVALID_VALUES,info:"drawOrder must be numeric"};if(unique(drawOrders).length!==drawOrders.length)return{error:INVALID_VALUES,info:"drawOrder values must be unique"};if(null==(_a=event.drawDefinitions)?void 0:_a.length){const drawIds=(event.drawDefinitions||[]).map((({drawId})=>drawId)),orderedDrawIds=Object.keys(orderedDrawIdsMap);if((null==orderedDrawIds?void 0:orderedDrawIds.length)&&intersection(drawIds,orderedDrawIds).length!==drawIds.length)return{error:INVALID_VALUES,info:"Missing drawIds"};event.drawDefinitions.forEach((drawDefinition=>{drawDefinition.drawOrder=orderedDrawIdsMap[drawDefinition.drawId]}))}const{flightProfile}=getFlightProfile({event});return null==(_b=null==flightProfile?void 0:flightProfile.flights)||_b.forEach((flight=>{flight.flightNumber=orderedDrawIdsMap[flight.drawId]})),__spreadValues$H({},SUCCESS)}var __defProp$G=Object.defineProperty,__getOwnPropSymbols$G=Object.getOwnPropertySymbols,__hasOwnProp$G=Object.prototype.hasOwnProperty,__propIsEnum$G=Object.prototype.propertyIsEnumerable,__defNormalProp$G=(obj,key,value)=>key in obj?__defProp$G(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$G=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$G.call(b,prop)&&__defNormalProp$G(a,prop,b[prop]);if(__getOwnPropSymbols$G)for(var prop of __getOwnPropSymbols$G(b))__propIsEnum$G.call(b,prop)&&__defNormalProp$G(a,prop,b[prop]);return a};function refreshEventDrawOrder({tournamentRecord,event}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};const{flightProfile}=getFlightProfile({event}),orderedDrawIdsMap=(null==flightProfile?void 0:flightProfile.flights)?Object.assign({},...flightProfile.flights.sort(((a,b)=>a.flightNumber-b.flightNumber)).map(((flight,i)=>({[flight.drawId]:i+1})))):(null==(_a=event.drawDefinitions)?void 0:_a.length)?Object.assign({},...event.drawDefinitions.sort(((a,b)=>a.drawOrder-b.drawOrder)).map(((drawDefinition,i)=>({[drawDefinition.drawId]:i+1})))):void 0;return orderedDrawIdsMap?updateDrawIdsOrder({event,orderedDrawIdsMap}):__spreadValues$G({},SUCCESS)}var __defProp$F=Object.defineProperty,__defProps$o=Object.defineProperties,__getOwnPropDescs$o=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$F=Object.getOwnPropertySymbols,__hasOwnProp$F=Object.prototype.hasOwnProperty,__propIsEnum$F=Object.prototype.propertyIsEnumerable,__defNormalProp$F=(obj,key,value)=>key in obj?__defProp$F(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$F=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$F.call(b,prop)&&__defNormalProp$F(a,prop,b[prop]);if(__getOwnPropSymbols$F)for(var prop of __getOwnPropSymbols$F(b))__propIsEnum$F.call(b,prop)&&__defNormalProp$F(a,prop,b[prop]);return a};var __defProp$E=Object.defineProperty,__getOwnPropSymbols$E=Object.getOwnPropertySymbols,__hasOwnProp$E=Object.prototype.hasOwnProperty,__propIsEnum$E=Object.prototype.propertyIsEnumerable,__defNormalProp$E=(obj,key,value)=>key in obj?__defProp$E(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$E=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$E.call(b,prop)&&__defNormalProp$E(a,prop,b[prop]);if(__getOwnPropSymbols$E)for(var prop of __getOwnPropSymbols$E(b))__propIsEnum$E.call(b,prop)&&__defNormalProp$E(a,prop,b[prop]);return a};function attachFlightProfile({deleteExisting,event,flightProfile}){var _a;const stack="attachFlightProfile";if(!flightProfile)return decorateResult({result:{error:MISSING_VALUE},stack});if(!event)return decorateResult({result:{error:MISSING_EVENT},stack});const{flightProfile:existingFlightProfile}=getFlightProfile({event});if(existingFlightProfile&&attachFlightProfile&&!deleteExisting)return decorateResult({result:{error:EXISTING_PROFILE},stack});if(null==(_a=event.drawDefinitions)?void 0:_a.length)return decorateResult({result:{error:EXISTING_DRAW_DEFINITIONS},stack});return addEventExtension$1({event,extension:{name:FLIGHT_PROFILE,value:flightProfile}}),__spreadValues$E({flightProfile:makeDeepCopy(flightProfile,!1,!0)},SUCCESS)}var __defProp$D=Object.defineProperty,__getOwnPropSymbols$D=Object.getOwnPropertySymbols,__hasOwnProp$D=Object.prototype.hasOwnProperty,__propIsEnum$D=Object.prototype.propertyIsEnumerable,__defNormalProp$D=(obj,key,value)=>key in obj?__defProp$D(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$D=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$D.call(b,prop)&&__defNormalProp$D(a,prop,b[prop]);if(__getOwnPropSymbols$D)for(var prop of __getOwnPropSymbols$D(b))__propIsEnum$D.call(b,prop)&&__defNormalProp$D(a,prop,b[prop]);return a};var __defProp$C=Object.defineProperty,__getOwnPropSymbols$C=Object.getOwnPropertySymbols,__hasOwnProp$C=Object.prototype.hasOwnProperty,__propIsEnum$C=Object.prototype.propertyIsEnumerable,__defNormalProp$C=(obj,key,value)=>key in obj?__defProp$C(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$B=Object.defineProperty,__getOwnPropSymbols$B=Object.getOwnPropertySymbols,__hasOwnProp$B=Object.prototype.hasOwnProperty,__propIsEnum$B=Object.prototype.propertyIsEnumerable,__defNormalProp$B=(obj,key,value)=>key in obj?__defProp$B(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$A=Object.defineProperty,__defProps$n=Object.defineProperties,__getOwnPropDescs$n=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$A=Object.getOwnPropertySymbols,__hasOwnProp$A=Object.prototype.hasOwnProperty,__propIsEnum$A=Object.prototype.propertyIsEnumerable,__defNormalProp$A=(obj,key,value)=>key in obj?__defProp$A(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const ASCENDING="ASC",DESCENDING="DESC";var __defProp$z=Object.defineProperty,__defProps$m=Object.defineProperties,__getOwnPropDescs$m=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$z=Object.getOwnPropertySymbols,__hasOwnProp$z=Object.prototype.hasOwnProperty,__propIsEnum$z=Object.prototype.propertyIsEnumerable,__defNormalProp$z=(obj,key,value)=>key in obj?__defProp$z(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$z=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$z.call(b,prop)&&__defNormalProp$z(a,prop,b[prop]);if(__getOwnPropSymbols$z)for(var prop of __getOwnPropSymbols$z(b))__propIsEnum$z.call(b,prop)&&__defNormalProp$z(a,prop,b[prop]);return a},__spreadProps$m=(a,b)=>__defProps$m(a,__getOwnPropDescs$m(b));function generateLineUps({useDefaultEventRanking,tournamentRecord,drawDefinition,scaleAccessor,singlesOnly,tieFormat,attach,event}){var _a,_b;if((null==event?void 0:event.eventType)!==TEAM_EVENT)return{error:INVALID_EVENT_TYPE};if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!tieFormat&&!drawDefinition)return{error:DRAW_DEFINITION_NOT_FOUND};if(validateTieFormat({tieFormat:tieFormat=tieFormat||(null==drawDefinition?void 0:drawDefinition.tieFormat)||event.tieFormat}).error)return{error:INVALID_TIE_FORMAT};if("object"!=typeof scaleAccessor&&!useDefaultEventRanking)return{error:INVALID_VALUES,context:{scaleAccessor}};const lineUps={},participantIds=((null==drawDefinition?void 0:drawDefinition.entries)||event.entries).filter((entry=>(null==entry?void 0:entry.entryStatus)===DIRECT_ACCEPTANCE)).map(getParticipantId),{participants=[]}=getParticipants$1({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord}),teamParticipants=participants.filter((({participantId})=>participantIds.includes(participantId))),defaultScaleName=(null==(_a=null==event?void 0:event.category)?void 0:_a.categoryName)||(null==(_b=null==event?void 0:event.category)?void 0:_b.ageCategoryCode),{scaleName=defaultScaleName,scaleType=RANKING$1,sortOrder,accessor}=scaleAccessor||{},formattedScaleType=scaleType===RANKING$1?"rankings":"ratings";const getScaleValue=(individualParticipant,matchUpType)=>{var _a2,_b2,_c;let matchUpTypeScales=null==(_a2=individualParticipant[formattedScaleType])?void 0:_a2[matchUpType];if(!matchUpTypeScales&&useDefaultEventRanking&&(matchUpTypeScales=null==(_b2=individualParticipant[formattedScaleType])?void 0:_b2[SINGLES_MATCHUP]),Array.isArray(matchUpTypeScales)){const scaleValue=null==(_c=matchUpTypeScales.find((scale=>scale.scaleName===scaleName)))?void 0:_c.scaleValue;if(isNumeric(scaleValue))return scaleValue;if(accessor&&"object"==typeof scaleValue)return scaleValue[accessor]}return 0},sortMethod=(a,b,matchUpType)=>{const y=sortOrder===DESCENDING?a:b;return getScaleValue(sortOrder===DESCENDING?b:a,matchUpType)-getScaleValue(y,matchUpType)},singlesScaleSort=(a,b)=>sortMethod(a,b,SINGLES_MATCHUP),doublesScaleSort=(a,b)=>sortMethod(a,b,DOUBLES_MATCHUP),participantIdPairs=[],collectionDefinitions=tieFormat.collectionDefinitions||[];for(const teamParticipant of teamParticipants){const singlesSort=teamParticipant.individualParticipants.sort(singlesScaleSort),doublesSort=singlesOnly?singlesSort:teamParticipant.individualParticipants.sort(doublesScaleSort),participantAssignments={};for(const collectionDefinition of collectionDefinitions){const collectionParticipantIds=[],{collectionId,matchUpCount,matchUpType,gender}=collectionDefinition,singlesMatchUp=matchUpType===SINGLES_MATCHUP;generateRange(0,matchUpCount).forEach((i=>{const typeSort=singlesMatchUp?singlesSort:doublesSort,collectionPosition=i+1,participantIds2=[];generateRange(0,singlesMatchUp?1:2).forEach((i2=>{const nextParticipantId=typeSort.find((participant=>{const targetGender=[MALE,FEMALE].includes(gender)&&gender||gender===MIXED&&[MALE,FEMALE][i2];return!(targetGender&&targetGender!==participant.person.sex||collectionParticipantIds.includes(participant.participantId))})).participantId;nextParticipantId&&(participantIds2.push(nextParticipantId),collectionParticipantIds.push(nextParticipantId),participantAssignments[nextParticipantId]||(participantAssignments[nextParticipantId]=[]),participantAssignments[nextParticipantId].push({collectionPosition,collectionId}))})),singlesMatchUp||participantIdPairs.push(participantIds2)}))}const lineUp=Object.keys(participantAssignments).map((participantId=>({collectionAssignments:participantAssignments[participantId],participantId})));lineUps[teamParticipant.participantId]=lineUp}const participantsToAdd=[];for(const pairParticipantIds of participantIdPairs){const{participant:existingPairParticipant}=getPairedParticipant({tournamentParticipants:participants,participantIds:pairParticipantIds});if(!existingPairParticipant){const newPairParticipant={individualParticipantIds:pairParticipantIds,participantRole:COMPETITOR,participantType:PAIR};participantsToAdd.push(newPairParticipant)}}if(attach){for(;participantsToAdd.length;)addParticipant$1({participant:participantsToAdd.pop(),tournamentRecord});addExtension$1({element:drawDefinition,extension:{name:LINEUPS,value:lineUps}})}return __spreadProps$m(__spreadValues$z({},SUCCESS),{lineUps,participantsToAdd})}var __defProp$y=Object.defineProperty,__defProps$l=Object.defineProperties,__getOwnPropDescs$l=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$y=Object.getOwnPropertySymbols,__hasOwnProp$y=Object.prototype.hasOwnProperty,__propIsEnum$y=Object.prototype.propertyIsEnumerable,__defNormalProp$y=(obj,key,value)=>key in obj?__defProp$y(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$y=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$y.call(b,prop)&&__defNormalProp$y(a,prop,b[prop]);if(__getOwnPropSymbols$y)for(var prop of __getOwnPropSymbols$y(b))__propIsEnum$y.call(b,prop)&&__defNormalProp$y(a,prop,b[prop]);return a};var __defProp$x=Object.defineProperty,__getOwnPropSymbols$x=Object.getOwnPropertySymbols,__hasOwnProp$x=Object.prototype.hasOwnProperty,__propIsEnum$x=Object.prototype.propertyIsEnumerable,__defNormalProp$x=(obj,key,value)=>key in obj?__defProp$x(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function drawMatic(params){var _a;const tournamentParticipants=null==(_a=params.tournamentRecord)?void 0:_a.participants;return Object.assign(params,{tournamentParticipants}),drawMatic$1(params)}var __defProp$w=Object.defineProperty,__defProps$k=Object.defineProperties,__getOwnPropDescs$k=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$w=Object.getOwnPropertySymbols,__hasOwnProp$w=Object.prototype.hasOwnProperty,__propIsEnum$w=Object.prototype.propertyIsEnumerable,__defNormalProp$w=(obj,key,value)=>key in obj?__defProp$w(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$w=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$w.call(b,prop)&&__defNormalProp$w(a,prop,b[prop]);if(__getOwnPropSymbols$w)for(var prop of __getOwnPropSymbols$w(b))__propIsEnum$w.call(b,prop)&&__defNormalProp$w(a,prop,b[prop]);return a},__spreadProps$k=(a,b)=>__defProps$k(a,__getOwnPropDescs$k(b));function addFlight({qualifyingPositions,drawEntries=[],matchUpValue,drawName,drawId,event,stage}){var _a,_b,_c;const stack="addFlight";if(!event)return decorateResult({result:{error:MISSING_EVENT},stack});if(!drawName)return decorateResult({result:{error:MISSING_VALUE},stack});if(null==drawEntries?void 0:drawEntries.length){const enteredParticipantIds=getParticipantIds(event.entries||[]),flightParticipantIds=getParticipantIds(drawEntries);if(intersection(flightParticipantIds,enteredParticipantIds).length!==flightParticipantIds.length)return decorateResult({result:{error:INVALID_VALUES},stack})}const flightProfile=null==(_a=getFlightProfile({event}))?void 0:_a.flightProfile,flightNumbers=(null==(_c=null==(_b=null==flightProfile?void 0:flightProfile.flights)?void 0:_b.map((({flightNumber:flightNumber2})=>!isNaN(flightNumber2)&&parseInt(flightNumber2))))?void 0:_c.filter(Boolean))||[],flightNumber=Math.max(0,...flightNumbers)+1,flight={drawId:drawId||UUID(),flightNumber,matchUpValue,drawEntries,drawName};stage&&(flight.stage=stage),qualifyingPositions&&(flight.qualifyingPositions=qualifyingPositions);if(((null==flightProfile?void 0:flightProfile.flights)||[]).find((({drawId:drawId2})=>drawId2===flight.drawId)))return decorateResult({result:{error:EXISTING_FLIGHT},stack});const flights=((null==flightProfile?void 0:flightProfile.flights)||[]).concat(flight);return addEventExtension$1({event,extension:{name:FLIGHT_PROFILE,value:__spreadProps$k(__spreadValues$w({},flightProfile||{}),{flights})}})}var __defProp$v=Object.defineProperty,__defProps$j=Object.defineProperties,__getOwnPropDescs$j=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$v=Object.getOwnPropertySymbols,__hasOwnProp$v=Object.prototype.hasOwnProperty,__propIsEnum$v=Object.prototype.propertyIsEnumerable,__defNormalProp$v=(obj,key,value)=>key in obj?__defProp$v(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$v=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$v.call(b,prop)&&__defNormalProp$v(a,prop,b[prop]);if(__getOwnPropSymbols$v)for(var prop of __getOwnPropSymbols$v(b))__propIsEnum$v.call(b,prop)&&__defNormalProp$v(a,prop,b[prop]);return a},__spreadProps$j=(a,b)=>__defProps$j(a,__getOwnPropDescs$j(b));function attachStructures({itemType="attachStructures",matchUpModifications,tournamentRecord,drawDefinition,structures,links}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const result=attachStructures$1({matchUpModifications,tournamentRecord,drawDefinition,structures,links});if(result.error)return result;return addTournamentTimeItem({tournamentRecord,timeItem:{itemValue:{structureIds:null==structures?void 0:structures.map((({structureId})=>structureId)),drawId:drawDefinition.drawId},itemType}}),result}var __defProp$u=Object.defineProperty,__getOwnPropSymbols$u=Object.getOwnPropertySymbols,__hasOwnProp$u=Object.prototype.hasOwnProperty,__propIsEnum$u=Object.prototype.propertyIsEnumerable,__defNormalProp$u=(obj,key,value)=>key in obj?__defProp$u(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$u=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$u.call(b,prop)&&__defNormalProp$u(a,prop,b[prop]);if(__getOwnPropSymbols$u)for(var prop of __getOwnPropSymbols$u(b))__propIsEnum$u.call(b,prop)&&__defNormalProp$u(a,prop,b[prop]);return a};function setEventStartDate({tournamentRecord,event,startDate}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};if(!dateValidation.test(startDate))return{error:INVALID_DATE};const result=getTournamentDates(tournamentRecord);if(result.error)return result;const{tournamentStartDate,tournamentEndDate}=result,newEventStartDate=new Date(extractDate(startDate));if(newEventStartDate<tournamentStartDate||newEventStartDate>tournamentEndDate)return{error:INVALID_DATE};const eventEndDate=event.endDate&&new Date(extractDate(event.endDate));return eventEndDate&&newEventStartDate>eventEndDate&&(event.endDate=startDate),event.startDate=startDate,__spreadValues$u({},SUCCESS)}function setEventEndDate({tournamentRecord,event,endDate}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};if(!dateValidation.test(endDate))return{error:INVALID_DATE};const result=getTournamentDates(tournamentRecord);if(result.error)return result;const{tournamentStartDate,tournamentEndDate}=result,newEventEndDate=new Date(extractDate(endDate));if(newEventEndDate<tournamentStartDate||newEventEndDate>tournamentEndDate)return{error:INVALID_DATE};const eventStartDate=event.startDate&&new Date(extractDate(event.startDate));return eventStartDate&&newEventEndDate<eventStartDate&&(event.startDate=endDate),event.endDate=endDate,__spreadValues$u({},SUCCESS)}function getTournamentDates(tournamentRecord){const{startDate,endDate}=tournamentRecord;return dateValidation.test(startDate)&&dateValidation.test(endDate)?{tournamentStartDate:new Date(extractDate(startDate)),tournamentEndDate:new Date(extractDate(endDate))}:decorateResult({result:{error:INVALID_TOURNAMENT_DATES},context:{startDate,endDate}})}var __defProp$t=Object.defineProperty,__getOwnPropSymbols$t=Object.getOwnPropertySymbols,__hasOwnProp$t=Object.prototype.hasOwnProperty,__propIsEnum$t=Object.prototype.propertyIsEnumerable,__defNormalProp$t=(obj,key,value)=>key in obj?__defProp$t(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$s=Object.defineProperty,__getOwnPropSymbols$s=Object.getOwnPropertySymbols,__hasOwnProp$s=Object.prototype.hasOwnProperty,__propIsEnum$s=Object.prototype.propertyIsEnumerable,__defNormalProp$s=(obj,key,value)=>key in obj?__defProp$s(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$r=Object.defineProperty,__getOwnPropSymbols$r=Object.getOwnPropertySymbols,__hasOwnProp$r=Object.prototype.hasOwnProperty,__propIsEnum$r=Object.prototype.propertyIsEnumerable,__defNormalProp$r=(obj,key,value)=>key in obj?__defProp$r(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __defProp$q=Object.defineProperty,__getOwnPropSymbols$q=Object.getOwnPropertySymbols,__hasOwnProp$q=Object.prototype.hasOwnProperty,__propIsEnum$q=Object.prototype.propertyIsEnumerable,__defNormalProp$q=(obj,key,value)=>key in obj?__defProp$q(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$q=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$q.call(b,prop)&&__defNormalProp$q(a,prop,b[prop]);if(__getOwnPropSymbols$q)for(var prop of __getOwnPropSymbols$q(b))__propIsEnum$q.call(b,prop)&&__defNormalProp$q(a,prop,b[prop]);return a};function prepareStage({preparedStructureIds=[],provisionalPositioning,inContextDrawMatchUps,tournamentRecord,appliedPolicies,qualifyingOnly,drawDefinition,seedingProfile,participants,matchUpsMap,automated,placeByes,drawType,drawSize,entries,event,enforcePolicyLimits=!0,seedAssignmentProfile,seedByRanking=!0,seededParticipants,assignSeedsCount,seedingScaleName,seedsCount,stageSequence=1,roundTarget,stage}){const eventType=null==event?void 0:event.eventType,stageEntries=entries.filter((entry=>{var _a,_b;const entryRoundTarget=null==(_b=null==(_a=findExtension$1({name:ROUND_TARGET,element:entry}))?void 0:_a.extension)?void 0:_b.value;return(!entry.entryStage||entry.entryStage===stage)&&(!stageSequence||!entry.entryStageSequence||entry.entryStageSequence===stageSequence)&&(!roundTarget||!entryRoundTarget||entryRoundTarget===roundTarget)&&DIRECT_ENTRY_STATUSES.includes(entry.entryStatus)}));seededParticipants&&(seedsCount=seededParticipants.length),seedsCount>drawSize&&(seedsCount=drawSize),seedsCount>stageEntries.length&&(seedsCount=stageEntries.length);const{structures}=getDrawStructures({drawDefinition,stageSequence,roundTarget,stage}),multipleStructures=structures.length>1,structure=structures.find((({structureId:structureId2})=>!preparedStructureIds.includes(structureId2))),{structureId}=structure||{},seedBlockInfo=getValidSeedBlocks({provisionalPositioning,appliedPolicies,drawDefinition,structure}),{seedLimit}=initializeStructureSeedAssignments({participantCount:stageEntries.length,enforcePolicyLimits,appliedPolicies,drawDefinition,seedingProfile,structureId,seedsCount});seedLimit&&seedLimit<seedsCount&&(seedsCount=seedLimit);const enteredParticipantIds=entries.map(getParticipantId);if(seededParticipants)seededParticipants.filter((({participantId})=>enteredParticipantIds.includes(participantId))).filter((seededParticipant=>!seededParticipant.seedNumber||seededParticipant.seedNumber<=seededParticipants.length)).sort(((a,b)=>a.seedNumber<b.seedNumber?-1:a.seedNumber<b.seedNumber?1:0)).forEach((seededParticipant=>{const{participantId,seedNumber,seedValue}=seededParticipant;assignSeed({provisionalPositioning,tournamentRecord,drawDefinition,seedingProfile,participantId,seedBlockInfo,structureId,seedNumber,seedValue,event})}));else if(event||seedingScaleName){const{categoryName,ageCategoryCode}=(null==event?void 0:event.category)||{},seedingScaleAttributes={scaleType:SEEDING$1,scaleName:seedingScaleName||categoryName||ageCategoryCode||event.eventId,eventType};let{scaledEntries}=getScaledEntries({scaleAttributes:seedingScaleAttributes,tournamentRecord,stageSequence,entries,stage});if(!(null==scaledEntries?void 0:scaledEntries.length)&&seedByRanking){const rankingScaleAttributes={scaleType:RANKING$1,scaleName:categoryName||ageCategoryCode,eventType};({scaledEntries}=getScaledEntries({scaleAttributes:rankingScaleAttributes,tournamentRecord,stageSequence,entries,stage}))}const scaledEntriesCount=(null==scaledEntries?void 0:scaledEntries.length)||0;scaledEntriesCount<seedsCount&&(seedsCount=scaledEntriesCount),null==scaledEntries||scaledEntries.filter((({participantId})=>enteredParticipantIds.includes(participantId))).slice(0,assignSeedsCount||seedsCount).forEach(((scaledEntry,index)=>{const seedNumber=index+1,{participantId,scaleValue}=scaledEntry,seedValue=(null==seedAssignmentProfile?void 0:seedAssignmentProfile[seedNumber])||scaleValue||seedNumber;assignSeed({provisionalPositioning,tournamentRecord,drawDefinition,seedingProfile,participantId,structureId,seedNumber,seedValue,event})}))}let positionAssignments,positioningReport,conflicts=[];if(!1!==automated&&drawType!==AD_HOC&&(!qualifyingOnly||stage===QUALIFYING)){const seedsOnly="object"==typeof automated&&automated.seedsOnly,result=automatedPositioning$1({inContextDrawMatchUps,multipleStructures,tournamentRecord,appliedPolicies,drawDefinition,seedingProfile,participants,structureId,matchUpsMap,placeByes,seedLimit,seedsOnly,drawType,event});if(conflicts=null==result?void 0:result.conflicts,positionAssignments=null==result?void 0:result.positionAssignments,positioningReport=null==result?void 0:result.positioningReport,result.error)return decorateResult({result,stack:"prepareStage"})}return{positionAssignments,positioningReport,stageEntries,structureId,seedsCount,conflicts}}var __defProp$p=Object.defineProperty,__defProps$i=Object.defineProperties,__getOwnPropDescs$i=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$p=Object.getOwnPropertySymbols,__hasOwnProp$p=Object.prototype.hasOwnProperty,__propIsEnum$p=Object.prototype.propertyIsEnumerable,__defNormalProp$p=(obj,key,value)=>key in obj?__defProp$p(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$p=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$p.call(b,prop)&&__defNormalProp$p(a,prop,b[prop]);if(__getOwnPropSymbols$p)for(var prop of __getOwnPropSymbols$p(b))__propIsEnum$p.call(b,prop)&&__defNormalProp$p(a,prop,b[prop]);return a},__spreadProps$i=(a,b)=>__defProps$i(a,__getOwnPropDescs$i(b));function generateDrawDefinition(params){var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n;const stack="generateDrawDefinition",{drawType=SINGLE_ELIMINATION,considerEventEntries=!0,ignoreAllowedDrawTypes,voluntaryConsolation,hydrateCollections,policyDefinitions,ignoreStageSpace,tournamentRecord,qualifyingOnly,tieFormatName,drawEntries,addToEvent,placeByes,event}=params,{tournamentParticipants:participants}=getTournamentParticipants({tournamentRecord,inContext:!0}),validEntriesResult=event&&participants&&checkValidEntries({event,participants});if(null==validEntriesResult?void 0:validEntriesResult.error)return decorateResult({result:validEntriesResult,stack});const allowedDrawTypes=!ignoreAllowedDrawTypes&&tournamentRecord&&getAllowedDrawTypes({tournamentRecord,categoryType:null==event?void 0:event.categoryType,categoryName:null==event?void 0:event.categoryName});if((null==allowedDrawTypes?void 0:allowedDrawTypes.length)&&!allowedDrawTypes.includes(drawType))return decorateResult({result:{error:INVALID_DRAW_TYPE},stack});const eventEntries=(null==(_a=null==event?void 0:event.entries)?void 0:_a.filter((entry=>[...STRUCTURE_ENTERED_TYPES,QUALIFIER].includes(entry.entryStatus))))||[],consideredEntries=(qualifyingOnly&&[]||drawEntries||(considerEventEntries?eventEntries:[])).filter((({entryStage})=>!entryStage||entryStage===MAIN));let drawSize=!params.drawSize&&consideredEntries.length&&![AD_HOC,DOUBLE_ELIMINATION,FEED_IN$1,ROUND_ROBIN,ROUND_ROBIN_WITH_PLAYOFF].includes(drawType)&&nextPowerOf2(consideredEntries.length)||isConvertableInteger(params.drawSize)&&parseInt(params.drawSize);if(isNaN(drawSize)&&drawType!==AD_HOC)return decorateResult({result:{error:MISSING_DRAW_SIZE},stack});let seedsCount="number"!=typeof params.seedsCount?parseInt(params.seedsCount||0):params.seedsCount||0;const eventType=null==event?void 0:event.eventType,matchUpType=params.matchUpType||eventType,existingDrawDefinition=params.drawId&&(null==(_b=null==event?void 0:event.drawDefinitions)?void 0:_b.find((d=>d.drawId===params.drawId)));let{tieFormat,matchUpFormat}=params;if(tieFormat){const result=validateTieFormat({tieFormat});if(result.error)return decorateResult({result,stack})}if(matchUpType===TEAM$2&&eventType===TEAM$2){const existingMainTieFormat=null==(_d=null==(_c=null==existingDrawDefinition?void 0:existingDrawDefinition.structures)?void 0:_c.find((({stage})=>stage===MAIN)))?void 0:_d.tieFormat;tieFormat=tieFormat||existingMainTieFormat||tieFormatName&&(null==(_e=null==event?void 0:event.tieFormat)?void 0:_e.tieFormatName)===tieFormatName&&event.tieFormat||tieFormatName&&tieFormatDefaults({namedFormat:tieFormatName,hydrateCollections,event})||(null==event?void 0:event.tieFormat)||tieFormatDefaults({event,hydrateCollections}),matchUpFormat=void 0}else matchUpFormat||(tieFormat=void 0,(null==event?void 0:event.matchUpFormat)||(matchUpFormat="SET3-S:6/TB7"));if(params.drawId&&"string"!=typeof params.drawId)return decorateResult({result:{error:INVALID_VALUES},stack});existingDrawDefinition&&drawType!==existingDrawDefinition.drawType&&(existingDrawDefinition.drawType=drawType);let drawDefinition=existingDrawDefinition||newDrawDefinition({drawType,drawId:params.drawId});if(matchUpFormat||tieFormat){if(!(matchUpFormat&&(null==event?void 0:event.matchUpFormat)===matchUpFormat||(null==event?void 0:event.tieFormat)&&tieFormat&&JSON.stringify(event.tieFormat)===JSON.stringify(tieFormat))){if(tieFormat){const result=function checkTieFormat(tieFormat){const result=validateTieFormat({tieFormat,checkCollectionIds:!1});if(result.error)return result;for(const collectionDefinition of tieFormat.collectionDefinitions)collectionDefinition.collectionId||(collectionDefinition.collectionId=UUID());return{tieFormat}}(tieFormat);if(result.error)return decorateResult({result,stack});drawDefinition.tieFormat=result.tieFormat||tieFormat}else{let result=setMatchUpFormat$1({tournamentRecord,drawDefinition,matchUpFormat,tieFormat,event});if(result.error)return{error:result.error,info:"matchUpFormat or tieFormat error"}}matchUpType&&(drawDefinition.matchUpType=matchUpType)}}const{appliedPolicies}=getAppliedPolicies({tournamentRecord,event});if(policyDefinitions){if("object"!=typeof policyDefinitions)return decorateResult({result:{info:"policyDefinitions must be an object",error:INVALID_VALUES}});{const policiesToAttach={};for(const key of Object.keys(policyDefinitions))JSON.stringify(appliedPolicies[key])!==JSON.stringify(policyDefinitions[key])&&(policiesToAttach[key]=policyDefinitions[key]);Object.keys(policiesToAttach).length&&(attachPolicies({drawDefinition,policyDefinitions:policiesToAttach}),Object.assign(appliedPolicies,policiesToAttach))}}appliedPolicies[POLICY_TYPE_SEEDING]||(attachPolicies({drawDefinition,policyDefinitions:POLICY_SEEDING_USTA}),Object.assign(appliedPolicies,POLICY_SEEDING_USTA));let structureId=null==(_g=null==(_f=null==existingDrawDefinition?void 0:existingDrawDefinition.structures)?void 0:_f.find((structure=>structure.stage===MAIN&&1===structure.stageSequence)))?void 0:_g.structureId;const entries=drawEntries||eventEntries,positioningReports=[];let drawTypeResult,conflicts=[];const generateQualifyingPlaceholder=params.qualifyingPlaceholder&&!(null==(_h=params.qualifyingProfiles)?void 0:_h.length)&&!existingDrawDefinition,existingQualifyingStructures=null==existingDrawDefinition?void 0:existingDrawDefinition.structures.filter((structure=>structure.stage===QUALIFYING)),existingQualifyingPlaceholderStructureId=1===(null==existingQualifyingStructures?void 0:existingQualifyingStructures.length)&&!(null==(_i=existingQualifyingStructures[0].matchUps)?void 0:_i.length)&&existingQualifyingStructures[0].structureId;if(existingQualifyingPlaceholderStructureId){const qualifyingProfiles=params.qualifyingProfiles,qualifyingResult=(null==qualifyingProfiles?void 0:qualifyingProfiles.length)&&generateQualifyingStructures({idPrefix:params.idPrefix,isMock:params.isMock,uuids:params.uuids,qualifyingProfiles,appliedPolicies,matchUpType});if(null==qualifyingResult?void 0:qualifyingResult.error)return qualifyingResult;drawDefinition.structures=drawDefinition.structures.filter((({structureId:structureId2})=>structureId2!==existingQualifyingPlaceholderStructureId)),drawDefinition.links=drawDefinition.links.filter((({source})=>source.structureId!==existingQualifyingPlaceholderStructureId));const{qualifiersCount,qualifyingDrawPositionsCount,qualifyingDetails}=qualifyingResult;qualifyingDrawPositionsCount&&((null==qualifyingResult?void 0:qualifyingResult.structures)&&drawDefinition.structures.push(...qualifyingResult.structures),(null==qualifyingResult?void 0:qualifyingResult.links)&&drawDefinition.links.push(...qualifyingResult.links));const mainStructure=drawDefinition.structures.find((({stage,stageSequence})=>stage===MAIN&&1===stageSequence)),{qualifiersCount:existingQualifiersCount}=getQualifiersCount({drawDefinition,stageSequence:1,structureId,stage:MAIN});let result=setStageQualifiersCount({qualifiersCount:Math.max(qualifiersCount||0,existingQualifiersCount||0),drawDefinition,stage:MAIN});if(result.error)return result;if(result=setStageDrawSize({drawSize:qualifyingDrawPositionsCount,stage:QUALIFYING,drawDefinition}),result.error)return result;for(const entry of(drawEntries||[]).filter((({entryStage})=>entryStage===QUALIFYING))){addDrawEntry(__spreadProps$i(__spreadValues$p({},entry),{entryStage:entry.entryStage||MAIN,drawDefinition}))}for(const qualifyingDetail of qualifyingDetails||[]){const{finalQualifyingRoundNumber:qualifyingRoundNumber,finalQualifyingStructureId:qualifyingStructureId,roundTarget:targetEntryRound,finishingPositions,linkType}=qualifyingDetail,link=mainStructure&&(null==(_j=generateQualifyingLink({targetStructureId:mainStructure.structureId,sourceStructureId:qualifyingStructureId,sourceRoundNumber:qualifyingRoundNumber,finishingPositions,targetEntryRound,linkType}))?void 0:_j.link);if(null==link?void 0:link.error)return link;link&&drawDefinition.links.push(link)}drawTypeResult={drawDefinition}}else{if(drawTypeResult=generateDrawTypeAndModifyDrawDefinition$1(__spreadProps$i(__spreadValues$p({},params),{modifyOriginal:!1,tournamentRecord,appliedPolicies,drawDefinition,matchUpFormat,matchUpType,tieFormat,drawSize})),drawTypeResult.error)return decorateResult({result:drawTypeResult,stack});drawDefinition=drawTypeResult.drawDefinition;for(const entry of entries){if(drawEntries&&entry.entryStage&&entry.entryStage!==MAIN)continue;const result=addDrawEntry(__spreadProps$i(__spreadValues$p({},entry),{entryStage:entry.entryStage||MAIN,ignoreStageSpace,drawDefinition}));if(drawEntries&&result.error)return decorateResult({result,stack})}drawType===LUCKY_DRAW&&(seedsCount=0);const structureResult=prepareStage(__spreadProps$i(__spreadValues$p(__spreadValues$p({},drawTypeResult),params),{qualifyingOnly:!drawSize||qualifyingOnly,appliedPolicies,drawDefinition,participants,stage:MAIN,seedsCount,placeByes,drawSize,entries}));if(structureResult.error&&!structureResult.conflicts)return structureResult;(null==(_k=structureResult.positioningReport)?void 0:_k.length)&&positioningReports.push({[MAIN]:structureResult.positioningReport}),structureId=structureResult.structureId,conflicts=structureResult.conflicts}const qualifyingConflicts=[];if(params.qualifyingProfiles){const sequenceSort=(a,b)=>a.stageSequence-b.stageSequence,roundTargetSort=(a,b)=>a.roundTarget-b.roundTarget,preparedStructureIds=[];let roundTarget=1;for(const roundTargetProfile of params.qualifyingProfiles.sort(roundTargetSort)){if(!Array.isArray(roundTargetProfile.structureProfiles))return decorateResult({result:{error:MISSING_VALUE},info:mustBeAnArray("structureProfiles")});roundTarget=roundTargetProfile.roundTarget||roundTarget;let stageSequence=1;const sortedStructureProfiles=(null==(_l=roundTargetProfile.structureProfiles)?void 0:_l.sort(sequenceSort))||[];for(const structureProfile of sortedStructureProfiles){const{qualifyingRoundNumber,qualifyingPositions,seededParticipants,seedingScaleName,seedsCount:seedsCount2=0,seedingProfile,seedByRanking,placeByes:placeByes2,drawSize:drawSize2}=structureProfile,qualifyingStageResult=prepareStage(__spreadProps$i(__spreadValues$p(__spreadValues$p({},drawTypeResult),params),{qualifyingRoundNumber,preparedStructureIds,qualifyingPositions,seededParticipants,stage:QUALIFYING,seedingScaleName,appliedPolicies,drawDefinition,qualifyingOnly,seedingProfile,stageSequence,seedByRanking,participants,roundTarget,seedsCount:seedsCount2,placeByes:placeByes2,drawSize:drawSize2,entries}));if(qualifyingStageResult.error)return qualifyingStageResult;qualifyingStageResult.structureId&&preparedStructureIds.push(qualifyingStageResult.structureId),stageSequence+=1,(null==(_m=qualifyingStageResult.conflicts)?void 0:_m.length)&&qualifyingConflicts.push(...qualifyingStageResult.conflicts),(null==(_n=qualifyingStageResult.positioningReport)?void 0:_n.length)&&positioningReports.push({[QUALIFYING]:qualifyingStageResult.positioningReport})}roundTarget+=1}}else if(generateQualifyingPlaceholder){const qualifyingStructure=structureTemplate({structureName:QUALIFYING,stage:QUALIFYING}),{link}=generateQualifyingLink({sourceStructureId:qualifyingStructure.structureId,sourceRoundNumber:0,targetStructureId:structureId,linkType:POSITION});drawDefinition.structures.push(qualifyingStructure),drawDefinition.links.push(link)}return drawDefinition.drawName=params.drawName||drawType,"object"==typeof voluntaryConsolation&&function addVoluntaryConsolationStructure(params){const{tournamentRecord}=params;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const tournamentParticipants=tournamentRecord.participants;return addVoluntaryConsolationStructure$1(__spreadValues$q({participants:tournamentParticipants},params))}(__spreadProps$i(__spreadValues$p({},voluntaryConsolation),{tournamentRecord,appliedPolicies,drawDefinition,matchUpType})),addToEvent&&addDrawDefinition$1({tournamentRecord,drawDefinition,event}),__spreadProps$i(__spreadValues$p({existingDrawDefinition:!!existingDrawDefinition,qualifyingConflicts,positioningReports,drawDefinition,structureId},SUCCESS),{conflicts})}const eventGovernor={generateQualifyingStructure:function generateQualifyingStructure(params){const{tournamentRecord}=params;return tournamentRecord?generateQualifyingStructure$1(((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$r.call(b,prop)&&__defNormalProp$r(a,prop,b[prop]);if(__getOwnPropSymbols$r)for(var prop of __getOwnPropSymbols$r(b))__propIsEnum$r.call(b,prop)&&__defNormalProp$r(a,prop,b[prop]);return a})({participants:tournamentRecord.participants},params)):{error:MISSING_TOURNAMENT_RECORD}},attachQualifyingStructure:function attachQualifyingStructure({tournamentRecord,drawDefinition,structure,link}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const result=attachQualifyingStructure$1({tournamentRecord,drawDefinition,structure,link});return result.error||addTournamentTimeItem({tournamentRecord,timeItem:{itemType:"attachQualifyingStructures",itemValue:{structureId:structure.structureId,drawId:drawDefinition.drawId}}}),result},attachPlayoffStructures:function attachPlayoffStructures(params){return attachStructures(__spreadProps$j(__spreadValues$v({},params),{itemType:"attachPlayoffStructures"}))},attachStructures,addQualifyingStructure:function addQualifyingStructure(params){const tournamentRecord=params.tournamentRecord;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const result=addQualifyingStructure$1(params);if(result.error)return result;const{qualifyingRoundNumber,qualifyingPositions,targetStructureId,drawDefinition,structureName,matchUpType,drawSize,drawType}=params;return addTournamentTimeItem({tournamentRecord,timeItem:{itemType:"addQualifyingStructures",itemValue:definedAttributes({drawId:drawDefinition.drawId,structureName,targetStructureId,qualifyingPositions,qualifyingRoundNumber,matchUpType,drawSize,drawType})}}),result},disableTieAutoCalc:function disableTieAutoCalc(params){return params.tournamentRecord?disableTieAutoCalc$1(params):{error:MISSING_TOURNAMENT_RECORD}},enableTieAutoCalc:function enableTieAutoCalc(params){return params.tournamentRecord?enableTieAutoCalc$1(params):{error:MISSING_TOURNAMENT_RECORD}},modifyCollectionDefinition,orderCollectionDefinitions,removeCollectionDefinition,addCollectionDefinition,removeCollectionGroup,addCollectionGroup,resetScorecard:function resetScorecard(params){return resetScorecard$1(params)},resetTieFormat,addEvent,deleteEvents:function deleteEvents({tournamentRecord,eventIds}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!tournamentRecord.events)return{error:EVENT_NOT_FOUND};if(!Array.isArray(eventIds))return{error:MISSING_VALUE,info:mustBeAnArray("drawIds")};const auditTrail=[],deletedEventDetails=[];if(tournamentRecord.events=(tournamentRecord.events||[]).filter((event=>{if(eventIds.includes(event.eventId)){const auditData={action:"deleteEvents",payload:{events:[event]}};auditTrail.push(auditData),deletedEventDetails.push({tournamentId:tournamentRecord.tournamentId,eventName:event.eventName,eventType:event.eventType,category:event.category,eventId:event.eventId,gender:event.gender})}return!eventIds.includes(event.eventId)})),checkSchedulingProfile({tournamentRecord}),auditTrail.length){addNotice({topic:AUDIT,payload:auditTrail});addTournamentTimeItem({tournamentRecord,timeItem:{itemType:"deleteEvents",itemValue:deletedEventDetails}})}return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$U.call(b,prop)&&__defNormalProp$U(a,prop,b[prop]);if(__getOwnPropSymbols$U)for(var prop of __getOwnPropSymbols$U(b))__propIsEnum$U.call(b,prop)&&__defNormalProp$U(a,prop,b[prop]);return a})({},SUCCESS)},setEventDates:function setEventDates({tournamentRecord,event,startDate,endDate}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};if(!startDate&&!endDate)return{error:MISSING_VALUE,info:"missing date"};if(startDate&&!dateValidation.test(startDate))return{error:INVALID_DATE};if(endDate&&!dateValidation.test(endDate))return{error:INVALID_DATE};if(startDate&&endDate){if(new Date(extractDate(startDate))>new Date(extractDate(endDate)))return{error:INVALID_VALUES}}if(startDate){const result=setEventStartDate({tournamentRecord,event,startDate});if(result.error)return result}if(endDate){const result=setEventEndDate({tournamentRecord,event,endDate});if(result.error)return result}return __spreadValues$u({},SUCCESS)},setEventStartDate,setEventEndDate,removeSeededParticipant:function removeSeededParticipant({tournamentRecord,drawDefinition,drawPosition}){return tournamentRecord?drawDefinition?isConvertableInteger(drawPosition)?((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$t.call(b,prop)&&__defNormalProp$t(a,prop,b[prop]);if(__getOwnPropSymbols$t)for(var prop of __getOwnPropSymbols$t(b))__propIsEnum$t.call(b,prop)&&__defNormalProp$t(a,prop,b[prop]);return a})({},SUCCESS):{error:INVALID_DRAW_POSITION}:{error:MISSING_DRAW_DEFINITION}:{error:MISSING_TOURNAMENT_RECORD}},removeScaleValues,checkValidEntries,addDrawEntries,removeSeeding:function removeSeeding({tournamentRecord,drawDefinition,entryStatuses,scaleName,drawId,event,stage}){var _a,_b;return tournamentRecord?event?(scaleName=scaleName||(null==(_a=event.category)?void 0:_a.categoryName)||(null==(_b=event.category)?void 0:_b.ageCategoryCode),removeScaleValues({tournamentRecord,scaleAttributes:{eventType:event.eventType,scaleType:SEEDING$1,scaleName},drawDefinition,entryStatuses,drawId,event,stage})):{error:MISSING_EVENT}:{error:MISSING_TOURNAMENT_RECORD}},autoSeeding:function autoSeeding({tournamentRecord,drawDefinition,policyDefinitions,scaleAttributes,scaleName,drawSize,drawId,event,stage,sortDescending,scaleSortMethod}){const result=getEntriesAndSeedsCount({policyDefinitions,drawDefinition,drawSize,drawId,event,stage});if(result.error)return result;const{entries,seedsCount,stageEntries}=result,{scaledEntries}=getScaledEntries({tournamentRecord,scaleAttributes,scaleSortMethod,sortDescending,entries,stage}),{scaleItemsWithParticipantIds}=generateSeedingScaleItems({scaleAttributes,scaledEntries,stageEntries,seedsCount,scaleName});return{scaleItemsWithParticipantIds}},getAvailablePlayoffRounds:getAvailablePlayoffProfiles,getAvailablePlayoffProfiles,deleteDrawDefinitions,addPlayoffStructures:function addPlayoffStructures(params){const tournamentRecord=params.tournamentRecord;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const result=addPlayoffStructures$1(params);if(result.error)return result;const{playoffStructureNameBase,playoffPositions,roundNumbers,structureId}=params;return addTournamentTimeItem({tournamentRecord,timeItem:{itemType:"addPlayoffStructures",itemValue:definedAttributes({playoffStructureNameBase,playoffPositions,roundNumbers,structureId})}}),result},addDrawDefinition:addDrawDefinition$1,removeStructure,modifyDrawName:function modifyDrawName({event,drawId,drawDefinition,drawName}){var _a;if(!drawName||"string"!=typeof drawName)return{error:INVALID_VALUES,drawName};const{flightProfile}=getFlightProfile({event}),flight=null==(_a=null==flightProfile?void 0:flightProfile.flights)?void 0:_a.find((flight2=>flight2.drawId===drawId));if(flight){flight.drawName=drawName;addEventExtension$1({event,extension:{name:FLIGHT_PROFILE,value:(a=__spreadValues$y({},flightProfile),b={flights:flightProfile.flights},__defProps$l(a,__getOwnPropDescs$l(b)))}})}var a,b;return drawDefinition&&(drawDefinition.drawName=drawName,modifyDrawNotice({drawDefinition})),flight||drawDefinition?__spreadValues$y({},SUCCESS):{error:MISSING_DRAW_DEFINITION}},generateAndPopulatePlayoffStructures,generateSeedingScaleItems,setSubOrder,addEventEntries,promoteAlternate:function promoteAlternate(params){const{participantId}=params;return participantId&&"string"!=typeof participantId?{error:INVALID_VALUES,participantId}:promoteAlternates((a=__spreadValues$Q({},params),b={participantIds:[participantId].filter(Boolean)},__defProps$r(a,__getOwnPropDescs$r(b))));var a,b},promoteAlternates,destroyPairEntry,setEntryPosition,setEntryPositions:function setEntryPositions({tournamentRecord,entryPositions,drawDefinition,event}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(entryPositions))return{error:INVALID_VALUES};for(const positioning of entryPositions){const{participantId,entryPosition}=positioning,result=setEntryPosition({skipRefresh:!0,tournamentRecord,drawDefinition,participantId,entryPosition,event});if(result.error)return result}return(null==event?void 0:event.entries)&&(event.entries=refreshEntryPositions({entries:event.entries})),(null==drawDefinition?void 0:drawDefinition.entries)&&(drawDefinition.entries=refreshEntryPositions({entries:drawDefinition.entries})),__spreadValues$M({},SUCCESS)},addEventEntryPairs:function addEventEntryPairs({allowDuplicateParticipantIdPairs,entryStatus=ALTERNATE,participantIdPairs=[],entryStage=MAIN,tournamentRecord,drawDefinition,event,uuids}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};if(event.eventType!==DOUBLES$1)return{error:INVALID_EVENT_TYPE};const tournamentParticipants=tournamentRecord.participants||[],individualParticipantIds=tournamentParticipants.filter((participant=>participant.participantType===INDIVIDUAL)).map((participant=>participant.participantId)),invalidParticipantIds=individualParticipantIds.filter((participantId=>!individualParticipantIds.includes(participantId)));if(invalidParticipantIds.length)return{error:INVALID_PARTICIPANT_IDS,invalidParticipantIds};const invalidParticipantIdPairs=participantIdPairs.filter((pair=>2!==pair.length));if(invalidParticipantIdPairs.length)return{error:INVALID_PARTICIPANT_IDS,invalidParticipantIdPairs};const existingParticipantIdPairs=tournamentParticipants.filter((participant=>participant.participantType===PAIR)).map((participant=>participant.individualParticipantIds)),provisionalParticipants=participantIdPairs.map((individualParticipantIds2=>({participantId:(null==uuids?void 0:uuids.pop())||UUID(),participantType:PAIR,participantRole:COMPETITOR,individualParticipantIds:individualParticipantIds2}))),newParticipants=allowDuplicateParticipantIdPairs?provisionalParticipants:provisionalParticipants.filter((participant=>!existingParticipantIdPairs.find((existing=>2===intersection(existing,participant.individualParticipantIds).length))));let info,addedParticipants=[];if(newParticipants){const result2=addParticipants({allowDuplicateParticipantIdPairs,participants:newParticipants,returnParticipants:!0,tournamentRecord});if(result2.error)return result2;addedParticipants=result2.participants||[],info=result2.info}const result=addEventEntries({participantIds:participantIdPairs.map((participantIds=>{const addedParticipant=addedParticipants.find((addedPair=>2===intersection(addedPair.individualParticipantIds,participantIds).length));if(addedParticipant)return addedParticipant;const{participant}=getPairedParticipant({tournamentRecord,participantIds});return participant})).map((participant=>participant.participantId)),tournamentRecord,drawDefinition,entryStatus,entryStage,event});newParticipants.length&&addNotice({topic:ADD_PARTICIPANTS,participants:newParticipants});const newParticipantIds=newParticipants.map(getParticipantId);return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$X.call(b,prop)&&__defNormalProp$X(a,prop,b[prop]);if(__getOwnPropSymbols$X)for(var prop of __getOwnPropSymbols$X(b))__propIsEnum$X.call(b,prop)&&__defNormalProp$X(a,prop,b[prop]);return a})({},result),__defProps$u(a,__getOwnPropDescs$u({info,newParticipantIds}));var a},removeEventEntries,removeDrawEntries:function removeDrawEntries({autoEntryPositions=!0,participantIds,drawDefinition,drawId,stages,event}){var _a;if(!event)return{error:MISSING_EVENT};if(!drawId)return{error:MISSING_DRAW_ID};if(!participantIds||!participantIds.length)return{error:MISSING_PARTICIPANT_IDS};if(overlap(getAssignedParticipantIds({drawDefinition,stages}),participantIds))return{error:EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT};const filterEntry=entry=>{const entryId=entry.participantId;return!participantIds.includes(entryId)},{flightProfile}=getFlightProfile({event}),flight=null==(_a=null==flightProfile?void 0:flightProfile.flights)?void 0:_a.find((flight2=>flight2.drawId===drawId));return(null==flight?void 0:flight.drawEntries)&&(flight.drawEntries=flight.drawEntries.filter(filterEntry),autoEntryPositions&&(flight.drawEntries=refreshEntryPositions({entries:flight.drawEntries}))),(null==drawDefinition?void 0:drawDefinition.entries)&&(drawDefinition.entries=drawDefinition.entries.filter(filterEntry),autoEntryPositions&&(drawDefinition.entries=refreshEntryPositions({entries:drawDefinition.entries}))),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$O.call(b,prop)&&__defNormalProp$O(a,prop,b[prop]);if(__getOwnPropSymbols$O)for(var prop of __getOwnPropSymbols$O(b))__propIsEnum$O.call(b,prop)&&__defNormalProp$O(a,prop,b[prop]);return a})({},SUCCESS)},modifyEventEntries:function modifyEventEntries({event,tournamentRecord,entryStage=MAIN,participantIdPairs=[],unpairedParticipantIds=[],entryStatus=DIRECT_ACCEPTANCE}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};const tournamentParticipants=tournamentRecord.participants||[],individualParticipantIds=tournamentParticipants.filter((participant=>participant.participantType===INDIVIDUAL)).map((participant=>participant.participantId)),invalidParticipantIds=unpairedParticipantIds.concat(...participantIdPairs).flat(1/0).filter((participantId=>!individualParticipantIds.includes(participantId)));if(invalidParticipantIds.length)return{error:INVALID_PARTICIPANT_IDS,invalidParticipantIds};const invalidParticipantIdPairs=participantIdPairs.filter((pair=>2!==pair.length));if(invalidParticipantIdPairs.length)return{error:INVALID_PARTICIPANT_IDS,invalidParticipantIdPairs};const existingParticipantIdPairs=tournamentParticipants.filter((participant=>participant.participantType===PAIR)).map((participant=>participant.individualParticipantIds)),newParticipants=participantIdPairs.filter((incoming=>!existingParticipantIdPairs.find((existing=>2===intersection(existing,incoming).length)))).map((individualParticipantIds2=>({participantType:PAIR,participantRole:COMPETITOR,individualParticipantIds:individualParticipantIds2}))),result=addParticipants({tournamentRecord,participants:newParticipants});if(result.error)return result;const pairParticipantEntries=participantIdPairs.map((participantIds=>{const{participant}=getPairedParticipant({tournamentRecord,participantIds});return participant})).map((participantId=>({participantId,entryStatus,entryStage}))),unpairedParticipantEntries=unpairedParticipantIds.map((participantId=>({entryStatus:UNGROUPED,participantId,entryStage})));return event.entries=(event.entries||[]).filter((entry=>entry.entryStage===entryStage)),event.entries=event.entries.concat(...pairParticipantEntries,...unpairedParticipantEntries),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$x.call(b,prop)&&__defNormalProp$x(a,prop,b[prop]);if(__getOwnPropSymbols$x)for(var prop of __getOwnPropSymbols$x(b))__propIsEnum$x.call(b,prop)&&__defNormalProp$x(a,prop,b[prop]);return a})({},SUCCESS)},modifyEntriesStatus,modifySeedAssignment:function modifySeedAssignment({tournamentRecord,drawDefinition,participantId,structureId,seedValue,event}){return tournamentRecord?(tournamentRecord.participants||[]).find((participant2=>participant2.participantId===participantId))?modifySeedAssignment$1({tournamentRecord,drawDefinition,participantId,structureId,seedValue,event}):{error:INVALID_PARTICIPANT_ID}:{error:MISSING_TOURNAMENT_RECORD}},modifyPairAssignment:function modifyPairAssignment({replacementIndividualParticipantId,existingIndividualParticipantId,tournamentRecord,drawDefinition,participantId,event,uuids}){var _a,_b;if(!event)return{error:MISSING_EVENT};if((null==event?void 0:event.eventType)!==DOUBLES)return{error:INVALID_EVENT_TYPE};if(uuids&&!Array.isArray(uuids))return{error:INVALID_VALUES};if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(![replacementIndividualParticipantId,existingIndividualParticipantId,participantId].every((id=>"string"==typeof id)))return{error:MISSING_PARTICIPANT_ID};if(!((null==(_a=null==event?void 0:event.entries)?void 0:_a.filter((({entryStatus})=>[UNGROUPED,UNPAIRED].includes(entryStatus))).map((({participantId:participantId2})=>participantId2)))||[]).includes(replacementIndividualParticipantId))return{error:INVALID_PARTICIPANT_ID};const participant=(tournamentRecord.participants||[]).find((participant2=>participant2.participantId===participantId));if((null==participant?void 0:participant.participantType)!==PAIR)return{error:INVALID_PARTICIPANT,participant};const existingIndividualParticipantIds=participant.individualParticipantIds,individualParticipantIds=[replacementIndividualParticipantId,...existingIndividualParticipantIds.filter((individualParticipantId=>individualParticipantId!==existingIndividualParticipantId))],{participant:existingPairParticipant}=getPairedParticipant({participantIds:[individualParticipantIds],tournamentRecord});let newPairParticipantId;if(existingPairParticipant)newPairParticipantId=existingPairParticipant.participantId;else{const result=addParticipant$1({participant:{participantId:null==uuids?void 0:uuids.pop(),participantRole:COMPETITOR,individualParticipantIds,participantType:PAIR},returnParticipant:!0,tournamentRecord});if(result.error)return result;newPairParticipantId=result.participant.participantId}const{flightProfile}=getFlightProfile({event});if(drawDefinition){const flight=null==(_b=null==flightProfile?void 0:flightProfile.flights)?void 0:_b.find((({drawId})=>drawId===drawDefinition.drawId));flight&&(flight.drawEntries=flight.drawEntries.map((entry=>entry.participantId===participantId?__spreadProps$q(__spreadValues$P({},entry),{participantId:newPairParticipantId}):entry))),drawDefinition.entries=drawDefinition.entries.map((entry=>entry.participantId===participantId?__spreadProps$q(__spreadValues$P({},entry),{participantId:newPairParticipantId}):entry));for(const structure of drawDefinition.structures||[])if(structure.positionAssignments)structure.positionAssignments=structure.positionAssignments.map((assignment=>assignment.participantId===participantId?__spreadProps$q(__spreadValues$P({},assignment),{participantId:newPairParticipantId}):assignment));else if(structure.structures)for(const subStructure of structure.structures)subStructure.positionAssignments=subStructure.positionAssignments.map((assignment=>assignment.participantId===participantId?__spreadProps$q(__spreadValues$P({},assignment),{participantId:newPairParticipantId}):assignment))}event.entries=event.entries.map((entry=>entry.participantId===participantId&&__spreadProps$q(__spreadValues$P({},entry),{participantId:newPairParticipantId})||entry.participantId===replacementIndividualParticipantId&&__spreadProps$q(__spreadValues$P({},entry),{participantId:existingIndividualParticipantId})||entry));const participantOtherEntries=tournamentRecord.events.some((({entries,eventId,drawDefinitions})=>event.eventId===eventId?drawDefinitions.some((({drawId,entries:entries2})=>drawId!==(null==drawDefinition?void 0:drawDefinition.drawId)&&(null==entries2?void 0:entries2.find((entry=>entry.participantId===participantId))))):null==entries?void 0:entries.find((entry=>entry.participantId===participantId))));if(!participantOtherEntries){const result=deleteParticipants({addIndividualParticipantsToEvents:!1,participantIds:[participantId],tournamentRecord});if(result.error)return result}return __spreadProps$q(__spreadValues$P({},SUCCESS),{participantOtherEntries,newPairParticipantId})},resetVoluntaryConsolationStructure:function resetVoluntaryConsolationStructure({tournamentRecord,drawDefinition,resetEntries,event}){var _a,_b;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const structure=null==(_a=drawDefinition.structures)?void 0:_a.find((structure2=>structure2.stage===VOLUNTARY_CONSOLATION));if(!structure)return{error:STRUCTURE_NOT_FOUND};const removedMatchUpIds=(null==(_b=structure.matchUps)?void 0:_b.map((({matchUpId})=>matchUpId)))||[];return structure.positionAssignments=[],structure.seedAssignments=[],structure.matchUps=[],deleteMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:removedMatchUpIds,drawDefinition}),resetEntries&&(drawDefinition.entries=drawDefinition.entries.filter((entry=>entry.entryStage!==VOLUNTARY_CONSOLATION))),modifyDrawNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,drawDefinition,structureIds:[structure.structureId]}),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$J.call(b,prop)&&__defNormalProp$J(a,prop,b[prop]);if(__getOwnPropSymbols$J)for(var prop of __getOwnPropSymbols$J(b))__propIsEnum$J.call(b,prop)&&__defNormalProp$J(a,prop,b[prop]);return a})({},SUCCESS)},deleteFlightProfileAndFlightDraws:function deleteFlightProfileAndFlightDraws({autoPublish=!0,tournamentRecord,auditData,event}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};const{flightProfile}=getFlightProfile({event});if(flightProfile){const drawIds=null==(_a=flightProfile.flights)?void 0:_a.map((({drawId})=>drawId)).filter(Boolean),result=deleteDrawDefinitions({eventId:event.eventId,tournamentRecord,autoPublish,auditData,drawIds,event});return result.error?result:removeEventExtension({event,name:FLIGHT_PROFILE})}return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$I.call(b,prop)&&__defNormalProp$I(a,prop,b[prop]);if(__getOwnPropSymbols$I)for(var prop of __getOwnPropSymbols$I(b))__propIsEnum$I.call(b,prop)&&__defNormalProp$I(a,prop,b[prop]);return a})({},SUCCESS)},deleteFlightAndFlightDraw:function deleteFlightAndFlightDraw({autoPublish=!0,tournamentRecord,auditData,drawId,event}){var _a,_b;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!drawId)return{error:MISSING_DRAW_ID};if(!event)return{error:MISSING_EVENT};const{flightProfile}=getFlightProfile({event});if(flightProfile){if(null==(_a=flightProfile.flights)?void 0:_a.find((flight2=>flight2.drawId===drawId))){const flights=flightProfile.flights.filter((flight2=>flight2.drawId!==drawId));addEventExtension$1({event,extension:{name:FLIGHT_PROFILE,value:(a=__spreadValues$F({},flightProfile),b={flights},__defProps$o(a,__getOwnPropDescs$o(b)))}})}}var a,b;const drawWasGenerated=null==(_b=event.drawDefinitions)?void 0:_b.find((drawDefinition=>drawDefinition.drawId===drawId));if(drawWasGenerated){const result=deleteDrawDefinitions({drawIds:[drawId],eventId:event.eventId,tournamentRecord,autoPublish,auditData,event});if(result.error)return result}return refreshEventDrawOrder({tournamentRecord,event})},generateFlightProfile:function generateFlightProfile({drawNameRoot="Flight",attachFlightProfile:attachFlightProfile$1,tournamentRecord,scaleAttributes,scaleSortMethod,deleteExisting,sortDescending,drawNames=[],scaledEntries,flightsCount,flightValues,splitMethod,uuids=[],event,stage}){if(!event)return{error:MISSING_EVENT};const eventEntries=event.entries||[],{flightProfile}=getFlightProfile({event});if(flightProfile&&attachFlightProfile$1&&!deleteExisting)return{error:EXISTING_PROFILE};scaledEntries||({scaledEntries}=getScaledEntries({tournamentRecord,scaleAttributes,scaleSortMethod,sortDescending,event,stage}));const scaledEntryParticipantIds=scaledEntries.map(getParticipantId),unscaledEntries=eventEntries.filter((({participantId})=>!scaledEntryParticipantIds.includes(participantId))).filter((entry=>(!stage||!entry.entryStage||entry.entryStage===stage)&&DIRECT_ENTRY_STATUSES.includes(entry.entryStatus))),flightEntries=scaledEntries.concat(...unscaledEntries),entriesCount=flightEntries.length;let splitEntries=chunkArray(flightEntries,Math.ceil(entriesCount/flightsCount));"splitWaterfall"===splitMethod?splitEntries=chunkByNth(flightEntries,flightsCount):"splitShuttle"===splitMethod&&(splitEntries=chunkByNth(flightEntries,flightsCount,!0));const updatedFlightProfile={scaleAttributes,splitMethod,flights:generateRange(0,flightsCount).map((index=>{var _a;const flightNumber=index+1,flight={flightNumber,drawId:(null==uuids?void 0:uuids.pop())||UUID(),drawEntries:(entriesChunk=splitEntries[index],(entriesChunk||[]).map((({participantId,scaleValue})=>{const entry=eventEntries.find((entry2=>entry2.participantId===participantId));return scaleValue&&(entry.scaleValue=scaleValue),entry})).sort(((a,b)=>a.scaleValue-b.scaleValue)).map(((entry,i)=>(entry.scaleValue&&(entry.seedNumber=i+1),entry)))),drawName:(null==drawNames?void 0:drawNames.length)&&drawNames[index]||`${drawNameRoot} ${flightNumber}`};var entriesChunk;const matchUpValue=null==(_a=null==flightValues?void 0:flightValues.find((value=>value.flightNumber===flightNumber)))?void 0:_a.matchUpValue;return matchUpValue&&(flight.matchUpValue=matchUpValue),flight}))};if(attachFlightProfile$1){const result=attachFlightProfile({flightProfile:updatedFlightProfile,deleteExisting,event});return __spreadValues$D({splitEntries:getDevContext()&&splitEntries||void 0},result)}return __spreadValues$D({flightProfile:updatedFlightProfile},SUCCESS)},refreshEventDrawOrder,attachFlightProfile,resetDrawDefinition:function resetDrawDefinition({tournamentRecord,removeScheduling,drawDefinition}){var _a;if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};const matchUpsMap=getMatchUpsMap({drawDefinition}),getRawMatchUp=matchUpId=>{var _a2;return null==(_a2=null==matchUpsMap?void 0:matchUpsMap.drawMatchUps)?void 0:_a2.find((matchUp=>matchUp.matchUpId===matchUpId))};for(const structure of drawDefinition.structures||[]){const{positionAssignments,stage,stageSequence}=structure;!positionAssignments||1===stageSequence&&[QUALIFYING,MAIN].includes(stage)||(structure.positionAssignments=positionAssignments.map((assignment=>(delete assignment.participantId,assignment))),structure.seedAssignments=[]);const{matchUps:inContextMatchUps}=getAllStructureMatchUps({afterRecoveryTimes:!1,inContext:!0,matchUpsMap,structure});for(const inContextMatchUp of inContextMatchUps){const{matchUpId,roundNumber,sides}=inContextMatchUp,matchUp=getRawMatchUp(matchUpId);if(delete matchUp.extensions,delete matchUp.notes,matchUp.matchUpStatus!==BYE&&Object.assign(matchUp,toBePlayed),roundNumber&&roundNumber>1&&matchUp.drawPositions){const fedDrawPositions=null==sides?void 0:sides.map((({drawPosition,participantFed})=>!participantFed&&drawPosition)).filter(Boolean);matchUp.drawPositions=matchUp.drawPositions.map((drawPosition=>fedDrawPositions.includes(drawPosition)?void 0:drawPosition))}removeScheduling?delete matchUp.timeItems:(null==(_a=matchUp.timeItems)?void 0:_a.length)&&(matchUp.timeItems=matchUp.timeItems.filter((timeItem=>![ALLOCATE_COURTS,ASSIGN_COURT,ASSIGN_VENUE,ASSIGN_OFFICIAL,SCHEDULED_DATE,SCHEDULED_TIME].includes(timeItem.itemType)))),modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,context:"resetDrawDefiniton",drawDefinition,matchUp})}}return modifyDrawNotice({drawDefinition,structureIds:(drawDefinition.structures||[]).map((({structureId})=>structureId))}),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$B.call(b,prop)&&__defNormalProp$B(a,prop,b[prop]);if(__getOwnPropSymbols$B)for(var prop of __getOwnPropSymbols$B(b))__propIsEnum$B.call(b,prop)&&__defNormalProp$B(a,prop,b[prop]);return a})({},SUCCESS)},pruneDrawDefinition:function pruneDrawDefinition({matchPlayDrawPositions=!0,tournamentRecord,drawDefinition,drawId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};let relevantMatchUps=[];const{drawsAnalysis}=analyzeDraws({tournamentRecord});if(drawsAnalysis.canBePruned.includes(drawId)){const isMatchPlay=drawsAnalysis.matchPlay.includes(drawId),drawAnalysis=drawsAnalysis.drawAnalysis[drawId],{structures:[mainStructure]}=getDrawStructures({stageSequence:1,drawDefinition,stage:MAIN}),structureData=drawAnalysis.structuresData.find((({structureId})=>mainStructure.structureId===structureId)),matchUps=mainStructure.matchUps||[];relevantMatchUps=matchUps.sort(((a,b)=>a.roundPosition-b.roundPosition)).filter((({roundNumber})=>!structureData.inactiveRounds.includes(roundNumber)));const relevantMatchUpIds=relevantMatchUps.map(getMatchUpId),deletedMatchUpIds=matchUps.map(getMatchUpId).filter((matchUpId=>!relevantMatchUpIds.includes(matchUpId)));if(isMatchPlay){const matchPlayMatchUps=relevantMatchUps.sort(((a,b)=>a.roundPosition-b.roundPosition)).filter((({roundNumber})=>!structureData.inactiveRounds.includes(roundNumber))).filter((({winningSide})=>winningSide)),matchPlayMatchUpIds=matchPlayMatchUps.map(getMatchUpId),matchUpIdsToDelete=relevantMatchUpIds.filter((matchUpId=>!matchPlayMatchUpIds.includes(matchUpId)));deletedMatchUpIds.push(...matchUpIdsToDelete);const existingDrawPositions=matchPlayMatchUps.map((({drawPositions})=>drawPositions)).flat(),drawPositionsMap=Object.assign({},...existingDrawPositions.map(((drawPosition,i)=>({[drawPosition]:i+1}))));if(matchPlayMatchUps.forEach((matchUp=>{matchPlayDrawPositions?matchUp.drawPositions=matchUp.drawPositions.map((drawPosition=>drawPositionsMap[drawPosition])):delete matchUp.drawPositions})),matchPlayDrawPositions){const updatedPositionAssignments=mainStructure.positionAssignments.filter((assignment=>existingDrawPositions.includes(assignment.drawPosition))).map((assignment=>(assignment.drawPosition=drawPositionsMap[assignment.drawPosition],assignment)));mainStructure.positionAssignments=updatedPositionAssignments}else mainStructure.positionAssignments=[];mainStructure.matchUps=matchPlayMatchUps,relevantMatchUps=matchPlayMatchUps}deleteMatchUpsNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUpIds:deletedMatchUpIds,drawDefinition}),modifyDrawNotice({drawDefinition})}return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$A.call(b,prop)&&__defNormalProp$A(a,prop,b[prop]);if(__getOwnPropSymbols$A)for(var prop of __getOwnPropSymbols$A(b))__propIsEnum$A.call(b,prop)&&__defNormalProp$A(a,prop,b[prop]);return a})({},SUCCESS),__defProps$n(a,__getOwnPropDescs$n({matchUps:relevantMatchUps}));var a},updateDrawIdsOrder,getFlightProfile,getScaledEntries,generateLineUps,addFlight,generateAdHocMatchUps:function generateAdHocMatchUps(params){return generateAdHocMatchUps$1(params)},deleteAdHocMatchUps:function deleteAdHocMatchUps(params){return deleteAdHocMatchUps$1(params)},addAdHocMatchUps:function addAdHocMatchUps(params){return addAdHocMatchUps$1(params)},drawMatic,setOrderOfFinish:function setOrderOfFinish(params){return setOrderOfFinish$1(params)},setDelegatedOutcome:function setDelegatedOutcome(params){return setDelegatedOutcome$1(params)},removeDelegatedOutcome:function removeDelegatedOutcome(params){return removeDelegatedOutcome$1(params)},addVoluntaryConsolationStructure:addVoluntaryConsolationStructure$1,addVoluntaryConsolationStage:function addVoluntaryConsolationStage(params){return addVoluntaryConsolationStage$1(params)},generateVoluntaryConsolation:function generateVoluntaryConsolation(params){const{tournamentRecord}=params;return tournamentRecord?generateVoluntaryConsolation$1(((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$C.call(b,prop)&&__defNormalProp$C(a,prop,b[prop]);if(__getOwnPropSymbols$C)for(var prop of __getOwnPropSymbols$C(b))__propIsEnum$C.call(b,prop)&&__defNormalProp$C(a,prop,b[prop]);return a})({participants:tournamentRecord.participants},params)):{error:MISSING_TOURNAMENT_RECORD}},attachConsolationStructures:function attachConsolationStructures(params){return attachStructures(__spreadProps$j(__spreadValues$v({},params),{itemType:"attachConsolationStructures"}))},bulkMatchUpStatusUpdate:bulkMatchUpStatusUpdate$1,updateTieMatchUpScore:function updateTieMatchUpScore(params){return params.tournamentRecord?updateTieMatchUpScore$1(params):{error:MISSING_TOURNAMENT_RECORD}},setMatchUpStatus:setMatchUpStatus$1,setMatchUpFormat:function setMatchUpFormat({tournamentRecord,drawDefinition,scheduledDates,stageSequences,matchUpFormat,structureIds,structureId,eventType,matchUpId,eventIds,eventId,drawIds,stages,drawId,event,force}){const stack="setMatchUpFormat";if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!matchUpFormat)return{error:MISSING_MATCHUP_FORMAT};if(matchUpFormat&&!isValid(matchUpFormat))return decorateResult({result:{error:UNRECOGNIZED_MATCHUP_FORMAT,matchUpFormat},stack});if(scheduledDates&&!Array.isArray(scheduledDates))return decorateResult({result:{error:INVALID_VALUES,scheduledDates},stack});if(eventType&&![SINGLES,DOUBLES].includes(eventType))return decorateResult({result:{error:INVALID_EVENT_TYPE},stack});let modificationsCount=0;if((structureId||structureIds)&&!drawDefinition)return decorateResult({result:{error:MISSING_DRAW_DEFINITION},stack});if(drawId&&matchUpId){const result=setMatchUpFormat$1({tournamentRecord,drawDefinition,matchUpFormat,structureIds,structureId,matchUpId,force});if(result.error)return result;modificationsCount+=1}const processStructures=drawDefinition2=>{const modifiedStructureIds=[];for(const structure of drawDefinition2.structures||[]){if(Array.isArray(stages)&&!stages.includes(structure.stage)||Array.isArray(stageSequences)&&!stageSequences.includes(structure.stageSequence)||structureIds.length&&!structureIds.includes(structure.structureId))continue;structureIds.length&&structure.matchUpFormat!==matchUpFormat&&(structure.matchUpFormat=matchUpFormat,modifiedStructureIds.push(structure.structureId),modificationsCount+=1);const matchUps=(force||scheduledDates)&&getAllStructureMatchUps({matchUpFilters:{matchUpStatuses:[TO_BE_PLAYED]},structure}),inContextMatchUps=scheduledDates&&getAllStructureMatchUps({matchUpFilters:{matchUpStatuses:[TO_BE_PLAYED]},contextFilters:{scheduledDates},afterRecoveryTimes:!1,inContext:!0,structure});if(null==matchUps?void 0:matchUps.length){const matchUpIdsToModify=inContextMatchUps?inContextMatchUps.map(getMatchUpId):matchUps.map(getMatchUpId);for(const matchUp of matchUps)matchUpIdsToModify.includes(matchUp.matchUpId)&&(matchUp.matchUpFormat=(null==scheduledDates?void 0:scheduledDates.length)?matchUpFormat:void 0,modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,eventId:null==event?void 0:event.eventId,context:stack,drawDefinition:drawDefinition2,matchUp}))}}return modifiedStructureIds.length||drawDefinition2.matchUpFormat!==matchUpFormat&&(drawDefinition2.matchUpFormat=matchUpFormat,modificationsCount+=1),modifiedStructureIds};structureIds=structureIds||[structureId].filter(Boolean),eventIds=eventIds||[eventId].filter(Boolean),drawIds=drawIds||[drawId].filter(Boolean);for(const event2 of tournamentRecord.events||[])if(!((null==eventIds?void 0:eventIds.length)&&!eventIds.includes(event2.eventId)||eventType&&eventType!==event2.eventType||eventType===TEAM$1))if(Array.isArray(stageSequences)||Array.isArray(stages)||structureIds.length||drawIds.length)for(const drawDefinition2 of event2.drawDefinitions||[]){if(Array.isArray(drawIds)&&!drawIds.includes(drawDefinition2.drawId))continue;modifyDrawNotice({structureIds:processStructures(drawDefinition2),drawDefinition:drawDefinition2})}else event2.matchUpFormat!==matchUpFormat&&(event2.matchUpFormat=matchUpFormat,modificationsCount+=1);return __spreadProps$p(__spreadValues$N({},SUCCESS),modificationsCount?{modificationsCount}:{info:NO_MODIFICATIONS_APPLIED})},assignDrawPosition:function assignDrawPosition({tournamentRecord,drawDefinition,participantId,drawPosition,structureId,qualifier,event,bye}){if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!drawPosition)return{error:MISSING_DRAW_POSITION};if(!structureId)return{error:MISSING_STRUCTURE_ID};if(bye){const result=assignDrawPositionBye$1({tournamentRecord,drawDefinition,drawPosition,structureId,event});if(result.error)return result}else{if(qualifier)return{error:NOT_IMPLEMENTED};{const result=assignDrawPosition$1({tournamentRecord,drawDefinition,participantId,drawPosition,structureId,event});if(result.error)return result}}return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$Y.call(b,prop)&&__defNormalProp$Y(a,prop,b[prop]);if(__getOwnPropSymbols$Y)for(var prop of __getOwnPropSymbols$Y(b))__propIsEnum$Y.call(b,prop)&&__defNormalProp$Y(a,prop,b[prop]);return a})({},SUCCESS)},assignSeedPositions:function assignSeedPositions(params){const{provisionalPositioning,useExistingSeedLimit,tournamentRecord,drawDefinition,seedingProfile,structureId,assignments,drawId,event}=params;let modifications=0;if(!(null==assignments?void 0:assignments.length))return{error:MISSING_ASSIGNMENTS};if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!drawId)return{error:MISSING_DRAW_ID};const result=getStructureSeedAssignments({provisionalPositioning,drawDefinition,structureId});if(result.error)return result;const{seedAssignments,seedLimit}=result,mergeObject=Object.assign({},...seedAssignments.filter((assignment=>assignment.seedNumber)).map((assignment=>({[assignment.seedNumber]:assignment}))));assignments.forEach((newAssignment=>{const{seedNumber}=newAssignment;seedNumber<=seedLimit&&(!useExistingSeedLimit||mergeObject[seedNumber])&&(mergeObject[seedNumber]=newAssignment)}));const updatedAssignments=Object.values(mergeObject),participantIds=updatedAssignments.map((assignment=>null==assignment?void 0:assignment.participantId)).filter(Boolean);if(participantIds.length!==uniqueValues(participantIds).length)return{error:INVALID_PARTICIPANT_SEEDING};for(const assignment of updatedAssignments){const result2=assignSeed(__spreadProps$t(__spreadValues$V({},assignment),{provisionalPositioning,tournamentRecord,drawDefinition,seedingProfile,structureId,event}));if(null==result2?void 0:result2.error)return result2;(null==result2?void 0:result2.success)&&modifications++}return modifications?__spreadProps$t(__spreadValues$V({},SUCCESS),{modifications}):{error:NO_MODIFICATIONS_APPLIED}},assignDrawPositionBye:function assignDrawPositionBye({tournamentRecord,drawDefinition,seedBlockInfo,drawPosition,structureId,event}){return assignDrawPositionBye$1({tournamentRecord,drawDefinition,seedBlockInfo,drawPosition,structureId,event})},substituteParticipant:function substituteParticipant(params){return function substituteParticipant$1({substituteParticipantId,existingParticipantId,tournamentRecord,drawDefinition,sideNumber,matchUpId,event}){const stack="substituteParticipant";if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!matchUpId)return{error:MISSING_MATCHUP_ID};if(!existingParticipantId||!substituteParticipantId)return decorateResult({result:{error:MISSING_PARTICIPANT_ID},stack});const{matchUp}=findMatchUp$1({drawDefinition,matchUpId,event});if(!matchUp)return{error:MATCHUP_NOT_FOUND};if(!matchUp.collectionId)return decorateResult({result:{error:INVALID_MATCHUP},stack});const matchUpsMap=getMatchUpsMap({drawDefinition}),{matchUps:inContextDrawMatchUps}=getAllDrawMatchUps({tournamentParticipants:null==tournamentRecord?void 0:tournamentRecord.participants,includeByeMatchUps:!0,inContext:!0,drawDefinition,matchUpsMap}),inContextMatchUp=inContextDrawMatchUps.find((drawMatchUp=>drawMatchUp.matchUpId===matchUpId)),relevantSide=inContextDrawMatchUps.find((drawMatchUp=>drawMatchUp.matchUpId===inContextMatchUp.matchUpTieId)).sides.find((side=>side.participant.individualParticipants.some((({participantId})=>participantId===existingParticipantId))));return!relevantSide||sideNumber&&relevantSide.sideNumber!==sideNumber?{error:INVALID_PARTICIPANT_ID}:relevantSide.participant.individualParticipants.map(getParticipantId).filter((participantId=>participantId!==existingParticipantId)).includes(substituteParticipantId)?replaceTieMatchUpParticipantId({newParticipantId:substituteParticipantId,tieMatchUpId:matchUpId,existingParticipantId,substitution:!0,tournamentRecord,drawDefinition,event}):decorateResult({result:{error:INVALID_PARTICIPANT_ID},stack})}(params)},swapDrawPositionAssignments:function swapDrawPositionAssignments(params){return swapDrawPositionAssignments$1(params)},assignMatchUpSideParticipant:function assignMatchUpSideParticipant({tournamentRecord,drawDefinition,participantId,sideNumber,matchUpId,event}){var _a;if(participantId&&"string"!=typeof participantId)return{error:INVALID_PARTICIPANT_ID};if(!drawDefinition)return{error:MISSING_DRAW_DEFINITION};if(!matchUpId)return{error:MISSING_MATCHUP_ID};const noSideNumberProvided=void 0===sideNumber;if(noSideNumberProvided&&(sideNumber=1),![1,2].includes(sideNumber))return{error:INVALID_VALUES,sideNumber};const{matchUp,structure}=findMatchUp$1({drawDefinition,matchUpId,event});if(!!((null==structure?void 0:structure.structures)||drawDefinition.drawType&&drawDefinition.drawType!==AD_HOC||(null==structure?void 0:structure.matchUps.find((({roundPosition})=>!!roundPosition)))))return{error:INVALID_DRAW_TYPE};if(!participantId&&((null==(_a=matchUp.score)?void 0:_a.scoreStringSide1)||completedMatchUpStatuses.includes(matchUp.matchUpstatus)||[DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(matchUp.matchUpStatus)))return{error:CANNOT_REMOVE_PARTICIPANTS,info:"matchUp has completed status or score"};if(matchUp.sides=[1,2].map((currentSideNumber=>{var _a2;const existingSide=(null==(_a2=matchUp.sides)?void 0:_a2.find((side=>side.sideNumber===currentSideNumber)))||{sideNumber:currentSideNumber};return sideNumber===currentSideNumber?__spreadProps$z(__spreadValues$14({},existingSide),{participantId}):existingSide})),noSideNumberProvided)for(const side of matchUp.sides)side.sideNumber=3-side.sideNumber;return modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,context:"assignSideParticipant",drawDefinition,matchUp}),__spreadProps$z(__spreadValues$14({},SUCCESS),{sidesSwapped:noSideNumberProvided})},removeDrawPositionAssignment,alternateDrawPositionAssignment:function alternateDrawPositionAssignment(params){return alternateDrawPositionAssignment$1(params)},withdrawParticipantAtDrawPosition:function withdrawParticipantAtDrawPosition(params){return Object.assign(params,{entryStatus:WITHDRAWN}),removeDrawPositionAssignment(params)},setDrawParticipantRepresentativeIds:function setDrawParticipantRepresentativeIds({representativeParticipantIds,drawDefinition}){if(!drawDefinition)return{error:DRAW_DEFINITION_NOT_FOUND};if(!Array.isArray(representativeParticipantIds))return{error:INVALID_VALUES};const enteredParticipantIds=getParticipantIds((null==drawDefinition?void 0:drawDefinition.entries)||[]);return representativeParticipantIds.length&&intersection(representativeParticipantIds,enteredParticipantIds).length<representativeParticipantIds.length?{error:INVALID_VALUES}:addDrawDefinitionExtension({drawDefinition,extension:{name:"participantRepresentatives",value:representativeParticipantIds}})},getDrawParticipantRepresentativeIds:function getDrawParticipantRepresentativeIds({drawDefinition}){var _a;const result=findDrawDefinitionExtension({drawDefinition,name:"participantRepresentatives"});return result.error?result:{representativeParticipantIds:(null==(_a=result.extension)?void 0:_a.value)||[]}},luckyLoserDrawPositionAssignment:function luckyLoserDrawPositionAssignment(params){return function luckyLoserDrawPositionAssignment$1({luckyLoserParticipantId,tournamentRecord,drawDefinition,drawPosition,structureId}){return positionParticipantAction({positionActionName:"luckyLoserDrawPositionAssignment",participantId:luckyLoserParticipantId,tournamentRecord,drawDefinition,drawPosition,structureId})}(params)},qualifierDrawPositionAssignment:function qualifierDrawPositionAssignment(params){return function qualifierDrawPositionAssignment$1({qualifyingParticipantId,tournamentRecord,drawDefinition,drawPosition,structureId}){return positionParticipantAction({positionActionName:"qualifierDrawPositionAssignment",participantId:qualifyingParticipantId,isQualifierPosition:!0,tournamentRecord,drawDefinition,drawPosition,structureId})}(params)},setPositionAssignments:function setPositionAssignments(params){return setPositionAssignments$1(params)},automatedPositioning:function automatedPositioning({applyPositioning=!0,tournamentRecord,drawDefinition,seedingProfile,structureId,placeByes,seedsOnly,event}){return event?drawDefinition?automatedPositioning$1({tournamentRecord,applyPositioning,drawDefinition,seedingProfile,participants:null==tournamentRecord?void 0:tournamentRecord.participants,structureId,placeByes,seedsOnly}):{error:DRAW_DEFINITION_NOT_FOUND}:{error:EVENT_NOT_FOUND}},automatedPlayoffPositioning,checkInParticipant:function checkInParticipant({tournamentRecord,participantId,matchUpId,matchUp,drawId}){matchUp&&!drawId&&({drawId}=matchUp),matchUp&&!matchUpId&&({matchUpId}=matchUp);const{event,drawDefinition}=findEvent({tournamentRecord,drawId});if(!event)return{error:EVENT_NOT_FOUND};{const result=checkInParticipant$1({tournamentParticipants:tournamentRecord.participants,drawDefinition,participantId,matchUpId});if(result.error&&result.error!==PARTICIPANT_ALREADY_CHECKED_IN)return result}return __spreadValues$R({},SUCCESS)},checkOutParticipant:function checkOutParticipant({tournamentRecord,participantId,matchUpId,matchUp,drawId}){matchUp&&!drawId&&({drawId}=matchUp),matchUp&&!matchUpId&&({matchUpId}=matchUp);const{event,drawDefinition}=findEvent({tournamentRecord,drawId});if(!event)return{error:EVENT_NOT_FOUND};{const result=checkOutParticipant$1({drawDefinition,tournamentParticipants:tournamentRecord.participants,matchUpId,participantId});if(result.error)return result}return __spreadValues$R({},SUCCESS)},toggleParticipantCheckInState:toggleParticipantCheckInState$1,addDrawDefinitionTimeItem,generateDrawDefinition,generateDrawStructuresAndLinks:function generateDrawStructuresAndLinks(params){return generateDrawStructuresAndLinks$1(params)},generateDrawTypeAndModifyDrawDefinition:function generateDrawTypeAndModifyDrawDefinition(params){return generateDrawTypeAndModifyDrawDefinition$1(params)},applyLineUps:function applyLineUps({tournamentRecord,drawDefinition,matchUpId,lineUps,event}){var _a,_b,_c;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!drawDefinition)return{error:DRAW_DEFINITION_NOT_FOUND};if("string"!=typeof matchUpId)return{error:INVALID_MATCHUP};if(!Array.isArray(lineUps))return{error:INVALID_VALUES,lineUps};const tournamentParticipants=tournamentRecord.participants||[];let result=findMatchUp$1({tournamentParticipants,inContext:!0,drawDefinition,matchUpId});if(result.error)return result;const{matchUp:inContextMatchUp,structure}=result,{drawPositions,matchUpType}=inContextMatchUp;if(matchUpType!==TEAM$2)return{error:INVALID_MATCHUP};if(!(null==drawPositions?void 0:drawPositions.length))return{error:MISSING_DRAW_POSITIONS};const tieFormat=inContextMatchUp.tieFormat||structure.tieFormat||drawDefinition.tieFormat||event.tieFormat||tournamentRecord.tieFormat,sideAssignments={};for(const lineUp of lineUps){if(!Array.isArray(lineUp))return{error:INVALID_VALUES,lineUp};const collectionParticipantIds={},sideNumbers=[];for(const lineUpAssignment of lineUp){if("object"!=typeof lineUpAssignment)return{error:INVALID_VALUES,lineUpAssignment};const{participantId,collectionAssignments=[]}=lineUpAssignment;if(!Array.isArray(collectionAssignments))return{error:INVALID_VALUES,collectionAssignments};const participant=tournamentParticipants.find((participant2=>participant2.participantId===participantId));if(!participant)return{error:PARTICIPANT_NOT_FOUND};if(!participant.participantType===INDIVIDUAL)return{error:INVALID_PARTICIPANT_TYPE};const sideNumber2=null==(_b=null==(_a=inContextMatchUp.sides)?void 0:_a.find((side=>{var _a2,_b2;return null==(_b2=null==(_a2=side.participant)?void 0:_a2.individualParticipantIds)?void 0:_b2.includes(participantId)})))?void 0:_b.sideNumber;sideNumber2&&sideNumbers.push(sideNumber2);for(const collectionAssignment of collectionAssignments){if("object"!=typeof collectionAssignment)return{error:INVALID_VALUES,collectionAssignment};const{collectionId,collectionPosition}=collectionAssignment,collectionDefinition=null==(_c=null==tieFormat?void 0:tieFormat.collectionDefinitions)?void 0:_c.find((collectionDefinition2=>collectionDefinition2.collectionId===collectionId));if(!collectionDefinition)return{error:INVALID_VALUES,collectionId};const aggregator=`${collectionId}-${collectionPosition}`;collectionParticipantIds[aggregator]||(collectionParticipantIds[aggregator]=[]);const participantCount=collectionParticipantIds[aggregator].length;if(collectionDefinition.matchUpType===SINGLES$1&&participantCount||collectionDefinition.matchUpType===DOUBLES$1&&participantCount>1)return{info:"Excessive collectionPosition assignments",error:INVALID_VALUES};collectionParticipantIds[aggregator].push(participantId)}}for(const participantIds of Object.values(collectionParticipantIds))if(2===participantIds.length){const{pairedParticipant}=getPairedParticipant({tournamentParticipants,participantIds});if(!pairedParticipant){const result2=addParticipant$1({participant:{participantType:PAIR,participantRole:COMPETITOR,individualParticipantIds:participantIds},pairOverride:!0,tournamentRecord});if(result2.error)return result2}}const instances=instanceCount(sideNumbers),sideNumber=(instances[1]||0)>(instances[2]||0)?1:(instances[2]||0)>(instances[1]||0)?2:void 0;sideNumber&&!Object.keys(sideAssignments).includes(sideNumber)&&(sideAssignments[sideNumber]=lineUp)}if(!Object.keys(sideAssignments).length)return{error:VALUE_UNCHANGED};if(result=findMatchUp$1({drawDefinition,matchUpId}),result.error)return result;const{matchUp}=result;matchUp.sides||(matchUp.sides=[]);for(const sideNumber of[1,2]){const side=matchUp.sides.find((side2=>side2.sideNumber===sideNumber)),assignment=sideAssignments[sideNumber];assignment&&(side?side.lineUp=assignment:matchUp.sides.push({lineUp:assignment,sideNumber}))}return modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,context:"applyLineUps",drawDefinition,matchUp}),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$s.call(b,prop)&&__defNormalProp$s(a,prop,b[prop]);if(__getOwnPropSymbols$s)for(var prop of __getOwnPropSymbols$s(b))__propIsEnum$s.call(b,prop)&&__defNormalProp$s(a,prop,b[prop]);return a})({},SUCCESS)},assignTieMatchUpParticipantId,removeTieMatchUpParticipantId:function removeTieMatchUpParticipantId(params){var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l;const{tournamentRecord,drawDefinition,participantId,event}=params,stack="removeTieMatchUpParticiapantId";if(!participantId)return decorateResult({result:{error:MISSING_PARTICIPANT_ID},stack});const matchUpContext=getTieMatchUpContext(params);if(matchUpContext.error)return matchUpContext;const{appliedPolicies}=getAppliedPolicies({tournamentRecord,drawDefinition,event}),matchUpActionsPolicy=(null==appliedPolicies?void 0:appliedPolicies[POLICY_TYPE_MATCHUP_ACTIONS])||POLICY_MATCHUP_ACTIONS_DEFAULT[POLICY_TYPE_MATCHUP_ACTIONS],substitutionProcessCodes=null==matchUpActionsPolicy?void 0:matchUpActionsPolicy.substitutionProcessCodes,{inContextDualMatchUp,inContextTieMatchUp,relevantAssignments,collectionPosition,teamParticipants,collectionId,matchUpType,dualMatchUp,tieMatchUp,tieFormat}=matchUpContext,side=null==(_a=inContextTieMatchUp.sides)?void 0:_a.find((side2=>{var _a2,_b2,_c2;return(null==(_a2=side2.participant)?void 0:_a2.participantId)===participantId||(null==(_c2=null==(_b2=side2.participant)?void 0:_b2.individualParticipantIds)?void 0:_c2.includes(participantId))}));if(!side)return{error:PARTICIPANT_NOT_FOUND};if(!(null==(_b=side.substitutions)?void 0:_b.length)&&(scoreHasValue({score:inContextTieMatchUp.score})||inContextTieMatchUp.winningSide))return{error:EXISTING_OUTCOME};const teamParticipantId=null==(_d=null==(_c=inContextDualMatchUp.sides)?void 0:_c.find((({sideNumber})=>sideNumber===side.sideNumber)))?void 0:_d.participantId;if(!teamParticipantId)return{error:PARTICIPANT_NOT_FOUND};const{tournamentParticipants:[participantToRemove]}=getTournamentParticipants({tournamentRecord,participantFilters:{participantIds:[participantId]}});if(!participantToRemove)return{error:PARTICIPANT_NOT_FOUND};if(matchUpType===SINGLES$1&&participantToRemove.participantType===PAIR)return{error:INVALID_PARTICIPANT};const participantIds=participantToRemove.participantType===INDIVIDUAL?[participantId]:participantToRemove.individualParticipantIds;if(!(null==(_e=dualMatchUp.sides)?void 0:_e.length)){const{extension}=findExtension$1({element:drawDefinition,name:LINEUPS}),lineUps=(null==extension?void 0:extension.value)||{},extractSideDetail=({displaySideNumber,drawPosition,sideNumber})=>({drawPosition,sideNumber,displaySideNumber});dualMatchUp.sides=inContextDualMatchUp.sides.map((side2=>{const participantId2=side2.participantId;return __spreadProps$v(__spreadValues$Z({},extractSideDetail(side2)),{lineUp:participantId2&&lineUps[participantId2]||[]})}))}let dualMatchUpSide=null==(_f=dualMatchUp.sides)?void 0:_f.find((({sideNumber})=>sideNumber===side.sideNumber));if(!dualMatchUpSide&&((null==(_g=dualMatchUp.sides)?void 0:_g.filter((({lineUp})=>!lineUp)).length)||0)<2){const drawPositionMap=teamParticipants.map((({participantId:teamParticipantId2})=>{var _a2;return{drawPosition:null==(_a2=relevantAssignments.find((assignment=>assignment.participantId===teamParticipantId2)))?void 0:_a2.drawPosition,teamParticipantId:teamParticipantId2}}));dualMatchUpSide=null==(_h=dualMatchUp.sides)?void 0:_h.find((side2=>{var _a2;return(null==(_a2=drawPositionMap.find((({drawPosition})=>drawPosition===side2.drawPosition)))?void 0:_a2.teamParticipantId)===teamParticipantId}))}if(!dualMatchUpSide)return console.log({teamParticipantId,teamParticipants}),{error:PARTICIPANT_NOT_FOUND,participantId};const{modifiedLineUp,previousParticipantIds}=removeCollectionAssignments({collectionPosition,teamParticipantId,dualMatchUpSide,participantIds,drawDefinition,collectionId});if(dualMatchUpSide.lineUp=modifiedLineUp,teamParticipantId&&updateTeamLineUp({participantId:teamParticipantId,lineUp:modifiedLineUp,drawDefinition,tieFormat}),matchUpType===DOUBLES$1&&participantToRemove.participantType===INDIVIDUAL){const tieMatchUpSide=null==(_i=inContextTieMatchUp.sides)?void 0:_i.find((side2=>side2.sideNumber===dualMatchUpSide.sideNumber)),{participantId:pairParticipantId}=tieMatchUpSide||{},{tournamentParticipants:[pairParticipant]}=getTournamentParticipants({tournamentRecord,participantFilters:{participantIds:[pairParticipantId]},withEvents:!0});if(!pairParticipant)return{error:PARTICIPANT_NOT_FOUND};{const individualParticipantIds=null==pairParticipant?void 0:pairParticipant.individualParticipantIds.filter((currentId=>currentId!==participantId));if(individualParticipantIds.push(...previousParticipantIds),individualParticipantIds.length>2)return{error:INVALID_PARTICIPANT_IDS};if(pairParticipant.draws.length){if(1===individualParticipantIds.length){const{participant:existingParticipant}=getPairedParticipant({participantIds:individualParticipantIds,tournamentRecord});if(!existingParticipant){const result=addParticipant$1({participant:{participantRole:COMPETITOR,individualParticipantIds,participantType:PAIR},pairOverride:!0,tournamentRecord});if(result.error)return result}}}else if(individualParticipantIds.length){pairParticipant.individualParticipantIds=individualParticipantIds;const result=modifyParticipant({participant:pairParticipant,pairOverride:!0,tournamentRecord});if(result.error)return result}else{const result=deleteParticipants({participantIds:[pairParticipantId],tournamentRecord});result.error&&console.log("cleanup",{result})}}}if(1===(null==(_j=side.substitutions)?void 0:_j.length)){const otherSide=inContextTieMatchUp.sides.find((s=>s.sideNumber!==side.sideNumber));if(!(null==(_k=null==otherSide?void 0:otherSide.substitutions)?void 0:_k.length)&&(null==(_l=tieMatchUp.processCodes)?void 0:_l.length)){for(const substitutionProcessCode of substitutionProcessCodes||[]){const codeIndex=tieMatchUp.processCodes.lastIndexOf(substitutionProcessCode);tieMatchUp.processCodes.splice(codeIndex,1)}modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUp:tieMatchUp,context:stack,drawDefinition})}}return modifyMatchUpNotice({tournamentId:null==tournamentRecord?void 0:tournamentRecord.tournamentId,matchUp:dualMatchUp,context:stack,drawDefinition}),__spreadProps$v(__spreadValues$Z({},SUCCESS),{modifiedLineUp})},replaceTieMatchUpParticipantId,updateTeamLineUp,validateLineUp,getTeamLineUp};var __defProp$o=Object.defineProperty,__defProps$h=Object.defineProperties,__getOwnPropDescs$h=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$o=Object.getOwnPropertySymbols,__hasOwnProp$o=Object.prototype.hasOwnProperty,__propIsEnum$o=Object.prototype.propertyIsEnumerable,__defNormalProp$o=(obj,key,value)=>key in obj?__defProp$o(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;function getSideValues({exclusionRule,valueAccessor,matchUpType,scaleName,sides}){const sortedRange=null==exclusionRule?void 0:exclusionRule.range.sort(),checkExcludeParticipant=scaleValue=>{const exclusionValue=null==scaleValue?void 0:scaleValue[null==exclusionRule?void 0:exclusionRule.valueAccessor];return{exclude:exclusionRule&&exclusionValue>=sortedRange[0]&&exclusionValue<=sortedRange[1],exclusionValue}};return sides.sort(((a,b)=>a.sideNumber-b.sideNumber)).map((({participant})=>{const exclusionValues=[],individualParticipants=null==participant?void 0:participant.individualParticipants;if(null==individualParticipants?void 0:individualParticipants.length){let scaleValues=[],value=0;for(const participant2 of individualParticipants){const{scaleValue,value:pValue}=getSideValue({valueAccessor,participant:participant2,matchUpType,scaleName}),{exclude,exclusionValue}=checkExcludeParticipant(scaleValue);exclude&&exclusionValues.push(exclusionValue),scaleValues.push(scaleValue),pValue&&void 0!==value?value+=pValue:value=void 0}return{participantName:participant.participantName,exclusionValues,scaleValues,value}}if(participant){const{scaleValue,value}=getSideValue({valueAccessor,matchUpType,participant,scaleName}),{exclude,exclusionValue}=checkExcludeParticipant(scaleValue);return exclude&&exclusionValues.push(exclusionValue),{participantName:participant.participantName,exclusionValues,scaleValue,value}}return{}}))}function getSideValue({participant,valueAccessor,matchUpType,scaleName}){var _a,_b,_c,_d,_e;const ranking=null==(_b=null==(_a=null==participant?void 0:participant.rankings)?void 0:_a[matchUpType])?void 0:_b.find((ranking2=>ranking2.scaleName===scaleName)),scaleValue=null==(_e=(null==(_d=null==(_c=null==participant?void 0:participant.ratings)?void 0:_c[matchUpType])?void 0:_d.find((rating2=>rating2.scaleName===scaleName)))||ranking)?void 0:_e.scaleValue;return{scaleValue,value:valueAccessor?null==scaleValue?void 0:scaleValue[valueAccessor]:scaleValue}}var __defProp$n=Object.defineProperty,__getOwnPropSymbols$n=Object.getOwnPropertySymbols,__hasOwnProp$n=Object.prototype.hasOwnProperty,__propIsEnum$n=Object.prototype.propertyIsEnumerable,__defNormalProp$n=(obj,key,value)=>key in obj?__defProp$n(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const queryGovernor={allTournamentMatchUps,tournamentMatchUps,allEventMatchUps,getRoundMatchUps:function getRoundMatchUps(params){return getRoundMatchUps$1(params)},allDrawMatchUps:allDrawMatchUps$1,eventMatchUps,drawMatchUps:function drawMatchUps$1({participants:tournamentParticipants,tournamentAppliedPolicies,scheduleVisibilityFilters,participantsProfile,afterRecoveryTimes,policyDefinitions,useParticipantMap,tournamentRecord,contextFilters,contextProfile,contextContent,drawDefinition,matchUpFilters,participantMap,nextMatchUps,tournamentId,inContext,context,event}){if(!event)return{error:MISSING_EVENT};const{eventId,eventName,endDate}=event||{},additionalContext=__spreadValues$4m(__spreadValues$4m({},context),definedAttributes({eventId,eventName,endDate:endDate||(null==event?void 0:event.endDate)||(null==tournamentRecord?void 0:tournamentRecord.endDate),tournamentId:tournamentId||(null==tournamentRecord?void 0:tournamentRecord.tournamentId),indoorOutDoor:(null==event?void 0:event.indoorOutDoor)||(null==tournamentRecord?void 0:tournamentRecord.indoorOutDoor),surfaceCategory:(null==event?void 0:event.surfaceCategory)||(null==tournamentRecord?void 0:tournamentRecord.surfaceCategory)}));return!(null==tournamentParticipants?void 0:tournamentParticipants.length)&&tournamentRecord&&({participants:tournamentParticipants,participantMap}=getParticipants$2({participantsProfile,policyDefinitions,useParticipantMap,tournamentRecord,contextProfile,inContext})),contextProfile&&!contextContent&&(contextContent=getContextContent({policyDefinitions,tournamentRecord,contextProfile,drawDefinition,event})),getDrawMatchUps({context:additionalContext,tournamentAppliedPolicies,scheduleVisibilityFilters,tournamentParticipants,participantsProfile,afterRecoveryTimes,policyDefinitions,tournamentRecord,participantMap,drawDefinition,matchUpFilters,contextFilters,contextProfile,contextContent,nextMatchUps,inContext,event})},credits,getTournamentStructures:function getTournamentStructures({withStageGrouping,tournamentRecord,stageSequences,stageSequence,roundTarget,stages,stage}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const stageStructures={},structures=[];for(const event of tournamentRecord.events||[]){const{structures:eventStructures,stageStructures:eventStageStructures}=getEventStructures({withStageGrouping,stageSequences,stageSequence,roundTarget,stages,event,stage});if(structures.push(...eventStructures),eventStageStructures)for(const stage2 of Object.keys(eventStageStructures))stageStructures[stage2]||(stageStructures[stage2]=[]),stageStructures[stage2].push(...eventStageStructures[stage2])}return{structures,stageStructures}},getEventStructures,getEvents:function getEvents({tournamentRecord,context,inContext}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{tournamentId}=tournamentRecord;return{events:(tournamentRecord.events||[]).map((event=>{const eventCopy=makeDeepCopy(event);return context&&Object.assign(eventCopy,context),inContext&&Object.assign(eventCopy,{tournamentId}),eventCopy}))}},getEvent:function getEvent({tournamentRecord,drawDefinition,event,context}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};const eventCopy=makeDeepCopy(event);return context&&Object.assign(eventCopy,context),definedAttributes({event:eventCopy,drawDefinition:drawDefinition&&(null==(_a=eventCopy.drawDefinitions)?void 0:_a.find((({drawId})=>drawDefinition.drawId===drawId)))})},findDrawDefinitionExtension,findParticipantExtension:function findParticipantExtension({tournamentRecord,participantId,name}){if(!tournamentRecord)return decorateResult({result:{error:MISSING_TOURNAMENT_RECORD},stack});if(!participantId)return decorateResult({result:{error:MISSING_PARTICIPANT_ID},stack});const{participant}=findTournamentParticipant({tournamentRecord,participantId});return findExtension$1({element:participant,name})},findTournamentExtension,findEventExtension,findExtension:findExtension$2,getTieFormat:getTieFormat$1,getMatchUpFormat,getDrawDefinition:function getDrawDefinition({tournamentRecord,drawDefinition}){return tournamentRecord?{drawDefinition:makeDeepCopy(drawDefinition)}:{error:MISSING_TOURNAMENT_RECORD}},getEventProperties:function getEventProperties({tournamentRecord,event}){var _a,_b;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!event)return{error:MISSING_EVENT};const eventEntries=event.entries||[],tournamentParticipants=tournamentRecord.participants||[],scaleName=(null==(_a=event.category)?void 0:_a.categoryName)||(null==(_b=event.category)?void 0:_b.ageCategoryCode),{eventType}=event,enteredParticipantIds=eventEntries.map((entry=>entry.participantId));let hasSeededParticipants,hasRankedParticipants,hasRatedParticipants;return{entryScaleAttributes:tournamentParticipants.filter((participant=>enteredParticipantIds.includes(participant.participantId))).map((participant=>{var _a2,_b2,_c,_d,_e,_f;const{participantId,participantName,name}=participant;let scaleAttributes={scaleType:SEEDING,eventType,scaleName};const seed=null==(_b2=null==(_a2=participantScaleItem({participant,scaleAttributes}))?void 0:_a2.scaleItem)?void 0:_b2.scaleValue;scaleAttributes={scaleType:"RANKING",eventType,scaleName};const ranking=null==(_d=null==(_c=participantScaleItem({participant,scaleAttributes}))?void 0:_c.scaleItem)?void 0:_d.scaleValue;scaleAttributes={scaleType:"RATING",eventType,scaleName};const rating=null==(_f=null==(_e=participantScaleItem({participant,scaleAttributes}))?void 0:_e.scaleItem)?void 0:_f.scaleValue;return hasSeededParticipants=!(!hasSeededParticipants&&!seed),hasRankedParticipants=!(!hasRankedParticipants&&!ranking),hasRatedParticipants=!(!hasRatedParticipants&&!rating),{participantId,participantName:participantName||name,seed,ranking,rating}})),hasSeededParticipants,hasRankedParticipants,hasRatedParticipants}},getPositionAssignments,isValidMatchUpFormat:isValid,getMaxEntryPosition:function getMaxEntryPosition({entries=[],entryStatus,stage}){return Math.max(...entries.filter((entry=>!(stage&&stage!==entry.entryStage||entryStatus&&entry.entryStatus!==entryStatus||isNaN(entry.entryPosition)))).map((({entryPosition})=>parseInt(entryPosition||0))),0)},getMatchUpCompetitiveness,findVenue,getCourts:function getCourts({tournamentRecord,venueId,venueIds}){return tournamentRecord?{courts:(tournamentRecord.venues||[]).filter((venue=>venueId?venue.venueId===venueId:venueIds?venueIds.includes(venue.venueId):!venueId&&!venueIds)).map((venue=>{const{venueId:venueId2}=venue,venueCourts=makeDeepCopy(venue.courts||[]);return venueCourts.forEach((court=>Object.assign(court,{venueId:venueId2}))),venueCourts})).flat()}:{error:MISSING_TOURNAMENT_RECORD}},getVenuesAndCourts:getVenuesAndCourts$1,findCourt:function publicFindCourt(params){return makeDeepCopy(findCourt(params),!1,!0)},getEventTimeItem,getTournamentTimeItem,getParticipantTimeItem:function getParticipantTimeItem({returnPreviousValues,tournamentRecord,participantId,itemSubTypes,itemType}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participantId)return{error:MISSING_PARTICIPANT_ID};const result=findTournamentParticipant({tournamentRecord,participantId});if(result.error)return result;const{participant}=result;if(!(null==participant?void 0:participant.timeItems))return{info:NOT_FOUND};const{timeItem,previousItems,info}=getTimeItem({element:result.participant,returnPreviousValues,itemSubTypes,itemType});return timeItem&&{timeItem,previousItems}||{info}},getDrawDefinitionTimeItem:function getDrawDefinitionTimeItem({returnPreviousValues,drawDefinition,itemSubTypes,itemType}){if(!drawDefinition)return{error:MISSING_DRAW_ID};if(!drawDefinition.timeItems)return{info:NOT_FOUND};const{timeItem,previousItems,info}=getTimeItem({element:drawDefinition,returnPreviousValues,itemSubTypes,itemType});return timeItem&&{timeItem,previousItems}||{info}},bulkUpdatePublishedEventIds:function bulkUpdatePublishedEventIds({tournamentRecord,outcomes}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!(null==outcomes?void 0:outcomes.length))return{error:MISSING_VALUE,info:"Missing outcomes"};const eventIdsMap=outcomes.reduce(((eventIdsMap2,outcome)=>{const{drawId,eventId}=outcome;return eventId&&drawId&&(eventIdsMap2[eventId]?eventIdsMap2[eventId].includes(drawId)||eventIdsMap2[eventId].push(drawId):eventIdsMap2[eventId]=[drawId]),eventIdsMap2}),{}),relevantEventsIds=Object.keys(eventIdsMap);return{publishedEventIds:(null==(_a=tournamentRecord.events)?void 0:_a.filter((event=>relevantEventsIds.includes(event.eventId)))).filter((event=>{const{timeItem}=getEventTimeItem({itemType:`${PUBLISH}.${STATUS$1}`,event}),pubState=null==timeItem?void 0:timeItem.itemValue,{eventId}=event;return eventIdsMap[eventId].filter((drawId=>{var _a2;return pubState&&pubState[PUBLIC]&&(null==(_a2=pubState[PUBLIC].drawIds)?void 0:_a2.includes(drawId))})).length})).map((event=>event.eventId)),eventIdPublishedDrawIdsMap:eventIdsMap}},matchUpActions:matchUpActions$1,positionActions:function positionActions(params){const{tournamentRecord}=params;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{tournamentParticipants}=getTournamentParticipants({tournamentRecord,inContext:!0});return positionActions$1(((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2n.call(b,prop)&&__defNormalProp$2m(a,prop,b[prop]);if(__getOwnPropSymbols$2n)for(var prop of __getOwnPropSymbols$2n(b))__propIsEnum$2n.call(b,prop)&&__defNormalProp$2m(a,prop,b[prop]);return a})({tournamentParticipants},params))},findMatchUp:function publicFindMatchUp(params){Object.assign(params,{inContext:!0});const{matchUp,error}=findMatchUp(params);return{matchUp:makeDeepCopy(matchUp,!0,!0),error}},participantScheduledMatchUps,getPredictiveAccuracy:function getPredictiveAccuracy({tournamentRecord,ascending=!0,drawDefinition,excludeMargin,exclusionRule,valueAccessor,zoneDoubling,matchUpType,zoneMargin,scaleName,matchUps,eventId,drawId,event}){var _a,_b,_c,_d;if(!tournamentRecord&&!matchUps)return{error:MISSING_TOURNAMENT_RECORD};if(matchUpType&&![SINGLES$1,DOUBLES$1].includes(matchUpType))return{error:INVALID_VALUES,info:{matchUpType}};if(!Array.isArray(matchUps)&&matchUps)return{error:INVALID_VALUES,context:{matchUps}};const contextProfile={withScaleValues:!0,withCompetitiveness:!0},contextFilters={matchUpTypes:matchUpType?[matchUpType]:[SINGLES$1,DOUBLES$1]},participants=null==tournamentRecord?void 0:tournamentRecord.participants;(null==(_a=null==matchUps?void 0:matchUps[0])?void 0:_a.hasContext)?drawId?matchUps=matchUps.filter((matchUp=>matchUp.drawId===drawId)):eventId&&(matchUps=matchUps.filter((matchUp=>matchUp.eventId===eventId))):void 0===matchUps&&(matchUps=drawId&&!drawDefinition&&[]||!drawId&&eventId&&!event&&[]||drawId&&(null==(_b=allDrawMatchUps$1({inContext:!0,drawDefinition,contextFilters,contextProfile,participants}))?void 0:_b.matchUps)||!drawId&&eventId&&(null==(_c=allEventMatchUps({inContext:!0,contextFilters,contextProfile,participants,event}))?void 0:_c.matchUps)||(null==(_d=allTournamentMatchUps({tournamentRecord,contextFilters,contextProfile}))?void 0:_d.matchUps)||[]),matchUpType&&(matchUps=matchUps.filter((matchUp=>matchUp.matchUpType===matchUpType)));const relevantMatchUps=matchUps.filter((({winningSide,score,sides,matchUpStatus})=>![RETIRED$1,DEFAULTED,WALKOVER$2,DEAD_RUBBER,ABANDONED].includes(matchUpStatus)&&scoreHasValue({score})&&2===(null==sides?void 0:sides.length)&&winningSide)),accuracy=function getGroupingAccuracy({excludeMargin,exclusionRule,valueAccessor,ascending,scaleName,matchUps}){const accuracy={affirmative:[],negative:[],excluded:[]};for(const matchUp of matchUps){const{matchUpType,sides,score,winningSide}=matchUp;if(!winningSide)continue;if(exclusionRule&&(!exclusionRule.valueAccessor||!exclusionRule.range))return{info:"exclusionRule requires valueAccessor and range",error:MISSING_VALUE};const winningIndex=winningSide-1,sideValues=getSideValues({exclusionRule,valueAccessor,matchUpType,scaleName,score,sides});if(exclusionRule){const exclusionValues=sideValues.map((({exclusionValues:exclusionValues2})=>exclusionValues2)).flat();if(exclusionValues.length){accuracy.excluded.push({scoreString:null==score?void 0:score.scoreStringSide1,exclusionValues,winningSide,sideValues});continue}}if(sideValues.filter((value=>![void 0,"",null].includes(value.value))).length<2){accuracy.excluded.push({scoreString:null==score?void 0:score.scoreStringSide1,missingValues:!0,winningSide,sideValues});continue}const valuesGap=sideValues[winningIndex].value-sideValues[1-winningIndex].value,floatMargin=parseFloat(excludeMargin),excludeGap=floatMargin&&Math.abs(valuesGap)<floatMargin;if(excludeGap){accuracy.excluded.push({scoreString:null==score?void 0:score.scoreStringSide1,excludeMargin,winningSide,excludeGap,sideValues,valuesGap});continue}const signedGap=ascending?-1*valuesGap:valuesGap,winningScoreString=1===winningSide?null==score?void 0:score.scoreStringSide1:null==score?void 0:score.scoreStringSide2;signedGap>0?accuracy.affirmative.push({winningScoreString,winningSide,sideValues,valuesGap,score}):accuracy.negative.push({winningScoreString,winningSide,sideValues,valuesGap,score})}const denominator=accuracy.affirmative.length+accuracy.negative.length,percent=denominator&&accuracy.affirmative.length/denominator*100;return accuracy.percent=percent?Math.round(100*percent)/100:0,accuracy}({matchUps:relevantMatchUps,excludeMargin,exclusionRule,valueAccessor,ascending,scaleName}),marginCalc=zoneDoubling&&matchUpType!==SINGLES$1?2*zoneMargin:zoneMargin,zoneData=zoneMargin&&relevantMatchUps.map((({competitiveness,matchUpType:matchUpType2,score,sides})=>{const sideValues=getSideValues({valueAccessor,matchUpType:matchUpType2,scaleName,score,sides});return{competitiveness,score,valuesGap:Math.abs(sideValues[0].value-sideValues[1].value)}})).filter((({valuesGap})=>valuesGap<=marginCalc)),zoneBands=(null==zoneData?void 0:zoneData.length)&&function getGroupingBands({zoneData}){const bands={[COMPETITIVE]:[],[ROUTINE]:[],[DECISIVE]:[]};for(const data of zoneData){const{competitiveness,score,valuesGap}=data;bands[competitiveness]&&bands[competitiveness].push({score,valuesGap})}return bands}({zoneData}),totalZoneMatchUps=zoneBands&&[].concat(Object.values(zoneBands)).flat().length,zoneDistribution=totalZoneMatchUps&&Object.assign({},...Object.keys(zoneBands).map((key=>({[key]:Math.round(1e4*zoneBands[key].length/totalZoneMatchUps)/100})))),nonZone=relevantMatchUps.length-((null==zoneData?void 0:zoneData.length)||0);return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$o.call(b,prop)&&__defNormalProp$o(a,prop,b[prop]);if(__getOwnPropSymbols$o)for(var prop of __getOwnPropSymbols$o(b))__propIsEnum$o.call(b,prop)&&__defNormalProp$o(a,prop,b[prop]);return a})({},SUCCESS),__defProps$h(a,__getOwnPropDescs$h({relevantMatchUps,zoneDistribution,zoneData,accuracy,nonZone}));var a},getMatchUpsStats:function getMatchUpsStats({competitiveProfile,tournamentRecord,matchUps}){if(!Array.isArray(matchUps))return{error:MISSING_MATCHUPS};const policy=!competitiveProfile&&findPolicy({policyType:POLICY_TYPE_COMPETITIVE_BANDS,tournamentRecord}).policy,bandProfiles=competitiveProfile||(null==policy?void 0:policy.competitiveProfile)||POLICY_COMPETITIVE_BANDS_DEFAULT[POLICY_TYPE_COMPETITIVE_BANDS].competitiveProfile,relevantMatchUps=matchUps.filter((({winningSide})=>winningSide)),pctspd=pctSpread(relevantMatchUps.map(getScoreComponents)).reduce(((p,c)=>((p,spread)=>(p[getBand(spread,bandProfiles)]+=1,p))(p,c)),{[COMPETITIVE]:0,[ROUTINE]:0,[DECISIVE]:0,[WALKOVER$1]:0}),total=Object.keys(pctspd).reduce(((a,k)=>(pctspd[k]||0)+a),0),competitiveBands=Object.keys(pctspd).map((k=>({[k]:100*(pctspd[k]/total).toFixed(4)}))),retiredCount=relevantMatchUps.filter((({matchUpStatus})=>"RETIRED"===matchUpStatus));return competitiveBands.push({RETIRED:100*(retiredCount/total).toFixed(4)}),((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$n.call(b,prop)&&__defNormalProp$n(a,prop,b[prop]);if(__getOwnPropSymbols$n)for(var prop of __getOwnPropSymbols$n(b))__propIsEnum$n.call(b,prop)&&__defNormalProp$n(a,prop,b[prop]);return a})({competitiveBands:Object.assign({},...competitiveBands)},SUCCESS)},participantScaleItem,getParticipantScaleItem,getParticipantSignInStatus:function getParticipantSignInStatus({tournamentRecord,participantId}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!participantId)return{error:MISSING_PARTICIPANT_ID};const{participant}=findTournamentParticipant({tournamentRecord,participantId});if(!participant)return{error:PARTICIPANT_NOT_FOUND};const{timeItem}=getTimeItem({itemType:SIGN_IN_STATUS,element:participant});return timeItem&&timeItem.itemValue===SIGNED_IN&&SIGNED_IN},getPolicyDefinitions,getMatchUpScheduleDetails},locationGovernor={addVenue:addVenue$1,deleteVenue:deleteVenue$1,deleteVenues:function deleteVenues({tournamentRecord,venueIds,force}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(venueIds))return{error:INVALID_VALUES};for(const venue of tournamentRecord.venues||[]){const{venueId}=venue;if(venueIds.includes(venueId)){const{venueId:venueId2}=venue,result=deleteVenue$1({tournamentRecord,venueId:venueId2,force});if(result.error)return result}}return __spreadValues$2V({},SUCCESS)},modifyVenue:modifyVenue$1,enableCourts:enableCourts$1,enableVenues:enableVenues$1,disableCourts:disableCourts$1,disableVenues:disableVenues$1,addCourt,addCourts:addCourts$1,deleteCourt:deleteCourt$1,modifyCourt:modifyCourt$1,modifyCourtAvailability,findVenue:function publicFindVenue(_a){var _b=_a,{convertExtensions}=_b;return makeDeepCopy(findVenue(((source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$4E.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols$4E)for(var prop of __getOwnPropSymbols$4E(source))exclude.indexOf(prop)<0&&__propIsEnum$4E.call(source,prop)&&(target[prop]=source[prop]);return target})(_b,["convertExtensions"])),convertExtensions,!0)}};var __defProp$m=Object.defineProperty,__defProps$g=Object.defineProperties,__getOwnPropDescs$g=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$m=Object.getOwnPropertySymbols,__hasOwnProp$m=Object.prototype.hasOwnProperty,__propIsEnum$m=Object.prototype.propertyIsEnumerable,__defNormalProp$m=(obj,key,value)=>key in obj?__defProp$m(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$m=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$m.call(b,prop)&&__defNormalProp$m(a,prop,b[prop]);if(__getOwnPropSymbols$m)for(var prop of __getOwnPropSymbols$m(b))__propIsEnum$m.call(b,prop)&&__defNormalProp$m(a,prop,b[prop]);return a},__spreadProps$g=(a,b)=>__defProps$g(a,__getOwnPropDescs$g(b));const tournamentEngine=function(){const engine={getState:({convertExtensions,removeExtensions}={})=>getState$1({convertExtensions,removeExtensions,tournamentId:getTournamentId()}),newTournamentRecord:(params={})=>{const result=newTournamentRecord(params);return result.error?result:(setTournamentRecord$1(result),setTournamentId(result.tournamentId),Object.assign({tournamentId:result.tournamentId},SUCCESS))},setTournamentId:newTournamentId=>setTournamentId(newTournamentId)};function processResult(result){return(null==result?void 0:result.error)?(engine.error=result.error,engine.success=!1):(engine.error=void 0,engine.success=!0),engine}return engine.version=()=>"1.0.3",engine.reset=()=>processResult(removeTournamentRecord(getTournamentId())),engine.setState=(tournament,deepCopyOption,deepCopyAttributes)=>{setDeepCopy(deepCopyOption,deepCopyAttributes);return processResult(setState$1(tournament,deepCopyOption))},engine.devContext=contextCriteria=>(setDevContext(contextCriteria),engine),engine.getDevContext=contextCriteria=>getDevContext(contextCriteria),engine.executionQueue=(directives,rollbackOnError)=>function executionQueue(directives,rollbackOnError){var _a;if(!Array.isArray(directives))return{error:INVALID_VALUES};const tournamentId=getTournamentId(),tournamentRecord=getTournamentRecord(tournamentId),snapshot=rollbackOnError&&makeDeepCopy(tournamentRecord,!1,!0),results=[];for(const directive of directives){if("object"!=typeof directive)return{error:INVALID_VALUES};const{method:methodName,params}=directive;if(!engine[methodName]){const result3={error:METHOD_NOT_FOUND,methodName},devContext=getDevContext();return(devContext.result&&!Array.isArray(devContext.result)||Array.isArray(devContext.result)&&(null==(_a=devContext.result)?void 0:_a.includes(methodName)))&&console.log("te:",result3),result3}const result2=executeFunction(tournamentRecord,engine[methodName],params,methodName);if(null==result2?void 0:result2.error)return snapshot&&setState$1(snapshot),__spreadProps$g(__spreadValues$m({},result2),{rolledBack:!!snapshot});results.push(result2)}const mutationStatus=cycleMutationStatus(),timeStamp=Date.now();mutationStatus&&updateFactoryExtension({tournamentRecord,value:{version:"1.0.3",timeStamp}});notifySubscribers({directives,mutationStatus,timeStamp,tournamentId}),deleteNotices();return{success:results.every((r=>r.success)),results}}(directives,rollbackOnError),function importGovernors(governors){governors.forEach((governor=>{Object.keys(governor).forEach((methodName=>{engine[methodName]=params=>{if(getDevContext())return engineInvoke(governor[methodName],params,methodName);try{return engineInvoke(governor[methodName],params,methodName)}catch(err){const tournamentId=getTournamentId(),error=err.toString();console.log("ERROR",{params:JSON.stringify(params),tournamentId,methodName,error})}}}))}))}([queryGovernor,eventGovernor,locationGovernor,policyGovernor,reportGovernor,scheduleGovernor,publishingGovernor,tournamentGovernor,participantGovernor]),engine;function executeFunction(tournamentRecord,method,params,methodName){var _a,_b;delete engine.success,delete engine.error;const start=Date.now(),augmentedParams=paramsMiddleware$1(tournamentRecord,params),result=method(__spreadProps$g(__spreadValues$m({},augmentedParams),{tournamentRecord})),elapsed=Date.now()-start,devContext=getDevContext(),log={method:methodName},logErrors="object"==typeof devContext.result&&devContext.result.error;return![void 0,!1].includes(devContext.perf)&&(isNaN(devContext.perf)||elapsed>devContext.perf)&&(log.elapsed=elapsed),(logErrors||devContext.params&&!Array.isArray(devContext.params)||Array.isArray(devContext.params)&&(null==(_a=devContext.params)?void 0:_a.includes(methodName)))&&(log.params=params),(logErrors||!logErrors&&devContext.result&&!Array.isArray(devContext.result)||Array.isArray(devContext.result)&&(null==(_b=devContext.result)?void 0:_b.includes(methodName)))&&(log.result=result),Object.keys(log).length>1&&console.log("te:",log),devContext.makeDeepCopy&&(result.deepCopyIterations=function getDeepCopyIterations(){return globalState.iterators.makeDeepCopy}()),result}function engineInvoke(method,params,methodName){const tournamentId=getTournamentId(),tournamentRecord=(null==params?void 0:params.sandBoxRecord)||(null==params?void 0:params.sandboxRecord)||(null==params?void 0:params.sandboxTournament)||getTournamentRecord(tournamentId),snapshot=(null==params?void 0:params.rollbackOnError)&&makeDeepCopy(tournamentRecord,!1,!0),result=executeFunction(tournamentRecord,method,params,methodName);(null==result?void 0:result.error)&&snapshot&&setState$1(snapshot);const notify=(null==result?void 0:result.success)&&!0!==(null==params?void 0:params.delayNotify)&&!0!==(null==params?void 0:params.doNotNotify),mutationStatus=cycleMutationStatus(),timeStamp=Date.now();return mutationStatus&&(updateFactoryExtension({tournamentRecord,value:{version:"1.0.3",timeStamp}}),result.modificationsApplied=!0),notify&&notifySubscribers({directives:[{method,params}],mutationStatus,tournamentId,timeStamp}),(notify||!(null==result?void 0:result.success)||(null==params?void 0:params.doNotNotify))&&deleteNotices(),result}}();Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;var __defProp$k=Object.defineProperty,__getOwnPropSymbols$k=Object.getOwnPropertySymbols,__hasOwnProp$k=Object.prototype.hasOwnProperty,__propIsEnum$k=Object.prototype.propertyIsEnumerable,__defNormalProp$k=(obj,key,value)=>key in obj?__defProp$k(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$k=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$k.call(b,prop)&&__defNormalProp$k(a,prop,b[prop]);if(__getOwnPropSymbols$k)for(var prop of __getOwnPropSymbols$k(b))__propIsEnum$k.call(b,prop)&&__defNormalProp$k(a,prop,b[prop]);return a};function setState(tournament,deepCopyOption){var _a;if("object"!=typeof tournament)return{error:INVALID_OBJECT};const tournamentId=(null==(_a=tournament.unifiedTournamentId)?void 0:_a.tournamentId)||tournament.tournamentId;if(!tournamentId)return{error:MISSING_TOURNAMENT_ID};const tournamentRecord=!1!==deepCopyOption?makeDeepCopy(tournament):tournament;return setTournamentRecords({[tournamentId]:tournamentRecord}),setTournamentId(tournamentId),tournamentRecord}function getState({convertExtensions,removeExtensions,tournamentId}={}){if("string"!=typeof tournamentId)return{};return{tournamentRecord:makeDeepCopy(getTournamentRecord(tournamentId),convertExtensions,!1,removeExtensions)}}function paramsMiddleware(tournamentRecord,params){return params&&params.someParam&&(params=__spreadValues$k({},params)),params}function getTargetElement(target,element){return target&&element&&Array.isArray(element)&&element[target-1]||"object"==typeof element&&element[target]}function getAwardProfile({participation={},awardProfiles,startDate,eventType,drawSize,drawType,category,endDate,level}){const{participationOrder,flightNumber,rankingStage}=participation,awardProfile=awardProfiles.find((profile=>{var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j;return(profile=>!startDate&&!endDate||!profile.dateRanges||profile.dateRanges.some((dateRange=>{const validStartDate=!startDate||!dateRange.startDate||new Date(startDate)>new Date(dateRange.startDate),validEndDate=!endDate||!dateRange.endDate||new Date(endDate)<=new Date(dateRange.endDate);return validStartDate&&validEndDate})))(profile)&&(!profile.maxFlightNumber||flightNumber<=profile.maxFlightNumber)&&(!(null==(_a=profile.drawTypes)?void 0:_a.length)||(null==(_b=profile.drawTypes)?void 0:_b.includes(drawType)))&&(!(null==(_c=profile.drawSizes)?void 0:_c.length)||profile.drawSizes.includes(drawSize))&&(!(null==(_d=profile.stages)?void 0:_d.length)||profile.stages.includes(rankingStage))&&(!(null==(_e=profile.levels)?void 0:_e.length)||profile.levels.includes(level))&&(!profile.maxDrawSize||drawSize<=profile.maxDrawSize)&&(!profile.drawSize||profile.drawSize===drawSize)&&(!profile.maxLevel||level<=profile.maxLevel)&&(!flightNumber||!(null==(_g=null==(_f=profile.flights)?void 0:_f.flightNumbers)?void 0:_g.length)||profile.flights.flightNumbers.includes(flightNumber))&&(!profile.participationOrder||profile.participationOrder===participationOrder)&&(!(null==(_h=profile.category)?void 0:_h.ageCategoryCodes)||profile.category.ageCategoryCodes.includes(null==category?void 0:category.ageCategoryCode))&&(!(null==(_i=profile.eventTypes)?void 0:_i.length)||(null==(_j=profile.eventTypes)?void 0:_j.includes(eventType)))}));return{awardProfile}}function getAwardPoints({participantWon,flightNumber,valueObj,drawSize,flights,level}){var _a,_b;const getValue=(obj,flightNumber2)=>{const objectValue=(null==obj?void 0:obj.value)||(null==obj?void 0:obj.v)||(isConvertableInteger(obj)?obj:0),targetElement=getTargetElement(level,null==obj?void 0:obj.level),flightValue=((flightNumber2,targetElement)=>{if(flightNumber2){if(Array.isArray(targetElement)){const arrayMember=targetElement.find((m=>m.flight===flightNumber2||m.f===flightNumber2));return arrayMember.value||arrayMember.v}if("object"==typeof targetElement){const flights2=targetElement.flights||targetElement.f;if(Array.isArray(flights2))return flights2[flightNumber2-1]}}})(flightNumber2,targetElement);return{value:flightValue||isConvertableInteger(targetElement)&&targetElement||objectValue}};let requireWin,s,t,d,awardPoints=0;const winAccessor=(participantWon?"won":!1===participantWon&&"lost")||void 0;if(Array.isArray(valueObj)){let sizeDefined=valueObj.find((obj=>{var _a2;return obj.drawSize===drawSize||(null==(_a2=obj.drawSizes)?void 0:_a2.includes(drawSize))})),thresholdMatched=valueObj.find((obj=>obj.drawSize&&obj.threshold&&drawSize>obj.drawSize)),defaultDef=valueObj.find((obj=>{var _a2;return!obj.drawSize&&!(null==(_a2=obj.drawSizes)?void 0:_a2.length)}));void 0!==winAccessor&&(sizeDefined=null==sizeDefined?void 0:sizeDefined[winAccessor],thresholdMatched=null==thresholdMatched?void 0:thresholdMatched[winAccessor],defaultDef=null==defaultDef?void 0:defaultDef[winAccessor]),s=getValue(sizeDefined,flightNumber).value,t=getValue(thresholdMatched,flightNumber).value,d=getValue(defaultDef,flightNumber).value,awardPoints=s||t||d,requireWin=s&&sizeDefined.requireWin||t&&thresholdMatched.requireWin||(null==defaultDef?void 0:defaultDef.requireWin)}else if("object"==typeof valueObj){let sizeDefined=null==(_a=null==valueObj?void 0:valueObj.drawSizes)?void 0:_a[drawSize],defaultDef=valueObj;void 0!==winAccessor&&(sizeDefined=null==sizeDefined?void 0:sizeDefined[winAccessor],defaultDef=null==defaultDef?void 0:defaultDef[winAccessor]),s=getValue(sizeDefined,flightNumber).value,d=getValue(defaultDef,flightNumber).value,awardPoints=s||d,requireWin=s?sizeDefined.requireWin:null==defaultDef?void 0:defaultDef.requireWin}else isConvertableInteger(valueObj)&&void 0===winAccessor&&(awardPoints=valueObj);return(null==(_b=null==flights?void 0:flights.pct)?void 0:_b[flightNumber])&&(awardPoints=Math.round(awardPoints*flights.pct[flightNumber])),{awardPoints,requireWin}}var __defProp$j=Object.defineProperty,__getOwnPropSymbols$j=Object.getOwnPropertySymbols,__hasOwnProp$j=Object.prototype.hasOwnProperty,__propIsEnum$j=Object.prototype.propertyIsEnumerable,__defNormalProp$j=(obj,key,value)=>key in obj?__defProp$j(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const rankingsGovernor={getTournamentPoints:function getTournamentPoints({participantFilters,policyDefinitions,tournamentRecord,saveRankings,level}){var _a;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const{policyDefinitions:attachedPolicies}=getPolicyDefinitions({policyTypes:["rankingPoints"],tournamentRecord}),pointsPolicy=(null==policyDefinitions?void 0:policyDefinitions.rankingPoints)||(null==attachedPolicies?void 0:attachedPolicies.rankingPoints);if(!pointsPolicy)return{error:MISSING_POLICY_DEFINITION};const awardProfiles=pointsPolicy.awardProfiles;let requireWinFirstRound=pointsPolicy.requireWinFirstRound,requireWinForPoints=pointsPolicy.requireWinForPoints;const{participants,derivedEventInfo,derivedDrawInfo,mappedMatchUps}=getParticipants$1({withRankingProfile:!0,participantFilters,tournamentRecord}),participantsWithOutcomes=participants.filter((p=>{var _a2;return null==(_a2=p.draws)?void 0:_a2.length})),personPoints={},teamPoints={},pairPoints={};for(const participant of participantsWithOutcomes){const{participantType,participantId,person,draws}=participant;for(const draw of draws){const{drawId,structureParticipation,eventId}=draw,eventInfo=derivedEventInfo[eventId],drawInfo=derivedDrawInfo[drawId],drawType=null==drawInfo?void 0:drawInfo.drawType,{category,eventType}=eventInfo||{},startDate=draw.startDate||eventInfo.startDate||tournamentRecord.startDate,endDate=draw.endDate||eventInfo.endDate||tournamentRecord.endDate;if(eventType===TEAM_EVENT&&participantId!==TEAM_PARTICIPANT)continue;let points;if(awardProfiles){let rangeAccessor,requireWin=requireWinForPoints,totalWinsCount=0,positionPoints=0,perWinPoints=0;for(const participation of structureParticipation){const{finishingPositionRange,participationOrder,participantWon,flightNumber,rankingStage,winCount}=participation;totalWinsCount+=winCount||0;const drawSize=null==drawInfo?void 0:drawInfo.drawSize,{awardProfile}=getAwardProfile({awardProfiles,participation,eventType,startDate,category,drawSize,drawType,endDate,level});if(awardProfile){if(!drawSize)continue;const accessor=Array.isArray(finishingPositionRange)&&Math.max(...finishingPositionRange),dashRange=unique(finishingPositionRange||[]).join("-"),firstRound=accessor&&rankingStage!==QUALIFYING&&(null==finishingPositionRange?void 0:finishingPositionRange.includes(drawSize));void 0!==awardProfile.requireWinForPoints&&(requireWin=awardProfile.requireWinForPoints),void 0!==awardProfile.requireWinFirstRound&&(requireWinFirstRound=awardProfile.requireWinFirstRound);const{finishingPositionPoints={},finishingPositionRanges,finishingRound,pointsPerWin,flights}=awardProfile,ppwProfile=Array.isArray(awardProfile.perWinPoints)?null==(_a=awardProfile.perWinPoints)?void 0:_a.find((pwp=>{var _a2;return null==(_a2=pwp.participationOrders)?void 0:_a2.includes(participationOrder)})):awardProfile.perWinPoints,participationOrders=finishingPositionPoints.participationOrders;let winRequired,awardPoints=0;if((!participationOrders||participationOrders.includes(participationOrder))&&finishingPositionRanges){const valueObj=finishingPositionRanges[accessor];valueObj&&({awardPoints,requireWin:winRequired}=getAwardPoints({flightNumber,valueObj,drawSize,flights,level}))}if(!awardPoints&&finishingRound&&1===participationOrder){const valueObj=finishingRound[accessor];valueObj&&({awardPoints,requireWin:winRequired}=getAwardPoints({participantWon,flightNumber,valueObj,drawSize,flights,level}))}if(firstRound&&void 0!==requireWinFirstRound&&(requireWin=requireWinFirstRound),void 0!==winRequired&&(requireWin=winRequired),awardPoints>positionPoints&&(!requireWin||winCount)&&(positionPoints=awardPoints,rangeAccessor=accessor),!awardPoints&&pointsPerWin&&winCount&&(perWinPoints+=winCount*pointsPerWin,rangeAccessor=dashRange),!awardPoints&&winCount&&ppwProfile){const levelValue=getTargetElement(level,null==ppwProfile?void 0:ppwProfile.level);levelValue?perWinPoints+=winCount*levelValue:ppwProfile.value&&(perWinPoints+=winCount*ppwProfile.value)}}if(points=positionPoints+perWinPoints,participantType===TEAM_PARTICIPANT){const teamStructureMatchUps=(participant.matchUps||[]).filter((({structureId})=>structureId===participation.structureId));for(const{matchUpId}of teamStructureMatchUps){const matchUp=mappedMatchUps[matchUpId],sideNumber=matchUp.sides.find((side=>side.participantId===participantId)).sideNumber;if(matchUp.winningSice===sideNumber)for(const tieMatchUp of matchUp.tieMatchUps)tieMatchUp.winningSide}}}if(perWinPoints||positionPoints){const award={winCount:totalWinsCount,positionPoints,rangeAccessor,perWinPoints,eventType,drawId,points},personId=null==person?void 0:person.personId;personId?(personPoints[personId]||(personPoints[personId]=[]),personPoints[personId].push(award)):participantType===PAIR?(pairPoints[participantId]||(pairPoints[participantId]=[]),pairPoints[participantId].push(award)):participantType===TEAM_PARTICIPANT&&(teamPoints[participantId]||(teamPoints[participantId]=[]),teamPoints[participantId].push(award))}}}}if(saveRankings){addExtension$1({element:tournamentRecord,extension:{name:"rankingPoints",value:{personPoints,teamPoints,pairPoints}}})}return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$j.call(b,prop)&&__defNormalProp$j(a,prop,b[prop]);if(__getOwnPropSymbols$j)for(var prop of __getOwnPropSymbols$j(b))__propIsEnum$j.call(b,prop)&&__defNormalProp$j(a,prop,b[prop]);return a})({participantsWithOutcomes,personPoints,pairPoints,teamPoints},SUCCESS)}},ratingsParameters={[ELO]:{range:[0,3e3],decimalsCount:0,defaultInitialization:1500},NTRP:{range:[1,7],decimalsCount:1,defaultInitialization:3,accessor:"dntrpRatingHundredths",accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""}},UTR:{range:[1,16],decimalsCount:2,defaultInitialization:6},[WTN]:{range:[40,1],decimalsCount:2,defaultInitialization:23,accessor:"wtnRating",accessors:["wtnRating"],attributes:{confidence:{generator:!0,range:[60,100]}}}};const eloConfig={nSpread:400,diffThreshold:.125,kCalc:countables=>250/Math.pow(countables+5,.4),kMultiplier:function kSet(maxCountables=3,counted=2){let kset=maxCountables/counted;return isNaN(kset)?eloConfig.kDefault():kset},kDefault:()=>1};function calculateNewRatings({ratings=ratingsParameters,winnerCountables=1,loserCountables=0,ratingType=ELO,maxCountables,winnerRating,loserRating,ratingRange,countables}={}){const ratingParameters=null==ratings?void 0:ratings[ratingType];if(!ratingParameters)return{error:MISSING_VALUE};ratingRange=ratingParameters.range||ratingRange,winnerRating=winnerRating||ratingParameters.defaultInitialization,loserRating=loserRating||ratingParameters.defaultInitialization;const invertedScale=ratingRange[0]>ratingRange[1],decimalPlaces=ratingParameters.decimalsCount||0,consideredRange=invertedScale?ratingRange.slice().reverse():ratingRange,inRange=(range,value)=>parseFloat(value)>=Math.min(...range)&&parseFloat(value)<=Math.max(...range);inRange(ratingRange,winnerRating)&&inRange(ratingRange,loserRating)||(inRange(ratingRange,winnerRating)||(winnerRating=ratingParameters.defaultInitialization),inRange(ratingRange,loserRating)||(loserRating=ratingParameters.defaultInitialization));const convertRange=({value,sourceRange,targetRange})=>(value-sourceRange[0])*(targetRange[1]-targetRange[0])/(sourceRange[1]-sourceRange[0])+targetRange[0],convertedWinnerRating=convertRange({targetRange:ratingsParameters[ELO].range,sourceRange:consideredRange,value:invertedScale?ratingRange[0]-winnerRating:winnerRating}),convertedLoserRating=convertRange({targetRange:ratingsParameters[ELO].range,sourceRange:consideredRange,value:invertedScale?ratingRange[0]-loserRating:loserRating}),getExpectation=(playerRating,opponentRating)=>1/(1+Math.pow(10,(opponentRating-playerRating)/eloConfig.nSpread));let winnerExpectation=getExpectation(convertedWinnerRating,convertedLoserRating),loserExpectation=getExpectation(convertedLoserRating,convertedWinnerRating),winnerKValue=eloConfig.kCalc(winnerCountables),loserKValue=eloConfig.kCalc(loserCountables),k=eloConfig.kMultiplier(maxCountables,countables),winnerUpdatedConvertedRating=convertedWinnerRating+k*winnerKValue*(1-winnerExpectation),loserUpdatedConvertedRating=convertedLoserRating+k*loserKValue*(0-loserExpectation),convertedUpdatedWinnerRating=convertRange({sourceRange:ratingsParameters[ELO].range,value:winnerUpdatedConvertedRating,targetRange:consideredRange}),convertedUpdatedLoserRating=convertRange({sourceRange:ratingsParameters[ELO].range,value:loserUpdatedConvertedRating,targetRange:consideredRange});const updatedWinnerRating=invertedScale?ratingRange[0]-convertedUpdatedWinnerRating:convertedUpdatedWinnerRating;let newWinnerRating=parseFloat(updatedWinnerRating).toFixed(decimalPlaces);const updatedLoserRating=invertedScale?ratingRange[0]-convertedUpdatedLoserRating:convertedUpdatedLoserRating;let newLoserRating=parseFloat(updatedLoserRating).toFixed(decimalPlaces);const percentageDifference=Math.max(...ratingRange)?Math.abs(winnerRating-loserRating)/Math.max(...ratingRange):0;return(convertedUpdatedWinnerRating>convertedUpdatedLoserRating&&percentageDifference>eloConfig.diffThreshold||newWinnerRating<0||newLoserRating<0)&&(newWinnerRating=winnerRating,newLoserRating=loserRating),{newWinnerRating,newLoserRating}}var __defProp$i=Object.defineProperty,__defProps$e=Object.defineProperties,__getOwnPropDescs$e=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$i=Object.getOwnPropertySymbols,__hasOwnProp$i=Object.prototype.hasOwnProperty,__propIsEnum$i=Object.prototype.propertyIsEnumerable,__defNormalProp$i=(obj,key,value)=>key in obj?__defProp$i(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$i=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$i.call(b,prop)&&__defNormalProp$i(a,prop,b[prop]);if(__getOwnPropSymbols$i)for(var prop of __getOwnPropSymbols$i(b))__propIsEnum$i.call(b,prop)&&__defNormalProp$i(a,prop,b[prop]);return a},__spreadProps$e=(a,b)=>__defProps$e(a,__getOwnPropDescs$e(b));const governor={calculateNewRatings,processMatchUps:function processMatchUps({tournamentRecord,ratingType=ELO,considerGames,matchUpIds,asDynamic}){var _a,_b;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if(!Array.isArray(matchUpIds))return{error:MISSING_MATCHUPS};if("string"!=typeof ratingType)return{error:INVALID_VALUES,ratingType};if(!ratingsParameters[ratingType])return{error:INVALID_VALUES};const ratingParameter=ratingsParameters[ratingType],{accessor}=ratingParameter,modifiedScaleValues={},{matchUps}=allTournamentMatchUps({matchUpFilters:{matchUpIds,matchUpStatuses:completedMatchUpStatuses},tournamentRecord,inContext:!0});for(const matchUp of matchUps.sort(matchUpSort)){const{endDate,matchUpFormat,matchUpType,score,sides,winningSide}=matchUp,scaleAttributes={scaleType:RATING$2,eventType:matchUpType,scaleName:ratingType},dynamicScaleName=`${ratingType}.DYNAMIC`,dynamicScaleAttributes={scaleType:RATING$2,eventType:matchUpType,scaleName:dynamicScaleName},sideParticipantIds=Object.assign({},...sides.map((({sideNumber,participant})=>({[sideNumber]:[null==participant?void 0:participant.participantId,...(null==participant?void 0:participant.individualParticipantIds)||[]].filter(Boolean).flat()})))),outputScaleName=asDynamic?dynamicScaleName:ratingType,scaleItemMap=Object.assign({},...Object.values(sideParticipantIds).flat().map((participantId=>{const{scaleItem:dynamicScaleItem}=getParticipantScaleItem({scaleAttributes:dynamicScaleAttributes,tournamentRecord,participantId}),{scaleItem}=getParticipantScaleItem({tournamentRecord,scaleAttributes,participantId});return{[participantId]:dynamicScaleItem||scaleItem||{scaleName:outputScaleName,scaleType:RATING$2,eventType:matchUpType,scaleDate:endDate,scaleValue:accessor?{[accessor]:void 0}:void 0}}}))),parsedFormat=parse(matchUpFormat)||{},bestOf=(null==parsedFormat?void 0:parsedFormat.bestOf)||1,setsTo=(null==parsedFormat?void 0:parsedFormat.setsTo)||1,maxCountables=considerGames?bestOf&setsTo:bestOf,countables=(null==score?void 0:score.sets)?(null==(sets=score.sets)?void 0:sets.reduce(((aggregate,set)=>(set.winningSide&&(aggregate[set.winningSide-1]+=1),aggregate)),[0,0]))||[0,0]:1===winningSide?[1,0]:[0,1],winningSideParticipantIds=sideParticipantIds[winningSide],losingSideParticipantIds=sideParticipantIds[3-winningSide];for(const winnerParticipantId of winningSideParticipantIds){const winnerScaleValue=null==(_a=scaleItemMap[winnerParticipantId])?void 0:_a.scaleValue,winnerRating="object"==typeof winnerScaleValue?winnerScaleValue[accessor]:winnerScaleValue;for(const loserParticipantId of losingSideParticipantIds){const loserScaleValue=null==(_b=scaleItemMap[loserParticipantId])?void 0:_b.scaleValue,loserRating="object"==typeof loserScaleValue?loserScaleValue[accessor]:loserScaleValue,winnerCountables=countables[winningSide],loserCountables=countables[3-winningSide],{newWinnerRating,newLoserRating}=calculateNewRatings({winnerCountables,loserCountables,maxCountables,winnerRating,loserRating,ratingType}),newWinnerScaleValue=accessor?__spreadProps$e(__spreadValues$i({},winnerScaleValue),{[accessor]:newWinnerRating}):newWinnerRating,newLoserScaleValue=accessor?__spreadProps$e(__spreadValues$i({},loserScaleValue),{[accessor]:newLoserRating}):newLoserRating;scaleItemMap[winnerParticipantId].scaleValue=newWinnerScaleValue,scaleItemMap[loserParticipantId].scaleValue=newLoserScaleValue;let result=setParticipantScaleItem({scaleItem:__spreadProps$e(__spreadValues$i({},scaleItemMap[winnerParticipantId]),{scaleName:outputScaleName}),participantId:winnerParticipantId,tournamentRecord});if(result.error)return result;if(result=setParticipantScaleItem({scaleItem:__spreadProps$e(__spreadValues$i({},scaleItemMap[loserParticipantId]),{scaleName:outputScaleName}),participantId:loserParticipantId,tournamentRecord}),result.error)return result}}Object.assign(modifiedScaleValues,scaleItemMap)}var sets;const processedMatchUpIds=matchUps.map((({matchUpId})=>matchUpId));return __spreadProps$e(__spreadValues$i({},SUCCESS),{modifiedScaleValues,processedMatchUpIds})}};var __defProp$h=Object.defineProperty,__defProps$d=Object.defineProperties,__getOwnPropDescs$d=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$h=Object.getOwnPropertySymbols,__hasOwnProp$h=Object.prototype.hasOwnProperty,__propIsEnum$h=Object.prototype.propertyIsEnumerable,__defNormalProp$h=(obj,key,value)=>key in obj?__defProp$h(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;!function(){const engine={getState:({convertExtensions,removeExtensions}={})=>getState({convertExtensions,removeExtensions,tournamentId:getTournamentId()}),setTournamentId:newTournamentId=>setTournamentId(newTournamentId)};function processResult(result){return(null==result?void 0:result.error)?(engine.error=result.error,engine.success=!1):(engine.error=void 0,engine.success=!0),engine}return engine.version=()=>"1.0.3",engine.reset=()=>processResult(removeTournamentRecord(getTournamentId())),engine.setState=(tournament,deepCopyOption,deepCopyAttributes)=>{setDeepCopy(deepCopyOption,deepCopyAttributes);return processResult(setState(tournament,deepCopyOption))},function importGovernors(governors){governors.forEach((governor=>{Object.keys(governor).forEach((method=>{engine[method]=params=>{if(getDevContext())return engineInvoke(governor[method],params);try{return engineInvoke(governor[method],params)}catch(err){const error=err.toString();console.log("ERROR",{error,method,params:JSON.stringify(params)})}}}))}))}([rankingsGovernor,governor]),engine;function executeFunction(tournamentRecord,method,params){delete engine.success,delete engine.error;const augmentedParams=paramsMiddleware(0,params);return method((a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$h.call(b,prop)&&__defNormalProp$h(a,prop,b[prop]);if(__getOwnPropSymbols$h)for(var prop of __getOwnPropSymbols$h(b))__propIsEnum$h.call(b,prop)&&__defNormalProp$h(a,prop,b[prop]);return a})({},augmentedParams),__defProps$d(a,__getOwnPropDescs$d({tournamentRecord}))));var a}function engineInvoke(method,params){const tournamentRecord=(null==params?void 0:params.sandBoxRecord)||(null==params?void 0:params.sandboxRecord)||(null==params?void 0:params.sandboxTournament)||getTournamentRecord(getTournamentId()),snapshot=(null==params?void 0:params.rollbackOnError)&&makeDeepCopy(tournamentRecord,!1,!0),result=executeFunction(tournamentRecord,method,params);(null==result?void 0:result.error)&&snapshot&&setState(snapshot);const notify=(null==result?void 0:result.success)&&!0!==(null==params?void 0:params.delayNotify)&&!0!==(null==params?void 0:params.doNotNotify);return notify&&notifySubscribers(),(notify||!(null==result?void 0:result.success)||(null==params?void 0:params.doNotNotify))&&deleteNotices(),result}}();Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;var namesData$1={lastNames:["Abbey","Ampleforth","Austen","Banks","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Earhart","Eisenstein","Eldritch","Elliot","Eyre","Faulkner","Frank","Godel","Goldstein","Greer","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Midgely","Mond","Montoya","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wirt","Wormwood"],firstFemale:["Ada","Amelia","America","Anne","Antoina","Aravis","Beatrice","Brienne","Buttercup","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Heather","Helen","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Bill","Charles","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Joe","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Mustapha","Neil","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Stafford","Stanislaw","Stanley","Syme","Thorstein","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston"]};function generatePersonData({count=100,sex}={}){if(!count||sex&&![MALE,FEMALE].includes(sex))return{personData:[],error:INVALID_VALUES};const buffer=Math.ceil(1.3*count),{lastNames,firstFemale,firstMale}=namesData$1,ISOs=countries.map((({iso})=>iso)).filter(Boolean),lastNameDupeCount=Math.ceil(buffer/lastNames.length),femaleDupeCount=Math.ceil(buffer/firstFemale.length),maleDupeCount=Math.ceil(buffer/firstMale.length),lastNameDupes=generateRange(0,lastNameDupeCount).flatMap((()=>{const n=makeDeepCopy(lastNames,!1,!0);return generateRange(0,lastNames.length).map((()=>randomPop(n)))})),femaleDupes=generateRange(0,femaleDupeCount).flatMap((()=>{const n=makeDeepCopy(firstFemale,!1,!0);return generateRange(0,firstFemale.length).map((()=>randomPop(n)))})),maleDupes=generateRange(0,maleDupeCount).flatMap((()=>{const n=makeDeepCopy(firstMale,!1,!0);return generateRange(0,firstMale.length).map((()=>randomPop(n)))})),candidates={};for(let i=0;i<buffer;i++){const lastName=lastNameDupes.pop(),personSex=sex||randomMember([MALE,FEMALE]),firstName=personSex===MALE?maleDupes.pop():femaleDupes.pop(),nationalityCode=randomMember(ISOs);candidates[`${firstName}${lastName}`]={nationalityCode,sex:personSex,firstName,lastName}}return{personData:Object.values(candidates).slice(0,count)}}function generatePersons({personExtensions,consideredDate,isMock=!0,gendersCount,personData,count=1,category,sex}={}){if(isNaN(count))return{error:INVALID_VALUES};const maleCount=(null==gendersCount?void 0:gendersCount[MALE])||sex===MALE&&count||0,femaleCount=(null==gendersCount?void 0:gendersCount[FEMALE])||sex===FEMALE&&count||0,defaultCount=(count=Math.max(count,maleCount+femaleCount))-(maleCount+femaleCount),defaultPersonData=[...maleCount&&generatePersonData({count:maleCount,sex:MALE}).personData||[],...femaleCount&&generatePersonData({count:femaleCount,sex:FEMALE}).personData||[],...defaultCount&&generatePersonData({count:defaultCount}).personData||[]];let validPersonData=defaultPersonData.filter((person=>!sex||maleCount&&femaleCount||person.sex===sex)),nationalityCodes=[];if(Array.isArray(personData)){const validatedPersonData=personData.filter((person=>"string"==typeof person.firstName&&("string"==typeof person.lastName&&(!![MALE,FEMALE].includes(person.sex)&&(!(person.nationalityCode&&("string"!=typeof person.nationalityCode||person.nationalityCode.length>3||!countries.find((({iso,ioc})=>[iso,ioc].includes(person.nationalityCode)))))&&(person.nationalityCode&&nationalityCodes.push(person.nationalityCode),!0))))));if(!validatedPersonData.length)return{error:INVALID_VALUES};validPersonData=validatedPersonData}const shuffledPersons=shuffleArray(validPersonData);if(shuffledPersons.length<count){console.log("LESS",shuffledPersons.length,count);const{maleFirstNames,maleLastNames,femaleFirstNames,femaleLastNames,nationalityCodes:nationalityCodes2}=defaultPersonData.reduce(((a,person)=>{const{firstName,lastName,nationalityCode}=person;return person.sex===MALE?(a.maleFirstNames.includes(firstName)||a.maleFirstNames.push(firstName),a.maleLastNames.includes(lastName)||a.maleLastNames.push(lastName)):(a.femaleFirstNames.includes(firstName)||a.femaleFirstNames.push(firstName),a.femaleLastNames.includes(lastName)||a.femaleLastNames.push(lastName)),a.nationalityCodes.includes(nationalityCode)||a.nationalityCodes.push(nationalityCode),a}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});generateRange(0,count-shuffledPersons.length).forEach((()=>{const personSex=sex||randomMember([MALE,FEMALE]),nationalityCode=randomMember(nationalityCodes2),person={firstName:randomMember(personSex===MALE?maleFirstNames:femaleFirstNames),lastName:randomMember(personSex===MALE?maleLastNames:femaleLastNames),sex:personSex,nationalityCode};shuffledPersons.push(person)}))}const{ageMinDate,ageMaxDate}=parseAgeCategoryCode({consideredDate,category}),rangeStart=parseInt((null==ageMinDate?void 0:ageMinDate.slice(0,4))||0)||parseInt((null==ageMaxDate?void 0:ageMaxDate.slice(0,4))||0)-3,rangeEnd=parseInt((null==ageMaxDate?void 0:ageMaxDate.slice(0,4))||0)||parseInt((null==ageMinDate?void 0:ageMinDate.slice(0,4))||0)+3,yearRange=(ageMinDate||ageMaxDate)&&[rangeStart,rangeEnd],persons=shuffledPersons.slice(0,count).map(((person,i)=>{const birthYear=yearRange&&randomPop(generateRange(...yearRange)),birthDay=randomPop(generateRange(0,365)),birthDate=birthYear&&function dateFromDay(year,day,dateFormat){const date=new Date(year,0);return formatDate(new Date(date.setDate(day)),dateFormat)}(birthYear,birthDay);return Object.assign(definedAttributes({extensions:personExtensions||[{name:"regionCode",value:i+1}],birthDate,isMock}),person)}));return{persons:persons.length&&persons||shuffledPersons[0],nationalityCodes}}function generateAddress(addressAttributes){const{cities,states,postalCodes,nationalityCode,participantIndex}=addressAttributes;return{city:cities&&cities[participantIndex],state:states&&states[participantIndex],postalCode:postalCodes&&postalCodes[participantIndex],countryCode:nationalityCode}}var namesData=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function nameMocks({nameRoot="TEAM",count=1}={}){const names=shuffleArray(namesData).slice(0,count);return names.length<count&&generateRange(0,count-names.length).forEach((i=>names.push(`${nameRoot} ${i+1}`))),{names}}var statesData=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],citiesData=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function cityMocks({count=1,participantsCount=32}={}){const shuffledCities=shuffleArray(citiesData),candidateCities=shuffledCities.slice(0,count);return{cities:generateRange(0,participantsCount).map((i=>i<Math.min(count,shuffledCities.length)?candidateCities[i]:randomMember(candidateCities)))}}function stateMocks({count=1,participantsCount=32}={}){const shuffledStates=shuffleArray(statesData),candidateStates=shuffledStates.slice(0,count).map((state=>Object.keys(state))).flat();return{states:generateRange(0,participantsCount).map((i=>i<Math.min(count,shuffledStates.length)?candidateStates[i]:randomMember(candidateStates)))}}function postalCodeMocks({count=1,participantsCount=32}={}){const candidatePostalCodes=generateRange(0,count).map((()=>generateRange(0,5).map((()=>randomInt(0,9))).join("")));return{postalCodes:generateRange(0,participantsCount).map((i=>i<count?candidatePostalCodes[i]:randomMember(candidatePostalCodes)))}}var __defProp$f=Object.defineProperty,__defProps$b=Object.defineProperties,__getOwnPropDescs$b=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$f=Object.getOwnPropertySymbols,__hasOwnProp$f=Object.prototype.hasOwnProperty,__propIsEnum$f=Object.prototype.propertyIsEnumerable,__defNormalProp$f=(obj,key,value)=>key in obj?__defProp$f(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$f=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$f.call(b,prop)&&__defNormalProp$f(a,prop,b[prop]);if(__getOwnPropSymbols$f)for(var prop of __getOwnPropSymbols$f(b))__propIsEnum$f.call(b,prop)&&__defNormalProp$f(a,prop,b[prop]);return a};var __defProp$e=Object.defineProperty,__defProps$a=Object.defineProperties,__getOwnPropDescs$a=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$e=Object.getOwnPropertySymbols,__hasOwnProp$e=Object.prototype.hasOwnProperty,__propIsEnum$e=Object.prototype.propertyIsEnumerable,__defNormalProp$e=(obj,key,value)=>key in obj?__defProp$e(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$e=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$e.call(b,prop)&&__defNormalProp$e(a,prop,b[prop]);if(__getOwnPropSymbols$e)for(var prop of __getOwnPropSymbols$e(b))__propIsEnum$e.call(b,prop)&&__defNormalProp$e(a,prop,b[prop]);return a},__spreadProps$a=(a,b)=>__defProps$a(a,__getOwnPropDescs$a(b));function generateOutcomeFromScoreString({matchUpFormat,matchUpStatus,winningSide,scoreString}){if(!scoreString)return{outcome:__spreadProps$a(__spreadValues$e({},toBePlayed),{winningSide,matchUpStatus})};if(winningSide&&![1,2,void 0].includes(winningSide))return{error:INVALID_VALUES,winningSide};const neutralParsedSets=scoreString&&parseScoreString({scoreString}),score={},winningScoreString=generateScoreString({sets:neutralParsedSets,matchUpFormat}),losingScoreString=generateScoreString({sets:neutralParsedSets,reversed:!0,matchUpFormat});return 2===winningSide?(score.scoreStringSide1=losingScoreString,score.scoreStringSide2=winningScoreString):(score.scoreStringSide1=winningScoreString,score.scoreStringSide2=losingScoreString),score.sets=parseScoreString({scoreString:score.scoreStringSide1}),definedAttributes({outcome:{matchUpStatus,winningSide,score}})}const defaultStatusProfile={[WALKOVER$2]:2,[DOUBLE_WALKOVER]:1,[DOUBLE_DEFAULT]:1,[RETIRED$1]:1,[DEFAULTED]:4};function generateOutcome({matchUpFormat="SET3-S:6/TB7",matchUpStatusProfile=defaultStatusProfile,pointsPerMinute=1,sideWeight=4,winningSide,defaultWithScorePercent=2}){if(!isValid(matchUpFormat))return{error:INVALID_MATCHUP_FORMAT};if("object"!=typeof matchUpStatusProfile)return{error:INVALID_VALUES};if(defaultWithScorePercent>100&&(defaultWithScorePercent=100),isNaN(defaultWithScorePercent)||isNaN(pointsPerMinute)||isNaN(sideWeight))return{error:INVALID_VALUES};const matchUpStatuses=Object.keys(matchUpStatusProfile).filter((matchUpStatus2=>Object.keys(matchUpStatusConstants).includes(matchUpStatus2)&&matchUpStatus2!==COMPLETED$1));if(Object.keys(matchUpStatuses).reduce(((total,key)=>total+matchUpStatusProfile[key]),0)>100)return{error:INVALID_VALUES,matchUpStatusProfile};const matchUpStatusMap=matchUpStatuses.reduce(((statusMap,matchUpStatus2)=>(statusMap.pointer=statusMap.pointer+matchUpStatusProfile[matchUpStatus2],statusMap.valueMap.push([statusMap.pointer,matchUpStatus2]),statusMap)),{pointer:0,valueMap:[]}),outcomePointer=randomInt(1,100),matchUpStatus=(matchUpStatusMap.valueMap.find((item=>outcomePointer<=item[0]))||[100,COMPLETED$1])[1],noScore={sets:[],scoreStringSide1:"",side2ScoreString:""};if([WALKOVER$2,DEFAULTED].includes(matchUpStatus)){const outcome2={score:noScore,winningSide:winningSide=winningSide||randomInt(1,2),matchUpStatus};if(!(matchUpStatus===DEFAULTED&&randomInt(1,100)>100-defaultWithScorePercent))return{outcome:outcome2}}else if([DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(matchUpStatus))return{outcome:{score:noScore,matchUpStatus}};const parsedFormat=parse(matchUpFormat),{bestOf,setFormat,finalSetFormat}=parsedFormat,sets=[],weightedSide=randomInt(0,1),weightedRange=winningSide?[winningSide-1]:[...generateRange(0,sideWeight).map((()=>weightedSide)),1-weightedSide],incompleteAt=[RETIRED$1,DEFAULTED,INCOMPLETE,SUSPENDED].includes(matchUpStatus)&&(randomPop(generateRange(1,bestOf))||1);let weightedWinningSide;for(const setNumber of generateRange(1,bestOf+1)){const isFinalSet=setNumber===bestOf,{set,incomplete,winningSideNumber}=generateSet({incomplete:incompleteAt===setNumber,matchUpStatus,pointsPerMinute,setFormat:isFinalSet&&finalSetFormat||setFormat,setNumber,weightedRange});if(sets.push(set),incomplete){weightedWinningSide=winningSideNumber;break}if(analyzeMatchUp({matchUp:{score:{sets},matchUpFormat}}).calculatedWinningSide)break}const analysis=analyzeMatchUp({matchUp:{score:{sets},matchUpFormat}}),matchUpWinningSide=weightedWinningSide?winningSide||weightedWinningSide:analysis.calculatedWinningSide,{score}=matchUpScore({score:{sets},winningSide:matchUpWinningSide,matchUpStatus});return{outcome:{score,winningSide:matchUpWinningSide,matchUpStatus}}}function generateSet({weightedRange=[0,1],pointsPerMinute,matchUpStatus,incomplete,setFormat,setNumber}){const set={setNumber},{setTo,tiebreakFormat,tiebreakAt,tiebreakSet,timed,minutes}=setFormat,weightIndex=randomInt(0,weightedRange.length-1),reverseScores=weightedRange[weightIndex];let winningSideNumber;if(timed){const calcPoints=minutes*pointsPerMinute,pointsVariation=Math.round(.2*calcPoints),totalPoints=calcPoints+randomPop([1,-1])*pointsVariation,sidePoints=function weightedRandom(max=1,weight=3,round=!0){let num=0;for(let i=0;i<weight;i++)num+=Math.random()*(max/weight);return round&&max>1?Math.round(num):num}(totalPoints,2),scores=[sidePoints,totalPoints-sidePoints];reverseScores&&scores.reverse(),winningSideNumber=weightedRange[weightIndex]+1;let highSide=(scores[0]>scores[1]?1:scores[1]>scores[0]&&2)||0;if(incomplete){const[side1Score2,side2Score2]=scores;return Object.assign(set,{side1Score:side1Score2,side2Score:side2Score2}),completedMatchUpStatuses.includes(matchUpStatus)?{set,incomplete,winningSideNumber}:{set,incomplete}}highSide||(scores[randomInt(0,1)]+=1),highSide=scores[0]>scores[1]?1:2,highSide!==winningSideNumber&&scores.reverse();const[side1Score,side2Score]=scores;return Object.assign(set,{side1Score,side2Score,winningSide:winningSideNumber}),{set}}if(incomplete)return set.side1Score=randomInt(0,tiebreakAt),set.side2Score=randomInt(0,tiebreakAt),completedMatchUpStatuses.includes(matchUpStatus)&&(winningSideNumber=weightedRange[weightIndex]+1),{set,incomplete,winningSideNumber};{const range=generateRange(1,setTo+1).map((value=>generateRange(0,setTo+2-value).map((()=>value)))).flat(),lowValue=range[randomInt(0,range.length-1)],scores=setTo&&getSetComplement({isSide1:!0,tiebreakAt,lowValue,setTo}),isTiebreakSet=!scores,specifiedWinningSide=1===weightedRange.length&&weightedRange[weightIndex]+1;if(!isTiebreakSet){if(specifiedWinningSide){(scores[0]>scores[1]?1:2)!==specifiedWinningSide&&scores.reverse()}else reverseScores&&scores.reverse();const[side1Score,side2Score]=scores;Object.assign(set,{side1Score,side2Score})}const setAnalysis=analyzeSet({matchUpScoringFormat:{setFormat},setObject:set});let tiebreakWinningSide;if(setAnalysis.hasTiebreakCondition||isTiebreakSet){const{NoAD:tiebreakNoAd,tiebreakTo}=tiebreakFormat||tiebreakSet||{},range2=generateRange(1,tiebreakTo+1).map((value=>generateRange(0,tiebreakTo+2-value).map((()=>value)))).flat(),lowValue2=range2[randomInt(0,range2.length-1)];let scores2=getTiebreakComplement({isSide1:!0,lowValue:lowValue2,tiebreakTo,tiebreakNoAd});if(isTiebreakSet){const highSide=scores2[0]>scores2[1]?1:2;specifiedWinningSide?highSide!==specifiedWinningSide&&scores2.reverse():reverseScores&&scores2.reverse(),[set.side1TiebreakScore,set.side2TiebreakScore]=scores2,tiebreakWinningSide=scores2[0]>scores2[1]?1:2}else 2===setAnalysis.leadingSide?[set.side1TiebreakScore,set.side2TiebreakScore]=scores2:[set.side2TiebreakScore,set.side1TiebreakScore]=scores2}set.winningSide=setAnalysis.winningSide||setAnalysis.leadingSide||specifiedWinningSide||tiebreakWinningSide}return{set}}var __defProp$d=Object.defineProperty,__defProps$9=Object.defineProperties,__getOwnPropDescs$9=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$d=Object.getOwnPropertySymbols,__hasOwnProp$d=Object.prototype.hasOwnProperty,__propIsEnum$d=Object.prototype.propertyIsEnumerable,__defNormalProp$d=(obj,key,value)=>key in obj?__defProp$d(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$d=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$d.call(b,prop)&&__defNormalProp$d(a,prop,b[prop]);if(__getOwnPropSymbols$d)for(var prop of __getOwnPropSymbols$d(b))__propIsEnum$d.call(b,prop)&&__defNormalProp$d(a,prop,b[prop]);return a},__spreadProps$9=(a,b)=>__defProps$9(a,__getOwnPropDescs$9(b));function completeDrawMatchUps({matchUpStatusProfile,completeAllMatchUps,randomWinningSide,tournamentRecord,drawDefinition,completionGoal,matchUpFormat,event}){var _a,_b,_c;const sortedStructures=drawDefinition.structures.slice().sort(structureSort);let completedCount=0,{matchUps:firstRoundDualMatchUps,matchUpsMap}=getAllDrawMatchUps({contextFilters:{stages:[MAIN,QUALIFYING]},matchUpFilters:{matchUpTypes:[TEAM$2],roundNumbers:[1]},inContext:!0,drawDefinition});if(firstRoundDualMatchUps.length){const categoryName=(null==(_a=event.category)?void 0:_a.ageCategoryCode)||(null==(_b=event.category)?void 0:_b.categoryName);if(categoryName){generateLineUps({singlesOnly:!0,tournamentRecord,drawDefinition,scaleAccessor:{scaleName:categoryName,sortOrder:ASCENDING,scaleType:RANKING$1},attach:!0,event})}else{const structureId=null==(_c=firstRoundDualMatchUps[0])?void 0:_c.structureId,{positionAssignments}=getPositionAssignments$1({drawDefinition,structureId});if(null==positionAssignments?void 0:positionAssignments.length){let{tournamentParticipants:teamParticipants}=getTournamentParticipants({participantFilters:{participantTypes:[TEAM$2]},tournamentRecord});const assignParticipants=dualMatchUp=>{const singlesMatchUps=dualMatchUp.tieMatchUps.filter((({matchUpType})=>matchUpType===SINGLES$1)),doublesMatchUps=dualMatchUp.tieMatchUps.filter((({matchUpType})=>matchUpType===DOUBLES$1));singlesMatchUps.forEach(((singlesMatchUp,i)=>{const tieMatchUpId=singlesMatchUp.matchUpId;singlesMatchUp.sides.forEach((side=>{const{drawPosition}=side,teamParticipant=teamParticipants.find((teamParticipant2=>{const{participantId}=teamParticipant2,assignment=positionAssignments.find((assignment2=>assignment2.participantId===participantId));return(null==assignment?void 0:assignment.drawPosition)===drawPosition}));if(teamParticipant){const individualParticipantId=teamParticipant.individualParticipantIds[i];assignTieMatchUpParticipantId({teamParticipantId:teamParticipant.participantId,participantId:individualParticipantId,tournamentRecord,drawDefinition,tieMatchUpId,event})}}))})),doublesMatchUps.forEach(((doublesMatchUp,i)=>{const tieMatchUpId=doublesMatchUp.matchUpId;doublesMatchUp.sides.forEach((side=>{const{drawPosition}=side,teamParticipant=teamParticipants.find((teamParticipant2=>{const{participantId}=teamParticipant2,assignment=positionAssignments.find((assignment2=>assignment2.participantId===participantId));return(null==assignment?void 0:assignment.drawPosition)===drawPosition}));if(teamParticipant){teamParticipant.individualParticipantIds.slice(2*i,2*i+2).forEach((individualParticipantId=>{assignTieMatchUpParticipantId({teamParticipantId:teamParticipant.participantId,participantId:individualParticipantId,tournamentRecord,drawDefinition,tieMatchUpId,event})}))}}))}))};firstRoundDualMatchUps.forEach(assignParticipants)}}}const scoreString="string"==typeof completeAllMatchUps&&completeAllMatchUps,matchUpStatus=scoreString&&COMPLETED$1;for(const structure of sortedStructures){if(completedCount>=completionGoal)break;const{matchUps}=getAllStructureMatchUps({matchUpFilters:{matchUpTypes:[DOUBLES$1,SINGLES$1]},afterRecoveryTimes:!1,tournamentRecord,inContext:!0,drawDefinition,matchUpsMap,structure,event}),sortedMatchUpIds=matchUps.filter((({winningSide})=>!winningSide)).sort(matchUpSort).map(getMatchUpId);for(const matchUpId of sortedMatchUpIds){if(!isNaN(completionGoal)&&completedCount>=completionGoal)break;const{matchUps:matchUps2}=getAllStructureMatchUps({matchUpFilters:{matchUpTypes:[DOUBLES$1,SINGLES$1]},afterRecoveryTimes:!1,tournamentRecord,inContext:!0,drawDefinition,matchUpsMap,structure,event}),targetMatchUp=matchUps2.find((matchUp=>matchUp.matchUpId===matchUpId)),isDoubleExit=[DOUBLE_WALKOVER,DOUBLE_DEFAULT].includes(targetMatchUp.matchUpStatus);if((null==targetMatchUp?void 0:targetMatchUp.readyToScore)&&!isDoubleExit){const result=smartComplete({winningSide:!randomWinningSide&&1,matchUpStatusProfile,tournamentRecord,drawDefinition,targetMatchUp,matchUpFormat,matchUpStatus,scoreString,event});if(result.error)return result;completedCount+=1}}}return __spreadProps$9(__spreadValues$d({},SUCCESS),{completedCount})}function completeDrawMatchUp({matchUpStatusCodes,tournamentRecord,drawDefinition,targetMatchUp,matchUpStatus,matchUpFormat,scoreString,winningSide,event}){if(!targetMatchUp||targetMatchUp.matchUpStatus===BYE)return;const{matchUpId}=targetMatchUp||{},{outcome}=generateOutcomeFromScoreString({matchUpFormat,matchUpStatus,scoreString,winningSide});return matchUpStatusCodes&&(outcome.matchUpStatusCodes=matchUpStatusCodes),setMatchUpStatus$1({tournamentRecord,drawDefinition,matchUpFormat,matchUpId,outcome,event})}function smartComplete(params){const{matchUpStatusProfile={},tournamentRecord,drawDefinition,matchUpStatus,matchUpFormat,targetMatchUp,scoreString,winningSide,event}=params;if(scoreString||matchUpStatus)return completeDrawMatchUp(params);const{matchUpId}=targetMatchUp||{},{outcome}=generateOutcome({matchUpStatusProfile,matchUpFormat,winningSide});return setMatchUpStatus$1({tournamentRecord,drawDefinition,matchUpFormat,matchUpId,outcome,event})}var __defProp$c=Object.defineProperty,__defProps$8=Object.defineProperties,__getOwnPropDescs$8=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$c=Object.getOwnPropertySymbols,__hasOwnProp$c=Object.prototype.hasOwnProperty,__propIsEnum$c=Object.prototype.propertyIsEnumerable,__defNormalProp$c=(obj,key,value)=>key in obj?__defProp$c(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$c=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$c.call(b,prop)&&__defNormalProp$c(a,prop,b[prop]);if(__getOwnPropSymbols$c)for(var prop of __getOwnPropSymbols$c(b))__propIsEnum$c.call(b,prop)&&__defNormalProp$c(a,prop,b[prop]);return a},__spreadProps$8=(a,b)=>__defProps$8(a,__getOwnPropDescs$8(b));function generateFlightDrawDefinitions({matchUpStatusProfile,completeAllMatchUps,randomWinningSide,tournamentRecord,drawProfiles,event}){var _a,_b;const{flightProfile}=getFlightProfile({event}),{eventName,eventType,category}=event,{startDate}=tournamentRecord,drawIds=[],categoryName=(null==category?void 0:category.categoryName)||(null==category?void 0:category.ageCategoryCode)||(null==category?void 0:category.ratingType),existingDrawIds=null==(_a=event.drawDefinitions)?void 0:_a.map((({drawId})=>drawId));if(Array.isArray(null==flightProfile?void 0:flightProfile.flights))for(const[index,flight]of flightProfile.flights.entries()){const{drawId,stage,drawName,drawEntries}=flight;drawIds.push(flight.drawId);const drawProfile=drawProfiles[index],{seedsCount,generate=!0}=drawProfile||{};if(generate){const drawParticipantIds=drawEntries.filter(hasParticipantId).map(getParticipantId),seedingScaleName=categoryName||eventName;if(tournamentRecord&&seedsCount&&seedsCount<=drawParticipantIds.length){generateRange(1,seedsCount+1).forEach(((scaleValue,index2)=>{let scaleItem={scaleValue,scaleName:seedingScaleName,scaleType:SEEDING$1,eventType,scaleDate:startDate};const participantId=drawParticipantIds[index2];setParticipantScaleItem({tournamentRecord,participantId,scaleItem})}))}if(null==existingDrawIds?void 0:existingDrawIds.includes(drawId))break;let result=generateDrawDefinition(__spreadProps$8(__spreadValues$c({},drawProfile),{matchUpType:eventType,seedingScaleName,tournamentRecord,isMock:!0,drawEntries,drawName,drawId,event,stage}));if(result.error)return result;const{drawDefinition}=result,drawExtensions=null==(_b=drawProfiles[index])?void 0:_b.drawExtensions;if(Array.isArray(drawExtensions)&&drawExtensions.filter(isValidExtension).forEach((extension=>addExtension$1({element:drawDefinition,extension}))),result=addDrawDefinition$1({suppressNotifications:!0,tournamentRecord,drawDefinition,event}),result.error)return result;if(drawProfile.drawType===AD_HOC&&drawProfile.drawMatic){const roundsCount=drawProfile.roundsCount||1;for(const roundNumber of generateRange(1,roundsCount+1)){const result2=drawMatic({generateMatchUps:!0,tournamentRecord,drawDefinition,roundNumber});if(result2.error)return result2}}if(null==drawProfile?void 0:drawProfile.withPlayoffs){const structureId=drawDefinition.structures[0].structureId,result2=addPlayoffStructures$1(__spreadProps$8(__spreadValues$c({idPrefix:drawProfile.idPrefix},drawProfile.withPlayoffs),{tournamentRecord,drawDefinition,isMock:!0,structureId,event}));if(null==result2?void 0:result2.error)return result2}const completionGoal=null==drawProfile?void 0:drawProfile.completionGoal;if(!(!1===(null==drawProfile?void 0:drawProfile.automated))&&(completeAllMatchUps||completionGoal)){const matchUpFormat=null==drawProfile?void 0:drawProfile.matchUpFormat,result2=completeDrawMatchUps({completeAllMatchUps:!completionGoal&&completeAllMatchUps,matchUpStatusProfile,randomWinningSide,tournamentRecord,completionGoal,drawDefinition,matchUpFormat,event});if(result2.error)return result2;const completedCount=result2.completedCount;if((null==drawProfile?void 0:drawProfile.drawType)===ROUND_ROBIN_WITH_PLAYOFF){let result3=automatedPlayoffPositioning({structureId:drawDefinition.structures.find((structure=>structure.stage===MAIN)).structureId,tournamentRecord,drawDefinition,event});if(result3.error)return result3;if(result3=completeDrawMatchUps({completeAllMatchUps:!completionGoal&&completeAllMatchUps,completionGoal:completionGoal?completionGoal?completionGoal-completedCount:void 0:void 0,matchUpStatusProfile,randomWinningSide,tournamentRecord,drawDefinition,matchUpFormat,event}),result3.error)return result3}}}}return __spreadProps$8(__spreadValues$c({},SUCCESS),{drawIds})}var __defProp$b=Object.defineProperty,__defProps$7=Object.defineProperties,__getOwnPropDescs$7=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$b=Object.getOwnPropertySymbols,__hasOwnProp$b=Object.prototype.hasOwnProperty,__propIsEnum$b=Object.prototype.propertyIsEnumerable,__defNormalProp$b=(obj,key,value)=>key in obj?__defProp$b(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$b=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$b.call(b,prop)&&__defNormalProp$b(a,prop,b[prop]);if(__getOwnPropSymbols$b)for(var prop of __getOwnPropSymbols$b(b))__propIsEnum$b.call(b,prop)&&__defNormalProp$b(a,prop,b[prop]);return a},__spreadProps$7=(a,b)=>__defProps$7(a,__getOwnPropDescs$7(b));function generateParticipants({ratingsParameters:ratingsParameters$1=ratingsParameters,valuesInstanceLimit,consideredDate,category,nationalityCodesCount,nationalityCodeType,nationalityCodes,participantsCount=32,participantType,personIds,idPrefix,uuids,personExtensions,addressProps,gendersCount,matchUpType,personData,sex,inContext,withISO2,withIOC,rankingRange,scaledParticipantsCount,scaleAllParticipants}){const doubles=participantType===PAIR||matchUpType===DOUBLES_MATCHUP,team=participantType===TEAM||matchUpType===TEAM;!rankingRange||Array.isArray(rankingRange)&&rankingRange.every((r=>isNumeric(r)))&&2===rankingRange.length||(rankingRange=void 0),scaledParticipantsCount=scaleAllParticipants?participantsCount:scaledParticipantsCount;(rankingRange=rankingRange||[1,scaledParticipantsCount&&scaledParticipantsCount>1e3?scaledParticipantsCount:1e3])[1]+=1;const individualParticipantsCount=participantsCount*(doubles?2:team?8:1),result=generatePersons({count:individualParticipantsCount,personExtensions,consideredDate,gendersCount,personData,category,sex});if(result.error)return result;const{nationalityCodes:personNationalityCodes,persons:mockedPersons}=result;let doublesRankings=[],singlesRankings=[],singlesRatings=[],doublesRatings=[];if("object"==typeof category){const{categoryName,ageCategoryCode,ratingType}=category;if(!categoryName&&!ageCategoryCode||ratingType||(singlesRankings=shuffleArray(generateRange(...rankingRange)).slice(0,scaledParticipantsCount||randomInt(20,30)),[PAIR,TEAM].includes(participantType)&&(doublesRankings=shuffleArray(generateRange(...rankingRange)).slice(0,scaledParticipantsCount||randomInt(20,30)))),ratingType&&ratingsParameters$1[ratingType]){let{ratingMax,ratingMin,ratingAttributes}=category;const ratingParameters=Object.assign({},ratingsParameters$1[ratingType],ratingAttributes||{}),{attributes={},decimalsCount,accessors,range,step}=ratingParameters,getAttributes=attributes2=>{const generatedAttributes={};for(const attribute of Object.keys(attributes2)||{}){const attributeValue=attributes2[attribute];if("object"==typeof attributeValue&&attributeValue.generator){const{range:range2}=attributeValue,[min2,max2]=range2.slice().sort();generatedAttributes[attribute]=randomInt(min2,max2)}else generatedAttributes[attribute]=attributeValue}return generatedAttributes},skew=range[0]>range[1]?2:.5,[min,max]=range.slice().sort(),generateRatings=()=>generateRange(0,1e3).map((()=>skewedDistribution(min,max,skew,step,decimalsCount))).filter((rating=>(!ratingMax||rating<=ratingMax)&&(!ratingMin||rating>=ratingMin))).slice(0,scaledParticipantsCount||randomInt(20,30)).map((scaleValue=>accessors?Object.assign({},...accessors.map((accessor=>({[accessor]:scaleValue}))),getAttributes(attributes)):scaleValue));singlesRatings=generateRatings(),[PAIR,TEAM].includes(participantType)&&(doublesRatings=generateRatings())}}const countryCodes=countries.filter((country=>"IOC"===nationalityCodeType&&country.ioc||country.iso));const{postalCodesProfile,postalCodesCount,statesProfile,citiesProfile,citiesCount,statesCount}=addressProps||{},valuesFromProfile=profile=>Object.keys(profile).map((key=>generateRange(0,statesProfile[key]).map((()=>key)))).flat(),addressValues={cities:citiesProfile&&valuesFromProfile(citiesProfile)||(null==addressProps?void 0:addressProps.cities)||cityMocks({count:citiesCount||individualParticipantsCount,participantsCount:individualParticipantsCount}).cities,states:statesProfile&&valuesFromProfile(statesProfile)||(null==addressProps?void 0:addressProps.states)||stateMocks({count:statesCount||individualParticipantsCount,participantsCount:individualParticipantsCount}).states,postalCodes:postalCodesProfile&&valuesFromProfile(postalCodesProfile)||(null==addressProps?void 0:addressProps.postalCodes)||postalCodeMocks({count:postalCodesCount||individualParticipantsCount,participantsCount:individualParticipantsCount}).postalCodes},isoMin=function getMin(count){const instances=Math.ceil(individualParticipantsCount/count);return valuesInstanceLimit&&instances>valuesInstanceLimit?Math.ceil(individualParticipantsCount/valuesInstanceLimit):count}(nationalityCodesCount),isoList=isoMin?shuffleArray(countryCodes).slice(0,nationalityCodesCount):nationalityCodes?countryCodes.filter((isoCountry=>nationalityCodes.includes(isoCountry.key))):countryCodes,countriesList=shuffleArray(generateRange(0,Math.ceil(individualParticipantsCount/(isoMin||1))).map((()=>isoList)).flat(1/0)),teamNames=nameMocks({count:participantsCount}).names;return{participants:generateRange(0,participantsCount).map((i=>{const sideParticipantsCount=doubles?2:team?8:1,individualParticipants=generateRange(0,sideParticipantsCount).map((j=>function generateIndividualParticipant(participantIndex){const person=mockedPersons[participantIndex],{nationalityCode:personNationalityCode,participantExtensions,participantTimeItems,extensions,firstName,birthDate,lastName,personId,sex:sex2}=person||{},standardGivenName=firstName||"GivenName",standardFamilyName=lastName||"FamilyName",participantName=`${standardGivenName} ${standardFamilyName}`,country=countriesList[participantIndex],nationalityCode=(null==personNationalityCodes?void 0:personNationalityCodes.length)&&personNationalityCode||country&&("IOC"===nationalityCodeType?country.ioc||country.iso:country.iso||country.ioc)||personNationalityCode;!(null==countriesList?void 0:countriesList.length)||nationalityCode||personNationalityCode||console.log("%c Invalid Nationality Code",{participantIndex,country});const address=generateAddress(__spreadProps$7(__spreadValues$b({},addressValues),{participantIndex,nationalityCode})),participant=definedAttributes({participantId:genParticipantId({participantType:INDIVIDUAL,index:participantIndex,idPrefix,uuids}),extensions:participantExtensions,timeItems:participantTimeItems,participantRole:COMPETITOR,participantType:INDIVIDUAL,participantName,person:{addresses:[address],personId:personId||(null==personIds?void 0:personIds.length)&&personIds[participantIndex]||UUID(),standardFamilyName,standardGivenName,nationalityCode,extensions,birthDate:isValidDateString(birthDate)?birthDate:void 0,sex:sex2}});if(withIOC&&nationalityCode){const country2=countries.find((({iso})=>iso===nationalityCode));(null==country2?void 0:country2.ioc)&&(participant.person.iocNationalityCode=country2.ioc),(null==country2?void 0:country2.label)&&(participant.person.countryName=country2.label)}if(withISO2&&nationalityCode){const country2=countries.find((({iso})=>iso===nationalityCode));(null==country2?void 0:country2.iso2)&&(participant.person.iso2NationalityCode=country2.iso2),(null==country2?void 0:country2.label)&&(participant.person.countryName=country2.label)}if(category){const singlesRanking=singlesRankings[participantIndex],doublesRanking=doublesRankings[participantIndex];addScaleItem({scaleValue:singlesRanking,eventType:SINGLES_EVENT,scaleType:RANKING$1,participant,category}),addScaleItem({scaleValue:doublesRanking,eventType:DOUBLES_EVENT,scaleType:RANKING$1,participant,category});const singlesRating=singlesRatings[participantIndex],doublesRating=doublesRatings[participantIndex];addScaleItem({scaleValue:singlesRating,eventType:SINGLES_EVENT,scaleType:RATING$2,participant,category}),addScaleItem({scaleValue:doublesRating,eventType:DOUBLES_EVENT,scaleType:RATING$2,participant,category})}return participant}(i*sideParticipantsCount+j))),individualParticipantIds=individualParticipants.map((participant=>participant.participantId)),pairName=individualParticipants.map((i2=>i2.person.standardFamilyName)).join("/"),participantType2=doubles?PAIR:TEAM,groupParticipant={participantId:genParticipantId({participantType:participantType2,idPrefix,index:i,uuids}),participantRole:COMPETITOR,participantName:doubles?pairName:teamNames[i],individualParticipantIds,participantType:participantType2};return inContext&&(groupParticipant.individualParticipants=individualParticipants),doubles||team?[groupParticipant,...individualParticipants]:individualParticipants})).flat()}}function addScaleItem({scaleValue:itemValue,participant,eventType,scaleType,category}){const scaleName=category.categoryName||category.ratingType||category.ageCategoryCode,timeItem={itemValue,itemType:[SCALE$1,scaleType,eventType,scaleName].join(".")};scaleName&&itemValue&&(participant.timeItems||(participant.timeItems=[]),participant.timeItems.push(timeItem))}function genParticipantId({idPrefix,participantType,index,uuids}){return idPrefix?`${idPrefix}-${participantType===INDIVIDUAL?"I":"P"}-${index}`:(null==uuids?void 0:uuids.pop())||UUID()}function processTieFormat({alternatesCount=0,tieFormatName,tieFormat,drawSize}){var _a;let maxDoublesCount=0,maxSinglesCount=0,singlesMatchUpTotal=0,doublesMatchUpTotal=0,categories={};const genders={[MALE]:0,[FEMALE]:0,[MIXED]:0,[OTHER$2]:0,[ANY]:0};null==(_a=null==(tieFormat="object"==typeof tieFormat?tieFormat:tieFormatDefaults({namedFormat:tieFormatName}))?void 0:tieFormat.collectionDefinitions)||_a.filter(Boolean).forEach((collectionDefinition=>{const{category,collectionId,matchUpType,matchUpCount,gender}=collectionDefinition;if([MALE,FEMALE].includes(gender)){const required=matchUpCount*(matchUpType===DOUBLES$1?2:1);genders[gender]<required&&(genders[gender]=required)}else gender===MIXED&&(genders[MALE]<matchUpCount&&(genders[MALE]=matchUpCount),genders[FEMALE]<matchUpCount&&(genders[FEMALE]=matchUpCount));if(category){const categoryString=JSON.stringify(category);categories[categoryString]=category}if(collectionId||(collectionDefinition.collectionId=UUID()),matchUpType===DOUBLES$1){const doublesCount=matchUpCount;doublesMatchUpTotal+=matchUpCount,maxDoublesCount=Math.max(maxDoublesCount,doublesCount)}if(matchUpType===SINGLES$1){const singlescount=matchUpCount;singlesMatchUpTotal+=matchUpCount,maxSinglesCount=Math.max(maxSinglesCount,singlescount)}}));const teamSize=Object.keys(categories).length?Math.max(singlesMatchUpTotal,2*doublesMatchUpTotal):Math.max(maxSinglesCount,2*maxDoublesCount);return{maxDoublesDraw:maxDoublesCount*(drawSize+alternatesCount),maxSinglesDraw:maxSinglesCount*(drawSize+alternatesCount),teamSize,genders}}var __defProp$a=Object.defineProperty,__defProps$6=Object.defineProperties,__getOwnPropDescs$6=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$a=Object.getOwnPropertySymbols,__hasOwnProp$a=Object.prototype.hasOwnProperty,__propIsEnum$a=Object.prototype.propertyIsEnumerable,__defNormalProp$a=(obj,key,value)=>key in obj?__defProp$a(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$a=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$a.call(b,prop)&&__defNormalProp$a(a,prop,b[prop]);if(__getOwnPropSymbols$a)for(var prop of __getOwnPropSymbols$a(b))__propIsEnum$a.call(b,prop)&&__defNormalProp$a(a,prop,b[prop]);return a},__spreadProps$6=(a,b)=>__defProps$6(a,__getOwnPropDescs$6(b));var __defProp$9=Object.defineProperty,__defProps$5=Object.defineProperties,__getOwnPropDescs$5=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$9=Object.getOwnPropertySymbols,__hasOwnProp$9=Object.prototype.hasOwnProperty,__propIsEnum$9=Object.prototype.propertyIsEnumerable,__defNormalProp$9=(obj,key,value)=>key in obj?__defProp$9(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$9=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$9.call(b,prop)&&__defNormalProp$9(a,prop,b[prop]);if(__getOwnPropSymbols$9)for(var prop of __getOwnPropSymbols$9(b))__propIsEnum$9.call(b,prop)&&__defNormalProp$9(a,prop,b[prop]);return a},__spreadProps$5=(a,b)=>__defProps$5(a,__getOwnPropDescs$5(b));function addTournamentParticipants({participantsProfile={},tournamentRecord,eventProfiles,drawProfiles,startDate,uuids}){const{participantsCount,participantType,largestTeamDraw,largestTeamSize,gendersCount}=function getParticipantsCount({participantsProfile,eventProfiles,drawProfiles}){let{participantsCount,participantType=INDIVIDUAL}=participantsProfile||{};const specifiedParicipantsCount=participantsCount||0,gendersCount={[FEMALE]:0,[MIXED]:0,[OTHER$2]:0,[MALE]:0,[ANY]:0};let largestDoublesDraw=0,largestSinglesDraw=0,largestTeamSize=0,largestTeamDraw=0,uniqueParticipantsCount=0;const processDrawProfile=({alternatesCount=0,uniqueParticipants,tieFormatName,drawSize=0,eventType,tieFormat,category,gender,stage})=>{const isDoubles=eventType===DOUBLES,isTeam=eventType===TEAM$1,requiresUniqueParticipants=Boolean(uniqueParticipants||stage===QUALIFYING||category||gender);if(isTeam){largestTeamDraw=Math.max(largestTeamDraw,drawSize+alternatesCount),tieFormat="object"==typeof tieFormat?tieFormat:tieFormatDefaults({namedFormat:tieFormatName});const{teamSize,maxDoublesDraw,maxSinglesDraw,genders}=processTieFormat({alternatesCount,tieFormatName,tieFormat,drawSize});largestTeamSize=Math.max(largestTeamSize,teamSize),largestSinglesDraw=Math.max(largestSinglesDraw,maxSinglesDraw),requiresUniqueParticipants||(largestDoublesDraw=Math.max(largestDoublesDraw,maxDoublesDraw)),Object.keys(genders).forEach((key=>gendersCount[key]+=genders[key]))}else if(isDoubles)if(requiresUniqueParticipants){const additionalParticipantsCount=2*(drawSize+alternatesCount);uniqueParticipantsCount+=additionalParticipantsCount,gender&&(gendersCount[gender]+=additionalParticipantsCount)}else drawSize+alternatesCount&&drawSize+alternatesCount>largestDoublesDraw&&(largestDoublesDraw=drawSize+alternatesCount);else if(requiresUniqueParticipants){const additionalParticipantsCount=drawSize+alternatesCount;gender&&(gendersCount[gender]+=additionalParticipantsCount),uniqueParticipantsCount+=additionalParticipantsCount}else drawSize&&drawSize>largestSinglesDraw&&(largestSinglesDraw=drawSize+alternatesCount)};let categories=[];if(null==eventProfiles||eventProfiles.forEach((eventProfile=>{const{tieFormatName:eventTieFormatName,tieFormat:eventTieFormat,drawProfiles:drawProfiles2,eventType,category,gender}=eventProfile;if(drawProfiles2)for(const drawProfile of drawProfiles2){const{tieFormatName,tieFormat}=drawProfile;processDrawProfile(__spreadProps$6(__spreadValues$a({},drawProfile),{tieFormatName:tieFormatName||eventTieFormatName,tieFormat:tieFormat||eventTieFormat,eventType,category,gender}))}else category&&(categories.push(category),console.log({categories}))})),Array.isArray(drawProfiles))for(const drawProfile of drawProfiles)processDrawProfile(drawProfile);const individualCompetitorsCount=Math.max(largestTeamDraw*largestTeamSize,2*largestDoublesDraw,largestSinglesDraw);return largestDoublesDraw&&(participantType=PAIR),(participantsCount||specifiedParicipantsCount)<individualCompetitorsCount&&(participantsCount=individualCompetitorsCount),participantsCount&&largestDoublesDraw&&[PAIR,TEAM$1].includes(participantType)&&(largestSinglesDraw&&Math.floor(largestSinglesDraw/2)>largestDoublesDraw?participantsCount=Math.floor(largestSinglesDraw/2):(!largestSinglesDraw||2*largestDoublesDraw>=largestSinglesDraw)&&(participantsCount=Math.ceil(participantsCount/2))),void 0===participantsCount&&(participantsCount=(null==eventProfiles?void 0:eventProfiles.length)||(null==drawProfiles?void 0:drawProfiles.length)?0:32),participantsCount<specifiedParicipantsCount&&(participantsCount=specifiedParicipantsCount),{uniqueParticipantsCount,participantsCount,largestTeamDraw,largestTeamSize,participantType,gendersCount}}({participantsProfile,eventProfiles,drawProfiles}),{teamKey}=participantsProfile||{},{participants}=generateParticipants(__spreadProps$5(__spreadValues$9({uuids},participantsProfile),{consideredDate:startDate,participantsCount,participantType,gendersCount}));let addedCount=0,result=addParticipants({tournamentRecord,participants});if(result.error)return result;if(addedCount+=result.addedCount,teamKey){const result2=generateTeamsFromParticipantAttribute(__spreadValues$9({tournamentRecord},teamKey));if(result2.error)return result2}const allIndividualParticipantIds=participants.filter((({participantType:participantType2})=>participantType2===INDIVIDUAL)).map(getParticipantId);return result=addParticipants({participants:generateRange(0,largestTeamDraw).map((teamIndex=>{const individualParticipantIds=allIndividualParticipantIds.slice(teamIndex*largestTeamSize,(teamIndex+1)*largestTeamSize);return{participantName:`Team ${teamIndex+1}`,participantRole:COMPETITOR,participantType:TEAM,participantId:UUID(),individualParticipantIds}})),tournamentRecord}),result.error?result:(addedCount+=result.addedCount,__spreadValues$9({addedCount},SUCCESS))}var __defProp$8=Object.defineProperty,__defProps$4=Object.defineProperties,__getOwnPropDescs$4=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$8=Object.getOwnPropertySymbols,__hasOwnProp$8=Object.prototype.hasOwnProperty,__propIsEnum$8=Object.prototype.propertyIsEnumerable,__defNormalProp$8=(obj,key,value)=>key in obj?__defProp$8(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$8=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$8.call(b,prop)&&__defNormalProp$8(a,prop,b[prop]);if(__getOwnPropSymbols$8)for(var prop of __getOwnPropSymbols$8(b))__propIsEnum$8.call(b,prop)&&__defNormalProp$8(a,prop,b[prop]);return a},__spreadProps$4=(a,b)=>__defProps$4(a,__getOwnPropDescs$4(b));function generateEventParticipants({participantsProfile={},uniqueParticipantsCount,ratingsParameters,tournamentRecord,eventProfile,eventIndex,event,uuids}){const{category,gender,eventType}=event,eventParticipantType=eventType===SINGLES&&INDIVIDUAL||eventType===DOUBLES&&PAIR||eventType,participantsCount=(uniqueParticipantsCount[MAIN]||0)+(uniqueParticipantsCount[QUALIFYING]||0),sex=[MALE,FEMALE].includes(gender)?gender:void 0,idPrefix=(null==participantsProfile?void 0:participantsProfile.idPrefix)?`E-${eventIndex}-${null==participantsProfile?void 0:participantsProfile.idPrefix}`:void 0,{participants:uniqueFlightParticipants}=generateParticipants(__spreadProps$4(__spreadValues$8({uuids:eventProfile.uuids||uuids},participantsProfile),{scaledParticipantsCount:eventProfile.scaledParticipantsCount,consideredDate:null==tournamentRecord?void 0:tournamentRecord.startDate,rankingRange:eventProfile.rankingRange,participantType:eventParticipantType,participantsCount,ratingsParameters,idPrefix,category,sex}));let result=addParticipants({participants:uniqueFlightParticipants,tournamentRecord});if(result.error)return result;return{uniqueDrawParticipants:uniqueFlightParticipants.filter((({participantType})=>participantType===eventParticipantType)),uniqueParticipantIds:uniqueFlightParticipants.map(getParticipantId)}}function getStageParticipantsCount({drawProfiles,category,gender}){const uniqueParticipantsCount={},stageParticipantsCount=null==drawProfiles?void 0:drawProfiles.reduce(((stageParticipantsCount2,drawProfile)=>{const{qualifyingPositions=0,participantsCount=0,uniqueParticipants,stage=MAIN,drawSize=0}=drawProfile||{};Object.keys(stageParticipantsCount2).includes(stage)||(stageParticipantsCount2[stage]=0);const stageCount=(participantsCount||drawSize)-qualifyingPositions;return uniqueParticipants||gender||category||stage===QUALIFYING?(Object.keys(uniqueParticipantsCount).includes(stage)||(uniqueParticipantsCount[stage]=0),uniqueParticipantsCount[stage]+=stageCount):stageParticipantsCount2[stage]=Math.max(stageParticipantsCount2[stage],stageCount),stageParticipantsCount2}),{}),uniqueParticipantStages=Object.keys(uniqueParticipantsCount);return uniqueParticipantStages.forEach((stage=>stageParticipantsCount[stage]+=uniqueParticipantsCount[stage])),{stageParticipantsCount,uniqueParticipantsCount,uniqueParticipantStages}}function getStageParticipants({allUniqueParticipantIds,stageParticipantsCount,eventParticipantType,targetParticipants}){const mainParticipantsCount=stageParticipantsCount[MAIN]||0,qualifyingParticipantsCount=stageParticipantsCount[QUALIFYING]||0;return{stageParticipants:{QUALIFYING:targetParticipants.filter((({participantType})=>participantType===eventParticipantType)).filter((({participantId})=>!allUniqueParticipantIds.includes(participantId))).slice(0,qualifyingParticipantsCount),MAIN:targetParticipants.filter((({participantType})=>participantType===eventParticipantType)).filter((({participantId})=>!allUniqueParticipantIds.includes(participantId))).slice(qualifyingParticipantsCount,qualifyingParticipantsCount+mainParticipantsCount)}}}var __defProp$7=Object.defineProperty,__getOwnPropSymbols$7=Object.getOwnPropertySymbols,__hasOwnProp$7=Object.prototype.hasOwnProperty,__propIsEnum$7=Object.prototype.propertyIsEnumerable,__defNormalProp$7=(obj,key,value)=>key in obj?__defProp$7(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$7=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$7.call(b,prop)&&__defNormalProp$7(a,prop,b[prop]);if(__getOwnPropSymbols$7)for(var prop of __getOwnPropSymbols$7(b))__propIsEnum$7.call(b,prop)&&__defNormalProp$7(a,prop,b[prop]);return a};function generateFlight({autoEntryPositions,tournamentRecord,drawParticipants,drawProfile,event}){const{drawType=SINGLE_ELIMINATION,qualifyingPositions=0,stage=MAIN,drawSize=0,drawName,drawId}=drawProfile,entriesCount=drawSize-qualifyingPositions,drawParticipantIds=drawParticipants.slice(0,entriesCount).map(getParticipantId);if(drawParticipantIds.length){const result2=addEventEntries({participantIds:drawParticipantIds,autoEntryPositions,tournamentRecord,stage,event});if(result2.error)return result2}const result=addFlight({drawName:drawName||drawType,qualifyingPositions,drawEntries:drawParticipantIds.map((participantId=>({entryStatus:DIRECT_ACCEPTANCE,entryStage:stage,participantId}))),drawId,event,stage});return result.error?result:__spreadValues$7({},SUCCESS)}var __defProp$6=Object.defineProperty,__getOwnPropSymbols$6=Object.getOwnPropertySymbols,__hasOwnProp$6=Object.prototype.hasOwnProperty,__propIsEnum$6=Object.prototype.propertyIsEnumerable,__defNormalProp$6=(obj,key,value)=>key in obj?__defProp$6(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$6=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$6.call(b,prop)&&__defNormalProp$6(a,prop,b[prop]);if(__getOwnPropSymbols$6)for(var prop of __getOwnPropSymbols$6(b))__propIsEnum$6.call(b,prop)&&__defNormalProp$6(a,prop,b[prop]);return a};function generateFlights({uniqueDrawParticipants,autoEntryPositions,stageParticipants,tournamentRecord,drawProfiles,category,gender,event}){let uniqueParticipantsIndex=0;for(const drawProfile of drawProfiles){const{qualifyingPositions=0,uniqueParticipants,stage=MAIN,drawSize=0}=drawProfile,entriesCount=drawSize-qualifyingPositions,requiresUniqueParticipants=uniqueParticipants||gender||category||stage===QUALIFYING,drawParticipants=requiresUniqueParticipants?uniqueDrawParticipants.slice(uniqueParticipantsIndex,uniqueParticipantsIndex+entriesCount):stageParticipants[stage||MAIN]||[];requiresUniqueParticipants&&(uniqueParticipantsIndex+=entriesCount);const result=generateFlight({autoEntryPositions,drawParticipants,tournamentRecord,drawProfile,event});if(result.error)return result}return __spreadValues$6({},SUCCESS)}var __defProp$5=Object.defineProperty,__defProps$3=Object.defineProperties,__getOwnPropDescs$3=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$5=Object.getOwnPropertySymbols,__hasOwnProp$5=Object.prototype.hasOwnProperty,__propIsEnum$5=Object.prototype.propertyIsEnumerable,__defNormalProp$5=(obj,key,value)=>key in obj?__defProp$5(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$5=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$5.call(b,prop)&&__defNormalProp$5(a,prop,b[prop]);if(__getOwnPropSymbols$5)for(var prop of __getOwnPropSymbols$5(b))__propIsEnum$5.call(b,prop)&&__defNormalProp$5(a,prop,b[prop]);return a},__spreadProps$3=(a,b)=>__defProps$3(a,__getOwnPropDescs$3(b));function generateEventWithFlights({allUniqueParticipantIds,matchUpStatusProfile,participantsProfile,completeAllMatchUps,autoEntryPositions,hydrateCollections,randomWinningSide,ratingsParameters,tournamentRecord,eventProfile,eventIndex,publish,uuids}){let gender=eventProfile.gender,eventName=eventProfile.eventName;const{eventType=SINGLES,policyDefinitions,drawProfiles=[],eventExtensions,surfaceCategory,tieFormatName,discipline,eventLevel,timeItems,ballType,category}=eventProfile,tieFormat=eventProfile.tieFormat||(eventType===TEAM$1?tieFormatDefaults({namedFormat:tieFormatName,event:{category,gender},hydrateCollections}):void 0);let targetParticipants=tournamentRecord.participants;for(const drawProfile of drawProfiles)!gender&&drawProfile.gender&&(gender=null==drawProfile?void 0:drawProfile.gender);const{stageParticipantsCount,uniqueParticipantsCount,uniqueParticipantStages}=getStageParticipantsCount({drawProfiles,category,gender}),eventParticipantType=eventType===SINGLES&&INDIVIDUAL||eventType===DOUBLES&&PAIR||eventType,{uniqueDrawParticipants=[],uniqueParticipantIds=[]}=uniqueParticipantStages?generateEventParticipants({event:{eventType,category,gender},uniqueParticipantsCount,participantsProfile,ratingsParameters,tournamentRecord,eventProfile,eventIndex,uuids}):{};let{eventAttributes}=eventProfile;"object"!=typeof eventAttributes&&(eventAttributes={});const categoryName=(null==category?void 0:category.categoryName)||(null==category?void 0:category.ageCategoryCode)||(null==category?void 0:category.ratingType),eventId=eventProfile.eventId||UUID();eventName=eventName||categoryName||"Generated Event";const newEvent=__spreadProps$3(__spreadValues$5({},eventAttributes),{surfaceCategory,discipline,eventLevel,eventName,eventType,tieFormat,ballType,category,eventId,gender});if((null==eventExtensions?void 0:eventExtensions.length)&&Array.isArray(eventExtensions)){const extensions=eventExtensions.filter(isValidExtension);(null==extensions?void 0:extensions.length)&&Object.assign(newEvent,{extensions})}if(Array.isArray(timeItems)&&timeItems.forEach((timeItem=>addEventTimeItem({event,timeItem}))),"object"==typeof policyDefinitions)for(const policyType of Object.keys(policyDefinitions))attachEventPolicies({policyDefinitions:{[policyType]:policyDefinitions[policyType]},event:newEvent});newEvent.category&&(newEvent.category.categoryName=categoryName);let result=addEvent({suppressNotifications:!1,tournamentRecord,event:newEvent});if(result.error)return result;const{event}=result,{stageParticipants}=getStageParticipants({allUniqueParticipantIds,stageParticipantsCount,eventParticipantType,targetParticipants});if(result=generateFlights({uniqueDrawParticipants,autoEntryPositions,stageParticipants,tournamentRecord,drawProfiles,category,gender,event}),result.error)return result;if(result=generateFlightDrawDefinitions({matchUpStatusProfile,completeAllMatchUps,randomWinningSide,tournamentRecord,drawProfiles,event}),result.error)return result;const drawIds=result.drawIds;return publish&&publishEvent({tournamentRecord,event}),{drawIds,eventId,uniqueParticipantIds}}var __defProp$4=Object.defineProperty,__defProps$2=Object.defineProperties,__getOwnPropDescs$2=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4=Object.getOwnPropertySymbols,__hasOwnProp$4=Object.prototype.hasOwnProperty,__propIsEnum$4=Object.prototype.propertyIsEnumerable,__defNormalProp$4=(obj,key,value)=>key in obj?__defProp$4(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4.call(b,prop)&&__defNormalProp$4(a,prop,b[prop]);if(__getOwnPropSymbols$4)for(var prop of __getOwnPropSymbols$4(b))__propIsEnum$4.call(b,prop)&&__defNormalProp$4(a,prop,b[prop]);return a},__spreadProps$2=(a,b)=>__defProps$2(a,__getOwnPropDescs$2(b));function generateEventWithDraw({allUniqueParticipantIds=[],participantsProfile={},matchUpStatusProfile,completeAllMatchUps,autoEntryPositions,hydrateCollections,randomWinningSide,ratingsParameters,tournamentRecord,isMock=!0,drawProfile,startDate,drawIndex,uuids}){var _a;const drawProfileCopy=makeDeepCopy(drawProfile,!1,!0),{excessParticipantAlternates=!0,matchUpFormat=FORMAT_STANDARD,drawType=SINGLE_ELIMINATION,tournamentAlternates=0,alternatesCount=0,qualifyingPositions,qualifyingProfiles,generate=!0,eventExtensions,drawExtensions,completionGoal,tieFormatName,seedsCount,timeItems,drawName,category,idPrefix,publish,gender,stage}=drawProfileCopy;let drawSize=drawProfileCopy.drawSize||(drawProfileCopy.ignoreDefaults?void 0:32);const eventType=drawProfile.eventType||drawProfile.matchUpType||SINGLES,participantType=eventType===DOUBLES?PAIR:INDIVIDUAL,tieFormat="object"==typeof drawProfile.tieFormat&&drawProfile.tieFormat||eventType===TEAM&&tieFormatDefaults({namedFormat:tieFormatName,event:{category,gender},hydrateCollections})||void 0,categoryName=(null==category?void 0:category.categoryName)||(null==category?void 0:category.ageCategoryCode)||(null==category?void 0:category.ratingType);let eventName=drawProfile.eventName||categoryName||`Generated ${eventType}`,targetParticipants=(null==tournamentRecord?void 0:tournamentRecord.participants)||[];const qualifyingParticipantsCount=((null==qualifyingProfiles?void 0:qualifyingProfiles.map((profile=>profile.structureProfiles||[])).flat().reduce(((count,profile)=>count+(!profile.participantsCount||profile.participantsCount>profile.drawSize?profile.drawSize:profile.participantsCount||0)),0))||0)*(participantType===DOUBLES?2:1),participantsCount=(!drawProfile.participantsCount||drawProfile.participantsCount>drawSize?drawSize:drawProfile.participantsCount)||0,eventId=drawProfileCopy.eventId||UUID();let event={eventName,eventType,tieFormat,category,eventId,gender};Array.isArray(timeItems)&&timeItems.forEach((timeItem=>addEventTimeItem({event,timeItem})));let{eventAttributes}=drawProfile;if("object"!=typeof eventAttributes&&(eventAttributes={}),Object.assign(event,eventAttributes),(null==eventExtensions?void 0:eventExtensions.length)&&Array.isArray(eventExtensions)){const extensions=eventExtensions.filter(isValidExtension);(null==extensions?void 0:extensions.length)&&Object.assign(event,{extensions})}const uniqueParticipantIds=[];if(qualifyingParticipantsCount||drawProfile.uniqueParticipants||!tournamentRecord||gender||category){const drawParticipantsCount=(participantsCount||0)+alternatesCount+qualifyingParticipantsCount;let individualParticipantCount=drawParticipantsCount;const gendersCount={[MALE]:0,[FEMALE]:0};let teamSize,genders;eventType===TEAM&&(({teamSize,genders}=processTieFormat({alternatesCount,tieFormatName,tieFormat,drawSize})),Object.keys(genders).forEach((key=>{[MALE,FEMALE].includes(key)&&genders[key]&&(gendersCount[key]=drawSize*genders[key])})),individualParticipantCount=teamSize*((drawSize||0)+qualifyingParticipantsCount));const idPrefix2=(null==participantsProfile?void 0:participantsProfile.idPrefix)?`D-${drawIndex}-${null==participantsProfile?void 0:participantsProfile.idPrefix}`:void 0,result2=generateParticipants(__spreadProps$2(__spreadValues$4({},participantsProfile),{scaledParticipantsCount:drawProfile.scaledParticipantsCount||participantsProfile.scaledParticipantsCount,participantsCount:individualParticipantCount,consideredDate:null==tournamentRecord?void 0:tournamentRecord.startDate,sex:gender||(null==participantsProfile?void 0:participantsProfile.sex),rankingRange:drawProfile.rankingRange,uuids:drawProfile.uuids||uuids,ratingsParameters,participantType,gendersCount,idPrefix:idPrefix2,category})),{participants:unique}=result2;if(event.category&&(event.category.categoryName=categoryName),tournamentRecord){const result3=addParticipants({participants:unique,tournamentRecord});if(result3.error)return result3}if(unique.forEach((({participantId})=>uniqueParticipantIds.push(participantId))),targetParticipants=unique,eventType===TEAM){const maleIndividualParticipantIds=genders[MALE]?unique.filter((({participantType:participantType2,person})=>participantType2===INDIVIDUAL&&person.sex===MALE)).map(getParticipantId):[],femaleIndividualParticipantIds=genders[FEMALE]?unique.filter((({participantType:participantType2,person})=>participantType2===INDIVIDUAL&&person.sex===FEMALE)).map(getParticipantId):[],remainingParticipantIds=unique.filter((({participantType:participantType2})=>participantType2===INDIVIDUAL)).map(getParticipantId).filter((participantId=>!maleIndividualParticipantIds.includes(participantId)&&!femaleIndividualParticipantIds.includes(participantId))),mixedCount=teamSize-(genders[MALE]+genders[FEMALE]);let fIndex=0,mIndex=0,rIndex=0;const teamParticipants=generateRange(0,drawParticipantsCount).map((teamIndex=>{const fPIDs=femaleIndividualParticipantIds.slice(fIndex,fIndex+genders[FEMALE]),mPIDs=maleIndividualParticipantIds.slice(mIndex,mIndex+genders[MALE]),rIDs=remainingParticipantIds.slice(rIndex,rIndex+mixedCount);return fIndex+=genders[FEMALE],mIndex+=genders[MALE],rIndex+=mixedCount,{individualParticipantIds:[...fPIDs,...mPIDs,...rIDs],participantOtherName:`TM${teamIndex+1}`,participantName:`Team ${teamIndex+1}`,participantRole:COMPETITOR,participantType:TEAM,participantId:UUID()}})),result3=addParticipants({participants:teamParticipants,tournamentRecord});if(!result3.success)return result3;targetParticipants=teamParticipants}}const isEventParticipantType=participant=>{const{participantType:participantType2}=participant;return eventType===SINGLES&&participantType2===INDIVIDUAL||(eventType===DOUBLES&&participantType2===PAIR||eventType===TEAM&&participantType2===TEAM)},isEventGender=participant=>{var _a2,_b;return!drawProfile.gender||((null==(_a2=participant.person)?void 0:_a2.sex)===drawProfile.gender||(!!(null==(_b=participant.individualParticipantIds)?void 0:_b.some((participantId=>{const individualParticipant=targetParticipants.find((p=>p.participantId===participantId));return individualParticipant&&isEventGender(individualParticipant)})))||void 0))},consideredParticipants=targetParticipants.filter(isEventParticipantType).filter(isEventGender).filter((({participantId})=>!allUniqueParticipantIds.includes(participantId))),participantIds=consideredParticipants.slice(0,participantsCount).map((p=>p.participantId));if(isMock&&(null==participantIds?void 0:participantIds.length)){const result2=addEventEntries({autoEntryPositions,entryStage:stage,tournamentRecord,participantIds,event});if(result2.error)return result2}const qualifyingParticipantIds=qualifyingParticipantsCount?consideredParticipants.slice(participantsCount,participantsCount+qualifyingParticipantsCount).map((p=>p.participantId)):0;if(isMock&&(null==qualifyingParticipantIds?void 0:qualifyingParticipantIds.length)){let qualifyingIndex=0,roundTarget=1;const sequenceSort=(a,b)=>a.stageSequence-b.stageSequence,roundTargetSort=(a,b)=>a.roundTarget-b.roundTarget;for(const roundTargetProfile of qualifyingProfiles.sort(roundTargetSort)){roundTarget=roundTargetProfile.roundTarget||roundTarget;let qualifyingPositions2,entryStageSequence=1;for(const structureProfile of roundTargetProfile.structureProfiles.sort(sequenceSort)){const participantsCount2=(structureProfile.drawSize||coerceEven(structureProfile.participantsCount))-(qualifyingPositions2||0),participantIds2=qualifyingParticipantIds.slice(qualifyingIndex,qualifyingIndex+participantsCount2),result2=addEventEntries({entryStage:QUALIFYING,entryStageSequence,autoEntryPositions,tournamentRecord,participantIds:participantIds2,roundTarget,event});if(result2.error)return result2;qualifyingPositions2=structureProfile.qualifyingPositions,qualifyingIndex+=participantsCount2,entryStageSequence+=1}roundTarget+=1}}const alternatesParticipantIds=excessParticipantAlternates&&(null==(_a=null==tournamentRecord?void 0:tournamentRecord.participants)?void 0:_a.filter((({participantId})=>!participantIds.includes(participantId))).filter(isEventParticipantType).filter(isEventGender).slice(0,alternatesCount||drawSize-participantsCount||tournamentAlternates).map((p=>p.participantId)));if(isMock&&(null==alternatesParticipantIds?void 0:alternatesParticipantIds.length)){const result2=addEventEntries({participantIds:alternatesParticipantIds,autoEntryPositions:!1,entryStatus:ALTERNATE,tournamentRecord,event});if(result2.error)return result2.error}const seedingScaleName=categoryName||eventName;if(tournamentRecord&&seedsCount&&seedsCount<=participantIds.length){generateRange(1,seedsCount+1).forEach(((scaleValue,index)=>{let scaleItem={scaleName:seedingScaleName,scaleDate:startDate,scaleType:SEEDING,scaleValue,eventType};const participantId=participantIds[index];setParticipantScaleItem({tournamentRecord,participantId,scaleItem})}))}const result=generateDrawDefinition(__spreadProps$2(__spreadValues$4({},makeDeepCopy(drawProfile,!1,!0)),{tournamentRecord,seedingScaleName,matchUpFormat,eventId,isMock,event}));if(result.error)return result;const{drawDefinition}=result,drawId=drawDefinition.drawId;if(Array.isArray(drawExtensions)&&drawExtensions.filter(isValidExtension).forEach((extension=>addExtension$1({element:drawDefinition,extension}))),generate){if(addDrawDefinition$1({drawDefinition,event,suppressNotifications:!0}),drawType===AD_HOC&&drawProfile.drawMatic){const roundsCount=drawProfile.roundsCount||1;for(const roundNumber of generateRange(1,roundsCount+1)){const result2=drawMatic({generateMatchUps:!0,tournamentRecord,drawDefinition,roundNumber});if(result2.error)return result2}}if(drawProfile.withPlayoffs){const structureId=drawDefinition.structures[0].structureId,result2=addPlayoffStructures$1(__spreadProps$2(__spreadValues$4({},drawProfile.withPlayoffs),{tournamentRecord,drawDefinition,structureId,idPrefix,isMock,event}));if(null==result2?void 0:result2.error)return result2}const manual=!1===drawProfile.automated;if(isMock&&!manual){if(drawProfile.outcomes){const{matchUps}=allDrawMatchUps$1({drawDefinition,inContext:!0,event});for(const outcomeDef of drawProfile.outcomes){const{roundNumber,drawPositions,roundPosition,scoreString,winningSide,stage:stage2=MAIN,matchUpFormat:matchUpFormat2,stageSequence=1,matchUpStatus=COMPLETED$1,matchUpStatusCodes,matchUpIndex=0,structureOrder}=outcomeDef,structureMatchUpIds=matchUps.reduce(((sm,matchUp)=>{const{structureId,matchUpId}=matchUp;return sm[structureId]?sm[structureId].push(matchUpId):sm[structureId]=[matchUpId],sm}),{}),orderedStructures=Object.assign({},...Object.keys(structureMatchUpIds).map(((structureId,index)=>({[structureId]:index+1})))),targetMatchUp=matchUps.filter((matchUp=>!(stage2&&matchUp.stage!==stage2||stageSequence&&matchUp.stageSequence!==stageSequence||roundNumber&&matchUp.roundNumber!==roundNumber||roundPosition&&matchUp.roundPosition!==roundPosition||structureOrder&&orderedStructures[matchUp.structureId]!==structureOrder||drawPositions&&2!==intersection(drawPositions,matchUp.drawPositions).length)))[matchUpIndex],result2=completeDrawMatchUp({matchUpStatusCodes,tournamentRecord,drawDefinition,targetMatchUp,matchUpFormat:matchUpFormat2,matchUpStatus,scoreString,winningSide,drawId});if(null==result2?void 0:result2.error)return result2}}if(completeAllMatchUps||completionGoal){const result2=completeDrawMatchUps({matchUpStatusProfile,completeAllMatchUps,qualifyingProfiles,randomWinningSide,tournamentRecord,completionGoal,drawDefinition,matchUpFormat,event});if(result2.error)return result2;const completedCount=result2.completedCount;if(drawType===ROUND_ROBIN_WITH_PLAYOFF){let result3=automatedPlayoffPositioning({structureId:drawDefinition.structures.find((structure=>structure.stage===MAIN)).structureId,tournamentRecord,drawDefinition,event});if(result3=completeDrawMatchUps({completionGoal:completionGoal?completionGoal?completionGoal-completedCount:void 0:void 0,matchUpStatusProfile,completeAllMatchUps,randomWinningSide,tournamentRecord,drawDefinition,matchUpFormat,event}),result3.error)return result3}}}publish&&publishEvent({tournamentRecord,event})}else{const result2=addFlight({drawEntries:drawDefinition.entries,drawName:drawName||drawType,qualifyingPositions,drawId,event,stage});if(result2.error)return result2}return __spreadProps$2(__spreadValues$4({},SUCCESS),{event:definedAttributes(event),uniqueParticipantIds,targetParticipants,drawDefinition,eventId,drawId})}function generateVenues({tournamentRecord,venueProfiles}){const{startDate,endDate}=tournamentRecord;let venueIds=[];for(const[index,venueProfile]of venueProfiles.entries()){let{venueAbbreviation,venueId=UUID(),dateAvailability,startTime="07:00",endTime="19:00",courtTimings,courtsCount,courtNames,venueName,idPrefix,courtIds}=venueProfile;let result=addVenue$1({tournamentRecord,venue:{venueName:venueName||`Venue ${index+1}`,venueAbbreviation,venueId}});if(result.error)return result;venueIds.push(venueId);const dates=dateRange(startDate,endDate),generatedDateAvailability=!Array.isArray(dateAvailability)&&[{startTime,endTime}].concat(dates.map((date=>({date:formatDate(date),startTime,endTime}))));if(result=addCourts$1({dateAvailability:dateAvailability||generatedDateAvailability,tournamentRecord,courtTimings,courtsCount,courtNames,startTime,idPrefix,courtIds,endTime,venueId,dates}),result.error)return result}return venueIds}var __defProp$3=Object.defineProperty,__defProps$1=Object.defineProperties,__getOwnPropDescs$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3=Object.getOwnPropertySymbols,__hasOwnProp$3=Object.prototype.hasOwnProperty,__propIsEnum$3=Object.prototype.propertyIsEnumerable,__defNormalProp$3=(obj,key,value)=>key in obj?__defProp$3(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;const amendsGovernor={anonymizeTournamentRecord:function anonymizeTournamentRecord({keepExtensions=[],anonymizeParticipantNames=!0,tournamentRecord,tournamentName,personIds=[],tournamentId}){var _a,_b,_c,_d,_e;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const extensionsToKeep=Array.isArray(keepExtensions)?internalExtensions.concat(...keepExtensions):internalExtensions,filterExtensions=element=>{var _a2;return Array.isArray(keepExtensions)?null==(_a2=null==element?void 0:element.extensions)?void 0:_a2.filter((extension=>extensionsToKeep.includes(extension.name))):null==element?void 0:element.extensions},idMap={};tournamentRecord.extensions=filterExtensions(tournamentRecord);const newTournamentId=tournamentId||UUID();idMap[tournamentRecord.tournamentId]=newTournamentId,tournamentRecord.tournamentId=newTournamentId,tournamentRecord.createdAt=(new Date).toISOString(),tournamentRecord.tournamentName=tournamentName||`Anonymized: ${formatDate(new Date)}`,delete tournamentRecord.parentOrganisation;for(const participant of tournamentRecord.participants||[]){const newParticipantId=UUID();idMap[participant.participantId]=newParticipantId,participant.participantId=newParticipantId}for(const participant of tournamentRecord.participants||[])Array.isArray(participant.individualParticipantIds)&&(participant.individualParticipantIds=participant.individualParticipantIds.map((individualParticipantId=>idMap[individualParticipantId])));let venueIndex=0;for(const venue of tournamentRecord.venues||[]){venue.extensions=filterExtensions(venue),venue.venueName=`Venue #${venueIndex}`,venue.venueAbbreviation=`V${venueIndex}`;const newVenueId=UUID();idMap[venue.venueId]=newVenueId,venueIndex+=1}let eventCount=1;for(const event of tournamentRecord.events||[]){event.extensions=filterExtensions(event);const newEventId=UUID();idMap[event.eventId]=newEventId,event.eventId=newEventId;const categoryName=(null==(_a=event.category)?void 0:_a.categoryName)||(null==(_b=event.category)?void 0:_b.ageCategoryCode)||(null==(_c=event.category)?void 0:_c.ratingType)||event.gender;if(event.eventName=`Event ${eventCount} ${categoryName}`,Array.isArray(event.entries))for(const entry of event.entries)entry.participantId=idMap[entry.participantId];for(const drawDefinition of event.drawDefinitions||[]){drawDefinition.extensions=filterExtensions(drawDefinition);const newDrawId=UUID();if(idMap[drawDefinition.drawId]=newDrawId,drawDefinition.drawId=newDrawId,Array.isArray(drawDefinition.entries))for(const entry of drawDefinition.entries)entry.participantId=idMap[entry.participantId];const updateStructure=structure=>{structure.extensions=filterExtensions(structure);const newStructureId=UUID();idMap[structure.structureId]=newStructureId,structure.structureId=newStructureId;for(const assignment of structure.positionAssignments||[])assignment.participantId&&(assignment.participantId=idMap[assignment.participantId]);for(const assignment of structure.seedAssignments||[])assignment.participantId&&(assignment.participantId=idMap[assignment.participantId]);for(const matchUp of structure.matchUps||[])for(const side of matchUp.sides||[])side.lineUp&&(side.lineUp=side.lineUp.map((({participantId,collectionAssignments})=>({participantId:idMap[participantId],collectionAssignments}))))};for(const structure of drawDefinition.structures||[])if(updateStructure(structure),Array.isArray(structure.structures))for(const childStructure of structure.structures)updateStructure(childStructure);for(const link of drawDefinition.links||[])link.source.structureId=idMap[link.source.structureId],link.target.structureId=idMap[link.target.structureId]}const{extension:flightProfile}=findEventExtension({name:FLIGHT_PROFILE,event});Array.isArray(null==(_d=null==flightProfile?void 0:flightProfile.value)?void 0:_d.flights)&&(null==(_e=flightProfile.value.flights)||_e.forEach((flight=>{if(flight.drawId=idMap[flight.drawId],Array.isArray(flight.drawEntries))for(const entry of flight.drawEntries)entry.participantId=idMap[entry.participantId]}))),eventCount+=1}const consideredDate=tournamentRecord.startDate||formatDate(new Date),individualParticipants=(tournamentRecord.participants||[]).filter((({participantType})=>participantType===INDIVIDUAL)),gendersCount=individualParticipants.reduce(((counts,participant)=>{var _a2;const gender=null==(_a2=participant.person)?void 0:_a2.sex;return[MALE,FEMALE].includes(gender)?counts[gender]+=1:counts[OTHER$2]+=1,counts}),{[MALE]:0,[FEMALE]:0,[OTHER$2]:0}),genderedPersons=Object.assign({},...Object.keys(gendersCount).map((gender=>{var _a2;return{[gender]:(null==(_a2=generatePersons({category:{ageCategoryCode:"O18"},count:gendersCount[gender],addressProps:{citiesCount:10},personExtensions:[],consideredDate,sex:gender}))?void 0:_a2.persons)||[]}}))),genderedIndices={[MALE]:0,[FEMALE]:0,[OTHER$2]:0},individualParticipantsCount=individualParticipants.length,addressComponents=individualParticipants.reduce(((components,participant)=>{var _a2,_b2;const address=(null==(_b2=null==(_a2=participant.person)?void 0:_a2.addresses)?void 0:_b2[0])||{},{city,state,postalCode}=address;return components.cities.includes(city)||components.cities.push(city),components.states.includes(state)||components.states.push(state),components.postalCodes.includes(postalCode)||components.postalCodes.push(postalCode),components}),{cities:[],postalCodes:[],states:[]}),postalCodesCount=addressComponents.postalCodes.length,citiesCount=addressComponents.cities.length,statesCount=addressComponents.states.length,{cities}=cityMocks({count:citiesCount||individualParticipantsCount,participantsCount:individualParticipantsCount}),{states}=stateMocks({count:statesCount||individualParticipantsCount,participantsCount:individualParticipantsCount}),{postalCodes}=postalCodeMocks({count:postalCodesCount||individualParticipantsCount,participantsCount:individualParticipantsCount}),addressValues={cities,states,postalCodes};individualParticipants.forEach(((individualParticipant,participantIndex)=>{var _a2,_b2;const person=null==individualParticipant?void 0:individualParticipant.person,gender=(null==person?void 0:person.sex)||OTHER$2,birthYear=null==(_a2=extractDate(null==person?void 0:person.birthDate))?void 0:_a2.split("-")[0],genderedIndex=genderedIndices[gender],generatedPerson=genderedPersons[gender][genderedIndex];if(genderedIndices[gender]+=1,birthYear){const[,month,day]=(null==(_b2=null==generatedPerson?void 0:generatedPerson.birthDate)?void 0:_b2.split("-"))||[],birthDate=[birthYear,month,day].join("-");generatedPerson.birthDate=birthDate}if(null==person?void 0:person.addresses){const address=generateAddress((a=__spreadValues$f({},addressValues),b={participantIndex,nationalityCode:generatedPerson.nationalityCode},__defProps$b(a,__getOwnPropDescs$b(b))));generatedPerson.addresses=[address]}var a,b;generatedPerson.personId=(null==personIds?void 0:personIds[participantIndex])||UUID(),anonymizeParticipantNames?(generatedPerson.standardFamilyName=generatedPerson.lastName,generatedPerson.standardGivenName=generatedPerson.firstName,individualParticipant.participantName=`${generatedPerson.standardGivenName} ${generatedPerson.standardFamilyName}`):(generatedPerson.standardFamilyName=null==person?void 0:person.standardFamilyName,generatedPerson.standardGivenName=null==person?void 0:person.standardGivenName),delete generatedPerson.firstName,delete generatedPerson.lastName,generatedPerson.extensions=filterExtensions(person),individualParticipant.person=generatedPerson,idMap[null==person?void 0:person.personId]=generatedPerson.personId})),(tournamentRecord.participants||[]).filter((({participantType})=>participantType===PAIR)).forEach((pairParticipant=>{const{individualParticipantIds}=pairParticipant;pairParticipant.participantName=function generatePairParticipantName({individualParticipantIds,individualParticipants}){let participantName=individualParticipants.filter((({participantId})=>individualParticipantIds.includes(participantId))).map((({person})=>null==person?void 0:person.standardFamilyName)).filter(Boolean).sort().join("/");1===individualParticipantIds.length&&(participantName+="/Unknown");return participantName}({individualParticipantIds,individualParticipants})}));const teamParticipants=(tournamentRecord.participants||[]).filter((({participantType})=>participantType===TEAM)),teamNames=nameMocks({count:teamParticipants.length}).names;teamParticipants.forEach(((teamParticipant,i)=>{teamParticipant.participantName=teamNames[i]}));const groupParticipants=(tournamentRecord.participants||[]).filter((({participantType})=>participantType===GROUP)),groupNames=nameMocks({count:groupParticipants.length,nameRood:"Group"}).names;groupParticipants.forEach(((teamParticipant,i)=>{teamParticipant.participantName=groupNames[i]}));const{extension:schedulingProfile}=findTournamentExtension({name:SCHEDULING_PROFILE,tournamentRecord});Array.isArray(null==schedulingProfile?void 0:schedulingProfile.value)&&schedulingProfile.value.forEach((round=>{round.tournamentId=idMap[round.tournamentId],round.structureId=idMap[round.structureId],round.eventId=idMap[round.eventId],round.drawId=idMap[round.drawId]}));const{extension:personRequests}=findTournamentExtension({name:PERSON_REQUESTS,tournamentRecord});return Array.isArray(null==personRequests?void 0:personRequests.value)&&personRequests.value.forEach((request=>{request.personId=idMap[request.personId]})),__spreadValues$f({},SUCCESS)},modifyTournamentRecord:function modifyTournamentRecord({ratingsParameters:ratingsParameters$1=ratingsParameters,participantsProfile={},matchUpStatusProfile,completeAllMatchUps,autoEntryPositions,hydrateCollections,randomWinningSide,schedulingProfile,tournamentRecord,eventProfiles,venueProfiles,autoSchedule,drawProfiles,uuids}){var _a,_b,_c;if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};const allUniqueParticipantIds=[],eventIds=[],drawIds=[];null==eventProfiles||eventProfiles.forEach((eventProfile=>{var _a2;const event=null==(_a2=tournamentRecord.events)?void 0:_a2.find(((event2,index)=>void 0!==eventProfile.eventIndex&&index===eventProfile.eventIndex||eventProfile.eventName&&event2.eventName===eventProfile.eventName||eventProfile.eventId&&event2.eventId===eventProfile.eventId));(null==event?void 0:event.gender)&&(eventProfile.gender=event.gender)}));const participantsCount=(null==(_a=tournamentRecord.participants)?void 0:_a.length)||void 0;participantsCount&&(null==participantsProfile?void 0:participantsProfile.idPrefix)&&(participantsProfile.idPrefix=`${participantsProfile.idPrefix}-${participantsCount}`);const result=addTournamentParticipants({startDate:tournamentRecord.startDate,participantsProfile,tournamentRecord,eventProfiles,drawProfiles,uuids});if(!result.success)return result;if(eventProfiles){let eventIndex=(null==(_b=tournamentRecord.events)?void 0:_b.length)||0;for(const eventProfile of eventProfiles){let{ratingsParameters:ratingsParameters2}=eventProfile;const event=null==(_c=tournamentRecord.events)?void 0:_c.find(((event2,index)=>void 0!==eventProfile.eventIndex&&index===eventProfile.eventIndex||eventProfile.eventName&&event2.eventName===eventProfile.eventName||eventProfile.eventId&&event2.eventId===eventProfile.eventId));if(event){const{gender,category,eventType}=event,{drawProfiles:drawProfiles2,publish}=eventProfile,eventParticipantType=eventType===SINGLES&&INDIVIDUAL||eventType===DOUBLES&&PAIR||eventType;if(drawProfiles2){const{stageParticipantsCount,uniqueParticipantsCount,uniqueParticipantStages}=getStageParticipantsCount({drawProfiles:drawProfiles2,category,gender}),{uniqueDrawParticipants=[],uniqueParticipantIds=[]}=uniqueParticipantStages?generateEventParticipants({event:{eventType,category,gender},uniqueParticipantsCount,participantsProfile,ratingsParameters:ratingsParameters2,tournamentRecord,eventProfile,uuids}):{};allUniqueParticipantIds.push(...uniqueParticipantIds);const{stageParticipants}=getStageParticipants({targetParticipants:tournamentRecord.participants||[],allUniqueParticipantIds,stageParticipantsCount,eventParticipantType});let result2=generateFlights({uniqueDrawParticipants,autoEntryPositions,stageParticipants,tournamentRecord,drawProfiles:drawProfiles2,category,gender,event});if(result2.error)return result2;if(result2=generateFlightDrawDefinitions({matchUpStatusProfile,completeAllMatchUps,randomWinningSide,tournamentRecord,drawProfiles:drawProfiles2,event}),result2.error)return result2;drawIds.push(...result2.drawIds)}publish&&publishEvent({tournamentRecord,event})}else{const result2=generateEventWithFlights({startDate:tournamentRecord.startDate,allUniqueParticipantIds,matchUpStatusProfile,participantsProfile,completeAllMatchUps,autoEntryPositions,randomWinningSide,ratingsParameters:ratingsParameters2,tournamentRecord,eventProfile,eventIndex,uuids});if(result2.error)return result2;const{eventId,drawIds:generatedDrawIds,uniqueParticipantIds}=result2;generatedDrawIds&&drawIds.push(...generatedDrawIds),eventIds.push(eventId),(null==uniqueParticipantIds?void 0:uniqueParticipantIds.length)&&allUniqueParticipantIds.push(...uniqueParticipantIds),eventIndex+=1}}}if(drawProfiles){let drawIndex=(tournamentRecord.events||[]).map((event=>{var _a2;return(null==(_a2=event.drawDefinitions)?void 0:_a2.map((()=>1)))||[]})).flat().reduce(((a,b)=>a+b),0);for(const drawProfile of drawProfiles){let result2=generateEventWithDraw({startDate:tournamentRecord.startDate,allUniqueParticipantIds,matchUpStatusProfile,participantsProfile,completeAllMatchUps,autoEntryPositions,hydrateCollections,randomWinningSide,ratingsParameters:ratingsParameters$1,tournamentRecord,drawProfile,drawIndex,uuids});if(result2.error)return result2;const{drawId,eventId,event,uniqueParticipantIds}=result2;if(result2=addEvent({tournamentRecord,event}),result2.error)return result2;drawId&&drawIds.push(drawId),eventIds.push(eventId),(null==uniqueParticipantIds?void 0:uniqueParticipantIds.length)&&allUniqueParticipantIds.push(...uniqueParticipantIds),drawIndex+=1}}const venueIds=(null==venueProfiles?void 0:venueProfiles.length)?generateVenues({tournamentRecord,venueProfiles}):[];let schedulerResult={};if(null==schedulingProfile?void 0:schedulingProfile.length){const result2=setSchedulingProfile$1({tournamentRecords:{[tournamentRecord.tournamentId]:tournamentRecord},schedulingProfile});if(result2.error)return result2;if(autoSchedule){const{tournamentId}=tournamentRecord;schedulerResult=scheduleProfileRounds({tournamentRecords:{[tournamentId]:tournamentRecord}})}}const totalParticipantsCount=tournamentRecord.participants.length;return a=((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$3.call(b,prop)&&__defNormalProp$3(a,prop,b[prop]);if(__getOwnPropSymbols$3)for(var prop of __getOwnPropSymbols$3(b))__propIsEnum$3.call(b,prop)&&__defNormalProp$3(a,prop,b[prop]);return a})({totalParticipantsCount,scheduledRounds:void 0,schedulerResult},SUCCESS),__defProps$1(a,__getOwnPropDescs$1({eventIds,venueIds,drawIds}));var a}};var __defProp$2=Object.defineProperty,__getOwnPropSymbols$2=Object.getOwnPropertySymbols,__hasOwnProp$2=Object.prototype.hasOwnProperty,__propIsEnum$2=Object.prototype.propertyIsEnumerable,__defNormalProp$2=(obj,key,value)=>key in obj?__defProp$2(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$2.call(b,prop)&&__defNormalProp$2(a,prop,b[prop]);if(__getOwnPropSymbols$2)for(var prop of __getOwnPropSymbols$2(b))__propIsEnum$2.call(b,prop)&&__defNormalProp$2(a,prop,b[prop]);return a};var __defProp$1=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1=Object.getOwnPropertySymbols,__hasOwnProp$1=Object.prototype.hasOwnProperty,__propIsEnum$1=Object.prototype.propertyIsEnumerable,__defNormalProp$1=(obj,key,value)=>key in obj?__defProp$1(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp$1.call(b,prop)&&__defNormalProp$1(a,prop,b[prop]);if(__getOwnPropSymbols$1)for(var prop of __getOwnPropSymbols$1(b))__propIsEnum$1.call(b,prop)&&__defNormalProp$1(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b));const mocksGovernor={generateOutcomeFromScoreString,generateTournamentRecord:function generateTournamentRecord({scheduleCompletedMatchUps,ratingsParameters:ratingsParameters$1=ratingsParameters,tournamentName="Mock Tournament",tournamentExtensions,tournamentAttributes,matchUpStatusProfile,participantsProfile,completeAllMatchUps,autoEntryPositions,hydrateCollections,randomWinningSide,policyDefinitions,schedulingProfile,eventProfiles,venueProfiles,drawProfiles,autoSchedule,startDate,endDate,uuids}={}){if(startDate&&!isValidDateString(startDate)||endDate&&!isValidDateString(endDate))return{error:INVALID_DATE};if(eventProfiles&&!Array.isArray(eventProfiles))return{error:INVALID_VALUES};if(!startDate){const tournamentDate=new Date;startDate=formatDate(endDate||tournamentDate),endDate=formatDate(tournamentDate.setDate(tournamentDate.getDate()+7))}if(!endDate){const tournamentDate=new Date(startDate);endDate=formatDate(tournamentDate.setDate(tournamentDate.getDate()+7))}"object"!=typeof tournamentAttributes&&(tournamentAttributes={});const tournamentRecord=newTournamentRecord(__spreadProps(__spreadValues$1({},tournamentAttributes),{tournamentName,startDate,endDate}));if((null==tournamentExtensions?void 0:tournamentExtensions.length)&&Array.isArray(tournamentExtensions)){const extensions=tournamentExtensions.filter(isValidExtension);(null==extensions?void 0:extensions.length)&&Object.assign(tournamentRecord,{extensions,isMock:!0})}if("object"==typeof policyDefinitions)for(const policyType of Object.keys(policyDefinitions))attachPolicies$2({policyDefinitions:{[policyType]:policyDefinitions[policyType]},tournamentRecord});const result=addTournamentParticipants({participantsProfile,tournamentRecord,eventProfiles,drawProfiles,startDate,uuids});if(!result.success)return result;const drawIds=[],eventIds=[],allUniqueParticipantIds=[];if(Array.isArray(drawProfiles)){let drawIndex=0;for(const drawProfile of drawProfiles){let result2=generateEventWithDraw({allUniqueParticipantIds,matchUpStatusProfile,participantsProfile,completeAllMatchUps,autoEntryPositions,hydrateCollections,randomWinningSide,ratingsParameters:ratingsParameters$1,tournamentRecord,isMock:!0,drawProfile,startDate,drawIndex,uuids});if(result2.error)return result2;const{drawId,eventId,event,uniqueParticipantIds}=result2;if(result2=addEvent({suppressNotifications:!1,tournamentRecord,event}),result2.error)return result2;drawId&&drawIds.push(drawId),eventIds.push(eventId),(null==uniqueParticipantIds?void 0:uniqueParticipantIds.length)&&allUniqueParticipantIds.push(...uniqueParticipantIds),drawIndex+=1}}if(eventProfiles){let eventIndex=0;for(const eventProfile of eventProfiles){const result2=generateEventWithFlights({allUniqueParticipantIds,matchUpStatusProfile,participantsProfile,completeAllMatchUps,autoEntryPositions,hydrateCollections,randomWinningSide,ratingsParameters:ratingsParameters$1,tournamentRecord,eventProfile,eventIndex,startDate,uuids});if(result2.error)return result2;const{eventId,drawIds:generatedDrawIds,uniqueParticipantIds}=result2;generatedDrawIds&&drawIds.push(...generatedDrawIds),eventIds.push(eventId),(null==uniqueParticipantIds?void 0:uniqueParticipantIds.length)&&allUniqueParticipantIds.push(...uniqueParticipantIds),eventIndex+=1}}const venueIds=(null==venueProfiles?void 0:venueProfiles.length)?generateVenues({tournamentRecord,venueProfiles,uuids}):[];let scheduledRounds,schedulerResult={};if(schedulingProfile){const result2=function generateSchedulingProfile({schedulingProfile,tournamentRecord}){if("object"!=typeof schedulingProfile)return{error:INVALID_VALUES};const containedStructures=getContainedStructures({tournamentRecord}).containedStructures,{matchUps}=allTournamentMatchUps({tournamentRecord}),{tournamentId}=tournamentRecord,scheduledRounds=[];for(const dateProfile of schedulingProfile){const{scheduleDate,venues=[]}=dateProfile;for(const venue of venues){const{rounds,venueId}=venue;for(const round of rounds){const{drawId,winnerFinishingPositionRange,roundSegment}=round,targetMatchUp=matchUps.filter((matchUp=>{var _a;const targetRange=(null==winnerFinishingPositionRange?void 0:winnerFinishingPositionRange.indexOf("-"))>0&&winnerFinishingPositionRange.split("-").map((x=>+x)),range=null==(_a=matchUp.finishingPositionRange)?void 0:_a.winner;return!(matchUp.drawId!==drawId||round.roundNumber&&matchUp.roundNumber!==round.roundNumber||range&&targetRange&&2!==intersection(range,targetRange).length&&(unique(range).length!==unique(targetRange).length||intersection(range,targetRange).length!==unique(range).length))}))[0];if(targetMatchUp){const{eventId,roundNumber,drawName,structureName,roundName}=targetMatchUp;let structureId=targetMatchUp.structureId;roundNumber&&!winnerFinishingPositionRange&&(structureId=Object.keys(containedStructures).find((containingStructureId=>containedStructures[containingStructureId].includes(structureId)))||structureId);const roundToSchedule={tournamentId,structureId,roundNumber,roundSegment,eventId,drawId};let result=addSchedulingProfileRound({tournamentRecords:{[tournamentId]:tournamentRecord},round:roundToSchedule,scheduleDate,venueId});if(result.error)return result;scheduledRounds.push(__spreadValues$2({structureName,roundName,drawName},roundToSchedule))}}}}return{scheduledRounds}}({schedulingProfile,tournamentRecord});if(result2.error)return result2;if(scheduledRounds=result2.scheduledRounds,autoSchedule){const{tournamentId}=tournamentRecord;schedulerResult=scheduleProfileRounds({scheduleCompletedMatchUps,tournamentRecords:{[tournamentId]:tournamentRecord}})}}return cycleMutationStatus(),definedAttributes(__spreadProps(__spreadValues$1({},SUCCESS),{tournamentRecord,scheduledRounds,schedulerResult,eventIds,venueIds,drawIds}))},generateEventWithDraw,generateParticipants,parseScoreString,generateOutcome,credits};var __defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;let devContextSet=!1;const mocksEngine=function(){const engine={version:()=>"1.0.3",setDeepCopy:(deepCopyOption,deepCopyAttributes)=>(setDeepCopy(deepCopyOption,deepCopyAttributes),engine),devContext:isDev=>(setDevContext(isDev),devContextSet=!0,engine)};return function importGovernors(governors){governors.forEach((governor=>{Object.keys(governor).forEach((method=>{engine[method]=params=>{try{return function engineInvoke(method,params){const result=method(((a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a})({},params));(null==result?void 0:result.error)||notifySubscribers();deleteNotices(),devContextSet&&(setDevContext(!1),devContextSet=!1);return result}(governor[method],params)}catch(err){const error=err.toString();console.log("ERROR",{error,method,params:JSON.stringify(params)})}}}))}))}([amendsGovernor,mocksGovernor]),engine}(),utilities={structureSort,matchUpSort,tidyScore:function tidyScore({score:incomingScore,stepLog,fullLog,profile,identifier,fileName,sheetName}){let matchUpStatus,attributes,result,modifications=[],applied=[],score=incomingScore;const doProcess=methods=>{methods.forEach((method=>{result=transforms[method]({profile,identifier,matchUpStatus,attributes,applied,score});const modified=result.score!==score;modified&&modifications.push({method,score:result.score}),stepLog&&(fullLog||modified||result.matchUpStatus!==matchUpStatus)&&(matchUpStatus?console.log({score:result.score,matchUpStatus},method):console.log({score:result.score},method)),result.matchUpStatus&&(matchUpStatus=result.matchUpStatus),result.attributes&&(attributes=result.attributes),result.applied&&(applied=result.applied),score=result.score}))};doProcess(processingOrder);let isValid=isValidPattern(score);return isValid||(score=incomingScore.toString().replace(/\D/g,""),(null==attributes?void 0:attributes.removed)&&(attributes.removed=void 0),doProcess(secondPass),isValid=isValidPattern(score),isValid||(score="")),applied.forEach((application=>{transformations[application]||(transformations[application]=0),transformations[application]+=1})),{score,matchUpStatus:null==matchUpStatus?void 0:matchUpStatus.toUpperCase(),modifications,isValid}},generateScoreString,calculateWinCriteria,parseScoreString,proConflicts,addExtension:addExtension$1,chunkArray,countValues:function countValues(values){return function groupValues(obj){return Object.keys(obj).reduce(((p,c)=>{const value=obj[c];return p[value]?p[value].push(c):p[value]=[c],p}),{})}(instanceCount(values))},dateRange,dateTime,definedAttributes,dehydrateMatchUps:function dehydrateMatchUps({tournamentRecord}){if(!tournamentRecord)return{error:MISSING_TOURNAMENT_RECORD};if("object"!=typeof tournamentRecord||!tournamentRecord.tournamentId)return{error:INVALID_VALUES};const{matchUps}=allTournamentMatchUps({tournamentRecord,inContext:!1});if(null==matchUps?void 0:matchUps.length){const matchUpFormatMap=function getMatchUpFormatMap({tournamentRecord}){const matchUpFormatMap={};for(const event of tournamentRecord.events||[]){event.matchUpFormat&&(matchUpFormatMap[event.eventId]=event.matchUpFormat);for(const drawDefinition of event.drawDefinitions||[]){drawDefinition.matchUpFormat&&(matchUpFormatMap[drawDefinition.drawId]=drawDefinition.matchUpFormat);for(const structure of drawDefinition.structures||[]){structure.matchUpFormat&&(matchUpFormatMap[structure.structureId]=structure.matchUpFormat);for(const childStructure of structure.structures||[])childStructure.matchUpFormat&&(matchUpFormatMap[childStructure.structureId]=childStructure.matchUpFormat)}}}return matchUpFormatMap}({tournamentRecord});!function removeExtraneousAttributes(matchUps,matchUpFormatMap={}){for(const matchUp of matchUps){const{structureId,drawId,eventId}=matchUp,inheritedMatchUpFormat=matchUpFormatMap[structureId]||matchUpFormatMap[drawId]||matchUpFormatMap[eventId],matchUpFormat=matchUp.matchUpFormat===inheritedMatchUpFormat?void 0:matchUp.matchUpFormat;for(const key of Object.keys(matchUp))baseAttributeKeys.includes(key)||delete matchUp[key];matchUp.sides&&matchUp.drawPositions&&!matchUp.tieMatchUps&&delete matchUp.sides,matchUpFormat&&(matchUp.matchUpFormat=matchUpFormat)}}(matchUps,matchUpFormatMap)}return((a,b)=>{for(var prop in b||(b={}))__hasOwnProp$4l.call(b,prop)&&__defNormalProp$4k(a,prop,b[prop]);if(__getOwnPropSymbols$4l)for(var prop of __getOwnPropSymbols$4l(b))__propIsEnum$4l.call(b,prop)&&__defNormalProp$4k(a,prop,b[prop]);return a})({},SUCCESS)},findExtension:findExtension$1,garman,getTimeItem,generateHashCode:function generateHashCode(o){if(null===o||"object"!=typeof o)return;const str=JSON.stringify(o),keyCount=countKeys(o),charSum=str.split("").reduce(((a,b)=>a+b.charCodeAt(0)),0);return[str.length,keyCount,charSum].map((e=>e.toString(36))).join("")},generateRange,generateTimeCode,instanceCount,intersection,isNumeric,isConvertableInteger,isPowerOf2,JSON2CSV:function JSON2CSV(arrayOfJSON,config){if(config&&"object"!=typeof config)return INVALID_VALUES;let{columnTransform={}}=config||{};const{includeTransformAccessors,includeHeaderRow=!0,returnTransformedJSON,removeEmptyColumns,onlyHeaderRow,columnAccessors=[],functionMap={},columnMap={},valuesMap={},context={},delimiter='"',columnJoiner=",",rowJoiner="\r\n",keyJoiner="."}=config||{};if(!Array.isArray(arrayOfJSON)||!Array.isArray(columnAccessors)||"object"!=typeof context||"object"!=typeof columnMap||"object"!=typeof columnTransform||"object"!=typeof functionMap||"object"!=typeof valuesMap||"string"!=typeof columnJoiner||"string"!=typeof rowJoiner||"string"!=typeof keyJoiner||"string"!=typeof delimiter)return INVALID_VALUES;columnTransform=Object.assign({},...Object.keys(columnTransform).reverse().map((key=>({[key]:Array.isArray(columnTransform[key])?columnTransform[key]:["string"==typeof columnTransform[key]&&columnTransform[key]].filter(Boolean)}))));const flattened=arrayOfJSON.filter(Boolean).map((obj=>flattenJSON(obj,keyJoiner))),transformColumns=Object.values(columnTransform).flat();includeTransformAccessors&&columnAccessors.push(...transformColumns);const headerRow=flattened.reduce(((aggregator,row)=>Object.keys(row).every((key=>!aggregator.includes(key)&&aggregator.push(key)||!0))&&aggregator),[]).filter((key=>!(null==columnAccessors?void 0:columnAccessors.length)||columnAccessors.includes(key))),accessorMap=Object.assign({},...Object.keys(columnTransform).reverse().map((transform=>columnTransform[transform].map((value=>({[value]:transform}))).flat())).flat()),tranformedHeaderRow=headerRow.reduce(((def,key)=>{const transform=accessorMap[key];return transform?def.includes(transform)||def.push(transform):def.push(key),def}),[]).sort(((a,b)=>(null==config?void 0:config.sortOrder)?config.sortOrder.includes(a)&&config.sortOrder.includes(b)&&config.sortOrder.indexOf(a)-config.sortOrder.indexOf(b)||!config.sortOrder.includes(b)&&-1:0));Object.keys(columnMap).forEach((columnName=>!tranformedHeaderRow.includes(columnName)&&tranformedHeaderRow.unshift(columnName))),Object.keys(columnTransform).forEach((columnName=>!tranformedHeaderRow.includes(columnName)&&tranformedHeaderRow.unshift(columnName))),"object"==typeof context&&Object.keys(context).forEach((columnName=>!tranformedHeaderRow.includes(columnName)&&tranformedHeaderRow.unshift(columnName)));let mappedHeaderRow=tranformedHeaderRow.map((key=>columnMap[key]||key));if(onlyHeaderRow)return[mappedHeaderRow];const withDelimiter=value=>`${delimiter}${value}${delimiter}`,columnValueCounts=[];let flattenedRows=flattened.map((row=>Object.values(tranformedHeaderRow.reduce(((columnsMap,columnName,columnIndex)=>{var _a;const accessors=columnTransform[columnName],value=((null==accessors?void 0:accessors.length)?row[accessors.find((accessor=>row[accessor]))]:row[columnName])||(null==context?void 0:context[columnName])||"",mappedValue=(null==(_a=valuesMap[columnName])?void 0:_a[value])||value,fxValue="function"==typeof functionMap[columnName]?functionMap[columnName](mappedValue):mappedValue;return columnsMap[columnName]=withDelimiter(fxValue),fxValue&&(columnValueCounts[columnIndex]=(columnValueCounts[columnIndex]||0)+1),columnsMap}),{}))));const indicesToRemove=removeEmptyColumns&&[...columnValueCounts].map(((count,index)=>!count&&index)).filter(isNumeric).reverse();if(indicesToRemove){const purge=row=>row.filter(((value,index)=>!indicesToRemove.includes(index)));flattenedRows=flattenedRows.map(purge),mappedHeaderRow=purge(mappedHeaderRow)}const rows=flattenedRows.map((row=>row.join(columnJoiner)));return returnTransformedJSON?rows.map((row=>{const columnValues=row.split(columnJoiner);return Object.assign({},...columnValues.map(((v,i)=>({[mappedHeaderRow[i]]:v}))))})):includeHeaderRow?[mappedHeaderRow.map(withDelimiter).join(columnJoiner),...rows].join(rowJoiner):rows.join(rowJoiner)},flattenJSON,makeDeepCopy,nearestPowerOf2,nextPowerOf2,numericSort,overlap,parseAgeCategoryCode,randomMember,randomPop,shuffleArray,unique,UUID,UUIDS:function UUIDS(count=1){return generateRange(0,count).map(UUID)}}},"./node_modules/yallist/iterator.js":module=>{"use strict";module.exports=function(Yallist){Yallist.prototype[Symbol.iterator]=function*(){for(let walker=this.head;walker;walker=walker.next)yield walker.value}}},"./node_modules/yallist/yallist.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";function Yallist(list){var self=this;if(self instanceof Yallist||(self=new Yallist),self.tail=null,self.head=null,self.length=0,list&&"function"==typeof list.forEach)list.forEach((function(item){self.push(item)}));else if(arguments.length>0)for(var i=0,l=arguments.length;i<l;i++)self.push(arguments[i]);return self}function insert(self,node,value){var inserted=node===self.head?new Node(value,null,node,self):new Node(value,node,node.next,self);return null===inserted.next&&(self.tail=inserted),null===inserted.prev&&(self.head=inserted),self.length++,inserted}function push(self,item){self.tail=new Node(item,self.tail,null,self),self.head||(self.head=self.tail),self.length++}function unshift(self,item){self.head=new Node(item,null,self.head,self),self.tail||(self.tail=self.head),self.length++}function Node(value,prev,next,list){if(!(this instanceof Node))return new Node(value,prev,next,list);this.list=list,this.value=value,prev?(prev.next=this,this.prev=prev):this.prev=null,next?(next.prev=this,this.next=next):this.next=null}module.exports=Yallist,Yallist.Node=Node,Yallist.create=Yallist,Yallist.prototype.removeNode=function(node){if(node.list!==this)throw new Error("removing node which does not belong to this list");var next=node.next,prev=node.prev;return next&&(next.prev=prev),prev&&(prev.next=next),node===this.head&&(this.head=next),node===this.tail&&(this.tail=prev),node.list.length--,node.next=null,node.prev=null,node.list=null,next},Yallist.prototype.unshiftNode=function(node){if(node!==this.head){node.list&&node.list.removeNode(node);var head=this.head;node.list=this,node.next=head,head&&(head.prev=node),this.head=node,this.tail||(this.tail=node),this.length++}},Yallist.prototype.pushNode=function(node){if(node!==this.tail){node.list&&node.list.removeNode(node);var tail=this.tail;node.list=this,node.prev=tail,tail&&(tail.next=node),this.tail=node,this.head||(this.head=node),this.length++}},Yallist.prototype.push=function(){for(var i=0,l=arguments.length;i<l;i++)push(this,arguments[i]);return this.length},Yallist.prototype.unshift=function(){for(var i=0,l=arguments.length;i<l;i++)unshift(this,arguments[i]);return this.length},Yallist.prototype.pop=function(){if(this.tail){var res=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,res}},Yallist.prototype.shift=function(){if(this.head){var res=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,res}},Yallist.prototype.forEach=function(fn,thisp){thisp=thisp||this;for(var walker=this.head,i=0;null!==walker;i++)fn.call(thisp,walker.value,i,this),walker=walker.next},Yallist.prototype.forEachReverse=function(fn,thisp){thisp=thisp||this;for(var walker=this.tail,i=this.length-1;null!==walker;i--)fn.call(thisp,walker.value,i,this),walker=walker.prev},Yallist.prototype.get=function(n){for(var i=0,walker=this.head;null!==walker&&i<n;i++)walker=walker.next;if(i===n&&null!==walker)return walker.value},Yallist.prototype.getReverse=function(n){for(var i=0,walker=this.tail;null!==walker&&i<n;i++)walker=walker.prev;if(i===n&&null!==walker)return walker.value},Yallist.prototype.map=function(fn,thisp){thisp=thisp||this;for(var res=new Yallist,walker=this.head;null!==walker;)res.push(fn.call(thisp,walker.value,this)),walker=walker.next;return res},Yallist.prototype.mapReverse=function(fn,thisp){thisp=thisp||this;for(var res=new Yallist,walker=this.tail;null!==walker;)res.push(fn.call(thisp,walker.value,this)),walker=walker.prev;return res},Yallist.prototype.reduce=function(fn,initial){var acc,walker=this.head;if(arguments.length>1)acc=initial;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");walker=this.head.next,acc=this.head.value}for(var i=0;null!==walker;i++)acc=fn(acc,walker.value,i),walker=walker.next;return acc},Yallist.prototype.reduceReverse=function(fn,initial){var acc,walker=this.tail;if(arguments.length>1)acc=initial;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");walker=this.tail.prev,acc=this.tail.value}for(var i=this.length-1;null!==walker;i--)acc=fn(acc,walker.value,i),walker=walker.prev;return acc},Yallist.prototype.toArray=function(){for(var arr=new Array(this.length),i=0,walker=this.head;null!==walker;i++)arr[i]=walker.value,walker=walker.next;return arr},Yallist.prototype.toArrayReverse=function(){for(var arr=new Array(this.length),i=0,walker=this.tail;null!==walker;i++)arr[i]=walker.value,walker=walker.prev;return arr},Yallist.prototype.slice=function(from,to){(to=to||this.length)<0&&(to+=this.length),(from=from||0)<0&&(from+=this.length);var ret=new Yallist;if(to<from||to<0)return ret;from<0&&(from=0),to>this.length&&(to=this.length);for(var i=0,walker=this.head;null!==walker&&i<from;i++)walker=walker.next;for(;null!==walker&&i<to;i++,walker=walker.next)ret.push(walker.value);return ret},Yallist.prototype.sliceReverse=function(from,to){(to=to||this.length)<0&&(to+=this.length),(from=from||0)<0&&(from+=this.length);var ret=new Yallist;if(to<from||to<0)return ret;from<0&&(from=0),to>this.length&&(to=this.length);for(var i=this.length,walker=this.tail;null!==walker&&i>to;i--)walker=walker.prev;for(;null!==walker&&i>from;i--,walker=walker.prev)ret.push(walker.value);return ret},Yallist.prototype.splice=function(start,deleteCount,...nodes){start>this.length&&(start=this.length-1),start<0&&(start=this.length+start);for(var i=0,walker=this.head;null!==walker&&i<start;i++)walker=walker.next;var ret=[];for(i=0;walker&&i<deleteCount;i++)ret.push(walker.value),walker=this.removeNode(walker);null===walker&&(walker=this.tail),walker!==this.head&&walker!==this.tail&&(walker=walker.prev);for(i=0;i<nodes.length;i++)walker=insert(this,walker,nodes[i]);return ret},Yallist.prototype.reverse=function(){for(var head=this.head,tail=this.tail,walker=head;null!==walker;walker=walker.prev){var p=walker.prev;walker.prev=walker.next,walker.next=p}return this.head=tail,this.tail=head,this};try{__webpack_require__("./node_modules/yallist/iterator.js")(Yallist)}catch(er){}}}]);
//# sourceMappingURL=748.5434f2b7.iframe.bundle.js.map